<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="SVG">SVG</h2><blockquote><p>可缩放矢量图</p></blockquote><h4 id="SVG-文档基本结构">SVG 文档基本结构</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&#x27;140&#x27;</span> <span class="attr">heiight</span>=<span class="string">&#x27;170&#x27;</span> <span class="attr">xmlns</span>=<span class="string">&#x27;http://wwww.w3.org/2000/svg&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Cat<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">desc</span>&gt;</span>Stick Figure of Cat<span class="tag">&lt;/<span class="name">desc</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 在这里绘制图像 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><svg> 以像素为单位定义了整个图像的 width 和 height，还通过 xmlns 属性定义了 SVG 的命名空间</p><title> 元素的内容可以被阅读器显示在标题栏上或者是作为鼠标指针指向图像时的提示<desc> 元素允许咱们为图像定义完整的描述信息<h4 id="基本形状和属性">基本形状和属性</h4><ul><li>基本图形</li></ul><p><rect>、<circle>、<ellipse>、<line>、<polyline>、<polygon></p><ul><li>基本属性</li></ul><p>fill、stroke、stroke-width、transform</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="监听-浏览器-Tab-切换">监听 浏览器 Tab 切换</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 切换浏览器窗口</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">changeWindowsTab</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// chrome sougou</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;webkitVisibilityState&quot;</span> <span class="keyword">in</span> <span class="variable language_">document</span>) &#123;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;webkitvisibilitychange&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">webkitVisibilityState</span> === <span class="string">&quot;hidden&quot;</span>) &#123;</span><br><span class="line"><span class="comment">// 离开了，对数据进行处理，例如关闭流</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123;<span class="attr">leave</span>: <span class="literal">true</span>&#125;, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 回来了，对数据处理，如开启流</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123;<span class="attr">leave</span>: <span class="literal">false</span>&#125;, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// IE</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;msvisibilitychange&quot;</span> <span class="keyword">in</span> <span class="variable language_">document</span>) &#123;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;msvisibilitychange&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">msVisibilityState</span> === <span class="string">&quot;hidden&quot;</span>) &#123;</span><br><span class="line"><span class="comment">// 离开了，对数据进行处理，例如关闭流</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123;<span class="attr">leave</span>: <span class="literal">true</span>&#125;, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">// 回来了，对数据处理，如开启流</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123;<span class="attr">leave</span>: <span class="literal">false</span>&#125;, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// FF</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="string">&quot;mozvisibilitychange&quot;</span> <span class="keyword">in</span> <span class="variable language_">document</span>) &#123;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;mozvisibilitychange&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">mozVisibilityState</span> === <span class="string">&quot;hidden&quot;</span>) &#123;</span><br><span class="line"><span class="comment">// 离开了，对数据进行处理，例如关闭流</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123;<span class="attr">leave</span>: <span class="literal">true</span>&#125;, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">// 回来了，对数据处理，如开启流</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">postMessage</span>(&#123;<span class="attr">leave</span>: <span class="literal">false</span>&#125;, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="监听浏览器刷新及关闭">监听浏览器刷新及关闭</h3><blockquote><p>onbeforeunload 和 onunload 都是在页面刷新或退出时触发的事件</p></blockquote><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">用法：</span><br><span class="line"></span><br><span class="line">事件用法</span><br><span class="line"><span class="variable">onunload</span><span class="variable">window.onunload</span>=<span class="function"><span class="title">function</span>()&#123;<span class="variable">SomeJavaScriptCode</span>&#125;;</span></span><br><span class="line"><span class="function"><span class="variable">onbeforeunload</span><span class="variable">window.onbeforeunload</span>=<span class="title">function</span>()&#123;<span class="variable">SomeJavaScriptCode</span>&#125;;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">区别：</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">unbeforeunload</span>()是在页面刷新或关闭之前触发的事件，而<span class="title">onubload</span>()是在页面刷新或关闭之后才会触发的。</span></span><br><span class="line"><span class="function"><span class="title">unbeforeunload</span>()事件执行的顺序在<span class="title">onunload</span>()事件之前发生。</span></span><br><span class="line"><span class="function"><span class="title">unbeforeunload</span>()事件可以禁止<span class="title">onunload</span>()事件的触发。</span></span><br><span class="line"><span class="function"><span class="title">onunload</span>()事件是无法阻止页面关闭的。</span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="Stylelint">Stylelint</h2><h3 id="说明">说明</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;stylelint-config-prettier&quot;</span>: 解决 prettier 与 stylelint 的冲突</span><br><span class="line"><span class="string">&quot;stylelint-config-standard&quot;</span>: 它扩展了 stylelint-config-recommended，并开启了附加规则，以执行 CSS 规范中的现代约定。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="Commitlint">Commitlint</h2><blockquote><p>一个 git commit 校验约束工具，就是当我们运行git commmit -m 'xxx’时，来检查’xxx’是不是满足团队约定好的提交规范的工具。</p></blockquote><h4 id="安装依赖">安装依赖</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pnpm install @commitlint/<span class="built_in">config</span>-conventional @commitlint/cli -D -w</span><br><span class="line"></span><br><span class="line">@commitlint/cli</span><br><span class="line">commitlint命令行工具，用于在项目中快速引入 commit message 规范和 commitlint 相关配置规范</span><br><span class="line"></span><br><span class="line">@commitlint/<span class="built_in">config</span>-conventional</span><br><span class="line">commitlint规则集(通常通过commitlint.<span class="built_in">config</span>.js指定)</span><br><span class="line"></span><br><span class="line">commitizen</span><br><span class="line">对应<span class="built_in">package</span>.json <span class="built_in">config</span> commitizen, 格式化commmit message的工具(从commit生成Change <span class="built_in">log</span>)</span><br><span class="line"></span><br><span class="line">cz-conventional-changelog</span><br><span class="line">日志变更标准</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="配置commitlint-hook">配置commitlint hook</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">npx</span> husky add .husky/commit-msg <span class="string">&#x27;npx commitlint --edit <span class="variable">$1</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">commitlint --edit &lt;文件名&gt;：执行 commitlint 命令行工具，并使用 --edit 选项，从一个文件里提取 commit 内容来进行校验。校验规则由 commitlint.config.js 配置文件来指定，reference-cli</span></span><br><span class="line"><span class="string"><span class="variable">$1</span>：在新版的 husky 中 <span class="variable">$HUSKY_GIT_PARAMS</span> 变量已不再使用，取而代之是 <span class="variable">$1</span> </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="Git-相关问题">Git 相关问题</h2><p><strong>Git 远程仓库文件名大小写</strong></p><ul><li>设置本地git环境识别大小写</li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config core.ignorecase <span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li>删除多余的文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">rm</span> --cached src/components/Header -r</span></span><br></pre></td></tr></table></figure><ul><li>同步，提交到远程仓库</li></ul><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">add</span> . <span class="variable">&amp;&amp;</span> git commit -m <span class="string">&quot;规范组件命名&quot;</span> <span class="variable">&amp;&amp;</span> git push origin dev</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<ul><li>PeerTube 是一款开源的去中心化视频分享平台</li><li>Fluent-ffmpeg 基于FFmpeg的JavaScript接口，用于处理音频和视频</li></ul><p>流媒体开发库</p><ul><li>Hls.js 实现HTTP Live Streaming客户端。 它依靠HTML5视频和MediaSource扩展进行播放</li><li>MediaStreamRecorder: 用于录制音频和视频的JavaScript库</li><li>WebTorrent 浏览器中实现的BitTorrent客户端，支持实时流媒体，边下边播</li><li>video.js 开源HTML5和Flash视频播放器</li></ul><p>弹幕</p><ul><li>danmaku2ass 将弹幕转换为ASS字幕格式，适用于播放器如mpv，基于Python</li><li>原生JS:<ul><li>横向：<a href="https://github.com/hugeorange/BulletJs.git">https://github.com/hugeorange/BulletJs.git</a></li><li>纵向：<a href="https://segmentfault.com/a/1190000022634959">https://segmentfault.com/a/1190000022634959</a></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* h5 直播间弹幕列表组件</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 使用方式</span></span><br><span class="line"><span class="comment">* &#123;liveInfo.danmuChannel &amp;&amp; &lt;DanmuPanel ref=&#123;ref =&gt; this.danmuRef = ref&#125; wrapH=&#123;DANMUWRAPH&#125;/&gt; &#125;</span></span><br><span class="line"><span class="comment">* 父组件socket拿到数据通过组件 ref 实例调用 addDanmu(data)</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 如需样式调整请自行修改less样式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&quot;classnames&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debounce, isScrollBottom &#125; <span class="keyword">from</span> <span class="string">&quot;@/util/index&quot;</span>; <span class="comment">// 自行实现或参考我下面的代码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.less&quot;</span>;</span><br><span class="line"></span><br><span class="line">interface propsType &#123;</span><br><span class="line">    wrapH?: string; <span class="comment">// 弹幕容器高度</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弹幕对象类型</span></span><br><span class="line">type contentType = &#123;</span><br><span class="line">    <span class="attr">name</span>: string;</span><br><span class="line">    <span class="attr">content</span>: string;</span><br><span class="line">    <span class="attr">key</span>: string;</span><br><span class="line">    reactId?: any; <span class="comment">// 列表唯一标识，如不传会自动添加</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">DanmuPanel</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;propsType, any&gt; &#123;</span><br><span class="line">    <span class="attr">danmuWrapHeight</span>: number; <span class="comment">// 弹幕容器dom高度</span></span><br><span class="line">    <span class="attr">danmuWrapRef</span>: <span class="title class_">HTMLElement</span>; <span class="comment">// 弹幕容器dom</span></span><br><span class="line">    <span class="attr">danmuListRef</span>: <span class="title class_">HTMLElement</span>; <span class="comment">// 弹幕列表dom</span></span><br><span class="line">    <span class="attr">restNums</span>: number;</span><br><span class="line">    <span class="attr">reactId</span>: number; <span class="comment">// 弹幕列表 key</span></span><br><span class="line">    <span class="attr">debounceCb</span>: <span class="title class_">Function</span>;</span><br><span class="line">    <span class="attr">isBindScrolled</span>: boolean;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">danmuList</span>: [],</span><br><span class="line">            <span class="attr">restDanmu</span>: <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">restNums</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reactId</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">debounceCb</span> = <span class="title function_">debounce</span>(<span class="variable language_">this</span>.<span class="property">danmuScroll</span>, <span class="number">200</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initDom</span>();</span><br><span class="line">        <span class="comment">// this.testAddDanmu();</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 测试代码，后期删掉</span></span><br><span class="line">    <span class="title function_">testAddDanmu</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            ++i</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">addDanmu</span>(&#123;</span><br><span class="line">                <span class="attr">name</span>: i + <span class="string">&#x27;-我是名字&#x27;</span>,</span><br><span class="line">                <span class="attr">content</span>: i + <span class="string">&#x27;-我是内容&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&quot;danmu&quot;</span>,</span><br><span class="line">                <span class="attr">reactId</span>: i</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;, <span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title function_">initDom</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">danmuWrapRef</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.danmu-wrap&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">danmuListRef</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.danmu-wrap .list&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">danmuWrapHeight</span> = <span class="variable language_">this</span>.<span class="property">danmuWrapRef</span>.<span class="property">offsetHeight</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private addScroll = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">debounceCb</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isBindScrolled</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 弹幕列表滚动到底部回调</span></span><br><span class="line">    private danmuScroll = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">ele</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">this</span>.<span class="property">danmuWrapRef</span>;</span><br><span class="line">        <span class="keyword">const</span> isBottom = <span class="title function_">isScrollBottom</span>(ele, ele.<span class="property">clientHeight</span>);</span><br><span class="line">        <span class="keyword">if</span> (isBottom) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">restNums</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">restDanmu</span>: <span class="number">0</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 供父组件调用 socket拿到结果后调用</span></span><br><span class="line">    public addDanmu = <span class="function">(<span class="params">data: contentType</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; danmuList &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">        data.<span class="property">reactId</span> = ++<span class="variable language_">this</span>.<span class="property">reactId</span>;</span><br><span class="line">        <span class="keyword">if</span> (danmuList.<span class="property">length</span> &gt;= <span class="number">150</span>) &#123;</span><br><span class="line">            danmuList.<span class="title function_">splice</span>(<span class="number">0</span>, <span class="number">50</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        danmuList.<span class="title function_">push</span>(data);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; danmuList &#125;, <span class="variable language_">this</span>.<span class="property">renderDanmu</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private renderDanmu = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> listH = <span class="variable language_">this</span>.<span class="property">danmuListRef</span>.<span class="property">offsetHeight</span>;</span><br><span class="line">        <span class="keyword">const</span> diff = listH - <span class="variable language_">this</span>.<span class="property">danmuWrapHeight</span>;</span><br><span class="line">        <span class="keyword">const</span> top = <span class="variable language_">this</span>.<span class="property">danmuWrapRef</span>.<span class="property">scrollTop</span>;</span><br><span class="line">        <span class="keyword">if</span> (diff - top &lt; <span class="number">50</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (diff &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isBindScrolled</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">isBindScrolled</span> = <span class="literal">false</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">danmuWrapRef</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="variable language_">this</span>.<span class="property">addScroll</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">danmuWrapRef</span>.<span class="title function_">scrollTo</span>(&#123; <span class="attr">top</span>: diff + <span class="number">40</span>, <span class="attr">left</span>: <span class="number">0</span>, <span class="attr">behavior</span>: <span class="string">&#x27;smooth&#x27;</span> &#125;);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">restNums</span> = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ++<span class="variable language_">this</span>.<span class="property">restNums</span>;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isBindScrolled</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isBindScrolled</span> = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">danmuWrapRef</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="variable language_">this</span>.<span class="property">addScroll</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">restDanmu</span>: <span class="variable language_">this</span>.<span class="property">restNums</span> &gt;= <span class="number">99</span> ? <span class="string">&#x27;99+&#x27;</span> : <span class="variable language_">this</span>.<span class="property">restNums</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private scrollBottom = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">restNums</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">restDanmu</span>: <span class="variable language_">this</span>.<span class="property">restNums</span> &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">danmuWrapRef</span>.<span class="title function_">scrollTo</span>(&#123; <span class="attr">top</span>: <span class="variable language_">this</span>.<span class="property">danmuListRef</span>.<span class="property">offsetHeight</span>, <span class="attr">left</span>: <span class="number">0</span>, <span class="attr">behavior</span>: <span class="string">&#x27;smooth&#x27;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; danmuList, restDanmu &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;danmu-panel&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;danmu-wrap&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">height:</span> <span class="attr">this.props.wrapH</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        &#123;</span></span><br><span class="line"><span class="language-xml">                            danmuList.map((v) =&gt; (</span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;v.reactId&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;v.name&#125;：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">&#123;classnames(</span>&quot;<span class="attr">content</span>&quot;, <span class="attr">v.key</span>)&#125;&gt;</span>&#123;v.content&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            ))</span></span><br><span class="line"><span class="language-xml">                        &#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;</span></span><br><span class="line"><span class="language-xml">                    !!restDanmu &amp;&amp;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;rest-nums&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.scrollBottom&#125;</span>&gt;</span>&#123; restDanmu &#125;条新消息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// debounce isScrollBottom 实现如下</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 防抖函数</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> fn </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> wait </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn:<span class="built_in">Function</span>, wait:number = <span class="number">500</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">timeout</span>:number = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 每次触发 scroll handler 时先清除定时器</span></span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">        <span class="comment">// 指定 xx ms 后触发真正想进行的操作 handler</span></span><br><span class="line">        timeout = <span class="built_in">setTimeout</span>(fn, wait);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 是否滚到到容器底部</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> ele 滚动容器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> wrapHeight 容器高度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">isScrollBottom</span>(<span class="params">ele: HTMLElement, wrapHeight:number, threshold: number = <span class="number">30</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> h1 = ele.<span class="property">scrollHeight</span> - ele.<span class="property">scrollTop</span>;</span><br><span class="line">    <span class="keyword">const</span> h2 = wrapHeight + threshold;</span><br><span class="line">    <span class="keyword">const</span> isBottom = h1 &lt;= h2;</span><br><span class="line">    <span class="comment">// console.log(&#x27;--&gt;&#x27;, isBottom, ele.scrollHeight, ele.scrollTop, h2)</span></span><br><span class="line">    <span class="keyword">return</span> isBottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>h5直播拉流页面调研: <a href="https://segmentfault.com/a/1190000037750253">https://segmentfault.com/a/1190000037750253</a></li></ul></li><li>斗鱼弹幕抓取及可视化管理平台： <a href="https://github.com/Crawler995/DouyuBarrage-Pro.git">https://github.com/Crawler995/DouyuBarrage-Pro.git</a></li><li>a-barrage: <a href="https://github.com/logcas/a-barrage.git">https://github.com/logcas/a-barrage.git</a></li></ul><p>直播间</p><ul><li>LiveRoom<ul><li>地址<ul><li>前端：<a href="https://github.com/jack-hoo/LiveRoomDemo_Client.git">https://github.com/jack-hoo/LiveRoomDemo_Client.git</a><ul><li>核心技术点：hls.js、websocket、</li></ul></li><li>后端：<a href="https://github.com/jack-hoo/LiveRoomDemo_Server.git">https://github.com/jack-hoo/LiveRoomDemo_Server.git</a></li></ul></li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="localtunnel">localtunnel</h3><p><strong>全局安装</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> -g localtunnel</span><br></pre></td></tr></table></figure><p><strong>申请通道URL</strong></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lt <span class="comment">--port 8000</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="永久免费vps申请，超强配置，8核心，32G内存">永久免费vps申请，超强配置，8核心，32G内存</h3><p>永久云服务器申请连接：<a href="https://dashboard.render.com/">https://dashboard.render.com/</a></p><p>Githube注册连接：<a href="https://github.com/">https://github.com/</a></p><p>Docker代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 Ubuntu 22.04 作为基础镜像</span></span><br><span class="line">FROM ubuntu:22.04</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 Shellinabox</span></span><br><span class="line">RUN apt-get update &amp;&amp; \</span><br><span class="line">    apt-get install -y shellinabox &amp;&amp; \</span><br><span class="line">    apt-get clean &amp;&amp; \</span><br><span class="line">    <span class="built_in">rm</span> -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 root 用户的密码为 &#x27;root&#x27;</span></span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">&#x27;root:frepai&#x27;</span> | chpasswd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露 22 端口</span></span><br><span class="line">EXPOSE 22</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Shellinabox</span></span><br><span class="line">CMD [<span class="string">&quot;/usr/bin/shellinaboxd&quot;</span>, <span class="string">&quot;-t&quot;</span>, <span class="string">&quot;-s&quot;</span>, <span class="string">&quot;/:LOGIN&quot;</span>]</span><br></pre></td></tr></table></figure><p>VPS申请完成之后，需要安装最基础的软件包，因为我们申请的是底层的unbutu操作系统，操作性非常强，需要什么就安装什么！</p><p>更新系统：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure><p>安装基础软件包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install sudo curl wget nano screen git</span><br></pre></td></tr></table></figure><p>安装neofetch工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install neofetch</span><br></pre></td></tr></table></figure><p>调用显示系统信息命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neofetch</span><br></pre></td></tr></table></figure><p>[<a href="https://frepai.com/">https://frepai.com/</a>]</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://nic.eu.org">https://nic.eu.org</a></p><p><a href="https://www.fakenamegenerator.com">https://www.fakenamegenerator.com</a></p><p><a href="https://sjc.alpha3cloud.com">https://sjc.alpha3cloud.com</a></p><p>userInfo</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">United</span> <span class="string">Kingdom</span></span><br><span class="line"></span><br><span class="line"><span class="string">Jason</span> <span class="string">M.</span> <span class="string">Rodriguez</span></span><br><span class="line"><span class="number">34</span> <span class="string">Lamphey</span> <span class="string">Road</span></span><br><span class="line"><span class="string">THE</span> <span class="string">BRATCH</span></span><br><span class="line"><span class="string">WV5</span> <span class="string">3SR</span></span><br><span class="line"><span class="number">078</span> <span class="number">0832 </span><span class="number">9954</span></span><br><span class="line"></span><br><span class="line"><span class="string">Elizabeth</span> <span class="string">B.</span> <span class="string">Mercier</span></span><br><span class="line"><span class="number">87</span> <span class="string">Park</span> <span class="string">Place</span></span><br><span class="line"><span class="string">CARTMEL</span></span><br><span class="line"><span class="string">LA11</span> <span class="string">9SG</span></span><br><span class="line"><span class="number">070</span> <span class="number">3303 </span><span class="number">8997</span></span><br><span class="line"></span><br><span class="line"><span class="string">Donna</span> <span class="string">S.</span> <span class="string">Hedges</span></span><br><span class="line"><span class="number">75</span> <span class="string">Simone</span> <span class="string">Weil</span> <span class="string">Avenue</span></span><br><span class="line"><span class="string">WEARE</span> <span class="string">GIFFARD</span></span><br><span class="line"><span class="string">EX39</span> <span class="string">1NX</span></span><br><span class="line"><span class="number">078</span> <span class="number">5843 </span><span class="number">7176</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">Cheryl</span> <span class="string">H.</span> <span class="string">Davis</span></span><br><span class="line"><span class="number">70</span> <span class="string">Bootham</span> <span class="string">Crescent</span></span><br><span class="line"><span class="string">RIDLINGTON</span></span><br><span class="line"><span class="string">NR28</span> <span class="string">2SU</span></span><br><span class="line"><span class="number">077</span> <span class="number">6454 </span><span class="number">6457</span></span><br><span class="line"></span><br><span class="line"><span class="string">Account</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">JMR76-FREE</span></span><br></pre></td></tr></table></figure><p>LocalTunnel ：<a href="https://theboroer.github.io/localtunnel-www/">https://theboroer.github.io/localtunnel-www/</a> 允许用户通过公网 URL 访问本地主机。</p><p>临时邮箱网站<br><a href="https://temp-mail.org">https://temp-mail.org</a></p><p>privatevpn</p><p>查看IP地址<br><a href="http://www.whoer.net">www.whoer.net</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="bpmn-js">bpmn.js</h3><p><strong>基本概念</strong></p><ul><li>diagram element 图表元素</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">id:</span> <span class="string">&quot;StartEvent_1y45yut&quot;</span>,</span><br><span class="line"><span class="symbol">type:</span> <span class="string">&quot;bpmn:StartEvent&quot;</span>,</span><br><span class="line"><span class="symbol">businessObject:</span> <span class="punctuation">&#123;</span></span><br><span class="line">$type: <span class="string">&quot;bpmn:StartEvent&quot;</span>,</span><br><span class="line"><span class="symbol">name:</span> <span class="string">&quot;开始&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li>xml 标签称之为BPMN element</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;startEvent <span class="attribute">id</span>=<span class="string">&quot;StartEvent_1y45yut&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;开始&quot;</span>&gt;&lt;/startEvent&gt;</span><br></pre></td></tr></table></figure><ul><li>官方 Panel</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> 这里引入的是右侧属性栏这个框</span><br><span class="line">import propertiesPanelModule from <span class="string">&#x27;bpmn-js-properties-panel&#x27;</span></span><br><span class="line"><span class="regexp">//</span> 而这个引入的是右侧属性栏里的内容</span><br><span class="line">import propertiesProviderModule from <span class="string">&#x27;bpmn-js-properties-panel/lib/provider/camunda&#x27;</span></span><br><span class="line"></span><br><span class="line">additionalModules: [</span><br><span class="line">  propertiesPanelModule,</span><br><span class="line">  propertiesProviderModule</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> propertiesPanelModule 表示的是属性栏这个框, 就是告诉别人这里要有个属性栏;</span><br><span class="line"><span class="regexp">//</span> propertiesProviderModule 表示的是属性栏里的内容, 也就是点击不同的element该显示什么内容.</span><br></pre></td></tr></table></figure><ul><li>两者的一些属性关联起来靠的是一个叫做businessObject的属性</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="统计代码行数">统计代码行数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --format=<span class="string">&#x27;%aN&#x27;</span> | <span class="built_in">sort</span> -u | <span class="keyword">while</span> <span class="built_in">read</span> name; <span class="keyword">do</span> <span class="built_in">echo</span> -en <span class="string">&quot;<span class="variable">$name</span>\t&quot;</span>; git <span class="built_in">log</span> --author=<span class="string">&quot;<span class="variable">$name</span>&quot;</span> --pretty=tformat: --since ==2022–01-01 --<span class="keyword">until</span>=2022-12-30 --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="Git-Tag-管理">Git Tag 管理</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">tag</span> <span class="title">列出所有tag</span></span><br><span class="line"></span><br><span class="line">git fetch --tags 下载所有 <span class="keyword">tag</span> <span class="title">至本地</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">git</span> checkout tagName 切换至指定<span class="keyword">tag</span></span><br><span class="line"></span><br><span class="line"><span class="title">git</span> <span class="keyword">tag</span> <span class="title">-l</span> | xargs git <span class="keyword">tag</span> <span class="title">-d</span> <span class="comment">#删除所有本地分支</span></span><br><span class="line">git fetch origin --prune <span class="comment">#从远程拉取所有信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查询远程tags的命令如下：</span></span><br><span class="line">git ls-remote --tags origin</span><br><span class="line"></span><br><span class="line"><span class="keyword">tag</span>常用git命令：</span><br><span class="line">git <span class="keyword">tag</span> <span class="title">#列出所有tag</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-l</span> v1.* <span class="comment">#列出符合条件的tag（筛选作用）</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">#创建轻量tag</span>（无-m标注信息）</span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-a</span> -m ‘first <span class="keyword">version</span>’ <span class="comment">#创建含标注tag</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-a</span> f1bb97a(commit id) <span class="comment">#为之前提交打tag</span></span><br><span class="line"></span><br><span class="line">git push origin --tags <span class="comment">#推送所有本地tag到远程</span></span><br><span class="line">git push origin <span class="comment">#推送指定本地tag到远程</span></span><br><span class="line"></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-d</span> <span class="comment">#删除本地指定tag</span></span><br><span class="line">git push origin --delete tagName <span class="comment">#删除远程指定tag</span></span><br><span class="line"></span><br><span class="line">git fetch origin <span class="comment">#拉取远程指定tag</span></span><br><span class="line">git show <span class="comment">#显示指定tag详细信息</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="临时参考">临时参考</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">git 如何在本地同步远程分支和<span class="keyword">tag</span></span><br><span class="line"></span><br><span class="line"><span class="title">1</span>.git如何同步本地分支与远程origin的分支</span><br><span class="line">问题场景<span class="number">1</span>：</span><br><span class="line">同事A创建了本地分支branchA并push到了远程-&gt;同事B在本地拉取(git fetch)了和远程branchA同步的本地分支branchA-&gt;同事A开发完成将远程分支branchA删除（远程仓库已经不存在分支branchA）-&gt;同事B用git fetch同步远端分支，git branch -r发现本地仍然记录有branchA的远程分支</span><br><span class="line"></span><br><span class="line">分析：远端有新增分支，git fetch可以同步到新的分支到本地，但是远端有删除分支，直接<span class="string">&quot;git fetch&quot;</span>是不能将远程已经不存在的branch等在本地删除的</span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line">git fetch --prune <span class="comment">#这样就可以实现在本地删除远程已经不存在的分支</span></span><br><span class="line">或者简略：</span><br><span class="line">git fetch -p</span><br><span class="line">git fetch -p origin</span><br><span class="line">git remote prune origin</span><br><span class="line"></span><br><span class="line">branch常用的命令：</span><br><span class="line">git branch -a <span class="comment">#查看本地和远程所有的分支</span></span><br><span class="line">git branch -r <span class="comment">#查看所有远程分支</span></span><br><span class="line">git branch <span class="comment">#查看所有本地分支</span></span><br><span class="line">git branch -d -r origin/branchA <span class="comment">#删除远程分支</span></span><br><span class="line"></span><br><span class="line">其他较常用的命令</span><br><span class="line">git fetch <span class="comment">#将本地分支与远程保持同步</span></span><br><span class="line">git checkout -b 本地分支名x origin/远程分支名x <span class="comment">#拉取远程分支并同时创建对应的本地分支</span></span><br><span class="line"></span><br><span class="line">问题场景<span class="number">2</span>：</span><br><span class="line">本地分支提示：Git Your branch is ahead of ‘origin/<span class="literal">master</span>’ by X commits，你想让本地直接和远程保持同步，想让不再提示这个讨厌信息，那么如果你本地的commit确保不想要，可以如下操作：</span><br><span class="line">解决方法：</span><br><span class="line"><span class="number">1</span>）git reset --hard origin/<span class="keyword">master</span></span><br><span class="line"></span><br><span class="line"><span class="title">或者还有一个将本地代码与服务器代码更新一致的语句</span></span><br><span class="line"><span class="title">2</span>）git branch -u origin/<span class="keyword">master</span></span><br><span class="line"></span><br><span class="line"><span class="title">如果想直接回退版本让远程和本地代码保持一致，那就确保本地代码没问题之后强制推到远程</span></span><br><span class="line"><span class="title">git</span> push -f origin <span class="keyword">master</span></span><br><span class="line"></span><br><span class="line"><span class="title">2</span>.git 如何同步本地<span class="keyword">tag</span>与远程<span class="keyword">tag</span></span><br><span class="line"><span class="title">问题场景：</span></span><br><span class="line"><span class="title">同事A</span>在本地创建tagA并push同步到了远程-&gt;同事B在本地拉取了远程tagA(git fetch)-&gt;同事A工作需要将远程标签tagA删除-&gt;同事B用git fetch同步远端信息，git <span class="keyword">tag</span>后发现本地仍然记录有tagA</span><br><span class="line"></span><br><span class="line">分析：对于远程repository中已经删除了的<span class="keyword">tag</span>，即使使用git fetch --prune，甚至<span class="string">&quot;git fetch --tags&quot;</span>确保下载所有tags，也不会让其在本地也将其删除的。而且，似乎git目前也没有提供一个直接的命令和参数选项可以删除本地的在远程已经不存在的<span class="keyword">tag</span>（我目前是没找到有关这类<span class="keyword">tag</span>问题的git命令~~，有知道的同学可以告知我下，互相进步）。</span><br><span class="line">解决方法：</span><br><span class="line"></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-l</span> | xargs git <span class="keyword">tag</span> <span class="title">-d</span> <span class="comment">#删除所有本地分支</span></span><br><span class="line">git fetch origin --prune <span class="comment">#从远程拉取所有信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查询远程tags的命令如下：</span></span><br><span class="line">git ls-remote --tags origin</span><br><span class="line"></span><br><span class="line"><span class="keyword">tag</span>常用git命令：</span><br><span class="line">git <span class="keyword">tag</span> <span class="title">#列出所有tag</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-l</span> v1.* <span class="comment">#列出符合条件的tag（筛选作用）</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">#创建轻量tag</span>（无-m标注信息）</span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-a</span> -m ‘first <span class="keyword">version</span>’ <span class="comment">#创建含标注tag</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-a</span> f1bb97a(commit id) <span class="comment">#为之前提交打tag</span></span><br><span class="line"></span><br><span class="line">git push origin --tags <span class="comment">#推送所有本地tag到远程</span></span><br><span class="line">git push origin <span class="comment">#推送指定本地tag到远程</span></span><br><span class="line"></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-d</span> <span class="comment">#删除本地指定tag</span></span><br><span class="line">git push origin :refs/tags/ <span class="comment">#删除远程指定tag</span></span><br><span class="line"></span><br><span class="line">git fetch origin <span class="comment">#拉取远程指定tag</span></span><br><span class="line">git show <span class="comment">#显示指定tag详细信息</span></span><br></pre></td></tr></table></figure><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 轻量标签</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">tagname</span></span><br><span class="line">eg: git <span class="keyword">tag</span> <span class="title">v1</span>.<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 附注标签</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-a</span> tagname -m &#x27;<span class="keyword">tag</span> <span class="title">describe</span>&#x27;</span><br><span class="line">eg: git <span class="keyword">tag</span> <span class="title">-a</span> v1.<span class="number">4</span> -m &#x27;my <span class="keyword">version</span> <span class="number">1.4</span>&#x27;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对某个历史提交打标签</span></span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-a</span> <span class="tag">&lt;tagname&gt;</span> <span class="tag">&lt;sha-1&gt;</span></span><br><span class="line">eg: git <span class="keyword">tag</span> <span class="title">-a</span> v1.<span class="number">2</span> <span class="number">9</span>fceb02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有标签</span></span><br><span class="line">git <span class="keyword">tag</span></span><br><span class="line"></span><br><span class="line"><span class="title"># 查看1</span>.<span class="number">8</span>系列</span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-l</span> &#x27;v1.<span class="number">8</span>.*&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">删除标签</span><br><span class="line">git <span class="keyword">tag</span> <span class="title">-d</span> <span class="tag">&lt;tagname&gt;</span></span><br><span class="line">eg: git <span class="keyword">tag</span> <span class="title">-d</span> v1.<span class="number">4</span>-lw</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 共享标签</span></span><br><span class="line">默认情况下，git push 命令并不会传送标签到远程仓库服务器上。</span><br><span class="line">如果要共享标签，必须显示的推送标签到远程仓库。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送单个标签</span></span><br><span class="line">git push origin <span class="tag">&lt;tagname&gt;</span></span><br><span class="line">eg: git push origin v1.<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有标签</span></span><br><span class="line">git push origin --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程标签</span></span><br><span class="line">git push origin --delete <span class="tag">&lt;tagname&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>git log：该命令显示从最近到最远的提交日志。</p><p>git log - -pretty=oneline：将只会显示提交的commit id号和对应的注释。(这里是两个-，Markdown显示两个-为一个-)</p><p>如果你在本地做了错误提交，那么回退版本的方法很简单<br>1.先用下面命令找到要回退的版本的commit id：git reflog<br>2.接着回退版本: git reset –hard commit id</p><p>回退远程分支</p><ol><li>git push -f origin master</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>kong</h1><blockquote><p>网关是微服务中不可或缺的一部分，它承载了所有请求流量入口，参数验证拦截，用户权限验证，但是除了JAVA的spring cloud之外，公共网关屈指可数，其中最受关注的就是KONG了</p></blockquote><h1>下载kong镜像</h1><p>docker pull kong</p><h1>命名 kong</h1><p>docker tag kong kong</p><h1>下载konga</h1><p>docker pull pantsel/konga</p><h1>声明网络</h1><p>docker network create kong-net</p><h1>查看网络</h1><p>docker network ls</p><h1>下载数据库</h1><p>docker pull postgres:9.6</p><h1>创建数据库存储卷</h1><p>docker volume create kong-volume</p><h1>运行数据库（使用 postgres）</h1><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name kong-database --network=kong-net  -v kong-volume:/var/lib/postgresql/data   -p <span class="number">5432</span>:<span class="number">5432</span>   -e <span class="string">&quot;POSTGRES_USER=kong&quot;</span>   -e <span class="string">&quot;POSTGRES_DB=kong&quot;</span>   -e <span class="string">&quot;POSTGRES_PASSWORD=kong&quot;</span>   postgres:<span class="number">9</span>.<span class="number">6</span></span><br></pre></td></tr></table></figure><h1>准备数据库数据和配置</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> --rm <span class="attribute">--network</span>=kong-net -e <span class="string">&quot;KONG_DATABASE=postgres&quot;</span> -e <span class="string">&quot;KONG_PG_HOST=172.27.48.1&quot;</span> -e <span class="string">&quot;KONG_PG_PASSWORD=kong&quot;</span> -e <span class="string">&quot;KONG_PASSWORD=kong&quot;</span> -e <span class="string">&quot;KONG_CASSANDRA_CONTACT_POINTS=kong-database&quot;</span> kong:latest kong migrations bootstrap</span><br></pre></td></tr></table></figure><h1>启动 kong-service</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> run -d --name kong --network=kong-net -e <span class="string">&quot;KONG_DATABASE=postgres&quot;</span> -e <span class="string">&quot;KONG_PG_HOST=kong-database&quot;</span> -e <span class="string">&quot;KONG_CASSANDRA_CONTACT_POINTS=kong-database&quot;</span> -e <span class="string">&quot;KONG_PROXY_ACCESS_LOG=/dev/stdout&quot;</span> -e <span class="string">&quot;KONG_ADMIN_ACCESS_LOG=/dev/stdout&quot;</span> -e <span class="string">&quot;KONG_PROXY_ERROR_LOG=/dev/stderr&quot;</span> -e <span class="string">&quot;KONG_ADMIN_ERROR_LOG=/dev/stderr&quot;</span> -e <span class="string">&quot;KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl&quot;</span> -p <span class="number">8443</span>:<span class="number">8443</span> -p <span class="number">127.0.0.1:8001</span>:<span class="number">8001</span> -p <span class="number">127.0.0.1:8444</span>:<span class="number">8444</span> kong</span><br></pre></td></tr></table></figure><h1>为 konga 创建数据表</h1><p>docker run --rm pantsel/konga -c prepare -a postgres -u postgresql://kong:kong@172.27.48.1/konga</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>ajreport</strong><br><strong>chudayun</strong><br><strong>datagear</strong><br><strong>jimureport</strong></p><h3 id="基于-HTML5-Canvas-的交互式地铁线路图">基于 HTML5 Canvas 的交互式地铁线路图</h3><ul><li><a href="https://www.hightopo.com/demo/subway/index.html">https://www.hightopo.com/demo/subway/index.html</a></li></ul><p>PC 扫码原理？</p><p>网页端展示二维码，同时不断的向服务端发送请求询问该二维码的状态；<br>手机端扫描二维码，读取二维码成功后，跳转至确认登录页，若用户确认登录，则服务器修改二维码状态，并返回用户登录信息；<br>网页端收到服务器端二维码状态改变，则跳转登录后页面；<br>若超过一定时间用户未操作，网页端二维码失效，需要重新刷新生成新的二维码。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>w3cschoolSql</title>
      <link href="/posts/a68635.html"/>
      <url>/posts/a68635.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  @<span class="variable">@FOREIGN_KEY_CHECKS</span>;</span><br><span class="line">use w3cschool;</span><br><span class="line"><span class="keyword">SET</span> NAMES utf8;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `w3cschool_tbl`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> w3cschool_tbl(</span><br><span class="line">   w3cschool_id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">   w3cschool_title <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   w3cschool_author <span class="type">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">   submission_date <span class="type">DATE</span>,</span><br><span class="line">   <span class="keyword">PRIMARY</span> KEY ( w3cschool_id )</span><br><span class="line">  ) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> w3cschool_tbl </span><br><span class="line">     (w3cschool_title, w3cschool_author, submission_date)</span><br><span class="line">     <span class="keyword">VALUES</span></span><br><span class="line">     (&quot;Learn PHP&quot;, &quot;John Poul&quot;, NOW()),</span><br><span class="line"> (&quot;Learn MySQL&quot;, &quot;Abdul S&quot;, NOW()),</span><br><span class="line"> (&quot;JAVA Tutorial&quot;, &quot;Sanjay&quot;, <span class="string">&#x27;2007-05-06&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Table structure for `employee_tbl`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `employee_tbl`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `employee_tbl` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `singin` tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;登录次数&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">--  Records of `employee_tbl`</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `employee_tbl` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;小明&#x27;</span>, <span class="string">&#x27;2016-04-22 15:25:33&#x27;</span>, <span class="string">&#x27;1&#x27;</span>), (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;小王&#x27;</span>, <span class="string">&#x27;2016-04-20 15:25:47&#x27;</span>, <span class="string">&#x27;3&#x27;</span>), (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;小丽&#x27;</span>, <span class="string">&#x27;2016-04-19 15:26:02&#x27;</span>, <span class="string">&#x27;2&#x27;</span>), (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;小王&#x27;</span>, <span class="string">&#x27;2016-04-07 15:26:14&#x27;</span>, <span class="string">&#x27;4&#x27;</span>), (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;小明&#x27;</span>, <span class="string">&#x27;2016-04-11 15:26:40&#x27;</span>, <span class="string">&#x27;4&#x27;</span>), (<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;小明&#x27;</span>, <span class="string">&#x27;2016-04-04 15:26:54&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tcount_tbl` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `w3cschool_author` <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">`w3cschool_count` <span class="type">int</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tcount_tbl` (w3cschool_author, w3cschool_count) </span><br><span class="line">  <span class="keyword">VALUES</span> (<span class="string">&#x27;mahran&#x27;</span>, <span class="number">20</span>),(<span class="string">&#x27;mahnaz&#x27;</span>, <span class="number">10</span>),(<span class="string">&#x27;Jen&#x27;</span>, <span class="number">60</span>),(<span class="string">&#x27;Gill&#x27;</span>, <span class="number">45</span>),(<span class="string">&#x27;John Poul&#x27;</span>, <span class="number">5</span>),(<span class="string">&#x27;Sanjay&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> tables;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> name ,<span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee_tbl <span class="keyword">GROUP</span> <span class="keyword">BY</span> name;</span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">SUM</span>(singin) <span class="keyword">as</span> singin_count <span class="keyword">from</span> employee_tbl <span class="keyword">GROUP</span> <span class="keyword">BY</span> name <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">coalesce</span>(name, <span class="string">&#x27;总数&#x27;</span>), <span class="built_in">SUM</span>(singin) <span class="keyword">as</span> singin_count <span class="keyword">from</span> employee_tbl <span class="keyword">GROUP</span> <span class="keyword">BY</span> name <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> a.w3cschool_id, a.w3cschool_author, b.w3cschool_count <span class="keyword">FROM</span> w3cschool_tbl a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tcount_tbl b <span class="keyword">ON</span> a.w3cschool_author <span class="operator">=</span> b.w3cschool_author;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> SQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cookie、Session、Token 与 JWT 解析</title>
      <link href="/posts/379ad06d.html"/>
      <url>/posts/379ad06d.html</url>
      
        <content type="html"><![CDATA[<h1>Cookie、Session、Token 与 JWT 解析</h1><h2 id="认证、授权与凭证">认证、授权与凭证</h2><h3 id="什么是认证（Authentication）？"><strong>什么是认证（Authentication）？</strong></h3><ul><li>通俗地讲就是<strong>验证当前用户的身份是否合法的过程</strong>，即你是谁？证明“你是你自己”（比如：你每天上下班打卡，都需要通过指纹打卡，当你的指纹和系统里录入的指纹相匹配时，就打卡成功）</li><li>互联网中的认证：**用户名密码登录；邮箱发送登录链接；手机号接收验证码。**只要你能收到邮箱/验证码，就默认你是账号的主人！认证主要是为了保护系统的隐私数据与资源。</li><li>拓展：什么是会话？认证通过后，为了避免用户每次操作都进行认证（除银行转账等），可以将用户信息保存在会话中，<strong>会话就是系统为了保存当前用户的登录状态所提供的机制</strong>，常见的有基于 Session 和 token 的方式，具体见下文。</li></ul><h3 id="什么是授权（Authorization）？"><strong>什么是授权（Authorization）？</strong></h3><ul><li>简单来讲就是<strong>谁（who）对什么（what）进行了什么操作（how）</strong>。认证是保证用户的合法性，授权则是为了更细粒度的对隐私数据的划分。<strong>*授权是在认证通过后，控制不同的用户访问不同的资源。</strong></li><li><strong>用户授予第三方应用访问该用户某些资源的权限</strong>。比如，你在安装手机应用的时候，APP 会询问是否允许授予权限（访问相册、地理位置等权限）；你在访问微信小程序时，当登录时，小程序会询问是否允许授予权限（获取昵称、头像、地区、性别等个人信息）</li><li>**实现授权的方式有：**业界通常基于 R(role/resource)BAC 实现授权：(1)基于角色的访问控制（2）基于资源（权限）的访问控制，系统设计时定义好某项操作的权限标识，系统扩展性好。</li></ul><h3 id="什么是凭证（Credentials）"><strong>什么是凭证（Credentials）</strong></h3><ul><li><strong>实现认证和授权的前提</strong>是需要一种<strong>媒介（证书）</strong> 来标记访问者的身份。</li><li>例如：在战国时期，商鞅变法，发明了照身帖。照身帖由官府发放，是一块打磨光滑细密的竹板，上面刻有持有人的头像和籍贯信息。国人必须持有，如若没有就被认为是黑户，或者间谍之类的。在现实生活中，每个人都会有一张专属的居民身份证，是用于证明持有人身份的一种法定证件。通过身份证，我们可以办理手机卡/银行卡/个人贷款/交通出行等等，这就是<strong>认证的凭证。</strong></li><li>在互联网应用中，一般网站会有两种模式，游客模式和登录模式。游客模式下，可以正常浏览网站上面的文章，一旦想要点赞/收藏/分享文章，就需要登录或者注册账号。当用户登录成功后，服务器会给该用户使用的浏览器颁发一个<strong>令牌（token）</strong>，这个令牌用来表明你的身份，每次浏览器发送请求时会带上这个令牌，就可以使用游客模式下无法使用的功能。</li></ul><h2 id="Cookie-与-Session"><strong>Cookie 与 Session</strong></h2><h3 id="什么是-Cookie？">什么是 Cookie？</h3><ul><li><strong>HTTP 是无状态的协议（对于事务处理没有记忆能力，每次客户端和服务端会话完成时，服务端不会保存任何会话信息</strong>）：每个请求都是完全独立的，服务端无法确认当前访问者的身份信息，无法分辨上一次的请求发送者和这一次的发送者是不是同一个人。所以服务器与浏览器为了进行<strong>会话跟踪</strong>（知道是谁在访问我），就必须主动的去维护一个状态，这个状态用于告知服务端前后两个请求是否来自同一浏览器。而<strong>这个状态需要通过 cookie 或者 session 去实现。</strong></li><li><strong>cookie 存储在客户端：</strong> cookie 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。</li><li><strong>cookie 是不可跨域的：</strong> 每个 cookie 都会绑定单一的域名，无法在别的域名下获取使用，<strong>一级域名和二级域名之间是允许共享使用的</strong>（<strong>靠的是 domain）</strong>。</li></ul><p><strong>cookie 重要的属性</strong></p><h3 id="什么是-Session"><strong>什么是 Session</strong></h3><ul><li><strong>session 是另一种记录服务器和客户端会话状态的机制</strong>，即告诉服务端前后两个请求是否来自同一个客户端（浏览器），知道谁在访问我。<strong>因为 http 本身是无状态协议</strong>，这样，无法确定你的本次请求和上次请求是不是你发送的。如果要进行类似论坛登陆相关的操作，就实现不了了。</li><li><strong>session 是基于 cookie 实现的，session 存储在服务器端，sessionId 会被存储到客户端的 cookie 中</strong>。ps：还有一种是浏览器禁用了 cookie 或不支持 cookie，这种可以通过 URL 重写的方式发到服务器；</li></ul><p><strong>session 认证流程（如上图）：</strong></p><ul><li>用户第一次请求服务器的时候，服务器根据用户提交的相关信息，<strong>创建对应的 Session</strong></li><li>请求返回时将此 Session 的<strong>唯一标识信息 SessionID</strong> 返回给浏览器</li><li>浏览器接收到服务器返回的 SessionID 信息后，会<strong>将此信息存入到 Cookie 中，同时 Cookie 记录此 SessionID 属于哪个域名</strong></li><li><strong>当用户第二次访问服务器的时候，请求会自动判断此域名下是否存在 Cookie 信息</strong>，如果存在自动将 Cookie 信息也发送给服务端，服务端会从 Cookie 中获取 SessionID，再根据 SessionID 查找对应的 Session 信息，如果没有找到说明用户没有登录或者登录失效，如果找到 Session 证明用户已经登录可执行后面操作。</li></ul><p>根据以上流程可知，<strong>SessionID 是连接 Cookie 和 Session 的一道桥梁</strong>，大部分系统也是根据此原理来<strong>验证用户登录状态。</strong></p><p>基于 Session 的认证机制由 Servlet 规范定制，Servlet 容器已经实现，用户通过 HttpSession 的操作方法可以实现：</p><h3 id="Cookie-和-Session-的区别"><strong>Cookie 和 Session 的区别</strong></h3><ul><li>**安全性：**Session 是存储在服务器端的，Cookie 是存储在客户端的。所以 Session 相比 Cookie 安全，</li><li><strong>存取值的类型不同</strong>：Cookie 只支持存字符串数据，想要设置其他类型的数据，需要将其转换成字符串，Session 可以存任意数据类型。</li><li><strong>有效期不同：</strong> Cookie 可设置为长时间保持，比如我们经常使用的默认登录功能，Session 一般失效时间较短，客户端关闭（默认情况下）或者 Session 超时都会失效。</li><li><strong>存储大小不同：</strong> 单个 Cookie 保存的数据不能超过 4K，Session 可存储数据远高于 Cookie，但是当访问量过多，会占用过多的服务器资源。</li></ul><h3 id="拓展：Session-痛点">拓展：Session 痛点</h3><p>看起来通过 cookie + session 的方式是解决了问题， 但是我们忽略了一个问题，上述情况能正常工作是因为我们假设 server 是单机工作的，但实际在生产上，为了保障高可用，一般服务器至少需要两台机器，通过负载均衡的方式来决定到底请求该打到哪台机器上。</p><p>假设登录请求打到了 A 机器，A 机器生成了 session 并在 cookie 里添加 sessionId 返回给了浏览器，那么问题来了：下次添加购物车时如果请求打到了 B 或者 C，由于 session 是在 A 机器生成的，此时的 B,C 是找不到 session 的，那么就会发生无法添加购物车的错误，就得重新登录了，此时请问该怎么办。主要有以下三种方式：</p><p>（1 ）session 复制</p><p>A 生成 session 后复制到 B, C，这样每台机器都有一份 session，无论添加购物车的请求打到哪台机器，由于 session 都能找到，故不会有问题</p><p>这种方式虽然可行，但缺点也很明显：</p><ul><li>同一样的一份 session 保存了多份，数据冗余</li><li>如果节点少还好，但如果节点多的话，特别是像阿里，微信这种由于 DAU 上亿，可能需要部署成千上万台机器，这样节点增多复制造成的性能消耗也会很大。</li></ul><p>（2）session 粘连</p><p>这种方式是让每个客户端请求只打到固定的一台机器上，比如浏览器登录请求打到 A 机器后，后续所有的添加购物车请求也都打到 A 机器上，Nginx 的 sticky 模块可以支持这种方式，支持按 ip 或 cookie 粘连等等，如按 ip 粘连方式如下</p><p>这样的话每个 client 请求到达 Nginx 后，只要它的 ip 不变，根据 ip hash 算出来的值会打到固定的机器上，也就不存在 session 找不到的问题了，当然不难看出这种方式缺点也是很明显，对应的机器挂了怎么办？</p><p>（3）session 共享</p><p>这种方式也是目前各大公司普遍采用的方案，将 session 保存在 redis，memcached 等中间件中，请求到来时，各个机器去这些中间件取一下 session 即可。</p><p>缺点其实也不难发现，就是每个请求都要去 redis 取一下 session，多了一次内部连接，消耗了一点性能，另外为了保证 redis 的高可用，必须做集群，当然了对于大公司来说, redis 集群基本都会部署，所以这方案可以说是大公司的首选了。</p><h2 id="Token（令牌）与-JWT（跨域认证）"><strong>Token（令牌）与</strong> JWT（跨域认证）</h2><h3 id="Token-概述（no-session-）">Token 概述（no session!）</h3><p>通过上文分析我们知道通过在服务端共享 session 的方式可以完成用户的身份定位，但是不难发现也有一个小小的瑕疵：搞个校验机制我还得搭个 redis 集群？大厂确实 redis 用得比较普遍，但对于小厂来说可能它的业务量还未达到用 redis 的程度，所以有没有其他不用 server 存储 session 的用户身份校验机制呢，使用 token！</p><p>简单来说：首先请求方输入自己的用户名，密码，然后 server 据此生成 token，客户端拿到 token 后会保存到本地（token 存储在浏览器端），之后向 server 请求时在请求头带上此 token 即可（server 有校验机制，检验 token 合法性，同时 server 通过 token 中携带的 uid 确定是谁在访问它）。</p><p><img src="images/token.webp" alt="token.webp"><br>可以看到 token 主要由三部分组成：</p><ul><li>header：指定了签名算法</li><li>payload：可以指定用户 id，过期时间等非敏感数据</li><li>Signature: 签名，server 根据 header 知道它该用哪种签名算法，再用密钥根据此签名算法对 head + payload 生成签名，这样一个 token 就生成了。</li></ul><p>当 server 收到浏览器传过来的 token 时，它会首先取出 token 中的 header + payload，根据密钥生成签名，然后再与 token 中的签名比对，如果成功则说明签名是合法的，即 token 是合法的。而且你会发现 payload 中存有我们的 userId，所以拿到 token 后直接在 payload 中就可获取 userid，避免了<strong>像 session 那样要从 redis 去取的开销</strong>。</p><p>你会发现这种方式确实很妙，只要 server 保证密钥不泄露，那么生成的 token 就是安全的，因为如果伪造 token 的话在签名验证环节是无法通过的，就此即可判定 token 非法。</p><p>可以看到通过这种方式有效地避免了 token 必须保存在 server 的弊端，实现了分布式存储，不过需要注意的是，token 一旦由 server 生成，它就是有效的，直到过期，无法让 token 失效，除非在 server 为 token 设立一个黑名单，在校验 token 前先过一遍此黑名单，如果在黑名单里则此 token 失效，但一旦这样做的话，那就意味着黑名单就必须保存在 server，这又回到了 session 的模式，那直接用 session 不香吗。所以一般的做法是当客户端登出要让 token 失效时，直接在本地移除 token 即可，下次登录重新生成 token 就好。</p><p>另外需要注意的是 <strong>token 一般是放在 header 的 Authorization 自定义头里，不是放在 Cookie 里的，这主要是为了解决跨域不能共享 Cookie 的问题</strong></p><p><strong>总结：token 解决什么问题（为什么要用 token）？</strong></p><ul><li><strong>完全由应用管理，可以避开同源策略</strong></li><li><strong>支持跨域访问，cookie 不支持</strong>， Cookie 跨站是不能共享的，这样的话如果你要实现多应用（多系统）的单点登录（SSO），使用 Cookie 来做需要的话就很困难了。但如果用 token 来实现 SSO 会非常简单，只要在 header 中的 authorize 字段（或其他自定义）加上 token 即可完成所有跨域站点的认证。</li><li><strong>token 是无状态的，可以在多个服务器间共享</strong></li><li><strong>token 可以避免 CSRF 攻击（跨站请求攻击）</strong></li><li>易于扩展，在移动端原生请求是没有 cookie 之说的，而 sessionid 依赖于 cookie，sessionid 就不能用 cookie 来传了，如果用 token 的话，由于它是随着 header 的 authoriize 传过来的，也就不存在此问题，换句话说 token 天生支持移动平台，可扩展性好</li></ul><blockquote><p><strong>拓展 1：那啥是 CSRF 呢？</strong></p></blockquote><p>攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。<strong>由于浏览器曾经认证过（cookie 里带来 sessionId 等身份认证的信息），所以被访问的网站会认为是真正的用户操作而去运行。</strong></p><p>那么如果正常的用户误点了上面这张图片，由于相同域名的请求会自动带上 cookie，而 cookie 里带有正常登录用户的 sessionid，类似上面这样的转账操作在 server 就会成功，会造成极大的安全风险</p><p><strong>CSRF 攻击的根本原因在于对于同样域名的每个请求来说，它的 cookie 都会被自动带上，这个是浏览器的机制决定的！</strong></p><p>至于完成一次 CSRF 攻击必要的两个步骤：</p><p>1、首先登了一个正常的网站 A，并且在本地生成了 cookie<br>2、在 cookie 有效时间内，访问了危险网站 B（就获取了身份信息）</p><p>Q：那我不访问危险网站就完了呗？<br><strong>A：危险网站也许只是个存在漏洞的可信任网站！</strong></p><p>Q：那我访问完正常网站，关了浏览器就好了呀？<br><strong>A：即使关闭浏览器，cookie 也不保证一定立即失效，而且关闭浏览器并不能结束会话，session 的生命周期跟这些都没关系。</strong></p><blockquote><p><strong>拓展 2：同源策略？</strong></p></blockquote><ul><li>就是不同源的客户端脚本在没有明确授权情况下，不准读写对方的资源！</li><li><strong>同源就是：协议、域名与端口号都相同。</strong></li><li>同源策略是由 Netscape 提出的著名安全策略，是浏览器最核心、基本的安全功能，它限制了一个源中加载脚本与来自其他源中资源的交互方式。</li></ul><blockquote><p><strong>拓展 3：什么是跨域，如何解决？</strong></p></blockquote><ul><li><p>当浏览器执行脚本时会<strong>检查是否同源</strong>，只有同源的脚本才会执行，如果不同源即为跨域。</p></li><li><p><strong>产生原因</strong>：它是由<strong>浏览器的同源策略</strong>造成的，是浏览器对 JavaScript 实施的安全限制。</p></li><li><p><strong>解决方案</strong>：</p><ul><li><strong>nginx（静态服务器）反向代理解决跨域</strong>（前端常用），<strong>a 明确访问 c 代理服务器</strong>，但是不知道 c 的内容从哪里来，c 反向从别的地方拿来数据。(忽略的是目标地址)，<strong>浏览器可以访问 a,而服务器之间不存在跨域问题</strong>，浏览器先访问 a 的服务器 c，让 c 服务器作为代理去访问 b 服务器,拿到之后再返回数据给 a。</li><li>jsonp：通常为了减轻 web 服务器的负载，我们把 js、css、图片等静态资源分离到另一台独立域名的服务器上，在 html 页面中再通过相应的标签从不同域名下加载静态资源，而被浏览器允许。</li><li>添加响应头</li></ul></li></ul><blockquote><p>拓展 4：易于扩展？</p></blockquote><ul><li>比如有多台服务器，使用<strong>负载均衡</strong>，第一次登录转发到了 A，A 中 seesion 缓存了用户的登录信息，第二次登录转发到了 B，这时候就丢失了登录状态，当然这样也是有解决方案可以共享 session，但<strong>token 只需要所有的服务器使用相同的解密手段即可。</strong></li></ul><blockquote><p>拓展 5：无状态？</p></blockquote><ul><li>服务端不保存客户端请求者的任何信息，<strong>客户端每次请求必须自备描述信息，通过这些信息来识别客户端身份。服务端只需要确认该 token 是否是自己亲自签发即可，签发和验证都在服务端进行。</strong></li></ul><blockquote><p><strong>拓展 6：什么是单点登录？</strong></p></blockquote><ul><li>所谓单点登录，是指在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。</li></ul><h4 id="Acesss-Token">Acesss Token</h4><ul><li><strong>访问资源接口（API）时所需要的资源凭证</strong></li><li><strong>简单 token 的组成：</strong> uid(用户唯一的身份标识)、time(当前时间的时间戳)、sign（签名，token 的前几位以哈希算法压缩成的一定长度的十六进制字符串）</li></ul><p><strong>特点：</strong></p><ul><li><strong>服务端无状态化、可扩展性好</strong></li><li><strong>支持移动端设备</strong></li><li>安全性高</li><li>支持跨程序调用</li></ul><p><strong>token 的身份验证流程：</strong></p><ol><li>客户端使用用户名跟密码请求登录</li><li>服务端收到请求，去验证用户名与密码</li><li><strong>验证成功后，服务端会签发一个 token 并把这个 token 发送给客户端</strong></li><li>客户端收到 token 以后，会把它存储起来，比如放在 cookie 里或者 localStorage 里</li><li>客户端每次向服务端请求资源的时候需要带着服务端签发的 token</li><li>服务端收到请求，然后去验证客户端请求里面带着的 token ，<strong>如果验证成功，就向客户端返回请求的数据</strong></li></ol><p><strong>注意点</strong>：</p><ul><li><strong>每一次请求都需要携带 token，需要把 token 放到 HTTP 的 Header 里</strong></li><li><strong>基于 token 的用户认证是一种服务端无状态的认证方式，服务端不用存放 token 数据。用解析 token 的计算时间换取 session 的存储空间，从而减轻服务器的压力，减少频繁的查询数据库</strong></li><li><strong>token 完全由应用管理，所以它可以避开同源策略</strong></li></ul><h4 id="Refresh-Token"><strong>Refresh Token</strong></h4><ul><li>另外一种 token——refresh token</li><li>refresh token 是专用于刷新 access token 的 token。如果没有 refresh token，也可以刷新 access token，但每次刷新都要用户输入登录用户名与密码，会很麻烦。有了 refresh token，可以减少这个麻烦，客户端直接用 refresh token 去更新 access token，无需用户进行额外的操作。</li></ul><p><strong>两者区别</strong>：</p><ul><li>Access Token 的有效期比较短，当 Acesss Token 由于过期而失效时，使用 Refresh Token 就可以获取到新的 Token，如果 Refresh Token 也失效了，用户就只能重新登录了。</li><li>Refresh Token 及过期时间是存储在服务器的数据库中，只有在申请新的 Acesss Token 时才会验证，不会对业务接口响应时间造成影响，也不需要向 Session 一样一直保持在内存中以应对大量的请求。</li></ul><h3 id="Token-的缺点"><strong>Token 的缺点</strong></h3><p>那有人就问了，既然 token 这么好，那为什么各个大公司几乎都采用共享 session 的方式呢，可能很多人是第一次听到 token，token 不香吗? token 有以下两点劣势：</p><ul><li>token 太长了：<strong>token 是 header, payload 编码后的样式，所以一般要比 sessionId 长很多</strong>，很有可能超出 cookie 的大小限制（cookie 一般有大小限制的，如 4kb），如果你在 token 中存储的信息越长，那么 token 本身也会越长，这样的话由于你每次请求都会带上 token，对请求来是个不小的负担</li><li>不太安全：网上很多文章说 token 更安全，其实不然，细心的你可能发现了，我们说 token 是存在浏览器的，再细问，存在浏览器的哪里？既然它太长放在 cookie 里可能导致 cookie 超限，那就只好放在 local storage 里，这样会造成安全隐患，<strong>因为 local storage 这类的本地存储是可以被 JS 直接读取的，另外由上文也提到，token 一旦生成无法让其失效，必须等到其过期才行，这样的话如果服务端检测到了一个安全威胁，也无法使相关的 token 失效。</strong></li></ul><p><strong>所以 token 更适合一次性的命令认证，设置一个比较短的有效期！！！</strong></p><p>拓展：不管是 cookie 还是 token，<strong>从存储角度来看其实都不安全（实际上防护 CSRF 攻击的正确方式是用 CSRF token），都有暴露的风险，我们所说的安全更多的是强调传输中的安全，可以用 HTTPS 协议来传输， 这样的话请求头都能被加密，也就保证了传输中的安全。</strong></p><p>其实我们把 cookie 和 token 比较本身就不合理，一个是存储方式，一个是验证方式，正确的比较应该是 session vs token。</p><h3 id="Token-和-Session-的区别"><strong>Token 和 Session 的区别</strong></h3><p><strong>token 和 session 其实都是为了身份验证，session 一般翻译为会话，而 token 更多的时候是翻译为令牌；session 和 token 都是有过期时间一说，都需要去管理过期时间；</strong></p><ul><li>Session 是一种<strong>记录服务器和客户端会话状态的机制，使服务端有状态化，可以记录会话信息</strong>（可能保存在缓存、文件或数据库）。而 Token 是<strong>令牌</strong>，<strong>访问资源接口（API）时所需要的资源凭证</strong>。Token <strong>使服务端无状态化，不会存储会话信息。</strong></li><li>**其实 token 与 session 的问题是一种时间与空间的博弈问题，session 是空间换时间，而 token 是时间换空间。两者的选择要看具体情况而定。**虽然确实都是“客户端记录，每次访问携带”，但 token 很容易设计为自包含的，也就是说，后端不需要记录什么东西，每次一个无状态请求，每次解密验证，每次当场得出合法 /非法的结论。这一切判断依据，除了固化在 CS 两端的一些逻辑之外，整个信息是自包含的。这才是真正的无状态。 而 sessionid ，一般都是一段随机字符串，需要到后端去检索 id 的有效性。万一服务器重启导致内存里的 session 没了呢？万一 redis 服务器挂了呢？</li><li>所谓 Session 认证只是简单的把 User 信息存储到 Session 里，因为 SessionID 的不可预测性，暂且认为是安全的。而 Token ，如果指的是 OAuth Token 或类似的机制的话，提供的是 认证 和 授权 ，认证是针对用户，授权是针对 App 。<strong>其目的是让某 App 有权利访问某用户的信息</strong>。这里的 Token 是唯一的。不可以转移到其它 App 上，也不可以转到其它用户上。Session 只提供一种简单的认证，即只要有此 SessionID ，即认为有此 User 的全部权利。是需要严格保密的，这个数据应该只保存在站方，不应该共享给其它网站或者第三方 App。所以简单来说：<strong>如果你的用户数据可能需要和第三方共享，或者允许第三方调用 API 接口，用 Token 。如果永远只是自己的网站，自己的 App，用什么就无所谓了。</strong></li></ul><h3 id="JWT-概述"><strong>JWT 概述</strong></h3><ul><li>JSON Web Token（简称 JWT）是目前最流行的<strong>跨域认证</strong>解决方案。是一种<strong>认证授权机制</strong>。</li><li>JWT 是为了在网络应用环境间<strong>传递声明</strong>而执行的一种基于 JSON 的开放标准（RFC 7519）。JWT 的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源。比如用在用户登录上。</li><li>可以使用 HMAC 算法或者是 RSA 的公/私秘钥对 JWT 进行签名。因为数字签名的存在，这些传递的信息是可信的。</li><li><strong>阮一峰老师的 JSON Web Token 入门教程 讲的非常通俗易懂，这里就不再班门弄斧了</strong></li></ul><h4 id="生成-JWT"><strong>生成 JWT</strong></h4><ul><li><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fjwt.io%2F">https://jwt.io/</a></li><li><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.jsonwebtoken.io%2F">https://www.jsonwebtoken.io/</a></li></ul><h4 id="JWT-的原理"><strong>JWT 的原理</strong></h4><p><strong>JWT 认证流程：</strong></p><ul><li><p>用户输入用户名/密码登录，<strong>服务端认证成功后，会返回给客户端一个 JWT</strong></p></li><li><p>客户端将 token 保存到本地（通常使用 localstorage，也可以使用 cookie）</p></li><li><p>当用户希望访问一个受保护的路由或者资源的时候，需要请求头的 Authorization 字段中使用 Bearer 模式添加 JWT，其内容看起来是下面这样</p><p>Authorization: Bearer <token></p></li><li><p>服务端的保护路由将会检查请求头 Authorization 中的 JWT 信息，如果合法，则允许用户的行为</p></li><li><p>因为 JWT 是自包含的（内部包含了一些会话信息），因此减少了需要查询数据库的需要</p></li><li><p>因为 JWT 并不使用 Cookie 的，所以你可以使用任何域名提供你的 API 服务而不需要担心跨域资源共享问题（CORS）</p></li><li><p>因为用户的状态不再存储在服务端的内存中，所以这是一种<strong>无状态的认证机制</strong></p></li></ul><h4 id="JWT-的使用方式"><strong>JWT 的使用方式</strong></h4><h4 id="方式一"><strong>方式一</strong></h4><ul><li><p><strong>当用户希望访问一个受保护的路由或者资源的时候</strong>，可以把它放在 Cookie 里面自动发送，但是这样不能跨域，所以<strong>更好的做法是放在 HTTP 请求头信息的 Authorization 字段里，使用 Bearer 模式添加 JWT。</strong></p><p>GET /calendar/v1/events</p></li><li><p>用户的状态不会存储在服务端的内存中，这是一种 <strong>无状态的认证机制</strong></p></li><li><p>服务端的保护路由将会检查请求头 Authorization 中的 JWT 信息，如果合法，则允许用户的行为。</p></li><li><p>由于 JWT 是自包含的，因此减少了需要查询数据库的需要</p></li><li><p>JWT 的这些特性使得我们可以完全依赖其无状态的特性提供数据 API 服务，甚至是创建一个下载流服务。</p></li><li><p>因为 JWT 并不使用 Cookie ，所以你可以使用任何域名提供你的 API 服务而<strong>不需要担心跨域资源共享问题</strong>（CORS）</p></li></ul><h4 id="方式二"><strong>方式二</strong></h4><ul><li>跨域的时候，可以把 JWT 放在 POST 请求的数据体里。</li></ul><h4 id="方式三"><strong>方式三</strong></h4><ul><li><p>通过 URL 传输</p><p><a href="http://www.example.com/user?token=xxx">http://www.example.com/user?token=xxx</a></p></li></ul><h4 id="项目中使用-JWT"><strong>项目中使用 JWT</strong></h4><p>项目地址：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fyjdjiayou%2Fjwt-demo">https://github.com/yjdjiayou/jwt-demo</a></p><h4 id="Token-和-JWT-的区别"><strong>Token 和 JWT 的区别</strong></h4><p><strong>相同：</strong></p><ul><li>都是<strong>访问资源的令牌</strong></li><li>都可以<strong>记录用户的信息</strong></li><li>都是<strong>使服务端无状态化</strong></li><li>都是<strong>只有验证成功</strong>后，<strong>客户端才能访问服务端上受保护的资源</strong></li></ul><p><strong>区别：</strong></p><ul><li>Token：服务端验证客户端发送过来的 Token 时，<strong>还需要查询数据库获取用户信息</strong>，然后验证 Token 是否有效。</li><li>JWT：将 Token 和 Payload 加密后存储于客户端，服务端只需要使用密钥解密进行校验（校验也是 JWT 自己实现的）即可，<strong>不需要查询或者减少查询数据库，因为 JWT 自包含了用户信息和加密的数据。</strong></li></ul><h2 id="常见的前后端鉴权方式"><strong>常见的前后端鉴权方式</strong></h2><ol><li>Session-Cookie</li><li>Token 验证（包括 JWT，SSO）</li><li>OAuth2.0（开放授权）</li></ol><h2 id="常见的加密算法"><strong>常见的加密算法</strong></h2><h3 id="不可逆加密：【Hash-加密算法-散列算法-摘要算法】">不可逆加密：【Hash 加密算法/散列算法/摘要算法】</h3><ul><li>一旦加密就不能反向解密得到密码原文，一般用来加密用户密码,app 的服务器端数据库里一般存储的也都是加密后的用户密码。</li><li>在数据传输的过程中，首先把密码类数据经过 MD5 加密算法加密，然后再在外面使用可逆的加密方式加密一次，这样在数据传输的过程中，即便数据被截获了，但是想要完全破解，还是很难的。</li><li>Hash 算法特别的地方在于它是一种单向算法，用户可以通过 Hash 算法对目标信息生成一段特定长度的唯一的 Hash 值，却不能通过这个 Hash 值重新获得目标信息。因此 Hash 算法常用在不可还原的密码存储、信息完整性校验等。</li><li>用途：一般用于效验下载文件正确性，一般在网站上下载文件都能见到；存储用户敏感信息，如密码、 卡号等不可解密的信息。</li><li>常见的不可逆加密算法有：MD5、SHA、HMAC</li></ul><blockquote><p>MD5：Message Digest Algorithm MD5（中文名为消息摘要算法第五版）为计算机安全领域广泛使用的一种散列函数，用以提供消息的完整性保护。该算法的文件号为 RFC 1321（R.Rivest,MIT Laboratory for Computer Science and RSA Data Security Inc. April 1992）。 MD5 即 Message-Digest Algorithm 5（信息-摘要算法 5），用于确保信息传输完整一致。是计算机广泛使用的杂凑算法之一（又译摘要算法、哈希算法），主流编程语言普遍已有 MD5 实现。将数据（如汉字）运算为另一固定长度值，是杂凑算法的基础原理，MD5 的前身有 MD2、MD3 和 MD4。</p><p>MD5 算法具有以下特点： 1、压缩性：任意长度的数据，算出的 MD5 值长度都是固定的。 2、容易计算：从原数据计算出 MD5 值很容易。 3、抗修改性：对原数据进行任何改动，哪怕只修改 1 个字节，所得到的 MD5 值都有很大区别。 4、强抗碰撞：已知原数据和其 MD5 值，想找到一个具有相同 MD5 值的数据（即伪造数据）是非常困难的。 MD5 的作用是让大容量信息在用数字签名软件签署私人密钥前被&quot;压缩&quot;成一种保密的格式（就是把一个任意长度的字节串变换成一定长的十六进制数字串）。除了 MD5 以外，其中比较有名的还有 sha-1、RIPEMD 以及 Haval 等。</p></blockquote><blockquote><p>SHA1 ：安全哈希算法（Secure Hash Algorithm）主要适用于数字签名标准 （Digital Signature Standard DSS）里面定义的数字签名算法（Digital Signature Algorithm DSA）。对于长度小于 2^64 位的消息，SHA1 会产生一个 160 位的消息摘要。当接收到消息的时候，这个消息摘要可以用来验证数据的完整性。在传输的过程中，数据很可能会发生变化，那么这时候就会产生不同的消息摘要。 SHA1 有如下特点： 1.不可以从消息摘要中复原信息； 2.两个不同的消息不会产生同样的消息摘要,(但会有 1x10 ^ 48 分之一的机率出现相同的消息摘要,一般使用时忽略)。</p></blockquote><h3 id="可逆加密：可逆加密有对称加密和非对称加密。">可逆加密：可逆加密有对称加密和非对称加密。</h3><h4 id="对称加密：【文件加密和解密使用相同的密钥，即加密密钥也可以用作解密密钥】">对称加密：【文件加密和解密使用相同的密钥，即加密密钥也可以用作解密密钥】</h4><ul><li>在对称加密算法中，数据发信方将明文和加密密钥一起经过特殊的加密算法处理后，使其变成复杂的加密密文发送出去，收信方收到密文后，若想解读出原文，则需要使用加密时用的密钥以及相同加密算法的逆算法对密文进行解密，才能使其回复成可读明文。在对称加密算法中，使用的密钥只有一个，收发双方都使用这个密钥，这就需要解密方事先知道加密密钥。</li><li>对称加密算法的优点是算法公开、计算量小、加密速度快、加密效率高。</li><li>用途：<strong>一般用于保存用户手机号、身份证等敏感但能解密的信息。</strong></li><li>常见的对称加密算法有 AES（高级加密标准）、<strong>DES（数据加密算法）</strong>、3DES、Blowfish、IDEA、RC4、RC5、RC6</li></ul><h4 id="非对称加密：【两个密钥：公开密钥（publickey）和私有密钥，公有密钥加密，私有密钥解密】">非对称加密：【两个密钥：公开密钥（publickey）和私有密钥，公有密钥加密，私有密钥解密】</h4><ul><li>非对称加密算法是一种密钥的保密方法。非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。</li><li>非对称加密算法实现机密信息交换的基本过程是：甲方生成一对密钥并将其中的一把作为公用密钥向其它方公开；得到该公用密钥的乙方使用该密钥对机密信息进行加密后再发送给甲方；甲方再用自己保存的另一把专用密钥对加密后的信息进行解密。</li><li>服务器存私钥，客户端拿公钥，客户端加解密算法可以做成 so 库。</li><li>非对称加密与对称加密相比，其安全性更好；非对称加密的缺点是加密和解密花费时间长、速度慢，只适合对少量数据进行加密。</li><li>用途：<strong>一般用于签名和认证。</strong></li><li>常见的非对称加密算法有：RSA（公钥加密算法）、DSA（数字签名用）、ECC（移动设备用）、Diffie-Hellman、El Gamal</li></ul><h2 id="常见问题"><strong>常见问题</strong></h2><h3 id="使用-cookie-时需要考虑的问题"><strong>使用 cookie 时需要考虑的问题</strong></h3><ul><li>因为存储在客户端，容易被客户端篡改，<strong>使用前需要验证合法性</strong>，所以，<strong>不要存储敏感数据</strong>，比如用户密码，账户余额；使用 <strong>httpOnly</strong> 在一定程度上提高安全性</li><li><strong>尽量减少 cookie 的体积</strong>，能存储的数据量不能超过 4kb；一个浏览器针对一个网站最多存 20 个 Cookie，浏览器一般只允许存放 300 个 Cookie</li><li>设置正确的 domain 和 path，减少数据传输</li><li><strong>cookie 无法跨域</strong>（每个 cookie 都会绑定单一的域名，无法在别的域名下获取使用）</li><li><strong>移动端对 cookie 的支持不是很好，而 session 需要基于 cookie 实现，所以移动端常用的是 token</strong></li></ul><h3 id="使用-session-时需要考虑的问题"><strong>使用 session 时需要考虑的问题</strong></h3><ul><li>将 session 存储在服务器里面，<strong>当用户同时在线量比较多时</strong>，这些 session 会占据较多的内存，需要<strong>在服务端定期的去清理过期的 session</strong></li><li>当网站采用<strong>集群部署</strong>的时候，会遇到<strong>多台 web 服务器之间如何做 session 共享的问题</strong>。因为 session 是由单个服务器创建的，但是处理用户请求的服务器不一定是那个创建 session 的服务器，那么该服务器就无法拿到之前已经放入到 session 中的登录凭证之类的信息了。<strong>解决方案</strong>：写客户端 cookie 的方式、服务器之间 session 数据同步、用 mysql 数据库共享 session 数据。</li><li>当多个应用要共享 session 时，除了以上问题，还会遇到跨域问题，因为不同的应用可能部署的主机不一样，需要在<strong>各个应用做好 cookie 跨域的处理</strong>。</li><li><strong>sessionId 是存储在 cookie 中的，假如浏览器禁止 cookie 或不支持 cookie 怎么办？</strong> 一般会把 sessionId 跟在 url 参数后面即重写 url，所以 session 不一定非得需要靠 cookie 实现</li><li><strong>移动端对 cookie 的支持不是很好，而 session 需要基于 cookie 实现，所以移动端常用的是 token</strong></li></ul><h3 id="使用-token-时需要考虑的问题"><strong>使用 token 时需要考虑的问题</strong></h3><ul><li>如果你认为用数据库来存储 token 会导致查询时间太长，可以选择放在内存当中。比如 redis 很适合你对 token 查询的需求。</li><li><strong>token 完全由应用管理，所以它可以避开同源策略</strong></li><li><strong>token 可以避免 CSRF 攻击(因为不需要 cookie 了)</strong></li><li><strong>移动端对 cookie 的支持不是很好，而 session 需要基于 cookie 实现，所以移动端常用的是 token</strong></li></ul><h3 id="使用-JWT-时需要考虑的问题"><strong>使用 JWT 时需要考虑的问题</strong></h3><ul><li>因为 <strong>JWT 并不依赖 Cookie</strong> 的，所以你可以使用任何域名提供你的 API 服务而不需要担心跨域资源共享问题（CORS）</li><li>JWT 默认是不加密，但也是可以加密的。生成原始 Token 以后，可以用密钥再加密一次。</li><li>JWT 不加密的情况下，不能将秘密数据写入 JWT。</li><li>JWT 不仅可以用于认证，也可以用于交换信息。有效使用 JWT，可以降低服务器查询数据库的次数。</li><li><strong>JWT 最大的优势是服务器不再需要存储 Session，使得服务器认证鉴权业务可以方便扩展</strong>。但这也是 JWT 最大的缺点：由于服务器不需要存储 Session 状态，因此**使用过程中无法废弃某个 Token 或者更改 Token 的权限。**也就是说一旦 JWT 签发了，到期之前就会始终有效，除非服务器部署额外的逻辑。</li><li><strong>JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限</strong>。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。</li><li><strong>JWT 适合一次性的命令认证，颁发一个有效期极短的 JWT</strong>，即使暴露了危险也很小，由于每次操作都会生成新的 JWT，因此也没必要保存 JWT，真正实现无状态。</li><li><strong>为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。</strong></li></ul><h3 id="使用加密算法时需要考虑的问题"><strong>使用加密算法时需要考虑的问题</strong></h3><ul><li>绝不要以<strong>明文存储</strong>密码</li><li><strong>永远使用 哈希算法 来处理密码，绝不要使用 Base64 或其他编码方式来存储密码，这和以明文存储密码是一样的，使用哈希，而不要使用编码</strong>。编码以及加密，都是双向的过程，而密码是保密的，应该只被它的所有者知道， 这个过程必须是单向的。哈希正是用于做这个的，从来没有解哈希这种说法， 但是编码就存在解码，加密就存在解密。</li><li>绝不要使用弱哈希或已被破解的哈希算法，像 MD5 或 SHA1 ，只使用强密码哈希算法。</li><li>绝不要以明文形式显示或发送密码，即使是对密码的所有者也应该这样。如果你需要 “忘记密码” 的功能，可以随机生成一个新的 <strong>一次性的</strong>（这点很重要）密码，然后把这个密码发送给用户。</li></ul><h3 id="分布式架构下-session-共享方案"><strong>分布式架构下 session 共享方案</strong></h3><h4 id="1-session-复制"><strong>1. session 复制</strong></h4><ul><li>任何一个服务器上的 session 发生改变（增删改），该节点会把这个 session 的所有内容序列化，然后广播给所有其它节点，不管其他服务器需不需要 session ，以此来保证 session 同步</li></ul><p><strong>优点：</strong> 可容错，各个服务器间 session 能够实时响应。</p><p><strong>缺点：</strong> 会对网络负荷造成一定压力，如果 session 量大的话可能会造成网络堵塞，拖慢服务器性能。</p><h4 id="2-粘性-session-IP-绑定策略"><strong>2. 粘性 session /IP 绑定策略</strong></h4><ul><li><strong>采用 Ngnix 中的 ip_hash 机制，将某个 ip 的所有请求都定向到同一台服务器上，即将用户与服务器绑定。</strong> 用户第一次请求时，负载均衡器将用户的请求转发到了 A 服务器上，如果负载均衡器设置了粘性 session 的话，那么用户以后的每次请求都会转发到 A 服务器上，相当于把用户和 A 服务器粘到了一块，这就是粘性 session 机制。</li></ul><p><strong>优点：</strong> 简单，不需要对 session 做任何处理。</p><p><strong>缺点：</strong> 缺乏容错性，如果当前访问的服务器发生故障，用户被转移到第二个服务器上时，他的 session 信息都将失效。</p><p><strong>适用场景：</strong> 发生故障对客户产生的影响较小；服务器发生故障是低概率事件 。</p><p><strong>实现方式：</strong> 以 Nginx 为例，在 upstream 模块配置 ip_hash 属性即可实现粘性 session。</p><h4 id="3-session-共享（常用）"><strong>3. session 共享（常用）</strong></h4><ul><li><p>使用分布式缓存方案比如 Memcached 、Redis 来缓存 session，<strong>但是要求 Memcached 或 Redis 必须是集群</strong></p></li><li><p>把 session 放到 Redis 中存储，虽然架构上变得复杂，并且需要多访问一次 Redis ，但是这种方案带来的好处也是很大的：</p><ul><li>实现了 session 共享；</li><li>可以水平扩展（增加 Redis 服务器）；</li><li>服务器重启 session 不丢失（不过也要注意 session 在 Redis 中的刷新/失效机制）；</li><li>不仅可以跨服务器 session 共享，甚至可以跨平台（例如网页端和 APP 端）</li></ul></li></ul><h4 id="4-session-持久化"><strong>4. session 持久化</strong></h4><ul><li>将 session 存储到数据库中，保证 session 的持久化</li></ul><p><strong>优点：</strong> 服务器出现问题，session 不会丢失</p><p><strong>缺点：</strong> 如果网站的访问量很大，把 session 存储到数据库中，会对数据库造成很大压力，还需要增加额外的开销维护数据库。</p><h3 id="只要关闭浏览器-，session-真的就消失了？"><strong>只要关闭浏览器 ，session 真的就消失了？</strong></h3><p>不对。<strong>对 session 来说，除非程序通知服务器删除一个 session，否则服务器会一直保留</strong>，程序一般都是在用户做 log off 的时候发个指令去删除 session。</p><p>然而浏览器从来不会主动在关闭之前通知服务器它将要关闭，因此服务器根本不会有机会知道浏览器已经关闭，之所以会有这种错觉，是<strong>大部分 session 机制都使用会话 cookie 来保存 session id，而关闭浏览器后这个 session id 就消失了，再次连接服务器时也就无法找到原来的 session</strong>。</p><p>如果服务器设置的 cookie 被保存在硬盘上，或者使用某种手段改写浏览器发出的 HTTP 请求头，把原来的 session id 发送给服务器，则再次打开浏览器仍然能够打开原来的 session。</p><p>恰恰是<strong>由于关闭浏览器不会导致 session 被删除，迫使服务器为 session 设置了一个失效时间，当距离客户端上一次使用 session 的时间超过这个失效时间时，服务器就认为客户端已经停止了活动，才会把 session 删除以节省存储空间。</strong></p><h2 id="项目地址"><strong>项目地址</strong></h2><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fyjdjiayou%2Fjwt-demo">https://github.com/yjdjiayou/jwt-demo</a></p><h2 id="巨人的肩膀：">巨人的肩膀：</h2><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fjuejin.im%2Fpost%2F6844904034181070861">https://juejin.im/post/6844904034181070861</a><br><a href="https://www.jianshu.com/p/b2e23939ad46">https://www.jianshu.com/p/b2e23939ad46</a><br><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.51cto.com%2Fjamesfancy%2F2065665">https://blog.51cto.com/jamesfancy/2065665</a><br><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fkaixuansui%2Farticle%2Fdetails%2F94433920">https://blog.csdn.net/kaixuansui/article/details/94433920</a><br><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fyuki-nana%2Fp%2F14001600.html">https://www.cnblogs.com/yuki-nana/p/14001600.html</a><br><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fxiaozhang2014%2Fp%2F7750200.html">https://www.cnblogs.com/xiaozhang2014/p/7750200.html</a><br><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fj-6ngGKRJvB3gfY4VJaU4A">https://mp.weixin.qq.com/s/j-6ngGKRJvB3gfY4VJaU4A</a></p>]]></content>
      
      
      <categories>
          
          <category> Web认证 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cookie、Session、Token 与 JWT 解析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cookie</title>
      <link href="/posts/8d4cbf50.html"/>
      <url>/posts/8d4cbf50.html</url>
      
        <content type="html"><![CDATA[<h3 id="Cookie">Cookie</h3><p><strong>Cookie是什么？</strong></p><ul><li>网站为了辨别用户身份，进行Session跟踪而储存在用户本地终端上的数据（通常经过加密），由客户端暂时或永久保存的信息。</li></ul><p><strong>Cookie工作原理</strong></p><ul><li>服务器颁发给客户端的唯一通行证，用来识别客户端身份</li></ul><p><strong>Cookie特点</strong></p><ul><li>Cookie存储的数据量有限，浏览器中的Cookie存储的数据一般不超过4KB(超出的话，最早创建的会被删除)</li><li>浏览器可以禁用Cookie</li></ul><p><strong>Cookie 种类</strong></p><ul><li>会话Cookie: 存储在浏览器内存中，浏览器在关闭之后该 Cookie 失效(默认: Max-Age: -1)</li><li>持久Cookie: 存储在客户端的本地磁盘上,用于长久保持用户登录状态(Max-Age &gt; 0)</li><li>Cookie对象有一个Max-Age属性，Max-Age属性的值就是Cookie的生存周期，在这个周期内Cookie有效，超出周期Cookie就会被清除</li></ul><p><strong>应用场景</strong></p><ul><li>对安全要求不高</li><li>不需要存储大量数据</li><li>主要应用场景<ul><li>会话状态管理<ul><li>用户登录状态<ul><li>服务器在Cookie中存储用户信息、并设置过期时间</li></ul></li><li>购物车</li><li>游戏分数或其它需要记录的信息</li></ul></li><li>个性化设置（如用户自定义设置、主题等）</li><li>浏览器行为跟踪（如跟踪分析用户行为等）<br><img src="images/session/set-cookie.png" alt="set-cookie.png"></li></ul></li></ul><p><strong>Cookie什么时候被创建及怎么手动创建</strong></p><ul><li>默认创建<ol><li>当用户访问的是JSP这类技术编写的页面时，服务器自动为该浏览器创建一个会话Cookie</li><li>当用户请求一个servlet并且该servlet中调用了request.getSession()方法时，服务器自动为该浏览器创建一个会话Cookie(格式:JSESSIONID: sessionId)</li></ol></li></ul><h3 id="Session详解实现持久化用户登录状态">Session详解实现持久化用户登录状态</h3><p><strong>什么是会话</strong></p><ul><li>从服务器创建Session到Session 过期的过程</li></ul><p><strong>什么是Session？</strong></p><ul><li>服务器发送给客户端一个令牌，该令牌上有唯一标识的ID，每次请求服务器时，浏览器出示该令牌，服务器通过令牌上的ID来找到对应的用户</li><li>Sessino保持在服务器端，因此可以存储大量数据</li></ul><p><strong>Session什么时候被创建？</strong></p><ul><li>当用户访问的是JSP这类技术编写的页面时，服务器自动为该浏览器创建唯一一个session</li><li>如果请求的是servlet,且该servlet中调用了request.getSession()方法时，服务器自动为该浏览器创建唯一一个session</li><li>如果服务器没有为发送请求的浏览器创建Session时，request.getSession()会自动创建一个Seession并返回;如果有的话，该方法会找到这个Session并返回</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取客户端的session,如果不存在，自动创建一个</span></span><br><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line"> <span class="comment">//设置session的最大存活时间为1000s</span></span><br><span class="line">session.setMaxInactiveInterval(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">//销毁session</span></span><br><span class="line"><span class="comment">//session.invalidate();</span></span><br></pre></td></tr></table></figure><p><strong>设置Cookie?</strong></p><ul><li>通过set-cookie 在该次响应头中设置session ID ，并返回该响应头给客户端</li></ul><p><strong>Session与Cookie结合使用</strong></p><ul><li>当浏览器向服务器端发送了一个携有Cookie请求时，浏览器会把此 Cookies 放到请求头一起提交给服务器，服务器通过此Cookies 的value属性值来找到对应的Session， 然后再通过该 Session 来获得存在该对象中的信息</li></ul><p><strong>Cookie 和 Session 有什么不同？</strong></p><ol><li>作用范围不同，Cookie 保存在客户端（浏览器），Session 保存在服务器端。</li><li>存取方式的不同，Cookie 只能保存 ASCII，Session 可以存任意数据类型，一般情况下我们可以在 Session 中保持一些常用变量信息，比如说 UserId 等。</li><li>有效期不同，Cookie 可设置为长时间保持，比如我们经常使用的默认登录功能，Session 一般失效时间较短，客户端关闭或者 Session 超时都会失效。</li></ol>]]></content>
      
      
      <categories>
          
          <category> Web认证 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cookie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Token</title>
      <link href="/posts/9ef68e3f.html"/>
      <url>/posts/9ef68e3f.html</url>
      
        <content type="html"><![CDATA[<p>Token的定义：</p><ol><li>Token是服务端生成的一个字符串</li><li>用作客户端请求数据验证，避免数据库的频道查询，生成后存储在session中</li></ol><p>使用Token的目的：<br>验证用户登陆情况、减轻服务器查询压力(从redis 中 查询session 压力)</p><p>JWT:<br>一个Token字符串,由三部分组成，头部、载荷与签名<br>红色的为头部Header<br>紫色的为载荷playload<br>蓝色的为签名Signature</p><p>Header: 签名的算法类型HS256+JWT<br>Payload: 包含过期时间、签发时间、用户ID等信息<br>Signature：对上边两字符串进行二次加密（防止token被篡改）</p>]]></content>
      
      
      <categories>
          
          <category> Web认证 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Token </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第三方Cookie</title>
      <link href="/posts/304cbca6.html"/>
      <url>/posts/304cbca6.html</url>
      
        <content type="html"><![CDATA[<h3 id="第三方Cookie">第三方Cookie</h3><p><strong>Cookie 作用</strong></p><ol><li>记录网页上用户状态、浏览活动</li><li>便于进行用户画像设定</li><li>网站一定期限内免登录</li></ol><p><strong>场景</strong></p><ul><li>用户访问 <a href="http://www.baidu.com">www.baidu.com</a>, 返回页面中内嵌 第三方广告信息，比如瓜子二手车(目标站点访问了第三方域名提供的功能)</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一方cookie： 由百度服务器创建</span><br><span class="line">第三方cookie： 由瓜子二手车服务器创建</span><br><span class="line"></span><br><span class="line">第三方cookie记录了当前用户的浏览记录及喜好，当你访问第三方域名时，对用户进行个性化广告推荐</span><br></pre></td></tr></table></figure><p>禁用后第一方cookie存储的用户数据 价值更大<br>寻找新的广告推荐替代cookie</p><p>依赖第三方cookie小公司面临倒闭，各大搜索引擎厂商形成垄断</p><p>新的广告推荐方案：</p><ol><li>将相同喜好的用户归组，进行集体推荐</li></ol><p>移动端：<br>手机APP索要的各种权限、隐私条款都被用来进行用户画像设定</p><p>如果禁了第三方cookie，那么广告推送技术就只剩下了一种：第一方推送用户数据给广告商，广告商再分析数据推送广告。<br>好处：<br>责任明确，用户需要允许推送的隐私内容<br>第一方只能推送用户允许推送的隐私内容<br>第三方无法擅自获得用户隐私</p>]]></content>
      
      
      <categories>
          
          <category> Web认证 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 第三方Cookie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ISO、GMT、UTC区别</title>
      <link href="/posts/7e38c7f4.html"/>
      <url>/posts/7e38c7f4.html</url>
      
        <content type="html"><![CDATA[<p><strong>ISO、GMT、UTC区别</strong></p><ul><li>ISO 国际标准化组织的日期和时间的表示方法</li></ul><blockquote><p>字母T：日期和时间的分隔符<br>字母Z：表示UTC时间（可简单理解为是0时区）；也可用4位数字格式的时间偏移量代替；不写的时候表示不偏移(当前时区)</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#例子：</span></span><br><span class="line"><span class="attribute">2019</span>-<span class="number">09</span>-<span class="number">26</span>T03:<span class="number">45</span>:<span class="number">36</span>.<span class="number">656</span>Z      // <span class="number">0</span>时区的<span class="number">2019</span>年<span class="number">9</span>月<span class="number">26</span>日<span class="number">3</span>点<span class="number">45</span>分<span class="number">36</span>秒<span class="number">656</span>毫秒</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">09</span>-<span class="number">26</span>T03:<span class="number">45</span>:<span class="number">36</span>.<span class="number">656</span>-<span class="number">0800</span>  // 西八区的<span class="number">2019</span>年<span class="number">9</span>月<span class="number">26</span>日<span class="number">3</span>点<span class="number">45</span>分<span class="number">36</span>秒<span class="number">656</span>毫秒</span><br><span class="line"><span class="attribute">2019</span>-<span class="number">09</span>-<span class="number">26</span>T03:<span class="number">45</span>:<span class="number">36</span>.<span class="number">656</span>+<span class="number">0800</span>  // 东八区的<span class="number">2019</span>年<span class="number">9</span>月<span class="number">26</span>日<span class="number">3</span>点<span class="number">45</span>分<span class="number">36</span>秒<span class="number">656</span>毫秒</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#以下是ISO格式的各种情况转换为 GMT+0800（东8区时间）：</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">new</span> Date(&#x27;<span class="number">2019</span>-<span class="number">09</span>-<span class="number">25</span>T18:<span class="number">00</span>:<span class="number">14</span>&#x27;);      // 不写z</span><br><span class="line"></span><br><span class="line"><span class="attribute">Wed</span> Sep <span class="number">25</span> <span class="number">2019</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">14</span> GMT+<span class="number">0800</span> (中国标准时间)</span><br><span class="line"></span><br><span class="line"><span class="attribute">new</span> Date(&#x27;<span class="number">2019</span>-<span class="number">09</span>-<span class="number">25</span>T18:<span class="number">00</span>:<span class="number">14</span>z&#x27;);    // 结尾是z</span><br><span class="line"></span><br><span class="line"><span class="attribute">Thu</span> Sep <span class="number">26</span> <span class="number">2019</span> <span class="number">02</span>:<span class="number">00</span>:<span class="number">14</span> GMT+<span class="number">0800</span> (中国标准时间)</span><br><span class="line"></span><br><span class="line"><span class="attribute">new</span> Date(&#x27;<span class="number">2019</span>-<span class="number">09</span>-<span class="number">25</span>T18:<span class="number">00</span>:<span class="number">14</span>+<span class="number">0000</span>&#x27;);  // <span class="number">0</span>时区</span><br><span class="line"></span><br><span class="line"><span class="attribute">Thu</span> Sep <span class="number">26</span> <span class="number">2019</span> <span class="number">02</span>:<span class="number">00</span>:<span class="number">14</span> GMT+<span class="number">0800</span> (中国标准时间)</span><br><span class="line"></span><br><span class="line"><span class="attribute">new</span> Date(&#x27;<span class="number">2019</span>-<span class="number">09</span>-<span class="number">25</span>T18:<span class="number">00</span>:<span class="number">14</span>+<span class="number">0800</span>&#x27;);  // 东<span class="number">8</span>区</span><br><span class="line"></span><br><span class="line"><span class="attribute">Wed</span> Sep <span class="number">25</span> <span class="number">2019</span> <span class="number">18</span>:<span class="number">00</span>:<span class="number">14</span> GMT+<span class="number">0800</span> (中国标准时间)</span><br><span class="line"></span><br><span class="line"><span class="attribute">new</span> Date(&#x27;<span class="number">2019</span>-<span class="number">09</span>-<span class="number">25</span>T18:<span class="number">00</span>:<span class="number">14</span>-<span class="number">0800</span>&#x27;);  // 西<span class="number">8</span>区</span><br><span class="line"></span><br><span class="line"><span class="attribute">Thu</span> Sep <span class="number">26</span> <span class="number">2019</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">14</span> GMT+<span class="number">0800</span> (中国标准时间)</span><br></pre></td></tr></table></figure><ul><li><p>GMT 格林威治时间（0时区时间）</p></li><li><p>UTC 世界标准时（根据GMT时间计算得来，比GMT更加精确，误差在0.9秒以内）</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 临时记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 临时记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>临时记录</title>
      <link href="/posts/b916a8dc.html"/>
      <url>/posts/b916a8dc.html</url>
      
        <content type="html"><![CDATA[<h3 id="Hadoop-集群运行jar-包">Hadoop 集群运行jar 包</h3><p><a href="https://blog.csdn.net/weixin_49429575/article/details/109599272">https://blog.csdn.net/weixin_49429575/article/details/109599272</a></p><h3 id="大数据平台是否更应该容器化">大数据平台是否更应该容器化</h3><p><a href="https://blog.csdn.net/rlnlo2pnefx9c/article/details/107171331">https://blog.csdn.net/rlnlo2pnefx9c/article/details/107171331</a></p><p>电诈访问地址：<br><a href="https://www.gaoxin-fraud.9sdata.cn/management.html">https://www.gaoxin-fraud.9sdata.cn/management.html</a></p><p>渭南项目访问地址：<br><a href="https://www.service-bj.9sdata.cn/">https://www.service-bj.9sdata.cn/</a></p><p>3d earth:<br><a href="https://2050.earth/?ref=sheui.com">https://2050.earth/?ref=sheui.com</a><br><a href="https://zhuanlan.zhihu.com/p/35120118">https://zhuanlan.zhihu.com/p/35120118</a><br><a href="https://wow.techbrood.com/fiddle/38828">https://wow.techbrood.com/fiddle/38828</a></p><p>一些低代码产品和平台<br><a href="http://boot.jeecg.com/user/login">http://boot.jeecg.com/user/login</a><br><a href="http://demo.ruoyi.vip/index">http://demo.ruoyi.vip/index</a><br><a href="https://www.mingdao.com/app/my">https://www.mingdao.com/app/my</a><br><a href="https://www.jiandaoyun.com/dashboard#/">https://www.jiandaoyun.com/dashboard#/</a></p><h2 id="UI设计网站">UI设计网站</h2><ol><li><a href="https://js.design/">https://js.design/</a></li><li><a href="https://codesign.qq.com/app/design">https://codesign.qq.com/app/design</a></li><li>figma</li><li>蓝湖</li></ol><p>export JAVA_HOME=/usr/java/jdk1.7.0_67<br>export JAVA_BIN=/usr/java/jdk1.7.0_67/bin<br>export PATH=$PATH:$JAVA_HOME/bin<br>export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar<br>export JAVA_HOMEJAVA_BINPATHCLASSPATH</p><p>#set hadoop path<br>export HADOOP_HOME=/home/hadoop/software/hadoop<br>export PATH=$PATH:$HADOOP_HOME/bin</p><p>#set scala path<br>export SCALA_HOME=/home/hadoop/software/scala-2.11.4<br>export PATH=$PATH:$SCALA_HOME/bin</p><p>#set spark path<br>export SPARK_HOME=/home/hadoop/software/spark-1.6.1-bin-hadoop2.6<br>export PATH=$PATH:$SPARK_HOME/bin</p><p>export  YARN_CONF_DIR=/home/hadoop/platform-config<br>export HADOOP_CONF_DIR=/home/hadoop/platform-config</p><h2 id="dom-流畅滚动">dom 流畅滚动</h2><p>element.scrollIntoView({block:‘start’,behavior:‘smooth’})<br>element.scrollTo(0, 0)</p><h2 id="修正-单页应用在-ie-下不兼容问题">修正 单页应用在 ie 下不兼容问题</h2><p>config.entry.app = [‘babel-polyfill’, ‘eventsource-polyfill’, ‘./src/main.js’];</p><p>@yanhaijing/console_js// console 在 低版本 ie 下 为 undefined<br>autoprefixer      // postcss 自动填充 前缀<br>es6-promise<br>ie-placeholder  // 处理 IE 下 input placeholder 问题<br>element-dataset// 修正 HTMLElement.dataset 属性</p><ul><li><p>可视化</p><ul><li>3d 地球</li><li>BI 可视化</li><li>知识图谱</li><li>在线 excel 编辑器</li></ul><p>quest 1: 如何实现 class 只能被 new 不能被 直接调用</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">a</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">filed1</span> = a;</span><br><span class="line">  &#125;</span><br><span class="line">  filed2 = <span class="number">2</span>;</span><br><span class="line">  func1 = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">babel 编译后</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_classCallCheck</span>(<span class="params">instance, Constructor</span>) &#123;</span><br><span class="line">　<span class="comment">// instanceof 检测构造函数的 prototype 属性是否出现在某个实例对象的原型链上。</span></span><br><span class="line">  <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> <span class="title class_">Constructor</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Cannot call a class as a function&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> _Parent = <span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, _Parent);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filed2</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">func1</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filed1</span> = a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 new 操作符 创建实例</span></span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;instance&#x27;</span>, instance);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接调用</span></span><br><span class="line"><span class="title class_">Parent</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 临时记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 临时记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>模板打印</title>
      <link href="/posts/c3b61f7a.html"/>
      <url>/posts/c3b61f7a.html</url>
      
        <content type="html"><![CDATA[<h3 id="word2html">word2html</h3><ol><li><a href="https://www.easeconvert.com/word-to-html/">https://www.easeconvert.com/word-to-html/</a></li><li><a href="https://cn.office-converter.com/Word-to-HTML-Converter">https://cn.office-converter.com/Word-to-HTML-Converter</a></li><li><a href="http://docpe.com/">http://docpe.com/</a></li><li><a href="http://docpe.com/word/word-to-html.aspx">http://docpe.com/word/word-to-html.aspx</a></li></ol><p>长轮询<br><a href="https://blog.csdn.net/ddwddw4/article/details/95060303">https://blog.csdn.net/ddwddw4/article/details/95060303</a></p><h3 id="前端word模版导出">前端word模版导出</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 安装 docxtemplater</span></span><br><span class="line">cnpm install docxtemplater pizzip  <span class="comment">--save</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 安装 jszip-utils</span></span><br><span class="line">cnpm install jszip-utils <span class="comment">--save </span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 安装 jszip</span></span><br><span class="line">cnpm install jszip <span class="comment">--save</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 安装 FileSaver</span></span><br><span class="line">cnpm install <span class="built_in">file</span>-saver <span class="comment">--save</span></span><br></pre></td></tr></table></figure><h3 id="单位换算">单位换算</h3><p>pt (point，磅) 是一个物理长度单位，指的是72分之一英寸。<br>px (pixel，像素)是一个虚拟长度单位，是计算机系统的数字化图像长度单位，如果px要换算成物理长度，需要指定精度DPI(Dots Per Inch，每英寸像素数)，在扫描打印时一般都有DPI可选。Windows系统默认是96dpi，Apple系统默认是72dpi。<br>em是一个相对长度单位，最初是指字母M的宽度，故名em。现指的是字符宽度的倍数，用法类似百分比，如：0.8em, 1.2em,2em等。通常1em=16px<br>字号是中文字库中特有的一种单位，以中文代号表示特定的磅值pt（一号 = 26pt ）</p><p>推导：pt=1/72(英寸) &amp;&amp; px=1/dpi(英寸) =&gt; pt=px*72/dpi</p><p>部分css 属性说明<br>widows 属性设置或返回一个元素必须在页面顶部的可见行的最小数量<br>orphans:5 意味着至少有 5 行必须在分页符上面可见<br>table<br>colspan合并列数<br>rowspan合并行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;file:///Users/jahaw/Downloads/051012190095.html&#x27;</span>, <span class="string">&#x27;html_print&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="前端预览服务">前端预览服务</h3><ul><li><a href="https://github.com/wuxue107/bookjs-eazy">https://github.com/wuxue107/bookjs-eazy</a></li><li><a href="https://mozilla.github.io/pdf.js/web/viewer.html">https://mozilla.github.io/pdf.js/web/viewer.html</a> [推荐]</li><li>react-pdf</li></ul>]]></content>
      
      
      <categories>
          
          <category> 临时记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 模板打印 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>建站</title>
      <link href="/posts/8a1e348e.html"/>
      <url>/posts/8a1e348e.html</url>
      
        <content type="html"><![CDATA[<p><strong>开源建站系统</strong></p><ul><li>dedecms</li><li>wordpress</li><li>ecshop</li><li>帝国cms</li><li>z-blog</li></ul><p><strong>Sass建站</strong></p><blockquote><p>将应用软件统一部署在自己服务器上，卖家可以根据自己的需求来订购不同的服务及服务时常</p></blockquote><ul><li>Shopify</li><li>Shoplazza 店匠（深圳建站平台）</li><li>Shopyy</li><li>SHOPLINE</li><li>Shoptago</li><li>UEESHOP</li><li>FunPinPin<br><img src="./Sass%E5%BB%BA%E7%AB%99.png" alt="Sass建站"></li></ul><p><strong>开源建站</strong></p><blockquote><p>开放源代码的建站工具，卖家可以根据自己需求进行二次开发</p></blockquote><ul><li>Magento</li><li>Woo Commerce</li><li>Opencart</li></ul><p><strong>自主建站</strong></p><blockquote><p>不依赖外部任何建站工具，靠自有或外包技术团队自行开发网站</p></blockquote><p><strong>优缺点比较</strong></p><ul><li><p>Sass建站</p><ul><li>优点：适合那些想做独立站、但人员和技术都比较有限的团队、得花钱【跨境电商】</li><li>缺点：缺少本地化服务、平台规则更严、不能个性化设计和扩容</li></ul></li><li><p>开源建站&amp;自主建站</p><ul><li>优点：适合拥有专业技术的团队</li></ul></li></ul><p><strong>静态网站生成工具 SSGs</strong></p><ul><li>Jekyll</li><li>Octopress</li><li>Hogo</li><li>Hexo</li><li>Hugo</li><li>VuePress</li><li>Gatsby</li><li>Nuxt.js</li><li>Docusaurus</li><li>Eleventy</li><li>Publii</li><li>Primo</li><li>Pelican</li><li>Middleman</li><li>Metalsmith</li><li>DocPad</li><li>Wintersmith</li><li>Cactus</li><li>HubPress</li></ul><p><a href="https://linux.cn/article-12671-1.html">静态网站生成器1</a></p><p><a href="https://www.cnblogs.com/buyz/p/10935831.html">静态网站生成器2</a></p><p><strong>建站</strong></p><ul><li><p>云服务器</p></li><li><p>服务器管理软件</p><ul><li>宝塔</li></ul></li><li><p>网站程序源码</p><ul><li>博客： wordpress + Woocommerce</li><li>论坛：discuz</li><li>站长之家</li><li>外贸建站：webflow University</li><li>pageadmin</li></ul></li><li><p>域名</p></li><li></li></ul><p><strong>博客网站生成工具 SSGs</strong></p><ul><li>Jekyll</li><li>Hexo</li><li>Hugo</li><li>VuePress</li><li>docusaurus</li></ul><p><strong>开源系统</strong></p><ul><li>免费<ul><li><a href="https://www.php.cn/bootstrap/481236.html">https://www.php.cn/bootstrap/481236.html</a></li><li><a href="https://sc.chinaz.com/tag_moban/html5.html">https://sc.chinaz.com/tag_moban/html5.html</a></li><li><a href="http://www.mobanwang.com/mb/">http://www.mobanwang.com/mb/</a></li><li><a href="https://www.youzhan.org/">https://www.youzhan.org/</a></li><li>素材火</li></ul></li><li>付费<ul><li><a href="http://www.cssmoban.com/">http://www.cssmoban.com/</a></li><li><a href="https://demos.creative-tim.com/">https://demos.creative-tim.com/</a></li><li><a href="https://www.qifeiye.com/?wd=1005">https://www.qifeiye.com/?wd=1005</a></li><li><a href="https://keenthemes.com/metronic/">https://keenthemes.com/metronic/</a></li></ul></li></ul><p><strong>开源建站工具</strong></p><ul><li>博客： wordpress + Woocommerce</li><li>论坛：discuz</li><li>外贸建站：webflow University</li><li>pageadmin[收费]</li></ul><p><strong>设计网站</strong></p><ul><li><a href="https://codesign.qq.com">https://codesign.qq.com</a></li><li></li></ul>]]></content>
      
      
      <categories>
          
          <category> 临时记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 建站 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>上线流程</title>
      <link href="/posts/16b3e53b.html"/>
      <url>/posts/16b3e53b.html</url>
      
        <content type="html"><![CDATA[<h2 id="微信小程序上线流程">微信小程序上线流程</h2><blockquote><p>微信小程序账号注册开通、填写小程序信息、认证、开发小程序、小程序提交审核和发布全过程</p></blockquote><p><a href="http://t.csdn.cn/PZqVB">http://t.csdn.cn/PZqVB</a></p><p>微信公众平台https://mp.weixin.qq.com/</p>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>project.config 配置详情</title>
      <link href="/posts/21c1cfd1.html"/>
      <url>/posts/21c1cfd1.html</url>
      
        <content type="html"><![CDATA[<h1>微信开发者工具-project.config.json 配置详情</h1><h2 id="项目配置文件">项目配置文件</h2><ol><li>项目根目录中的 <code>project.config.json</code> 和 <code>project.private.config.json</code> 文件可以对项目进行配置，</li><li><code>project.private.config.json</code> 中的相同设置优先级高于 <code>project.config.json</code></li><li>可以在 <code>project.config.json</code> 文件中配置公共的配置，在 <code>project.private.config.json</code> 配置个人的配置，可以将 <code>project.private.config.json</code> 写到 <code>.gitignore</code> 避免版本管理的冲突。</li><li><code>project.private.config.json</code> 中有的字段，开发者工具内的设置修改会优先覆盖 <code>project.private.config.json</code> 的内容。如在 <code>project.private.config.json</code> 有 <code>appid</code> 字段，那么在 详情-基本信息 中修改了 appid，会写到 <code>project.private.config.json</code> 中，不会覆盖掉 <code>project.config.json</code> 的 <code>appid</code> 字段的内容</li><li>开发阶段相关的设置修改优先同步到 <code>project.private.config.json</code> 中，与最终编译产物有关的设置无法在 <code>project.private.config.json</code> 中生效</li></ol><h2 id="一级字段">一级字段</h2><p>字段名</p><p>类型</p><p>说明</p><p>miniprogramRoot</p><p>Path String</p><p>指定小程序源码的目录(需为相对路径)</p><p>qcloudRoot</p><p>Path String</p><p>指定腾讯云项目的目录(需为相对路径)</p><p>pluginRoot</p><p>Path String</p><p>指定插件项目的目录(需为相对路径)</p><p>cloudbaseRoot</p><p>Path String</p><p>云开发代码根目录(需为相对路径)</p><p>cloudfunctionRoot</p><p>Path String</p><p>云函数代码根目录(需为相对路径)</p><p>cloudfunctionTemplateRoot</p><p>Path String</p><p>云函数本地调试请求模板的根目录(需为相对路径)</p><p>cloudcontainerRoot</p><p>Path String</p><p>云托管代码根目录(需为相对路径)</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#compileType" title="compileType">compileType</a></p><p>String</p><p>编译类型</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#setting" title="setting">setting</a></p><p>Object</p><p>项目设置</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#libVersion" title="libVersion">libVersion</a></p><p>String</p><p>基础库版本</p><p>appid</p><p>String</p><p>项目的 appid，<strong>只在新建项目时读取</strong></p><p>projectname</p><p>String</p><p>项目名字，<strong>只在新建项目时读取</strong></p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#packOptions" title="packOptions">packOptions</a></p><p>Object</p><p>打包配置选项</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#debugOptions" title="debugOptions">debugOptions</a></p><p>Object</p><p>调试配置选项</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#watchOptions" title="watchOptions">watchOptions</a></p><p>Object</p><p>文件监听配置设置</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#scripts" title="scripts">scripts</a></p><p>Object</p><p>自定义预处理</p><p><a href="https://developers.weixin.qq.com/minigame/dev/devtools/projectconfig#staticServerOptions" title="staticServerOptions">staticServerOptions</a></p><p>Object</p><p>仅在小游戏项目中有效</p><h2 id="compileType">compileType</h2><p>编译类型作用于开发工具的以下设置</p><p><img src="https://img-blog.csdnimg.cn/d70a07a3ce944720b45c4e9a52a01e4a.png" alt=""></p><p>名字</p><p>说明</p><p>miniprogram</p><p>当前为普通小程序项目</p><p>plugin</p><p>当前为小程序插件项目</p><h2 id="setting">setting</h2><p>项目的编译设置，可以指定以下设置。部分设置无法在 <code>project.private.config.json</code> 中生效</p><p>以下字段可以开发者工具-详情-本地设置可以对应上</p><p>字段名</p><p>类型</p><p>允许私有设置[1]</p><p>说明</p><p>es6</p><p>Boolean</p><p>否</p><p>是否启用 es6 转 es5[2]</p><p>enhance</p><p>Boolean</p><p>否</p><p>是否打开增强编译[2]</p><p>postcss</p><p>Boolean</p><p>否</p><p>上传代码时样式是否自动补全</p><p>minified</p><p>Boolean</p><p>否</p><p>上传代码时是否自动压缩脚本文件</p><p>minifyWXSS</p><p>Boolean</p><p>否</p><p>上传代码时是否自动压缩样式文件</p><p>minifyWXML</p><p>Boolean</p><p>否</p><p>上传代码时是否自动压缩 WXML 文件</p><p>uglifyFileName</p><p>Boolean</p><p>否</p><p>上传时进行代码保护</p><p>ignoreUploadUnusedFiles</p><p>Boolean</p><p>否</p><p>上传时是否过滤无依赖文件</p><p>autoAudits</p><p>Boolean</p><p>是</p><p>是否自动运行体验评分</p><p>urlCheck</p><p>Boolean</p><p>是</p><p>是否检查安全域名和 TLS 版本</p><p>compileHotReLoad</p><p>Boolean</p><p>是</p><p>是否开启文件保存后自动热重载</p><p>preloadBackgroundData</p><p>Boolean</p><p>是</p><p>小程序加载时是否数据预拉取</p><p>lazyloadPlaceholderEnable</p><p>Boolean</p><p>是</p><p>是否启用懒注入占位组件调试[3]</p><p>useStaticServer</p><p>Boolean</p><p>是</p><p>仅在小游戏项目有效，是否开启静态资源服务器[4]</p><p>以下字段是开发者工具的隐式设置</p><p>字段名</p><p>类型</p><p>允许私有设置[1]</p><p>说明</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#babelSetting" title="babelSetting">babelSetting</a></p><p>Object</p><p>否</p><p>增强编译下 Babel 的配置项</p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#useCompilerPlugins" title="useCompilerPlugins">useCompilerPlugins</a></p><p>String[] 或 false</p><p>否</p><p>编译插件配置</p><p>disableUseStrict</p><p>Boolean</p><p>否</p><p>将 JS 编译成 ES5 时，是否禁用严格模式</p><p>uploadWithSourceMap</p><p>Boolean</p><p>否</p><p>上传时是否带上 sourcemap（默认为 true）</p><p>localPlugins</p><p>Boolean</p><p>否</p><p>在小游戏插件项目中，是否启用 “以本地目录为插件资源来源”[5] 特性</p><p>packNpmManually</p><p>Boolean</p><p>否</p><p>是否手动配置构建 npm 的路径</p><p>packNpmRelationList</p><p>Array</p><p>否</p><p>仅 <code>packNpmManually</code> 为 true 时生效，详细参考<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html" title="构建 npm 文档">构建 npm 文档</a></p><p>coverView</p><p>Boolean</p><p>是</p><p>是否使用工具渲染 CoverView</p><p>ignoreDevUnusedFiles</p><p>Boolean</p><p>是</p><p>预览、真机调试和本地模拟器等开发阶段是否过滤无依赖文件（默认为 true）</p><p>checkInvalidKey</p><p>Boolean</p><p>是</p><p>是否展示 JSON 文件校验错误信息</p><p>showShadowRootInWxmlPanel</p><p>Boolean</p><p>是</p><p>是否开启调试器 WXML 面板展示 shadow-root</p><p>useIsolateContext</p><p>Boolean</p><p>是</p><p>是否开启小程序独立域调试特性[6]</p><p>useMultiFrameRuntime</p><p>Boolean</p><p>是</p><p>是否开启模拟器预先载入小程序的某些资源[7]。此设定为 false 时会导致 <code>useIsolateContext</code> 失效</p><p>useApiHook</p><p>Boolean</p><p>是</p><p>是否启用 API Hook 功能[8]</p><p>useApiHostProcess</p><p>Boolean</p><p>是</p><p>是否在额外的进程处理一些小程序 API[9]</p><p>useLanDebug</p><p>Boolean</p><p>是</p><p>仅在小游戏有效，是否开启局域网调试服务器</p><p>enableEngineNative</p><p>Boolean</p><p>是</p><p>是否在游戏引擎项目中开启支持引用 node 原生模块的底层加速特性</p><p>showES6CompileOption</p><p>Boolean</p><p>是</p><p>是否在本地设置中展示传统的 ES6 转 ES5 开关（对应 es6），增强编译开关 （对应 enhance）</p><p><strong>注 1</strong>: 开发阶段相关的设置修改优先同步到 <code>project.private.config.json</code> 中，与最终编译产物有关的设置无法在 <code>project.private.config.json</code> 中生效</p><p><strong>注 2</strong>: <code>es6</code> 和 <code>enhance</code> 需同时为 true/false，对应于 <code>将 JS 编译成 ES5</code></p><p><strong>注 3</strong>: (<strong>懒注入占位组件调试</strong>) 开启<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/lazyload" title="按需注入">按需注入</a>后在项目设置面板中会出现对应的勾选项，开启之后，按需注入的组件将会停止注入，页面停止在占位组件状态，便于调试自定义占位组件。</p><p><strong>注 4</strong>: (<strong>静态资源服务器</strong>) 可以托管项目本地的静态资源，主要用于在预览时测试小游戏真机资源加载的效果。</p><p><strong>注 5</strong>: (<strong>以本地目录为插件资源来源</strong>) 启用此特性后，工具将停止从线上获取小游戏插件包内容，并将检验本地相应目录的文件完整性。仅对小游戏插件项目有效。要以本地磁盘目录作为插件的资源来源，需要同时在小游戏插件项目的 game.json 中配置相关的属性。</p><p><strong>注 6</strong>: (<strong>小程序独立域调试</strong>) 一种新的小程序内部代码的执行方式，仅影响工具侧的调试过程。未来将取代传统的执行方式并成为默认选择。仅在 2.11.1 及以上基础库有效。关闭此特性可能有助于规避一些调试中遇到的未知报错。</p><p><strong>注 7</strong>: (<strong>预先载入小程序的某些资源</strong>) 开启此内部特性后，调试时小程序的重新载入可能会更快一些。此设定不影响真机和实际运行效果。</p><p><strong>注 8</strong>: (<strong>API Hook 功能</strong>) 关闭此内部特性可能导致工具的某些调试功能（例如 mock）失效。此设定不影响真机运行效果。</p><p><strong>注 9</strong>: (<strong>额外进程</strong>) 开启此内部特性后，部分 API 的调用会被移到单独的进程以减轻工具主进程的负担。此设定不影响真机运行效果。</p><h2 id="useCompilerPlugins">useCompilerPlugins</h2><p>编译插件配置，目前支持编译插件有 typescript、less、sass</p><p>如</p><pre><code>&#123;  &quot;setting&quot;: &#123;    &quot;useCompilerPlugins&quot;: [      &quot;typescript&quot;,      &quot;less&quot;    ]  &#125;&#125;</code></pre><p>表示项目支持直接使用 typescript 和 less</p><h2 id="babelSetting">babelSetting</h2><p><code>将 JS 编译为 ES5</code> 时 Babel 的配置项，其中可以指定以下设置</p><p>字段名</p><p>类型</p><p>说明</p><p>outputPath</p><p>String</p><p>Babel 辅助函数的输出目录，默认为 <code>@babel/runtime</code></p><p>ignore</p><p>Array<code>&lt;String&gt;</code></p><p>配置需要跳过 Babel 编译(包括代码压缩)处理的文件或目录</p><p><strong>注 1</strong>: 指定文件路径外，还可以指定目录，详见下面项目配置示例</p><h2 id="libVersion">libVersion</h2><p>可以指定项目运行的基础库具体的版本号 也可以 <code>project.config.json</code> 的 <code>libVersion</code> 指定以下值</p><p>值</p><p>说明</p><p>latest</p><p>最新的非灰度中的基础库</p><p>trial</p><p>最新的基础库</p><p>widelyUsed</p><p>使用比例最高的基础库</p><p>以上值在 <code>project.private.config.json</code> 文件中无效，因为手动在开发者工具-详情-本地设置中改变基础库的版本，会覆盖掉 <code>project.private.config.json</code> 的 <code>libVersion</code> 字段</p><h2 id="scripts">scripts</h2><p>指定自定义预处理的命令</p><p>名字</p><p>说明</p><p>beforeCompile</p><p>编译前预处理命令</p><p>beforePreview</p><p>预览前预处理命令</p><p>beforeUpload</p><p>上传前预处理命令</p><h2 id="packOptions">packOptions</h2><p><code>packOptions</code> 用以配置项目在打包过程中的选项。打包是预览、上传时对项目进行的必须步骤。</p><p>目前可以指定 <code>packOptions.include</code> 字段，用以配置打包时需要强制带上的文件（<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html#%E5%85%81%E8%AE%B8%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6" title="仅限后缀名白名单内">仅限后缀名白名单内</a>）或者文件夹，匹配的这些文件或文件夹将一定会出现在预览或上传的结果内。（该字段的优先级高于 <code>packOptions.ignore</code>）</p><p>同时可以指定 <code>packOptions.ignore</code> 字段，用以配置打包时对符合指定规则的文件或文件夹进行忽略，以跳过打包的过程，这些文件或文件夹将不会出现在预览或上传的结果内。</p><p><code>packOptions.ignore</code> 和 <code>packOptions.include</code> 为一对象数组，对象元素类型如下：</p><p>字段名</p><p>类型</p><p>说明</p><p>value</p><p>string</p><p>路径 1 或取值</p><p>type</p><p>string</p><p>类型</p><p>其中，<code>type</code> 可以取的值为 <code>folder</code>、<code>file</code>、<code>suffix</code>、<code>prefix</code>、<code>regexp</code>2、<code>glob</code>2，分别对应文件夹、文件、后缀、前缀、正则表达式、Glob 规则。所有规则值都会自动忽略大小写。</p><p><strong>注 1</strong>: <code>value</code> 字段的值若表示文件或文件夹路径，以小程序目录 (<code>miniprogramRoot</code>) 为根目录。</p><p><strong>注 2</strong>: <code>regexp</code>、<code>glob</code> 仅 1.02.1809260 及以上版本工具支持。</p><p>示例配置如下。</p><pre><code>&#123;  &quot;packOptions&quot;: &#123;    &quot;ignore&quot;: [&#123;      &quot;type&quot;: &quot;file&quot;,      &quot;value&quot;: &quot;test/test.js&quot;    &#125;, &#123;      &quot;type&quot;: &quot;folder&quot;,      &quot;value&quot;: &quot;test&quot;    &#125;, &#123;      &quot;type&quot;: &quot;suffix&quot;,      &quot;value&quot;: &quot;.webp&quot;    &#125;, &#123;      &quot;type&quot;: &quot;prefix&quot;,      &quot;value&quot;: &quot;test-&quot;    &#125;, &#123;      &quot;type&quot;: &quot;glob&quot;,      &quot;value&quot;: &quot;test/**/*.js&quot;    &#125;, &#123;      &quot;type&quot;: &quot;regexp&quot;,      &quot;value&quot;: &quot;\\.jsx$&quot;    &#125;]  &#125;&#125;</code></pre><p><strong>注</strong>: 这部分设置的更改可能需要重新打开项目才能生效。</p><h2 id="debugOptions">debugOptions</h2><p><code>debugOptions</code> 用以配置在对项目代码进行调试时的选项。</p><p>目前可以指定 <code>debugOptions.hidedInDevtools</code> 字段，用以配置调试时于调试器 Sources 面板隐藏源代码的文件。</p><p><code>hidedInDevtools</code> 的配置规则和 <code>packOptions.ignore</code> 是一致的。</p><p>当某个 js 文件符合此规则时，调试器 Sources 面板中此文件源代码正文内容将被隐藏，显示为：</p><pre><code>// xxx.js has been hided by project.config.json</code></pre><blockquote><p>注：配置此规则后，可能需要关闭并重新打开项目才能看到效果。</p></blockquote><p><strong>项目配置示例：</strong></p><pre><code>&#123;  &quot;miniprogramRoot&quot;: &quot;./src&quot;,  &quot;qcloudRoot&quot;: &quot;./svr&quot;,  &quot;setting&quot;: &#123;    &quot;postcss&quot;: true,    &quot;es6&quot;: true,    &quot;minified&quot;: true,    &quot;urlCheck&quot;: false,    &quot;checkSiteMap&quot;: true,    &quot;enhance&quot;: true,    &quot;babelSetting&quot;: &#123;      &quot;ignore&quot;: [        &quot;utils/something_not_to_process.js&quot;,        &quot;miniprogram_npm/*&quot;,        &quot;utils/already_handle/*&quot;      ]    &#125;  &#125;,  &quot;packOptions&quot;: &#123;    &quot;ignore&quot;: []  &#125;,  &quot;debugOptions&quot;: &#123;&#125;&#125;</code></pre><h2 id="watchOptions">watchOptions</h2><p><code>watchOptions</code> 用以配置项目中可以被忽略展示和监听文件变化的文件匹配规则。 部分项目（如游戏项目）其项目文件可能成千上万，其中大部分可能是资源文件，并不是小程序和小游戏代码中关心展示的文件，这些文件在工具开发时可以不需要被开发者关注，因此工具可以增加一个配置去忽略指定的文件和目录，从而不对这些文件进行文件遍历获取和文件内容变更的监听（watch），从而提高开启工具的速度以及减少工具打开占用的内存。</p><p>目前可以指定 <code>watchOptions.ignore</code> 字段，用以配置工具时对符合指定规则的文件或文件夹进行忽略(<code>忽略的文件将不展示在编辑器文件列表和对该文件进行监听</code>），以避免展示和监听项目中不必要的文件内容（这些文件或文件夹不需要去关心文件变化）</p><p><code>watchOptions.ignore</code> 为 <code>glob pattern</code> 字符串数组,具体支持如下：</p><ul><li><ul><li>匹配 0 到多个字符</li></ul></li><li>? 匹配一个字符</li><li>[…] 匹配一个字符列表，类似正则表达式的字符列表</li><li>!(pattern|pattern|pattern) 反向匹配括号内的模式</li><li>?(pattern|pattern|pattern) 匹配 0 或 1 个括号内的模式</li><li>+(pattern|pattern|pattern) 匹配至少 1 个括号内的模式</li><li>*(pattern|pattern|pattern) 匹配 0 到多个括号内的模式</li><li>@(pattern|pat*|pat?erN) 精确匹配括号内的模式</li><li>** 匹配 0 到多个子目录，递归匹配子目录</li></ul><p>示例配置如下。</p><p>如下所示</p><pre><code>&#123;  &quot;description&quot;: &quot;项目配置文件&quot;,  &quot;watchOptions&quot;: &#123;     &quot;ignore&quot;: [        &quot;utils/util.js&quot;,        &quot;libs/**/**&quot;     ]  &#125;&#125;</code></pre><p><strong>注 1</strong> : watchOptions.ignore 数组中的值若表示文件或文件夹路径，以项目根目录为基准目录。</p><p><strong>注 2</strong> : 由于文件遍历和 watch 都是在项目启动时执行，因此如果修改了 watchOptions 需要重新打开项目</p><p><strong>注 3</strong>: 该配置仅 1.02.1910220 及以上版本工具支持。</p>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>注意事项</title>
      <link href="/posts/ef0ce2e.html"/>
      <url>/posts/ef0ce2e.html</url>
      
        <content type="html"><![CDATA[<h3 id="注意事项">注意事项</h3><p>小程序发布注意事项:</p><ol><li>小程序名称要与简介信息及内容相关</li><li>服务类目要对应小程序的页面内容</li><li>个人小程序提交审核要选择个人开放内类目</li></ol><p>几个基本要求：</p><p>1、一个微信小程序最多关联 5 个服务类目，一个月内可申请修改 3 次</p><p>2、微信小程序的类目选择需与页面内容匹配，在天鸽小程序平台创建的小程序，可按照以下服务类目选择<br><img src="images/service-items.jpg" alt="服务类目"></p><p>3、有些类目需要特殊资质，比如医疗、餐饮、政务类，电商等</p>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>小程序开发文档</title>
      <link href="/posts/20075456.html"/>
      <url>/posts/20075456.html</url>
      
        <content type="html"><![CDATA[<h3 id="小程序开发文档">小程序开发文档</h3><p>[开发文档](https:// <a href="http://mp.weixin.qq.com/debug/wxadoc/dev/api/">mp.weixin.qq.com/debug/wxadoc/dev/api/</a>)</p><p>目前小程序只支持网络图片或者base64图片，使用本地图片需要将图片转为base64代码</p><p>tarBar: 用来定义 tabBar 的表现</p><p>networkTimeout: 用来设置各种网络请求的超时时间</p><p><strong>Applet项目结构</strong></p><ul><li><p>app.json 小程序公共配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;pages&quot;</span>:[</span><br><span class="line">    <span class="string">&quot;pages/index/index&quot;</span>,   <span class="comment">//    默认展示该数组中的第一条</span></span><br><span class="line">    <span class="string">&quot;pages/logs/logs&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;window&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;backgroundTextStyle&quot;</span>:<span class="string">&quot;light&quot;</span>,</span><br><span class="line">    <span class="string">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#fff&quot;</span>,</span><br><span class="line">    <span class="string">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;WeChat&quot;</span>,</span><br><span class="line">    <span class="string">&quot;navigationBarTextStyle&quot;</span>:<span class="string">&quot;black&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>app.js 小程序逻辑</p></li><li><p>app.wxss 小程序公共样式表</p></li><li><p>project.config.json 项目配置文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;项目配置文件&quot;</span>,</span><br><span class="line">  <span class="string">&quot;packOptions&quot;</span>: &#123; <span class="comment">// 打包配置选项</span></span><br><span class="line">    <span class="string">&quot;ignore&quot;</span>: [] <span class="comment">// 配置打包时对符合指定规则的文件或文件夹进行忽略，跳过打包的过程，这些文件或文件夹不会出现在预览或上传的结果内</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;setting&quot;</span>: &#123; <span class="comment">// 项目设置</span></span><br><span class="line">    <span class="string">&quot;urlCheck&quot;</span>: <span class="literal">true</span>, <span class="comment">// 是否检查安全域名和TLS版本</span></span><br><span class="line">    <span class="string">&quot;es6&quot;</span>: <span class="literal">true</span>, <span class="comment">// 是否启用es5转es6</span></span><br><span class="line">    <span class="string">&quot;postcss&quot;</span>: <span class="literal">true</span>, <span class="comment">// 上传代码时样式是否自动补全</span></span><br><span class="line">    <span class="string">&quot;minified&quot;</span>: <span class="literal">true</span>, <span class="comment">// 上传代码时是否自动压缩</span></span><br><span class="line">    <span class="string">&quot;newFeature&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;compileType&quot;</span>: <span class="string">&quot;miniprogram&quot;</span>, <span class="comment">// 编译类型,miniprogram当前为普通小程序项目。plugin当前为小程序插件项目</span></span><br><span class="line">  <span class="string">&quot;libVersion&quot;</span>: <span class="string">&quot;2.0.8&quot;</span>, <span class="comment">// 基础库版本</span></span><br><span class="line">  <span class="string">&quot;appid&quot;</span>: <span class="string">&quot;wxf5b8ab7a81a76efa&quot;</span>, <span class="comment">// APPID，只在新建项目时读取</span></span><br><span class="line">  <span class="string">&quot;projectname&quot;</span>: <span class="string">&quot;test2&quot;</span>, <span class="comment">// 项目名称，只在新建项目时读取</span></span><br><span class="line">  <span class="string">&quot;isGameTourist&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;condition&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;search&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;current&quot;</span>: -<span class="number">1</span>,</span><br><span class="line">      <span class="string">&quot;list&quot;</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;conversation&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;current&quot;</span>: -<span class="number">1</span>,</span><br><span class="line">      <span class="string">&quot;list&quot;</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;game&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;currentL&quot;</span>: -<span class="number">1</span>,</span><br><span class="line">      <span class="string">&quot;list&quot;</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;miniprogram&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;current&quot;</span>: -<span class="number">1</span>,</span><br><span class="line">      <span class="string">&quot;list&quot;</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>pages</p><ul><li>wxml 页面结构</li><li>wxss 页面样式</li><li>js   页面逻辑</li><li>json 页面配置</li></ul></li><li><p>utils</p><ul><li>主要用来定义一些公用的函数函数</li></ul></li><li><p>assets 页面静态资源</p></li></ul><p><strong>wx周期函数</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onload</span>():监听页面加载时进行数据请求并设置<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">onLaunch函数：监听小程序初始化(全局只触发一次)</span><br><span class="line"><span class="title function_">onShow</span>():监听小程序显示</span><br><span class="line"><span class="title function_">onHide</span>()：监听小程序隐藏</span><br><span class="line">globalData对象：全局函数</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span>()的参数也是<span class="title class_">Object</span>类型,用于注册一个页面</span><br><span class="line"><span class="title function_">onLoad</span>():监听页面加载(只调用一次)</span><br><span class="line"><span class="title function_">onReady</span>():监听页面初次渲染完成(只调用一次)</span><br><span class="line"><span class="title function_">onShow</span>()：监听页面显示，如：页面切换</span><br><span class="line"><span class="title function_">onHide</span>():监听页面隐藏</span><br><span class="line"><span class="title function_">onUnload</span>():监听页面卸载</span><br><span class="line"></span><br><span class="line">在 redirectTo 或 navigateBack 的时候调用</span><br><span class="line"></span><br><span class="line">onPullDownRefresh 监听用户下拉动</span><br><span class="line"><span class="number">1</span>）需要在config的<span class="variable language_">window</span>选项中开启enablePullDownRefresh。</span><br><span class="line"><span class="number">2</span>）当处理完数据刷新后，wx.<span class="property">stopPullDownRefresh</span> 可以停止当前页面的下拉刷新</span><br><span class="line"></span><br><span class="line"><span class="title function_">onReachBottom</span>():页面上拉触底(滚动条触底)事件的处理函数</span><br><span class="line"><span class="attr">data</span>:页面的初始数据</span><br><span class="line"><span class="title class_">Page</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">setDate</span>():用于页面初始数据data的修改，该数据绑定到wxml上后，无需刷新，视图层就会反映出修改。</span><br><span class="line"></span><br><span class="line"><span class="title function_">getCurrentPages</span>():</span><br><span class="line">获取当前页面栈的实例，以数组形式按栈的顺序给出，第一个元素为首页，最后一个元素为当前页面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bindtap：用于给元素添加事件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;view <span class="keyword">class</span>=<span class="string">&quot;container log-list&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;logs&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;log&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;log-item&quot;</span>&gt;</span>&#123;&#123;index + 1&#125;&#125;. &#123;&#123;log&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span></span><br><span class="line">&lt;/view&gt;</span><br><span class="line">logs页面使用&lt;block/&gt;控制标签来阻止代码，在&lt;block /&gt;使用<span class="attr">wx</span>:<span class="keyword">for</span>绑定logs数据，并将logs数据循环展开节点。</span><br><span class="line"></span><br><span class="line"><span class="attr">wx</span>:<span class="keyword">for</span>=<span class="string">&quot;&#123;&#123; list &#125;&#125;&quot;</span>   遍历请求回来的数据</span><br><span class="line"><span class="attr">wx</span>:<span class="keyword">for</span>-item=<span class="string">&quot;slide&quot;</span>   列表中的每个元素</span><br><span class="line"><span class="attr">wx</span>:key=<span class="string">&quot;&#123;&#123; index &#125;&#125;&quot;</span>  每个元素所对应的下标</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>像素疑惑</strong></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> rpx:代表设置的物理像素</span><br><span class="line">小程序默认以ipho<span class="symbol">ne6</span>的分辨率来进行实际布局的宽高设置：</span><br><span class="line">ipho<span class="symbol">ne6</span>:<span class="number">2</span>倍率<span class="comment">()</span>------&gt;<span class="number">375</span> *   <span class="number">667</span></span><br><span class="line"><span class="number">375</span> *   <span class="number">667</span>中的一个像素点代表  <span class="number">750</span>  *  <span class="number">1335</span>下的两个像素点</span><br><span class="line"><span class="number">1</span>rpx: 代表的是 <span class="number">750</span>  *  <span class="number">1335</span>下的一个像素点</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>微信map的使用技巧</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">getLocation</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;gcj02&#x27;</span>&#125;):获取实时的地理位置坐标。</span><br><span class="line"><span class="attr">https</span>:<span class="comment">// mp.weixin.qq.com/wiki?t=resource/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>微信Applet图片上传</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;aaa.php&quot;</span> enctype=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&gt;</span><br><span class="line">  图片上传【multipart/form-<span class="title function_">data</span>(二进制流) text/plain】</span><br><span class="line">  &lt;input type=<span class="string">&quot;file&quot;</span>&gt;上传&lt;/input&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 选图片并缓存</span></span><br><span class="line">wx.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tempFilePaths = res.<span class="property">tempFilePaths</span></span><br><span class="line">    wx.<span class="title function_">saveFile</span>(&#123;</span><br><span class="line">      <span class="attr">tempFilePath</span>: tempFilePaths[<span class="number">0</span>], </span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;缓存路径 &gt;&gt;&gt;&#x27;</span>, res.<span class="property">savedFilePath</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选图片上传至服务器</span></span><br><span class="line">wx.<span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tempFilePaths = res.<span class="property">tempFilePaths</span></span><br><span class="line">    wx.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;http:// example.weixin.qq.com/upload&#x27;</span>, </span><br><span class="line">      <span class="attr">filePath</span>: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">      <span class="attr">formData</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;test&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务端Response &gt;&#x27;</span>, res.<span class="property">data</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小程序 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>AnnotationRate</title>
      <link href="/posts/79de2e4f.html"/>
      <url>/posts/79de2e4f.html</url>
      
        <content type="html"><![CDATA[<h3 id="AnnotationRate">AnnotationRate</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 统计指定目录下代码行数及注释率</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 用法: node annotation-rate.js &lt;路径&gt; [后缀名]...</span></span><br><span class="line"><span class="comment"> * 后缀名不填的话默认为统计 .js 和 .ts 文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 示例 [统计 ./src 下的 js 文件]: node annotation-rate.js ./src</span></span><br><span class="line"><span class="comment"> * 示例 [统计 ./dist 下的 java 文件]: node annotation-rate.js ./src .java</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取命令行参数</span></span><br><span class="line"><span class="keyword">const</span> parm = process.<span class="property">argv</span>.<span class="title function_">splice</span>(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// 第一个参数是路径</span></span><br><span class="line"><span class="keyword">const</span> rootPath = parm[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// 后面的所有参数都是文件后缀</span></span><br><span class="line"><span class="keyword">let</span> types = parm.<span class="title function_">splice</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (types.<span class="property">length</span> === <span class="number">0</span>) types = [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.ts&quot;</span>];</span><br><span class="line"><span class="comment">// 需要过滤的文件夹</span></span><br><span class="line"><span class="keyword">const</span> filter = [<span class="string">&quot;./node_modules&quot;</span>, <span class="string">&quot;./.git&quot;</span>, <span class="string">&quot;./.tscache&quot;</span>, <span class="string">&quot;.DS_Store&quot;</span>];</span><br><span class="line"><span class="comment">// 总计</span></span><br><span class="line"><span class="keyword">const</span> total = &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&quot;total&quot;</span>,</span><br><span class="line">  <span class="attr">length</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">comment</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">commentRatio</span>: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 统计结果</span></span><br><span class="line"><span class="keyword">const</span> result = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对指定文件进行统计</span></span><br><span class="line"><span class="comment"> * 包括获取文件行数、注释及计算注释率</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; path 文件路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">count</span>(<span class="params">path</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> rep = <span class="keyword">await</span> fs.<span class="title function_">readFileSync</span>(path).<span class="title function_">toString</span>();</span><br><span class="line">  <span class="keyword">const</span> lines = rep.<span class="title function_">split</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> lines_len = lines.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 匹配出注释的行数</span></span><br><span class="line">  <span class="keyword">const</span> commentNum = lines.<span class="title function_">filter</span>(<span class="function">(<span class="params">line</span>) =&gt;</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;^(//|/\\*|\\*|\\*/)&quot;</span>, <span class="string">&quot;g&quot;</span>).<span class="title function_">test</span>(line.<span class="title function_">trimStart</span>())</span><br><span class="line">  ).<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">  result.<span class="title function_">push</span>(&#123;</span><br><span class="line">    path,</span><br><span class="line">    <span class="attr">length</span>: lines_len,</span><br><span class="line">    <span class="attr">comment</span>: commentNum,</span><br><span class="line">    <span class="attr">commentRatio</span>: <span class="title class_">Math</span>.<span class="title function_">round</span>((commentNum / lines_len) * <span class="number">10000</span>) / <span class="number">100</span> + <span class="string">&quot;%&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">updateTotal</span>(lines_len, commentNum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新总计信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; length 新增行数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; comment 新增注释</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateTotal</span>(<span class="params">length, comment</span>) &#123;</span><br><span class="line">  total.<span class="property">length</span> += length;</span><br><span class="line">  total.<span class="property">comment</span> += comment;</span><br><span class="line">  total.<span class="property">commentRatio</span> =</span><br><span class="line">    <span class="title class_">Math</span>.<span class="title function_">round</span>((total.<span class="property">comment</span> / total.<span class="property">length</span>) * <span class="number">10000</span>) / <span class="number">100</span> + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归所有文件夹统计</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; pt 根目录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">start</span>(<span class="params">pt</span>) &#123;</span><br><span class="line">  fs.<span class="title function_">readdirSync</span>(pt)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">file</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;pt&#125;</span>/<span class="subst">$&#123;file&#125;</span>`</span>)</span><br><span class="line">    .<span class="title function_">forEach</span>(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> stat = fs.<span class="title function_">statSync</span>(file);</span><br><span class="line">      <span class="comment">// 是文件夹就递归</span></span><br><span class="line">      <span class="keyword">if</span> (stat.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (filter.<span class="title function_">indexOf</span>(pt) != -<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">start</span>(file);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 是文件并且后缀名符合就执行统计</span></span><br><span class="line">      <span class="keyword">if</span> (types.<span class="title function_">indexOf</span>(path.<span class="title function_">extname</span>(file)) != -<span class="number">1</span>) <span class="title function_">count</span>(file);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">start</span>(rootPath);</span><br><span class="line">  result.<span class="title function_">push</span>(total);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">table</span>(result);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具类程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AnnotationRate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Axios httpHelper</title>
      <link href="/posts/79de2e4f.html"/>
      <url>/posts/79de2e4f.html</url>
      
        <content type="html"><![CDATA[<h3 id="Axios-httpHelper">Axios httpHelper</h3><p><strong>CryptoHelper</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cryptoJs <span class="keyword">from</span> <span class="string">&quot;crypto-js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CryptoHelper</span> &#123;</span><br><span class="line">  public <span class="attr">key</span>: string;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">key: string</span>) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如需秘钥，可以在实例化时传入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 加密</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">word</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  public <span class="title function_">encrypt</span>(<span class="attr">word</span>: string | <span class="literal">undefined</span>): string &#123;</span><br><span class="line">    <span class="keyword">if</span> (!word) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> encrypted = cryptoJs.<span class="title class_">MD5</span>(word);</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="title function_">toString</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">CryptoHelper</span>;</span><br></pre></td></tr></table></figure><p><strong>Storage</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line">  public <span class="title function_">get</span>(<span class="params">key: string | <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> text = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (text) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(text);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  public <span class="title function_">set</span>(<span class="params">key: string | <span class="literal">undefined</span>, data: any</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br><span class="line">  &#125;</span><br><span class="line">  public <span class="title function_">remove</span>(<span class="params">key: string | <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Storage</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>httpHelper</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123;</span><br><span class="line">  <span class="title class_">AxiosError</span>,</span><br><span class="line">  <span class="title class_">AxiosRequestConfig</span>,</span><br><span class="line">  <span class="title class_">AxiosResponse</span>,</span><br><span class="line">  <span class="title class_">CancelTokenSource</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CryptoHelper</span> <span class="keyword">from</span> <span class="string">&quot;./cryptoJs-helper&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Storage</span> <span class="keyword">from</span> <span class="string">&quot;./storage-helper&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CANCELTTYPE</span> = &#123;</span><br><span class="line">  <span class="attr">CACHE</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">REPEAT</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ICancel</span> &#123;</span><br><span class="line">  <span class="attr">data</span>: any;</span><br><span class="line">  <span class="attr">type</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Request</span> &#123;</span><br><span class="line">  <span class="attr">md5Key</span>: string;</span><br><span class="line">  <span class="attr">source</span>: <span class="title class_">CancelTokenSource</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前处理中的请求队列缓存</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">pendingRequests</span>: <span class="title class_">Request</span>[] = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个实例</span></span><br><span class="line"><span class="keyword">const</span> http = axios.<span class="title function_">create</span>();</span><br><span class="line"><span class="keyword">const</span> storage = <span class="keyword">new</span> <span class="title class_">Storage</span>();</span><br><span class="line"><span class="keyword">const</span> cryptoHelper = <span class="keyword">new</span> <span class="title class_">CryptoHelper</span>(<span class="string">&quot;cacheKey&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">config: AxiosRequestConfig</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 为每一次请求生成一个cancleToken</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> source = axios.<span class="property">CancelToken</span>.<span class="title function_">source</span>();</span><br><span class="line">  config.<span class="property">cancelToken</span> = source.<span class="property">token</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 缓存命中判断</span></span><br><span class="line"><span class="comment">   * 成功则取消当次请求</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> data = storage.<span class="title function_">get</span>(</span><br><span class="line">    cryptoHelper.<span class="title function_">encrypt</span>(</span><br><span class="line">      config.<span class="property">url</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(config.<span class="property">data</span>) + (config.<span class="property">method</span> || <span class="string">&quot;&quot;</span>)</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">if</span> (data &amp;&amp; <span class="title class_">Date</span>.<span class="title function_">now</span>() &lt;= data.<span class="property">exppries</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">      <span class="string">`接口：<span class="subst">$&#123;config.url&#125;</span> 缓存命中 -- <span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span> -- <span class="subst">$&#123;data.exppries&#125;</span>`</span></span><br><span class="line">    );</span><br><span class="line">    source.<span class="title function_">cancel</span>(</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">CANCELTTYPE</span>.<span class="property">CACHE</span>,</span><br><span class="line">        <span class="attr">data</span>: data.<span class="property">data</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 重复请求判断</span></span><br><span class="line"><span class="comment">   * 同url，同请求类型判定为重复请求</span></span><br><span class="line"><span class="comment">   * 以最新的请求为准</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> md5Key = cryptoHelper.<span class="title function_">encrypt</span>(config.<span class="property">url</span> + (config.<span class="property">method</span> || <span class="string">&quot;&quot;</span>));</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 将之前的重复且未完成的请求全部取消</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> hits = pendingRequests.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">md5Key</span> === md5Key);</span><br><span class="line">  <span class="keyword">if</span> (hits.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    hits.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span></span><br><span class="line">      item.<span class="property">source</span>.<span class="title function_">cancel</span>(</span><br><span class="line">        <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="variable constant_">CANCELTTYPE</span>.<span class="property">REPEAT</span>,</span><br><span class="line">          <span class="attr">data</span>: <span class="string">&quot;重复请求，以取消&quot;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 将当前请求添加进请求对列中</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  pendingRequests.<span class="title function_">push</span>(&#123;</span><br><span class="line">    md5Key,</span><br><span class="line">    source,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">res: AxiosResponse</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 不论请求是否成功，</span></span><br><span class="line"><span class="comment">   * 将本次完成的请求从请求队列中移除</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// 以同样的加密方式(MD5)获取加密字符串</span></span><br><span class="line">  <span class="keyword">const</span> md5Key = cryptoHelper.<span class="title function_">encrypt</span>(</span><br><span class="line">    res.<span class="property">config</span>.<span class="property">url</span> + (res.<span class="property">config</span>.<span class="property">method</span> || <span class="string">&quot;&quot;</span>)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> index = pendingRequests.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">md5Key</span> === md5Key);</span><br><span class="line">  <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    pendingRequests.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">data</span> &amp;&amp; res.<span class="property">data</span>.<span class="property">type</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">config</span>.<span class="property">data</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> dataParse = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">config</span>.<span class="property">data</span>);</span><br><span class="line">      <span class="keyword">if</span> (dataParse.<span class="property">cache</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!dataParse.<span class="property">cacheTime</span>) &#123;</span><br><span class="line">          dataParse.<span class="property">cacheTime</span> = <span class="number">1000</span> * <span class="number">60</span> * <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        storage.<span class="title function_">set</span>(</span><br><span class="line">          cryptoHelper.<span class="title function_">encrypt</span>(</span><br><span class="line">            res.<span class="property">config</span>.<span class="property">url</span> + res.<span class="property">config</span>.<span class="property">data</span> + (res.<span class="property">config</span>.<span class="property">method</span> || <span class="string">&quot;&quot;</span>)</span><br><span class="line">          ),</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">data</span>: res.<span class="property">data</span>.<span class="property">data</span>,</span><br><span class="line">            <span class="attr">exppries</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() + dataParse.<span class="property">cacheTime</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">`接口：<span class="subst">$&#123;res.config.url&#125;</span> 设置缓存，缓存时间: <span class="subst">$&#123;dataParse.cacheTime&#125;</span>`</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&quot;接口报错了！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装 get、post 请求</span></span><br><span class="line"><span class="comment"> * 集成接口缓存过期机制</span></span><br><span class="line"><span class="comment"> * 缓存过期将重新请求获取最新数据，并更新缓存</span></span><br><span class="line"><span class="comment"> * 数据存储在localstorage</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *      cache: true</span></span><br><span class="line"><span class="comment"> *      cacheTime: 1000 * 60 * 3  -- 默认缓存3分钟</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> httpHelper = &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">url: string, params: any</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      http</span><br><span class="line">        .<span class="title function_">get</span>(url, params)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="keyword">async</span> (<span class="attr">res</span>: <span class="title class_">AxiosResponse</span>) =&gt; &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">error: AxiosError</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (axios.<span class="title function_">isCancel</span>(error)) &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="attr">cancle</span>: <span class="title class_">ICancel</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(error.<span class="property">message</span>);</span><br><span class="line">            <span class="keyword">if</span> (cancle.<span class="property">type</span> === <span class="variable constant_">CANCELTTYPE</span>.<span class="property">REPEAT</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="title function_">resolve</span>([]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="title function_">resolve</span>(cancle.<span class="property">data</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(error);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">post</span>(<span class="params">url: string, params: any</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      http</span><br><span class="line">        .<span class="title function_">post</span>(url, params)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="keyword">async</span> (<span class="attr">res</span>: <span class="title class_">AxiosResponse</span>) =&gt; &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">error: AxiosError</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (axios.<span class="title function_">isCancel</span>(error)) &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="attr">cancle</span>: <span class="title class_">ICancel</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(error.<span class="property">message</span>);</span><br><span class="line">            <span class="keyword">if</span> (cancle.<span class="property">type</span> === <span class="variable constant_">CANCELTTYPE</span>.<span class="property">REPEAT</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="title function_">resolve</span>(<span class="literal">null</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="title function_">resolve</span>(cancle.<span class="property">data</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(error);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> httpHelper;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具类程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Axios </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>代码质量及规范</title>
      <link href="/posts/7c78d1ac.html"/>
      <url>/posts/7c78d1ac.html</url>
      
        <content type="html"><![CDATA[<h3 id="1、背景">1、背景</h3><p>在多人协作项目中，如果代码风格统一、代码提交信息的说明准确，那么在后期协作以及Bug处理时会更加方便。</p><p>因此，在本文章中，我会介绍怎么使用下面这个工具，在git push 代码之前检测commit messages</p><ol><li>commitlint</li><li>husky</li></ol><h2 id="2、commit规范">2、commit规范</h2><blockquote><p>commit message 格式: <code>&lt;type&gt;:&lt;subject&gt;</code></p></blockquote><p><strong>type</strong></p><p>用于说明 commit 的类别，只允许使用下面7个标识</p><ul><li>feat：新功能（feature）</li><li>fix：修补bug</li><li>docs：文档（documentation）</li><li>style：格式（不影响代码运行的变动）</li><li>refactor：重构（即不是新增功能，也不是修改bug的代码变动）</li><li>test：增加测试</li><li>chore：构建过程或辅助工具的变动</li></ul><p>如果type为feat和fix，则该 commit 将肯定出现在 Change log 之中。</p><p><strong>subject</strong></p><p>subject是 commit 目的的简短描述，不超过50个字符，且结尾不加句号（.）。</p><h3 id="3、使用工具校验commit是否符合规范">3、使用工具校验commit是否符合规范</h3><p><strong>全局安装</strong></p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> install -g @commitlint/cli @commitlint/config-conventional</span><br></pre></td></tr></table></figure><p><strong>项目根目录生成配置配件</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">echo</span> <span class="string">&quot;module.exports = &#123;extends: [&#x27;<span class="variable">@commitlint</span>/config-conventional&#x27;]&#125;&quot;</span> &gt; commitlint.config.js</span><br></pre></td></tr></table></figure><p>** 在commitlint.config.js制定提交message规范</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&#x27;@commitlint/config-conventional&#x27;</span>],</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;type-enum&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;always&#x27;</span>, [</span><br><span class="line">      <span class="string">&quot;feat&quot;</span>, <span class="string">&quot;fix&quot;</span>, <span class="string">&quot;docs&quot;</span>, <span class="string">&quot;style&quot;</span>, <span class="string">&quot;refactor&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;chore&quot;</span>, <span class="string">&quot;revert&quot;</span></span><br><span class="line">    ]],</span><br><span class="line">    <span class="string">&#x27;subject-full-stop&#x27;</span>: [<span class="number">0</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;subject-case&#x27;</span>: [<span class="number">0</span>, <span class="string">&#x27;never&#x27;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>上面我们就完成了commitlint的安装与提交规范的制定。检验commit message的最佳方式是结合git hook</p><p><strong>husky介绍</strong></p><p>husky继承了Git下所有的钩子，在触发钩子的时候，husky可以阻止不合法的commit,push等等。<strong>注意使用husky之前，必须先将代码放到git 仓库中，否则本地没有.git文件，就没有地方去继承钩子了。</strong></p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install husky --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure><p>安装成功后需要在项目下的package.json中配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;commitmsg&quot;</span>: <span class="string">&quot;commitlint -e <span class="variable">$GIT_PARAMS</span>&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;config&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;commitizen&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;cz-customizable&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>husky的钩子</strong></p><p>package.json添加如下钩子</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;husky&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hooks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pre-commit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run lint&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>最后总结过程中遇到一些问题</strong></p><ol><li>git commit后可能报错相关‘regenerator-runtime’模块找不到；解决方式：npm install regenerator-runtime –save。</li><li>git commit -m “messge”,用双引号</li><li>prepare ：在打包和发布包之前运行，在 npm install 没有任何参数的本地运行</li></ol><h3 id="代码质量">代码质量</h3><ul><li>复杂度： 项目量、模块大小、耦合度等</li><li>重复率： 要求5% 以下</li><li>代码风格</li></ul><h3 id="代码质量管控">代码质量管控</h3><ul><li>规范化<ul><li>建立代码规范<ul><li>统一目录结构</li><li>统一命名规范、统一编辑器配置</li></ul></li><li>Code Review 制度<ul><li>PR 方式 + 指定审核人 进行 merge 操作</li></ul></li></ul></li><li>自动化<ul><li>使用 linters 自动检查代码质量</li></ul></li></ul><h3 id="代码质量分析工具">代码质量分析工具</h3><blockquote><p>代码静态分析（Program Static Analysis）是指在不运行代码的方式下，通过词法分析、语法分析、控制流、数据流分析等技术对程序代码进行扫描，验证代码是否满足规范性、安全性、可靠性、可维护性等指标的一种代码分析技术</p></blockquote><ul><li>gitee scan<ul><li>代码缺陷、代码规范进行扫描、检查漏洞</li></ul></li><li>sonarQube<ul><li>对项目进行代码行数量/重复率统计、代码逻辑缺陷扫描（如空指针）、口令/密钥泄漏风险扫描、坏味道检测，并给出对应详细的报告与修复评估</li><li>根据 SonarLint Report 视图，展示不规范的事项列表，处理警告和坏味道</li><li>产品组<ul><li>sonarqube：sonarqube是一个web平台，是sonarqube的基础，统一管理插件和规则，统一展现度量数据</li><li>SonarQube Scanners：命令行扫描工具，进行代码的静态扫描</li><li>SonarQube Plugins：插件，支持多种语言</li><li>SonarLint：IDE集成插件</li></ul></li></ul></li></ul><p><a href="https://www.jianshu.com/p/c14973c7c382">sonarQube 参考链接</a></p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>工程化</title>
      <link href="/posts/76315ff9.html"/>
      <url>/posts/76315ff9.html</url>
      
        <content type="html"><![CDATA[<ul><li><p>如何解决代码拆分问题</p><ul><li>CommonJS 规范</li><li>ES6</li></ul></li><li><p>如何让浏览器支持模块</p><ul><li>早期：使用 browserify、requirejs 打包工具编写 浏览器中运行 CommonJS 的模块代码</li><li>ECMAScript 使得模块成为标准 <code>&lt;script type='module' /&gt;</code></li></ul></li><li><p>主流构建工具</p><ul><li>Parcel<ul><li>0 配置，开箱即用</li><li>简单应用</li></ul></li><li>Rollup<ul><li>用标准化格式编写代码，减少无用代码来减小包体积</li><li>只能打包js</li><li>适合构建类库</li></ul></li><li>Webpack</li><li>vite</li><li>Esbuild</li></ul></li></ul><p><img src="../images/question1.webp" alt="汇总一"></p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HomeBrew</title>
      <link href="/posts/b79f8971.html"/>
      <url>/posts/b79f8971.html</url>
      
        <content type="html"><![CDATA[<h1>Inter 版本 Home-brew 国内源安装</h1><ol><li>cd ~<br>Curl -fsSL <a href="https://raw.githubusercontent.com/Homebrew/install/master/install.sh">https://raw.githubusercontent.com/Homebrew/install/master/install.sh</a> &gt;&gt; brew_install</li><li>修改 BREW_REPO<br>BREW_REPO=“git://mirrors.ustc.edu.cn/brew.git”</li><li>快速安装<br>/bin/bash brew_install<blockquote><p>若卡住 /usr/local/Homebrew/Library/Taps/homebrew，则执行以下操作：<br>mkdir -p /usr/local/Homebrew/Library/Taps/homebrew/<br>cd /usr/local/Homebrew/Library/Taps/homebrew<br>git clone <a href="https://mirrors.ustc.edu.cn/homebrew-core.git">https://mirrors.ustc.edu.cn/homebrew-core.git</a><br>终端输入 brew help 查看是否安装成功</p></blockquote></li></ol><h2 id="ARM-版-HomeBrew-安装">ARM 版 HomeBrew 安装</h2><p>/bin/bash -c “$(curl -fsSL <a href="https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh">https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh</a>)”</p><h1>设置 homebrew 环境变量</h1><p>vim ~/.bash_profile<br>export PATH=/opt/homebrew/bin:$PATH<br>source ~/.bash_profile</p><h2 id="设置环境变量-根据终端类型设置环境变量">设置环境变量[根据终端类型设置环境变量]</h2><pre><code>查看终端类型: echo $SHELLeg: [macOS Catalina(10.15.x)]echo export PATH=/opt/homebrew/bin:$PATH &gt;&gt; ~/.zprofilesource ~/.zprofile</code></pre><h2 id="smartmontools">smartmontools</h2><p>brew install smartmontools<br>smartctl -a disk0</p>]]></content>
      
      
      <categories>
          
          <category> 工具类程序 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>书签</title>
      <link href="/posts/d21d4e81.html"/>
      <url>/posts/d21d4e81.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.baacloud72.com/modules/login.php">https://www.baacloud72.com/modules/login.php</a></p><p><a href="https://www.jianshu.com/p/8b769356ee67">https://www.jianshu.com/p/8b769356ee67</a><br><a href="https://help.aliyun.com/document_detail/27480.html">https://help.aliyun.com/document_detail/27480.html</a></p><p><a href="https://www.toyaml.com/index.html">https://www.toyaml.com/index.html</a></p><p><a href="https://sword.bladex.vip/#/user/login">https://sword.bladex.vip/#/user/login</a><br><a href="http://boot.jeecg.com/user/login?redirect=%2Fonline%2Fcgform">http://boot.jeecg.com/user/login?redirect=%2Fonline%2Fcgform</a><br><a href="https://preview.pro.ant.design/dashboard/analysis/">https://preview.pro.ant.design/dashboard/analysis/</a><br><a href="http://datav.aliyun.com/portal/school/atlas/area_generator#4.00/100.113693/33.594992">http://datav.aliyun.com/portal/school/atlas/area_generator#4.00/100.113693/33.594992</a></p><p><a href="https://gojs.net.cn/api/index.html">https://gojs.net.cn/api/index.html</a><br><a href="https://www.mapbox.cn/mapbox-gl-js/examples/">https://www.mapbox.cn/mapbox-gl-js/examples/</a><br><a href="https://www.openstreetmap.org/#map=4/27.68/122.34">https://www.openstreetmap.org/#map=4/27.68/122.34</a><br><a href="https://tileserver.readthedocs.io/en/latest/">https://tileserver.readthedocs.io/en/latest/</a><br><a href="https://openmaptiles.com/downloads/planet/">https://openmaptiles.com/downloads/planet/</a><br><a href="https://lbs.amap.com/tools/picker">https://lbs.amap.com/tools/picker</a></p><p><a href="https://www.geekxh.com/0.01.%E6%8C%87%E5%AF%BC%E5%AD%A6%E4%B9%A0/023.html">https://www.geekxh.com/0.01.指导学习/023.html</a><br><a href="https://tool.lu/">https://tool.lu/</a><br><a href="https://tinypng.com/">https://tinypng.com/</a></p><p><a href="https://web.dev/learn/css/">https://web.dev/learn/css/</a><br><a href="https://www.patterns.dev/posts/classic-design-patterns/">https://www.patterns.dev/posts/classic-design-patterns/</a></p><p><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</a><br><a href="https://www.ruanyifeng.com/blog/2019/04/oauth_design.html">https://www.ruanyifeng.com/blog/2019/04/oauth_design.html</a></p><p><a href="https://codesign.qq.com/?utm_source=cloud&amp;utm_medium=banner">https://codesign.qq.com/?utm_source=cloud&amp;utm_medium=banner</a></p><p><a href="https://www.bootcdn.cn/">https://www.bootcdn.cn/</a></p><ul><li><p>浏览器主进程：<br>负责界面显示、用户交互、子进程管理，同时提供存储等功能。</p></li><li><p>渲染进程：<br>核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页。<br>排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中。<br>默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。<br>出于安全考虑，渲染进程都是运行在沙箱模式下，无法访问系统资源。</p></li><li><p>GPU 进程：<br>Chrome 刚开始发布的时候是没有 GPU 进程的。<br>GPU 的使用初衷是为了实现 3D CSS 的效果。<br>随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。<br>最后，Chrome 在其多进程架构上也引入了 GPU 进程。</p></li><li><p>网络进程：<br>主要负责页面的网络资源加载。<br>之前是作为一个模块运行在浏览器主进程里面的，直至最近才独立出来，成为一个单独的进程。</p></li><li><p>插件进程：<br>主要是负责插件的运行。<br>因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。</p></li></ul><p><a href="https://www.zhihu.com/question/400613871">https://www.zhihu.com/question/400613871</a></p>]]></content>
      
      
      <categories>
          
          <category> 浏览器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 书签 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器加载</title>
      <link href="/posts/365597d0.html"/>
      <url>/posts/365597d0.html</url>
      
        <content type="html"><![CDATA[<h1>浏览器加载</h1><h3 id="加载过程">加载过程</h3><p>1、当浏览器获得一个html文件时，会”自上而下“加载，并在加载过程中进行解析渲染。<br>2、加载过程中遇到外部css文件，浏览器另外发出一个请求，来获取css文件。<br>3、遇到图片资源，浏览器也会另外发出一个请求，来获取图片资源。这是异步请求，并不会影响html文档进行加载。<br>4、但是当文档加载过程中遇到js文件，html文档会挂起渲染（加载解析渲染同步）的线程，不仅要等待文档中js文件加载完毕，还要等待解析执行完毕，才可以恢复html文档的渲染线程。</p><p>5、加载外联js和css的阻塞情况<br>一个不太严谨但方便记忆的口诀：<code>JS 全阻塞，CSS 半阻塞</code></p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">JS</span> 会阻塞后续 DOM 解析以及其它资源(如 CSS，<span class="keyword">JS</span> 或图片资源)的加载。</span><br><span class="line">CSS不阻塞DOM的加载和解析（它只阻塞DOM的渲染呈现。这里谈加载），不会阻塞其它资源(如图片)的加载，但是会阻塞 后续<span class="keyword">JS</span> 文件的执行（原因之一是，<span class="keyword">js</span>执行代码可能会依赖到css样式。css只阻塞执行而不阻塞<span class="keyword">js</span>的加载）。</span><br><span class="line">鉴于上面的特性，当css后面存在<span class="keyword">js</span>的时候，css会间接地阻塞<span class="keyword">js</span>后面资源的加载（css阻塞<span class="keyword">js</span>，<span class="keyword">js</span>阻塞其他资源 ）。</span><br><span class="line">现代浏览器会进行 <span class="keyword">prefetch</span> 优化，浏览器在获得 html 文档之后会对页面上引用的资源进行提前下载</span><br><span class="line">外联<span class="keyword">js</span>文件使用defer属性和async可以达到异步非阻塞加载的效果，由于现代浏览器都存在 <span class="keyword">prefetch</span>，所以 defer, async 可能并没有太多的用途，可以作为了解扩展知识，仅仅将脚本文件放到 body 底部(但还是在<span class="string">`&lt;/body&gt;`</span>之前)就可以起到很不错的优化效果（遵循先解析再渲染再执行script这个顺序）。当把<span class="keyword">js</span>放在最后的时候，其实浏览器将自动忽略<span class="string">`&lt;/body&gt;`</span>标签，从而自动在最后的最后补上<span class="string">`&lt;/body&gt;`</span>。</span><br></pre></td></tr></table></figure><h3 id="浏览器解析">浏览器解析</h3><p>1、浏览器通过请求的 URL 进行域名解析，向服务器发起请求，接收文件（HTML、CSS、JS、Images等等）。<br>2、HTML 文件加载后，开始构建 DOM Tree（DOM树）<br>3、CSS 样式文件加载后，开始解析和构建 CSS Rule Tree<br>4、Javascript 脚本文件加载后， 通过 DOM API 和 CSS Object Model(<code>CSSOM</code>) API 来操作 DOM Tree 和 CSS Rule Tree</p><h3 id="浏览器渲染">浏览器渲染</h3><p>1、浏览器引擎通过 DOM Tree 和 CSS Rule Tree 构建 Rendering Tree（渲染树）<br>2、布局阶段：在屏幕上绘制渲染树中的所有节点的几何属性，比如： 位置，宽高，大小等等，这个过程称为 Flow 或 Layout 。<br>3、绘制元素: 绘制所有节点的可视属性，比如：背景色等。<br>4、合并渲染层：把以上绘制的所有图层（类似于PhotoShop中的“图层”）合并,最终输出一张图片<br>其中的阶段3、4可称之为Paint</p><p>DOM树<br>CSS树</p><p>Render Tree</p><p>Layout Tree: 计算元素大小、位置</p><p>paint/repaint: 遍历渲染树、使用UI层渲染节点</p><h3 id="常用事件">常用事件</h3><ul><li>onready表示文档结构已经加载完成（不包含图片等非文字媒体文件）</li><li>onload 事件在页面完全加载完毕的时候触发(所有内容加载完成)</li><li>onbeforeunload、onunload 事件在即将离开当前页面（刷新或关闭）时触发</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">不同点</span><br><span class="line"><span class="bullet">1.</span> onbeforeunload在onunload之前执行，它还可 以阻止onunload的执行</span><br><span class="line"><span class="bullet">2.</span> onbeforeunload 是正要去服务器读 取新的页面时调用，此时还没开始读取；</span><br><span class="line"><span class="bullet">3.</span> onunload是已经从服务器上读到了需要加载的新的页面，在即将替换掉当前页面时调用。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 浏览器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器加载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>html渲染文档</title>
      <link href="/posts/97915d97.html"/>
      <url>/posts/97915d97.html</url>
      
        <content type="html"><![CDATA[<p><strong>html渲染文档</strong></p><ul><li><p>dom<br>dom是一种中间代理模式，维护文档树、处理事件交互、样式和绘制，对开发者最友好，实现上最容易，方便调试，样式丰富，交互控件多，界面体验好，通过keyframes来实现动画也很便捷。缺点是不管你的实际应用要不要这些服务，它都是标配，没法绕过去，导致开销大，性能差，不适用于元素数量很多的情况</p></li><li><p>canvas（2d)<br>canvas则是给开发者开放了一种直接访问底层绘图功能的接口，去除了中间代理，好处当然是更快了，坏处是什么都得自己来，交互、刷新、维护数据和渲染，此外canvas在处理大分辨率设备时比较吃力（比如地图这方面不如基于dom的svg, svg是draw，canvas是paint ），处理文本和屏幕适配方面也不太好。</p></li><li><p>webgl<br>webgl实际上用了canvas的一个3d渲染上下文，在绘制平面内容时，和canvas 2d相比，webgl更为直接的利用了gpu硬件，在某些场合，几乎可以摆脱cpu的限制，达到性能极致。</p></li></ul><p>简言之，尽管现代浏览器都尽量为dom（比如涉及video、image元素以及像素变换方面）、canvas 2d和webgl提供硬件加速的支持，但webgl在渲染数量众多的元素或像素时，性能毫无疑问的遥遥领先。</p>]]></content>
      
      
      <categories>
          
          <category> 浏览器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html渲染文档 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基础</title>
      <link href="/posts/20dbfd00.html"/>
      <url>/posts/20dbfd00.html</url>
      
        <content type="html"><![CDATA[<p><strong>五大浏览器的内核</strong><br>Trident:IE Maxthon（遨游）腾讯、世界之窗、360浏览器<br>此内核仅应用于window平台<br>Gecko： Firefox<br>Webkit：Safari、Chrome<br>Presto：Opera --世界公认渲染速度最快的引擎<br>Blink：Google和Opera SoftWare 开发的浏览器排版引擎</p><h3 id="Chrome-Dev-tools">Chrome Dev-tools</h3><p>Audits：分析一个页面。然后提供关于减少页面加载时间的建议和优化<br>TimeLine：<br>提高渲染性能<br>Profile<br><a href="https://developers.google.com/speed/pagespeed/insights/">参考链接</a></p>]]></content>
      
      
      <categories>
          
          <category> 浏览器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器缓存</title>
      <link href="/posts/be7c79f7.html"/>
      <url>/posts/be7c79f7.html</url>
      
        <content type="html"><![CDATA[<h3 id="浏览器缓存">浏览器缓存</h3><p><img src="./images/browser-cache.png" alt="browser-cache"></p><ul><li>主要指<code>http</code>缓存，其机制是根据<code>http</code>报文的<code>缓存标识</code>进行相应操作</li><li>强制缓存</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">强制缓存就是，用户第一次访问页面之后，浏览器将数据存在缓存中，在过期时间之内，都不会再请求服务器。是否使用强制缓存在于资源是否过期，该过期时间从第一次请求的服务器响应头中获取。如果在过期时间内，从缓存中读取，如果超出过期时间，则使用协商缓存。</span><br><span class="line"></span><br><span class="line">控制强制缓存的字段分别是Expires和<span class="keyword">Cache</span>-Control，其中 <span class="keyword">Cache</span>-Control 优先级比Expires高[由response 设定]</span><br><span class="line"></span><br><span class="line">上面的<span class="number">200</span> <span class="keyword">from</span> memory <span class="keyword">cache</span>和<span class="number">200</span> <span class="keyword">from</span> disk <span class="keyword">cache</span>属于强制缓存</span><br></pre></td></tr></table></figure><ul><li>协商缓存</li></ul><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">协商缓存，从字面意思，就是要协商，是浏览器和服务器协商，那么浏览器每次都要和服务器通信。在第一次请求服务器时，服务器会返回资源，并且返回一个资源的缓存标识，一起存到浏览器的缓存数据库。当第二次请求资源时，浏览器会首先将缓存标识发送给服务器，服务器拿到标识后判断标识是否匹配，如果不匹配，表示资源有更新，服务器会将新数据和新的缓存标识一起返回到浏览器；如果缓存标识匹配，表示资源没有更新，并且返回 <span class="number">304</span> 状态码，浏览器就读取本地缓存服务器中的数据。</span><br><span class="line"></span><br><span class="line">与协商缓存有关的字段是<span class="title class_">Last</span>-<span class="title class_">Modified</span>/<span class="title class_">IF</span>-<span class="title class_">Modified</span>-<span class="title class_">Since</span>、<span class="title class_">Etag</span>/<span class="title class_">IF</span>-<span class="title class_">None</span>-<span class="title class_">Match</span>。</span><br><span class="line"></span><br><span class="line"><span class="title class_">Last</span>-<span class="title class_">Modified</span>与<span class="title class_">ETag</span>是可以一起使用的，服务器会优先验证<span class="title class_">ETag</span>，一致的情况下，才会继续比对<span class="title class_">Last</span>-<span class="title class_">Modified</span>，最后才决定是否返回<span class="number">304</span>。</span><br><span class="line">```        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 特点</span></span><br><span class="line">- 优势</span><br><span class="line">  - 减少冗余的数据传输，节省带宽</span><br><span class="line">  - 减轻服务器的请求负担，有缓存就可以少向服务器发送请求，尤其是对于一些访问量大的网站这点还是很重要的</span><br><span class="line">  - 资源从缓存中读取，无需向服务器发送请求再等待返回，加快了客户端的访问速度</span><br><span class="line">- 缺点</span><br><span class="line">  - 项目更新后，用户访问浏览器读取的是缓存资源，无法获取到最新页面</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 缓存常见 http status</span></span><br><span class="line">![http-cache](./images/http-cache.png)</span><br><span class="line"></span><br><span class="line">status &amp; size      | 解释</span><br><span class="line"><span class="symbol">:-------------</span>     | ----</span><br><span class="line"><span class="number">200</span> from memory cache    | 状态码是灰色的，从内存中读取之前已经加载过的资源，不请求服务器，页面关闭时，资源就会被内存释放，再次打开相同页面不会出现此类情况，在同一页面刷新才会出现。一般脚本、字体、图片会存在内存当中</span><br><span class="line"><span class="number">200</span> from disk cache      | 状态码是灰色的，从磁盘中读取之前已经加载过的资源，不请求服务器，页面关闭不会被释放，这部分资源存在电脑磁盘里，只有用户手动清除浏览器缓存的时候才会释放。一般非脚本会存在内存当中，如css等</span><br><span class="line"><span class="number">200</span> 数值大小              | 从服务器下载最新资源，数值是从服务器获取的全部资源大小</span><br><span class="line"><span class="number">304</span> 数值大小              | 访问服务器，发现资源没有更新，使用本地资源。数值是与服务器通信报文的大小，并不是资源本身的大小。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 浏览器有三级缓存原理</span></span><br><span class="line"><span class="number">1</span>、先查找内存，如果内存中存在，从内存中加载</span><br><span class="line"><span class="number">2</span>、如果内存中未查找到，选择硬盘获取，如果硬盘中有，从硬盘中加载</span><br><span class="line"><span class="number">3</span>、如果硬盘中未查找到，那就进行网络请求，加载到的资源缓存到硬盘和内存</span><br><span class="line"></span><br><span class="line">假设某个用户打开过我们的页面，然后我们更新了文件，用户再去访问，资源加载情况是<span class="number">200</span> from disk cache，浏览器根本没有请求服务器，所以拿不到新的资源文件。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">### 用户行为会对缓存产生影响</span></span><br><span class="line">用户操作  | <span class="title class_">Expires</span>/<span class="title class_">Cache</span>-<span class="title class_">Control</span>  | <span class="title class_">Last</span>-<span class="title class_">Modied</span>/<span class="title class_">Etag</span></span><br><span class="line"><span class="symbol">:--------</span> | <span class="symbol">:----------------------</span>:  | <span class="symbol">:---------------</span>:</span><br><span class="line">地址栏回车 | 有效 | 有效</span><br><span class="line">页面链接跳转 | 有效 | 有效</span><br><span class="line">新开窗口 | 有效 | 有效</span><br><span class="line">前进回退 | 有效 | 有效</span><br><span class="line"><span class="title class_">F5</span>刷新 | 无效 | 有效</span><br><span class="line"><span class="title class_">Ctrl</span> + <span class="title class_">F5</span> 强制刷新 | 无效 | 无效</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 第一次发起 <span class="title class_">HTTP</span> 请求</span><br><span class="line">```mermaid</span><br><span class="line">sequenceDiagram</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 第一次发起 <span class="title class_">HTTP</span> 请求</span><br><span class="line">浏览器缓存 --&gt;&gt; 浏览器: 没有该请求的缓存结果和缓存标识</span><br><span class="line">浏览器 -&gt;&gt; 服务器: 发起 <span class="title class_">HTTP</span> 请求</span><br><span class="line">服务器 --&gt;&gt; 浏览器: 返回请求结果和缓存规则</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 将该请求结果和缓存标识写入浏览器缓存中</span><br></pre></td></tr></table></figure><ul><li>强制缓存生效</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 发起 HTTP 请求</span><br><span class="line">浏览器缓存 --&gt;&gt; 浏览器: 存在该请求的缓存结果、未失效、返回</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>强制缓存失效，使用协商缓存</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 发起 HTTP 请求</span><br><span class="line">浏览器缓存 --&gt;&gt; 浏览器: 该请求的缓存结果失效，则只返回缓存标识</span><br><span class="line">浏览器 -&gt;&gt; 服务器: 携带该资源的缓存标识，发起 HTTP 请求</span><br></pre></td></tr></table></figure><ul><li>强制缓存失效，直接向服务器请求</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 发起 HTTP 请求</span><br><span class="line">浏览器缓存 --&gt;&gt; 浏览器: 没有该请求的缓存结果和缓存标识</span><br><span class="line">浏览器 -&gt;&gt; 服务器: 发起 HTTP 请求</span><br></pre></td></tr></table></figure><ul><li>304</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 发起 HTTP 请求</span><br><span class="line">浏览器缓存 --&gt;&gt; 浏览器: 该请求的缓存结果失效，则只返回缓存标识</span><br><span class="line">浏览器 -&gt;&gt; 服务器: 携带该资源的缓存标识，发起 HTTP 请求</span><br><span class="line">服务器 --&gt;&gt; 浏览器: 304， 该资源无更新</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 获取该请求的缓存结果</span><br><span class="line">浏览器缓存 --&gt;&gt; 浏览器: 返回该请求的缓存结果</span><br></pre></td></tr></table></figure><ul><li>重新返回结果</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 发起 HTTP 请求</span><br><span class="line">浏览器缓存 --&gt;&gt; 浏览器: 该请求的缓存结果失效，则只返回缓存标识</span><br><span class="line">浏览器 -&gt;&gt; 服务器: 携带该资源的缓存标识，发起 HTTP 请求</span><br><span class="line">服务器 --&gt;&gt; 浏览器: 该资源更新了，重新返回请求结果， 200</span><br><span class="line">浏览器 -&gt;&gt; 浏览器缓存: 将该请求结果和缓存标识写入浏览器缓存中</span><br></pre></td></tr></table></figure><h3 id="使用场景">使用场景</h3><p>以React为例，React在打包的时候，css和js名字都加了哈希值，所以改动后打包生成的js和css是唯一的，页面请求的是新资源，不会有缓存问题。但是入口文件index.html会因为缓存造成更新问题，如果我们更新了，但是浏览器使用的是缓存，就会出现问题。所以需要对入口文件设置不使用强制缓存，需要每次去服务器验证文件是否修改，即使用协商缓存</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">webpack.pro.config.js</span><br><span class="line">output: &#123;</span><br><span class="line">  path: path.<span class="keyword">join</span>(__dirname, <span class="string">&#x27;./dist&#x27;</span>),</span><br><span class="line">  publicPath: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  filename: <span class="string">&#x27;bundle.[chunkhash].js&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">server</span> &#123;</span><br><span class="line"></span><br><span class="line">  listen       <span class="number">80</span>;</span><br><span class="line">  server_name  localhost;</span><br><span class="line">  root   /etc/html;</span><br><span class="line">  <span class="keyword">index</span>  <span class="keyword">index</span>.html;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    try_files $uri /<span class="keyword">index</span>.html;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta"># 对html文件限制缓存</span></span><br><span class="line">  location ~ .*\.(html)$ &#123;  </span><br><span class="line">    </span><br><span class="line">    <span class="meta"># add_header Cache-Control no-store;   # 禁止缓存</span></span><br><span class="line">    add_header Cache-Control no-cache; <span class="meta"># 协商缓存</span></span><br><span class="line">    add_header Pragma no-cache;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"># Pragma: no-cache可以应用到http 1.0 和 http 1.1</span></span><br><span class="line"><span class="meta"># Cache-Control: no-cache只能应用于http 1.1</span></span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/SallyShan/p/13603221.html">参考链接</a></p><!-- ### web网站css，js更新后客户浏览器缓存问题，需要刷新才能正常展示的解决办法 -->]]></content>
      
      
      <categories>
          
          <category> 浏览器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 缓存 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器运行机制</title>
      <link href="/posts/4edb44f5.html"/>
      <url>/posts/4edb44f5.html</url>
      
        <content type="html"><![CDATA[<h1>浏览器运行机制详解</h1><h2 id="1-浏览器是多进程的">1. 浏览器是多进程的</h2><h5 id="GPU-进程">GPU 进程</h5><ul><li>最多一个，用于 3D 绘制等</li></ul><h5 id="Browser-进程">Browser 进程</h5><ul><li>负责浏览器界面显示，与用户交互。如前进，后退等</li><li>负责各个页面的管理，创建和销毁其他进程</li><li>将 Renderer 进程得到的内存中的 Bitmap，绘制到用户界面上</li><li>网络资源的管理，下载等</li></ul><h5 id="第三方插件进程">第三方插件进程</h5><ul><li>每种类型的插件对应一个进程，仅当使用该插件时才创建</li></ul><h5 id="浏览器渲染进程（浏览器内核）">浏览器渲染进程（浏览器内核）</h5><ul><li>默认每个 tab 页一个进程</li><li>页面渲染，脚本执行，事件处理等</li></ul><h2 id="2-浏览器渲染进程是多线程的">2. 浏览器渲染进程是多线程的</h2><h5 id="GUI-渲染线程">GUI 渲染线程</h5><ul><li>负责渲染浏览器界面，解析 HTML，CSS，构建 DOM 树和 RenderObject 树，布局和绘制等。</li><li><strong>当界面需要重绘（Repaint）或由于某种操作引发回流(reflow)时，该线程就会执行</strong></li><li>注意，GUI 渲染线程与 JS 引擎线程是互斥的，当 JS 引擎执行时 GUI 线程会被挂起（相当于被冻结了），GUI 更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行。</li></ul><h5 id="js-引擎线程">js 引擎线程</h5><ul><li>也称为 JS 内核，负责处理 Javascript 脚本程序。（例如 V8 引擎）</li><li>JS 引擎线程负责解析 Javascript 脚本，运行代码。</li><li><strong>JS 引擎一直等待任务队列中任务的到来，然后加以处理，一个 Tab 页（renderer 进程）中只有一个 JS 线程在运行</strong></li><li><strong>同样注意，GUI 渲染线程与 JS 引擎线程是互斥的。所以如果 JS 执行的时间过长，要放在 body 下面，否则就会导致页面渲染加载阻塞。</strong></li></ul><h5 id="事件触发线程">事件触发线程</h5><ul><li>管理着事件队列</li><li>监听事件，符合条件时把回调函数放入事件队列中</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如：以下两种回调函数均会在事件队列中执行</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>))</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">456</span>))</span><br></pre></td></tr></table></figure><h5 id="定时触发器线程">定时触发器线程</h5><ul><li>setInterval 与 setTimeout 在此线程中计时完毕后，把回调函数放入事件队列中</li><li><strong>浏览器定时计数器并不是由 JavaScript 引擎计数的</strong>,（因为 JavaScript 引擎是单线程的, 如果处于阻塞线程状态就会影响记计时的准确），因此通过单独线程来计时并触发定时（计时完毕后，添加到事件队列中，等待 JS 引擎空闲后执行）</li><li>注意，W3C 在 HTML 标准中规定，规定要求<strong>setTimeout 中低于 4ms 的时间间隔算为 4ms</strong>。</li></ul><h5 id="异步-http-请求线程">异步 http 请求线程</h5><ul><li>检测到 XHR 对象状态变化时，将回调函数放入事件队列中</li></ul><p>event loop 整体流程</p><h2 id="3-repaint、reflow">3. repaint、reflow</h2><h5 id="repaint">repaint</h5><ul><li>repiant 或者 redraw 遍历所有的节点检测各节点的可见性、颜色、轮廓等可见的样式属性，然后根据检测的结果更新页面的响应部分。</li><li>当 render tree 中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如 background-color。则就叫称为重绘</li></ul><h5 id="reflow">reflow</h5><ul><li>reflow 指的是计算页面布局。某个节点 reflow 时会重新计算节点的尺寸和位置，而且还有可能触发其子节点、祖先节点和页面上的其他节点 reflow。在这之后再触发一次 repaint。</li><li>当 render tree 中的一部分(或全部)因为元素的规模尺寸，布局，隐藏等改变而需要重新构建。这就称为回流,每个页面至少需要一次回流，就是在页面第一次加载的时候。</li></ul><h5 id="导致-reflow-的操作">导致 reflow 的操作</h5><ol><li>调整窗口大小</li><li>改变字体</li><li>增加或者移除样式表</li><li>内容变化，比如用户在 input 框中输入文字</li><li>激活 CSS 伪类，比如 :hover (IE 中为兄弟结点伪类的激活)</li><li>操作 class 属性</li><li>脚本操作 DOM</li><li>计算 offsetWidth 和 offsetHeight 属性</li><li>设置 style 属性的值</li></ol><h5 id="它们会大大影响-web-性能，如何减少-reflow、repaint">它们会大大影响 web 性能，如何减少 reflow、repaint</h5><ol><li>不要通过父级来改变子元素样式，最好直接改变子元素样式，改变子元素样式尽可能不要影响父元素和兄弟元素的大小和尺寸</li><li>尽量通过 class 来设计元素样式，切忌用 style 多次操作单个属性</li><li>实现元素的动画，对于经常要进行回流的组件，要抽离出来，它的 position 属性应当设为 fixed 或 absolute</li><li>权衡速度的平滑。比如实现一个动画，以 1 个像素为单位移动这样最平滑，但 reflow 就会过于频繁，CPU 很快就会被完全占用。如果以 3 个像素为单位移动就会好很多。</li><li>不要用 tables 布局的另一个原因就是 tables 中某个元素一旦触发 reflow 就会导致 table 里所有的其它元素 reflow。在适合用 table 的场合，可以设置 table-layout 为 auto 或 fixed，</li><li>这样可以让 table 一行一行的渲染，这种做法也是为了限制 reflow 的影响范围。</li><li>css 里不要有表达式 expression</li><li>减少不必要的 DOM 层级（DOM depth）。改变 DOM 树中的一级会导致所有层级的改变，上至根部，下至被改变节点的子节点。这导致大量时间耗费在执行 reflow 上面。</li><li>避免不必要的复杂的 CSS 选择器，尤其是后代选择器（descendant selectors），因为为了匹配选择器将耗费更多的 CPU。</li><li>尽量不要过多的频繁的去增加，修改，删除元素，因为这可能会频繁的导致页面 reflow，可以先把该 dom 节点抽离到内存中进行复杂的操作然后再 display 到页面上。</li><li>请求如下值 offsetTop, offsetLeft, offsetWidth, offsetHeight，scrollTop/Left/Width/Height，clientTop/Left/Width/Height，浏览器会发生 reflow，建议将他们合并到一起操作，可以减少回流的次数。</li></ol><ul><li><a href="https://www.jianshu.com/p/777180d61d09">浏览器进程介绍</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 浏览器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器运行机制 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>跨域</title>
      <link href="/posts/58add7e9.html"/>
      <url>/posts/58add7e9.html</url>
      
        <content type="html"><![CDATA[<h3 id="工作于B-S架构">工作于B/S架构</h3><p>浏览器(Brower)作为HTTP客户端(Client)通过URL向HTTP服务端(WEB服务器)发送所有请求<br>Web服务器有：Apache服务器，IIS服务器（Internet Information Services）等</p><table><thead><tr><th>项目</th><th>Value</th></tr></thead><tbody><tr><td>GET</td><td>请求指定的页面信息，并返回实体主体</td></tr><tr><td>HEAD</td><td>类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头</td></tr><tr><td>POST</td><td>向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改</td></tr><tr><td>PUT</td><td>从客户端向服务器传送的数据取代指定的文档的内容</td></tr><tr><td>DELETE</td><td>请求服务器删除指定的页面</td></tr><tr><td>CONNECT</td><td>HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器</td></tr><tr><td>OPTIONS</td><td>允许客户端查看服务器的性能</td></tr><tr><td>TRACE</td><td>回显服务器收到的请求，主要用于测试或诊断</td></tr></tbody></table><h3 id="浏览器同源策略及规避方法">浏览器同源策略及规避方法</h3><ul><li>协议相同</li><li>域名相同</li><li>端口相同</li></ul><blockquote><p>为了保证用户信息的安全，防止恶意的网站窃取数据 [<strong>提交表单不受同源政策的限制</strong>]</p></blockquote><p>非同源，以下三种情况将受到限制:</p><ol><li>Cookie、LocalStorage 和 IndexDB 无法读取</li><li>DOM 无法获得</li><li>AJAX 请求不能发送</li></ol><h3 id="Cookie">Cookie</h3><ul><li>服务器写入浏览器的一小段信息，只有同源的网页才能共享。但是，两个网页一级域名相同，只是二级域名不同，浏览器允许通过设置document.domain共享 Cookie。<br>Cookie 是服务器对应该 session 回话的id</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">例如：</span><br><span class="line">举例来说</span><br><span class="line">A网页是http://w1.example.com/a.html，</span><br><span class="line">B网页是http://w2.example.com/b.html，</span><br><span class="line">那么只要设置相同的document.<span class="keyword">domain</span>，两个网页就可以共享Cookie。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Window</span>.<span class="keyword">open</span>、iframe 引入的窗口和父窗口无法进行通讯</span><br><span class="line">解决方法：</span><br><span class="line">设置<span class="keyword">window</span>.name 可保证在同一窗口下的父子窗口进行通讯</span><br><span class="line"></span><br><span class="line"><span class="keyword">Window</span>.postMessage</span><br></pre></td></tr></table></figure><h3 id="CROS-跨域资源共享-IE-10">CROS 跨域资源共享 (IE&gt;10)</h3><ul><li>允许浏览器向跨源服务器，发出XMLHttpRequest请求，克服ajax只能同源使用的限制<ul><li><p>简单请求：浏览器在头信息中添加 origin(本次请求来自哪个源)</p><ul><li>请求方法是以下三种方法之一：<br>▪ HEAD<br>▪ GET<br>▪ POST</li><li>HTTP的头信息不超出以下几种字段：<br>▪ Accept：请求报文可通过一个“Accept”报文头属性告诉服务端 客户端接受什么类型的响应<br>▪ Accept-Language<br>▪ Content-Language<br>▪ Last-Event-ID<br>▪ DPR<br>▪ Downlink<br>▪ Save-Data<br>▪ Viewport-Width<br>▪ Width<br>▪ Content-Type：只限于三个值application/x-www-form-urlencoded、multipart/form-data、text/plain</li></ul></li><li><p>复杂请求</p><ul><li>不同时满足以上两个条件即为复杂请求</li></ul>  <figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">浏览器:</span><br><span class="line">首先: Prefligt 请求(OPTIONS:浏览器主动发出 -- 不会携带任何请求参数)</span><br><span class="line">Access-Control-Request-<span class="keyword">Method</span>: 本次预检请求的方法</span><br><span class="line">Access-Control-Request-Headers：本次请求所携带的自定义首部字段(产生OPTIONS请求的主要原因)</span><br><span class="line">服务器端根据 origin 来决定是否允许此次请求:</span><br><span class="line">允许:</span><br><span class="line">Access-Control-Allow-Origin: http:<span class="comment">//api.bob.com （请求源）--当发送cookie时不可设置为</span></span><br><span class="line">Access-Control-Allow-Credentials: <span class="keyword">true</span>  (是否允许客户端发送cookie)</span><br><span class="line">Access-Control-Expose-Headers: FooBar (允许XMLHttpRequest对象获取其他字段)</span><br><span class="line">Content-<span class="keyword">Type</span>: text/html<span class="punctuation">;</span> charset=utf-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CORS请求默认不发送Cookie和HTTP认证信息</span><br><span class="line">服务端设置：</span><br><span class="line">Access-Control-Allow-Credentials: <span class="keyword">true</span> # 发送cookie:</span><br><span class="line">客户端:</span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()<span class="punctuation">;</span></span><br><span class="line">xhr.withCredentials = <span class="keyword">true</span><span class="punctuation">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>JSONP 跨域实现</p><ul><li>客户端</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> oBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleResponse</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;response&#x27;</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    oBtn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">        script.<span class="property">src</span> = <span class="string">&quot;https://api.douban.com/v2/book/search?q=javascript&amp;count=1&amp;callback=handleResponse&quot;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">insertBefore</span>(script, <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">firstChild</span>);   </span><br><span class="line">    &#125;;</span><br><span class="line"><span class="comment">// 防止内存泄露</span></span><br><span class="line">oBtn = <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><ul><li>服务端</li></ul><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)<span class="comment">;</span></span><br><span class="line"><span class="built_in">funcName</span> = request.getParameter(<span class="string">&#x27;callback&#x27;</span>)<span class="comment">;</span></span><br><span class="line">out.print(<span class="built_in">funcName</span> + <span class="string">&#x27;(eval(&quot;hello world&quot;))&#x27;</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure><ul><li>输出结果</li></ul><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;<span class="function"><span class="title">handleResponse</span>(<span class="string">&#x27;hello world&#x27;</span>)</span></span><br></pre></td></tr></table></figure></li><li><p>反向代理</p><ul><li>http-proxy-middleware</li><li>Nginx</li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 浏览器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 跨域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端开发</title>
      <link href="/posts/2620dd4d.html"/>
      <url>/posts/2620dd4d.html</url>
      
        <content type="html"><![CDATA[<h3 id="区别">区别</h3><ul><li>webapp: 运行在浏览器端</li><li>hybrid app: 利用 Cordova 打包，内置 <code>webview</code>、 可以调取原生硬件设备</li><li>native: 用户体验，性能方面最优</li></ul><h3 id="优缺点">优缺点</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">开发难度：webapp 难度小</span><br><span class="line">发布渠道：混合<span class="keyword">app</span>可以在<span class="keyword">app</span> store发布，及自主更新，而原生必须通过应用商店来更新</span><br><span class="line">跨平台及可移植性：webapp 和混合<span class="keyword">app</span> 均可实现跨平台，</span><br><span class="line">混合<span class="keyword">app</span>可以通过js API访问到移动设备的摄像头，GPS等硬件设施，原生可以访问移动设备的所有硬件设施</span><br></pre></td></tr></table></figure><h3 id="开发模式">开发模式</h3><h4 id="1-Hybrid混合开发">1. Hybrid混合开发</h4><ul><li>Hbuilder中MUI框架</li></ul><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过在原生<span class="keyword">APP</span>中嵌入<span class="string">&quot;Webview&quot;</span>(内置浏览器)，让前端代码跑在内置浏览器上</span><br><span class="line">js调用原生Android，来进行设备硬件的调用</span><br></pre></td></tr></table></figure><ul><li>Cordova 构建</li></ul><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">将前端代码放置在“<span class="meta">public</span>”文件夹内，打包之后生成apk文件</span><br><span class="line">拖动到手机上进行安装，在app内部内嵌<span class="string">&quot;一个webview&quot;</span>,所有前端代码都运行在该内置的浏览器上，再利用<span class="keyword">js</span>调用原生Android来实现手机硬件设备的调用。</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Xcode打包ios APP<br>在mac系统&quot;X-code&quot;开发ios APP,将前端代码放置在app文件夹内，利用js调用Object C语言，然后利用Object C来调用手机硬件设备</li></ul>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PC适配</title>
      <link href="/posts/f1d4bf9f.html"/>
      <url>/posts/f1d4bf9f.html</url>
      
        <content type="html"><![CDATA[<h3 id="PC-AutoSize">PC AutoSize</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 工具类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BigScreen</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 默认配置</span></span><br><span class="line">  defaultProps = (&#123;</span><br><span class="line">    <span class="attr">baseWidth</span>: <span class="number">1920</span>,</span><br><span class="line">    <span class="attr">baseHeight</span>: <span class="number">1080</span>,</span><br><span class="line">    <span class="attr">scaleCoeff</span>: <span class="number">0</span> <span class="comment">// 缩放系数</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化el样式</span></span><br><span class="line">  elDefaultStyle = (&#123;</span><br><span class="line">    <span class="attr">position</span>: <span class="string">&#x27;absolute&#x27;</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>: <span class="string">&#x27;left top 0px&#x27;</span>, <span class="comment">// 表示在对元素进行变换的时候，设置围绕哪个点进行变化的,默认变换的原点在元素的中心点【X、Y轴的50%处】</span></span><br><span class="line">    <span class="attr">left</span>: <span class="string">&#x27;50%&#x27;</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="string">&#x27;50%&#x27;</span>,</span><br><span class="line">    <span class="attr">transition</span>: <span class="string">&#x27;all 2s&#x27;</span>,</span><br><span class="line">    <span class="attr">overflow</span>: <span class="string">&#x27;auto&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; el, baseWidth, baseHeight, scaleCoeff &#125; = &#123; ...<span class="variable language_">this</span>.<span class="property">defaultProps</span>, ...props &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">el</span> = el;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">scaleCoeff</span> = scaleCoeff;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">baseWidth</span> = baseWidth;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">baseHeight</span> = baseHeight;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initDomHandler</span>();</span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calcRate</span>();</span><br><span class="line">    <span class="comment">// 改变窗口大小重新绘制</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, <span class="variable language_">this</span>.<span class="property">resize</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">initDomHandler</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> db = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="variable language_">this</span>.<span class="property">el</span>);</span><br><span class="line">    db.<span class="property">style</span>.<span class="property">width</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseWidth&#125;</span>px`</span>;</span><br><span class="line">    db.<span class="property">style</span>.<span class="property">height</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseHeight&#125;</span>px`</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">elDefaultStyle</span>) &#123;</span><br><span class="line">      db.<span class="property">style</span>[key] = <span class="variable language_">this</span>.<span class="property">elDefaultStyle</span>[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">db</span> = db;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">calcRate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> baseRate = (<span class="variable language_">this</span>.<span class="property">baseWidth</span> / <span class="variable language_">this</span>.<span class="property">baseHeight</span>).<span class="title function_">toFixed</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> currentRate = (<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>).<span class="title function_">toFixed</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> db = <span class="variable language_">this</span>.<span class="property">db</span>;</span><br><span class="line">    <span class="keyword">if</span> (db) &#123;</span><br><span class="line">      <span class="keyword">if</span> (currentRate &gt; baseRate) &#123;</span><br><span class="line">        <span class="comment">// 以高为准</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scaleCoeff</span> = (<span class="variable language_">window</span>.<span class="property">innerHeight</span> / <span class="variable language_">this</span>.<span class="property">baseHeight</span>).<span class="title function_">toFixed</span>(<span class="number">5</span>);</span><br><span class="line">        db.<span class="property">style</span>.<span class="property">transform</span> =</span><br><span class="line">            <span class="string">&quot;scale(&quot;</span> + <span class="variable language_">this</span>.<span class="property">scaleCoeff</span> + <span class="string">&quot;) translate(-50%,-50%)&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 以宽为准</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">scaleCoeff</span> = (<span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">this</span>.<span class="property">baseWidth</span>).<span class="title function_">toFixed</span>(<span class="number">5</span>);</span><br><span class="line">        db.<span class="property">style</span>.<span class="property">transform</span> =</span><br><span class="line">            <span class="string">&quot;scale(&quot;</span> + <span class="variable language_">this</span>.<span class="property">scaleCoeff</span> + <span class="string">&quot;) translate(-50%,-50%)&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">resize</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">timer</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">calcRate</span>()</span><br><span class="line">    &#125;, <span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">BigScreen</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> bs = <span class="keyword">new</span> <span class="title class_">BigScreen</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  <span class="attr">baseWidth</span>: <span class="number">1920</span>,</span><br><span class="line">  <span class="attr">baseHeight</span>: <span class="number">1080</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hbuilder MUI</title>
      <link href="/posts/96884077.html"/>
      <url>/posts/96884077.html</url>
      
        <content type="html"><![CDATA[<h4 id="Hbuilder-MUI">Hbuilder MUI</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">官网:www<span class="selector-class">.dcloud</span><span class="selector-class">.io</span></span><br><span class="line">高度封装好的东西---意味着 自定义性特别差!!!</span><br><span class="line"></span><br><span class="line">利用Hbuilder 来创建移动App项目步骤:</span><br><span class="line">打开Hbuilder--&gt;</span><br><span class="line">勾选mui项目---&gt;自动生成js、css、fonts、index<span class="selector-class">.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">API : dev<span class="selector-class">.dcloud</span><span class="selector-class">.net</span>.cn/mui/snippet</span><br><span class="line"></span><br><span class="line">H5+ </span><br><span class="line">www<span class="selector-class">.dcloud</span>.io/runtime<span class="selector-class">.html</span></span><br><span class="line">HTML5 中国产业联盟</span><br><span class="line">www<span class="selector-class">.html5plus</span><span class="selector-class">.org</span></span><br><span class="line"></span><br><span class="line">Android 文件管理器---推荐 ES文件管理</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Rem</title>
      <link href="/posts/bbf0a1cb.html"/>
      <url>/posts/bbf0a1cb.html</url>
      
        <content type="html"><![CDATA[<h3 id="rem详解及使用方法">rem详解及使用方法</h3><blockquote><p>浏览器的默认字体高都是 16px</p></blockquote><h4 id="方案一">方案一</h4><ul><li><strong>兼容性：</strong></li></ul><p>目前，IE9+，Firefox、Chrome、Safari、Opera 的主流版本都支持了 rem</p><p>就算对不支持的浏览器，应对方法也很简单，就是多写一个绝对单位的声明。这些浏览器会忽略用 rem 设定的字体大小。</p><ul><li><strong>使用%单位方便使用</strong></li></ul><p>css 中的 body 中先全局声明 font-size=62.5%，这里的%的算法和 rem 一样。</p><p><strong>因为 100%=16px，1px=6.25%，所以 10px=62.5%，</strong></p><p>这是的 1rem=10px，所以 12px=1.2rem。px 与 rem 的转换通过 10 转换</p><ul><li><strong>使用方法</strong></li></ul><p>注意，rem 是<strong>只相对于根元素 htm 的 font-size</strong>，即只需要设置根元素的 font-size，其它元素使用 rem 单位设置成相应的百分比即可；</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// 一般情况下，使用方式</span><br><span class="line"><span class="selector-tag">html</span> &#123; <span class="attribute">font-size</span>:<span class="number">62.5%</span>; &#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123; </span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">1.2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">14px</span>; <span class="comment">/** 针对不支持rem的浏览器 */</span></span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">1.4rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CSS 媒体查询：仅在浏览器和设备的环境与你指定的规则匹配时 CSS 才会被应用</span></span><br><span class="line"><span class="comment"> * @media media-type and (media-feature-rule) &#123;</span></span><br><span class="line"><span class="comment"> *   CSS rules</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 移动端适配，使用方式【页面字体大小自适应】 */</span> </span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">320px</span>)&#123;</span><br><span class="line">  <span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">62.5%</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">640px</span>)&#123;</span><br><span class="line">  <span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">125%</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">750px</span>)&#123;</span><br><span class="line">  <span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">150%</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">1242px</span>)&#123;</span><br><span class="line">  <span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">187.5%</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方案二">方案二</h4><ul><li>给根元素设置字体大小，并在body元素校正</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 因为Chrome某些版本不支持10px大小的字体 */</span></span><br><span class="line"><span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">100px</span>;&#125;</span><br><span class="line"><span class="selector-tag">body</span>&#123;<span class="attribute">font-size</span>:<span class="number">14px</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span> &#123; <span class="attribute">padding</span>: .rem .<span class="number">3rem</span>;&#125;</span><br></pre></td></tr></table></figure><ul><li>监听绑定事件，dom加载后和尺寸变化时改变 <code>font-size</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 改变font-size</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params">doc,win</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> docEI = doc.<span class="property">documentElement</span>,</span><br><span class="line">    resizeEvt = <span class="string">&#x27;orientationchange&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span> ?<span class="string">&#x27;orientataionchange&#x27;</span> : <span class="string">&#x27;resize&#x27;</span>,</span><br><span class="line">    recalc = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> clientWidth = docEI.<span class="property">clientWidth</span>;</span><br><span class="line">        <span class="keyword">if</span>(!clientWidth) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 100是字体大小，1920 是开发时浏览器窗口的宽度，等比计算</span></span><br><span class="line">        docEI.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="number">100</span>*(clientWidth/<span class="number">1920</span>)+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!doc.<span class="property">addEventListener</span>) <span class="keyword">return</span>;</span><br><span class="line">    win.<span class="title function_">addEventListener</span>(resizeEvt, recalc, <span class="literal">false</span>);</span><br><span class="line">    doc.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, recalc, <span class="literal">false</span>);</span><br><span class="line">&#125;)(<span class="variable language_">document</span>,<span class="variable language_">window</span>);</span><br></pre></td></tr></table></figure><h3 id="适配方案">适配方案</h3><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* postcss-px-to-view<span class="keyword">port</span>-8-plugin 将 px 单位转换为视口单位的 (vw, vh, vmin, vmax) 的 PostCSS 插件</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="A-Q">A &amp; Q</h4><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- 为什么不设置 font-<span class="built_in">size</span>:<span class="number">62.5</span><span class="comment">% ？</span></span><br><span class="line"></span><br><span class="line">因为谷歌有些版本不支持<span class="number">10</span>px大小的字体</span><br><span class="line"></span><br><span class="line">- 为什么不使用 em ？</span><br><span class="line"></span><br><span class="line">同百分比一样，相对于父元素计算不方便</span><br><span class="line"></span><br><span class="line">- 为什么不使用 viewport 等比缩放？</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;</span> /&gt;</span><br><span class="line">这种做法是将屏幕等比缩放，缩放过大时会失真</span><br><span class="line"></span><br><span class="line">- 使用<span class="built_in">rem</span> web就是响应式的了吗？</span><br><span class="line">不是，<span class="built_in">rem</span>只是等比缩放，只解决了响应式布局的准则 的部分问题 ，还需要配合媒体查询</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">设备像素比：</span><br><span class="line">http:<span class="regexp">//</span>www.zhangxinxu.com<span class="regexp">/wordpress/</span><span class="number">2012</span><span class="regexp">/08/</span>window-devicepixelratio/</span><br><span class="line">制作图标字体：</span><br><span class="line">iconmoon.io<span class="regexp">/app/</span><span class="comment">#select</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">标准的样式重置:http:<span class="regexp">//</span>cssreset.com</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>juejin.cn<span class="regexp">/post/</span><span class="number">6844903631993454600</span></span><br><span class="line">https:<span class="regexp">//</span>juejin.cn<span class="regexp">/post/</span><span class="number">6953091677838344199</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Cordova</title>
      <link href="/posts/2620dd4d.html"/>
      <url>/posts/2620dd4d.html</url>
      
        <content type="html"><![CDATA[<h3 id="Cordova">Cordova</h3><p><a href="https://juejin.cn/post/7006145405792550942">参考链接</a></p>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>适配</title>
      <link href="/posts/5f15d77.html"/>
      <url>/posts/5f15d77.html</url>
      
        <content type="html"><![CDATA[<h2 id="移动端适配">移动端适配</h2><h3 id="1、为什么要移动端适配？">1、为什么要移动端适配？</h3><blockquote><p>一般情况下设计稿的设计师按照375的尺寸设计，然而，在现在移动终端（就是手机）快速更新的时代，每个品牌的手机都有着不同的<code>物理分辨率</code>，这样就会导致，每台设备的<code>逻辑分辨率</code>也不尽相同，此时357的设计稿，如果想要还原那基本是不可能了，因为如果一个左右布局，左边如果写死，右边自适应的话，每个设备的右边所展示的内容大小就不尽相同，这是移动端适配就显得尤其重要。</p></blockquote><h3 id="2、-尺寸">2、 尺寸</h3><blockquote><p>屏幕尺寸是以屏幕对角线的长度来计量，计量单位为英寸。</p></blockquote><h3 id="3、像素">3、像素</h3><blockquote><p>像素是硬件和软件所能控制的最小单位。它指显示屏的画面上表示出来的最小单位，不是图画上的最小单位。单位面积内的像素越多，图像的效果就越好。(注意每个像素的大小是不固定的，他是根据设备的分辨率决定的)</p></blockquote><h3 id="4、分辨率">4、分辨率</h3><blockquote><p>屏幕分辨率是指纵横向上的像素点数，单位是px。屏幕分辨率确定计算机屏幕上显示多少信息的设置，以水平和垂直像素来衡量。就相同大小的屏幕而言，当屏幕分辨率低时（例如 640 x 480），在屏幕上显示的像素少，单个像素尺寸比较大。屏幕分辨率高时（例如 1600 x 1200），在屏幕上显示的像素多，单个像素尺寸比较小。</p></blockquote><h3 id="5、设备物理分辨率（物理像素）">5、设备物理分辨率（物理像素）</h3><h3 id="6、逻辑分辨率（设备独立像素）">6、逻辑分辨率（设备独立像素）</h3><h3 id="7、设备像素比">7、设备像素比</h3><blockquote><p>设备像素比device pixel ratio简称dpr，即物理像素和设备独立像素的比值。为什么要知道<code>设备像素比 DPR</code>呢？因为这个像素比会产生一个非常经典的问题，1像素边框的问题。</p></blockquote><h4 id="7-1-、1px边框问题">7.1 、1px边框问题</h4><ul><li>问题</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当我们css里写的1px的时候，由于它是逻辑像素，导致我们的逻辑像素根据这个设备像素比（dpr）去映射到设备上就为2px，或者3px，由于每个设备的屏幕尺寸不一样，就导致每个物理像素渲染出来的大小也不同（记得上面的知识点吗，设备的像素大小是不固定的），这样如果在尺寸比较大的设备上，1px渲染出来的样子相当的粗矿，这就是经典的一像素边框问题。</span><br></pre></td></tr></table></figure><ul><li>解决方案（通过动态计算屏幕尺寸与设计图的尺寸获得的比例就是scale的值）</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 在web中，浏览器使用 window.devicePixelRatio 来获取dpr。在css中，使用媒体查询 min-device-pixel-ratio，我们根据这个像素比，来算出他对应应该有的大小,但是暴露个非常大的兼容问题（不同系统的不同浏览器对小数点的px有不同的处理）*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.border-bottom</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">background</span>:<span class="number">#000</span>;</span><br><span class="line">  -webkit-<span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.5</span>);</span><br><span class="line">  -webkit-<span class="attribute">transform-origin</span>:<span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2倍屏 */</span></span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">2.0</span>) &#123;</span><br><span class="line">  <span class="selector-class">.border-bottom</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.5</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3倍屏 */</span></span><br><span class="line"><span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">3.0</span>) &#123;</span><br><span class="line">  <span class="selector-class">.border-bottom</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">scaleY</span>(<span class="number">0.33</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="8、如何适配">8、如何适配</h3><p><strong>viewport</strong></p><ul><li>移动端配置视口</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width; initial-scale=1; maximum-scale=1; minimum-scale=1; user-scalable=no;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="9-解决适配方法">9. 解决适配方法</h3><h4 id="9-1、rem适配">9.1、rem适配</h4><p>优点：根据屏幕大小百分百还原设计稿<br>缺陷：用户使用更大的屏幕，是想看到更多的内容，而不是更大的字</p><h4 id="9-2、vw，vh布局">9.2、vw，vh布局</h4><blockquote><p>vh、vw方案即将视觉视口宽度 window.innerWidth和视觉视口高度 window.innerHeight 等分为 100 份。</p></blockquote><p>vh和vw方案和rem类似也是相当麻烦需要做单位转化，而且px转换成vw不一定能完全整除，因此有一定的像素差。可借助 postcss-px-to-viewport能自动实现px到vw的转化</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> postcsspxtoviewport8plugin <span class="keyword">from</span> <span class="string">&#x27;postcss-px-to-viewport-8-plugin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">postcsspxtoviewport8plugin</span>(&#123;</span><br><span class="line">  <span class="attr">unitToConvert</span>: <span class="string">&#x27;px&#x27;</span>, <span class="comment">// 需要转换的单位，默认为&quot;px&quot;</span></span><br><span class="line">  <span class="attr">viewportWidth</span>: <span class="number">375</span>, <span class="comment">// 设计稿的视口宽度</span></span><br><span class="line">  <span class="attr">unitPrecision</span>: <span class="number">5</span>, <span class="comment">// 单位转换后保留的精度</span></span><br><span class="line">  <span class="attr">propList</span>: [<span class="string">&#x27;*&#x27;</span>], <span class="comment">// 能转化为vw的属性列表</span></span><br><span class="line">  <span class="attr">viewportUnit</span>: <span class="string">&#x27;vw&#x27;</span>, <span class="comment">// 希望使用的视口单位</span></span><br><span class="line">  <span class="attr">fontViewportUnit</span>: <span class="string">&#x27;vw&#x27;</span>, <span class="comment">// 字体使用的视口单位</span></span><br><span class="line">  <span class="attr">selectorBlackList</span>: [], <span class="comment">// 需要忽略的CSS选择器，不会转为视口单位，使用原有的px等单位。</span></span><br><span class="line">  <span class="attr">minPixelValue</span>: <span class="number">1</span>, <span class="comment">// 设置最小的转换数值，如果为1的话，只有大于1的值会被转换</span></span><br><span class="line">  <span class="attr">mediaQuery</span>: <span class="literal">false</span>, <span class="comment">// 媒体查询里的单位是否需要转换</span></span><br><span class="line">  <span class="attr">replace</span>: <span class="literal">true</span>, <span class="comment">// 是否直接更换属性值，而不添加备用属性</span></span><br><span class="line">  <span class="attr">exclude</span>: <span class="literal">undefined</span>, <span class="comment">// 忽略某些文件夹下的文件或特定文件，例如 &#x27;node_modules&#x27; 下的文件</span></span><br><span class="line">  <span class="attr">landscape</span>: <span class="literal">false</span>, <span class="comment">// 是否添加根据 landscapeWidth 生成的媒体查询条件 @media (orientation: landscape)</span></span><br><span class="line">  <span class="attr">landscapeUnit</span>: <span class="string">&#x27;vw&#x27;</span> <span class="comment">// 横屏时使用的单位</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="9-3、px为主，vx和vxxx（vw-vh-vmax-vmin）为辅，搭配一些flex（推荐）">9.3、px为主，vx和vxxx（vw/vh/vmax/vmin）为辅，搭配一些flex（推荐）</h4><h3 id="10-移动端适配流程">10.移动端适配流程</h3><ol><li>在head设置width=device-width的viewport</li><li>在cSS中使用px</li><li>在适当的场景使用flex布局，或者配合vw进行自适应</li><li>在跨设备类型的时候（pc &lt;-&gt; 手机 &lt;-&gt; 平板）使用媒体查询</li><li>在跨设备类型如果交互差异太大的情况，考虑分开项目开发</li></ol><p><a href="https://juejin.cn/post/6844903631993454600#comment">参考链接</a></p>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>响应式布局</title>
      <link href="/posts/9a628290.html"/>
      <url>/posts/9a628290.html</url>
      
        <content type="html"><![CDATA[<h3 id="响应式布局">响应式布局</h3><blockquote><p>一个网站能够兼容多个终端，可以根据屏幕的大小自动调整页面的的展示方式以及布局！</p></blockquote><h4 id="响应式设计与自适应设计的区别？">响应式设计与自适应设计的区别？</h4><p>响应式设计：响应式开发一套界面，通过检测视口分辨率，针对不同客户端做代码处理，来展现不同的布局和内容。<br>自适应设计：自适应需要开发多套界面，通过检测视口分辨率，来判断当前访问的设备是 PC 端、平板还是手机，从而请求服务层，返回不同的页面。</p><h4 id="响应式设计与自适应设计如何选取？">响应式设计与自适应设计如何选取？</h4><p>页面不是太复杂的情况下，采用响应式布局的方式<br>页面中信息较多，布局较为复杂的情况，采用自适应布局的方式</p><h4 id="响应式设计与自适应设计的优缺点？">响应式设计与自适应设计的优缺点？</h4><ul><li><p>响应式布局<br>优点：灵活性强，能够快捷解决多设备显示适用问题<br>缺点<br>效率较低，兼容各设备工作量大<br>代码较为累赘，加载时间可能会加长<br>在一定程度上改变了网站原有的布局结构</p></li><li><p>自适应布局<br>优点:<br>对网站复杂程度兼容更大<br>代码更高效<br>测试和运营都相对容易和精准</p></li></ul><p>缺点：同一个网站需要为不同的设备开发不同的页面，增加的开发的成本</p><h4 id="常见屏幕尺寸">常见屏幕尺寸</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">分辨率</span>   <span class="string">比例</span> <span class="string">|</span> <span class="string">设备尺寸</span></span><br><span class="line"></span><br><span class="line"><span class="number">1024</span> <span class="string">*</span> <span class="number">500</span><span class="string">（8.9</span> <span class="string">寸）</span></span><br><span class="line"><span class="number">1024</span> <span class="string">*</span> <span class="number">768</span><span class="string">（4</span> <span class="string">:</span> <span class="number">3</span>  <span class="string">|</span> <span class="number">10.4</span> <span class="string">寸、12.1</span> <span class="string">寸、14.1</span> <span class="string">寸、15</span> <span class="string">寸）</span></span><br><span class="line"><span class="number">1280</span> <span class="string">*</span> <span class="number">800</span><span class="string">（16</span> <span class="string">:</span> <span class="number">10</span>  <span class="string">|15.4</span> <span class="string">寸）</span></span><br><span class="line"><span class="number">1280</span> <span class="string">*</span> <span class="number">1024</span><span class="string">（5：4</span>  <span class="string">|</span> <span class="number">14.1</span><span class="string">寸、15.0寸）</span></span><br><span class="line"><span class="number">1280</span> <span class="string">*</span> <span class="number">854</span><span class="string">（15</span> <span class="string">:</span> <span class="number">10</span> <span class="string">|</span> <span class="number">15.2</span><span class="string">）</span></span><br><span class="line"><span class="number">1366</span> <span class="string">*</span> <span class="number">768</span><span class="string">（16：9</span> <span class="string">|</span> <span class="string">不常见）</span></span><br><span class="line"><span class="number">1440</span> <span class="string">*</span> <span class="number">900</span><span class="string">（16：10</span>  <span class="number">17</span><span class="string">寸</span> <span class="string">仅苹果用）</span></span><br><span class="line"><span class="number">1440</span> <span class="string">*</span> <span class="number">1050</span><span class="string">（5：4</span>  <span class="string">|</span> <span class="number">14.1</span><span class="string">寸、15.0寸）</span></span><br><span class="line"><span class="number">1600</span> <span class="string">*</span> <span class="number">1024</span><span class="string">（14：9</span> <span class="string">|</span> <span class="string">不常见）</span></span><br><span class="line"><span class="number">1600</span> <span class="string">*</span> <span class="number">1200</span><span class="string">（4：3</span> <span class="string">|</span> <span class="number">15</span><span class="string">、16.1）</span></span><br><span class="line"><span class="number">1680</span> <span class="string">*</span> <span class="number">1050</span><span class="string">（16：10</span> <span class="string">|</span> <span class="number">15.4</span><span class="string">寸、20.0寸）</span></span><br><span class="line"><span class="number">1920</span> <span class="string">*</span> <span class="number">1200</span><span class="string">（23寸）</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 移动端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Deployment.yaml</title>
      <link href="/posts/a6f3aa2.html"/>
      <url>/posts/a6f3aa2.html</url>
      
        <content type="html"><![CDATA[<h3 id="Deployment-yaml">Deployment.yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span>   <span class="comment"># 指定api版本，此值必须在kubectl api-versions中</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>                 <span class="comment"># 指定创建资源的角色/类型</span></span><br><span class="line"><span class="attr">metadata:</span>                        <span class="comment"># 资源的元数据/属性 </span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cango-demo</span>               <span class="comment"># 资源的名字，在同一个namespace中必须唯一</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">cango-prd</span>           <span class="comment"># 命名空间</span></span><br><span class="line">  <span class="attr">labels:</span>                        <span class="comment"># 设定资源的标签</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">cango-demo</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">stable</span>  </span><br><span class="line"><span class="attr">spec:</span>         <span class="comment"># 资源规范字段              </span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span> <span class="comment"># 声明副本数目</span></span><br><span class="line">  <span class="attr">strategy:</span>   <span class="comment"># 策略</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span> <span class="comment"># 滚动更新策略</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">1</span>       <span class="comment"># 最大额外可以存在的副本数</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span> <span class="comment"># 滚动升级时允许的最大Unavailable的pod个数</span></span><br><span class="line">  <span class="attr">selector:</span>             <span class="comment"># 选择器</span></span><br><span class="line">    <span class="attr">matchLabels:</span>        <span class="comment"># 匹配标签</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">cango-demo</span></span><br><span class="line">      <span class="attr">version:</span> <span class="string">stable</span>      </span><br><span class="line">  <span class="attr">template:</span>             <span class="comment"># 定义容器模板，该模板可以包含多个容器       </span></span><br><span class="line">    <span class="attr">metadata:</span>           <span class="comment"># 资源的元数据/属性</span></span><br><span class="line">      <span class="attr">labels:</span>           <span class="comment"># 设定资源的标签</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">cango-demo</span> <span class="comment"># 模板名称必填</span></span><br><span class="line">    <span class="attr">sepc:</span>               <span class="comment"># 资源规范字段</span></span><br><span class="line">      <span class="attr">containers:</span>                                                                   </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cango-demo</span>                                                           <span class="comment"># 镜像名称</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">swr.cn-east-2.myhuaweicloud.com/cango-prd/cango-demo:0.0.1-SNAPSHOT</span> <span class="comment"># 镜像地址</span></span><br><span class="line">          <span class="attr">command:</span> [ <span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;cat /etc/config/path/to/special-key&quot;</span> ]    <span class="comment"># 启动命令</span></span><br><span class="line">          <span class="attr">args:</span>                                                                <span class="comment"># 启动参数</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-storage.local.retention=$(STORAGE_RETENTION)&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-storage.local.memory-chunks=$(STORAGE_MEMORY_CHUNKS)&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-config.file=/etc/prometheus/prometheus.yml&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-alertmanager.url=http://alertmanager:9093/alertmanager&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-web.external-url=$(EXTERNAL_URL)&#x27;</span></span><br><span class="line">            <span class="comment"># 如果command和args均没有写，那么用Docker默认的配置。</span></span><br><span class="line">            <span class="comment"># 如果command写了，但args没有写，那么Docker默认的配置会被忽略而且仅仅执行.yaml文件的command（不带任何参数的）。</span></span><br><span class="line">            <span class="comment"># 如果command没写，但args写了，那么Docker默认配置的ENTRYPOINT的命令行会被执行，但是调用的参数是.yaml中的args。</span></span><br><span class="line">            <span class="comment"># 如果如果command和args都写了，那么Docker默认的配置被忽略，使用.yaml的配置。</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>  <span class="comment"># 如果不存在则拉取</span></span><br><span class="line">          <span class="comment"># livenessProbe: pod 内部健康检查的设置 &gt;&gt; 表示container是否处于live状态。如果LivenessProbe失败，LivenessProbe将会通知kubelet对应的container不健康了。</span></span><br><span class="line">          <span class="comment"># 随后kubelet将kill掉container，并根据RestarPolicy进行进一步的操作。默认情况下LivenessProbe在第一次检测之前初始化值为Success，</span></span><br><span class="line">          <span class="comment"># 如果container没有提供LivenessProbe，则也认为是Success；          </span></span><br><span class="line">          <span class="attr">livenessProbe:</span>        </span><br><span class="line">            <span class="attr">httpGet:</span>            <span class="comment"># 通过httpget检查健康，返回200-399之间，则认为容器正常</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/health</span>     <span class="comment"># 如果没有心跳检测接口就为 /</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">60</span> <span class="comment"># 启动后延时多久开始运行检测</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span>       <span class="comment"># 检测的超时时间</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span>     <span class="comment"># 成功门槛</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">5</span>     <span class="comment"># 失败门槛，连接失败5次，pod杀掉，重启一个新的pod</span></span><br><span class="line">            <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">readinessProbe:</span>           <span class="comment"># Pod 准备服务健康检查设置</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/health</span>         <span class="comment"># 如果没有心跳检测接口就为 /</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span> <span class="comment">##启动后延时多久开始运行检测</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">resources:</span>              <span class="comment"># CPU内存限制</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2048Mi</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">2048Mi</span></span><br><span class="line">          <span class="attr">env:</span>                      <span class="comment"># 通过环境变量的方式，直接传递pod=自定义Linux OS环境变量</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LOCAL_KEY</span>       <span class="comment"># 本地Key</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">value</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CONFIG_MAP_KEY</span>  <span class="comment"># 局策略可使用configMap的配置Key，</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">special-config</span>   <span class="comment">#configmap中找到name为special-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">special.type</span>      <span class="comment">#找到name为special-config里data下的key</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">80</span> <span class="comment"># 对 service暴露端口</span></span><br><span class="line">          <span class="attr">volumeMounts:</span>     <span class="comment">#挂载volumes中定义的磁盘[持久存储卷]</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">log-cache</span></span><br><span class="line">            <span class="attr">mount:</span> <span class="string">/tmp/log</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sdb</span>       <span class="comment">#普通用法，该卷跟随容器销毁，挂载一个目录</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/data/media</span>    </span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span>    <span class="comment">#直接挂载硬盘方法，如挂载下面的nfs目录到/mnt/nfs</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/mnt/nfs</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">example-volume-config</span>  <span class="comment">#高级用法第1种，将ConfigMap的log-script,backup-script分别挂载到/etc/config目录下的一个相对路径path/to/...下，如果存在同名文件，直接覆盖。</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/etc/config</span>       </span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rbd-pvc</span>                <span class="comment">#高级用法第2中，挂载PVC(PresistentVolumeClaim)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 使用volume将ConfigMap作为文件或目录直接挂载，其中每一个key-value键值对都会生成一个文件，key为文件名，value为内容，</span></span><br><span class="line">  <span class="attr">volumes:</span>  <span class="comment"># 定义磁盘给上面volumeMounts挂载 [数据卷定义]</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">log-cache</span>  <span class="comment"># 数据的名称，该名称要与volumeMounts中的name值保持一致</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sdb</span>  <span class="comment">#挂载宿主机上面的目录</span></span><br><span class="line">    <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/any/path/it/will/be/replaced</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">example-volume-config</span>  <span class="comment"># 供ConfigMap文件内容到指定路径使用</span></span><br><span class="line">    <span class="attr">configMap:</span>                     <span class="comment"># 数据来源于configMap</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">example-volume-config</span>  <span class="comment"># configMap的名称与上述创建的configMap中的name保持一致</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">log-script</span>            <span class="comment"># 对应configMap中data下面的key值</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">path/to/log-script</span>   <span class="comment"># 把key对应的值放入到path对应的文件中，进入pod中查看其实是链接【指定目录下的一个相对路径path/to/log-script】</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">backup-script</span>         <span class="comment"># ConfigMap中的Key</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">path/to/backup-script</span>  <span class="comment"># 指定目录下的一个相对路径path/to/backup-script</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span>          <span class="comment"># 供挂载NFS存储类型</span></span><br><span class="line">    <span class="attr">nfs:</span></span><br><span class="line">      <span class="attr">server:</span> <span class="number">10.42</span><span class="number">.0</span><span class="number">.55</span>          <span class="comment">#NFS服务器地址</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/opt/public</span>           <span class="comment">#showmount -e 看一下路径</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rbd-pvc</span>                 <span class="comment">#挂载PVC磁盘</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">rbd-pvc1</span>         <span class="comment">#挂载已经申请的pvc磁盘</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> K8S集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> K8S 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Light K8S集群</title>
      <link href="/posts/6603f430.html"/>
      <url>/posts/6603f430.html</url>
      
        <content type="html"><![CDATA[<h2 id="minikube">minikube</h2><ul><li>单机版的Kubernetes集群</li><li>访问master</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh</span> docker@<span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.x</span><br><span class="line"><span class="attribute">tcuser</span></span><br></pre></td></tr></table></figure><h2 id="traefik">traefik</h2><ul><li>反向代理工具</li></ul><h2 id="harbor">harbor</h2><ul><li>镜像仓库</li><li>damon.json 添加如下配置</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;http://f1361db2.m.daocloud.io&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;192.168.1.101:31000&quot;</span>,</span><br><span class="line">  <span class="string">&quot;192.168.1.12:30000&quot;</span>,</span><br><span class="line">  <span class="string">&quot;192.168.1.20:30000&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="Rancher">Rancher</h2><ul><li>开源的企业级 <strong>容器管理平台</strong></li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -itd --restart=unless-stopped --name=rancher \</span><br><span class="line"> -p <span class="number">8090</span>:<span class="number">80</span> -p <span class="number">8443</span>:<span class="number">443</span> \</span><br><span class="line"> -v <span class="regexp">/Users/</span><span class="number">9</span>sdata<span class="regexp">/lijiahao_workspace/</span>docker-workspace<span class="regexp">/rancher/</span>data:<span class="regexp">/var/</span>lib/rancher \</span><br><span class="line"> rancher/rancher:latest</span><br></pre></td></tr></table></figure><ul><li><a href="https://www.jianshu.com/p/3a492440c89b">link</a></li><li><a href="https://zhuanlan.zhihu.com/p/112755080">link</a></li></ul><h2 id="k8s">k8s</h2><blockquote><p>Pod</p></blockquote><ul><li>最终的应用部署实体</li></ul><blockquote><p>Service</p></blockquote><ul><li>一个网络下的Pod集合。Service 使用 selector labels 标签来选择代理的Pod</li><li>类似 Nginx 做负载均衡提供统一网络入口</li></ul><blockquote><p>Deployment</p></blockquote><ul><li>deployment 作用于一组pods的创建和运行</li><li>负责创建和保持Pod运行状态</li></ul><blockquote><p>k8s configMap</p></blockquote><ul><li>一种标准资源，专门用来集中管理应用的配置</li></ul>  <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">缺点：</span><br><span class="line"><span class="bullet">1.</span> 配置需要 运维和开发 协同完成</span><br><span class="line"><span class="bullet">2.</span> 无 web-ui 访问界面，只能通过 kubectl 指令 编辑查看</span><br></pre></td></tr></table></figure><h3 id="Prometheus">Prometheus</h3><ul><li>分布式监控系统</li></ul><h3 id="配置中心">配置中心</h3><ul><li>k8s configMap</li><li>Apollo</li><li>自定义</li></ul>]]></content>
      
      
      <categories>
          
          <category> K8S集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> K8S 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>service.yaml</title>
      <link href="/posts/e0c0d417.html"/>
      <url>/posts/e0c0d417.html</url>
      
        <content type="html"><![CDATA[<h3 id="service-yaml">service.yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> <span class="comment"># 指定api版本，此值必须在kubectl api-versions中 </span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> <span class="comment"># 指定创建资源的角色/类型 </span></span><br><span class="line"><span class="attr">metadata:</span> <span class="comment"># 资源的元数据/属性</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cango-demo</span>  <span class="comment"># 资源的名字，在同一个namespace中必须唯一</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span> <span class="comment"># 部署在哪个namespace中</span></span><br><span class="line">  <span class="attr">labels:</span> <span class="comment"># 设定资源的标签</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">cango-demo</span></span><br><span class="line"><span class="attr">spec:</span> <span class="comment"># 资源规范字段</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span>      <span class="comment"># Make the service available to network requests from external clients   </span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>        <span class="comment"># service 端口</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span>  <span class="comment"># 容器暴露的端口</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31055</span> <span class="comment"># 容器对外访问的端口</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span> <span class="comment"># 协议</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">http</span> <span class="comment"># 端口名称</span></span><br><span class="line">  <span class="attr">selector:</span>           </span><br><span class="line">    <span class="attr">app:</span> <span class="string">cango-demo</span>   <span class="comment"># Forward requests to pods with label of this.value</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解说：</span></span><br><span class="line"><span class="comment"># ClusterIP：此服务仅能在k8s集群内访问</span></span><br><span class="line"><span class="comment"># NodePort: 节点端口，可以让service接收来自k8s集群外的请求</span></span><br><span class="line"><span class="comment"># LoadBalancer: </span></span><br><span class="line"><span class="comment"># ExternalName:</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> K8S集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> K8S 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>K8S部署</title>
      <link href="/posts/69a04704.html"/>
      <url>/posts/69a04704.html</url>
      
        <content type="html"><![CDATA[<p>删除harbor原有镜像，推送镜像至harbor。<br>1.docker  tag  nginx:1.16   192.168.1.103:31000/nginx/nginx.web:latest</p><p>nginx:1.16     docker镜像：docker镜像版本<br>192.168.1.103:31000/nginx/nginx.web:latest     仓库地址/项目名称/镜像名称</p><p>2.docker  push     192.168.1.103:31000/nginx/nginx.web:latest</p><p>k8s集群应用服务部署<br>查看pod状态： kubectl   get pod  -o wide （显示所在的node节点）<br>查看svc状态： kubectl  get svc  -o  wide  (显示对内外访问的端口)<br>查看ingress状态： kubectl  get ing -o wide<br>查看traefikroute：   kubectl  get ingressroute<br>查看traefik拆头：kubectl  get  middleware</p><p>1.删除服务：<br>kubectl delete -f   deploy.yaml</p><p>2.删除宿主机本地docker镜像，释放空间，拉取最新镜像[查看镜像所在节点]。<br>kubectl   get pod  -o wide  # eg: document 镜像所在节点: 192.168.1.101<br>docker rmi document</p><p>3.创建\更新服务<br>kubectl  create -f  deploy.yaml \ kubectl  apply -f  deploy.yaml</p><h2 id="configMap">configMap</h2><p>kubectl create cm cm-test-file --from-file=test.yaml     [创建configMap]<br>kubectl get cm                     [查看configmap列表]<br>kubectl describe cm  cm-test            [查看configmap详情]<br>kubectl edit cm cm-test               [更新configMap]<br>kubectl delete cm cm-test             [删除configMap]</p><h2 id="nfs-服务">nfs 服务</h2><pre><code>启动systemctl enable nfs重启systemctl reload nfs配置共享目录mkdir /home/datas &amp;&amp; echo '/home/datas/  192.168.1.0/24(rw,no_root_squash)' &gt;&gt; /etc/exports &amp;&amp;systemctl reload nfs &amp;&amp;showmount -e查看nfs服务器共享信息showmount -e 192.168.1.103 查看 nfs 服务状态serive nfs status</code></pre><p>备注<br>traefik 服务部署 [11、12、101] 主机上<br>nfs 服务部署 [192.168.1.103] 主机上</p><p>查看命名空间</p><h1>kubectl get namespaces</h1><p>创建命名空间</p><ul><li>vim es-test-namespace.yaml</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">apiVersion:</span> v1</span><br><span class="line"><span class="symbol">kind:</span> Namespace</span><br><span class="line"><span class="symbol">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> es-test</span><br></pre></td></tr></table></figure><ul><li>kubectl apply -f es-test-namespace.yaml</li></ul><p>为Pod指定命名空间</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apiVersion</span><span class="punctuation">:</span> <span class="string">v1</span></span><br><span class="line"><span class="attribute">kind</span><span class="punctuation">:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attribute">metadata</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">es-test</span></span><br><span class="line"><span class="attribute">spce</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">containers</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">image: elasticsearch:8.1.1</span></span><br><span class="line">    <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">elastic_search</span></span><br></pre></td></tr></table></figure><p>查看指定namespace中的对象</p><h1>kubectl get pods --namespace=es-test</h1>]]></content>
      
      
      <categories>
          
          <category> K8S集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> K8S 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cursor</title>
      <link href="/posts/e0db4a7f.html"/>
      <url>/posts/e0db4a7f.html</url>
      
        <content type="html"><![CDATA[<h3 id="cursor">cursor</h3><ol><li></li><li>代码分析能力</li><li></li></ol>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ChatGPT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ChatGPT JS API</title>
      <link href="/posts/e0db4a7f.html"/>
      <url>/posts/e0db4a7f.html</url>
      
        <content type="html"><![CDATA[<p>补全接口示例</p><ol><li>请求方式: Post</li><li>url: <a href="https://api.openai.com/v1/completions">api.openai.com…</a></li><li>请求体 (json)</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;model&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text-davinci-003&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;prompt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Say this is a test&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;max_tokens&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;temperature&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;top_p&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;n&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;stream&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol start="4"><li>接口文档: <a href="https://platform.openai.com/docs/api-reference/completions/create">platform.openai.com/docs/api-re…</a></li></ol><p><strong>请求参数解析</strong><br><img src="./images/req-param.png" alt="请求参数"></p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ChatGPT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go-View 源码解读</title>
      <link href="/posts/ada44257.html"/>
      <url>/posts/ada44257.html</url>
      
        <content type="html"><![CDATA[<h2 id="go-view-源码解读"><a href="mtruning.club/guide/design/directory.html">go-view</a> 源码解读</h2><h3 id="左侧菜单栏数据格式">左侧菜单栏数据格式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  eg: 以胶囊柱图为例</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">charts</span>: [</span><br><span class="line">    &#123; </span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;CapsuleChart&#x27;</span>,</span><br><span class="line">      <span class="attr">chartKey</span>: <span class="string">&#x27;VCapsuleChart&#x27;</span>,</span><br><span class="line">      <span class="attr">conKey</span>: <span class="string">&#x27;VCCapsuleChart&#x27;</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;胶囊柱图&#x27;</span>,</span><br><span class="line">      <span class="attr">category</span>: <span class="string">&#x27;Bars&#x27;</span>,</span><br><span class="line">      <span class="attr">categoryName</span>: <span class="string">&#x27;柱状图&#x27;</span>,</span><br><span class="line">      <span class="attr">package</span>: <span class="string">&#x27;Charts&#x27;</span>,</span><br><span class="line">      <span class="attr">chartFrame</span>: <span class="string">&#x27;common&#x27;</span>,</span><br><span class="line">      <span class="attr">image</span>: <span class="string">&#x27;capsule.png&#x27;</span>      </span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="以dbClick-为例">以dbClick 为例</h3><ul><li>动态注册图表组件、图表配置组件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入图表组件及配置组件并通过key进行筛选</span></span><br><span class="line"><span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">globEager</span>(<span class="string">&#x27;./components/**/index.vue&#x27;</span>)</span><br><span class="line"><span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">globEager</span>(<span class="string">&#x27;./components/**/config.vue&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将导入的组件注册至vue实例上</span></span><br><span class="line"><span class="variable language_">window</span>[<span class="string">&#x27;$vue&#x27;</span>].<span class="title function_">component</span>(chartKey, domNode)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>初始化选中组件的配置信息、存储全局组件配置信息（chartEditStore）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取配置</span></span><br><span class="line"><span class="title class_">ChartConfigInstance</span> = <span class="keyword">import</span>(<span class="string">`./components/<span class="subst">$&#123;package&#125;</span>/<span class="subst">$&#123;category&#125;</span>/<span class="subst">$&#123;key&#125;</span>/config.ts`</span>)</span><br><span class="line"><span class="keyword">const</span> defaultChartConfig = <span class="keyword">new</span> <span class="title class_">ChartConfigInstance</span>.<span class="title function_">default</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储配置</span></span><br><span class="line">chartEditStore.<span class="title function_">addComponentList</span>(defaultChartConfig, <span class="literal">false</span>, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><ul><li>设置画布选中的图表（每个组件唯一标识）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// newComponent.id </span></span><br><span class="line"><span class="comment">//   = Number(Math.random().toString().substring(2, 10) + Date.now()).toString(36)</span></span><br><span class="line">chartEditStore.<span class="title function_">setTargetSelectChart</span>(newComponent.<span class="property">id</span>)</span><br></pre></td></tr></table></figure><h3 id="画布逻辑梳理">画布逻辑梳理</h3><blockquote><p>ContentBox 布局容器</p></blockquote><p><strong><a href="https://www.npmjs.com/package/vue3-sketch-ruler">vue3-sketch-ruler</a></strong></p><ul><li><p>作为低代码平台操作页面缩放工具</p><ul><li>大屏可视化</li><li>做图工具</li></ul></li><li><p>遍历渲染全局组件列表</p></li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件自身数据格式</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">chartConfig</span>: &#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">chartKey</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">conKey</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">title</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">category</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">categoryName</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">package</span>: <span class="built_in">string</span></span><br><span class="line">    chartFrame?: <span class="title class_">ChartFrameEnum</span></span><br><span class="line">    <span class="attr">image</span>: <span class="built_in">string</span>    </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">option</span>: &#123;</span><br><span class="line">    dataset?: <span class="built_in">any</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">xAxis</span>: <span class="built_in">any</span>;</span><br><span class="line">    <span class="attr">yAxis</span>: <span class="built_in">any</span>;</span><br><span class="line">    <span class="attr">legend</span>: <span class="built_in">any</span>;</span><br><span class="line">    <span class="attr">grid</span>: <span class="built_in">any</span>;</span><br><span class="line">    [<span class="attr">T</span>:<span class="built_in">string</span>]: <span class="built_in">any</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">attr</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">styles</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">preview</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">status</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">request</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">filter</span>: <span class="built_in">any</span>;</span><br><span class="line">  <span class="attr">events</span>: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="预览-从本地-localStorage-获取存储数据">预览: 从本地 localStorage 获取存储数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">StorageEnum</span>.<span class="property">GO_CHART_STORAGE_LIST</span></span><br></pre></td></tr></table></figure><h3 id="localStorage-存储如下信息">localStorage 存储如下信息</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GO_LOGIN_INFO</span></span><br><span class="line"><span class="variable constant_">GO_DESIGN</span></span><br><span class="line"><span class="variable constant_">GO_CHART_LAYOUT</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">GO_CHART_STORAGE_LIST</span></span><br><span class="line"><span class="comment">// 格式: &#123; id, editCanvasConfig, componentList, requestGlobalConfig &#125;</span></span><br></pre></td></tr></table></figure><p>疑问?</p><ol><li>切换组件后，上个组件的数据如何存储的？</li></ol><ul><li>已在全局store存储了该组件及相关配置信息</li></ul><h3 id="import-meta">import.meta</h3><blockquote></blockquote><ul><li>环境变量获取</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span></span><br></pre></td></tr></table></figure><ul><li>批量处理文件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取当前目录下的所有 .ts文件</span></span><br><span class="line"><span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">globEager</span>(<span class="string">&#x27;./**/*.ts&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 可视化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go-View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MapboxGL expressions</title>
      <link href="/posts/3cf958fb.html"/>
      <url>/posts/3cf958fb.html</url>
      
        <content type="html"><![CDATA[<h1>mapbox 表达式</h1><h2 id="目录">目录</h2><h2 id="表达式语法和概念">表达式语法和概念</h2><p>可以将任何layout属性，paint属性或filter的值指定为表达式。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[表达式运算符, 参数1, 参数2, ...]</span></span><br></pre></td></tr></table></figure><p>参数的值类型：字符串，数字，布尔值，或者另一个表达式数组，null。</p><p>也就是说表达式可以嵌套。也就是组合表达式：<br>例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//g</span>eojson 的 features 参数</span><br><span class="line"><span class="string">&quot;features&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Feature&quot;</span>,</span><br><span class="line">        <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;点1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;desc&quot;</span>:<span class="string">&quot;这是点1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;radius&quot;</span>: <span class="number">10</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;geometry&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Point&quot;</span>,</span><br><span class="line">          <span class="string">&quot;coordinates&quot;</span>: [</span><br><span class="line">            <span class="number">108.9902114868164</span>,</span><br><span class="line">            <span class="number">34.24813554589752</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 根据geojson中 radius 的值来确定圆的半径</span><br><span class="line"><span class="string">&quot;circle-radius&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;interpolate&quot;</span>, [<span class="string">&quot;linear&quot;</span>], [<span class="string">&quot;zoom&quot;</span>],</span><br><span class="line">    <span class="regexp">//</span>zoom为 <span class="number">0</span>，半径为radius的值</span><br><span class="line">    <span class="number">0</span>, [<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;radius&#x27;</span>],</span><br><span class="line">    <span class="regexp">//</span>zoom为 <span class="number">10</span>，半径为radius的值，zoom为<span class="number">0</span>-<span class="number">10</span>是按照linear 线性增加。</span><br><span class="line">    <span class="number">10</span>, [<span class="string">&#x27;*&#x27;</span>, [<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;radius&#x27;</span>], <span class="number">10</span>]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="表达式类型系统">表达式类型系统</h2><h3 id="1-下面这段话很重呀，需要仔细阅读"><code>1.下面这段话很重呀，需要仔细阅读</code></h3><p>表达式输入参数和输出结果的类型：boolean,color,string,number,array。来源于 style 规范中的 Types，<br>表达式的每次使用都具有已知的结果类型和必需的参数类型，并且SDK会验证表达式的结果类型是否适合使用该表达式的上下文，例如，filter属性中表达式的结果类型必须为boolean，+运算符的参数必须为number。</p><p>使用要素数据时，SDK通常不会提前知道要素属性值的类型。为了保持类型安全，在评估数据表达式时，SDK将检查属性值是否适合上下文。例如，如果您[“get”, “feature-color”]对circle-color属性使用表达式，则SDK将验证feature-color每个功能的值是否是标识有效color的字符串。如果此检查失败，将以特定于SDK的方式指示错误（通常是一条日志消息），并且将使用该属性的默认值。</p><p>在大多数情况下，此验证将在需要的任何地方自动进行。但是，在某些情况下，SDK可能无法根据周围环境自动确定数据表达式的预期结果类型。例如，不清楚表达式[“&lt;”, [“get”, “a”], [“get”, “b”]]是要比较字符串还是数字。在这种情况下，可以使用类型断言表达式运算符之一来指示数据表达式的预期类型：[“&lt;”, [“number”, [“get”, “a”]], [“number”, [“get”, “b”]]]。类型声明检查特征数据是否确实与数据表达式的预期类型匹配。如果此检查失败，则会产生错误，并使整个表达式恢复为所定义属性的默认值。断言运营商array，boolean，number，和string。</p><p>表达式仅执行一种隐式类型转换：在期望颜色的上下文中使用的数据表达式会将颜色的字符串表示形式转换为颜色值。在其他情况下，如果你想类型之间的转换，你必须使用一个类型转换表达式运算符：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">to</span>-<span class="built_in">boolean</span>: 返回 <span class="built_in">boolean</span></span><br><span class="line"><span class="keyword">to</span>-<span class="built_in">number</span>: 返回 <span class="built_in">number</span></span><br><span class="line"><span class="keyword">to</span>-<span class="built_in">string</span>: 返回 <span class="built_in">string</span></span><br><span class="line"><span class="keyword">to</span>-color: 返回 color</span><br></pre></td></tr></table></figure><p>例如，如果您具有一个功能属性，该属性以字符串格式存储数字值，并且您希望将这些值用作数字而不是字符串，则可以使用诸如的表达式[“to-number”, [“get”, “property-name”]]。</p><p>例如对数据中的字符串类型，转换成数字类型：</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//circle-radius: 的值期望是 number,所以字符串类型会报错</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;circle-radius&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;interpolate&quot;</span>,[<span class="string">&quot;linear&quot;</span>],[<span class="string">&quot;zoom&quot;</span>],</span><br><span class="line">    <span class="number">0</span>, [<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;radius&#x27;</span>],</span><br><span class="line">    <span class="number">10</span>, <span class="string">&#x27;*&#x27;</span>, [<span class="string">&quot;to-number&quot;</span>, [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;id&quot;</span>]], <span class="number">10</span>]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="2-断言"><code>2.断言:</code></h3><p>判断输入值是不是属于某种类型</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>判断输入值value是一个数组</span><br><span class="line">[<span class="string">&quot;array&quot;</span>, value]: 返回array</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>判断输入值value是一个布尔值</span><br><span class="line">[<span class="string">&quot;boolean&quot;</span>, value]: 返回boolean</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>判断输入值value是一个数字</span><br><span class="line">[<span class="string">&quot;number&quot;</span>, value]: number</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>判断输入值value是一个对象</span><br><span class="line">[<span class="string">&quot;object&quot;</span>, value]: object</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>判断输入值value是一个字符串</span><br><span class="line">[<span class="string">&quot;string&quot;</span>, value]: string</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>以上输入多个value，会按顺序比较，知道返回第一个满足的value，如果都不满足，返回false或者报错</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span></span><br></pre></td></tr></table></figure><ol><li>collator</li></ol><p>返回一个collator，用于与语言环境相关的比较操作。在case-sensitive和diacritic-sensitive选项默认为false。该locale参数指定要使用的语言环境的IETF语言标记。如果未提供，则使用默认语言环境。如果请求的语言环境不可用，collator则将使用系统定义的后备语言环境。使用resolved-locale测试的现场备用行为的结果。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;collator&quot;</span>,</span><br><span class="line">    &#123; <span class="string">&quot;case-sensitive&quot;</span>: <span class="built_in">boolean</span>, <span class="string">&quot;diacritic-sensitive&quot;</span>: <span class="built_in">boolean</span>, <span class="string">&quot;locale&quot;</span>: <span class="built_in">string</span> &#125;</span><br><span class="line">]: collator</span><br></pre></td></tr></table></figure><ol start="2"><li>literal</li></ol><p>提供文字数组或对象值。</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;literal&quot;</span>, [...] (<span class="type">JSON</span> <span class="type">array</span> literal)]: <span class="type">array</span>&lt;T, N&gt;</span><br><span class="line">[<span class="string">&quot;literal&quot;</span>, <span class="meta">&#123;...&#125;</span> (<span class="type">JSON</span> <span class="keyword">object</span> literal)]: <span class="type">Object</span></span><br></pre></td></tr></table></figure><ol start="3"><li>format</li></ol><p>返回formatted包含用于混合格式text-field条目的注释的文本。如果设置，则text-font参数将覆盖由根布局属性指定的字体。如果设置，则font-scale参数指定相对于text-size根布局属性中指定的比例因子。</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[</span><span class="string">&quot;format&quot;</span>,</span><br><span class="line">    input_1: <span class="built_in">string</span>, options_1: &#123; <span class="string">&quot;font-scale&quot;</span>: number, <span class="string">&quot;text-font&quot;</span>: <span class="built_in">array</span>&lt;<span class="built_in">string</span>&gt; &#125;,</span><br><span class="line">    <span class="params">...</span>,</span><br><span class="line">    input_n: <span class="built_in">string</span>, options_n: &#123; <span class="string">&quot;font-scale&quot;</span>: number, <span class="string">&quot;text-font&quot;</span>: <span class="built_in">array</span>&lt;<span class="built_in">string</span>&gt; &#125;</span><br><span class="line"><span class="meta">]</span>: formatted</span><br></pre></td></tr></table></figure><h3 id="3-表达式类型转换"><code>3.表达式类型转换</code></h3><ol><li>转布尔值boolean</li></ol><p>将输入值转换为布尔值。当输入是空字符串，0 ，false，null 或 NaN,结果是false. 否则是true。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;to-boolean&quot;, value</span>]: <span class="link">boolean</span></span><br></pre></td></tr></table></figure><ol start="2"><li>转为颜色color</li></ol><p>将输入值转换为颜色。如果提供了多个值，则会依次评估每个值，直到获得第一个成功的转换为止。如果没有任何输入可以转换，则该表达式为错误。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;to-color&quot;, value, fallback: value, fallback: value, ...</span>]: <span class="link">color</span></span><br></pre></td></tr></table></figure><ol start="3"><li>转数字number</li></ol><p>将输入值转换为数字。</p><ul><li>如果输入为null或false，结果为0。</li><li>如果输入为true，结果为1。</li><li>如果输入为字符串，则将按照<a href="https://tc39.es/ecma262/#sec-tonumber-applied-to-the-string-type">ECMAScript中“字符串转Number规则”</a>中指定的语言规范执行。</li><li>如果提供了多个值，则会依次评估每个值，直到获得第一个成功的转换为止。</li><li>如果没有任何输入可以转换，则该表达式为错误。</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;to-number&quot;, value, fallback: value, fallback: value, ...</span>]: <span class="link">number</span></span><br></pre></td></tr></table></figure><ol start="4"><li>转字符串string</li></ol><p>将输入值转换为字符串。</p><ul><li>如果输入为null，则结果为&quot;&quot;。</li><li>如果输入为布尔值，则结果为&quot;true&quot;或&quot;false&quot;。</li><li>如果输入是数字，则将其转换为<a href="https://tc39.es/ecma262/#sec-tostring-applied-to-the-number-type">ECMAScript语言规范的“ NumberToString”</a>算法指定的字符串。</li><li>如果输入是彩色，它被转换为以下形式的串&quot;rgba(r,g,b,a)&quot;，其中r，g和b是数字范围从0到255，和a范围为0〜1。</li><li>其他，按照<a href="https://tc39.es/ecma262/#sec-json.stringify">JSON.stringifyECMAScript语言规范</a>的功能执行。</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;to-string&quot;, value</span>]: <span class="link">string</span></span><br></pre></td></tr></table></figure><ol start="4"><li>类型判断typeof</li></ol><p>返回描述给定值类型的字符串。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;typeof&quot;, value</span>]: <span class="link">string</span></span><br></pre></td></tr></table></figure><h3 id="特征数据-Feature-data">特征数据 Feature data</h3><ol><li>accumulated</li></ol><p>获取到目前为止累积的集群属性的值。只能在clusterProperties集群化GeoJSON源的选项中使用。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;accumulated&quot;</span>]: <span class="link">value</span></span><br></pre></td></tr></table></figure><ol start="2"><li>feature-state</li></ol><p>从当前要素的状态检索属性值。如果请求的属性不在功能状态上，则返回null。要素的状态不是GeoJSON或矢量切片数据的一部分，必须在每个要素上以编程方式设置。请注意，[“ feature-state”] 仅可与支持数据驱动样式的绘画属性一起使用。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;feature-state&quot;, string</span>]: <span class="link">value</span></span><br></pre></td></tr></table></figure><ol start="3"><li>geometry-type</li></ol><p>获取要素的几何类型：（点，多点，线串，多线串，多边形，多多边形）。<br>Point, MultiPoint, LineString, MultiLineString, Polygon, MultiPolygon.</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;geometry-type&quot;</span>]: <span class="link">string</span></span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">layout:&#123;</span><br><span class="line">    <span class="string">&quot;text-field&quot;</span>: [<span class="string">&quot;geometry-type&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="regexp">//</span>获取的值是 Point</span><br></pre></td></tr></table></figure><ol start="4"><li>id</li></ol><p>获取功能的ID（如果有的话）。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;id&quot;</span>]: <span class="link">value</span></span><br></pre></td></tr></table></figure><ol start="5"><li>line-progress</li></ol><p>沿渐变线获取进度。只能在line-gradient属性中使用。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;line-progress&quot;</span>]: <span class="link">number</span></span><br></pre></td></tr></table></figure><ol start="6"><li>properties</li></ol><p>获取要素属性对象。请注意，在某些情况下，直接使用[“ get”，“ property_name”] 可能更有效。<br>例如获取的是properties的整个对象</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;properties&quot;</span>]: <span class="link">object</span></span><br></pre></td></tr></table></figure><h3 id="Lookup">Lookup</h3><ol><li>at</li></ol><p>从数组中检索一个项目。<br>number,在不在数组中</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;at&quot;</span>, <span class="built_in">number</span>, <span class="built_in">array</span>]: ItemType</span><br></pre></td></tr></table></figure><ol start="2"><li>get</li></ol><p>从当前要素的feature’s properties 中 或从 另一个对象（如果提供了第二个自变量）中检索属性值。如果缺少所请求的属性，则返回null。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;get&quot;, string</span>]: <span class="link">value</span></span><br><span class="line"></span><br><span class="line">[<span class="symbol">&quot;get&quot;, string, object</span>]: <span class="link">value</span></span><br></pre></td></tr></table></figure><ol start="3"><li>has</li></ol><p>测试当前要素feature’s properties中是否存在某个属性值；如果提供了第二个参数，则从另一个对象中进行测试。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;has&quot;</span>, <span class="keyword">string</span>]: <span class="keyword">boolean</span></span><br><span class="line">[<span class="string">&quot;has&quot;</span>, <span class="keyword">string</span>, <span class="keyword">object</span>]: <span class="keyword">boolean</span></span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 判断properties对象中是否有<span class="built_in"> id</span> 属性，度过有返<span class="built_in">回true</span>，否则返<span class="built_in">回false</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">filter</span>:[<span class="string">&quot;has&quot;</span>, <span class="string">&#x27;id&#x27;</span>]</span><br></pre></td></tr></table></figure><ol start="4"><li>length</li></ol><p>获取数组或字符串的长度。</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;length&quot;</span>, string |<span class="built_in"> array </span>| value]: number</span><br></pre></td></tr></table></figure><h3 id="判断">判断</h3><p>本节中的表达式可用于将条件逻辑添加到样式中。例如，'case’表达式提供基本的“ if / then / else”逻辑，还有’match’允许您将输入表达式的特定值映射到不同的输出表达式。</p><ol><li><code>! 逻辑非</code></li></ol><p>逻辑否定。true如果输入为false，false则返回true。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;!&quot;</span>, <span class="built_in">boolean</span>]: <span class="built_in">boolean</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>!= 不等于</code></li></ol><p>true如果输入值不相等，false则返回，否则返回。比较是严格类型化的：不同运行时类型的值始终被认为是不相等的。在解析时已知类型不同的情况将被视为无效，并会产生解析错误。接受一个可选collator参数来控制与语言环境有关的字符串比较。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;!=&quot;, value, value</span>]: <span class="link">boolean</span></span><br><span class="line">[<span class="symbol">&quot;!=&quot;, value, value, collator</span>]: <span class="link">boolean</span></span><br></pre></td></tr></table></figure><ol start="3"><li><code>&lt; 小于</code></li></ol><p>如果第一个输入严格小于第二个输入，则返回true，否则返回false。参数必须是字符串或数字。如果在求值过程中不满足，则表达式求值会产生错误。已知此约束在解析时不成立的情况被认为是有效的，并且会产生解析错误。接受一个可选collator参数来控制与语言环境有关的字符串比较。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;&lt;&quot;, value, value</span>]: <span class="link">boolean</span></span><br><span class="line">[<span class="symbol">&quot;&lt;&quot;, value, value, collator</span>]: <span class="link">boolean</span></span><br></pre></td></tr></table></figure><ol start="4"><li><code>&lt;= 小于等于(不大于)</code></li></ol><p>类似于上面的&lt;逻辑，等于或者小于</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;&lt;=&quot;, value, value</span>]: <span class="link">boolean</span></span><br><span class="line">[<span class="symbol">&quot;&lt;=&quot;, value, value, collator</span>]: <span class="link">boolean</span></span><br></pre></td></tr></table></figure><ol start="5"><li><code>== 等于比较</code></li></ol><p>比较是严格类型化的，不同运行时类型的值始终被认为是不相等的。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;==&quot;, value, value</span>]: <span class="link">boolean</span></span><br><span class="line">[<span class="symbol">&quot;==&quot;, value, value, collator</span>]: <span class="link">boolean</span></span><br></pre></td></tr></table></figure><ol start="6"><li><code>&gt; 大于</code></li></ol><p>第一个参数是否大于第二个参数</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;&gt;&quot;, value, value</span>]: <span class="link">boolean</span></span><br><span class="line">[<span class="symbol">&quot;&gt;&quot;, value, value, collator</span>]: <span class="link">boolean</span></span><br></pre></td></tr></table></figure><ol start="7"><li><code>&gt;= 大于等于(不小于)</code></li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;&gt;=&quot;, value, value</span>]: <span class="link">boolean</span></span><br><span class="line">[<span class="symbol">&quot;&gt;=&quot;, value, value, collator</span>]: <span class="link">boolean</span></span><br></pre></td></tr></table></figure><ol start="8"><li><code>all</code> 所有满足</li></ol><p>是有参数是否都为true，如果是返回true，如果有一个不是，则返回false</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;all&quot;</span>, <span class="built_in">boolean</span>, <span class="built_in">boolean</span>]: <span class="built_in">boolean</span></span><br><span class="line">[<span class="string">&quot;all&quot;</span>, <span class="built_in">boolean</span>, <span class="built_in">boolean</span>, ...]: <span class="built_in">boolean</span></span><br></pre></td></tr></table></figure><ol start="9"><li><code>any</code> 任一满足</li></ol><p>是有参数只要有一个为true，如果是返回true，如果全部为false，则返回false</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;any&quot;</span>, <span class="built_in">boolean</span>, <span class="built_in">boolean</span>]: <span class="built_in">boolean</span></span><br><span class="line">[<span class="string">&quot;any&quot;</span>, <span class="built_in">boolean</span>, <span class="built_in">boolean</span>, ...]: <span class="built_in">boolean</span></span><br></pre></td></tr></table></figure><ol start="10"><li><code>case</code> 条件<br>结果为第一个满足条件的输出吗，如果都不满足则为fallback。</li></ol><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[</span><span class="string">&quot;case&quot;</span>,</span><br><span class="line">    条件<span class="number">1</span>: <span class="built_in">boolean</span>, 输出: OutputType,</span><br><span class="line">    条件<span class="number">2</span>: <span class="built_in">boolean</span>, 输出: OutputType,</span><br><span class="line">    <span class="params">...</span>,</span><br><span class="line">    fallback: OutputType</span><br><span class="line"><span class="meta">]</span>: OutputType</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;circle-color&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;case&quot;</span>,</span><br><span class="line">    [<span class="string">&#x27;has&#x27;</span>,<span class="string">&#x27;ids&#x27;</span>], <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    [<span class="string">&#x27;has&#x27;</span>,<span class="string">&#x27;id&#x27;</span>], <span class="string">&#x27;yellow&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;blue&#x27;</span></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件返回值需要是一个boolean类型，相当于</span></span><br><span class="line"><span class="string">&quot;circle-color&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;case&quot;</span>,</span><br><span class="line">    <span class="literal">true</span>, <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="literal">false</span>, <span class="string">&#x27;yellow&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;blue&#x27;</span></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">//以上语句的的意思是，满足为red,不满足为yellow，都不满足(默认)为blue</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="11"><li><code>coalesce</code> 合并</li></ol><p>依次评估每个表达式，直到获得第一个非空值，然后返回该值。</p><ol start="12"><li><code>match</code> 匹配</li></ol><p>选择标签值与输入值匹配的输出，如果找不到匹配项，则选择回退值。输入可以是任何表达式（例如[“get”, “building_type”]）。每个标签label必须是：</p><ul><li>单个文字值；要么</li><li>文字值数组，其值必须是所有字符串或所有数字（例如[100, 101]或[“c”, “b”]）。如果数组中的任何值匹配，则输入匹配，类似于不推荐使用的&quot;in&quot;运算符。</li></ul><p>每个标签必须唯一。如果输入类型与标签类型不匹配，则结果将是后备值。</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;match&quot;</span>,</span><br><span class="line">    <span class="keyword">input</span>: InputType (number <span class="keyword">or</span> string),</span><br><span class="line">    <span class="keyword">label</span>: InputType | [InputType, InputType, ...], <span class="keyword">output</span>: OutputType,</span><br><span class="line">    <span class="keyword">label</span>: InputType | [InputType, InputType, ...], <span class="keyword">output</span>: OutputType,</span><br><span class="line">    ...,</span><br><span class="line">    fallback: OutputType</span><br><span class="line">]: OutputType</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;circle-color&quot;: [</span><br><span class="line">    <span class="string">&#x27;match&#x27;</span>, [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;点1&#x27;</span>, <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;点2&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>,</span><br><span class="line">    [<span class="string">&#x27;点3&#x27;</span>,<span class="string">&#x27;点4&#x27;</span>], <span class="string">&#x27;blue&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">//获取featur<span class="string">e&#x27;s properties 中的name值，根据name值匹配对应的颜色，默认是(没有匹配到）#fff , [&#x27;</span>点<span class="number">3</span><span class="string">&#x27;,&#x27;</span>点<span class="number">4</span><span class="string">&#x27;] 表示是label是可以是数组类型,</span></span><br></pre></td></tr></table></figure><h3 id="Ramps-scales-curves-倾斜，比例，曲线">Ramps, scales, curves 倾斜，比例，曲线</h3><ol><li>interpolate 插</li></ol><p>通过在成对的输入和输出值（“stops”）之间进行插值, 产生连续，平滑的结果。input可以是任何number表达式（例如，[“get”, “population”]）。stop_input必须是严格按升序排列的数字文字。输出类型必须是<code>number</code>，<code>array&lt;number&gt;</code>，或<code>color</code>。</p><p>interpolation 类型：</p><ul><li>[“linear”]：在两个止动点之间线性地插值，该插值刚好小于输入并且大于输入。</li><li>[“exponential”, base]：在停靠点之间小于输入并大于输入的位置按指数进行插值。base控制输出增加的速率：较高的值可使输出向范围的高端增加更多。值接近1时，输出线性增加。</li><li>[“cubic-bezier”, x1, y1, x2, y2]：使用给定控制点定义的三次贝塞尔曲线进行插值。</li></ul><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;interpolate&quot;</span>,</span><br><span class="line">    <span class="attr">interpolation</span>: [<span class="string">&quot;linear&quot;</span>] | [<span class="string">&quot;exponential&quot;</span>, base] | [<span class="string">&quot;cubic-bezier&quot;</span>, x1, y1, x2, y2 ],</span><br><span class="line">    <span class="attr">input</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">stop_input_1</span>: <span class="built_in">number</span>, <span class="attr">stop_output_1</span>: OutputType,</span><br><span class="line">    <span class="attr">stop_input_n</span>: <span class="built_in">number</span>, <span class="attr">stop_output_n</span>: OutputType, ...</span><br><span class="line">]: OutputType (<span class="built_in">number</span>, <span class="built_in">array</span>&lt;<span class="built_in">number</span>&gt;, or Color)</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;line-opacity&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;interpolate&quot;</span>, [<span class="string">&quot;linear&quot;</span>], [<span class="string">&quot;zoom&quot;</span>],</span><br><span class="line">    <span class="number">9</span>, <span class="number">0.8</span>,</span><br><span class="line">    <span class="number">15</span>, <span class="number">0.5</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">//当zoom 为<span class="number">9</span>的时候，透明度是<span class="number">0.8</span>，当zoom为<span class="number">15</span>的时候，透明度为<span class="number">0.5</span></span><br></pre></td></tr></table></figure><ol start="2"><li>interpolate-hcl</li></ol><p>同上，区别是返回的必须是hcl color颜色，</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;interpolate-hcl&quot;</span>,</span><br><span class="line"><span class="symbol">    interpolation:</span> [<span class="string">&quot;linear&quot;</span>] | [<span class="string">&quot;exponential&quot;</span>, base] | [<span class="string">&quot;cubic-bezier&quot;</span>, x1, y1, x2, y2 ],</span><br><span class="line"><span class="symbol">    input:</span> number,</span><br><span class="line"><span class="symbol">    stop_input_1:</span> number, stop_output_1: Color,</span><br><span class="line"><span class="symbol">    stop_input_n:</span> number, stop_output_n: Color, ...</span><br><span class="line">]: Color</span><br></pre></td></tr></table></figure><ol start="3"><li>interpolate-lab</li></ol><p>同上，区别是返回的必须是lab color颜色，</p><p>[“interpolate-lab”,<br>interpolation: [“linear”] | [“exponential”, base] | [“cubic-bezier”, x1, y1, x2, y2 ],<br>input: number,<br>stop_input_1: number, stop_output_1: Color,<br>stop_input_n: number, stop_output_n: Color, …<br>]: Color</p><ol start="2"><li>step</li></ol><p>相当于，获取input的值的结果，若在某个范围内，就给一个结果。</p><p>通过评估由成对的输入和输出值（“停止”）定义的分段常数函数，可以产生离散的步进结果。</p><ul><li>input可以是任何number数值表达式（例如，[“get”, “radius”]）。</li><li>stop_input必须是严格按升序排列的number。stop_output为输出值；</li><li>如果输入小于第一个止损，则返回第一个输入值stop_output_0。</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;step&quot;</span>,</span><br><span class="line">    <span class="attr">input:</span> <span class="string">number</span>,</span><br><span class="line">    <span class="attr">stop_output_0:</span> <span class="string">OutputType</span>,</span><br><span class="line">    <span class="attr">stop_input_1:</span> <span class="string">number</span>, <span class="attr">stop_output_1:</span> <span class="string">OutputType</span>,</span><br><span class="line">    <span class="attr">stop_input_n:</span> <span class="string">number</span>, <span class="attr">stop_output_n:</span> <span class="string">OutputType</span>, <span class="string">...</span></span><br><span class="line">]<span class="string">:</span> <span class="string">OutputType</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>例如</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;circle-color&quot;: [</span><br><span class="line">    //根据featur<span class="string">e&#x27;s properties中的radius值，</span></span><br><span class="line"><span class="string">    &#x27;</span>step<span class="string">&#x27;, [&#x27;</span><span class="keyword">get</span><span class="string">&#x27;, &#x27;</span>radius<span class="string">&#x27;],</span></span><br><span class="line"><span class="string">    //radius值小于3的显示#fff</span></span><br><span class="line"><span class="string">    &#x27;</span>#fff<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    //3-4 显示red</span></span><br><span class="line"><span class="string">    3, &#x27;</span>red<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    //5-6显示yellow</span></span><br><span class="line"><span class="string">    5, &#x27;</span>yellow<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    //7以上显示blue</span></span><br><span class="line"><span class="string">    7, &#x27;</span>blu<span class="string">e&#x27;,</span></span><br><span class="line"><span class="string">],</span></span><br></pre></td></tr></table></figure><h3 id="变量绑定">变量绑定</h3><ol><li>let</li></ol><p>将表达式绑定到命名变量，然后可以使用[“ var”，“ variable_name”] 在结果表达式中进行引用。</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;let&quot;</span>,</span><br><span class="line">    <span class="type">string</span> (alphanumeric literal), <span class="type">any</span>, <span class="type">string</span> (alphanumeric literal), <span class="type">any</span>, ...,</span><br><span class="line">    <span class="type">OutputType</span></span><br><span class="line">]: <span class="type">OutputType</span></span><br></pre></td></tr></table></figure><ol start="2"><li>var<br>引用变量绑定使用“ let”。</li></ol><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;var&quot;</span>, previously bound variable name]: the <span class="keyword">type</span> <span class="type">of </span>the bound expression</span><br></pre></td></tr></table></figure><h3 id="字符串操作">字符串操作</h3><ol><li>concat 字符串连接</li></ol><p>返回string，连接各个输入值。每个输入都将转换为字符串，就像通过to-string。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;concat&quot;, value, value, ...</span>]: <span class="link">string</span></span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;text-field&quot;</span>: [<span class="string">&#x27;concat&#x27;</span> ,<span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>]</span><br><span class="line"></span><br><span class="line">结果： aaabbb</span><br></pre></td></tr></table></figure><ol start="2"><li>downcase 转小写</li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;downcase&quot;</span>, <span class="built_in">string</span>]: <span class="built_in">string</span></span><br></pre></td></tr></table></figure><ol start="3"><li>upcase 转大写</li></ol><p>返回转换为大写的输入字符串。遵循Unicode默认大小写转换算法和Unicode字符数据库中不区分语言环境的大小写映射。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;upcase&quot;</span>, <span class="built_in">string</span>]: <span class="built_in">string</span></span><br></pre></td></tr></table></figure><ol start="4"><li><code>is-supported-script 支持脚本</code></li></ol><p>返回true是否期望输入字符串清晰呈现。返回false如果输入字符串包含无法呈现而不会失去意义的部分（例如，要求复杂文本整形的印度脚本，或者如果mapbox-gl-rtl-textMapbox GL JS中未使用该插件，则为从右到左脚本）。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;is-supported-script&quot;</span>, <span class="built_in">string</span>]: <span class="built_in">boolean</span></span><br></pre></td></tr></table></figure><ol start="5"><li><code>resolved-locale</code></li></ol><p>返回提供的所使用语言环境的IETF语言标记collator。这可用于确定默认系统区域设置，或确定是否成功加载了请求的区域设置。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;resolved-locale&quot;, collator</span>]: <span class="link">string</span></span><br></pre></td></tr></table></figure><h3 id="颜色表达式">颜色表达式</h3><ol><li>rgb</li></ol><p>从红色，绿色和蓝色分量创建颜色值，该值必须在0到255之间，并且alpha分量为1。如果任何分量超出范围，则该表达式为错误。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;rgb&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]: color</span><br></pre></td></tr></table></figure><ol start="2"><li>rgba</li></ol><p>从必须在0到255之间的红色，绿色，蓝色分量和必须在0到1之间的alpha分量创建颜色值。如果任何分量超出范围，则表达式为错误。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;rgba&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]: color</span><br></pre></td></tr></table></figure><ol start="3"><li>to-rgba</li></ol><p>返回一个四元素的数组，该数组包含输入颜色的红色，绿色，蓝色和Alpha分量的顺序。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[&quot;to-rgba&quot;, color]</span>: <span class="built_in">array<span class="keyword">&lt;number, 4&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Math-表达式">Math 表达式</h3><ol><li><code>- 减法</code></li></ol><p>对于两个输入，返回从第一个输入减去第二个输入的结果。对于单个输入，返回从0减去它的结果。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;-&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line">[<span class="string">&quot;-&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>* 乘法</code></li></ol><p>返回输入的乘积。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;*&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, ...]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="3"><li><code>/ 除法</code></li></ol><p>返回第一个输入与第二个输入的浮点除法的结果。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;/&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="4"><li><code>% 取余</code></li></ol><p>返回第一个输入除以第二个输入的整数后的余数。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;%&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="5"><li><code>^ 幂</code></li></ol><p>返回将第一个输入提高到第二个指定的幂的结果。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;^&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="6"><li><code>+ 加法</code></li></ol><p>返回输入的总和。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;+&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, ...]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="7"><li><code>abs 绝对值</code></li></ol><p>返回输入的绝对值。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;abs&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="8"><li><code>三角函数</code></li></ol><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 返回输入的反余弦值。</span></span><br><span class="line">[<span class="string">&quot;acos&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 返回输入的反正弦值。</span></span><br><span class="line">[<span class="string">&quot;asin&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 返回输入的反正切。</span></span><br><span class="line">[<span class="string">&quot;atan&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 返回输入的余弦值。</span></span><br><span class="line">[<span class="string">&quot;cos&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 返回输入的正弦值。</span></span><br><span class="line">[<span class="string">&quot;sin&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 返回输入的切线。</span></span><br><span class="line">[<span class="string">&quot;tan&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="9"><li><code>四舍五入取整相关</code></li></ol><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 向上取整，返回大于或等于输入的最小整数。</span></span><br><span class="line">[<span class="string">&quot;ceil&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 返回小于或等于输入的最大整数。</span></span><br><span class="line">[<span class="string">&quot;floor&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 四舍五入 将输入舍入到最接近的整数。中途值从零舍入。例如，[&quot;round&quot;, -1.5]计算结果为-2。</span></span><br><span class="line">[<span class="string">&quot;round&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="10"><li><code>常数类</code></li></ol><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 返回数学常数e。</span></span><br><span class="line">[<span class="string">&quot;e&quot;</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 返回输入的自然对数。</span></span><br><span class="line">[<span class="string">&quot;ln&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 返回数学常数ln（2）。</span></span><br><span class="line">[<span class="string">&quot;ln2&quot;</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 返回输入的以十为底的对数。</span></span><br><span class="line">[<span class="string">&quot;log10&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 返回输入的以2为底的对数。</span></span><br><span class="line">[<span class="string">&quot;log2&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 返回数学常数pi。</span></span><br><span class="line">[<span class="string">&quot;pi&quot;</span>]: <span class="built_in">number</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="11"><li>max 取最大值</li></ol><p>返回输入的最大值。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;max&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, ...]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="12"><li>min 取最小值</li></ol><p>返回输入的最小值。</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;min&quot;</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, ...]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><ol start="13"><li>sqrt 返回输入的平方根。</li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;sqrt&quot;</span>, <span class="built_in">number</span>]: <span class="built_in">number</span></span><br></pre></td></tr></table></figure><h3 id="Zoom-缩放">Zoom 缩放</h3><p>获取当前的缩放级别。请注意，在样式布局和绘画属性中，[“ zoom”] 可能仅作为顶级“ step”或“ interpolate”表达式的输入出现。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;zoom&quot;</span>]: <span class="link">number</span></span><br></pre></td></tr></table></figure><h3 id="Heatmap-热力图">Heatmap 热力图</h3><ol><li>heatmap-density</li></ol><p>获取热图图层中像素的内核密度估计，这是在特定像素周围拥挤多少数据点的相对度量。只能在heatmap-color属性中使用。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">&quot;heatmap-density&quot;</span>]: <span class="link">number</span></span><br></pre></td></tr></table></figure><h3 id="其他方法">其他方法</h3><p>可以将任何layout或paint属性的值指定为一个函数。使用功能可以使地图要素的外观随当前缩放级别zoom和/或地图项的feature’s properties 变化而变化。默认输入值是zoom</p><ol><li>stops</li></ol><p>必须是一个数组，根据输入和输出值定义功能。一组一个输入值和一个输出值称为stop”。停止输出值必须是文字值（即不是函数或表达式），并且适用于该属性。例如，fill-color属性中使用的stops函数输出值必须为colors。</p><p>例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;circle-radius&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;stops&quot;</span>: [</span><br><span class="line">        <span class="regexp">//</span> zoom 为<span class="number">1</span>时，半径为<span class="number">2</span></span><br><span class="line">        [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        <span class="regexp">//</span>zoom为<span class="number">10</span>时，半径为<span class="number">20</span></span><br><span class="line">        [<span class="number">10</span>, <span class="number">20</span>]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> [<span class="number">10</span>, <span class="number">20</span>]  就是一个stop， <span class="number">10</span>是输入值， <span class="number">20</span>是输出值，多个stop就是一个stops</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>property</li></ol><p>是一个字符串，表示属性名。<br>如果指定，该函数将采用指定的要素属性作为输入。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">&quot;circle-radius&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;property&quot;</span>: <span class="string">&quot;radius&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stops&quot;</span>: [</span><br><span class="line">        <span class="regexp">//</span> radius 为<span class="number">1</span>时，半径为<span class="number">2</span></span><br><span class="line">        [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        <span class="regexp">//</span> radius 为<span class="number">5</span>时，半径为 <span class="number">20</span></span><br><span class="line">        [<span class="number">5</span>, <span class="number">20</span>],</span><br><span class="line">        <span class="regexp">//</span> radius 为<span class="number">10</span>时，半径为<span class="number">5</span></span><br><span class="line">        [<span class="number">10</span>, <span class="number">5</span>]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 此时的 <span class="number">1</span> <span class="number">5</span> <span class="number">10</span> 就是radius 的取值步长，在<span class="number">1</span>-<span class="number">5</span>的范围内，取值是<span class="number">2</span>-<span class="number">20</span>，</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>base<br>类型是number，默认是1。<br>插值曲线的指数基础。它控制函数输出的增加速率。较高的值会使输出向该范围的高端增加更多。值接近1时，输出线性增加. 调节线性</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">&quot;circle-radius&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;base&quot;</span>: <span class="number">1.3</span>,</span><br><span class="line">    <span class="string">&quot;stops&quot;</span>: [</span><br><span class="line">        <span class="regexp">//</span> radius 为<span class="number">1</span>时，半径为<span class="number">2</span></span><br><span class="line">        [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">        <span class="regexp">//</span> radius 为<span class="number">5</span>时，半径为 <span class="number">20</span></span><br><span class="line">        [<span class="number">10</span>, <span class="number">20</span>],</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> base为<span class="number">1</span>时，是正常显示，小于<span class="number">1</span>，如<span class="number">0.8</span>时候，差距会变小，大于<span class="number">1</span>时，差距会拉大，大的更大，小的更小。</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>type</li></ol><p>可选值：“identity”, “exponential”,“interval”, or “categorical”</p><ul><li>identity：返回其输入作为输出的函数。</li><li>exponential：通过在停靠点之间进行插值而生成输出的函数，该停靠点小于且大于函数输入。域（输入值）必须是数字，并且style属性必须支持插值。支持插值的样式属性用标记为“指数”符号，并且指数是这些属性的默认函数类型。</li><li>interval： 返回停止点输出值刚好小于函数输入的函数。域（输入值）必须是数字。任何样式属性都可以使用间隔函数。对于标有，“间隔”符号的属性，这是默认功能类型。<br>*categorical： 一个函数，其返回的停止值等于函数输入的输出值。</li></ul><ol start="5"><li>default</li></ol><p>如果没有其他可用值，则该值将用作备用功能。在以下情况下使用它：</p><ul><li>在分类函数中，当要素值与任何 stops值都不匹配时。</li><li>在特性和缩放特性函数中，当要素不包含指定特性的值时。</li><li>在标识函数中，当 feature值对于样式属性无效时（例如，如果函数用于 circle-color属性，但特征属性值不是字符串或无效颜色）。</li><li>在间隔或指数属性以及缩放和特性函数中，当特征值不是数字时。<br>如果未提供默认值，则在这些情况下使用style属性的默认值。</li></ul><ol start="6"><li>colorSpace</li></ol><p>可选值：“rgb”, “lab”, “hcl”。</p><p>插值颜色的颜色空间。与RGB空间中插值的颜色相比，在LAB和HCL等感知颜色空间中插值的颜色趋向于生成看起来更一致的色带，并产生易于区分的颜色。</p><ul><li>“rgb”： 使用RGB颜色空间内插颜色值</li><li>“lab”：使用LAB颜色空间对颜色值进行插值。</li><li>“hcl”： 使用HCL颜色空间内插颜色值，分别内插Hue，Chroma和Luminance通道。</li></ul><ol start="7"><li>Zoom-and-property functions</li></ol><p>允许地图要素的外观随其属性和缩放而改变。每个止挡是一个包含两个元素的数组，第一个是具有属性输入值和缩放的对象，第二个是函数输出值。请注意，对属性功能的支持尚未完成。</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;circle-radius&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;property&quot;</span>: <span class="string">&quot;rating&quot;</span>,</span><br><span class="line">        <span class="string">&quot;stops&quot;</span>: [</span><br><span class="line">            // zoom <span class="built_in">is</span> <span class="number">0</span> <span class="keyword">and</span> <span class="string">&quot;rating&quot;</span> <span class="built_in">is</span> <span class="number">0</span> -&gt; circle <span class="built_in">radius</span> will be <span class="number">0px</span></span><br><span class="line">            [&#123;zoom: <span class="number">0</span>, value: <span class="number">0</span>&#125;, <span class="number">0</span>],</span><br><span class="line"></span><br><span class="line">            // zoom <span class="built_in">is</span> <span class="number">0</span> <span class="keyword">and</span> <span class="string">&quot;rating&quot;</span> <span class="built_in">is</span> <span class="number">5</span> -&gt; circle <span class="built_in">radius</span> will be 5px</span><br><span class="line">            [&#123;zoom: <span class="number">0</span>, value: <span class="number">5</span>&#125;, <span class="number">5</span>],</span><br><span class="line"></span><br><span class="line">            // zoom <span class="built_in">is</span> <span class="number">20</span> <span class="keyword">and</span> <span class="string">&quot;rating&quot;</span> <span class="built_in">is</span> <span class="number">0</span> -&gt; circle <span class="built_in">radius</span> will be <span class="number">0px</span></span><br><span class="line">            [&#123;zoom: <span class="number">20</span>, value: <span class="number">0</span>&#125;, <span class="number">0</span>],</span><br><span class="line"></span><br><span class="line">            // zoom <span class="built_in">is</span> <span class="number">20</span> <span class="keyword">and</span> <span class="string">&quot;rating&quot;</span> <span class="built_in">is</span> <span class="number">5</span> -&gt; circle <span class="built_in">radius</span> will be 20px</span><br><span class="line">            [&#123;zoom: <span class="number">20</span>, value: <span class="number">5</span>&#125;, <span class="number">20</span>]</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="一些给filter用的表达式，虽然没有废除，但是建议使用表达式">一些给filter用的表达式，虽然没有废除，但是建议使用表达式</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    paint:&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="attribute">filter</span>: [<span class="string">&#x27;in&#x27;</span>,<span class="string">&#x27;radius&#x27;</span>,<span class="number">5</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>是否存在属性</li></ol><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;has&quot;</span>, <span class="built_in">key</span>] <span class="built_in">feature</span>[<span class="built_in">key</span>] 存在</span><br><span class="line">[<span class="string">&quot;!has&quot;</span>, <span class="built_in">key</span>] <span class="built_in">feature</span>[<span class="built_in">key</span>] 不存在</span><br></pre></td></tr></table></figure><ol start="2"><li>比较过滤器</li></ol><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;==&quot;</span>, <span class="built_in">key</span>, value] 相等: <span class="built_in">feature</span>[<span class="built_in">key</span>] = value</span><br><span class="line">[<span class="string">&quot;!=&quot;</span>, <span class="built_in">key</span>, value] 不相等: <span class="built_in">feature</span>[<span class="built_in">key</span>] ≠ value</span><br><span class="line">[<span class="string">&quot;&gt;&quot;</span>, <span class="built_in">key</span>, value] 大于: <span class="built_in">feature</span>[<span class="built_in">key</span>] &gt; value</span><br><span class="line">[<span class="string">&quot;&gt;=&quot;</span>, <span class="built_in">key</span>, value] 大于或等于: <span class="built_in">feature</span>[<span class="built_in">key</span>] ≥ value</span><br><span class="line">[<span class="string">&quot;&lt;&quot;</span>, <span class="built_in">key</span>, value] 小于: <span class="built_in">feature</span>[<span class="built_in">key</span>] &lt; value</span><br><span class="line">[<span class="string">&quot;&lt;=&quot;</span>, <span class="built_in">key</span>, value] 小于或等于: <span class="built_in">feature</span>[<span class="built_in">key</span>] ≤ value</span><br></pre></td></tr></table></figure><ol start="3"><li>in</li></ol><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;in&quot;</span>, <span class="built_in">key</span>, v0, ..., vn] 集合包含：<span class="built_in">feature</span> [<span class="built_in">key</span>] ∈ &#123; v0，...，vn &#125;</span><br><span class="line">[<span class="string">&quot;!in&quot;</span>, <span class="built_in">key</span>, v0, ..., vn] 设置排除：<span class="built_in">feature</span> [<span class="built_in">key</span>] ∉ &#123; v0，...，vn &#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>组合过滤器</li></ol><p>[“all”, f0, …, fn] 逻辑AND：F0 ∧…∧ FN<br>[“any”, f0, …, fn] 逻辑OR：F0 ∨…∨ FN<br>[“none”, f0, …, fn] 逻辑NOR：¬ F0 ∧…∧¬ FN</p><p>以上四类中的：</p><p>key 必须是 feature property属性或者以下特殊值：</p><ul><li>“$type”：feature 类型，他可以和 “==”,“!=”, “in”, and “!in” 一起使用. 结果可能是&quot;Point&quot;, “LineString”, 或 “Polygon”.</li><li>“$id”：功能标识符。此键可以与&quot;==“，”!=“，“has”，”!has&quot;，“in”，和&quot;!in&quot;一起使用。</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;FeatureCollection&quot;</span>,</span><br><span class="line">    <span class="string">&quot;features&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Feature&quot;</span>,</span><br><span class="line">        <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;点1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;desc&quot;</span>:<span class="string">&quot;这是点1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;radius&quot;</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>:<span class="number">54</span>, <span class="regexp">//</span><span class="variable">$id</span> 就是这里</span><br><span class="line">        <span class="string">&quot;geometry&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Point&quot;</span>,  <span class="regexp">//</span><span class="variable">$type</span> 就是他</span><br><span class="line">          <span class="string">&quot;coordinates&quot;</span>: [</span><br><span class="line">            <span class="number">108.9902114868164</span>,</span><br><span class="line">            <span class="number">34.24813554589752</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><p>value 值必须是必须是一个字符串string，数字number或布尔值boolean进行比较的属性值。</p><p>表达式参考</p><h2 id="一、数学运算符">一、数学运算符</h2><h2 id="二、逻辑运算符">二、逻辑运算符</h2><h2 id="三、字符串运算符">三、字符串运算符</h2><h2 id="四、数据运算符">四、数据运算符</h2><p>数据表达式是用来访问数据的，例如： [‘get’,‘name’],就是获取数据中的name值</p><h2 id="五、Camera-operators-表达式">五、Camera operators 表达式</h2><p>相机类表达式，可以根据地图 zoom 的值变化而变化。</p><p>例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;circle-radius&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;interpolate&quot;</span>, [<span class="string">&quot;linear&quot;</span>], [<span class="string">&quot;zoom&quot;</span>],</span><br><span class="line">        <span class="regexp">//</span> zoom 是<span class="number">5</span>或者更小 -&gt; 圆半径是<span class="number">1</span>px</span><br><span class="line">        <span class="number">5</span>, <span class="number">1</span>,</span><br><span class="line">        <span class="regexp">//</span> zoom 是<span class="number">10</span>或者更大 -&gt; 圆半径是<span class="number">5</span>px</span><br><span class="line">        <span class="number">10</span>, <span class="number">5</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 可视化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MapboxGL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>eslint</title>
      <link href="/posts/cd69ee4d.html"/>
      <url>/posts/cd69ee4d.html</url>
      
        <content type="html"><![CDATA[<h3 id="常见配置翻译">常见配置翻译</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;no-alert&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用alert confirm prompt</span><br><span class="line"><span class="string">&quot;no-array-constructor&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用数组构造器</span><br><span class="line"><span class="string">&quot;no-bitwise&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用按位运算符</span><br><span class="line"><span class="string">&quot;no-caller&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>禁止使用arguments.caller或arguments.callee</span><br><span class="line"><span class="string">&quot;no-catch-shadow&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止catch子句参数与外部作用域变量同名</span><br><span class="line"><span class="string">&quot;no-class-assign&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止给类赋值</span><br><span class="line"><span class="string">&quot;no-cond-assign&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止在条件表达式中使用赋值语句</span><br><span class="line"><span class="string">&quot;no-console&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用console</span><br><span class="line"><span class="string">&quot;no-const-assign&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止修改const声明的变量</span><br><span class="line"><span class="string">&quot;no-constant-condition&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止在条件中使用常量表达式 <span class="keyword">if</span>(true) <span class="keyword">if</span>(<span class="number">1</span>)</span><br><span class="line"><span class="string">&quot;no-continue&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用<span class="keyword">continue</span></span><br><span class="line"><span class="string">&quot;no-control-regex&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止在正则表达式中使用控制字符</span><br><span class="line"><span class="string">&quot;no-debugger&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用debugger</span><br><span class="line"><span class="string">&quot;no-delete-var&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>不能对var声明的变量使用<span class="keyword">delete</span>操作符</span><br><span class="line"><span class="string">&quot;no-div-regex&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>不能使用看起来像除法的正则表达式<span class="regexp">/=foo/</span></span><br><span class="line"><span class="string">&quot;no-dupe-keys&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>在创建对象字面量时不允许键重复 &#123;a:<span class="number">1</span>,a:<span class="number">1</span>&#125;</span><br><span class="line"><span class="string">&quot;no-dupe-args&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>函数参数不能重复</span><br><span class="line"><span class="string">&quot;no-duplicate-case&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>switch中的case标签不能重复</span><br><span class="line"><span class="string">&quot;no-else-return&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>如果<span class="keyword">if</span>语句里面有return,后面不能跟<span class="keyword">else</span>语句</span><br><span class="line"><span class="string">&quot;no-empty&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>块语句中的内容不能为空</span><br><span class="line"><span class="string">&quot;no-empty-character-class&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>正则表达式中的[]内容不能为空</span><br><span class="line"><span class="string">&quot;no-empty-label&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用空label</span><br><span class="line"><span class="string">&quot;no-eq-null&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止对null使用==或!=运算符</span><br><span class="line"><span class="string">&quot;no-eval&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>禁止使用eval</span><br><span class="line"><span class="string">&quot;no-ex-assign&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止给catch语句中的异常参数赋值</span><br><span class="line"><span class="string">&quot;no-extend-native&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止扩展native对象</span><br><span class="line"><span class="string">&quot;no-extra-bind&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止不必要的函数绑定</span><br><span class="line"><span class="string">&quot;no-extra-boolean-cast&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止不必要的bool转换</span><br><span class="line"><span class="string">&quot;no-extra-parens&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止非必要的括号</span><br><span class="line"><span class="string">&quot;no-extra-semi&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止多余的冒号</span><br><span class="line"><span class="string">&quot;no-fallthrough&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>禁止switch穿透</span><br><span class="line"><span class="string">&quot;no-floating-decimal&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止省略浮点数中的<span class="number">0</span> .<span class="number">5</span> <span class="number">3</span>.</span><br><span class="line"><span class="string">&quot;no-func-assign&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止重复的函数声明</span><br><span class="line"><span class="string">&quot;no-implicit-coercion&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>禁止隐式转换</span><br><span class="line"><span class="string">&quot;no-implied-eval&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用隐式eval</span><br><span class="line"><span class="string">&quot;no-inline-comments&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止行内备注</span><br><span class="line"><span class="string">&quot;no-inner-declarations&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;functions&quot;</span>],<span class="regexp">//</span>禁止在块语句中使用声明（变量或函数）</span><br><span class="line"><span class="string">&quot;no-invalid-regexp&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止无效的正则表达式</span><br><span class="line"><span class="string">&quot;no-invalid-this&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止无效的this，只能用在构造器，类，对象字面量</span><br><span class="line"><span class="string">&quot;no-irregular-whitespace&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>不能有不规则的空格</span><br><span class="line"><span class="string">&quot;no-iterator&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用__iterator__ 属性</span><br><span class="line"><span class="string">&quot;no-label-var&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>label名不能与var声明的变量名相同</span><br><span class="line"><span class="string">&quot;no-labels&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止标签声明</span><br><span class="line"><span class="string">&quot;no-lone-blocks&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止不必要的嵌套块</span><br><span class="line"><span class="string">&quot;no-lonely-if&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止<span class="keyword">else</span>语句内只有<span class="keyword">if</span>语句</span><br><span class="line"><span class="string">&quot;no-loop-func&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>禁止在循环中使用函数（如果没有引用外部变量不形成闭包就可以）</span><br><span class="line"><span class="string">&quot;no-mixed-requires&quot;</span>: [<span class="number">0</span>, false],<span class="regexp">//</span>声明时不能混用声明类型</span><br><span class="line"><span class="string">&quot;no-mixed-spaces-and-tabs&quot;</span>: [<span class="number">2</span>, false],<span class="regexp">//</span>禁止混用tab和空格</span><br><span class="line"><span class="string">&quot;linebreak-style&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;windows&quot;</span>],<span class="regexp">//</span>换行风格</span><br><span class="line"><span class="string">&quot;no-multi-spaces&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>不能用多余的空格</span><br><span class="line"><span class="string">&quot;no-multi-str&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>字符串不能用\换行</span><br><span class="line"><span class="string">&quot;no-multiple-empty-lines&quot;</span>: [<span class="number">1</span>, &#123;<span class="string">&quot;max&quot;</span>: <span class="number">2</span>&#125;],<span class="regexp">//</span>空行最多不能超过<span class="number">2</span>行</span><br><span class="line"><span class="string">&quot;no-native-reassign&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>不能重写native对象</span><br><span class="line"><span class="string">&quot;no-negated-in-lhs&quot;</span>: <span class="number">2</span>,<span class="regexp">//i</span>n 操作符的左边不能有!</span><br><span class="line"><span class="string">&quot;no-nested-ternary&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用嵌套的三目运算</span><br><span class="line"><span class="string">&quot;no-new&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>禁止在使用new构造一个实例后不赋值</span><br><span class="line"><span class="string">&quot;no-new-func&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>禁止使用new Function</span><br><span class="line"><span class="string">&quot;no-new-object&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用new Object()</span><br><span class="line"><span class="string">&quot;no-new-require&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用new require</span><br><span class="line"><span class="string">&quot;no-new-wrappers&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用new创建包装实例，new String new Boolean new Number</span><br><span class="line"><span class="string">&quot;no-obj-calls&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>不能调用内置的全局对象，比如Math() JSON()</span><br><span class="line"><span class="string">&quot;no-octal&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用八进制数字</span><br><span class="line"><span class="string">&quot;no-octal-escape&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用八进制转义序列</span><br><span class="line"><span class="string">&quot;no-param-reassign&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止给参数重新赋值</span><br><span class="line"><span class="string">&quot;no-path-concat&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>node中不能使用__dirname或__filename做路径拼接</span><br><span class="line"><span class="string">&quot;no-plusplus&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用++，--</span><br><span class="line"><span class="string">&quot;no-process-env&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用process.env</span><br><span class="line"><span class="string">&quot;no-process-exit&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用process.<span class="keyword">exit</span>()</span><br><span class="line"><span class="string">&quot;no-proto&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止使用__proto__属性</span><br><span class="line"><span class="string">&quot;no-redeclare&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止重复声明变量</span><br><span class="line"><span class="string">&quot;no-regex-spaces&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止在正则表达式字面量中使用多个空格 <span class="regexp">/foo bar/</span></span><br><span class="line"><span class="string">&quot;no-restricted-modules&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>如果禁用了指定模块，使用就会报错</span><br><span class="line"><span class="string">&quot;no-return-assign&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>return 语句中不能有赋值表达式</span><br><span class="line"><span class="string">&quot;no-script-url&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用javascript:void(<span class="number">0</span>)</span><br><span class="line"><span class="string">&quot;no-self-compare&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>不能比较自身</span><br><span class="line"><span class="string">&quot;no-sequences&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用逗号运算符</span><br><span class="line"><span class="string">&quot;no-shadow&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>外部作用域中的变量不能与它所包含的作用域中的变量或参数同名</span><br><span class="line"><span class="string">&quot;no-shadow-restricted-names&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>严格模式中规定的限制标识符不能作为声明时的变量名使用</span><br><span class="line"><span class="string">&quot;no-spaced-func&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>函数调用时 函数名与()之间不能有空格</span><br><span class="line"><span class="string">&quot;no-sparse-arrays&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止稀疏数组， [<span class="number">1</span>,,<span class="number">2</span>]</span><br><span class="line"><span class="string">&quot;no-sync&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>nodejs 禁止同步方法</span><br><span class="line"><span class="string">&quot;no-ternary&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁止使用三目运算符</span><br><span class="line"><span class="string">&quot;no-trailing-spaces&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>一行结束后面不要有空格</span><br><span class="line"><span class="string">&quot;no-this-before-super&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>在调用super()之前不能使用this或super</span><br><span class="line"><span class="string">&quot;no-throw-literal&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止抛出字面量错误 throw <span class="string">&quot;error&quot;</span>;</span><br><span class="line"><span class="string">&quot;no-undef&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>不能有未定义的变量</span><br><span class="line"><span class="string">&quot;no-undef-init&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>变量初始化时不能直接给它赋值为undefined</span><br><span class="line"><span class="string">&quot;no-undefined&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>不能使用undefined</span><br><span class="line"><span class="string">&quot;no-unexpected-multiline&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>避免多行表达式</span><br><span class="line"><span class="string">&quot;no-underscore-dangle&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>标识符不能以_开头或结尾</span><br><span class="line"><span class="string">&quot;no-unneeded-ternary&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止不必要的嵌套 var isYes = answer === <span class="number">1</span> ? true : false;</span><br><span class="line"><span class="string">&quot;no-unreachable&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>不能有无法执行的代码</span><br><span class="line"><span class="string">&quot;no-unused-expressions&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止无用的表达式</span><br><span class="line"><span class="string">&quot;no-unused-vars&quot;</span>: [<span class="number">2</span>, &#123;<span class="string">&quot;vars&quot;</span>: <span class="string">&quot;all&quot;</span>, <span class="string">&quot;args&quot;</span>: <span class="string">&quot;after-used&quot;</span>&#125;],<span class="regexp">//</span>不能有声明后未被使用的变量或参数</span><br><span class="line"><span class="string">&quot;no-use-before-define&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>未定义前不能使用</span><br><span class="line"><span class="string">&quot;no-useless-call&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止不必要的call和apply</span><br><span class="line"><span class="string">&quot;no-void&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁用void操作符</span><br><span class="line"><span class="string">&quot;no-var&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>禁用var，用let和const代替</span><br><span class="line"><span class="string">&quot;no-warning-comments&quot;</span>: [<span class="number">1</span>, &#123; <span class="string">&quot;terms&quot;</span>: [<span class="string">&quot;todo&quot;</span>, <span class="string">&quot;fixme&quot;</span>, <span class="string">&quot;xxx&quot;</span>], <span class="string">&quot;location&quot;</span>: <span class="string">&quot;start&quot;</span> &#125;],<span class="regexp">//</span>不能有警告备注</span><br><span class="line"><span class="string">&quot;no-with&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁用with</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;array-bracket-spacing&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>],<span class="regexp">//</span>是否允许非空数组里面有多余的空格</span><br><span class="line"><span class="string">&quot;arrow-parens&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>箭头函数用小括号括起来</span><br><span class="line"><span class="string">&quot;arrow-spacing&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>=&gt;的前/后括号</span><br><span class="line"><span class="string">&quot;accessor-pairs&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>在对象中使用getter/setter</span><br><span class="line"><span class="string">&quot;block-scoped-var&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>块语句中使用var</span><br><span class="line"><span class="string">&quot;brace-style&quot;</span>: [<span class="number">1</span>, <span class="string">&quot;1tbs&quot;</span>],<span class="regexp">//</span>大括号风格</span><br><span class="line"><span class="string">&quot;callback-return&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>避免多次调用回调什么的</span><br><span class="line"><span class="string">&quot;camelcase&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>强制驼峰法命名</span><br><span class="line"><span class="string">&quot;comma-dangle&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>],<span class="regexp">//</span>对象字面量项尾不能有逗号</span><br><span class="line"><span class="string">&quot;comma-spacing&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>逗号前后的空格</span><br><span class="line"><span class="string">&quot;comma-style&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;last&quot;</span>],<span class="regexp">//</span>逗号风格，换行时在行首还是行尾</span><br><span class="line"><span class="string">&quot;complexity&quot;</span>: [<span class="number">0</span>, <span class="number">11</span>],<span class="regexp">//</span>循环复杂度</span><br><span class="line"><span class="string">&quot;computed-property-spacing&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;never&quot;</span>],<span class="regexp">//</span>是否允许计算后的键名什么的</span><br><span class="line"><span class="string">&quot;consistent-return&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>return 后面是否允许省略</span><br><span class="line"><span class="string">&quot;consistent-this&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;that&quot;</span>],<span class="regexp">//</span>this别名</span><br><span class="line"><span class="string">&quot;constructor-super&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>非派生类不能调用super，派生类必须调用super</span><br><span class="line"><span class="string">&quot;curly&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;all&quot;</span>],<span class="regexp">//</span>必须使用 <span class="keyword">if</span>()&#123;&#125; 中的&#123;&#125;</span><br><span class="line"><span class="string">&quot;default-case&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>switch语句最后必须有default</span><br><span class="line"><span class="string">&quot;dot-location&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>对象访问符的位置，换行的时候在行首还是行尾</span><br><span class="line"><span class="string">&quot;dot-notation&quot;</span>: [<span class="number">0</span>, &#123; <span class="string">&quot;allowKeywords&quot;</span>: true &#125;],<span class="regexp">//</span>避免不必要的方括号</span><br><span class="line"><span class="string">&quot;eol-last&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>文件以单一的换行符结束</span><br><span class="line"><span class="string">&quot;eqeqeq&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>必须使用全等</span><br><span class="line"><span class="string">&quot;func-names&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>函数表达式必须有名字</span><br><span class="line"><span class="string">&quot;func-style&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;declaration&quot;</span>],<span class="regexp">//</span>函数风格，规定只能使用函数声明/函数表达式</span><br><span class="line"><span class="string">&quot;generator-star-spacing&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>生成器函数*的前后空格</span><br><span class="line"><span class="string">&quot;guard-for-in&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span><span class="keyword">for</span> <span class="keyword">in</span>循环要用<span class="keyword">if</span>语句过滤</span><br><span class="line"><span class="string">&quot;handle-callback-err&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>nodejs 处理错误</span><br><span class="line"><span class="string">&quot;id-length&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>变量名长度</span><br><span class="line"><span class="string">&quot;indent&quot;</span>: [<span class="number">2</span>, <span class="number">4</span>],<span class="regexp">//</span>缩进风格</span><br><span class="line"><span class="string">&quot;init-declarations&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>声明时必须赋初值</span><br><span class="line"><span class="string">&quot;key-spacing&quot;</span>: [<span class="number">0</span>, &#123; <span class="string">&quot;beforeColon&quot;</span>: false, <span class="string">&quot;afterColon&quot;</span>: true &#125;],<span class="regexp">//</span>对象字面量中冒号的前后空格</span><br><span class="line"><span class="string">&quot;lines-around-comment&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>行前/行后备注</span><br><span class="line"><span class="string">&quot;max-depth&quot;</span>: [<span class="number">0</span>, <span class="number">4</span>],<span class="regexp">//</span>嵌套块深度</span><br><span class="line"><span class="string">&quot;max-len&quot;</span>: [<span class="number">0</span>, <span class="number">80</span>, <span class="number">4</span>],<span class="regexp">//</span>字符串最大长度</span><br><span class="line"><span class="string">&quot;max-nested-callbacks&quot;</span>: [<span class="number">0</span>, <span class="number">2</span>],<span class="regexp">//</span>回调嵌套深度</span><br><span class="line"><span class="string">&quot;max-params&quot;</span>: [<span class="number">0</span>, <span class="number">3</span>],<span class="regexp">//</span>函数最多只能有<span class="number">3</span>个参数</span><br><span class="line"><span class="string">&quot;max-statements&quot;</span>: [<span class="number">0</span>, <span class="number">10</span>],<span class="regexp">//</span>函数内最多有几个声明</span><br><span class="line"><span class="string">&quot;new-cap&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>函数名首行大写必须使用new方式调用，首行小写必须用不带new方式调用</span><br><span class="line"><span class="string">&quot;new-parens&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>new时必须加小括号</span><br><span class="line"><span class="string">&quot;newline-after-var&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>变量声明后是否需要空一行</span><br><span class="line"><span class="string">&quot;object-curly-spacing&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;never&quot;</span>],<span class="regexp">//</span>大括号内是否允许不必要的空格</span><br><span class="line"><span class="string">&quot;object-shorthand&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>强制对象字面量缩写语法</span><br><span class="line"><span class="string">&quot;one-var&quot;</span>: <span class="number">1</span>,<span class="regexp">//</span>连续声明</span><br><span class="line"><span class="string">&quot;operator-assignment&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;always&quot;</span>],<span class="regexp">//</span>赋值运算符 += -=什么的</span><br><span class="line"><span class="string">&quot;operator-linebreak&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;after&quot;</span>],<span class="regexp">//</span>换行时运算符在行尾还是行首</span><br><span class="line"><span class="string">&quot;padded-blocks&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>块语句内行首行尾是否要空行</span><br><span class="line"><span class="string">&quot;prefer-const&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>首选const</span><br><span class="line"><span class="string">&quot;prefer-spread&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>首选展开运算</span><br><span class="line"><span class="string">&quot;prefer-reflect&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>首选Reflect的方法</span><br><span class="line"><span class="string">&quot;quotes&quot;</span>: [<span class="number">1</span>, <span class="string">&quot;single&quot;</span>],<span class="regexp">//</span>引号类型 `` <span class="string">&quot;&quot;</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&quot;quote-props&quot;</span>:[<span class="number">2</span>, <span class="string">&quot;always&quot;</span>],<span class="regexp">//</span>对象字面量中的属性名是否强制双引号</span><br><span class="line"><span class="string">&quot;radix&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>parseInt必须指定第二个参数</span><br><span class="line"><span class="string">&quot;id-match&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>命名检测</span><br><span class="line"><span class="string">&quot;require-yield&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>生成器函数必须有yield</span><br><span class="line"><span class="string">&quot;semi&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;always&quot;</span>],<span class="regexp">//</span>语句强制分号结尾</span><br><span class="line"><span class="string">&quot;semi-spacing&quot;</span>: [<span class="number">0</span>, &#123;<span class="string">&quot;before&quot;</span>: false, <span class="string">&quot;after&quot;</span>: true&#125;],<span class="regexp">//</span>分号前后空格</span><br><span class="line"><span class="string">&quot;sort-vars&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>变量声明时排序</span><br><span class="line"><span class="string">&quot;space-after-keywords&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;always&quot;</span>],<span class="regexp">//</span>关键字后面是否要空一格</span><br><span class="line"><span class="string">&quot;space-before-blocks&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;always&quot;</span>],<span class="regexp">//</span>不以新行开始的块&#123;前面要不要有空格</span><br><span class="line"><span class="string">&quot;space-before-function-paren&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;always&quot;</span>],<span class="regexp">//</span>函数定义时括号前面要不要有空格</span><br><span class="line"><span class="string">&quot;space-in-parens&quot;</span>: [<span class="number">0</span>, <span class="string">&quot;never&quot;</span>],<span class="regexp">//</span>小括号里面要不要有空格</span><br><span class="line"><span class="string">&quot;space-infix-ops&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>中缀操作符周围要不要有空格</span><br><span class="line"><span class="string">&quot;space-return-throw-case&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>return throw case后面要不要加空格</span><br><span class="line"><span class="string">&quot;space-unary-ops&quot;</span>: [<span class="number">0</span>, &#123; <span class="string">&quot;words&quot;</span>: true, <span class="string">&quot;nonwords&quot;</span>: false &#125;],<span class="regexp">//</span>一元运算符的前/后要不要加空格</span><br><span class="line"><span class="string">&quot;spaced-comment&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>注释风格要不要有空格什么的</span><br><span class="line"><span class="string">&quot;strict&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>使用严格模式</span><br><span class="line"><span class="string">&quot;use-isnan&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>禁止比较时使用NaN，只能用isNaN()</span><br><span class="line"><span class="string">&quot;valid-jsdoc&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>jsdoc规则</span><br><span class="line"><span class="string">&quot;valid-typeof&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>必须使用合法的typeof的值</span><br><span class="line"><span class="string">&quot;vars-on-top&quot;</span>: <span class="number">2</span>,<span class="regexp">//</span>var必须放在作用域顶部</span><br><span class="line"><span class="string">&quot;wrap-iife&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;inside&quot;</span>],<span class="regexp">//</span>立即执行函数表达式的小括号风格</span><br><span class="line"><span class="string">&quot;wrap-regex&quot;</span>: <span class="number">0</span>,<span class="regexp">//</span>正则表达式字面量用小括号包起来</span><br><span class="line"><span class="string">&quot;yoda&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>]<span class="regexp">//</span>禁止尤达条件</span><br></pre></td></tr></table></figure><h3 id="配置">配置</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 安装依赖</span><br><span class="line">pnpm install </span><br><span class="line">  eslint </span><br><span class="line">  @typescript-eslint/parser </span><br><span class="line">  @typescript-eslint/eslint-plugin</span><br><span class="line">  eslint-plugin-prettier</span><br><span class="line">  eslint-config-prettier</span><br><span class="line">  -D -w</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. .eslintrc.cjs</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;root&quot;</span>: true,</span><br><span class="line">  <span class="string">&quot;parser&quot;</span>: <span class="string">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;@typescript-eslint&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;extends&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;eslint:recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prettier&quot;</span>, <span class="regexp">//</span> +++</span><br><span class="line">    <span class="string">&quot;plugin:@typescript-eslint/eslint-recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;plugin:@typescript-eslint/recommended&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;prettier/prettier&quot;</span>: <span class="string">&quot;off&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="常用包说明">常用包说明</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attribute">@typescript-eslint/parser</span><span class="punctuation">: </span></span><br><span class="line"><span class="punctuation"></span></span><br><span class="line"><span class="punctuation"></span></span><br><span class="line"><span class="attribute">eslint-config-prettier</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">关闭与 prettier 格式化冲突的规则</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">禁用所有与格式化相关的 eslint 规则</span></span><br><span class="line"></span><br><span class="line">eslint-plugin-prettier</span><br><span class="line"><span class="bullet">-</span> <span class="string">将 prettier 作为 eslint 格式化规则运行</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ESLint</span> 的核心在于 parser 和 plugin，一个负责将当前代码解析为 AST，一个负责在 AST 的基础上生成规则。</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="parser">parser</h3><p>ESLint 原理需要结合 parser 配置项来讲。<br>首先，ESLint 为什么需要一个 解析器？ 简单来讲，ESLint 做规则校验的前提是将语言转变为抽象语法树（AST），它的校验规则是用于适配 AST 的，在遍历 AST 节点的过程中，找到该节点适配的规则，并判断是否满足规则。</p><h3 id="plugins">plugins</h3><p>ESLint 能火起来的很大原因，在于它的插件式设计，这种设计使得他能快速的响应变化。插件是什么？插件就是规则，任何插件想要在 ESLint 中生效，需要规定两点内容。</p><ol><li>该规则针对的是 AST 的那些节点。</li><li>该节点需要满足怎样的条件。</li></ol><p>有了这两点，ESLint 就会在遍历 AST 的过程中，找出不符合规则的节点，将其报告出来。</p><p>默认情况下，ESLint 中的规则会对 JS 进行校验，如果我们想对 React 进行校验的话，就需要增加 eslint-plugin-react 插件，如下所示，在 plugins 中增加这个插件，eslint-plugin 的前缀是可以省略的。</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;react&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>有了规则是不够的，我们还需要开启这些规则，可以在 rules 中配置，更好的方法就是在 extends 中加入以下代码。</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;extends&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;plugin:react/recommended&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="extends">extends</h3><p>ESLint 中的规则很多，但是默认都不会开启的，我们需要在 rules 中设定这些规则开关，这个环节非常繁琐。因此 ESLint 设计了 extends 这个字段，用于继承别的文件中已经配置好的的规则。在不加入任何插件的情况下，extends 可以配置为 eslint:recommended 或 eslint:all。recommended 是 ESLint 官方推荐的配置，校验的规则比较少，eslint:all 则会开启全部的规则校验。<br>如果你想了解这两者的区别，你可以去 官方规则文档 查看。更快的方法是将 “eslint:recommended” 变成 “eslint:all”。修改后的结果非常夸张，我总共 3 行代码 ESLint 检测出 10 个错误。<br>extends 是一个数组，可以配置多组规则，每个配置继承它前面的配置。实际开发中，我们会继承一些优秀的 ESLint 方案，比如 airbnb，然后结合自己的实际情况，在 rules 中进一步配置。</p><p><a href="https://juejin.cn/post/7166533217376272414">参考链接</a></p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> eslint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitee-Jenkins集成</title>
      <link href="/posts/98474d22.html"/>
      <url>/posts/98474d22.html</url>
      
        <content type="html"><![CDATA[<h3 id="安装-Gitee-Jenkins-插件">安装 Gitee Jenkins 插件</h3><ul><li><a href="#_1">环境说明</a></li><li><a href="#_6">插件安装</a></li><li><a href="#_14">插件配置</a></li><li><ul><li><a href="#_Gitee__15">添加 Gitee 链接配置</a></li><li><a href="#_32">新建构建任务</a></li><li><a href="#_35">任务全局配置</a></li><li><a href="#_38">源码管理配置</a></li><li><a href="#_55">触发器配置</a></li><li><a href="#_71">构建后步骤配置</a></li><li><ul><li><a href="#_73">构建结果回评至码云</a></li><li><a href="#PR_80">构建成功自动合并PR</a></li></ul></li><li><a href="#WebHook_83">新建码云仓库WebHook</a></li><li><a href="#_94">测试触发构建</a></li><li><ul><li><a href="#_95">通过测试按钮触发构建</a></li><li><a href="#_98">测试推送触发构建</a></li><li><a href="#PR_104">测试PR触发构建</a></li></ul></li></ul></li></ul><h1>环境说明</h1><ul><li>系统版本：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&gt; <span class="built_in">cat</span> /etc/redhat-release</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&gt; CentOS Linux release 7.5.1804 (Core)</span></span><br></pre></td></tr></table></figure></li><li>Jenkins 版本<ul><li>Jenkins ver. 2.176.2</li></ul></li></ul><h1>插件安装</h1><ul><li>前往 Manage Jenkins -&gt; Manage Plugins -&gt; Available，在 Filter 中搜索 Gitee:<ul><li><img src="./images/GJ01.png" alt="在这里插入图片描述"></li></ul></li><li>下方可选列表中勾选 Gitee（如列表中不存在 Gitee，则点击 Check now 更新插件列表），然后点击“Download now and install after restart”。<ul><li><img src="./images/GJ02.png" alt="在这里插入图片描述"></li><li>在安装页面勾选“Restart Jenkins when installation is complete and no jobs are running”</li></ul></li><li>安装完之后，可以在 “installed” 页面看到 Gitee 插件<ul><li><img src="./images/GJ03.png" alt="在这里插入图片描述"></li></ul></li></ul><h1>插件配置</h1><h2 id="添加-Gitee-链接配置">添加 Gitee 链接配置</h2><ol><li>前往 Jenkins -&gt; Manage Jenkins -&gt; Configure System -&gt; Gitee 配置 -&gt; Gitee 链接</li><li>在 链接名 中输入 Gitee 或者你想要的名字</li><li>Gitee 域名 URL 中输入码云完整 URL地址： <a href="https://gitee.com">https://gitee.com</a> （码云私有化客户输入部署的域名）</li><li>证书令牌 中如还未配置码云 APIV5 私人令牌，点击 Add - &gt; Jenkins<ol><li>Domain 选择 全局凭据</li><li>Kind 选择 Gitee API 令牌</li><li>Scope 选择你需要的范围</li><li>Gitee API Token 输入你的码云私人令牌，获取地址：<a href="https://gitee.com/profile/personal_access_tokens">https://gitee.com/profile/personal_access_tokens</a></li><li>ID, Descripiton 中输入你想要的 ID 和描述即可。<br><img src="./images/GJ04.png" alt="在这里插入图片描述"></li></ol></li><li>Credentials 选择配置好的 Gitee APIV5 Token</li></ol><p><img src="./images/GJ05.png" alt="在这里插入图片描述"><br>6. 点击 Advanced ，可配置是否忽略 SSL 错误（适您的Jenkins环境是否支持），并可设置链接测超时时间（适您的网络环境而定）<br>7. 点击 Test Connection 测试链接是否成功，如失败请检查以上 3，5，6 步骤。<br><img src="./images/GJ06.png" alt="在这里插入图片描述"></p><h2 id="新建构建任务">新建构建任务</h2><ul><li>前往 Jenkins -&gt; New Item , name 输入 ‘Gitee Test’，选择 Freestyle project , 再点击 OK 即可创建构建项目。<ul><li><img src="./images/GJ07.png" alt="在这里插入图片描述"></li></ul></li></ul><h2 id="任务全局配置">任务全局配置</h2><ul><li>任务全局配置中需要选择前一步中的Gitee 链接。如图：<ul><li><img src="./images/GJ08.png" alt="在这里插入图片描述"></li></ul></li></ul><h2 id="源码管理配置">源码管理配置</h2><p>选择 Source Code Management 选项卡：</p><ol><li>点击 Git</li><li>输入你的仓库地址，例如 <a href="https://gitee.com/AndyWannaSing/hello-casstime-demo.git">https://gitee.com/AndyWannaSing/hello-casstime-demo.git</a><ol><li>点击 add-Jenkins，添加用户名和密码凭证（连接项目的时候需要用它做校验）</li><li>点击 Advanced 按钮, Name 字段中输入 origin， Refspec 字段输入 <code>+refs/heads/*:refs/remotes/origin/* +refs/pull/*/MERGE:refs/pull/*/MERGE</code><br><img src="./images/GJ09.png" alt="3."></li></ol></li><li>Branch Specifier 选项:<ol><li>对于单仓库工作流输入: origin/${giteeSourceBranch}</li><li>对于 PR 工作流输入: pull/${giteePullRequestIid}/MERGE</li></ol></li><li>Additional Behaviours 选项：<ol><li>对于单仓库工作流，如果你希望推送的分支构建前合并默认分支（发布的分支），可以做以下操作：<ol><li>点击 Add 下拉框</li><li>选择 Merge before build</li><li>设置 Name of repository 为 origin</li><li>设置 Branch to merge to 为 ${ReleaseBranch} 即您要合并的默认分支（发布分支）</li></ol></li><li>对于 PR 工作流，码云服务端已经将 PR 的原分支和目标分支作了预合并，您可以直接构建，如果目标分支不是默认分支（发布分支），您也可以进行上诉构建前合并。</li></ol></li></ol><h2 id="触发器配置">触发器配置</h2><p>选择 Build Triggers 选项卡：</p><ol><li>Enabled Gitee triggers 勾选您所需要的构建触发规则，如 Push Event, Opened Merge Request Events，勾选的事件会接受WebHook，触发构建。目前支持触发事件有：<ol><li>Push Events ：推送代码事件</li><li>Opened Merge Request Events ：提交 PR 事件</li><li>Updated Merge Request Events ：更新 PR 事件</li><li>Accepted Merge Request Events ：接受/合并 PR 事件</li><li>Closed Merge Request Events ：关闭 PR 事件</li><li>Approved Pull Requests ： 审查通过 PR 事件</li><li>Tested Pull Requests ：测试通过 PR 事件</li></ol></li><li>Enable [ci-skip] 该选项可以开启支持 [ci-skip] 指令，只要commit message 中包含 [ci-skip]，当前commit 即可跳过构建触发。</li><li>Ignore last commit has build 该选项可以跳过已经构建过的 Commit 版本。</li><li>Allowed branches 可以配置允许构建的分支，目前支持分支名和正则表达式的方式进行过滤。</li><li>Secret Token for Gitee WebHook 该选项可以配置 WebHook 的密码，该密码需要与码云 WebHook配置的密码一致方可触发构建。</li><li>注意：若 PR 状态为不可自动合并，则不触发构建。<br><img src="./images/GJ10.png" alt="在这里插入图片描述"></li></ol><h2 id="构建后步骤配置">构建后步骤配置</h2><p>选择 Post-build Actions 选项卡：</p><h3 id="构建结果回评至码云">构建结果回评至码云</h3><ol><li>点击 Add post-build action 下拉框选择 “将构建状态评论到 Gitee pull request 中”</li><li>Advanced 中可以配置：<ol><li>仅为构建失败回评到码云</li><li>自定义各状态的回评内容（内容可以引用 Jenkins 的环境变量，或者自定义的环境变量）</li></ol></li><li>若开启该功能，还可将不可自动合并的状态回评至码云<br><img src="./images/GJ11.png" alt="在这里插入图片描述"></li></ol><h3 id="构建成功自动合并PR">构建成功自动合并PR</h3><ol><li>点击 Add post-build action 下拉框选择 “当构建成功自动合并 Gitee 的 Pull Request”<br><img src="./images/GJ12.png" alt="在这里插入图片描述"></li></ol><h2 id="新建码云仓库WebHook">新建码云仓库WebHook</h2><p>进入源码管理配置中设置的码云仓库中，进入 管理 -&gt; WebHooks:</p><ul><li><img src="./images/GJ13.png" alt="在这里插入图片描述"></li></ul><ol><li>添加 WebHook， URL 填写 触发器配置的地址。</li><li>密码填写：触发器配置第 5 点中配置的 WebHook密码，不设密码可以不填</li><li>勾选 PUSH， Pull Request<br><img src="./images/GJ14.png" alt="在这里插入图片描述"></li></ol><p><img src="./images/GJ15.png" alt="在这里插入图片描述"><br>其中：<a href="http://7e2be7e8.ngrok.io/project/Gitee%20Test">http://7e2be7e8.ngrok.io/project/Gitee Test</a> 是外网的IP。（<a href="https://blog.csdn.net/liqing0013/article/details/80731757">内网转外网域名的方法</a>）<br><img src="./images/GJ16.png" alt="在这里插入图片描述"></p><h2 id="测试触发构建">测试触发构建</h2><h3 id="通过测试按钮触发构建">通过测试按钮触发构建</h3><ul><li><img src="./images/GJ17.png" alt="在这里插入图片描述"></li><li><img src="./images/GJ18.png" alt="在这里插入图片描述"></li></ul><h3 id="测试推送触发构建">测试推送触发构建</h3><ol><li>码云的 WebHook 管理中选择勾选了PUSH的 WebHook 点击测试，观察 Jenkins 任务的构建状态</li><li>码云仓库页面编辑一个文件提交，观察 Jenkins 任务的构建状态</li></ol><ul><li><img src="./images/GJ19.png" alt="在这里插入图片描述"></li><li><img src="./images/GJ20.png" alt="在这里插入图片描述"></li><li><img src="./images/GJ21.png" alt="在这里插入图片描述"></li></ul><h3 id="测试PR触发构建">测试PR触发构建</h3><ol><li>码云的 WebHook 管理中选择勾选了 Pull Request 的 WebHook 点击测试，观察 Jenkins 任务的构建状态</li><li>在码云仓库中新建一个Pull Request，观察 Jenkins 任务的构建状态</li></ol><p><img src="./images/GJ22.png" alt="在这里插入图片描述"><br><img src="./images/GJ23.png" alt="在这里插入图片描述"><br><img src="./images/GJ24.png" alt="在这里插入图片描述"></p><p><a href="https://blog.csdn.net/liqing0013/article/details/98031485">Gitee + Jenkins 配置</a></p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gitee-Jenkins集成 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>持续集成</title>
      <link href="/posts/aa63a9c4.html"/>
      <url>/posts/aa63a9c4.html</url>
      
        <content type="html"><![CDATA[<h3 id="持续继承-Continuous-Integration">持续继承 Continuous Integration</h3><p><img src="./images/CI.png" alt="持续集成"></p><ul><li>概念<ul><li>频繁地将代码集成到主干<ul><li>快速发现错误</li><li>防止分支大幅偏离主干</li></ul></li><li>让产品快速迭代，同时保证高质量</li></ul></li></ul><h3 id="持续交付">持续交付</h3><blockquote><p>频繁地将软件的新版本，交付给质量团队或者用户，以供评审[不论怎样，代码总是可交付的]</p></blockquote><h3 id="持续部署">持续部署</h3><blockquote><p>代码通过评审以后，自动部署到生产环境</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 持续集成 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lint Stage</title>
      <link href="/posts/88b9b050.html"/>
      <url>/posts/88b9b050.html</url>
      
        <content type="html"><![CDATA[<h3 id="Lint-Stage">Lint Stage</h3><p>lint-staged 是一个在<code>git暂存文件</code>上运行linters的工具，当然如果你觉得每次修改一个文件就给所有文件执行一次lint检查不恶心的话，这个工具对你来说就没有什么意义了，请直接关闭即可。</p><pre><code>npx mrm lint-staged</code></pre><p>它将根据<code>package.json</code>依赖项中的代码质量工具来安装和配置husky和<code>lint-staged</code>，因此请确保在此之前安装（<code>npm install --save-dev</code>）并配置所有代码质量工具，如Prettier和ESlint。</p><p>不要忘记提交对<code>package.json</code>的更改以与您的团队共享此设置！</p><p>现在更改一些文件，<code>git add</code>或<code>git add --patch</code>将其中一些文件修补到您的提交中，并尝试git提交它们。</p><h2 id="命令行标志">命令行标志</h2><pre><code>❯ npx lint-staged --help用法: lint-staged [options]Options:  -V, --version                      输出版本号  --allow-empty                      当任务撤消所有分阶段的更改时允许空提交（默认值：false）  -c, --config [path]                配置文件的路径  -d, --debug                        打印其他调试信息（默认值：false）  -p, --concurrent &lt;parallel tasks&gt;  要同时运行的任务数，或者为false则要连续运行任务（默认值：true）  -q, --quiet                        自己的控制台输出（默认值：false）  -r, --relative                     将相对文件路径传递给任务（默认值：false）  -x, --shell                        跳过任务解析以更好地支持shell（默认值：false）  -h, --help                         输出用法信息</code></pre><ul><li><code>--allow-empty</code>: 默认情况下，当LITER任务撤消所有阶段性的更改时，LITET阶段将退出一个错误，并中止提交。使用此标志允许创建空git提交。</li><li><code>--config [path]</code> : 手动指定配置文件或npm包名称的路径。注意：使用时，<code>lint-staged</code>不会执行配置文件搜索，如果找不到指定的文件，则会打印错误。</li><li><code>--debug</code> :在调试模式下运行。设置后，它将执行以下操作<ol><li>在内部使用<a href="https://github.com/visionmedia/debug">debug</a>记录有关暂存文件、正在执行的命令、二进制文件的位置等的其他信息。通过传递标志自动启用的调试日志也可以通过将环境变量<code>$DEBUG</code>设置为<code>lint-staged*</code>启用。</li><li>使用<a href="https://github.com/SamVerschueren/listr-verbose-renderer">verbose渲染程序</a>的listr; 这将导致串行无色输出到终端，而不是默认（美化，动态）输出。</li></ol></li><li><code>--concurrent [number | (true/false)]</code>: 控制由lint-staged运行的任务的并发性。注意：这不会影响子任务的并发性（它们将始终按顺序运行）。可能的值为：<ol><li><code>false</code>:依次运行所有任务</li><li><code>true</code>（默认）：无限并发。并行运行尽可能多的任务</li><li><code>&#123;number&#125;</code>：并行运行指定数量的任务，其中<code>1</code>等效于<code>false</code>。</li></ol></li><li><code>--quiet</code>:禁止所有CLI输出，但任务中除外。</li><li><code>--relative</code>: 将与<code>process.cwd()</code>（<code>lint-staged</code>运行）相关的文件路径传递给任务。默认值为<code>false</code>。</li><li><code>--shell</code> :默认情况下，将分析linter命令以提高速度和安全性。这具有常规shell脚本可能无法按预期工作的副作用。您可以使用此选项跳过命令解析。</li></ul><h2 id="配置">配置</h2><p>从v3.1开始，您现在可以使用不同的方式进行配置：</p><ul><li><code>lint-staged</code> 在你的对象 <code>package.json</code></li><li><code>.lintstagedrc</code> JSON或YML格式的文件</li><li><code>lint-staged.config.js</code> JS格式的文件</li><li>使用<code>--config</code>或<code>-c</code>标志传递配置文件</li></ul><p>配置应该是一个对象，其中每个值都是要运行的命令，其键是要用于此命令的glob模式。这个软件包使用<a href="https://github.com/micromatch/micromatch">micromatch</a>进行全局模式匹配。</p><p><code>package.json</code> 例:</p><pre><code>&#123;  &quot;lint-staged&quot;: &#123;    &quot;*&quot;: &quot;your-cmd&quot;  &#125;&#125;</code></pre><p><code>.lintstagedrc</code> 例：</p><pre><code>&#123;  &quot;*&quot;: &quot;your-cmd&quot;&#125;</code></pre><p>该配置将<code>your-cmd</code>使用作为参数传递的当前暂存文件的列表执行。</p><p>因此，考虑到您做了<code>git add file1.ext file2.ext</code>，<code>lint-staged</code>将运行以下命令：<br><code>your-cmd file1.ext file2.ext</code></p><h2 id="过滤文件">过滤文件</h2><p>Linter命令处理由glob模式定义的所有暂存文件的子集。<code>lint staged</code>使用<a href="https://github.com/micromatch/micromatch">micromatch</a>将文件与以下规则匹配：</p><ul><li>如果全局模式不包含斜杠（<code>/</code>），<code>matchBase</code>则将启用micromatch的选项，因此无论目录如何，全局匹配文件的基本名称：<ol><li><code>&quot;*.js&quot;</code>将匹配所有JS文件，例如<code>/test.js</code>和<code>/foo/bar/test.js</code><br>2. <code>&quot;!(*test).js&quot;</code>。将匹配所有以结尾的JS文件<code>test.js</code>，因此<code>foo.js</code>但不匹配<code>foo.test.js</code></li></ol></li><li>如果全局模式确实包含斜杠（<code>/</code>），则它也将与路径匹配：<ol><li><code>&quot;./*.js&quot;</code>将匹配git repo根目录中的所有JS文件，因此<code>/test.js</code>但不匹配<code>/foo/bar/test.js</code><br>2. <code>&quot;foo/**/\*.js&quot;</code>将匹配<code>/foo</code>目录中的所有JS文件，所以<code>/foo/bar/test.js</code>但不匹配<code>/test.js</code></li></ol></li></ul><p>匹配时，<code>lint-staged</code>将执行以下操作</p><ul><li>自动解决git root，无需配置。</li><li>选择项目目录中存在的暂存文件。</li><li>使用指定的glob模式过滤它们。</li><li>将绝对路径传递给linters作为参数。</li></ul><p>注意： <code>lint-staged</code>将绝对路径传递给linter，以免在其他工作目录（例如，您的<code>.git</code>目录与您的<code>package.json</code>目录不同）中执行时产生混淆。</p><h2 id="忽略文件">忽略文件</h2><p><code>lint-staged</code>的概念是在git中暂存的文件上运行已配置的linter（或其他）任务。<code>lint-staged</code>总是将所有暂存文件的列表传递给任务，忽略任何文件都应该在任务本身中配置。</p><p>考虑一个prettier用于使代码格式在所有文件中保持一致的项目。 项目还将缩小的第三方供应商库存储在<code>vendor/</code>目录中。为了防止prettier在这些文件上抛出错误，应该将供应商目录添加到prettier的忽略配置<code>.prettierignore</code>文件中。运行<code>npx prettier .</code> 。将忽略整个供应商目录，不会引发错误。当<code>lint-staged</code>被添加到项目并配置为运行prettier时，prettier将忽略供应商目录中所有修改的和暂存的文件，即使它将它们作为输入接收。</p><p>在高级方案中，如果无法将linter任务本身配置为忽略文件，但<code>lint-staged</code>仍应忽略某些暂存文件，则可以在使用函数语法将文件路径传递给任务之前对其进行筛选。请参见<a href="https://github.com/okonet/lint-staged#example-ignore-files-from-match">示例：忽略match中的文件</a>。</p><h2 id="支持哪些命令？">支持哪些命令？</h2><p>支持通过本地或全局安装的任何可执行文件<code>npm</code>，以及<code>$PATH</code>中的任何可执行文件。</p><p>不建议使用全局安装的脚本，因为对于没有安装脚本的人，<code>lint-staged</code>可能不起作用。</p><p><code>lint-staged</code>使用<a href="https://github.com/sindresorhus/execa#preferlocal">execa</a>查找本地安装的脚本。因此，您<code>.lintstagedrc</code>可以编写：</p><pre><code>&#123;   &quot;*.js&quot;: &quot;eslint --fix&quot;&#125;</code></pre><h2 id="依次运行多个命令">依次运行多个命令</h2><p>可以在每个glob上按顺序运行多个命令。为此，请传递一个命令数组而不是单个命令。这对于运行诸如<code>eslint --fix</code>或<code>stylefmt</code>之类的自动格式化工具很有用，但可以用于任何任意序列。</p><p>例如：</p><pre><code>&#123;  &quot;*.js&quot;: [&quot;eslint&quot;, &quot;prettier --write&quot;]&#125;</code></pre><p>要执行esLIt，如果它用<code>0</code>个代码退出，它将执行<code>prettier --write</code> 所有暂存的<code>*.js</code>文件。</p><h2 id="使用JS函数自定义任务">使用JS函数自定义任务</h2><p>当以JS格式提供配置时，可以将任务定义为一个函数，该函数将接收一个分段文件名/路径数组，并应以字符串形式返回完整的命令。也可以返回一个完整的命令字符串数组，例如当任务只支持单个文件输入时。函数可以是sync或async。</p><pre><code>type TaskFn = (filenames: string[]) =&gt; string | string[] | Promise&lt;string | string[]&gt;</code></pre><p><strong>示例：将文件名用单引号引起来，并在每个文件中运行一次</strong></p><pre><code>// .lintstagedrc.jsmodule.exports = &#123;  '**/*.js?(x)': filenames =&gt; filenames.map(filename =&gt; `prettier --write '$&#123;filename&#125;'`)&#125;</code></pre><p><strong>示例：运行<code>tsc</code>对TypeScript文件的更改，但不传递任何文件名参数</strong></p><pre><code>// lint-staged.config.jsmodule.exports = &#123;  '**/*.ts?(x)': () =&gt; 'tsc -p tsconfig.json --noEmit'&#125;</code></pre><p><strong>示例：如果超过10个暂存文件，则在整个存储库上运行eslint</strong></p><pre><code>// .lintstagedrc.jsmodule.exports = &#123;  '**/*.js?(x)': filenames =&gt; (filenames.length &gt; 10 ? 'eslint .' : `eslint $&#123;filenames.join(' ')&#125;`)&#125;</code></pre><p><strong>示例：使用自己的全局</strong></p><pre><code>// lint-staged.config.jsconst micromatch = require('micromatch')module.exports = &#123;  '*': allFiles =&gt; &#123;    const match = micromatch(allFiles, ['*.js', '*.ts'])    return `eslint $&#123;match.join(' ')&#125;`  &#125;&#125;</code></pre><p><strong>示例：忽略匹配文件</strong><br>如果出于某种原因要忽略全局匹配中的文件，则可以使用<code>micromatch.not()</code>：</p><pre><code>// lint-staged.config.jsconst micromatch = require('micromatch')module.exports = &#123;  '*.js': files =&gt; &#123;    // from `files` filter those _NOT_ matching `*test.js`    const match = micromatch.not(files, '*test.js')    return `eslint $&#123;match.join(' ')&#125;`  &#125;&#125;</code></pre><p>请注意，在大多数情况下，全局效果可以达到相同的效果。对于上面的示例，匹配的glob为<code>!(*test).js</code>。</p><p>** 示例：对命令使用相对路径 **</p><pre><code>const path = require('path')module.exports = &#123;  '*.ts': absolutePaths =&gt; &#123;    const cwd = process.cwd()    const relativePaths = absolutePaths.map(file =&gt; path.relative(cwd, file))    return `ng lint myProjectName --files $&#123;relativePaths.join(' ')&#125;`  &#125;&#125;</code></pre><h2 id="重新格式化代码">重新格式化代码</h2><p>像Prettier、ESLint/TSLint或stylelint这样的工具可以根据适当的配置重新格式化代码，方法是运行<code>Prettier--write</code> / <code>ESLint --fix</code> / <code>TSLint --fix</code> / <code>stylelint --fix</code>。只要没有错误,<code>lint-staged</code>将自动向提交添加任何修改。</p><pre><code>&#123;  &quot;*.js&quot;: &quot;prettier --write&quot;&#125;</code></pre><p>在版本10之前，<code>git add</code>作为最后一步，必须手动包含任务。此行为已集成到lint阶段本身中，以防止多个任务编辑同一文件时出现争用情况。如果<code>lint-staged</code> <code>git add</code>在任务配置中检测到，它将在控制台中显示警告。<code>git add</code>升级后，请从您的配置中删除。</p><h2 id="例子">例子</h2><p>假设您已经在中设置了lint-staged和husky的所有示例<code>package.json</code>。</p><pre><code>&#123;  &quot;name&quot;: &quot;My project&quot;,  &quot;version&quot;: &quot;0.1.0&quot;,  &quot;scripts&quot;: &#123;    &quot;my-custom-script&quot;: &quot;linter --arg1 --arg2&quot;  &#125;,  &quot;husky&quot;: &#123;    &quot;hooks&quot;: &#123;      &quot;pre-commit&quot;: &quot;lint-staged&quot;    &#125;  &#125;,  &quot;lint-staged&quot;: &#123;    &quot;*.&#123;js&#125;&quot;: [      &quot;eslint --cache --fix&quot;,      &quot;prettier --write&quot;    ],    &quot;*.css&quot;: [      &quot;stylelint --cache --fix&quot;,      &quot;prettier --write&quot;    ]  &#125;&#125;</code></pre><p>注意，我们不将路径作为命令调用时的参数传递。这一点很重要，因为lint-stage将为您完成这一点。</p><p><strong>具有默认参数的ESLint <code>*.js</code>并<code>*.jsx</code>作为预提交挂钩运行</strong></p><pre><code>&#123;  &quot;*.&#123;js,jsx&#125;&quot;: &quot;eslint&quot;&#125;</code></pre><p><strong>自动修复代码样式<code>--fix</code>并添加提交</strong></p><pre><code>&#123;  &quot;*.js&quot;: &quot;eslint --fix&quot;&#125;</code></pre><p>这将运行<code>eslint --fix</code>并自动向提交添加更改。</p><p><strong>重用npm脚本</strong></p><p>如果您想重用<code>package.json</code>中定义的npm脚本：</p><pre><code>&#123;  &quot;*.js&quot;: &quot;npm run my-custom-script --&quot;&#125;</code></pre><p>以下是等效的：</p><pre><code>&#123;  &quot;*.js&quot;: &quot;linter --arg1 --arg2&quot;&#125;</code></pre><p><strong>在linting命令中使用环境变量</strong><br>Linting命令不支持扩展环境变量的Shell约定。要自己启用该约定，请使用诸如之类的工具<a href="https://github.com/kentcdodds/cross-env">cross-env</a>。</p><p>例如，此处<code>jest</code>正在<code>.js</code>将<code>NODE_ENV</code>变量设置为的所有文件上运行<code>&quot;test&quot;</code>：</p><pre><code>&#123;  &quot;*.js&quot;: [&quot;cross-env NODE_ENV=test jest --bail --findRelatedTests&quot;]&#125;</code></pre><p><strong>使用<code>prettier</code>自动修复<code>javascript</code>、<code>typescript</code>、<code>markdown</code>、<code>HTML</code>或<code>CSS</code>的代码样式</strong></p><pre><code>&#123;  &quot;*.&#123;js,jsx,ts,tsx,md,html,css&#125;&quot;: &quot;prettier --write&quot;&#125;</code></pre><p><strong>Stylelint用于具有默认值的CSS和具有SCSS语法的SCSS</strong></p><pre><code>&#123;  &quot;*.css&quot;: &quot;stylelint&quot;,  &quot;*.scss&quot;: &quot;stylelint --syntax=scss&quot;&#125;</code></pre><p><strong>运行PostCSS排序和Stylelint进行检查</strong></p><pre><code>&#123;  &quot;*.scss&quot;: [&quot;postcss --config path/to/your/config --replace&quot;, &quot;stylelint&quot;]&#125;</code></pre><p><strong>缩小图像</strong></p><pre><code>&#123;  &quot;*.&#123;png,jpeg,jpg,gif,svg&#125;&quot;: &quot;imagemin-lint-staged&quot;&#125;</code></pre><p><code>imagemin-lint-staged</code>是一个CLI工具，专门用于具有合理默认值的lint-staged使用。</p><p><strong>使用流对您的暂存文件进行类型检查</strong></p><pre><code>&#123;  &quot;*.&#123;js,jsx&#125;&quot;: &quot;flow focus-check&quot;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lint Stage </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prettier</title>
      <link href="/posts/1a427ddd.html"/>
      <url>/posts/1a427ddd.html</url>
      
        <content type="html"><![CDATA[<h3 id="代码规范">代码规范</h3><ul><li>Git Prettier 集成</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;gitHooks&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;pre-commit&quot;</span>: <span class="string">&quot;lint-staged&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;*.&#123;js,jsx,less,md,json&#125;&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;prettier --write&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;*.ts?(x)&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;prettier --parser=typescript --write&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>执行说明：<br>pre-commit钩子在 git commit 执行时被触发，执行npm run pre-commit脚本（即lint-staged命令）；</p><p>lint-staged的配置，就是利用prettier对暂存区的文件路径应用过滤规则，匹配的文件将执行后面配置的任务，这里的任务就是 prettier --write 执行代码格式化</p><ul><li>prettierrc</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">printWidth: <span class="number">80</span>, <span class="regexp">//</span>单行长度</span><br><span class="line">tabWidth: <span class="number">2</span>, <span class="regexp">//</span>缩进长度</span><br><span class="line">useTabs: false, <span class="regexp">//</span>使用空格代替tab缩进</span><br><span class="line">semi: true, <span class="regexp">//</span>句末使用分号</span><br><span class="line">singleQuote: true, <span class="regexp">//</span>使用单引号</span><br><span class="line">quoteProps: <span class="string">&#x27;as-needed&#x27;</span>, <span class="regexp">//</span>仅在必需时为对象的key添加引号</span><br><span class="line">jsxSingleQuote: true, <span class="regexp">//</span> jsx中使用单引号</span><br><span class="line">trailingComma: <span class="string">&#x27;all&#x27;</span>, <span class="regexp">//</span>多行时尽可能打印尾随逗号</span><br><span class="line">bracketSpacing: true, <span class="regexp">//</span>在对象前后添加空格-eg: &#123; foo: bar &#125;</span><br><span class="line">jsxBracketSameLine: true, <span class="regexp">//</span>多属性html标签的‘&gt;’折行放置</span><br><span class="line">arrowParens: <span class="string">&#x27;always&#x27;</span>, <span class="regexp">//</span>单参数箭头函数参数周围使用圆括号-eg: (x) =&gt; x</span><br><span class="line">requirePragma: false, <span class="regexp">//</span>无需顶部注释即可格式化</span><br><span class="line">insertPragma: false, <span class="regexp">//</span>在已被preitter格式化的文件顶部加上标注</span><br><span class="line">proseWrap: <span class="string">&#x27;preserve&#x27;</span>, <span class="regexp">//</span>不知道怎么翻译</span><br><span class="line">htmlWhitespaceSensitivity: <span class="string">&#x27;ignore&#x27;</span>, <span class="regexp">//</span>对HTML全局空白不敏感</span><br><span class="line">vueIndentScriptAndStyle: false, <span class="regexp">//</span>不对vue中的script及style标签缩进</span><br><span class="line">endOfLine: <span class="string">&#x27;lf&#x27;</span>, <span class="regexp">//</span>结束行形式</span><br><span class="line">embeddedLanguageFormatting: <span class="string">&#x27;auto&#x27;</span>, <span class="regexp">//</span>对引用代码进行格式化</span><br><span class="line"></span><br><span class="line">overrides作用是指定A类文件使用B类文件作为分析器</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/*  prettier的配置 */</span></span><br><span class="line"><span class="string">&quot;prettier.printWidth&quot;</span>: <span class="number">100</span>, <span class="regexp">//</span> 超过最大值换行</span><br><span class="line"><span class="string">&quot;prettier.tabWidth&quot;</span>: <span class="number">4</span>, <span class="regexp">//</span> 缩进字节数</span><br><span class="line"><span class="string">&quot;prettier.useTabs&quot;</span>: false, <span class="regexp">//</span> 缩进不使用tab，使用空格</span><br><span class="line"><span class="string">&quot;prettier.semi&quot;</span>: true, <span class="regexp">//</span> 句尾添加分号</span><br><span class="line"><span class="string">&quot;prettier.singleQuote&quot;</span>: true, <span class="regexp">//</span> 使用单引号代替双引号</span><br><span class="line"><span class="string">&quot;prettier.proseWrap&quot;</span>: <span class="string">&quot;preserve&quot;</span>, <span class="regexp">//</span> 默认值。因为使用了一些折行敏感型的渲染器（如GitHub comment）而按照markdown文本样式进行折行</span><br><span class="line"><span class="string">&quot;prettier.arrowParens&quot;</span>: <span class="string">&quot;avoid&quot;</span>, <span class="regexp">//</span>  (x) =&gt; &#123;&#125; 箭头函数参数只有一个时是否要有小括号。avoid：省略括号</span><br><span class="line"><span class="string">&quot;prettier.bracketSpacing&quot;</span>: true, <span class="regexp">//</span> 在对象，数组括号与文字之间加空格 <span class="string">&quot;&#123; foo: bar &#125;&quot;</span></span><br><span class="line"><span class="string">&quot;prettier.disableLanguages&quot;</span>: [<span class="string">&quot;ts&quot;</span>], <span class="regexp">//</span> 不格式化ts文件，ts文件的格式化单独设置</span><br><span class="line"><span class="string">&quot;prettier.endOfLine&quot;</span>: <span class="string">&quot;auto&quot;</span>, <span class="regexp">//</span> 结尾是 \n \r \n\r auto</span><br><span class="line"><span class="string">&quot;prettier.eslintIntegration&quot;</span>: false, <span class="regexp">//</span>不让prettier使用eslint的代码格式进行校验</span><br><span class="line"><span class="string">&quot;prettier.htmlWhitespaceSensitivity&quot;</span>: <span class="string">&quot;ignore&quot;</span>,</span><br><span class="line"><span class="string">&quot;prettier.ignorePath&quot;</span>: <span class="string">&quot;.prettierignore&quot;</span>, <span class="regexp">//</span> 不使用prettier格式化的文件填写在项目的.prettierignore文件中</span><br><span class="line"><span class="string">&quot;prettier.jsxBracketSameLine&quot;</span>: false, <span class="regexp">//</span> 在jsx中把<span class="string">&#x27;&gt;&#x27;</span> 是否单独放一行</span><br><span class="line"><span class="string">&quot;prettier.jsxSingleQuote&quot;</span>: false, <span class="regexp">//</span> 在jsx中使用单引号代替双引号</span><br><span class="line"><span class="string">&quot;prettier.parser&quot;</span>: <span class="string">&quot;babylon&quot;</span>, <span class="regexp">//</span> 格式化的解析器，默认是babylon</span><br><span class="line"><span class="string">&quot;prettier.requireConfig&quot;</span>: false, <span class="regexp">//</span> Require a <span class="string">&#x27;prettierconfig&#x27;</span> to format prettier</span><br><span class="line"><span class="string">&quot;prettier.stylelintIntegration&quot;</span>: false, <span class="regexp">//</span>不让prettier使用stylelint的代码格式进行校验</span><br><span class="line"><span class="string">&quot;prettier.trailingComma&quot;</span>: <span class="string">&quot;es5&quot;</span>, <span class="regexp">//</span> 在对象或数组最后一个元素后面是否加逗号（在ES5中加尾逗号）</span><br><span class="line"><span class="string">&quot;prettier.tslintIntegration&quot;</span>: false <span class="regexp">//</span> 不让prettier使用tslint的代码格式进行校验</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Prettier </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rollup</title>
      <link href="/posts/d9966eb3.html"/>
      <url>/posts/d9966eb3.html</url>
      
        <content type="html"><![CDATA[<h3 id="Rollup">Rollup</h3><blockquote><p>一款 ES Modules 打包器。可以将项目中散落的细小模块打包为整块代码，从而使得这些划分的模块可以更好的运行在浏览器环境或者 Node.js 环境。</p></blockquote><p>从作用上来看，Rollup 与 Webpack 非常类似。不过相比于 Webpack，Rollup 要小巧的多。因为 Webpack 在配合一些插件的使用下，几乎可以完成开发过程中，前端工程化的绝大多数工作。而 Rollup 可以说仅仅是一个 ESM 打包器，没有其它。</p><p>iife: 自调用函数</p><p>默认开启 tree sharking</p><p>有 2 种方法引入外部资源：<br>添加插件 @rollup/plugin-node-resolve 将我们编写的源码与依赖的第三方库进行合并；<br>配置 external 属性，告诉 rollup.js 哪些是外部的类库。</p><p>rollup-plugin-terser: 生成压缩的 bundle<br>@rollup/plugin-commonjs: 转化 commonJS 到 ESM<br>less-plugin-npm-import：增加了从npm包导入less的功能<br>rollup-plugin-external-globals： 将外部导入转换为全局变量，如Rollup的output.globals选项</p><p>rollup-plugin-node-resolve： 使用 “node 解析算法” 来定位模块，用于使用 node_modules 中的第三方模块<br>rollup-plugin-postcss: Rollup和PostCSS之间的无缝集成</p><p><strong>开发规范</strong><br>amd: requireJS 规范<br>commonJS 规范</p><p><strong>优点</strong></p><ul><li>输出结果更加扁平</li><li>自动移除未引用代码</li><li>打包结果依然完全可读</li></ul><p><strong>缺点</strong></p><ul><li>加载非ESM 的第三方模块比较复杂</li><li>模块最终被打包到一个函数中，无法实现HMR</li><li>浏览器环境中，代码拆分功能依赖AMD库</li></ul><p><strong>结论</strong></p><ul><li>开发框架和类库 推荐Rollup、应用程序 推荐 Webpack</li><li>Webpack 大而全、Rollup 小而美</li></ul><p>参考链接<br><a href="https://juejin.cn/post/7145090564801691684">https://juejin.cn/post/7145090564801691684</a></p><h3 id="Parcel">Parcel</h3><blockquote><p>零配置前端应用打包器</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rollup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vitejs</title>
      <link href="/posts/4c4c7e8.html"/>
      <url>/posts/4c4c7e8.html</url>
      
        <content type="html"><![CDATA[<h1>Vite 新型前端构建工具</h1><blockquote><p>一个开发服务器, 基于 <code>原生 ESM 模块 </code>,提供<code>丰富的内建功能</code>。如 HMR</p><p>使用 Rollup 进行构建，预配置，可输出生产环境静态资源</p></blockquote><h3 id="特点">特点</h3><ul><li>快速启动<ul><li>使用原生 ESM 文件，无需打包!</li></ul></li><li><h2 id="轻量快速的模块热更新">轻量快速的模块热更新</h2></li><li><h2 id="按需编译">按需编译</h2></li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 先启动dev-server(基于 <span class="code">`connect`</span> 模块)，根据路由加载 ES Module 模块</span><br><span class="line"><span class="bullet">2.</span> 启动时先将加载内容进行转换(浏览器根据 content-type 解析返回的文件内容)</span><br><span class="line"><span class="bullet">3.</span> 基于 rollup 做生产构建</span><br></pre></td></tr></table></figure><h3 id="依赖预构建">依赖预构建</h3><ul><li>提高页面加载速度、并且将CommonJS UMD 转化为 ESM 格式，由esbuild 来执行，使得vite 冷启动时间比任何JS打包器都要快</li><li>重写导入为合法的URL</li><li>依赖或配置变化时执行于构建</li></ul>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vitejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vitejs 配置说明</title>
      <link href="/posts/4c4c7e8.html"/>
      <url>/posts/4c4c7e8.html</url>
      
        <content type="html"><![CDATA[<h2 id="vite-config-js-配置说明">vite.config.js 配置说明</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="comment">//项目根目录</span></span><br><span class="line">  <span class="attr">root</span>: process.<span class="title function_">cwd</span>(),</span><br><span class="line">  <span class="comment">//项目部署的基础路径</span></span><br><span class="line">  <span class="attr">base</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  <span class="comment">//环境配置 &#x27;development&#x27;|&#x27;production&#x27;</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="comment">//全局常量替换 Record&lt;string, string&gt;</span></span><br><span class="line">  <span class="attr">define</span>: &#123;</span><br><span class="line">    <span class="string">&quot;&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">user</span>: <span class="string">&quot;users&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="comment">//静态资源服务的文件夹</span></span><br><span class="line">  <span class="attr">publicDir</span>: <span class="string">&quot;public&quot;</span>,</span><br><span class="line">  <span class="comment">//存储缓存文件的目录</span></span><br><span class="line">  <span class="attr">cacheDir</span>: <span class="string">&quot;node_modules/.vite&quot;</span>,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="comment">//别名</span></span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;/src&quot;</span>),</span><br><span class="line">      <span class="attr">comps</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;/src/components&quot;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">dedupe</span>: [],</span><br><span class="line">    <span class="comment">//解决程序包中package.json配置中的exports 字段</span></span><br><span class="line">    <span class="attr">conditions</span>: [],</span><br><span class="line">    <span class="comment">//解析package.json中字段的优先级</span></span><br><span class="line">    <span class="attr">mainFields</span>: [<span class="string">&quot;module&quot;</span>, <span class="string">&quot;jsnext:main&quot;</span>, <span class="string">&quot;jsnext&quot;</span>],</span><br><span class="line">    <span class="comment">//导入时想要省略的扩展名列表</span></span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.mjs&quot;</span>, <span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.jsx&quot;</span>, <span class="string">&quot;.tsx&quot;</span>, <span class="string">&quot;.json&quot;</span>],</span><br><span class="line">    <span class="comment">//使Vite通过原始文件路径而不是真正的文件路径确定文件身份</span></span><br><span class="line">    <span class="attr">preserveSymlinks</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="comment">//配置 CSS modules 的行为。选项将被传递给 postcss-modules。</span></span><br><span class="line">    <span class="attr">modules</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">// PostCSS 配置（格式同 postcss.config.js）</span></span><br><span class="line">    <span class="comment">// postcss-load-config 的插件配置</span></span><br><span class="line">    <span class="attr">postcss</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//指定传递给 CSS 预处理器的选项</span></span><br><span class="line">    <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">      <span class="attr">scss</span>: &#123;</span><br><span class="line">        <span class="attr">additionalData</span>: <span class="string">`$injectedColor: orange;`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//开发过程中是否启sourcemap</span></span><br><span class="line">    <span class="attr">devSourcemap</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">json</span>: &#123;</span><br><span class="line">    <span class="comment">//是否支持从 .json 文件中进行按名导入</span></span><br><span class="line">    <span class="attr">namedExports</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//若设置为 true，导入的 JSON 会被转换为 export default JSON.parse(&quot;...&quot;) 会比转译成对象字面量性能更好，</span></span><br><span class="line">    <span class="attr">stringify</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//继承自 esbuild 转换选项。最常见的用例是自定义 JSX</span></span><br><span class="line">  <span class="attr">esbuild</span>: &#123;</span><br><span class="line">    <span class="attr">jsxFactory</span>: <span class="string">&quot;h&quot;</span>,</span><br><span class="line">    <span class="attr">jsxFragment</span>: <span class="string">&quot;Fragment&quot;</span>,</span><br><span class="line">    <span class="attr">jsxInject</span>: <span class="string">`import React from &#x27;react&#x27;`</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//静态资源处理  字符串|正则表达式</span></span><br><span class="line">  <span class="attr">assetsInclude</span>: [<span class="string">&quot;**/*.gltf&quot;</span>],</span><br><span class="line">  <span class="comment">//调整控制台输出的级别 &#x27;info&#x27; | &#x27;warn&#x27; | &#x27;error&#x27; | &#x27;silent&#x27;</span></span><br><span class="line">  <span class="attr">logLevel</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">  <span class="comment">//设为 false 可以避免 Vite 清屏而错过在终端中打印某些关键信息</span></span><br><span class="line">  <span class="attr">clearScreen</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//加载 .env 文件的目录</span></span><br><span class="line">  <span class="attr">envDir</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="comment">//envPrefix开头的环境变量会通过import.meta.env暴露客户端源码</span></span><br><span class="line">  <span class="attr">envPrefix</span>: <span class="string">&quot;VITE_&quot;</span>,</span><br><span class="line">  <span class="comment">//设置&#x27;spa&#x27; | &#x27;mpa&#x27; | &#x27;custom&#x27;应用操作</span></span><br><span class="line">  <span class="attr">appType</span>: <span class="string">&quot;spa&quot;</span>,</span><br><span class="line">  <span class="comment">//服务</span></span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="comment">//服务器主机名</span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">    <span class="comment">//端口号</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;5173&quot;</span>,</span><br><span class="line">    <span class="comment">//设为 true 时若端口已被占用则会直接退出，而不是尝试下一个可用端口</span></span><br><span class="line">    <span class="attr">strictPort</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//https.createServer()配置项</span></span><br><span class="line">    <span class="attr">https</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="comment">//服务器启动时自动在浏览器中打开应用程序。</span></span><br><span class="line">    <span class="attr">open</span>: <span class="string">&quot;/docs/index.html&quot;</span>,</span><br><span class="line">    <span class="comment">//自定义代理规则</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="comment">// 字符串简写写法</span></span><br><span class="line">      <span class="string">&quot;/foo&quot;</span>: <span class="string">&quot;http://localhost:4567&quot;</span>,</span><br><span class="line">      <span class="comment">// 选项写法</span></span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/api/</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 正则表达式写法</span></span><br><span class="line">      <span class="string">&quot;^/fallback/.*&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/fallback/</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 使用 proxy 实例</span></span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configure</span>: <span class="function">(<span class="params">proxy, options</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// proxy 是 &#x27;http-proxy&#x27; 的实例</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// Proxying websockets or socket.io</span></span><br><span class="line">      <span class="string">&quot;/socket.io&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;ws://localhost:3000&quot;</span>,</span><br><span class="line">        <span class="attr">ws</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//开发服务器配置 CORS</span></span><br><span class="line">    <span class="attr">cors</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//指定服务器响应的 header ,类型OutgoingHttpHeaders</span></span><br><span class="line">    <span class="attr">header</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//禁用或配置 HMR 连接</span></span><br><span class="line">    <span class="attr">hmr</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//传递给 chokidar 的文件系统监视器选项</span></span><br><span class="line">    <span class="attr">watch</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//中间件模式创建 Vite 服务器,&#x27;ssr&#x27; | &#x27;html&#x27;</span></span><br><span class="line">    <span class="attr">middlewareMode</span>: <span class="string">&quot;ssr&quot;</span>,</span><br><span class="line">    <span class="comment">//HTTP请求中预留此文件夹，用于代理 Vite 作为子文件夹时使用。</span></span><br><span class="line">    <span class="attr">base</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">fs</span>: &#123;</span><br><span class="line">      <span class="comment">//限制为工作区 root 路径以外的文件的访问</span></span><br><span class="line">      <span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">//限制哪些文件可以通过 /@fs/ 路径提供服务</span></span><br><span class="line">      <span class="attr">allow</span>: [</span><br><span class="line">        <span class="comment">// 搜索工作区的根目录</span></span><br><span class="line">        <span class="title function_">searchForWorkspaceRoot</span>(process.<span class="title function_">cwd</span>()),</span><br><span class="line">        <span class="comment">// 自定义规则</span></span><br><span class="line">        <span class="string">&quot;/path/to/custom/allow&quot;</span>,</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">//限制Vite开发服务器提供敏感文件的黑名单</span></span><br><span class="line">      <span class="attr">deny</span>: [<span class="string">&quot;.env&quot;</span>, <span class="string">&quot;.env.*&quot;</span>, <span class="string">&quot;*.&#123;pem,crt&#125;&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//定义开发调试阶段生成资产的url</span></span><br><span class="line">    <span class="attr">origin</span>: <span class="string">&quot;http://127.0.0.1:8080&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//构建</span></span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="comment">//浏览器兼容性  &quot;esnext&quot;|&quot;modules&quot;</span></span><br><span class="line">    <span class="attr">target</span>: <span class="string">&quot;modules&quot;</span>,</span><br><span class="line">    <span class="comment">//否自动注入 module preload 的 polyfill</span></span><br><span class="line">    <span class="attr">polyfillModulePreload</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//输出路径</span></span><br><span class="line">    <span class="attr">outDir</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">    <span class="comment">//生成静态资源的存放路径</span></span><br><span class="line">    <span class="attr">assetsDir</span>: <span class="string">&quot;assets&quot;</span>,</span><br><span class="line">    <span class="comment">//小于此阈值的导入或引用资源将内联为 base64 编码，以避免额外的 http 请求。设置为 0 可以完全禁用此项</span></span><br><span class="line">    <span class="attr">assetsInlineLimit</span>: <span class="number">4096</span>,</span><br><span class="line">    <span class="comment">//启用/禁用 CSS 代码拆分</span></span><br><span class="line">    <span class="attr">cssCodeSplit</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//不同的浏览器target设置CSS的压缩</span></span><br><span class="line">    <span class="attr">cssTarget</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="comment">//构建后是否生成 source map 文件</span></span><br><span class="line">    <span class="comment">//boolean | &#x27;inline&#x27; | &#x27;hidden&#x27;</span></span><br><span class="line">    <span class="attr">sourcemap</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">//自定义底层的 Rollup 打包配置</span></span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="comment">//要打包的文件路径</span></span><br><span class="line">      <span class="attr">input</span>: <span class="string">&quot;src/main.js&quot;</span>,</span><br><span class="line">      <span class="comment">//文件输出位置</span></span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">//打包生产文件路径</span></span><br><span class="line">        <span class="attr">file</span>: <span class="string">&quot;dist/index.js&quot;</span>,</span><br><span class="line">        <span class="comment">//打包输出格式</span></span><br><span class="line">        <span class="comment">// &quot;amd&quot;, &quot;cjs&quot;, &quot;system&quot;, &quot;es&quot;, &quot;iife&quot; or &quot;umd</span></span><br><span class="line">        <span class="attr">format</span>: <span class="string">&quot;cjs&quot;</span>,</span><br><span class="line">        <span class="comment">//包的全部变量名称</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;bundleName&quot;</span>,</span><br><span class="line">        <span class="comment">//声明全局变量</span></span><br><span class="line">        <span class="attr">globals</span>: &#123;</span><br><span class="line">          <span class="attr">jquery</span>: <span class="string">&quot;$&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//插件</span></span><br><span class="line">      <span class="attr">plugins</span>: [],</span><br><span class="line">      <span class="comment">//不需打包的文件</span></span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&quot;lodash&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//@rollup/plugin-commonjs 插件的选项</span></span><br><span class="line">    <span class="attr">commonjsOptions</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//@rollup/plugin-dynamic-import-vars 选项</span></span><br><span class="line">    <span class="attr">dynamicImportVarsOptions</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//构建的库</span></span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;lib/main.js&quot;</span>),</span><br><span class="line">      <span class="comment">//暴露的全局变量</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;mylib&quot;</span>,</span><br><span class="line">      <span class="comment">//&#x27;es&#x27; | &#x27;cjs&#x27; | &#x27;umd&#x27; | &#x27;iife&#x27;</span></span><br><span class="line">      <span class="attr">formats</span>: <span class="string">&quot;es&quot;</span>,</span><br><span class="line">      <span class="comment">//输出的包文件名</span></span><br><span class="line">      <span class="attr">fileName</span>: <span class="string">&quot;my-lib&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//当设置为 true，构建后将会生成 manifest.json 文件</span></span><br><span class="line">    <span class="attr">manifest</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">//当设置为 true，构建后将会生成SSR的manifest.json 文件</span></span><br><span class="line">    <span class="attr">ssrManifest</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">//生成面向 SSR 的构建</span></span><br><span class="line">    <span class="attr">ssr</span>: <span class="string">&quot;undefined&quot;</span>,</span><br><span class="line">    <span class="comment">//设置为 false 可以禁用最小化混淆，</span></span><br><span class="line">    <span class="comment">//boolean | &#x27;terser&#x27; | &#x27;esbuild&#x27;</span></span><br><span class="line">    <span class="attr">minify</span>: <span class="string">&quot;esbuild&quot;</span>,</span><br><span class="line">    <span class="comment">//传递给 Terser 的更多 minify 选项。</span></span><br><span class="line">    <span class="attr">terserOptions</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//设置为 false 来禁用将构建后的文件写入磁盘</span></span><br><span class="line">    <span class="attr">write</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//默认情况下，若 outDir 在 root 目录下，则 Vite 会在构建时清空该目录。</span></span><br><span class="line">    <span class="attr">emptyOutDir</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//启用/禁用 gzip 压缩大小报告</span></span><br><span class="line">    <span class="attr">reportCompressedSize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//触发警告的 chunk 大小（以 kbs 为单位）</span></span><br><span class="line">    <span class="attr">chunkSizeWarningLimit</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="comment">//设置为 &#123;&#125; 则会启用 rollup 的监听器</span></span><br><span class="line">    <span class="attr">watch</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//开发服务器</span></span><br><span class="line">  <span class="attr">preview</span>: &#123;</span><br><span class="line">    <span class="comment">//开发服务器主机名</span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">    <span class="comment">//开发服务器端口号</span></span><br><span class="line">    <span class="attr">port</span>: <span class="string">&quot;5173&quot;</span>,</span><br><span class="line">    <span class="comment">//设为 true 时若端口已被占用则会直接退出，而不是尝试下一个可用端口</span></span><br><span class="line">    <span class="attr">strictPort</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//https.createServer()配置项</span></span><br><span class="line">    <span class="attr">https</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="comment">//服务器启动时自动在浏览器中打开应用程序。</span></span><br><span class="line">    <span class="attr">open</span>: <span class="string">&quot;/docs/index.html&quot;</span>,</span><br><span class="line">    <span class="comment">//开发服务器，自定义代理规则</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="comment">// 字符串简写写法</span></span><br><span class="line">      <span class="string">&quot;/foo&quot;</span>: <span class="string">&quot;http://localhost:4567&quot;</span>,</span><br><span class="line">      <span class="comment">// 选项写法</span></span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/api/</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 正则表达式写法</span></span><br><span class="line">      <span class="string">&quot;^/fallback/.*&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/fallback/</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 使用 proxy 实例</span></span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configure</span>: <span class="function">(<span class="params">proxy, options</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// proxy 是 &#x27;http-proxy&#x27; 的实例</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// Proxying websockets or socket.io</span></span><br><span class="line">      <span class="string">&quot;/socket.io&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;ws://localhost:3000&quot;</span>,</span><br><span class="line">        <span class="attr">ws</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//开发服务器配置 CORS</span></span><br><span class="line">    <span class="attr">cors</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//依赖优化选项</span></span><br><span class="line">  <span class="attr">optimizeDeps</span>: &#123;</span><br><span class="line">    <span class="comment">//检测需要预构建的依赖项</span></span><br><span class="line">    <span class="attr">entries</span>: [],</span><br><span class="line">    <span class="comment">//预构建中强制排除的依赖项</span></span><br><span class="line">    <span class="attr">exclude</span>: [<span class="string">&quot;jquery&quot;</span>],</span><br><span class="line">    <span class="comment">//默认情况下，不在 node_modules 中的，链接的包不会被预构建。使用此选项可强制预构建链接的包。</span></span><br><span class="line">    <span class="attr">include</span>: [],</span><br><span class="line">    <span class="comment">//部署扫描和优化过程中传递给EsBuild</span></span><br><span class="line">    <span class="attr">esbuildOptions</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//设置为 true 可以强制依赖预构建，而忽略之前已经缓存过的、已经优化过的依赖</span></span><br><span class="line">    <span class="attr">force</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//SSR 选项</span></span><br><span class="line">  <span class="attr">ssr</span>: &#123;</span><br><span class="line">    <span class="comment">//列出的是要为 SSR 强制外部化的依赖</span></span><br><span class="line">    <span class="attr">external</span>: [],</span><br><span class="line">    <span class="comment">//列出的是防止被 SSR 外部化依赖项。</span></span><br><span class="line">    <span class="attr">noExternal</span>: [],</span><br><span class="line">    <span class="comment">//SSR 服务器的构建目标</span></span><br><span class="line">    <span class="attr">target</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="comment">//SSR 服务器的构建语法格式 &#x27;esm&#x27; | &#x27;cjs&#x27;</span></span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;esm&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">worker</span>: &#123;</span><br><span class="line">    <span class="comment">//worker 打包时的输出类型 &#x27;es&#x27; | &#x27;iife&#x27;</span></span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;iife&quot;</span>,</span><br><span class="line">    <span class="comment">// worker 打包的 Vite 插件</span></span><br><span class="line">    <span class="attr">plugins</span>: [],</span><br><span class="line">    <span class="comment">//打包 worker 的 Rollup 配置项</span></span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vitejs 配置说明 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 基础概念</title>
      <link href="/posts/e00d00c8.html"/>
      <url>/posts/e00d00c8.html</url>
      
        <content type="html"><![CDATA[<h3 id="Webpack">Webpack</h3><ul><li>现代 JavaScript 应用程序的静态模块打包器(module bundler)</li><li>能够识别遵循ES2015的模块语法、CommonJS、amd编写的模块</li><li>递归地构建一个依赖关系图(dependency graph)</li><li>构建 bundle</li></ul><h3 id="五个核心概念">五个核心概念</h3><ul><li>入口 entry<ul><li>指示 webpack 应该使用哪个模块，来作为构建其内部依赖图的开始</li></ul></li><li>输出 output<ul><li>告诉 webpack 在哪里输出它所创建的 bundles，以及如何命名这些文件</li></ul></li><li>loader<ul><li>将非JavaScript 文件 <code>转换</code> 为 webpack 能够处理的有效<code>模块</code> <strong>在 import 或&quot;加载&quot;模块时预处理文件</strong></li></ul></li><li>插件 plugin<ul><li>打包优化、压缩、定义环境中的变量等各种各样的任务</li><li>解决 loader 无法实现的其他事</li></ul></li><li>模式 mode<ul><li>启用 development/production 模式下的配置</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./path/to/my/entry/file.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;my-first-webpack.bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&#x27;static/[contenthash][ext]&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// test: 用于标识出应该被对应的 loader 进行转换的某个或某些文件。</span></span><br><span class="line">  <span class="comment">// use: 表示进行转换时，应该使用哪个 loader。</span></span><br><span class="line">  <span class="comment">// 嘿，webpack 编译器，当你碰到「在 require()/import 语句中被解析为 &#x27;.txt&#x27; 的路径」时，在你对它打包之前，先使用 raw-loader 转换一下。</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.txt$/</span>, <span class="attr">use</span>: <span class="string">&#x27;raw-loader&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;<span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span>&#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="基础配置">基础配置</h3><ul><li><p>常用命令</p><ul><li>webpack --stats detailed</li><li>webpack -c webpack.config.dev.js</li></ul></li><li><p>资源模块 Asset Module</p><ul><li>类型 Type<ul><li>asset/resource： 发送一个单独的文件并导出 URL</li><li>asset/inline：导出资源的 Data URL（Base64）</li><li>asset/source：导出资源源代码</li><li>asset：导出URL和发送一个单独的文件之间自动进行选择（通用资源类型）</li></ul></li></ul></li><li><p>抽离和压缩css</p><ul><li>mini-css-extract-plugin</li><li>[MiniCssExtractPlugin.loader, ‘css-loader’, ‘less-loader’]</li><li>css-minimizer-plugin</li></ul></li><li><p>代码分离</p><ul><li><p>入口启动：使用 Entry 配置手动分离代码</p><ul><li>公共代码重复打包</li></ul></li><li><p>防止重复：使用 Entry Dependencies 或 SplitChunksPlugin 去重和分离代码</p><ul><li>方式一</li></ul><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">  index: &#123;</span><br><span class="line">    <span class="keyword">import</span> <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    dependOn: <span class="string">&#x27;shared&#x27;</span>      <span class="comment">// 把共享的文件定义出来</span></span><br><span class="line">  &#125;,</span><br><span class="line">  another: &#123;</span><br><span class="line">    <span class="keyword">import</span> <span class="string">&#x27;./src/another.js&#x27;</span>,</span><br><span class="line">    dependOn: <span class="string">&#x27;shared&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">shared</span>: <span class="string">&#x27;lodash&#x27;</span>          <span class="comment">// 将 lodash 抽离出、放置在 shared.bundle.js 中    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>方式二</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">entry: &#123;</span><br><span class="line">  index: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  another: <span class="string">&#x27;./src/another.js&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">optimization: &#123;</span><br><span class="line">  splitChunks: &#123;</span><br><span class="line">    chunks: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>动态导入：通过模块内联函数调用来分离代码</p><ul><li>import(/* webpackChunkName: ‘name’ */ ‘name.js’)</li></ul></li><li><p>预获取/预加载模块[懒加载]</p><ul><li>prefetch：将来某些导航下需要的资源<ul><li>import(/* webpackChunkName: ‘name’, webpackPrefetch: true */ ‘name.js’)</li><li>告诉 webpack 执行预获取，生成 <link ref='prefetch' as='script' href='name.js'>并加载到页面头部，提示浏览器在空闲时间 获取 name.js</li></ul></li><li>preload：当前导航下需要的资源<ul><li>import(/* webpackChunkName: ‘name’, webpackPreload: true */ ‘name.js’)</li></ul></li></ul></li></ul></li><li><p>缓存 Cache</p><ul><li>命中缓存，以降低网络流量，使网站加载速度更快</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  filename: <span class="string">&#x27;[name].[contenthash].js&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>缓存第三方库</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">  splitChunks: &#123;</span><br><span class="line">    cacheGroups: &#123;</span><br><span class="line">      vendor: &#123;</span><br><span class="line">        test: /[\\/]node_modules[\\/]/,</span><br><span class="line">        name: <span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">        chunks: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>公共路径</p><ul><li>publicPath： 指定应用程序所有资源基础路径</li></ul></li><li><p>环境变量</p><ul><li>TerserPlugin</li></ul></li><li><p>npm脚本</p><ul><li>dev 模式下 移除性能警告</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">performance:</span> &#123;</span><br><span class="line">  <span class="attr">hints:</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>source map</p></li><li><p>dev-server</p><ul><li>compress<ul><li>true 压缩代码</li></ul></li><li>headers</li><li>https\http2</li><li>historyApiFailBack</li><li>host</li><li>hot<ul><li>true 模块热替换与热加载</li></ul></li><li>liveReload</li></ul></li><li><p>ESLint</p><ul><li>检验代码是否合格</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">devServer:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">  client:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">    overlay:</span> false <span class="comment">// 当出现编译错误或警告时，在浏览器中显示全屏覆盖</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>Githooks Husky</p><ul><li><p>方案一</p><ul><li>在 .git/hooks/ 新增 pre-commit -&gt; ‘npx eslint ./src’</li></ul></li><li><p>方案二</p><ul><li>package.json<ul><li>prepare: ‘husky install’</li></ul></li><li>npx husky add .husky/pre-commit ‘npx eslint ./src’</li><li>git add .husky/pre-commit</li></ul></li></ul></li><li><p>Webpack 模块</p><ul><li>ECMAScript 模块</li><li>CommonJS   模块</li><li>AMD   模块</li><li>Asset 模块</li></ul></li><li><p>模块解析简易原理</p></li></ul><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">js\css\less\img\html 等文件</span><br><span class="line">  -&gt; loader + <span class="keyword">module</span>（compiler）</span><br><span class="line">    -&gt;compiler 描述整个 webpack 打包流程</span><br><span class="line">      -&gt; 内置打包状态 随着打包进行，状态也发生变化，同时触发相应状态的生命钩子</span><br><span class="line">      -&gt; 内置解析器 resolvers，基于 enhanced-resolve 来实现，用于解析模块</span><br><span class="line"></span><br><span class="line">  -&gt; 模块化文件</span><br></pre></td></tr></table></figure><ul><li><p>externals 外部扩展</p><ul><li>引入第三方库 jQuery<ul><li>webpack.config.js</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">externalsType</span>: <span class="string">&#x27;script&#x27;</span>,</span><br><span class="line"><span class="attr">externals</span>: &#123;</span><br><span class="line">  <span class="attr">jquery</span>: [</span><br><span class="line">    <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;$&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>浏览器版本设置</p><ul><li><blockquote><p>1%            # PostCss 插件 应用在全球 使用率 &gt;1% 的浏览器上</p></blockquote></li><li>last 2 versions # 浏览器最近的两个版本</li></ul></li><li><p>一个标签页启动的线程</p><ul><li>JS引擎线程  处理JS</li><li>GUI渲染线程 渲染页面</li><li>浏览器事件触发线程 控制交互</li></ul></li><li><p>web worker</p><ul><li>将复杂耗时任务放在浏览器后台线程去处理，不阻塞UI线程的渲染</li></ul></li><li><p>webpack 性能提升</p><ul><li>提升项目性能</li><li>构建编译性能<ul><li><p>通用环境</p><ul><li>webpack@latest、Node@latest</li><li>Dll</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># webpack.<span class="property">dll</span>.<span class="property">config</span>.<span class="property">js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path)</span></span><br><span class="line"><span class="string">const webpack = require(&#x27;</span>webpack<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">module.exports = &#123;</span></span><br><span class="line"><span class="string">  mode: &#x27;</span>production<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">  entry: [&#x27;</span>jquery<span class="string">&#x27;],</span></span><br><span class="line"><span class="string">  output: &#123;</span></span><br><span class="line"><span class="string">    filename: &#x27;</span>[name].<span class="property">js</span><span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    path: path.resolve(__dirname, &#x27;</span>dll<span class="string">&#x27;),</span></span><br><span class="line"><span class="string">    library: &#x27;</span>[name]_[hash]<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  plugins: [</span></span><br><span class="line"><span class="string">    new webpack.DllPlugin(&#123;</span></span><br><span class="line"><span class="string">      name: &#x27;</span>[name]_[hash]<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      path: path.resolve(__dirname, &#x27;</span>dll/manifest.<span class="property">json</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># package.json</span></span><br><span class="line"><span class="string">scripts: &#123;</span></span><br><span class="line"><span class="string">  &#x27;</span>dll<span class="string">&#x27;: &#x27;</span>webpack --config ./webpack.<span class="property">dll</span>.<span class="property">config</span>.<span class="property">js</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 使用 webpack.config.js 中添加如下插件</span></span><br><span class="line"><span class="string">new webpack.DllReferencePlugin(&#123;</span></span><br><span class="line"><span class="string">  manifest: path.resolve(__dirname, &#x27;</span>./dll/manifest.<span class="property">json</span><span class="string">&#x27;)</span></span><br><span class="line"><span class="string">&#125;),</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># add-asset-html-webpack-plugin</span></span><br><span class="line"><span class="string">new AddAssetHtmlWebpackPlugin(&#123;</span></span><br><span class="line"><span class="string">  filepath: path.resolve(__dirname, &#x27;</span>./dll/jquery.<span class="property">js</span><span class="string">&#x27;),</span></span><br><span class="line"><span class="string">  publicPath: &#x27;</span>./<span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure><ul><li>worker pool</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// npm i thread-loader -D</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;thread-loader&#x27;</span>,  # 把一些耗时的 loader 放在 worker pool 中运行，否则不建议使用</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">workers</span>: <span class="number">2</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><h2 id="开发环境">开发环境</h2></li><li><p>生产环境</p></li></ul></li></ul></li></ul><p>课堂疑问</p><ol><li>chunkhash / contenthash 区别</li><li>yarn 与 npm 的区别</li><li>为何host 设置 ‘0.0.0.0’ 其他电脑即可访问你的页面？</li><li>dev 模式下 index.html 如何引用内存中的bundles.js</li><li>热替换与热加载区别</li></ol><p>问题一：</p><ol><li>hash ：表示所有文件哈希值相同，如果任意文件内容发生变化，则再次打包后，所有哈希值均改变且相同。即当任意module发生改变时，所有bundle的hash都改变且相同。</li><li>chunkhash ：根据不同的入口文件(Entry)进行依赖文件解析，构建对应的chunk，生成对应的哈希值。</li><li>contenthash :在打包时，我们会在js文件中导入CSS文件，因为他们是同一个入口文件，我们只改了JS代码，但是它的CSS在抽离生成CSS文件时hash也会跟着变，这个时候就需要contenthash来解决。</li></ol><p>问题二：<br>yarn</p><ol><li>有版本锁定文件yarn-lock.json</li><li>离线模式下从本地缓存安装依赖(并发下载)</li><li>输出日志简洁，语义化下载命令</li></ol><p>npm</p><ol><li>以队列模式下载依赖，下载错误后仍继续下载</li><li>日志输出复杂繁多</li><li>5.0版本后采用symlinks 链接本地缓存(不进行文件拷贝)，加快安装速度</li></ol><p>问题四：</p><ul><li>localhost也叫local 本地服务器</li><li>127.0.0.1 ～本机地址(本机服务器)<br>他们的解析通过本机的host文件，windows自动将localhost解析为127.0.0.1<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localhot(local)是不经网卡传输！这点很重要，它不受网络防火墙和网卡相关的的限制</span><br><span class="line"><span class="number">127.0.0.1</span>、本机IP均是通过网卡传输，依赖网卡，并受到网络防火墙和网卡相关的限制</span><br></pre></td></tr></table></figure><ul><li>但是本机IP与127.0.0.1的区别是：<ul><li>127.0.0.1只能通过本机访问</li><li>本机IP通过本机访问也能通过外部访问</li></ul></li></ul></li><li>0.0.0.0代表本机可访问的所有IP地址</li></ul><p>问题五：<br>热刷新(hot)：文件改动后，整个页面刷新，不保留任何状态（比如输入过内容的Input表单），相当于webpack帮你摁了F5刷新<br>热加载(liveReload)：文件改动后，以最小的代价改变被改变的区域。尽可能保留改动文件前的状态（对input输入内容后，修改其他标签的代码）</p><!-- 常见模块说明----------less-loader:  编译 .less 为 .css 文件css-loader: 使得 .css 可通过 import/require 引入 js 文件中style-loader: 将js 中引入的.css 文件内容套上 <style> 并 插入 html 中file-loader/url-loader: 返回文件 path蚂蚁前端研发最佳实践https://mp.weixin.qq.com/s/jRPjpt4R6r_bPeZ9Qp7gSg -->]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Manifest</title>
      <link href="/posts/5f8c0a16.html"/>
      <url>/posts/5f8c0a16.html</url>
      
        <content type="html"><![CDATA[<h3 id="Runtime">Runtime</h3><ul><li>在模块交互时，连接模块所需的加载和解析逻辑</li></ul><h3 id="Manifest">Manifest</h3><ul><li>Webpack 用来管理 所有模块之间的交互</li><li>当编译器(compiler)开始执行、解析和映射应用程序时，它会保留所有模块的详细要点, 该数据集合 称为 <code>Manifest</code></li><li>当完成打包并发送到浏览器时，会在 <code>Runtime</code> 通过 <code>Manifest</code> 来解析和加载模块</li></ul><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">`import` 或 `require` 语句现在都已经转换为 `__webpack_require__` 方法，此方法指向模块标识符(module identifier)</span><br><span class="line"></span><br><span class="line">通过使用 `Manifest` 中的数据，`Runtime` 将能够查询模块标识符，检索出背后对应的模块</span><br></pre></td></tr></table></figure><h3 id="其他">其他</h3><ul><li>通过使用浏览器缓存来改善项目的性能，理解上述过程尤为重要</li><li>通过使用 <code>bundle</code> 计算出内容散列(content hash)作为文件名称，这样在内容或文件修改时，浏览器中将通过新的内容散列指向新的文件，从而使缓存无效</li></ul>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>模块 modules</title>
      <link href="/posts/afdcaf6.html"/>
      <url>/posts/afdcaf6.html</url>
      
        <content type="html"><![CDATA[<h3 id="模块-modules">模块 modules</h3><ul><li>开发者将程序分解成离散功能块(discrete chunks of functionality)</li><li>模块间依赖关系表达方式<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">ES2015</span> <span class="keyword">import</span> 语句</span><br><span class="line"><span class="title class_">CommonJS</span> <span class="built_in">require</span>() 语句</span><br><span class="line"><span class="variable constant_">AMD</span> define 和 <span class="built_in">require</span> 语句</span><br><span class="line">css/sass/less 文件中的 @<span class="keyword">import</span> 语句</span><br><span class="line">样式(<span class="title function_">url</span>(...))或 <span class="variable constant_">HTML</span> 文件(<span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">...</span>&gt;</span>)中的图片链接(image url)</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="模块解析-module-resolution">模块解析 module resolution</h3><ul><li>resolver 库用于 帮助找到模块的绝对路径<ul><li>打包时，webpack 使用 enhanced-resolve 来解析文件路径<ul><li>绝对路径</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;/home/me/file&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>相对路径</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./file&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>模块路径</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;module&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li>模块将在 resolve.modules 中指定的所有目录内搜索<ul><li>解析器(resolver)将检查路径是否指向文件或目录。如果路径指向一个文件：<ul><li>如果路径具有文件扩展名，则被直接将文件打包</li><li>否则，将使用 [resolve.extensions] 选项作为文件扩展名来解析，此选项告诉解析器在解析中能够接受哪些扩展名（例如 .js, .jsx）</li></ul></li><li>如果路径指向一个文件夹，则采取以下步骤找到具有正确扩展名的正确文件<ul><li>如果文件夹中包含 package.json 文件，则按照顺序查找 <code>resolve.mainFields</code> 配置选项中指定的字段。并且 package.json 中的第一个这样的字段确定文件路径。</li><li>如果 package.json 文件不存在或者 package.json 文件中的 main 字段没有返回一个有效路径，则按照顺序查找 <code>resolve.mainFiles</code> 配置选项中指定的文件名，看是否能在 import/require 目录下匹配到一个存在的文件名。<br>文件扩展名通过 [resolve.extensions] 选项采用类似的方法进行解析。</li></ul></li></ul></li></ul></li></ul><p><a href="https://www.webpackjs.com/concepts/targets/">target</a><br><a href="https://www.webpackjs.com/configuration/resolve/#resolve-modules">resolve.modules</a><br><a href="https://www.webpackjs.com/configuration/resolve/#resolve-mainfields">resolve.mainFields</a><br><a href="https://www.webpackjs.com/configuration/resolve/#resolve-extensions">resolve.extensions</a></p><h3 id="loader">loader</h3><h3 id="缓存">缓存</h3>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>esbuild</title>
      <link href="/posts/b2d6c695.html"/>
      <url>/posts/b2d6c695.html</url>
      
        <content type="html"><![CDATA[<h1>esbuild</h1><ol><li>采用go语言编写</li><li>算法和数据结构底层</li></ol>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esbuild </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自定义CLI</title>
      <link href="/posts/707111f1.html"/>
      <url>/posts/707111f1.html</url>
      
        <content type="html"><![CDATA[<h1>自定义 cli</h1><h3 id="脚手架原理">脚手架原理</h3><ol><li>通过<code>ejs</code>创建对应模版</li><li>通过 <code>inquirer</code>命令行工具读取参数，渲染 <code>ejs模版</code>，再输出至指定目录下</li></ol>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>microbundle</title>
      <link href="/posts/3fe9c1b7.html"/>
      <url>/posts/3fe9c1b7.html</url>
      
        <content type="html"><![CDATA[<h2 id="为什么是-TypeScript-？">为什么是 TypeScript ？</h2><p>TypeScript 是一个增加了静态类型系统的 JavaScript 超集。它其余的特性则相当密切地遵循了当前和未来的 ECMAScript 规范。对于组件库作者来说，这意味着即便是不实际使用 TypeScript 开发的用户，他们所使用的能对 TypeScript 智能处理的 编辑器/IDE（比如 Visual Studio Code）也能给出更友好的自动完成等。在编写代码时，当你传入某些错误的东西，TypeScript 也能充当行内文档做出及时提醒，这将解救你在面对自己几个月前开发的代码一筹莫展之时。</p><h2 id="为什么是-microbundle-？">为什么是 microbundle ？</h2><p>microbundle 号称 “微小组件的零配置打包器”。它是一个围绕 rollup 构建的包装器，包含了健全的默认功能（如最小化/压缩）、美观的打包体积输出、多目标格式（ES modules, CommonJS, UMD）。而在本文范围内最重要的是，其拥有开箱即用的 TypeScript 支持（真正的 无配置，甚至不用 tsconfig.json 也行）。其简单到离谱的设置使得组件库作者可以聚焦于构建一个极好的库，而非为了把 ES6/TypeScript 等编译为 JS 大费周章 。</p><h2 id="用-microbundle-零配置打包">用 microbundle 零配置打包</h2><blockquote><p>用 vscode 来创建项目（这里不需要 为什么是 vscode ?? 了吧)</p></blockquote><ol><li><p>用 vscode 打开一个你的项目目录(新建)</p></li><li><p>创建组件包的设置，在终端中输入下列指令，运行后完成各项参数</p><p>npm init</p></li><li><p>创建源文件和目标文件夹</p><p>mkdir src &amp;&amp; mkdir dist</p></li><li><p>以及添加首个 TypeScript 文件</p><h1>手动在 vscode 中 src 目录下新建 index.ts 或者用指令</h1><p>touch src/index.ts</p></li><li><p>在 index.ts 中添加代码</p><h1>手动在 src/index.ts 中输入，或者用指令</h1><p>echo “export class GameRoot {}” &gt;&gt; src/index.ts</p></li><li><p>打开 package.json 修改和添加代码</p><p>{<br>…<br>“main”: “dist/index.js”,<br>“source”: “src/index.ts”<br>…<br>}</p></li></ol><blockquote><p>microbundle 会检查 package.json 中的 “main” 和 “source” 选项（编译后的入口文件和源入口文件），在本例中也就是 dist/index.js 和 src/index.ts。</p></blockquote><ol start="7"><li><p>使用 microbundle 编译我们的组件库</p><p>npx microbundle</p><h1>当 npm &lt; 5.x 时，也可以运行 ./node_modules/.bin/microbundle</h1><h1>运行后 microbundle 会将 src/index.ts 编译到 dist 目录中</h1></li></ol><h2 id="文件解析">文件解析</h2><p>打开 dist 目录，可以看到生成了很多文件：</p><ul><li>index.js 是 CommonJS 模块。这是一种被 NodeJS 使用的模块类型，看起来像 const myModule = require(‘my-module’)</li><li>index.m.js 是 ECMAScript 模块，由 ES6 定义，看起来类似 import MyModule from ‘my-module’</li><li>index.umd.js 是 UMD 模块</li><li>index.d.ts 是 TypeScript 类型描述文件</li><li>*.map 是为每个文件提供到 TypeScript 源文件的映射。</li></ul><h5 id="看看-index-js-的内容">看看 index.js 的内容</h5><pre><code>cat dist/index.jsvar n=function()&#123;return function()&#123;&#125;&#125;();exports.GameRoot=n;//# sourceMappingURL=index.js.map</code></pre><p>我们的 class GameRoot {} 语句被编译为其 ES5 的等价实现，并导出为一个 CommonJS 模块。</p><h5 id="再来看看-index-d-ts">再来看看 index.d.ts</h5><pre><code>cat dist/index.d.tsexport declare class GameRoot &#123;&#125;</code></pre><p>这允许了一个 TypeScript 项目将正确的类型信息反向指派给组件包 – 通过这种间接方式，完成了本来要引入 .ts 文件才能达到的类型识别目标。单独的类型声明文件意味着非 TypeScript 项目也可以理解模块的公共 API （例如代码编辑器可以对 npm 包中引用的代码智能自动完成）。</p><h2 id="扩展操作">扩展操作</h2><p>为便于使用我们可以将 watch 和 build 任务作为 npm scripts 放置在 package.json 中：</p><pre><code>&#123;...  &quot;scripts&quot;: &#123;    ...    &quot;dev&quot;: &quot;microbundle watch&quot;,    &quot;build&quot;: &quot;microbundle&quot;  &#125;...&#125;</code></pre><p>然后我们可以使用下列指令来执行他：</p><pre><code>npm run build   -- 编译num run dev     -- 监听文件改变</code></pre><h2 id="将-microbundle-构建的模块发布到-NPM">将 microbundle 构建的模块发布到 NPM</h2><p>借助 microbundle 可以将模块发布为 CommonJS 模块（标准的 npm 模块），但也能作为 ES Module 和 UMD 模块，按官网文档设置即可，继续来修改 package.json。</p><pre><code>&#123;  ...  &quot;source&quot;: &quot;src/index.ts&quot;,  &quot;main&quot;: &quot;dist/index.umd.js&quot;,  &quot;module&quot;: &quot;dist/index.modern.module.js&quot;,  &quot;types&quot;: &quot;dist/index.d.ts&quot;,  ...&#125;</code></pre><p>将 package.json 如此配置后就可以通过 npm publish 发布到 npm 了。</p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> microbundle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>umijs</title>
      <link href="/posts/2f44e478.html"/>
      <url>/posts/2f44e478.html</url>
      
        <content type="html"><![CDATA[<h2 id="常见问题">常见问题</h2><p><strong>asset-manifest.json 作用</strong></p><ul><li>用于描述产物的 manifest 文件</li></ul>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> umijs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>istio</title>
      <link href="/posts/114081f8.html"/>
      <url>/posts/114081f8.html</url>
      
        <content type="html"><![CDATA[<h2 id="istio">istio</h2><ul><li>是什么</li></ul><blockquote><p>Istio 提供一种简单的方式为已部署的服务建立网络，该网络具有负载均衡、服务间认证、监控等功能，而不需要对服务的代码做任何改动</p></blockquote><ul><li>istio 适用于容器或虚拟机环境（特别是 k8s），兼容异构架构。</li><li>istio 使用 sidecar（边车模式）代理服务的网络，不需要对业务代码本身做任何的改动。</li><li>HTTP、gRPC、WebSocket 和 TCP 流量的自动负载均衡。</li><li>istio 通过丰富的路由规则、重试、故障转移和故障注入，可以对流量行为进行细粒度控制；支持访问控制、速率限制和配额。</li><li>istio 对出入集群入口和出口中所有流量的自动度量指标、日志记录和跟踪</li></ul><h3 id="安装-卸载">安装/卸载</h3><ul><li><p>下载 curl -L <a href="https://istio.io/downloadIstio">https://istio.io/downloadIstio</a> | ISTIO_VERSION=1.4.5 sh -</p><ul><li>istio-1.4.5</li></ul></li><li><p>设置环境变量</p><ul><li>vim ~/.bash_profile &gt;&gt; PATH=$PATH:/root/istio-1.4.5/bin</li></ul></li><li><p>安装 istioctl 自动补全功能</p><ul><li>cp tools/istionctl.bash ~/.istioctl.bash</li><li>source ~/.istioctl.bsh</li><li>输入 istioctl manifest 验证自动补全</li></ul></li><li><p>命令行工具</p><ul><li>istioctl 会跟 跑在 k8s 上的 istio 进行通讯，获取它的控制面和数据面</li><li>istioctl version 输出版本仅是客户端的版本号</li><li>关闭警告信息 istioctl version --remote=false</li></ul></li><li><p>安装 istio</p><ul><li>istioctl<ul><li>istioctl manifest apply --set profile=demo<ul><li>istioctl profile list</li><li>profile 同一资源的不同配置</li></ul></li></ul></li><li>helm</li></ul></li><li><p>确认是否安装成功</p><ul><li>kubectl get all -n istio-system</li></ul></li><li><p>卸载</p><ul><li>istioctl manifest generate --set profile=demo | kubectl delete -f -</li></ul></li><li><p>istioctl analyze -n istio-system</p><ul><li>分析该命名空间下被 istio 注入的资源和配置的检查工作</li></ul></li><li><p>服务化网格工具 kiali</p><ul><li>将 服务网格 以 web 页面展示出来</li></ul></li><li><p>通过 工具操作 sevicemesh</p></li></ul><h3 id="命令行工具">命令行工具</h3>]]></content>
      
      
      <categories>
          
          <category> K8S集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> K8S 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot 集成 Apollo</title>
      <link href="/posts/f49f97e9.html"/>
      <url>/posts/f49f97e9.html</url>
      
        <content type="html"><![CDATA[<h3 id="Apollo（阿波罗）">Apollo（阿波罗）</h3><ul><li>携程框架部门研发的分布式配置中心，能够集中化管理应用不同环境、不同集群的配置，配置修改后能够实时推送到应用端，并且具备规范的权限、流程治理等特性，适用于微服务配置管理场景</li><li>访问地址及账户<ul><li><a href="http://192.168.1.151:30001">http://192.168.1.151:30001</a></li><li>apollo/admin</li></ul></li><li>集成步骤<ul><li>pom.xml 加入依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ctrip.framework.apollo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>apollo-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>修改 Dockerfile 注入如下配置</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FROM openjdk:8-jre-alpine</span></span><br><span class="line"><span class="keyword">ENV</span> JVM_OPTS=<span class="string">&quot;-Xss256k -XX:MaxRAMPercentage=80.0 -Duser.timezone=Asia/Shanghai -Djava.security.egd=file:/dev/./urandom&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_OPTS=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> APP_OPTS=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [ <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;java <span class="variable">$JVM_OPTS</span> <span class="variable">$JAVA_OPTS</span> -jar app.jar <span class="variable">$APP_OPTS</span>&quot;</span> ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sh -c: 字串作为完整的命令来执行, 将 sudo 的影响范围扩展到整条命令</span></span><br><span class="line">```    </span><br><span class="line">- springboot-apollo-deploy.yaml 配置 变量</span><br></pre></td></tr></table></figure>containers:<ul><li>name: springboot-apollo<br>env:<ul><li>name: JAVA_OPTS<br>value: “-Denv=DEV”</li></ul><h1>注意修改下面 apollo.meta 参数值中的 mydlqcloud 为你自己的部署 Apollo 的 Namespace 名称</h1><ul><li>name: APP_OPTS<br>value: &quot;<br>–app.id=apollo-demo<br>–apollo.bootstrap.enabled=true<br>–apollo.bootstrap.eagerLoad.enabled=false<br>–apollo.cacheDir=/opt/data/<br>–apollo.cluster=default<br>–apollo.bootstrap.namespaces=application<br>–apollo.autoUpdateInjectedSpringProperties=true<br>–apollo.meta=http://service-apollo-config-server-dev.sre:8080<br>&quot;</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="string">配置中心-1</span>]<span class="string">(https://www.cnblogs.com/jinmuqq222/p/13555072.html#_label0)</span></span><br><span class="line">[<span class="string">配置中心-2</span>]<span class="string">(https://www.jianshu.com/p/e5cc29be74d4)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### spring-boot application.yaml</span></span><br><span class="line"><span class="string">```yaml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapping/*Mapper.xml</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">sys-document</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">     <span class="attr">mongodb:</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">mongodb://martin:123456@192.168.1.11:27017/cec</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">filters:</span> <span class="string">stat</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">dm.jdbc.driver.DmDriver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:dm://www.dm8.com/DAMENG</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">CAPF</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">CAPF123123</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line">      <span class="attr">validation-query:</span> <span class="string">SELECT</span> <span class="string">&#x27;x&#x27;</span></span><br><span class="line">      <span class="attr">test-while-idle:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">test-on-borrow:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">test-on-return:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">pool-prepared-statements:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">max-pool-prepared-statement-per-connection-size:</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">jackson.default-property-inclusion:</span> <span class="string">non_null</span></span><br><span class="line">  <span class="attr">jackson.property-naming-strategy:</span> <span class="string">SNAKE_CASE</span></span><br><span class="line">  <span class="attr">jackson.date-format:</span> <span class="string">yyyy-MM-dd&#x27;T&#x27;HH:mm:ss:SSSZ</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">jest:</span></span><br><span class="line">      <span class="attr">uris:</span> <span class="string">http://192.168.1.10:9200</span></span><br><span class="line">      <span class="comment">#read-timeout: 1200000000</span></span><br><span class="line">      <span class="comment">#connection-timeout: 90000000</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">100MB</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">100MB</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org:</span></span><br><span class="line">  <span class="attr">spring:</span></span><br><span class="line">    <span class="attr">encryption:</span></span><br><span class="line">      <span class="attr">link_server_hosts:</span> <span class="string">links</span>      </span><br><span class="line">      <span class="attr">open_id:</span> <span class="string">sys_document</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">upload-url:</span> <span class="string">/home/upload</span></span><br><span class="line"><span class="attr">es-index:</span> <span class="string">file_detail</span></span><br><span class="line"><span class="attr">openoffice-url:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span></span><br><span class="line"><span class="attr">user-url:</span> <span class="string">http://contacts</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="待解决问题">待解决问题</h2><ol><li>apollo 配置 com.alibaba.druid.pool.DruidDataSource 数据源后，spring-boot 应用要写代码读取 所配置的变量 来进行 apolloDataSource 创建？</li></ol>]]></content>
      
      
      <categories>
          
          <category> K8S集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Apollo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apollo配置中心</title>
      <link href="/posts/75cdc27.html"/>
      <url>/posts/75cdc27.html</url>
      
        <content type="html"><![CDATA[<h1>配置中心</h1><ul><li>配置集中管理、统一标准</li><li>配置与应用分离</li><li>实时更新</li><li>高可用</li></ul><h1>Apollo配置中心</h1><h1>Apollo介绍</h1><p>Apollo（阿波罗）是携程框架部门研发的开源配置管理中心，能够集中化管理应用不同环境、不同集群的配置，配置修改后能够实时推送到应用端，并且具备规范的权限、流程治理等特性。</p><p>Apollo支持4个维度管理Key-Value格式的配置：</p><ol><li>application (应用)</li><li>environment (环境)</li><li>cluster (集群)</li><li>namespace (命名空间)</li></ol><h1>Apollo的优势</h1><p>正是基于配置的特殊性，所以Apollo从设计之初就立志于成为一个有治理能力的配置发布平台，目前提供了以下的特性：</p><ul><li><p>统一管理不同环境、不同集群的配置</p></li><li><p>Apollo提供了一个统一界面集中式管理不同环境（environment）、不同集群（cluster）、不同命名空间（namespace）的配置。</p></li><li><p>同一份代码部署在不同的集群，可以有不同的配置，比如zookeeper的地址等</p></li><li><p>通过命名空间（namespace）可以很方便地支持多个不同应用共享同一份配置，同时还允许应用对共享的配置进行覆盖</p></li><li><p>配置修改实时生效（热发布）</p><ul><li>用户在Apollo修改完配置并发布后，客户端能实时（1秒）接收到最新的配置，并通知到应用程序</li></ul></li><li><p>版本发布管理</p></li><li><p>所有的配置发布都有版本概念，从而可以方便地支持配置的回滚</p></li><li><p>灰度发布</p><ul><li>支持配置的灰度发布，比如点了发布后，只对部分应用实例生效，等观察一段时间没问题后再推给所有应用实例</li></ul></li><li><p>权限管理、发布审核、操作审计</p><ul><li>应用和配置的管理都有完善的权限管理机制，对配置的管理还分为了编辑和发布两个环节，从而减少人为的错误。</li><li>所有的操作都有审计日志，可以方便地追踪问题</li></ul></li><li><p>客户端配置信息监控</p></li><li><p>可以在界面上方便地看到配置在被哪些实例使用</p></li><li><p>提供Java和.Net原生客户端</p><ul><li>提供了Java和.Net的原生客户端，方便应用集成</li><li>支持Spring Placeholder, Annotation和Spring Boot的ConfigurationProperties，方便应用使用（需要Spring 3.1.1+）</li><li>同时提供了Http接口，非Java和.Net应用也可以方便地使用</li></ul></li><li><p>提供开放平台API</p><ul><li>Apollo自身提供了比较完善的统一配置管理界面，支持多环境、多数据中心配置管理、权限、流程治理等特性。不过Apollo出于通用性考虑，不会对配置的修改做过多限制，只要符合基本的格式就能保存，不会针对不同的配置值进行针对性的校验，如数据库用户名、密码，Redis服务地址等</li><li>对于这类应用配置，Apollo支持应用方通过开放平台API在Apollo进行配置的修改和发布，并且具备完善的授权和权限控制</li></ul></li><li><p>部署简单</p><ul><li>配置中心作为基础服务，可用性要求非常高，这就要求Apollo对外部依赖尽可能地少</li><li>目前唯一的外部依赖是MySQL，所以部署非常简单，只要安装好Java和MySQL就可以让Apollo跑起来</li><li>Apollo还提供了打包脚本，一键就可以生成所有需要的安装包，并且支持自定义运行时参数</li></ul></li></ul><p>Apollo的优势还可以通过与Spring Cloud Config对比来体现出</p><p>Apollo和Spring Cloud Config的区别.png</p><h1>Apollo的核心概念介绍</h1><h2 id="Namespace">Namespace</h2><p>Namespace就相当于spring boot项目中的配置文件，例如namespace中有默认的application,格式为properties，则对应着application.properties。</p><h3 id="1-Namespace的格式">1 Namespace的格式</h3><p>配置文件有多种格式，例如：properties、xml、yml、yaml、json等。同样Namespace也具有这些格式。</p><h3 id="2-Namespace的获取权限分类">2 Namespace的获取权限分类</h3><p>Namespace的获取权限分为两种：</p><p>private （私有的）<br>public （公共的）<br>这里的获取权限是相对于Apollo客户端来说的。</p><p>2.1 private权限</p><p>private权限的Namespace，只能被所属的应用获取到。一个应用尝试获取其它应用private的Namespace，Apollo会报“404”异常。</p><p>2.2 public权限</p><p>public权限的Namespace，能被任何应用获取。</p><h3 id="3-Namespace的类型">3. Namespace的类型</h3><p>Namespace类型有三种：</p><ul><li>私有类型</li><li>公共类型</li><li>关联类型（继承类型）</li></ul><p>3.1 私有类型</p><p>私有类型的Namespace具有private权限。例如上文提到的“application” Namespace就是私有类型。</p><p>3.2 公共类型<br>3.2.1 含义<br>公共类型的Namespace具有public权限。公共类型的Namespace相当于游离于应用之外的配置，且通过Namespace的名称去标识公共Namespace，所以公共的Namespace的名称必须全局唯一。</p><p>3.2.2 使用场景</p><ul><li>部门级别共享的配置</li><li>小组级别共享的配置</li><li>几个项目之间共享的配置</li><li>中间件客户端的配置</li></ul><p>3.3 关联类型</p><p>3.3.1 含义</p><p>关联类型又可称为继承类型，关联类型具有private权限。关联类型的Namespace继承于公共类型的Namespace，用于覆盖公共Namespace的某些配置。例如公共的Namespace有两个配置项</p><p>k1 = v1</p><p>k2 = v2</p><p>然后应用A有一个关联类型的Namespace关联了此公共Namespace，且覆盖了配置项k1，新值为v3。那么在应用A实际运行时，获取到的公共Namespace的配置为：</p><p>k1 = v3</p><p>k2 = v2</p><h1>Apollo服务端（测试客户端用）</h1><h2 id="1-准备工作">1 准备工作</h2><h3 id="1-1">1.1</h3><p>apollo服务端要求1.8+</p><p>apollo客户端要求1.7+</p><h3 id="1-2-MySQL">1.2 MySQL</h3><p>版本要求5.6.5+</p><h3 id="1-3-下载Quick-Start安装包">1.3 下载Quick Start安装包</h3><ul><li><p>从Github下载</p><ul><li>checkout或下载<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fnobodyiam%2Fapollo-build-scripts">apollo-build-scripts</a>项目</li><li>由于Quick Start项目比较大，所以放在了另外的repository，请注意项目地址<ul><li><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fnobodyiam%2Fapollo-build-scripts">https://github.com/nobodyiam/apollo-build-scripts</a></li></ul></li></ul></li><li><p>从百度网盘下载</p><ul><li>通过<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fpan.baidu.com%2Fs%2F1vLqmtewA7fUGZ-4nCPOT_g">网盘链接</a>下载，提取码：rmq9</li><li>下载到本地后，在本地解压apollo-build-scripts-master.zip</li></ul></li></ul><h2 id="2-安装步骤">2. 安装步骤</h2><h3 id="2-1-创建数据库">2.1 创建数据库</h3><p>Apollo服务端共需要两个数据库：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fnobodyiam%2Fapollo-build-scripts%2Fblob%2Fmaster%2Fsql%2Fapolloportaldb.sql">ApolloPortalDB</a>和<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fnobodyiam%2Fapollo-build-scripts%2Fblob%2Fmaster%2Fsql%2Fapolloconfigdb.sql">ApolloConfigDB</a>，数据库、表的创建和样例数据都分别准备了sql文件，只需要导入数据库即可。</p><p>验证方法：</p><ul><li><p>ApolloPortalDB：</p><pre><code>  select `Id`, `AppId`, `Name` from ApolloPortalDB.App;</code></pre></li><li><p>ApolloConfigDB：</p><pre><code>  select `NamespaceId`, `Key`, `Value`, `Comment` from ApolloConfigDB.Item;</code></pre></li></ul><p>如果都有查询出结果那表示数据库创建成功。</p><h3 id="2-2-配置数据库连接信息">2.2 配置数据库连接信息</h3><p>Apollo服务端需要知道如何连接到你前面创建的数据库，<a href="http://xn--demo-955f783hpg6buorepmw7r.sh">所以需要编辑demo.sh</a>，修改ApolloPortalDB和ApolloConfigDB相关的数据库连接串信息。</p><p>注意：填入的用户需要具备对ApolloPortalDB和ApolloConfigDB数据的读写权限。</p><pre><code># apollo config db infoapollo_config_db_url=jdbc:mysql://localhost:3306/ApolloConfigDB?characterEncoding=utf8apollo_config_db_username=用户名apollo_config_db_password=密码（如果没有密码，留空即可）# apollo portal db infoapollo_portal_db_url=jdbc:mysql://localhost:3306/ApolloPortalDB?characterEncoding=utf8apollo_portal_db_username=用户名apollo_portal_db_password=密码（如果没有密码，留空即可）</code></pre><h2 id="3-启动Apollo配置中心">3 启动Apollo配置中心</h2><p>Apollo的quick start脚本会在本地启动三个端口分别为8070、8080、8090的服务，需在确保端口未被占用的情况下执行脚本</p><pre><code>./demo.sh start </code></pre><p>eg:关闭服务的命令：</p><pre><code>./demo.sh stop</code></pre><p>当看到如下输出后，就说明启动成功了！</p><pre><code>==== starting service ====Service logging file is ./service/apollo-service.logStarted [10768]Waiting for config service startup.......Config service started. You may visit http://localhost:8080 for service status now!Waiting for admin service startup....Admin service started==== starting portal ====Portal logging file is ./portal/apollo-portal.logStarted [10846]Waiting for portal startup......Portal started. You can visit http://localhost:8070 now!</code></pre><h3 id="异常排查">异常排查</h3><p>如果启动遇到了异常，可以分别查看service和portal目录下的log文件排查问题。</p><p>注：在启动apollo-configservice的过程中会在日志中输出eureka注册失败的信息，如com.sun.jersey.api.client.ClientHandlerException: java.net.ConnectException: Connection refused。需要注意的是，这个是预期的情况，因为apollo-configservice需要向Meta Server（它自己）注册服务，但是因为在启动过程中，自己还没起来，所以会报这个错。后面会进行重试的动作，所以等自己服务起来后就会注册正常了。</p><h2 id="服务端使用">服务端使用</h2><p>通过访问<a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8070%2F">http://localhost:8070/</a>可访问web页面的服务端。</p><p>初始账号/密码为：admin/apollo</p><p>具体使用指南可参考<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fctripcorp%2Fapollo%2Fwiki%2FApollo%25E4%25BD%25BF%25E7%2594%25A8%25E6%258C%2587%25E5%258D%2597">官网</a></p><p>该服务端只是用来初步体验和测试使用。</p><h1>Apollo的客户端</h1><p>Apollo支持基于Spring Boot、基于Java、基于XML等等多种方式的配置，具体详情可参考<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fctripcorp%2Fapollo%2Fwiki%2FJava%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E4%25BD%25BF%25E7%2594%25A8%25E6%258C%2587%25E5%258D%2597">官网</a></p><p>Apollo会在本地存一份缓存配置文件</p><ul><li>Mac/Linux上文件位置为/opt/data/{appId}/config-cache</li><li>Windows上文件位置为C:\opt\data{appId}\config-cache</li><li>本地配置文件会以{appId}+{cluster}+{namespace}.properties的文件名和格式存储，当获取不到网络配置时会从这个配置中取值</li></ul><p>下面我就介绍最常用、简便、快捷、通用的方式，即基于Spring Boot的集成方式。</p><h2 id="1-首先加入依赖">1 首先加入依赖</h2><pre><code>&lt;dependency&gt;    &lt;groupId&gt;com.ctrip.framework.apollo&lt;/groupId&gt;    &lt;artifactId&gt;apollo-client&lt;/artifactId&gt;    &lt;version&gt;1.1.0&lt;/version&gt;&lt;/dependency&gt;</code></pre><h2 id="2-在服务应用的配置中加入以下配置（本例子中的文件为application-yml）：">2 在服务应用的配置中加入以下配置（本例子中的文件为application.yml）：</h2><pre><code>app:  id: test-appapollo:  meta: http://localhost:8080  #cluster: myCluster  #cacheDir: /opt/testDir  bootstrap:    enable: true    namespaces: applicationenv: DEV</code></pre><ul><li>app.id为在服务端web页面上创建的项目APP的id</li><li>apollo.meta为apollo服务端的地址</li><li>apollo.cluster为要配置的集群名称，如果没有可不填</li><li>apollo.cacheDir为自定义缓存路径</li><li>apollo.bootstrap.enable为是否在工程启动的bootstrap阶段向Spring容器注入被托管的namespaces中的配置</li><li>apollo.bootstrap.namespaces为要使用的namespaces，可在web页面上看到</li><li>env为要获取的配置环境，目前支持以下几个值（大小写不敏感）：<ul><li>DEV(Development environment)</li><li>FAT(Feature Acceptance Test environment)</li><li>UAT(User Acceptance Test environment)</li><li>PRO(Production environment)</li></ul></li></ul><p>在启动Spring Boot的java文件中添加注解：</p><pre><code>@EnableApolloConfig</code></pre><h2 id="Apollo客户端的使用">Apollo客户端的使用</h2><ol><li><p>通过@Value注解即可获取到值</p></li><li><p>可以以类的方式作为bean加载入Spring，例如</p><pre><code> @EnableApolloConfig @Configuration Class A &#123;     @Bean     public getB() &#123;         return new B();     &#125; &#125; Class B &#123;      private int x;     public void setX(int x) &#123;         this.x = x;     &#125;     public int getX() &#123;         return this.x;     &#125; &#125;</code></pre></li></ol><h3 id="推荐阅读更多精彩内容">推荐阅读<a href="/">更多精彩内容</a></h3><ul><li><p><a href="/p/23d695af7e80">Spring Boot 2.0 整合携程Apollo配置中心</a></p><p>Apollo（阿波罗）是携程框架部门研发的分布式配置中心，能够集中化管理应用不同环境、不同集群的配置，配置修改后能…</p><p><a href="/u/0b8c99f738f5">AaronSimon</a>阅读 10,838评论 1赞 43</p></li><li><p><a href="/p/039e7ca8ad0a">携程 Apollo 配置中心分布式部署（Docker）</a></p><p>在Spring Boot 2.0 整合携程Apollo配置中心一文中，我们在本地快速部署试用了Apollo。本文将…</p><p><a href="/u/0b8c99f738f5">AaronSimon</a>阅读 14,762评论 1赞 24</p><p><a href="/p/039e7ca8ad0a"></a></p></li><li><p><a href="/p/d78fa8412cbf">微服务架构中配置中心的选择</a></p><p>目前公司内部微服务架构基础设施建设中，技术选型以Spring Cloud技术为主，也被大家俗称作“全家桶”。 因其…</p><p><a href="/u/62b7335d44e6">东升的思考</a>阅读 32,406评论 1赞 50</p><p><a href="/p/d78fa8412cbf"></a></p></li><li><p><a href="/p/a3094b16571d">Apollo配置中心在项目中应用</a></p><p>Apollo Apollo（Github主页）是携程框架部门研发的配置管理平台，能够集中化管理应用不同环境、不同集…</p><p><a href="/u/44162c749eb3">maxbin</a>阅读 3,479评论 0赞 3</p><p><a href="/p/a3094b16571d"></a></p></li><li><p><a href="/p/7d91cb5109a4">Apollo配置中心遇到的坑</a></p><p>前言 项目用的springboot，连带着配置中心也一直用的spring的配置中心，但是一直以来都有各种问题： 每…</p><p><a href="/u/8cdbdaadc679">绝色天龙</a>阅读 51,272评论 5赞 15</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> K8S集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Apollo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Babel JS 解释器</title>
      <link href="/posts/b2b1d53a.html"/>
      <url>/posts/b2b1d53a.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.yuque.com/zhangalan/totnp7/yc8fbb">babel 实现 js解释器</a><br><img src="./imgs/functionAST.png" alt="functionAST"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&#x27;@babel/parser&#x27;</span>)</span><br><span class="line"><span class="comment">//高亮输出库</span></span><br><span class="line"><span class="keyword">const</span> &#123; codeFrameColumns &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@babel/code-frame&#x27;</span>)</span><br><span class="line"><span class="comment">//颜色打印库</span></span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sourceCode = <span class="string">`</span></span><br><span class="line"><span class="string">   const  a = 2;</span></span><br><span class="line"><span class="string">   function add(a, b) &#123;</span></span><br><span class="line"><span class="string">        return a + b;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">   console.log(add(1, 2));</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*parser 需要指定代码是不是包含 import、export 等，</span></span><br><span class="line"><span class="comment">  需要设置 moduleType 为 module 或者 script，</span></span><br><span class="line"><span class="comment">  我们干脆设置为 unambiguous，让它根据内容是否包含 </span></span><br><span class="line"><span class="comment">  import、export 来自动设置 moduleType。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> ast = parser.<span class="title function_">parse</span>(sourceCode, &#123;</span><br><span class="line">  <span class="attr">sourceType</span>: <span class="string">&#x27;unambiguous&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">要支持函数调用，首先要支持作用域链，</span></span><br><span class="line"><span class="comment">因为函数执行会生成一个新的作用域，并且会按照作用域链查找变量。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//定义作用域</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Scope</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">parentScope</span>) &#123;</span><br><span class="line">    <span class="comment">// parentScope 属性指向父 scope</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">parent</span> = parentScope;</span><br><span class="line">    <span class="comment">// 该scope 中声明的变量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">declarations</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 本作用域中声明变量</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">name, value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">declarations</span>[name] = value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查找本作用域的变量</span></span><br><span class="line">  <span class="title function_">getLocal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">declarations</span>[name]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 支持按照作用域链不断向上查找变量</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> res = <span class="variable language_">this</span>.<span class="title function_">getLocal</span>(name)</span><br><span class="line">    <span class="keyword">if</span> (res === <span class="literal">undefined</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">parent</span>) &#123;</span><br><span class="line">      res = <span class="variable language_">this</span>.<span class="property">parent</span>.<span class="title function_">get</span>(name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 本作用域中是否存在该变量的声明</span></span><br><span class="line">  <span class="title function_">has</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !!<span class="variable language_">this</span>.<span class="title function_">getLocal</span>(name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getIdentifierValue</span>(<span class="params">node, scope</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (node.<span class="property">type</span> === <span class="string">&#x27;Identifier&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> scope.<span class="title function_">get</span>(node.<span class="property">name</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> evaluate(node, scope)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AST 解释器 evaluator</span></span><br><span class="line"><span class="comment"> * 从根节点来执行，最外层是 File 节点，取 program 属性，Program 有 body 属性，是 AST 的数组，遍历执行。</span></span><br><span class="line"><span class="comment"> * 如果有不支持的节点类型，通过 code frame 来打印 AST 对应的代码，并且提示不支持。</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">const</span> evaluator = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> astInterpreters = &#123;</span><br><span class="line">    <span class="title class_">Program</span>(node, scope) &#123;</span><br><span class="line">      node.<span class="property">body</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        evaluate(item, scope)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//const  a = 2;</span></span><br><span class="line">    <span class="title class_">VariableDeclaration</span>(node, scope) &#123;</span><br><span class="line">      node.<span class="property">declarations</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        evaluate(item, scope)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//a = 2;</span></span><br><span class="line">    <span class="title class_">VariableDeclarator</span>(node, scope) &#123;</span><br><span class="line">      <span class="keyword">const</span> declareName = evaluate(node.<span class="property">id</span>)</span><br><span class="line">      <span class="keyword">if</span> (scope.<span class="title function_">get</span>(declareName)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;duplicate declare variable：&#x27;</span> + declareName)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        scope.<span class="title function_">set</span>(declareName, evaluate(node.<span class="property">init</span>, scope))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//console.log(add(1, 2))</span></span><br><span class="line">    <span class="title class_">ExpressionStatement</span>(node, scope) &#123;</span><br><span class="line">      <span class="keyword">return</span> evaluate(node.<span class="property">expression</span>, scope)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title class_">MemberExpression</span>(node, scope) &#123;</span><br><span class="line">      <span class="keyword">const</span> obj = scope.<span class="title function_">get</span>(evaluate(node.<span class="property">object</span>))</span><br><span class="line">      <span class="keyword">return</span> obj[evaluate(node.<span class="property">property</span>)]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// function add(a, b) &#123;</span></span><br><span class="line">    <span class="comment">//     return a + b;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="title class_">FunctionDeclaration</span>(node, scope) &#123;</span><br><span class="line">      <span class="keyword">const</span> declareName = evaluate(node.<span class="property">id</span>) <span class="comment">//add</span></span><br><span class="line">      <span class="keyword">if</span> (scope.<span class="title function_">get</span>(declareName)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;duplicate declare variable：&#x27;</span> + declareName)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//将add添加到作用域中，当函数执行时内部作用域产生</span></span><br><span class="line">        <span class="comment">//闭包：内部函数对外部词法作用域的引用，编译时产生</span></span><br><span class="line">        scope.<span class="title function_">set</span>(declareName, <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> funcScope = <span class="keyword">new</span> <span class="title class_">Scope</span>()</span><br><span class="line">          funcScope.<span class="property">parent</span> = scope</span><br><span class="line">          node.<span class="property">params</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">            funcScope.<span class="title function_">set</span>(item.<span class="property">name</span>, args[index])</span><br><span class="line">          &#125;)</span><br><span class="line">          funcScope.<span class="title function_">set</span>(<span class="string">&#x27;this&#x27;</span>, <span class="variable language_">this</span>)</span><br><span class="line">          <span class="keyword">return</span> evaluate(node.<span class="property">body</span>, funcScope)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">ReturnStatement</span>(node, scope) &#123;</span><br><span class="line">      <span class="keyword">return</span> evaluate(node.<span class="property">argument</span>, scope)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">BlockStatement</span>(node, scope) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">body</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">body</span>[i].<span class="property">type</span> === <span class="string">&#x27;ReturnStatement&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> evaluate(node.<span class="property">body</span>[i], scope)</span><br><span class="line">        &#125;</span><br><span class="line">        evaluate(node.<span class="property">body</span>[i], scope)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">CallExpression</span>(node, scope) &#123;</span><br><span class="line">      <span class="keyword">const</span> args = node.<span class="property">arguments</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="string">&#x27;Identifier&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> scope.<span class="title function_">get</span>(item.<span class="property">name</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> evaluate(item, scope)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">callee</span>.<span class="property">type</span> === <span class="string">&#x27;MemberExpression&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> fn = evaluate(node.<span class="property">callee</span>, scope)</span><br><span class="line">        <span class="keyword">const</span> objName = evaluate(node.<span class="property">callee</span>.<span class="property">object</span>, scope)</span><br><span class="line">        <span class="keyword">const</span> obj = scope.<span class="title function_">get</span>(objName)</span><br><span class="line">        <span class="keyword">return</span> fn.<span class="title function_">apply</span>(obj, args)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> fn = scope.<span class="title function_">get</span>(evaluate(node.<span class="property">callee</span>, scope))</span><br><span class="line">        <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="literal">null</span>, args)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//a+b</span></span><br><span class="line">    <span class="title class_">BinaryExpression</span>(node, scope) &#123;</span><br><span class="line">      <span class="keyword">const</span> leftValue = <span class="title function_">getIdentifierValue</span>(node.<span class="property">left</span>, scope)</span><br><span class="line">      <span class="keyword">const</span> rightValue = <span class="title function_">getIdentifierValue</span>(node.<span class="property">right</span>, scope)</span><br><span class="line">      <span class="keyword">switch</span> (node.<span class="property">operator</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> leftValue + rightValue</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> leftValue - rightValue</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> leftValue * rightValue</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">          <span class="keyword">return</span> leftValue / rightValue</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;upsupported operator：&#x27;</span> + node.<span class="property">operator</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">Identifier</span>(node) &#123;</span><br><span class="line">      <span class="keyword">return</span> node.<span class="property">name</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">NumericLiteral</span>(node) &#123;</span><br><span class="line">      <span class="keyword">return</span> node.<span class="property">value</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">evaluate</span> = (<span class="params">node, scope</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> astInterpreters[node.<span class="property">type</span>](node, scope)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        e &amp;&amp;</span><br><span class="line">        e.<span class="property">message</span> &amp;&amp;</span><br><span class="line">        e.<span class="property">message</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;astInterpreters[node.type] is not a function&#x27;</span>) != -<span class="number">1</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;unsupported ast type: &#x27;</span> + node.<span class="property">type</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(</span><br><span class="line">          <span class="title function_">codeFrameColumns</span>(sourceCode, node.<span class="property">loc</span>, &#123;</span><br><span class="line">            <span class="attr">highlightCode</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">        )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(node.<span class="property">type</span> + <span class="string">&#x27;:&#x27;</span>, e.<span class="property">message</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(</span><br><span class="line">          <span class="title function_">codeFrameColumns</span>(sourceCode, node.<span class="property">loc</span>, &#123;</span><br><span class="line">            <span class="attr">highlightCode</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    evaluate,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> globalScope = <span class="keyword">new</span> <span class="title class_">Scope</span>()</span><br><span class="line">globalScope.<span class="title function_">set</span>(<span class="string">&#x27;console&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">log</span>: <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">green</span>(...args))</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">red</span>(...args))</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">orange</span>(...args))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">evaluator.evaluate(ast.<span class="property">program</span>, globalScope)</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(globalScope);</span></span><br></pre></td></tr></table></figure><h3 id="参考链接">参考链接</h3><p><a href="https://astexplorer.net/">astexplorer</a></p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v8 的编译流程</title>
      <link href="/posts/4b9cd52d.html"/>
      <url>/posts/4b9cd52d.html</url>
      
        <content type="html"><![CDATA[<h3 id="v8-的编译流程">v8 的编译流程</h3><p><img src="imgs/compiler.png" alt="编译过程"></p><ol><li>将 Javascript 代码解析为 ATS（抽象语法树）。</li><li>基于 AST， 解释器（interpreter ）将 AST 转化为字节码（bytecode），这一步 js 引擎实际上已经在执行 js 代码了。</li><li>为了进一步的优化，优化编译器（optimizing compiler）将热点函数优化编译为机器指令（machine code）执行。</li><li>如果优化假设失败，优化编译器会将机器码回退到字节码。</li></ol><p>不过最早的 V8 是没有字节码的，就是直接解释执行 AST：</p><p><img src="imgs/old-compiler.png" alt=""></p><p>基于AST的灵活性诞生了很多工具，例如babel、webpack等等。</p><p>接下来就简单了解一下babel、webpack，并在最后搭建一个 react 脚手架。</p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Babel之前端埋点</title>
      <link href="/posts/1fff7ad6.html"/>
      <url>/posts/1fff7ad6.html</url>
      
        <content type="html"><![CDATA[<h3 id="babel与前端监控和前端埋点方案设计">babel与前端监控和前端埋点方案设计</h3><p>一、为什么需要前端监控<br>前端监控的目的是：<br>获取用户行为以及跟踪产品在用户端的使用情况，并以监控数据为基础，指明产品优化的方向。<br>前端监控可以分为三类：数据监控、性能监控和异常监控。下面我们来一一的了解。<br>(1)数据监控<br>数据监控，顾名思义就是监听用户的行为。常见的数据监控包括：<br>PV/UV:PV(page view)，即页面浏览量或点击量。UV:指访问某个站点或点击某条新闻的不同IP地址的人数<br>用户在每一个页面的停留时间<br>用户通过什么入口来访问该网页<br>用户在相应的页面中触发的行为<br>统计这些数据是有意义的，比如我们知道了用户来源的渠道，可以促进产品的推广，知道用户在每一个页面停留的时间，可以针对停留较长的页面，增加广告推送等等。<br>(2)性能监控<br>性能监控指的是监听前端的性能，主要包括监听网页或者说产品在用户端的体验。常见的性能监控数据包括：<br>不同用户，不同机型和不同系统下的首屏加载时间<br>白屏时间<br>http等请求的响应时间<br>静态资源整体下载时间<br>页面渲染时间<br>页面交互动画完成时间<br>这些性能监控的结果，可以展示前端性能的好坏，根据性能监测的结果可以进一步的去优化前端性能，比如兼容低版本浏览器的动画效果，加快首屏加载等等。<br>(3)异常监控<br>此外，产品的前端代码在执行过程中也会发生异常，因此需要引入异常监控。及时的上报异常情况，可以避免线上故障的发上。虽然大部分异常可以通过try catch的方式捕获，但是比如内存泄漏以及其他偶现的异常难以捕获。常见的需要监控的异常包括：<br>Javascript的异常监控<br>样式丢失的异常监控<br>二、常用前端埋点方案总结<br>在上一节中介绍了前端监控的作用，那么如何实现前端监控呢，实现前端监控的步骤为：前端埋点和上报、数据处理和数据分析。首要的步骤就是前端埋点和上报，也就是数据的收集阶段。数据收集的丰富性和准确性会影响对产品线上效果的判别结果。<br>目前常见的前端埋点方法分为三种：代码埋点、可视化埋点和无痕埋点。下面一一介绍每一种埋点的方法。<br>(1) 代码埋点<br>代码埋点，就是以嵌入代码的形式进行埋点，比如需要监控用户的点击事件，会选择在用户点击时，插入一段代码，保存这个监听行为或者直接将监听行为以某一种数据格式直接传递给server端。此外比如需要统计产品的PV和UV的时候，需要在网页的初始化时，发送用户的访问信息等。<br>代码埋点的优点：<br>可以在任意时刻，精确的发送或保存所需要的数据信息。<br>缺点：<br>工作量较大，每一个组件的埋点都需要添加相应的代码<br>(2)可视化埋点<br>通过可视化交互的手段，代替代码埋点。将业务代码和埋点代码分离，提供一个可视化交互的页面，输入为业务代码，通过这个可视化系统，可以在业务代码中自定义的增加埋点事件等等，最后输出的代码耦合了业务代码和埋点代码。<br>可视化埋点听起来比较高大上，实际上跟代码埋点还是区别不大。也就是用一个系统来实现手动插入代码埋点的过程。<br>缺点：<br>可视化埋点可以埋点的控件有限，不能手动定制。<br>(3)无埋点<br>无埋点并不是说不需要埋点，而是全部埋点，前端的任意一个事件都被绑定一个标识，所有的事件都别记录下来。通过定期上传记录文件，配合文件解析，解析出来我们想要的数据，并生成可视化报告供专业人员分析因此实现“无埋点”统计。<br>从语言层面实现无埋点也很简单，比如从页面的js代码中，找出dom上被绑定的事件，然后进行全埋点。<br>无埋点的优点：<br>由于采集的是全量数据，所以产品迭代过程中是不需要关注埋点逻辑的，也不会出现漏埋、误埋等现象<br>缺点：<br>无埋点采集全量数据，给数据传输和服务器增加压力<br>无法灵活的定制各个事件所需要上传的数据<br>三、前端埋点方案选型和前端上报方案设计<br>第一章中介绍了前端所需要监听的信息，在第二章中介绍了前端埋点的常见方式，本文来根据需求，来定制我们的埋点和上报方案。<br>(1)监控数据<br>首先我们需要明确一个产品或者网页，普遍需要监控和上报的数据。监控的分为三个阶段：用户进入网页首页、用户在网页内部交互和交互中报错。每一个阶段需要监控和上报的数据如下图所示：<br><img src="imgs/%E7%9B%91%E6%8E%A7.webp" alt=""></p><p>(2)埋点方案<br>在实际项目中考虑到上报数据的灵活定制，以及减少数据传输和服务器的压力，在所需埋点处不多的情况下，常用的方式是代码埋点。<br>以用户进入首页为例，我们在首页渲染完成后会发送事件类型和类型相关的数据给server端，告知首页的监控信息。<br><img src="imgs/%E5%9F%8B%E7%82%B9.webp" alt=""></p><p>(3)上报周期和上报数据类型<br>如果埋点的事件不是很多，上报可以时时进行，比如监控用户的交互事件，可以在用户触发事件后，立刻上报用户所触发的事件类型。如果埋点的事件较多，或者说网页内部交互频繁，可以通过本地存储的方式先缓存上报信息，然后定期上报。<br>接着来确定需要埋点上报的数据，上报的信息包括用户个人信息以及用户行为，主要数据可以分为：<br>● who: appid(系统或者应用的id),userAgent(用户的系统、网络等信息)<br>● when: timestamp(上报的时间戳)<br>● from where: currentUrl(用户当前url)，fromUrl(从哪一个页面跳转到当前页面)，type(上报的事件类型),element(触发上报事件的元素）<br>● what: 上报的自定义扩展数据data:{},扩展数据中可以按需求定制，比如包含uid等信息<br>上报数据的对象为：</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;   </span><br><span class="line">    ----------------上报接口本身提供--------------------</span><br><span class="line"><span class="built_in">    currentUrl,</span>  </span><br><span class="line"><span class="built_in">    fromUrl,</span></span><br><span class="line"><span class="built_in">    timestamp,</span></span><br><span class="line"><span class="title">    userAgent:</span>&#123;</span><br><span class="line"><span class="built_in">       os,</span></span><br><span class="line"><span class="built_in">       netWord,</span></span><br><span class="line">    &#125;</span><br><span class="line">    ----------------业务代码配置和自定义上报数据------------</span><br><span class="line"><span class="built_in">    type,</span></span><br><span class="line"><span class="built_in">    appid,</span></span><br><span class="line"><span class="built_in">    element,</span></span><br><span class="line"><span class="title">    data:</span>&#123;</span><br><span class="line"><span class="built_in">        uid,</span></span><br><span class="line">        uname</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(4)埋点和上报举例<br>我们以上报首屏加载事件为例，DOM提供了document的DOMContentLoaded事件来监听dom挂载，提供了window的load事件来监听页面所有资源加载渲染完毕。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script <span class="keyword">type</span>=&quot;text/javascript&quot;&gt;</span><br><span class="line">  var start=<span class="type">Date</span>.now();</span><br><span class="line">  document.addEventListener(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>() &#123;</span><br><span class="line">     <span class="keyword">fetch</span>(<span class="string">&#x27;some api&#x27;</span>,&#123;</span><br><span class="line">         <span class="keyword">type</span>:<span class="string">&#x27;dom complete&#x27;</span>,</span><br><span class="line">         data:&#123;</span><br><span class="line">           domCompletedTime:<span class="type">Date</span>.now()-<span class="keyword">start</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">window</span>.addEventListener(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span>() &#123;</span><br><span class="line">     <span class="keyword">fetch</span>(<span class="string">&#x27;some api&#x27;</span>,&#123;</span><br><span class="line">         <span class="keyword">type</span>:<span class="string">&#x27;load complete&#x27;</span>,</span><br><span class="line">         data:&#123;</span><br><span class="line">           LoadCompletedTime:<span class="type">Date</span>.now()-<span class="keyword">start</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(5)前端埋点系统的前后端通信加密<br>在上报数据的前后端通信中，需要和server端协商加密机制，利用 OpenSSL库来实现的加密，OpenSSL已经是一个广泛被采用的加密算法。前端可以采用node的crypto模块。<br>首先来看hash算法，crypto.createHash() 来创建一个Hash实例，可利用的hash算法如下：<br>● md5<br>● sha1<br>● sha256<br>● sha512<br>● ripemd160<br>以sha256算法加密为例：<br>const str=“123445”;//需要加密的字段 const hash=crypto.createHash(‘sha256’);//指定加密算法 hash.update(str); //通过算法加密相应的字段 const result=hash.digest(‘hex’);//转化成十六进制 复制代码</p><p>四、前端监控结果可视化展示系统的设计<br>当后端得到前端上报的信息之后，经过数据分析和处理，需要前端可视化的展示数据分析后的结果。<br>可以在开源中后台系统ant-design-pro的基础上进行二次开发，首先要明确展示信息。展示的信息包括单个用户和整体应用。<br>对于单个用户来说需要展示的监控信息为：<br>● 单个用户，在交互过程中触发各个埋点事件的次数<br>● 单个用户，在某个时间周期内，访问本网页的入口来源<br>● 单个用户，在每一个子页面的停留时间<br>对于全体用户需要展示的信息为：<br>● 某一个时间段内网页的PV和UV<br>● 全体用户访问网页的设备和操作系统分析<br>● 某一个时间段内访问本网页的入口来源分析<br>● 全体用户在访问本网页时，在交互过程中触发各个埋点事件的总次数<br>● 全体用户在访问本网页时，网页上报异常的集合<br>删选功能集合：<br>● 时间筛选：提供今日（00点到当前时间）、本周、本月和全年<br>● 用户删选：提供根据用户id删选出用户行为的统计信息<br>● 设备删选：删选不同系统的整体展示信息</p><p>babel埋点方案<br>分成两类更合适。一类是产品相关的数据指标比如转化率、点击率、UV、PV等等；一类是项目质量、性能相关的，这种可以叫做打点。大公司内部都会有自己的性能平台工具。引入之后可以在一些关键的地方打点做数据统计，比如首屏、http请求、js报错等等，对于业务本身自己也可以做一些手动打点，并且对打点上报的数据自定义报警，线上一旦出错就可以实时的收到报警</p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Babel 基础概念</title>
      <link href="/posts/4af1cee0.html"/>
      <url>/posts/4af1cee0.html</url>
      
        <content type="html"><![CDATA[<h3 id="Babel是什么？">Babel是什么？</h3><p>Babel 是一个 JavaScript 编译器<br>Babel 是一个工具链，主要用于将采用 ECMAScript 2015+ 语法编写的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中。下面列出的是 Babel 能为你做的事情：</p><p>● 语法转换<br>● 通过 Polyfill 方式在目标环境中添加缺失的特性 （通过引入第三方 polyfill 模块，例如 core-js）（preset env 会根据 targets 来引入插件，实现转换和 polyfill）<br>● 源码转换（codemods）</p><p>利用Babel对源码的操作，可以用来静态分析。实战中经常会用到的有：自动国际化、自动生成文档、自动埋点、js解释器等。</p><h3 id="Babel的编译过程">Babel的编译过程</h3><p>babel 是 source to source 的转换，整体编译流程分为三步：</p><p>● parse：通过 parser 把源码转成抽象语法树（AST）<br>● transform：遍历 AST，调用各种 transform 插件对 AST 进行增删改<br>● generate：把转换后的 AST 打印成目标代码，并生成 sourcemap</p><p><strong>parse</strong></p><p>parse 阶段的目的是把源码字符串转换成机器能够理解的 AST，这个过程分为词法分析、语法分析。</p><p>比如 let name = ‘lin’; 这样一段源码，我们要先把它分成一个个不能细分的单词（token），也就是 let, name, =, ‘lin’，这个过程是词法分析，按照单词的构成规则来拆分字符串成单词。</p><p>之后要把 token 进行递归的组装，生成 AST，这个过程是语法分析，按照不同的语法结构，来把一组单词组合成对象。</p><p><strong>transform</strong></p><p>transform 阶段是对 parse 生成的 AST 的处理，会进行 AST 的遍历，遍历的过程中处理到不同的 AST 节点会调用注册的相应的 visitor 函数，visitor 函数里可以对 AST 节点进行增删改，返回新的 AST（可以指定是否继续遍历新生成的 AST）。这样遍历完一遍 AST 之后就完成了对代码的修改。</p><p><strong>generate</strong><br>generate 阶段会把 AST 打印成目标代码字符串，并且会生成 sourcemap。不同的 AST 对应的不同结构的字符串。比如 IfStatement 就可以打印成 if(test) {} 格式的代码。这样从 AST 根节点进行递归打印，就可以生成目标代码的字符串。</p><blockquote><p>sourcemap 记录了源码到目标代码的转换关系，通过它我们可以找到目标代码中每一个节点对应的源码位置</p></blockquote><p><strong>AST</strong></p><p>babel 编译的第一步是把源码 parse 成抽象语法树 AST （Abstract Syntax Tree），后续对这个 AST 进行转换。（之所以叫抽象语法树是因为省略掉了源码中的分隔符、注释等内容）</p><p>AST 也是有标准的，JS parser 的 AST 大多是 estree 标准，从 SpiderMonkey 的 AST 标准扩展而来。babel 的整个编译流程都是围绕 AST 来的，这一节我们来学一下 AST。</p><p>熟悉了 AST，也就是知道转译器和 JS 引擎是怎么理解代码的，对深入掌握 Javascript 也有很大的好处。</p><p><strong>常见的AST</strong></p><p>AST 是对源码的抽象，字面量、标识符、表达式、语句、模块语法、class 语法都有各自的 AST。我们分别来了解一下：</p><p>Literal</p><p>是字面量的意思，比如 let name = 'lin’中，'lin’就是一个字符串字面量 StringLiteral，相应的还有数字字面量 NumericLiteral，布尔字面量 BooleanLiteral，字符串字面量 StringLiteral，正则表达式字面量 RegExpLiteral 等。</p><p>Identifier</p><p>Identifer 是标识符的意思，变量名、属性名、参数名等各种声明和引用的名字，都是Identifer。<br>比如 let name = ‘lin’ 里面的name</p><p>Statement</p><p>statement 是语句，它是可以独立执行的单位，比如 break、continue、debugger、return 或者 if 语句、while 语句、for 语句，还有声明语句，表达式语句等。我们写的每一条可以独立执行的代码都是语句。</p><p>Declaration</p><p>声明语句是一种特殊的语句，它执行的逻辑是在作用域内声明一个变量、函数、class、import、export 等。</p><p>Expression</p><p>expression 是表达式，特点是执行完以后有返回值，这是和语句 (statement) 的区别。<br>有的节点可能会是多种类型，identifier、super 有返回值，符合表达式的特点，所以也是 expression。</p><p>Program &amp; Directive</p><p>program 是代表整个程序的节点，它有 body 属性代表程序体，存放 statement 数组，就是具体执行的语句的集合。还有 directives 属性，存放Directive 节点，比如&quot;use strict&quot; 这种指令会使用 Directive 节点表示。</p><p>File &amp; Comment</p><p>babel 的 AST 最外层节点是 File，它有 program、comments、tokens 等属性，分别存放 Program 程序体、注释、token 等，是最外层节点。<br>注释分为块注释和行内注释，对应 CommentBlock 和 CommentLine 节点。</p><p><strong>AST 可视化查看工具</strong></p><p>当然，我们并不需要记什么内容对应什么 AST 节点，可以通过 <a href="http://axtexplorer.net">axtexplorer.net</a> 这个网站来直观的查看。</p><p>AST 的公共属性</p><p>每种 AST 都有自己的属性，但是它们也有一些公共属性：</p><p>● type： AST 节点的类型<br>● start、end、loc：start 和 end 代表该节点对应的源码字符串的开始和结束下标，不区分行列。而 loc 属性是一个对象，有 line 和 column 属性分别记录开始和结束行列号。<br>● leadingComments、innerComments、trailingComments： 表示开始的注释、中间的注释、结尾的注释，因为每个 AST 节点中都可能存在注释，而且可能在开始、中间、结束这三种位置，通过这三个属性来记录和 Comment 的关联。<br>● extra：记录一些额外的信息，用于处理一些特殊情况。比如 StringLiteral 修改 value 只是值的修改，而修改 extra.raw 则可以连同单双引号一起修改。</p><h3 id="Babel-API">Babel API</h3><p>@babel/parser</p><p>Babel parser（以前的 Babylon）是Babel 中使用的 JavaScript 解析器。</p><p>输出</p><p>Babel 解析器根据Babel AST 格式生成 AST 。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;@babel/parser&quot;</span>).<span class="title function_">parse</span>(<span class="string">&quot;code&quot;</span>, &#123;</span><br><span class="line">  <span class="comment">// parse in strict mode and allow module declarations</span></span><br><span class="line">  <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// enable jsx and flow syntax</span></span><br><span class="line">    <span class="string">&quot;jsx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;flow&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>@babel/traverse</p><p>当您想要转换一个AST时，您必须递归地遍历树。<br>我们可以将它与 babel 解析器一起使用来遍历和更新节点：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> parser <span class="keyword">from</span> <span class="string">&quot;@babel/parser&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> traverse <span class="keyword">from</span> <span class="string">&quot;@babel/traverse&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`function square(n) &#123;</span></span><br><span class="line"><span class="string">  return n * n;</span></span><br><span class="line"><span class="string">&#125;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ast = parser.<span class="title function_">parse</span>(code);</span><br><span class="line"></span><br><span class="line"><span class="title function_">traverse</span>(ast, &#123;</span><br><span class="line">  <span class="title function_">enter</span>(<span class="params">path</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.<span class="title function_">isIdentifier</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;n&quot;</span> &#125;)) &#123;</span><br><span class="line">      path.<span class="property">node</span>.<span class="property">name</span> = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Visitors</p><p>当我们谈论“去”一个节点，我们实际上意味着我们正在访问它们。我们之所以使用visitor这个术语，是因为有访问者这个概念。<br>访问者是跨语言的 AST 遍历中使用的模式。简单地说，它们是一个对象，其中定义了用于接受树中特定节点类型的方法。这有点抽象，让我们来看一个例子。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="title class_">Identifier</span>() &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Called!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// You can also create a visitor and add methods on it later</span></span><br><span class="line"><span class="keyword">let</span> visitor = &#123;&#125;;</span><br><span class="line">visitor.<span class="property">MemberExpression</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line">visitor.<span class="property">FunctionDeclaration</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意:Identifier(){…}是Identifier:{enter(){…}}的缩写。</p></blockquote><p>这是一个基本的访问者，在遍历过程中使用时，它将为树中的每个 Identifier 调用 Identifier ()方法。<br>因此，使用这段代码，Identifier ()方法将被每个 Identifier (包括平方)调用四次。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path.<span class="title function_">traverse</span>(<span class="title class_">MyVisitor</span>);</span><br><span class="line"><span class="title class_">Called</span>!</span><br><span class="line"><span class="title class_">Called</span>!</span><br><span class="line"><span class="title class_">Called</span>!</span><br><span class="line"><span class="title class_">Called</span>!</span><br></pre></td></tr></table></figure><p>让我们看看上面那个树怎么运行的</p><ul><li>Enter FunctionDeclaration<ul><li>Enter Identifier (id)<ul><li>Hit dead end</li></ul></li><li>Exit Identifier (id)</li><li>Enter Identifier (params[0])<ul><li>Hit dead end</li></ul></li><li>Exit Identifier (params[0])</li><li>Enter BlockStatement (body)<ul><li>Enter ReturnStatement (body)<ul><li>Enter BinaryExpression (argument)<br>-2 Enter Identifier (left)<ul><li>Hit dead end</li><li>Exit Identifier (left)</li><li>Enter Identifier (right)<ul><li>Hit dead end</li></ul></li><li>Exit Identifier (right)</li></ul></li><li>Exit BinaryExpression (argument)</li></ul></li><li>Exit ReturnStatement (body)</li></ul></li><li>Exit BlockStatement (body)</li></ul></li><li>Exit FunctionDeclaration</li></ul><p>如果需要，还可以为多个访问者节点应用相同的函数，方法是将它们与方法名中的 | 作为一个字符串(比如 Identifier | MemberExpression)分开。<br>flow-comments插件中的用法示例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyVisitor</span> = &#123;</span><br><span class="line">  <span class="string">&quot;ExportNamedDeclaration|Flow&quot;</span>(path) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>@babel/generator</p><p>将 AST 转换为代码。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; parse &#125; <span class="keyword">from</span> <span class="string">&quot;@babel/parser&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> generate <span class="keyword">from</span> <span class="string">&quot;@babel/generator&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">&quot;class Example &#123;&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> ast = <span class="title function_">parse</span>(code);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> output = <span class="title function_">generate</span>(</span><br><span class="line">  ast,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">/* options */</span></span><br><span class="line">    <span class="attr">sourceMaps</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  code</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>@babel/code-frame</p><p>一般用于标出代码位置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; codeFrameColumns &#125; <span class="keyword">from</span> <span class="string">&quot;@babel/code-frame&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rawLines = <span class="string">`class Foo &#123;</span></span><br><span class="line"><span class="string">  constructor()</span></span><br><span class="line"><span class="string">&#125;`</span>;</span><br><span class="line"><span class="keyword">const</span> location = &#123; <span class="attr">start</span>: &#123; <span class="attr">line</span>: <span class="number">2</span>, <span class="attr">column</span>: <span class="number">16</span> &#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">codeFrameColumns</span>(rawLines, location, &#123;</span><br><span class="line">  <span class="comment">/* options */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更多库 可以到Babel官网进行查看。</p><p>用途</p><p>老生常谈的 ES6 -&gt; ES5 、动态导入、特殊语法转换、taro编译 … 就不说了</p><p>自动埋点<br><a href="https://github.com/jialongsu/babel-auto-tracker">https://github.com/jialongsu/babel-auto-tracker</a></p><p>自动国际化<br>react-i18n-auto babel插件</p><p>自动生成API文档<br>other<br>linter 压缩混淆类型检查模块遍历器</p><p><strong>常用插件说明</strong></p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> babel-loader: 在webpack里应用 babel 解析ES6的桥梁</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> @babel/core: babel核心模块</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> @babel/preset-env: babel预设，一组 babel 插件的集合</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> @babel/plugin-transform-runtime: 在需要regeneratorRuntime的地方自动<span class="built_in">require</span>导包，编译时需要，[regeneratorRuntime全局辅助函数，用于兼容 <span class="keyword">async</span>/<span class="keyword">await</span> 语法]</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> @babel/plugin-proposal-decorators: 将类和对象修饰符编译到ES5</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span> @babel/plugin-syntax-dynamic-import: 允许解析 <span class="keyword">import</span>()</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span> @babel/plugin-proposal-<span class="keyword">class</span>-properties: 转换类属性(包括赋值定义、<span class="built_in">Object</span>.defindProperty定义)</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span> @babel/plugin-proposal-<span class="keyword">export</span>-<span class="keyword">default</span>-from: 编译 <span class="keyword">export</span> <span class="keyword">default</span> 为 ES2015(ES6)</span><br><span class="line"></span><br><span class="line"><span class="number">9.</span> @babel/plugin-proposal-optional-chaining: 编译可选链</span><br><span class="line"></span><br><span class="line"><span class="number">10.</span> @babel/plugin-transform-react-constant-elements: 将React元素提升到尽可能高的范围，防止多次不必要的重新实例化，从而加快协调并降低垃圾收集压力 </span><br></pre></td></tr></table></figure><h3 id="babel优质文章">babel优质文章</h3><p><a href="https://juejin.cn/post/6844904079118827533">政采云–前端工程师的自我修养-关于 Babel 那些事儿</a><br><a href="https://juejin.cn/post/6844904061934780424">前端工程实践之数据埋点分析系统（一）</a><br><a href="http://www.imooc.com/article/27151">前端埋点的那些事</a><br><a href="https://juejin.cn/post/6844903956905197576#heading-7">深入浅出 Babel 上篇：架构和原理 + 实战</a><br><a href="https://juejin.cn/post/6844903961820921869">深入浅出 Babel 下篇：既生 Plugin 何生 Macros</a></p><p><a href="https://www.yuque.com/zhangalan/totnp7/qh98xg">babel手册</a><br><a href="https://www.yuque.com/zhangalan/totnp7/lpcx5w">babel插件</a></p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack 工程中集成 TypeScript</title>
      <link href="/posts/d0e23c27.html"/>
      <url>/posts/d0e23c27.html</url>
      
        <content type="html"><![CDATA[<h3 id="Webpack-工程中集成-TypeScript">Webpack 工程中集成 TypeScript</h3><ol><li>安装ts及对应loader</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i typescript ts-loader -D</span><br></pre></td></tr></table></figure><ol start="2"><li>项目根目录下创建 <code>tsconfig.json</code></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">npx tsc --init</span><br><span class="line"></span><br><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;./dist/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;noImplicitAny&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;sourceMap&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;module&quot;</span>: <span class="string">&quot;es6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span>,</span><br><span class="line">    <span class="string">&quot;allowJs&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.typescriptlang.org/dt/search">类型查询网址</a></p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build Library</title>
      <link href="/posts/85a61465.html"/>
      <url>/posts/85a61465.html</url>
      
        <content type="html"><![CDATA[<h3 id="Library">Library</h3><blockquote><p>打包类库 <code>lib</code> (组件库、工具、框架)</p></blockquote><ul><li>打包 lib</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params">x, y</span>) =&gt; x + y;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置 library 避免 production 模式下 webpack tree sharking</span></span><br><span class="line"><span class="comment"> * type</span></span><br><span class="line"><span class="comment"> * - window 在浏览器环境中使用</span></span><br><span class="line"><span class="comment"> * - commonjs 在nodejs 环境中使用</span></span><br><span class="line"><span class="comment"> * - module ES Module模块</span></span><br><span class="line"><span class="comment"> * - umd 即可将包 应用在 script标签、commonjs、amd(require.js)、nodejs等环境中</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// window、commonjs </span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;mylib.js&#x27;</span>,</span><br><span class="line">    <span class="attr">library</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;mylib&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;window&#x27;</span>   <span class="comment">// window、commonjs</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES Module 下</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">experiments</span>: &#123;</span><br><span class="line">    <span class="attr">outputModule</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;mylib.js&#x27;</span>,</span><br><span class="line">    <span class="attr">library</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;module&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 终极方案(支持script标签、commonjs、amd， 对ES Module支持待考究！)</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;mylib.js&#x27;</span>,</span><br><span class="line">    <span class="attr">library</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;mylib&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;umd&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">globalObject</span>: <span class="string">&#x27;globalThis&#x27;</span> <span class="comment">// 全局 this 代替 self，解决node环境下 self is not defined</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 从输出的 bundle 中排除依赖lodash、jquery等，兼容 commonjs、amd等</span></span><br><span class="line">  <span class="attr">externals</span>: &#123;</span><br><span class="line">    <span class="attr">lodash</span>: &#123;</span><br><span class="line">      <span class="attr">commonjs</span>: <span class="string">&#x27;lodash&#x27;</span>,</span><br><span class="line">      <span class="attr">amd</span>: <span class="string">&#x27;lodash&#x27;</span>,</span><br><span class="line">      <span class="attr">root</span>: <span class="string">&#x27;_&#x27;</span>, <span class="comment">// 指向全局变量</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">jquery</span>: [</span><br><span class="line">      <span class="string">&#x27;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;$&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>发布npm包</strong></p><ul><li>确认源 <code>npm config get registry</code></li><li>npm adduser<ul><li>Jahaw</li><li>xxx</li><li><a href="mailto:xxx@163.com">xxx@163.com</a></li></ul></li><li>npm publish</li><li>注意事项：发包前确认 <code>package.json main</code> 入口是否正确！！！</li></ul>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>模块联邦 Module Federation</title>
      <link href="/posts/4bf75479.html"/>
      <url>/posts/4bf75479.html</url>
      
        <content type="html"><![CDATA[<h3 id="模块联邦-Module-Federation">模块联邦 Module Federation</h3><blockquote><p>多个独立构建可以组成一个独立应用程序、这些独立构建之间不存在任何依赖关系，因此可以单独开发和部署,这个通常称为<code>微前端</code><br>webpack 可以通过 <code>dll</code> 、 <code>externals</code>做到代码共享时的common chunk, 但不同应用和项目之间实现前者就比较困难了，无法在项目之间做到按需<code>热插拔</code><br>可以让项目达到线上 <code>runtime</code>效果，代码在项目间，直接利用<code>cda</code>之间共享，不再需要本地安装 <code>npm包</code> 构建再发布了</p></blockquote><ul><li><p>NPM 方式共享代码</p><ul><li>将依赖作为一个lib安装在项目里，进行webpack打包，然后构建上线</li></ul></li><li><p>UMD 方式共享代码(<code>runtime方式</code>)</p><ul><li>将模块用webpack umd 方式打包，输出到其它项目里</li><li>缺点<ul><li>包的体积无法达到本地编译时的优化效果</li><li>库直接容易产生冲突</li></ul></li></ul></li><li><p>MFE 微前端方式共享模块</p></li></ul><p>解决问题： 多个项目并存</p><ul><li>模块联邦 MF<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ModuleFederationPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>).<span class="property">container</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ModuleFederationPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;nav&#x27;</span>,                <span class="comment">// 微应用的名字，类似 single-spa 组织名</span></span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;remoteEntry.js&#x27;</span>, <span class="comment">// 对外提供打包后的文件名，导入时会使用</span></span><br><span class="line">  <span class="attr">remotes</span>: &#123;                  <span class="comment">// 引用其他应用暴露的组建</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">exposes</span>: &#123;                  <span class="comment">// 暴露给外界的组建 如：import(&#x27;nav/header&#x27;)</span></span><br><span class="line">    <span class="comment">// key：将来别人在用时，基于该路径来拼接url, value: 本地项目模块的实际路径</span></span><br><span class="line">    <span class="string">&#x27;./header&#x27;</span>: <span class="string">&#x27;./src/header.js&#x27;</span>  </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">shared</span>: &#123;                   <span class="comment">// 共享的第三方模块</span></span><br><span class="line">    <span class="string">&#x27;loadsh&#x27;</span>: <span class="string">&#x27;loadsh&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="comment">// new Mfp(&#123;</span></span><br><span class="line"><span class="comment">//   name:&#x27;roots&#x27;,</span></span><br><span class="line"><span class="comment">//   remotes:&#123;</span></span><br><span class="line"><span class="comment">//     one:&quot;nav@http://localhost:3001/remoteEntry.js&quot;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码</span></span><br><span class="line"><span class="comment">// const Header = React.lazy(()=&gt;import(&quot;one/header&quot;))</span></span><br><span class="line"><span class="comment">// &lt;React.Suspense fallback=&quot;Loading app&quot;&gt;</span></span><br><span class="line"><span class="comment">//   &lt;Header /&gt;</span></span><br><span class="line"><span class="comment">// &lt;/React.Suspense&gt;  </span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWA</title>
      <link href="/posts/67dc4d37.html"/>
      <url>/posts/67dc4d37.html</url>
      
        <content type="html"><![CDATA[<h3 id="pwd">pwd</h3><ul><li><p>非离线环境下运行应用程序</p><ul><li>PWA：通过 service worker 实现离线状态下 应用程序的访问</li><li>Wepack 中通过 workbox-webpack-plugin 实现 PWA</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">plugins:</span> [</span><br><span class="line">  ...,</span><br><span class="line">  new WorkboxPlugin.GenerateSW(<span class="punctuation">&#123;</span>            </span><br><span class="line"><span class="symbol">    clientsClaim:</span> true, <span class="comment">// 帮助快速启用 Serviceworkers</span></span><br><span class="line"><span class="symbol">    skipWaiting:</span> true   <span class="comment">// 不允许遗留 &#x27;旧&#x27; 的 Serviceworkers</span></span><br><span class="line">  <span class="punctuation">&#125;</span>)</span><br><span class="line">],</span><br><span class="line"><span class="symbol">devServer:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">  devMiddleware:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">    writeToDisk:</span> true <span class="comment">// 开发环境下，生成的dist写入磁盘</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>index.html 注册 service worker</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&#x27;./service-worker.js&#x27;</span>, &#123; <span class="attr">scope</span>: <span class="string">&#x27;./&#x27;</span> &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">registration</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker Registered&#x27;</span>, registration.<span class="property">scope</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker Failed to Register&#x27;</span>, error)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker are note supported.&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>性能优化</title>
      <link href="/posts/fc854d4d.html"/>
      <url>/posts/fc854d4d.html</url>
      
        <content type="html"><![CDATA[<h3 id="性能优化">性能优化</h3><h4 id="提升项目性能">提升项目性能</h4><ul><li>加快网站首屏渲染</li></ul><h4 id="构建编译性能">构建编译性能</h4><blockquote><p>提高打包速度、降低打包时间，受益者为开发者</p></blockquote><p><strong>通用环境(优化措施适用开发和生产)</strong></p><ol><li><p>更新 webpack@latest、Node@latest、Yarn@latest<br>这些环境或工具在版本升级时必定会提升性能</p></li><li><p>引导 <code>bootstrap</code><br>每个额外的loader/plugin都有其启动时间、尽量少的使用工具</p></li><li><p>解析 <code>resolve</code></p><ul><li>减少 resolve.modules,resolve.extensions,resolve.mainFiles,resolve.descriptionFiles中条目数，因为他们会增加文件系统调用的次数</li><li>如果你不使用 symlinks(例如 yarn link或npm link),可以设置resolve.symlinks = false</li><li>如果你使用自定义 resolve.plugin 规则，并且没有指定context上下文，可以设置resolve.cacheWithContext: false</li></ul></li><li><p>小即是快(small = faster)<br>减少编译结果的整体数量，以提高构建性能。尽量保持chunk体积小</p></li></ol><ul><li>使用数量更少/体积更小的library</li><li>在多页面应用程序中使用 SplitChunksPlugin，并开启async模式</li><li>移除未使用代码</li><li>只编译你当前正在开发的那些代码(<code>include/exclude</code>)</li></ul><ol start="5"><li>使用持久化缓存<br>在webpack配置中使用<code>cache</code>选项，使用package.json 中的<code>postinstall</code>清除缓存目录</li></ol><p>将cache类型设置为内存或者文件系统。memory选项很简单，它告诉webpack在内存中存储缓存，不允许额外的配置：</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">cache</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;momory&#x27;</span>      </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li><p>自定义plugin/loader<br>对他们进行概要分析，以免在此引入性能问题</p></li><li><p>progress plugin<br>将ProgressPlugin从webpack中删除，可以缩短构建时间。请注意，PorgressPlugin 可能不会为快速构建提供太多价值，因此，请权衡利弊再使用</p></li><li><p>dll<br>使用 <code>DllPlugin</code> 为 更改不频繁的代码生成单独的编译结果。这可以提高应用程序的编译速度，尽管它增加了构建过程的复杂度<br>注意：vue\react 官方已弃用，原因是webpack4开始打包性能已足够好，不需要做额外dll了等等。。</p></li></ol><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># webpack.dll.config.js</span><br><span class="line">const <span class="type">path</span> = require(<span class="string">&#x27;path)</span></span><br><span class="line"><span class="string">const webpack = require(&#x27;</span>webpack<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">module.exports = &#123;</span></span><br><span class="line"><span class="string">  mode: &#x27;</span>production<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">  entry: [&#x27;</span>jquery<span class="string">&#x27;],</span></span><br><span class="line"><span class="string">  output: &#123;</span></span><br><span class="line"><span class="string">    filename: &#x27;</span>[<span class="type">name</span>].js<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    path: path.resolve(__dirname, &#x27;</span>dll<span class="string">&#x27;),</span></span><br><span class="line"><span class="string">    library: &#x27;</span>[<span class="type">name</span>]_[hash]<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  plugins: [</span></span><br><span class="line"><span class="string">    new webpack.DllPlugin(&#123;</span></span><br><span class="line"><span class="string">      name: &#x27;</span>[<span class="type">name</span>]_[hash]<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      path: path.resolve(__dirname, &#x27;</span>dll/manifest.json<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># package.json</span></span><br><span class="line"><span class="string">scripts: &#123;</span></span><br><span class="line"><span class="string">  &#x27;</span>dll<span class="string">&#x27;: &#x27;</span>webpack <span class="comment">--config ./webpack.dll.config.js&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 使用 webpack.config.js 中添加如下插件</span><br><span class="line"><span class="built_in">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">  manifest: <span class="type">path</span>.resolve(__dirname, <span class="string">&#x27;./dll/manifest.json&#x27;</span>)</span><br><span class="line">&#125;),</span><br><span class="line"></span><br><span class="line"># <span class="keyword">add</span>-asset-html-webpack-plugin</span><br><span class="line"><span class="built_in">new</span> AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">  filepath: <span class="type">path</span>.resolve(__dirname, <span class="string">&#x27;./dll/jquery.js&#x27;</span>),</span><br><span class="line">  publicPath: <span class="string">&#x27;./&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="9"><li>worker pool<br>使用<code>thread-loader</code>可以将非常消耗资源的loader分流给一个<code>worker pool</code></li></ol><blockquote><p>不要使用太多<code>worker</code>，因为nodejs的runtime和loader都有启动开销。最小化worker和main process(主进程)之间的模块传输。进程间通讯(IPC, inter process communication)是非常消耗资源的。</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">npm</span> <span class="string">i</span> <span class="string">thread-loader</span> <span class="string">-D</span></span><br><span class="line"></span><br><span class="line"><span class="attr">module:</span> &#123;</span><br><span class="line">  <span class="attr">rules:</span> [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test:</span> <span class="string">/\.js$/</span>,</span><br><span class="line">      <span class="attr">exclude:</span> <span class="string">/node_modules/</span>,</span><br><span class="line">      <span class="attr">use:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader:</span> <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options:</span> &#123;</span><br><span class="line">            <span class="attr">presets:</span> [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader:</span> <span class="string">&#x27;thread-loader&#x27;</span>,  <span class="comment"># 把一些耗时的 loader 放在 worker pool 中运行，否则不建议使用</span></span><br><span class="line">          <span class="attr">options:</span> &#123;</span><br><span class="line">            <span class="attr">workers:</span> <span class="number">2</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="10"><li>Progress plugin<br>将<code>Progress Plugin</code>从webpack中移除，可以缩短构建时间。请注意 <code>ProgressPlugin</code> 可能不会为快速构建提供太多价值。因此，请权衡利弊再使用。</li></ol><h3 id="开发环境">开发环境</h3><ol><li>增量编译<br>使用webpack的watch mode(监听模式)，而不使用其他工具来watch文件和调用webpack。内置的watch mode 会记录时间戳并将此信息传递给compilation以使缓存失效。</li></ol><p>在某些配置环境中，watch mode会会退到 poll mode(轮询模式)。监听许多文件会导致CPU大量负载。在这些情况下，可以使用watchOptions.poll 来增加轮询的间隔时间。</p><ol start="2"><li><p>在内存中编译<br>下面几个工具通过在内存编译和serve资源来提高性能</p><ul><li>webpack-dev-server</li><li>webpack-hot-middleware</li><li>webpack-dev-middleware</li></ul></li><li><p>stats.toJson 加速<br>webpack4 默认使用 stats.toJson() 输出大量数据，除非在增量步骤中做必要的统计，否则请避免获取 stats对象的部分内容。</p></li></ol><p>webpack-dev-server 在v3.1.3以后的版本，包含一个重要的内存修复，即最小化每个增量构建步骤中从stats对象获取的数据量</p><ol start="4"><li>devtool<br>不同devtool的设定，会导致性能差异。</li></ol><ul><li>eval 具有最好性能，但不能帮助你转译代码</li><li>如果你能接受稍差一次的 source map，可以使用cheap-source-map变体来提高性能</li><li>使用eval-source-map 变体配置进行增量编译</li></ul><p>在大多数情况下，最佳选择是 eval-cheap-module-source-map</p><ol start="5"><li>避免在生产环境才用到的工具<br>某些utility、plugin和loader都只是用于生产环境。例如，在开发环境下使用 TerserPlugin来minify(压缩)和mangle(混淆破环)代码是没必要的。通常在开发环境下，应排除以下这些工具：</li></ol><ul><li>TerserPlugin</li><li>[fullhash]/[chunkhash]/[contenthash]</li><li>AggressiveSplittingPlugin</li><li>AggressiveMergingPlugin</li><li>ModuleConcatenationPlugin</li></ul><ol start="6"><li>最小化 entry chunk<br>webpack 只会在文件系统中输出已经更新的chunk。某些配置选项(HMR、output.chunkFilename的<code>[name]/[chunkhash]/[contenthash], [fulllhash]</code>)来说，除了对已经更新的chunk无效之外，对于entry chunk 也会无效。</li></ol><p>确保在生成entry chunk时，尽量减少其体积以提高性能。下面配置为运行时代码创建了一个额外chunk，所以它的生成代价比较低：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">runtimeChunk</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li>避免额外的优化步骤<br>webapck通过执行额外的算法任务，来优化输出结果的体积和加载性能。这些优化适用于小型代码库，但是在大型代码库中却非常耗费性能：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">removeAvailableModules</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">removeEmptyChunks</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">splitChunks</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="8"><li>输出结果不携带路径信息<br>webpack会在输出的bundle中生成路径信息。然而，在打包数千个模块的项目中，这会导致造成垃圾回收性能压力。在options.output.pathinfo 设置中关闭：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">pathinfo</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="9"><li><p>NodeJS 版本<br>NodeJS V8.9.10 - V9.11.1 中ES2015 Map和Set实现，存在性能回退，Webpack大量使用这些数据结构，因此，这次回退也会影响编译时间。</p></li><li><p>TypeScript Loader<br>你可以为loader 传入 transpileOnly选项，以缩短使用ts-loader时的构建时间。使用此选项，会关闭类型检查。如果要再次开启类型检查，请使用 ForkTsCheckerWebpackPlugin。使用此插件会将检查过程移至单独的进程，可以加速TypeScript的类型检查和ESLint插入速度。</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">transpileOnly</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生产环境">生产环境</h3><ol><li>不使用source map<br>source map 相当耗费资源</li></ol>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shimming 预置依赖</title>
      <link href="/posts/3bf955af.html"/>
      <url>/posts/3bf955af.html</url>
      
        <content type="html"><![CDATA[<h3 id="Shimming-预置依赖">Shimming 预置依赖</h3><blockquote><p>第三方库可能使用全局依赖，比如：jquery中的 <code>$</code>,这些库会创建一些要导出的全局变量，易造成冲突，这就是shimming发挥作用的地方<br>通过polyfill扩展低版本浏览器能力，支持更多用户</p></blockquote><p><strong>Shimming 预置全局变量</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于 broken modules(不符合规范的package)</span></span><br><span class="line"><span class="comment">// 通过 webpakc.ProvidePlugin 引入loadsh 库，并提供给 需要的模块</span></span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123;</span><br><span class="line">  <span class="comment">// _: &#x27;loadsh&#x27;,</span></span><br><span class="line">  <span class="comment">// 与 tree shaking 结合，将loadsh 中未引用的模块移除掉</span></span><br><span class="line">  <span class="attr">join</span>: [<span class="string">&#x27;loadsh&#x27;</span>, join] </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>细粒度 Shimming</strong></p><blockquote><p>使用 imports-loader 覆盖 this 指向 window(场景：一些遗留模块依赖的this指向window)</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块运行在commonJS上下文中</span></span><br><span class="line"><span class="comment">// src/test.js</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">alert</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.conf.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;./src/test.js&#x27;</span>),</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&#x27;imports-loader?wrapper=window&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>全局 Exports</strong></p><blockquote><p>某个外部library创建出一个全局变量，它希望consumer(消费者)使用这个变量</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/globals.js</span></span><br><span class="line"><span class="keyword">const</span> file = <span class="string">&#x27;expample.txt&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> helpers = &#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test something&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">parse</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;parse something&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.conf.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;./src/globals.js&#x27;</span>),</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&#x27;exports-loader?type=commonjs&amp;exports=file,multiple|helpers.parse|parse&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>加载 polyfill</strong></p><blockquote><p>帮助浏览器支持最新语法, 运行于所有代码之前</p></blockquote><ul><li><code>npm i @babel/polyfill -D</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/test.js 手动载入垫片</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@babel/polyfill&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Array</span>.<span class="title function_">form</span>([<span class="number">1</span>,<span class="number">2</span>], <span class="function"><span class="params">x</span> =&gt;</span> x + x ))</span><br></pre></td></tr></table></figure><p><strong>进一步优化 polyfill</strong></p><ul><li><code>import '@babel/polyfill'</code> 会全局导入polyfill包，导致应用包体积变大</li></ul><p><code>babel-preset-env</code> 会通过package.json <code>browserlist</code>来转译浏览器不支持的那些特性,这个preset 使用<code>useBuiltIns</code>选项，默认值为false，这种方式可以将全局<code>babel-polyfill</code>导入,改为更精细化导入方式:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/modules/es7.string.pad-start&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/modules/es7.string.pad-end&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/modules/web.timers&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/modules/web.immediate&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/modules/web.dom.eterable&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>安装 <code>@babel/preset-env</code> 及相关包</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-loader @babel/core @babel/preset-env -D</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="string">&#x27;/\.js$/&#x27;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&#x27;@babel/preset-env&#x27;</span>, <span class="comment">// 包含了大多数语法转换插件</span></span><br><span class="line">                <span class="comment">// preset-env 插件配置参数</span></span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="comment">// browserlist 中定义的内容</span></span><br><span class="line">                  <span class="comment">// 浏览器最后的一个版本 并且 全球使用率 &gt; 1% 时对代码进行语法转换</span></span><br><span class="line">                  <span class="attr">targets</span>: [                  </span><br><span class="line">                    <span class="string">&#x27;last 1 version&#x27;</span>, </span><br><span class="line">                    <span class="string">&#x27;&gt; 1%&#x27;</span></span><br><span class="line">                  ],</span><br><span class="line">                  <span class="comment">// 转换时自动导入</span></span><br><span class="line">                  <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>,</span><br><span class="line">                  <span class="attr">corejs</span>: <span class="number">3</span></span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack Plugin</title>
      <link href="/posts/fc1d05ec.html"/>
      <url>/posts/fc1d05ec.html</url>
      
        <content type="html"><![CDATA[<h3 id="目的">目的</h3><ul><li>打包优化、压缩、定义环境中的变量等各种各样的任务</li><li>解决 loader 无法实现的其他事</li></ul><h3 id="剖析">剖析</h3><ul><li>一个具有 <code>apply</code> 属性的 JavaScript 对象。apply 属性会被 webpack compiler 调用，并且 compiler 对象可在整个编译生命周期访问。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConsoleLogOnBuildWebpackPlugin.js</span></span><br><span class="line"><span class="keyword">const</span> pluginName = <span class="string">&#x27;ConsoleLogOnBuildWebpackPlugin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsoleLogOnBuildWebpackPlugin</span> &#123;</span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">run</span>.<span class="title function_">tap</span>(pluginName, <span class="function"><span class="params">compilation</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;webpack 构建过程开始！&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="常见插件">常见插件</h3><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ignore-plugin：忽略部分文件。</span><br><span class="line">html-webpack-plugin：简化 html 文件创建。</span><br><span class="line">web-webpack-plugin：可以方便地为单页应用输出 html，比 html-webpack-plugin 好用。</span><br><span class="line">terser-webpack-plugin：支持压缩ES6。</span><br><span class="line">optimize-css-assets-webpack-plugin：压缩css代码。</span><br><span class="line">mini-css-extract-plugin：分离样式文件，css 提取为单独文件，支持按需加载。</span><br><span class="line">werviceworker-webpack-plugin：为网页应用追加离线缓存功能。</span><br><span class="line">clean-webpack-plugin：目录清理。</span><br><span class="line">ModuleconcatenationPlugin：开启 Scope Hoisting。</span><br><span class="line">webpack-bundle-analyzer：可视化 webpack 输出文件的体积（业务组件、依赖第三方模块）。</span><br><span class="line">speed-measure-webpack-plugin：可以看到每个 loader 和 plugin 执行耗时（这个打包耗时、plugin 和 loader 耗时）。</span><br><span class="line">HotModuleReplacementPlugin：模块热替换</span><br></pre></td></tr></table></figure><h4 id="利用-Plugin解决SPA页面缓存问题">利用 Plugin解决SPA页面缓存问题</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span>: 构建阶段</span></span><br><span class="line"><span class="comment">// 获取并注入版本号【这里还可以写 把版本号 和 项目 名 发送到服务器，作版本记录】</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">WebpackVersionPlugin</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options = &#123; &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;</span><br><span class="line">      <span class="attr">versionName</span>: <span class="string">&#x27;$AppVersion&#x27;</span></span><br><span class="line">    &#125;, options)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// compiler: 完整的 webpack 环境配置</span></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; versionName &#125; = <span class="variable language_">this</span>.<span class="property">options</span>;</span><br><span class="line">    <span class="comment">// compilation 对象代表了一次资源版本构建。当运行 webpack 开发环境中间件时，每当检测到一个文件变化，就会创建一个新的 compilation，从而生成一组新的编译资源。</span></span><br><span class="line">    <span class="comment">// 一个 compilation 对象表现了当前的模块资源、编译生成资源、变化的文件、以及被跟踪依赖的状态信息。compilation 对象也提供了很多关键时机的回调，以供插件做自定义处理时选择使用</span></span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;WebpackVersionPlugin&#x27;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; hash &#125; = compilation</span><br><span class="line">      <span class="comment">// 需要在 index.html 注入变量 【在htmlWebpackPlugin 钩子里处理 详细看官方文档】</span></span><br><span class="line">      <span class="title class_">HtmlWebpackPlugin</span>.<span class="title function_">getHooks</span>(compilation).<span class="property">beforeEmit</span>.<span class="title function_">tapAsync</span>(</span><br><span class="line">        <span class="string">&#x27;MyPlugin&#x27;</span>, </span><br><span class="line">        <span class="function">(<span class="params">data, cb</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> htmlScriptStr = <span class="string">`&lt;script&gt;window.<span class="subst">$&#123;versionName&#125;</span>=&quot;<span class="subst">$&#123;hash&#125;</span>&quot;&lt;/script&gt;`</span>;</span><br><span class="line">          <span class="comment">// 插入到第一个 script标签前面</span></span><br><span class="line">          data.<span class="property">html</span> = data.<span class="property">html</span>.<span class="title function_">replace</span>(<span class="regexp">/(&lt;script)/</span>,  <span class="string">`<span class="subst">$&#123;htmlScriptStr&#125;</span>$1`</span>)</span><br><span class="line">          <span class="title function_">cb</span>(<span class="literal">null</span>, data)</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">      <span class="title function_">callback</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span>: 构建阶段通过NodeJS 写json，在客户端即可进行轮询</span></span><br><span class="line"><span class="comment">// script/tools.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; writeFile &#125; = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ROOT</span> = (<span class="params">...args: any[]</span>) =&gt; resolve.<span class="title function_">apply</span>(<span class="literal">null</span>, [__dirname, <span class="string">&#x27;../&#x27;</span>].<span class="title function_">concat</span>(args ? args : []))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> version = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line"><span class="keyword">const</span> json_path = <span class="title function_">ROOT</span>(<span class="string">&#x27;runtime/version.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> info = &#123; <span class="attr">name</span>: <span class="string">&#x27;LowCode Runtime&#x27;</span>, version &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">writeFile</span>(json_path, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(info, <span class="literal">null</span>, <span class="number">2</span>), <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;An error has occurred &#x27;</span>, error);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data written successfully to disk&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span>: 工具类</span></span><br><span class="line">interface <span class="title class_">Options</span> &#123;</span><br><span class="line">  timer?: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Updater</span> &#123;</span><br><span class="line">  <span class="attr">oldAppInfo</span>: <span class="title class_">Record</span>&lt;string, any&gt; <span class="comment">// 存储第一次版本信息</span></span><br><span class="line">  <span class="attr">newAppInfo</span>: <span class="title class_">Record</span>&lt;string, any&gt;  <span class="comment">// 获取新版本信息</span></span><br><span class="line">  <span class="attr">dispatch</span>: <span class="title class_">Record</span>&lt;string, <span class="title class_">Function</span>[]&gt; <span class="comment">// 发布订阅通知用户更新了</span></span><br><span class="line">  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options: Options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldAppInfo</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newAppInfo</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dispatch</span> = &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>() <span class="comment">// 初始化</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">timing</span>(options?.<span class="property">timer</span>)<span class="comment">// 轮询</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">json</span>: <span class="title class_">Record</span>&lt;string, any&gt; = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getAppInfo</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldAppInfo</span> = &#123; ...json &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getAppInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/runtime/version.json&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布订阅通知</span></span><br><span class="line">  <span class="title function_">on</span>(<span class="params">key: <span class="string">&#x27;no-update&#x27;</span> | <span class="string">&#x27;update&#x27;</span>, fn: <span class="built_in">Function</span></span>) &#123;</span><br><span class="line">    (<span class="variable language_">this</span>.<span class="property">dispatch</span>[key] || (<span class="variable language_">this</span>.<span class="property">dispatch</span>[key] = [])).<span class="title function_">push</span>(fn)  </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">compare</span>(<span class="params">oldAppInfo: Record&lt;string, any&gt;, newAppInfo: Record&lt;string, any&gt;</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果新旧 version 一样无更新</span></span><br><span class="line">    <span class="keyword">if</span> (oldAppInfo.<span class="property">version</span> === newAppInfo.<span class="property">version</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dispatch</span>[<span class="string">&#x27;no-update&#x27;</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">    </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 否则通知更新</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dispatch</span>[<span class="string">&#x27;update&#x27;</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">timing</span>(<span class="params">time = <span class="number">10000</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 轮询</span></span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">newAppInfo</span> = <span class="variable language_">this</span>.<span class="title function_">getAppInfo</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">compare</span>(<span class="variable language_">this</span>.<span class="property">oldAppInfo</span>, <span class="variable language_">this</span>.<span class="property">newAppInfo</span>)</span><br><span class="line">    &#125;, time)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span>: 页面集成</span></span><br><span class="line"><span class="comment">// 实例化该类</span></span><br><span class="line"><span class="keyword">const</span> up = <span class="keyword">new</span> <span class="title class_">Updater</span>(&#123;</span><br><span class="line">  <span class="attr">timer</span>: <span class="number">6000</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 未更新通知</span></span><br><span class="line">up.<span class="title function_">on</span>(<span class="string">&#x27;no-update&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;未更新&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 更新通知</span></span><br><span class="line">up.<span class="title function_">on</span>(<span class="string">&#x27;update&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;更新了&#x27;</span>)</span><br><span class="line">  location.<span class="title function_">reload</span>() <span class="comment">// 刷新页面</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://juejin.cn/post/6844904162405138445">参考链接-掘金</a></p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Tree Sharking</title>
      <link href="/posts/3a49d86b.html"/>
      <url>/posts/3a49d86b.html</url>
      
        <content type="html"><![CDATA[<h3 id="Tree-Sharking">Tree Sharking</h3><blockquote><p>移除js中未使用的代码，作用同 babel-plugin-import</p></blockquote><p><strong>副作用</strong><br>修改window、原生对象等等称为副作用</p><p><strong>sideEffects</strong></p><blockquote><p>在 package.js 中声明，按如下设置指导 webpack进行 tree sharking（webpack 5 默认不移除 css 文件）</p></blockquote><ul><li>true: 所有包都是有副作用，不能随便删除</li><li>false：引入的包不论其是否有副作用，只要没被使用，就会被完整的去除掉（有风险：会移除css样式表）</li><li>[*.css, *.global.js]: 告诉webpack哪些文件有副作用，不进行tree sharking</li></ul><p><strong>usedExport</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">performance</span>: &#123;</span><br><span class="line">  <span class="attr">usedExports</span>: <span class="literal">true</span>  <span class="comment">// 去除未引用的代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打包优化：将函数执行结果 打包至 bundle中(逻辑已被执行)</p><p>不能百分百进行treesharking<br>比如：全局样式表、设置了全局配置的js文件</p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webpack Plugin 之移除注释</title>
      <link href="/posts/5bbee187.html"/>
      <url>/posts/5bbee187.html</url>
      
        <content type="html"><![CDATA[<h2 id="为什么编写插件">为什么编写插件</h2><p>插件是 webpack 生态的重要组成部分，可以为社区开发者提供 webpack 编译各生命周期的不同阶段，以钩子 hook 的形式触发事件，以便访问 compiler 对象，进行订制开发。自定义插件比自定义 loader 更加高阶，主要为解决 loader 中解决不了的一些事情。</p><h2 id="自定义插件的场景是什么">自定义插件的场景是什么</h2><p>现有开源的 webpack 插件很多，基本我们可以直接使用，不需要自己开发插件，但像一些特殊场景下，比如公司需要配合 gitlab ci/cd、jenkins 将自己的研发链路执行自动化打包部署，而且不仅限于 web，像小程序、跨平台 RN 等也都可以应用，这个时候就体现出开发 webpack 插件的必要性了，下面我们就来了解一下如何写一个清除文件注释的插件。</p><h2 id="插件基本结构">插件基本结构</h2><p>开发插件之前需要了解 webpack 主流程和 tapable 用法，还未了解可移步</p><p><a href="https://zhuanlan.zhihu.com/p/135997214">webpack 源码解读 - 理解 Tapable 原理</a></p><p><a href="https://zhuanlan.zhihu.com/p/135985621">webpack 源码解读 - 主编译流程</a></p><p>一个 webpack plugin 由一下几个步骤组成：</p><ol><li>一个 JavaScript 类函数。</li><li>在函数原型 (prototype)中定义一个注入<code>compiler</code>对象的<code>apply</code>方法。</li><li><code>apply</code>函数中通过 compiler 插入指定的事件钩子,在钩子回调中拿到 compilation 对象</li><li>使用 compilation 操纵修改 webapack 内部实例数据。</li><li>异步插件，数据处理完后使用 callback 回调</li></ol><p>开发 webpack 插件还需要了解其中两个核心的对象引用 Compiler 和 Compilation，这里需要理解清楚他们的含义。</p><ul><li><code>compiler</code> 对象代表了完整的 webpack 环境配置。这个对象在启动 webpack 时被一次性建立，并配置好所有可操作的设置，包括 options，loader 和 plugin。当在 webpack 环境中应用一个插件时，插件将收到此 compiler 对象的引用。可以使用它来访问 webpack 的主环境。</li><li><code>compilation</code> 对象代表了一次资源版本构建。当运行 webpack 开发环境中间件时，每当检测到一个文件变化，就会创建一个新的 compilation，从而生成一组新的编译资源。一个 compilation 对象表现了当前的模块资源、编译生成资源、变化的文件、以及被跟踪依赖的状态信息。compilation 对象也提供了很多关键时机的回调，以供插件做自定义处理时选择使用。</li></ul><h2 id="怎么写一个插件">怎么写一个插件</h2><p>首先清楚我们写插件的目标是将 webpack 打包生成的构建产物中的注释移除掉，清晰之后开始编码。</p><p>准备：具体的目录结构如下</p><pre><code>debug-|      |--start.jsdistplugin-|       |--index.jssrc-|    |--util.js    |--index.jspackage.jsonwebpack.config.js</code></pre><p>***** debug/start.js <strong>*</strong></p><pre><code>const webpack = require('webpack')const config = require('./webpack.config')const compiler = webpack(config)compiler.run((err, stats)=&gt;&#123;    if(err)&#123;        console.error(err)    &#125;else&#123;        console.log(stats)    &#125;&#125;)</code></pre><p>***** debug/webpack.config.js <strong>*</strong></p><pre><code>const path = require('path');const commentPlugin = require('./plugin');module.exports = &#123;    mode: 'development',    entry: './src/index.js',    devtool: 'source-map',    output: &#123;        path: path.resolve(__dirname, './dist'),    &#125;,    module: &#123;        rules: [            &#123;                test: /\.js$/,                use: ['babel-loader'],                exclude: /node_modules/,            &#125;,        ]    &#125;,    plugins: [        new commentPlugin()    ]&#125;;</code></pre><p>***** plugin/index.js <strong>*</strong></p><pre><code>// 插件输出类class RemoveCommentPlugin &#123;    constructor(opts) &#123;        this.opts = opts;        this.externalModules = &#123;&#125;;    &#125;    apply(compiler) &#123;        // 去除注释正则        const reg = /(&quot;([^\\\&quot;]*(\\.)?)*&quot;)|('([^\\\']*(\\.)?)*')|(\/&#123;2,&#125;.*?(\r|\n))|(\/\*(\n|.)*?\*\/)|(\/\*\*\*\*\*\*\/)/g;        // 注册自定义插件钩子到生成资源到 output 目录之前，拿到compilation对象（编译好的stream）        compiler.hooks.emit.tap('RemoveComment', compilation =&gt; &#123;            // 遍历构建产物            Object.keys(compilation.assets).forEach(item =&gt; &#123;                // .source()是获取构建产物的文本                // .assets中包含构建产物的文件名                let content = compilation.assets[item].source();                content = content.replace(reg, function (word) &#123; // 去除注释后的文本                    return /^\/&#123;2,&#125;/.test(word) || /^\/\*!/.test(word) || /^\/\*&#123;3,&#125;\//.test(word) ? &quot;&quot; : word;                &#125;);                // console.info(content);                // 更新构建产物对象                compilation.assets[item] = &#123;                    source: () =&gt; content,                    size: () =&gt; content.length                &#125;            &#125;);        &#125;);    &#125;&#125;;module.exports = RemoveCommentPlugin;</code></pre><p>下面我们来分析一下刚才 plugin/index.js 中的代码：</p><pre><code>compiler.hooks.emit.tap('RemoveComment', compilation =&gt; &#123;  // ...&#125;)</code></pre><p>这一步主要是使用核心对象 compiler 的 emit 钩子，通过.tap 方法注册到 webpack 中，在输出构建产物到 dist 目录之前执行。 在这里列出 compiler 对象的生命周期钩子<br>-&gt; beforeRun 清除缓存<br>-&gt; run 注册缓存数据钩子<br>-&gt; beforeCompile<br>-&gt; compile 开始编译<br>-&gt; make 从入口分析依赖以及间接依赖模块，创建模块对象<br>-&gt; buildModule 模块构建<br>-&gt; normalModuleFactory 构建<br>-&gt; seal 构建结果封装， 不可再更改<br>-&gt; afterCompile 完成构建，缓存数据<br>-&gt; emit 输出到 dist 目录</p><pre><code>Object.keys(compilation.assets).forEach(item =&gt; &#123;  // ...&#125;)</code></pre><p>这一步的目的是访问 compilation 对象的 assets 属性，拿到构建资源的对象，最后，通过正则转好的内容再赋给 compilation.assets[‘main.js’]，更新构建产物。</p>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Webpack Loader</title>
      <link href="/posts/aa20d00e.html"/>
      <url>/posts/aa20d00e.html</url>
      
        <content type="html"><![CDATA[<h3 id="loader">loader</h3><ul><li>用于对模块的源代码进行转换, 使你在 import 或&quot;加载&quot;模块时预处理文件</li></ul><h3 id="特性">特性</h3><ul><li>loader 支持链式传递。能够对资源使用流水线(pipeline)。一组链式的 loader 将按照相反的顺序执行。loader 链中的第一个 loader 返回值给下一个 loader。在最后一个 loader，返回 webpack 所预期的 JavaScript。</li><li>loader 可以是同步的，也可以是异步的。</li><li>loader 运行在 Node.js 中，并且能够执行任何可能的操作。</li><li>loader 接收查询参数。用于对 loader 传递配置。</li><li>loader 也能够使用 options 对象进行配置。</li><li>除了使用 package.json 常见的 main 属性，还可以将普通的 npm 模块导出为 loader，做法是在 package.json 里定义一个 loader 字段。</li><li>插件(plugin)可以为 loader 带来更多特性。</li><li>loader 能够产生额外的任意文件。</li></ul><h3 id="解析-loader">解析 loader</h3><ul><li>遵循标准的 <code>模块解析</code></li><li>命名 xxx-loader</li></ul><h3 id="常见loaders">常见loaders</h3><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cache-loader：可以在一些性能开销较大的 Loader 之前添加，目的是将结果缓存到磁盘里。</span><br><span class="line">file-loader：把文件输出到一个文件夹中，在代码中通过相对 URL 去引用输出的文件（处理图片、字体、图标）。</span><br><span class="line">url-loader：与file-loader 类似，区别是用户可以设置一个阈值，大于阈值会交给 file-loader，小于阈值时返回文件 base64 形式编码（处理图片）。</span><br><span class="line">image-loader：加载并且压缩图片文件。</span><br><span class="line">babel-loader：把 ES6 转换成 ES5。</span><br><span class="line">ts-loader：将 typescript 转换成 JavaScript。</span><br><span class="line">svg-inline-loader：将压缩后的SVG内容注入代码中。</span><br><span class="line">raw-loader：加载文件原始内容（utf-8）。</span><br><span class="line">sass-loader：将 scss/sass 代码转换成 css。</span><br><span class="line">css-loader：加载 css，支持模块化、压缩、文件导入等特性。</span><br><span class="line">less-loader：将 less 代码转换成 css。</span><br><span class="line">style-loader：生成 style 标签，将 js 中的样式资源插入，并添加到 header 中生效。</span><br><span class="line">postcss-loader：扩展 css 语法，使用下一代 css，可以配合 autoprefixer 插件自动补齐 css3 前缀。</span><br><span class="line">eslint-loader：通过 eslint 检查 JavaScript 代码。</span><br><span class="line">tslint-loader：通过tslint 检查 typesc 代码。</span><br><span class="line">vue-loader：加载 vue.js 单文件组件。</span><br><span class="line">awesome-typescript-loader：将 typescript 转换成 JavaScript，性能优于 ts-loader</span><br></pre></td></tr></table></figure><h3 id="自定义sass-loader">自定义sass-loader</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">&#x27;node-sass&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; getOptions &#125; = <span class="built_in">require</span>(<span class="string">&#x27;loader-utils&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> options = <span class="title function_">getOptions</span>(<span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> sassOptions = options.<span class="property">sassOptions</span> || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = sass.<span class="title function_">renderSync</span>(&#123;</span><br><span class="line">      <span class="attr">data</span>: source,</span><br><span class="line">      ...sassOptions</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result.<span class="property">css</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">expots</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 指定loader引用范围</span></span><br><span class="line">  <span class="attr">resolveLoader</span>: &#123;</span><br><span class="line">    <span class="attr">modules</span>: [</span><br><span class="line">      path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./rules&#x27;</span>),</span><br><span class="line">      <span class="string">&#x27;node_modules&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.sass)$/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">include</span>: [path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src&#x27;</span>)],</span><br><span class="line">        <span class="attr">exclude</span>: [<span class="string">&#x27;node_modules&#x27;</span>],</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">stats</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>云平台架构</title>
      <link href="/posts/17cbdcf8.html"/>
      <url>/posts/17cbdcf8.html</url>
      
        <content type="html"><![CDATA[<h1>云平台架构</h1>]]></content>
      
      
      <categories>
          
          <category> 云 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>云-基本概念</title>
      <link href="/posts/89d5d3d7.html"/>
      <url>/posts/89d5d3d7.html</url>
      
        <content type="html"><![CDATA[<h1>云-基本概念</h1><h2 id="一、云的定义">一、云的定义</h2><h2 id="二、为企业带来的价值">二、为企业带来的价值</h2><h2 id="三、云计算通用点">三、云计算通用点</h2><h2 id="四、云的模式">四、云的模式</h2>]]></content>
      
      
      <categories>
          
          <category> 云 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>云管理平台-认知</title>
      <link href="/posts/1494c530.html"/>
      <url>/posts/1494c530.html</url>
      
        <content type="html"><![CDATA[<h1>云管理平台-认知</h1>]]></content>
      
      
      <categories>
          
          <category> 云 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Electron</title>
      <link href="/posts/35a516c7.html"/>
      <url>/posts/35a516c7.html</url>
      
        <content type="html"><![CDATA[<h2 id="Electron">Electron</h2><blockquote><p>由 Github 开源、可商用</p></blockquote><h3 id="构成">构成</h3><ul><li>Electron = chromium + NodeJs + Native API</li><li>产品列举</li></ul><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">- </span>VS Code</span><br><span class="line"><span class="bullet">- </span>Atom</span><br><span class="line"><span class="bullet">- </span>slack</span><br><span class="line"><span class="bullet">- </span>wordpress</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="工程结构">工程结构</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;项目A</span><br><span class="line">   &gt;<span class="attr">--dist</span></span><br><span class="line">     &gt;<span class="attr">--static</span></span><br><span class="line">     &gt;<span class="attr">--favicon</span><span class="selector-class">.icon</span></span><br><span class="line">     &gt;<span class="attr">--index</span><span class="selector-class">.html</span></span><br><span class="line">   &gt;<span class="attr">--main</span><span class="selector-class">.js</span></span><br><span class="line">   &gt;<span class="attr">--preload</span><span class="selector-class">.js</span></span><br><span class="line">   &gt;<span class="attr">--package</span>.json</span><br></pre></td></tr></table></figure><h3 id="额外功能扩展">额外功能扩展</h3><p><strong>1. 触发下载</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">win.<span class="property">webContents</span>.<span class="title function_">downloadURL</span>(url)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 will-download</span></span><br><span class="line">session.<span class="property">defaultSession</span>.<span class="title function_">on</span>(<span class="string">&#x27;will-download&#x27;</span>, <span class="function">(<span class="params">event, item, webContents</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(event, item, webContents)</span><br><span class="line">  item.<span class="title function_">setSavePath</span>(<span class="string">&#x27;D:\\&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>参考链接</strong><br><a href="https://juejin.cn/post/7077494070104293384">https://juejin.cn/post/7077494070104293384</a><br><a href="https://juejin.cn/post/7078543710434099237">https://juejin.cn/post/7078543710434099237</a></p><p><a href="https://gitee.com/jahaw/electron-examples">案例源码</a></p>]]></content>
      
      
      <categories>
          
          <category> 桌面应用 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>优化相关</h1><p>优化相关主要分为两类：优化开发体验和项目性能优化</p><h2 id="优化开发体验">优化开发体验</h2><ul><li>加快打包速度<ul><li>开发环境可以尝试 esmodule 的打包形式，可以使用 vite 或者 esbuild-loader</li><li>webpack 的话可以使用 cache-loader、happyPack、noParse 等</li></ul></li><li>完善 devops 流程</li><li>使用低代码平台构建管理平台页面</li><li>利用微前端的技术无关性，新项目使用新技术来构建</li></ul><h2 id="项目性能优化">项目性能优化</h2><p>工欲善其事，必先利其器，在讨论如何性能优化之前，先看一下如何收集关于性能的[数据]</p><ul><li>打包产物的话，可以根据 webpack-bundle-analyze 之类的打包分析工具进行分析</li><li>网站的性能概要可以通过 lighthouse 查看</li><li>运行时一些关键时间的监控例如 DNS 查询耗时、白屏时间等可以使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Performance">Performance Api</a>来计算</li><li>比较具体的性能卡点通过 Chrome Performance 火焰图分析</li></ul><p>开始性能优化的前提是要熟知两道经典题目『事件循环机制』和『从浏览器输入地址到呈现出网页的过程』，事件循环机制可以让你知道为什么要对一些高计算任务进行分片、以及为什么分片是使用<code>setTimeout</code>而不是 Promise，而浏览器输入地址更是一道非常全面的问题，牵扯到缓存、DNS、HTTP、重排重绘合成等方面，之后我们的具体性能优化也是会随着这个来讲（浏览器输入地址这道题写在了<a href="https://www.nowcoder.com/discuss/834183">上篇</a>，如果有需要可以进行阅读～）</p><p><strong>事件循环</strong></p><ul><li>js 代码执行是单线程，浏览器有单独的事件触发线程来提供宏任务队列收集定时器、异步请求、浏览器事件中的 callback<ul><li>本身的 script 标签也是一个宏事件，在宏任务执行的过程中，Promise、queueMicrotask 中的 callback 会加入到微任务队列中，在当前宏任务主流程执行完后执行所有微任务（微任务太多会使浏览器卡死）</li><li>执行 requestAnimationFrame（在下次重绘之前调用）</li><li>如果有空闲的时间去执行 requestIdleCallback</li><li>再从宏任务队列中取出下一个宏任务进行执行</li></ul></li></ul><p><strong>性能优化决策</strong></p><p>所以我们从事件循环角度来考虑：</p><ul><li>耗时计算任务可以采取宏任务切片执行</li><li>控制一次宏任务中微任务的数量</li><li>动画可以写在 requestAnimationFrame 中</li></ul><p><strong>从浏览器输入地址到呈现出网页的过程</strong></p><p>上面我们提到了这道题，渲染过程可以简单的归纳一下</p><p>检查缓存是否存在 =&gt; DNS 域名解析 =&gt; http 请求返回 =&gt; 浏览器解析资源下载资源 =&gt; 重排重绘合成</p><p>我们可以从这几个方面来考虑怎么做性能优化</p><p><strong>缓存</strong></p><p>在浏览器取回页面之前，会经历几个缓存 check 的步骤，分别是：</p><ul><li>Service Worker</li><li>cache or disk</li><li>强缓存</li><li>协商缓存<br>这几个步骤前端能去掌握的只有 Service Worker，在手机端可以考虑使用 Service Worker 缓存一些静态资源</li></ul><p><strong>DNS</strong></p><ul><li>统一域名</li><li>预获取（dns-prefetch）<ul><li>让浏览器提前解析需要用到的域名，可以选用自动解析和手动解析两种方式</li><li></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启 DNS 预获取</span></span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;x-dns-prefetch-control&quot;</span> content=<span class="string">&quot;on&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置DNS预获取的域名</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;dns-prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://orderapi.phone580.com&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>预解析（preconnect）<br>浏览器要建立一个连接，需要经过 DNS 查找，TCP 三次握手和 TLS 协商，这些过程需要相当的耗时，所以 preconnect，就是一项使浏览器预先建立一个连接，等真正需要加载资源的时候能直接请求</li></ul><p><strong>HTTP</strong></p><p>可以从 Http2 相对于 Http1.1 的升级上来讲性能优化点，和前端相关主要的是：</p><ul><li>头部压缩</li><li>多路复用</li><li>Server Push</li></ul><p><strong>下载资源</strong></p><p>首屏请求的资源如果变小，有利于用户能先看到画面，可以有几个优化的点：</p><ul><li>懒加载路由</li><li>善用 CDN</li><li>preload、prefetch 等，在主页预先加载别的页面的资源</li></ul><p><strong>重排重绘合成</strong></p><ul><li>一旦 dom 数量上去重排的速度就会变慢，长列表可以用虚拟列表去做，控制 dom 节点数量</li><li>css 适当使用合成层渲染</li></ul><p><strong>最后还有一些方向策略</strong></p><ul><li>SSR、SSG</li><li>骨架屏（手机端）</li><li>wasm、web worker</li></ul><p>性能优化基本上就是这些啦，在回答这个问题时有一条清晰的主脉络是最重要的，随着渲染的流程讲不容易乱</p><h1>跨端</h1><ul><li>React Native vs Flutter <a href="https://www.zhihu.com/question/384934444">https://www.zhihu.com/question/384934444</a></li><li>小程序 <a href="https://zhuanlan.zhihu.com/p/59764741">https://zhuanlan.zhihu.com/p/59764741</a></li></ul><h1>微前端</h1><ul><li><p>什么是微前端</p><ul><li>概念：将多个独立的应用组合成一个更大的整体，由主框架根据路由加载子应用，不同的子应用状态隔离</li><li>适用场景：尝试更新颖的技术栈、降低耦合<br><a href="https://zhuanlan.zhihu.com/p/78362028">可能是你见过最完善的微前端解决方案 - 知乎 (zhihu.com)</a></li></ul></li><li><p>微前端有哪几种实现方式</p><ul><li>package 集成</li><li>iframe<ul><li>难以做路由、响应式页面</li><li>主要关系于子应用提供什么形式的资源做渲染入口</li></ul></li><li>JS entry 集成<ul><li>single-spa</li><li>子应用将资源打成一个 entry script，打包产物可能体积庞大</li></ul></li><li>HTML entry 集成<ul><li>qiankun</li><li>直接将子应用打出来 HTML 作为入口，主框架可以通过 fetch html 的方式获取子应用的静态资源，同时将 HTML document 作为子节点塞到主框架的容器中</li></ul></li><li>Web Component<ul><li>每个子应用提供一个自定义元素供容器实体化</li></ul></li><li>Module Federation<ul><li>多个独立开发，部署的模块</li></ul></li></ul></li></ul><h1>前端新趋势</h1><ul><li><p>React 18</p><ul><li>Concurrent mode <a href="https://zhuanlan.zhihu.com/p/60307571">深入剖析 React Concurrent - 知乎 (zhihu.com)</a></li><li><code>startTransaction</code>与<code>useDeferredValue</code>，状态更新划分优先级，进一步优化用户响应</li><li>React Server Component，渲染放到服务端，解决大依赖和复杂组件在客户端渲染造成的卡顿</li><li>支持 React.lazy 的 SSR 架构，使用全新的<code>pipeToNodeWritable</code> api 流式传输服务端渲染好的 HTML，client 端通过 Suspence 包裹进行选择性水合（hydration）</li></ul></li><li><p>pnpm (volt)</p><ul><li>新的依赖管理工具，通过软连接的方式解决 shadow dependency 问题，极大程度提升性能</li></ul></li><li><p>前端基建</p><ul><li>通过 ES Module 的方式，避免打包，同时，通过使用执行效率更高的语言（go, rust），实现本地启动效率的极大提升（10 倍+）<ul><li>vite</li><li>esbuild</li><li>前端基建 rust 化: swc, rome</li></ul></li></ul></li><li><p>低代码</p><ul><li>拖拽式表单与[数据]结构生成，将研发从 CRUD 的重复劳动中解放出来</li></ul></li><li><p>Tailwind CSS</p><ul><li>好用的原子类集合与设计系统集成，不再纠结类名</li></ul></li><li><p>JAMStack</p><ul><li>云原生，serverless 方式部署网站</li></ul></li><li><p>web3D: Babylon.js, Three.js</p><ul><li>元宇宙时代，前端也需要 3d</li></ul></li><li><p>Tauri</p><ul><li>新的桌面端框架，使用操作系统 webview 进行界面渲染并使用 rust 与操作系统集成，不再需要打包 Chromium 和 nodejs，大大减小应用体积</li></ul></li></ul><h1>项目相关</h1><p>在面试过程中，基本上所有的面试官都会让你选择一个项目来介绍，这个时候你可以自己选择一下，是介绍你搭建的项目还是最有技术难点的项目，当然两个都介绍也可以<br>关于项目面试中可以说是必问的问题：</p><ul><li><p>所有项目中你印象最深刻的是哪一个？为什么</p><ul><li>印象深刻的话可以是第一个负责的项目、也可以是之前没涉及过的领域，第一个带人的也可以，只要有理由就可以了</li></ul></li><li><p>你在这个项目中遇到的最大的困难是什么，是怎么解决的？</p><ul><li>最大的困难的话可以有一些小小的艺术加工哈，比如实际在项目中碰到了什么问题，就算当时没有解决绕过了，也可以自己思考一下如果是现在的自己会怎么去做，有哪几种方案分别的优劣是什么，只要逻辑通顺没有破绽，这个就是你解决的问题啦</li></ul></li><li><p>从一个需求提出到上线的整个过程，有觉得不完善的地方吗，有没有去做改进呢？</p><ul><li>这个问题可以从两个方面来回答:<ul><li>整体流程上，需求是否 match 人力，[测试] 评审选在了什么时候开，上线后是否有[数据]反馈，- 前端角度，线上监控有没有做好，埋点的[数据]是否真实可用</li></ul></li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>公共问题</p><ol><li><p>简单自我介绍</p></li><li><p>介绍下印象较深的项目及项目亮点</p></li><li><p>什么是BFC、解决了什么问题？</p></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">定义: 块格式上下文，是CSS可视化渲染的一部分，也是浮动元素与其他元素交互的区域。</span><br><span class="line"></span><br><span class="line">产生BFC的方法:</span><br><span class="line">1. float有值且不为空</span><br><span class="line">2. overflow有值且不为visible</span><br><span class="line">3. display有值为：inline-block，table-cell，flow-root，table-caption，inline-flex中的一个</span><br><span class="line">4. position有值为absolute或者fixed</span><br><span class="line"></span><br><span class="line">解决问题:</span><br><span class="line">1. 避免外边距重叠</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom: 10px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="4"><li>H5端屏幕自适应？</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浏览器的默认字体高都是 16px</span></span><br><span class="line"><span class="number">1.</span> 设置body font-size=<span class="number">62.5</span>%</span><br><span class="line"><span class="number">2.</span> 推导 1rem 值</span><br><span class="line">   <span class="number">100</span>%=16px， 16px * <span class="number">62.5</span>% = 10px</span><br><span class="line">   1rem = 10px</span><br><span class="line">   </span><br><span class="line">vw、rem + flex</span><br><span class="line">flex</span><br></pre></td></tr></table></figure><ol start="5"><li>uni-app、Taro踩坑记录</li></ol><ul><li>uni-app 如何做到适配多端</li></ul>  <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">踩坑</span><br><span class="line"><span class="bullet">1.</span> 微信小程序不支持Axios</span><br><span class="line"><span class="bullet">2.</span> 微信小程序不支持Cookies</span><br><span class="line"><span class="bullet">3.</span> 适配多端的UI选择</span><br><span class="line"><span class="bullet">4.</span> 微信小程序中不支持navigator和window对象，需要安装jsencrypt后再对其修改</span><br><span class="line"><span class="bullet">5.</span> 条件编译</span><br><span class="line"><span class="bullet">6.</span> 底层代码编译</span><br></pre></td></tr></table></figure><ul><li>taro</li></ul>  <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 使用原生第三方组件库开发，不再具有多端转换的能力</span><br><span class="line"><span class="bullet">2.</span> picker 是否支持 虚拟滚动[VirtualList]</span><br><span class="line"><span class="bullet">3.</span> </span><br></pre></td></tr></table></figure><ol start="6"><li>小程序setData数据量过大问题处理？</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  pageNo: <span class="number">0</span>,</span><br><span class="line">  list: <span class="selector-attr">[]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置list(二维数组)，实现每次只setDate新加载的数据</span></span><br><span class="line"><span class="built_in">setData</span>(&#123;</span><br><span class="line">  list<span class="selector-attr">[pageNo]</span>: newData</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">虚拟列表</span><br></pre></td></tr></table></figure><ol start="7"><li>几道JS题型</li></ol><ul><li>考察事件循环、作用域</li></ul>  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">for</span><span class="params">(var i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span></span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="selector-tag">i</span> =&gt; console<span class="selector-class">.log</span>(i), <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>JS EventLoop</li></ul>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># <span class="attr">eg</span>:</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;script start&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timeout&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script end&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="attr">result</span>:</span><br><span class="line">  script start</span><br><span class="line">  async1 start</span><br><span class="line">  async2</span><br><span class="line">  promise1</span><br><span class="line">  script end</span><br><span class="line">  async1 end</span><br><span class="line">  promise2</span><br><span class="line">  timeout</span><br></pre></td></tr></table></figure><ul><li>自定义 setInterval 定时器</li></ul>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 场景：</span></span><br><span class="line"><span class="comment">* 1. setInterval 轮询在网络不好时出现请求堆积</span></span><br><span class="line"><span class="comment">* 2. setInterval 执行函数时间 &lt; 设定时间 导致逻辑错误</span></span><br><span class="line"><span class="comment">* 3. setInterval 对自己调用的代码是否报错不关心</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 例如：hello world 未按照 设定时间 2s 来执行</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>), <span class="number">2000</span>)</span><br><span class="line">&#125;, <span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">interval</span>(<span class="params">s,fn</span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="title function_">timeOut</span> = (<span class="params">s,fn</span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">fn</span>();</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(timeOut,s)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">timeOut</span>(s,timeOut);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用上面的方法</span></span><br><span class="line"><span class="title function_">setInter</span>(<span class="number">3000</span>,<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello world!&quot;</span>))</span><br><span class="line"><span class="comment">// 终止定时器</span></span><br><span class="line"><span class="built_in">clearTimeout</span>(timer)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>设计模式</p><ul><li>单例</li><li>发布订阅 EventEmitter</li><li>工厂模式</li></ul></li><li><p>什么是AST</p></li></ul>  <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 词法分析</span><br><span class="line"><span class="bullet">2.</span> 语法分析</span><br><span class="line"><span class="bullet">3.</span> 转换机器码</span><br></pre></td></tr></table></figure><ol start="8"><li>简要概述下 数组实现 栈/队列的思路</li></ol><ul><li><p>栈<br><img src="images/stack.png" alt="栈"></p></li><li><p>队列<br><img src="images/queue.png" alt="队列"></p></li></ul><ol start="9"><li>用过哪些构建工具？webpack hmr 的原理</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">webpack、vite、umi、rollup</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 内存中生成dist</span><br><span class="line"><span class="bullet">2.</span> 在浏览端和客户端有一个ws长链接</span><br><span class="line"><span class="bullet">3.</span> 当文件的真实hash值变化时，客户端会将新的hash值推给浏览器端</span><br><span class="line"><span class="bullet">4.</span> 浏览器端向客户端发起请求jsonp请求新的文件</span><br></pre></td></tr></table></figure><ol start="10"><li>如何做性能优化</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 优化图片</span><br><span class="line"><span class="bullet">2.</span> 优化CSS[压缩合并css、如 margin-top, margin-bottom]</span><br><span class="line"><span class="bullet">3.</span> 网址后加 <span class="code">`/`</span></span><br><span class="line"><span class="bullet">4.</span> 标明 元素 尺寸(宽高)</span><br><span class="line"><span class="bullet">5.</span> 减少 http 请求</span><br><span class="line">  a. 文件合并、压缩</span><br><span class="line">  b. 使用 缓存(HTTP 缓存)</span><br></pre></td></tr></table></figure><ol start="11"><li><p>编码规范及Git提交规范<br>ESLint、Prettier<br>commitlint + husky 提交规范 (git hooks)<br>stylelint</p></li><li><p>是否了解低代码、微前端框架？</p></li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">低代码</span><br><span class="line">  表单设计器</span><br><span class="line">  </span><br><span class="line">  流程设计器</span><br><span class="line">  </span><br><span class="line">  报表设计器</span><br><span class="line">  </span><br><span class="line">  BI 设计器</span><br><span class="line"></span><br><span class="line">  等等</span><br><span class="line"></span><br><span class="line">微前端</span><br><span class="line">  Single-SPA</span><br><span class="line"></span><br><span class="line">  Qiankun</span><br><span class="line"><span class="bullet">    -</span> </span><br><span class="line">  </span><br><span class="line">  MicroApp</span><br><span class="line"><span class="bullet">    -</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>拓展性:<br>react + typescript</p><p>vue3</p><ul><li><p>React Native</p><ul><li>0.5.7 + charless 代码</li><li>屏幕适配 rem[淘宝] flexsible</li></ul></li><li><p>webview + h5</p></li><li><p>rn bundlesjs</p></li></ul><p>spwn</p><ul><li><p>Taro、UI组件</p></li><li><p>taro 搭配 webpack</p></li><li><p>env</p></li><li><p>Istanbul生成测试报告</p></li><li><p>埋点</p><ul><li>点击</li><li>展现</li><li>曝光</li></ul></li><li><p>微前端</p><ul><li>react</li></ul></li><li><p>低代码</p><ul><li><p>表达设计器</p><ul><li>出码</li><li>schema</li></ul></li><li></li></ul></li></ul><p>技术选项</p><ul><li>vue、react<ul><li>js</li><li></li><li></li><li></li></ul></li><li><h2 id="技术迭代">技术迭代</h2><ul><li></li></ul></li><li>公共组件库的封装过程<ul><li>通用组件时需要注意的问题？</li><li>props elment-ui</li><li>peerDe</li><li>自适应</li><li></li><li></li></ul></li><li>团队水平</li></ul><p>大数据画像平台</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">Form List</span><br><span class="line">-&gt; <span class="punctuation">[</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h2 id="健康管理平台">健康管理平台</h2><ul><li><p>微前端</p><ul><li>qiankun</li><li>js 隔离<ul><li>沙箱</li><li>proxy</li></ul></li><li>css 隔离<ul><li>vue scoped<ul><li>对应Hash类名</li></ul></li><li>qiankun2、3</li><li></li></ul></li><li>iframe<ul><li>信息跨域<ul><li>window.post(‘m’)</li></ul></li><li><h2 id="css隔离">css隔离</h2><ul><li></li></ul></li></ul></li></ul></li><li><p>低代码</p><ul><li>拖拽方式 声明</li><li>Formily</li></ul></li></ul><p>css BFC概念？解决哪些问题?</p><p>react hooks 解决哪些问题？</p><p>useState 为何 if判断中？</p><p>redux<br>dispatch -&gt; Action -&gt; reducer -&gt; store -&gt; emit(‘change’) -&gt; view 更新</p><p>Dva 异步机制</p><p>useRef 与 useState 区别？</p><p>fiber、reconcile</p><p>typescript 使用过哪些 类型声明？</p><p>omit\pick\partial<br>&amp; 、 |</p><p>for(var i = 0; i &lt; 10; i++) {<br>setTimeout(i =&gt; console.log(i), 1000)<br>}</p><p>判断 “()()()(()))(” 是否合法？</p><p>云产品<br>vue、vuestic</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://Object.is">Object.is</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>如何面试别人</strong></p><p>1、暖场、破冰</p><p>2、详细的自我介绍</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">您好，我是负责本次面试的面试官李佳豪</span><br></pre></td></tr></table></figure><p>3、进入主题及控制</p><p>4、给予建议及答复</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>1、代码规范、开发规范、投产规范、安全第一，合规第一</p><p>代码规范：<br>编程命名规范结合Eslint 进行统一编码规范</p><p>Git提交规范<br>commitlint + husky  提交规范<br>eslint + prettier   编码规范</p><p>投产规范<br>测试环境和生产环境<br>giteeScan<br>缺陷报告：单引号问题<br>规范报告：{name:123} 行尾, ;要加空格 不得省略分号</p><p>代码重复率监测<br>代码缺陷检测</p><p>sonarQube:<br>代码行数量、重复率统计<br>代码逻辑缺陷扫描(空指针)<br>根据 SonarLint Report 视图，展示不规范的事项列表，处理警告和坏味道</p><p>2、沟通协作，能跨部门沟通，推动问题解决<br>项目立项，经过需求评审后 制定开发计划 做技术调研 跟进研发进度</p><p>3、能进行软件架构、核心功能点方案设计，PPT编写</p><p>4、有后端经验肯定加分</p><h4 id="部分问答">部分问答</h4><p><strong>实现继承的几种方式</strong></p><ol><li>Object.create(null)</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">字面量和<span class="keyword">new</span>关键字创建的对象是<span class="title class_">Object</span>的实例，原型指向<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>，继承内置对象<span class="title class_">Object</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;; <span class="comment">// var a = new Objecct();</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">create</span>(arg, pro)创建的对象的原型取决于arg</span><br><span class="line"><span class="number">1.</span> arg为<span class="literal">null</span>，新对象是空对象，没有原型，不继承任何对象；</span><br><span class="line"><span class="number">2.</span> arg为指定对象，新对象的原型指向指定对象，继承指定对象</span><br></pre></td></tr></table></figure><ol start="2"><li></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>css</strong><br>flex</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* flex: 1 =&gt; flex: 1 1 0; */</span></span><br><span class="line"><span class="attribute">flex</span>-group: 增长系数</span><br><span class="line">flex-shark: 收缩系数</span><br><span class="line">flex-basis: 主轴方向上基础尺寸 auto</span><br><span class="line"></span><br><span class="line">BFC</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="js">js</h3><p>发布订阅</p><p>闭包：函数嵌套函数、内层函数可访问外层函数作用域中的变量</p><p>浏览器</p><ul><li><p>cookie 服务器派发给客户端的凭证</p></li><li><p>session 服务器与客户端建立的会话、存储在服务端</p></li><li><p>加载及解析全过程</p></li></ul><ol><li>url -&gt; dns 解析 ip -&gt;拉取静态资源(html\css\js)</li><li>浏览器加载并解析html</li></ol>  <figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Dom Tree + Css Rule Tree = Render Tree</span><br><span class="line">Render Tree -&gt; Layout + Paint -&gt; 视图页面</span><br><span class="line"></span><br><span class="line">js全阻塞、css半阻塞</span><br></pre></td></tr></table></figure><ul><li>渲染进程<ul><li>GUI 渲染线程</li><li>JS 执行线程</li><li>事件队列线程</li><li>定时器线程</li><li>异步http请求线程</li></ul></li></ul><p>EventLoop</p><ul><li><p>执行栈</p></li><li><p>异步任务</p><ul><li>宏任务队列<ul><li>setInterval、setTimeout、RequestAnimalFrame</li></ul></li><li>微任务队列<ul><li>promise、async/await</li></ul></li></ul></li><li><p><a href="https://juejin.cn/post/7002011181221167118">三方cookie</a></p></li><li><p>URL -&gt; dns 解析(路由查找) -&gt;  html加载解析</p></li><li><p>oAuth: 基于 grant_code 授权码进行认证</p></li><li><p>SSO： 全局会话、局部会话</p></li></ul><p>promise 实现</p><p>函数式编程</p><ul><li><p>纯函数: 无状态函数，相同输入、相同输出</p></li><li><p>不可变数据类型</p></li><li><p>函数柯里化: 只传递给函数一部分参数来调用它，让它返回一个函数去处理剩下的参数</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">curry</span> = (<span class="params">fn, ...rest</span>) =&gt; (</span><br><span class="line">  rest.<span class="property">length</span> &gt;= fn.<span class="property">length</span></span><br><span class="line">    ? <span class="title function_">fn</span>(...rest)</span><br><span class="line">    : <span class="function">(<span class="params">..._rest</span>) =&gt;</span> <span class="title function_">curry</span>(fn, ...rest, ..._rest)</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>数组扁平化 flat</p><ul><li>concat + 递归</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flat</span>(<span class="params">arr, depth = <span class="number">1</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> res = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(item)) &#123;</span><br><span class="line">      <span class="keyword">if</span>(depth &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        res = res.<span class="title function_">concat</span>(<span class="title function_">flat</span>(item, depth - <span class="number">1</span>))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(depth === <span class="string">&#x27;Infinate&#x27;</span>) &#123;</span><br><span class="line">        res = res.<span class="title function_">concat</span>(<span class="title function_">flat</span>(item, depth))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="title function_">push</span>(item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> tmp = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>], <span class="number">6</span>], <span class="number">7</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">flat</span>(tmp))</span><br></pre></td></tr></table></figure><p>数组元素聚合</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">juhe</span>(<span class="params">arr, num</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> new_arr = [];  </span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(i % num === <span class="number">0</span> &amp;&amp; i !== <span class="number">0</span>) &#123;</span><br><span class="line">      new_arr.<span class="title function_">push</span>(arr.<span class="title function_">slice</span>(index, i))</span><br><span class="line">      index = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(i + <span class="number">1</span> === arr.<span class="property">length</span>) &#123;</span><br><span class="line">      new_arr.<span class="title function_">push</span>(arr.<span class="title function_">slice</span>(index, arr.<span class="property">length</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> new_arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// const arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];</span></span><br><span class="line"><span class="comment">// juhe(arr, 3)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>防抖</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> _arguments = <span class="variable language_">arguments</span>;    </span><br><span class="line">    <span class="keyword">if</span>(timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(_this, _arguments);</span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>节流</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, interval</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> last = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> _arguments = <span class="variable language_">arguments</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">    <span class="keyword">if</span>(now - last &gt; interval) &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(_this, _arguments)</span><br><span class="line">      last = now;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取验证码</span></span><br><span class="line"><span class="keyword">let</span> getCode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;getCode&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> time = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">getCode.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">getCodeFun</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCodeFun</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// if (timer) &#123;</span></span><br><span class="line">  <span class="comment">//   clearInterval(timer);</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  getCode.<span class="title function_">setAttribute</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  timer = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    time--;</span><br><span class="line">    getCode.<span class="property">innerHTML</span> = <span class="string">&quot;剩余 &quot;</span> + time + <span class="string">&quot; s&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (time &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">      time = <span class="number">5</span>;</span><br><span class="line">      getCode.<span class="property">innerHTML</span> = <span class="string">&quot;重新获取&quot;</span>;</span><br><span class="line">      getCode.<span class="title function_">removeAttribute</span>(<span class="string">&quot;disabled&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>react hooks</p><ul><li>useRef</li><li>useState</li><li>useEffect</li><li>useMemo</li><li>useCallback</li><li>useReducer</li><li>自定义Hooks</li></ul><p>架构</p><ul><li>fiber</li><li>recon</li></ul><p>微前端</p><ul><li><p>html、js 加载区别</p></li><li><p>garfish</p></li><li><p>micro-app</p></li><li><p>js 隔离</p></li><li><p>css 隔离</p></li></ul><p>http 协议</p><p>思维发散</p><ul><li>cdn<br>vue</li></ul><p>一面、二面<br>js、css + 做题<br><strong>1h</strong></p><p>Git<br>$A&gt; git merge B</p><ul><li>以A、B两分支最近的父节点为准，进行三方合并，生成新的 commit</li></ul><p>$A&gt; git rebase B</p><ul><li>以A、B两分支最近的父节点为准, 将A更新到B节点处，再依次将A的提交记录 patch 至A分支上</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>STAR法则</strong></p><blockquote><p>提问法核心和底层逻辑是通过就某一个或几个核心的工作或经历提问，通过让应聘者具体拿过去曾经做过的具体案例来举例:</p></blockquote><ul><li>详细的说明当时的情况S</li><li>需要达到的目标T</li><li>采取的行动A</li><li>最终实现的结果R</li></ul><p>来判断应聘者是否真实的经历过该项工作</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>js 相关(ts)</strong></p><ol><li><p>箭头函数</p><ul><li>不可用于构造函数，无 prototype</li><li>无法改变 this 指向</li></ul></li><li><p>原型链</p><ul><li>每个对象的<code>__proto__</code>指向创建它的构造函数的 prototype，而构造函数的 prototype 也有<code>__proto__</code>指向他的父辈或者是 Object，当查找一个对象中不存在的属性时，会去它的<code>__proto__</code>、<code>__proto__</code>中的<code>__proto__</code>中进行寻找，直到找到或者是<code>null</code>为止</li><li><code>instanceof</code>判断对象的<code>__proto__</code>和构造函数的 prototype 是不是同一个地址</li><li><code>Object.set[Proto](/jump/super-jump/word?word=Proto)typeOf</code>改变对象的<code>__proto__</code></li></ul></li><li><p>闭包</p><ul><li>定义：在一个函数 A 中，定义函数 B 访问函数 A 的变量</li><li>目的：隐藏变量</li></ul></li><li><p>Map 和 Object 的区别</p><ul><li>Map 的 key 可以为任何值，而 Object 只能为 string</li><li>Map 元素的顺序遵循插入的顺序，而 Object 的则没有这一特性</li></ul></li><li><p>Weak map</p><ul><li>Weak map 的 key 是弱引用，不会被垃圾回收的计数计算</li><li>可以用来做反射的元<a href="/jump/super-jump/word?word=%E6%95%B0%E6%8D%AE">数据</a>池、保存有关 DOM 节点的<a href="/jump/super-jump/word?word=%E6%95%B0%E6%8D%AE">数据</a></li></ul></li><li><p>实现一个 Partial</p></li></ol>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">MyPartial</span>&lt;T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof T]?: T[K]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="7"><li>输出什么</li></ol>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="number">2</span>)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err1,&quot;</span>,err))</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;then1&quot;</span>,res)&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err2,&quot;</span>,err))</span><br></pre></td></tr></table></figure><ol start="8"><li><p>从浏览器输入地址到呈现出网页的过程</p><ul><li><p>查看是否有有效的 service worker 缓存</p></li><li><p>判断是否有强缓存，也就是未过期的资源，靠 expire 和 cache-control 判断</p></li><li><p>DNS 域名解析</p></li><li><p>进行三次握手+TLS 握手</p><ul><li>TLS 握手<ul><li>客户端请求服务端的证书</li><li>第一次非对称加密，用 CA 的公钥去解证书的签名，如果解出来的 hash 和证书信息 hash 一致则合法</li><li>第二次非对称加密，客户端使用服务端公钥加密随机数</li><li>服务端使用服务端私钥解密随机数</li><li>使用随机数进行对称加密</li></ul></li></ul></li><li><p>向资源发送请求</p></li><li><p>协商缓存，使用 if-modified-since 和 etag 与服务器对比，或没有改变取本地缓存，返回的状态码是 304</p></li><li><p>取回资源</p></li><li><p>解析网页资源，下载网页中的资源</p><ul><li>html、css、font 这三种类型的资源优先级最高</li></ul></li><li><p>生成 dom 树和 css 树，构造 render 树</p></li><li><p>重排、重绘、合成</p></li><li><p>当 DOM 的变化引发了元素几何属性的变化，比如改变元素的宽高，元素的位置，导致浏览器不得不重新计算元素的几何属性，并重新构建渲染树，这个过程称为“重排”。完成重排后，要将重新构建的渲染树渲染到屏幕上，这个过程就是“重绘”。</p></li><li><p>首次渲染时一定会执行重排，后续如果不改变元素的外形位置尺寸则可以只执行重绘，不执行重排。</p></li><li><p>重绘得到的像素使用 GPU 绘制在页面上，一些特殊的 element 会单独为一个合成层（比如 will-change、或者 3D 转换等），合理使用合成层可以提高动画效果</p></li><li><p>触发 DOMContentLoaded 事件</p></li><li><p>加载图片等外部文件</p></li><li><p>触发 load 事件</p></li><li><p>下载 preload 资源（通过标签预加载）</p></li><li><p>小备注</p><ul><li>async script 会在 script 下载完成时立即执行，和构造 render 树并行</li><li>defer script 会在文档渲染完毕后，DOMContentLoaded 事件调用前执行</li></ul></li></ul></li></ol><p><strong>css 相关</strong></p><ol><li><p>实现 0.5px</p><ul><li>直接设置(兼容性问题，firefox、safari 可以，其他浏览器不可以)</li><li><code>transform: scaleY(0.5);transform-origin: 50% 100%;</code></li><li><code>linear-gradient</code>、<code>box-shadow</code>(各自有兼容性问题)</li><li>svg 的描边等属性的 1px 是物理像素的 1px</li></ul></li><li><p>CSS in JS vs less(scss) vs tailwindCss</p><ul><li>CSS in JS<ul><li><p>通用组件可用 Css in Js</p></li><li><p>emotion</p><ul><li>特点：定义 global、source-map、提取 css 文件</li></ul></li><li><p>Style Components</p><p>const Button = styled.a<code> display: inline-block; $&#123;props =&gt; props.primary &amp;&amp; css</code><br>background: white; <code>&#125; </code></p></li></ul></li><li>Less &amp; Scss<ul><li>Css 的预处理器，提供一些避免重复的功能</li><li>变量<ul><li>现在 css 也可实现，<code>--primary: red; color: var(--primary)</code></li><li>但是预处理器在转换时替代，比起 css 在运行时替代，预处理器理论上性能更好</li><li>但预处理器无法简单的实现在项目运行时动态替代的需求（比如换肤）</li></ul></li><li>嵌套<ul><li>css 计划支持但是遥遥无期</li></ul></li><li>继承、函数、迭代、条件分支</li></ul></li><li>TailWindCss<ul><li>原子颗粒写 css</li><li>design system</li></ul></li></ul></li><li><p>换肤</p><ul><li><a href="https://juejin.cn/post/6844904122643120141">https://juejin.cn/post/6844904122643120141</a></li></ul></li><li><p>BFC</p><ul><li>概念：每一个 BFC 区域只包括其子元素，不包括其子元素的子元素。<ul><li>每一个 BFC 区域都是独立隔绝的，互不影响</li><li>计算 BFC 高度时，浮动元素也参与计算</li><li>BFC 不会覆盖浮动元素</li></ul></li><li>实现：通过设置 body 根元素、float、position、display: flex、overflow 等形成一个 BFC</li><li>解决问题：<ul><li>margin 塌陷：把这两个元素各自放在两个 BFC 中，根据 BFC 互相独立隔绝可解决问题</li><li>计算浮动高度、不覆盖浮动</li></ul></li></ul></li><li><p>层叠上下文(z-index)</p><ul><li><a href="https://blog.csdn.net/llll789789/article/details/97562099">https://blog.csdn.net/llll789789/article/details/97562099</a></li><li>普通元素的层叠等级优先由其所在的层叠上下文决定。层叠等级的比较只有在当前层叠上下文元素中才有意义。不同层叠上下文中比较层叠等级是没有意义的。</li><li>css3 新属性也可以产生层级上下文（偏好文字在上层）</li><li>两个兄弟元素，一个设置了 background，一个设置了 z-index:-1，background 优先级低</li><li>z-index: auto 不生成层叠上下文，z-index:0 生成为 0 的层叠上下文<ul><li>两个为 0 的 z-index，后一个优先级大</li></ul></li></ul></li><li><p>移动端适配</p><ul><li>1px 问题，想要精准画出 1px 物理像素的边<ul><li>使用媒体查询-webkit-min-device-pixel-ratio、scale 配合来画</li><li>svg</li></ul></li><li>viewport</li><li>媒体查询</li><li>整体可以是 rem、vx 为主，px 为辅，多用 flex 和 grid<ul><li>rem 和 vw 方案的区别</li></ul></li></ul></li></ol><p><strong>框架相关（主要是 React）</strong></p><ol><li><p>concurrent 模式</p><ul><li><a href="https://zhuanlan.zhihu.com/p/60307571">https://zhuanlan.zhihu.com/p/60307571</a></li></ul></li><li><p>React 新生命周期<br><img src="./images/react-lifecycle.png" alt="react"></p></li><li><p>hook 和 class 对比</p><ul><li>hook 没有生命周期，class 有（hook 可以使用钩子函数模仿生命周期）</li><li>hook 可以把业务逻辑抽离出来做自定义 hook<ul><li>比如说我们有一个组件，里面的逻辑是屏幕大小一变化，就输出屏幕当前宽高</li><li>就可以写一个自定义的 hook useWindowSize</li></ul></li><li>hook 缺点<ul><li>写<code>useEffect</code>、<code>useMemo</code>的依赖项比较考验心智</li><li>状态不同步，容易产生闭包，需要使用 useRef 去记录</li></ul></li></ul></li><li><p>hook 为什么不可以在 if、switch 等循环中</p><ul><li>简单来说，hooks 就是通过数组实现的，比如当使用 setState 时，有两个数组去存放 state 和 setState 方法</li><li>在函数组件重新渲染后，state 设为初始值时去数组读取缓存值</li><li>所以不能改变 hooks 顺序，否则读取数组顺序会有误</li></ul></li><li><p>React 和 Vue 如何选择</p><ul><li>Vue 的更新是<a href="/jump/super-jump/word?word=%E6%95%B0%E6%8D%AE">数据</a>原子级别，而 React 是组件级别</li><li>Vue 会对需要追踪的状态，把它们转化为 getter 和 setter 进行<a href="/jump/super-jump/word?word=%E6%95%B0%E6%8D%AE">数据</a>代理，可以更细粒度的去做 dom diff 和预编译优化，但一旦<a href="/jump/super-jump/word?word=%E6%95%B0%E6%8D%AE">数据</a>流乱了，很难去从中拦截渲染</li><li>React 则只关心 setState，更加粗粒度但是更好控制<br><img src="./images/state-control.png" alt="React和Vue如何选择"></li></ul></li></ol><p><strong>安全相关</strong></p><ol><li><p>XSS</p><ul><li>XSS 攻击通常指的是通过利用网页开发时留下的漏洞，通过巧妙的方法注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。</li><li>场景：<ol><li>用户输入 <code>&quot;/&gt;&lt;/script&gt;&lt;img src='1' onerror=alert(1)&gt;&lt;name aa=&quot;</code></li><li>前端渲染用户输入内容时，就会将恶意标签进行渲染</li><li>导致可以执行任何 js（构造恶意链接、盗取用户 cookie、伪造用户身份去发起删除请求等）</li></ol></li><li>修复：<ul><li>非富文本场景：进行 htmlencode 编码操作</li><li>富文本场景：dom 解析、白名单标签过滤、图片上传内网</li></ul></li></ul></li><li><p>CSRF</p><ul><li>CSRF（Cross-site Request Forgery）跨站请求伪造，由于目标站无 token/referer 限制，导致攻击者可以用户的身份完成操作达到各种目的。</li><li>场景：<ol><li>攻击者构造一个页面，在页面中使用 ajax 构造一次请求</li><li>用户访问该页面，ajax 自动发器请求</li><li>由于是在用户本地浏览器发器的请求，浏览器默认携带用户的 cookie 信息，请求发起成功</li></ol></li><li>修复：<ol><li>开启框架的 CSRF 防御机制</li><li>使用 token 机制</li><li>Referer 验证<ol><li>对 Referer 来源开启白名单机制</li><li>白名单匹配完整主域名</li></ol></li><li>cookie samesite withCredential</li></ol></li></ul></li><li><p>如何反爬</p><ul><li><a href="https://juejin.cn/post/7056802543367618567">研究一下大厂怎么做反爬-你可能不知道的反爬虫知识 - 掘金 (juejin.cn)</a></li></ul></li><li><p>跨域</p><ul><li>CORS 了解一下机制</li><li>jsonp 可用作打点上报</li><li>iframe 可用 onmessage message</li><li>proxy</li></ul></li></ol><p><strong>构建工具相关</strong></p><ol><li><p>构建工具对比</p><ul><li><a href="https://mp.weixin.qq.com/s/3RTd3KCeKm_5aidYjhDe6Q">【第 2258 期】新一代构建工具对比 (qq.com)</a></li><li>Rollup 不支持 HMR，在对 js 以外的模块的支持上不如 webpack，但是如果是打包纯 js 库例如 react，前期的 vue 的话，使用 rollup 是很合适的，打包的产物比较干净，没有 webpack 那么多工具函数</li><li>Rollup 的插件机制设计得相对更干净简洁，单个模块的 resolve / load / transform 跟打包环节完全解耦，所以 Vite 才能在开发时模拟 Rollup 的插件机制，并且兼容大部分 Rollup 插件</li><li>现在 webpack 支持 es6module 输出并且 webpack5 能有更好的 tree-shaking</li><li>在开发应用时使用 Webpack，开发库时使用 Rollup</li></ul></li><li><p>webpack 生命周期</p><ul><li>使用配置文件中的参数初始化 compiler 对象，初始化所有插件</li><li>从入口文件出发，调用所有 loader 对模块进行处理(链式)，再找出该模块依赖的模块进行处理</li><li>根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 chunk，再把每个 chunk 转换成一个单独的文件加入到输出列表</li><li>根据配置确定输出的路径和文件名，写入文件系统</li><li>在以上过程中，Webpack 会在特定的时间点广播出特定的事件，插件在监听对应的事件后会执行特定的逻辑</li><li>Webpack 以开发模式运行时，每当检测到文件变化，一次新的 Compilation 被创建。</li></ul></li><li><p>是否有写过 webpack 或者 babel 插件</p><ul><li><a href="https://segmentfault.com/a/1190000012840742">Webpack 原理-编写 Plugin - SegmentFault 思否</a></li></ul></li><li><p>webpack hmr 的原理</p><ul><li><p><a href="https://zhuanlan.zhihu.com/p/30669007">https://zhuanlan.zhihu.com/p/30669007</a></p></li><li><p>超简版：</p><ol><li>客户端将打包好的代码存储在内存中</li><li>在浏览端和客户端有一个 ws 长链接</li><li>当文件的真实 hash 值变化时，客户端会将新的 hash 值推给浏览器端</li><li>浏览器端向客户端发起请求 jsonp 请求新的文件</li></ol></li></ul></li></ol><p><strong>实现题</strong></p><ol><li>实现一个 EventEmitter<ul><li><a href="https://zhuanlan.zhihu.com/p/77876876">EventEmitter 的前端实现 - 知乎 (zhihu.com)</a></li></ul></li><li>实现 promise<ul><li><a href="https://zhuanlan.zhihu.com/p/144058361">从零开始手写 Promise - 知乎 (zhihu.com)</a></li></ul></li><li>实现 promise.all<ul><li><a href="https://zhuanlan.zhihu.com/p/41502945">Promise.all 手动实现 - 知乎 (zhihu.com)</a></li></ul></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="ref">ref</h3><ul><li>主要用于定义基本类型，使用时需要通过 .value 读取或修改</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本类型：除去Object，包括：String、Number、boolean、null、undefined</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">count.<span class="property">value</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在定义基本类型时，响应式原理是与 vue2.x类似的 Object.defineProperty()，通过 get、 set读取、修改数据</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>定义引用类型的数据</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意，当定义引用类型时，其内部实现则是借助 reactive</span></span><br><span class="line"><span class="comment">// 可以通过打印数据在控制台查看结构，分别为：RefImpl、Proxy</span></span><br></pre></td></tr></table></figure><h3 id="reactive">reactive</h3><ul><li>只能定义引用类型，即Object，包括：Object、Array、Date、function，定义基本类型时会警告, 使用时，直接通过属性读写</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reactive</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;<span class="attr">count</span>:<span class="number">0</span>&#125;)</span><br><span class="line"></span><br><span class="line">state.<span class="property">count</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// reactive默认对对象内的所有属性都进行响应式处理，并可以实现深层监听</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 该响应式能力是通过 ES6 Proxy实现的，其可以做到对属性的新增、删除监听，解决了 defineProperty 的缺陷，并且对嵌套属性有着良好的支持，可以轻松实现 a.b.c.d=xx的响应式更新</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Proxy与 Reflect均为ES6语法，一般他俩是一起配合使用，可以很好的做到安全优雅的对属性做出劫持更新</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>执行顺序</strong><br><img src="./images/vue.png" alt="vue"><br><img src="./images/vue_init.png" alt="vue_init"><br><img src="./images/init_state.png" alt="init_state"></p><blockquote><p>执行顺序beforeCreate  -&gt;inject -&gt; Props -&gt;  Methods -&gt;  Data -&gt; Computed -&gt; Watch -&gt;provide-&gt; created</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<ol><li>Vue 中观察者模式和发布/订阅模式的区别和场景</li></ol><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">* </span>Vue 中响应式数据变化就是典型的观察者模式</span><br><span class="line"><span class="bullet">* </span>Vue 中事件绑定就是发布订阅模式</span><br><span class="line"></span><br><span class="line">观察者模式中观察者和被观察者是存在关联的。</span><br><span class="line">发布订阅模式中订阅者和发布者没有关联，所以观察者模式包含了发布订阅模式(watcher\dep)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">理论口述：</span><br><span class="line"><span class="bullet">* </span>Vue 渲染机制依赖Object.defineproperty数据劫持及发布订阅</span><br><span class="line"><span class="bullet">* </span>Vue实例初始化时给data上的每个属性绑定一个 watcher 监听器，数据改变时，会触发setter，并且通过notify函数去通知所有订阅者Watcher，订阅者们就会调用patch方法，给真实DOM打补丁，进而触发视图的更新。</span><br></pre></td></tr></table></figure><ol start="2"><li>Vue优势</li></ol><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">* </span>轻量级框架、简单易学</span><br><span class="line"><span class="bullet">* </span>双向数据绑定</span><br><span class="line"><span class="bullet">* </span>组件化</span><br><span class="line"><span class="bullet">* </span>虚拟DOM</span><br></pre></td></tr></table></figure><ol start="3"><li>Router 和 Route 区别</li></ol><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Router: 全局路由对象,Router构造方法实例,有<span class="built_in">push</span>,<span class="built_in">replace</span>,go等方法</span><br><span class="line">Route:  当前路由对象,有query,param,path,<span class="built_in">hash</span>,name等信息</span><br></pre></td></tr></table></figure><ol start="4"><li>路由周期函数</li></ol><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">作用：</span><br><span class="line">用来判断权限、页面丢失需要执行的操作</span><br><span class="line"></span><br><span class="line">全局路由：</span><br><span class="line"><span class="keyword">beforeEach：to/from/next</span></span><br><span class="line"><span class="keyword"></span>afterEach：</span><br><span class="line"></span><br><span class="line">组件路由：</span><br><span class="line"><span class="keyword">beforeRouteEnter</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">beforeRouteUpdate</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">beforeRouteLeave</span></span><br><span class="line"><span class="keyword"></span></span><br></pre></td></tr></table></figure><ol start="5"><li>Vue nextTick</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> 获取更新后的dom元素</span><br><span class="line"><span class="bullet">1.</span> Vue异步执行DOM更新。只要观察到数据变化，Vue将开启一个队列，并缓冲在同一事件循环中发生的所有数据改变。如果同一个watcher被多次触发，只会被推入到队列中一次。</span><br><span class="line"><span class="bullet">2.</span> 这种在缓冲时去除重复数据对于避免不必要的计算和DOM操作上非常重要。然后，在下一个的事件循环“tick”中，Vue刷新队列并执行实际 (已去重的) 工作。</span><br></pre></td></tr></table></figure><ol start="6"><li>v-if和v-show区别</li></ol><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 展示区别</span><br><span class="line">v-<span class="keyword">if</span>:   创建一个dom</span><br><span class="line">v-<span class="built_in">show</span>: 设置元素的 <span class="built_in">display</span>: none/<span class="built_in">block</span></span><br><span class="line"></span><br><span class="line">* 使用场景</span><br><span class="line">初次加载 v-<span class="keyword">if</span> 性能优于 v-<span class="built_in">show</span> (不加载该dom)</span><br><span class="line">频繁切换 v-<span class="built_in">show</span>性能优于 v-<span class="keyword">if</span>  (dom创建/删除开销 &gt; dom 显示/隐藏)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="7"><li>v-if 与 v-for优先级</li></ol><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Vue2:</span> v-for 优先级 高于 v-if (在源码 getElement 函数中体现)</span><br><span class="line"><span class="symbol">Vue3:</span></span><br></pre></td></tr></table></figure><ol start="8"><li>ref</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取 dom 元素</span><br></pre></td></tr></table></figure><ol start="9"><li>scoped 原理</li></ol><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">* </span>让css样式仅在当前组件中生效</span><br><span class="line"><span class="bullet">* </span>原理：给节点新增 data-v-[hash] 属性、让css 根据属性选择器添加 样式</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="10"><li>vue 中样式穿透</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">* css</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">* scss</span><br><span class="line">- 下载 yarn add sass-loader node-sass -D</span><br><span class="line">- scss 样式穿透</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&#x27;scss&#x27;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.parent</span> /deep/ <span class="selector-class">.swiper-pagenation</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">* stylus</span><br><span class="line">- 下载 yarn add stylus stylus-loader -D</span><br><span class="line">- stylus 样式穿透 (/deep/ 或者 &gt;&gt;&gt;)</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&#x27;stylus&#x27;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.parent</span> &gt;&gt;&gt; <span class="selector-class">.swiper-pagenation</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="11"><li>组件间传值</li></ol><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">* 父传子: </span><br><span class="line">props<span class="operator"></span></span><br><span class="line"><span class="operator"></span></span><br><span class="line"><span class="operator">* </span>子传父: </span><br><span class="line">watch: &#123;</span><br><span class="line">  name: <span class="keyword">function</span>(newVal, oldVal) &#123;</span><br><span class="line">    this.<span class="constructor">$emit(&#x27;<span class="params">addItem</span>&#x27;, <span class="params">this</span>.<span class="params">name</span>)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="operator"></span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="operator"></span>&lt;Parent @addItem=&#123;addItem&#125; /&gt;</span><br><span class="line">methods: &#123;</span><br><span class="line">  add<span class="constructor">Item(<span class="params">val</span>)</span> &#123;</span><br><span class="line">    console.log(<span class="keyword">val</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="operator"></span></span><br><span class="line"><span class="operator"></span></span><br><span class="line"><span class="operator">* </span>兄弟节点传值:</span><br><span class="line"><span class="keyword">new</span> <span class="constructor">Vue()</span>;<span class="operator"></span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="operator"></span>A节点:</span><br><span class="line">eventBus.<span class="constructor">$on(&#x27;<span class="params">addItem</span>&#x27;, <span class="params">name</span> =&gt; <span class="params">console</span>.<span class="params">log</span>(<span class="params">name</span>)</span>)<span class="operator"></span></span><br><span class="line"><span class="operator">...</span></span><br><span class="line"><span class="operator"></span>eventBus.<span class="constructor">$off(&#x27;<span class="params">addItem</span>&#x27;)</span></span><br><span class="line"></span><br><span class="line">B节点:</span><br><span class="line">eventBus.<span class="constructor">$emit(&#x27;<span class="params">addItem</span>&#x27;, <span class="params">this</span>.<span class="params">name</span>)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="12"><li>props 与 data 谁优先级高</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><ol start="13"><li>vue 路由模式</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hash</span></span><br><span class="line"><span class="built_in">history</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="13"><li>模式与环境变量</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.env</span><span class="selector-class">.development</span></span><br><span class="line">  VUE_APP_TITLE: <span class="string">&#x27;VUE&#x27;</span></span><br><span class="line">  VUE_APP_ENV: <span class="string">&#x27;dev&#x27;</span></span><br><span class="line">  VUE_APP_BASE_API: <span class="string">&#x27;http://localhost:3000/api&#x27;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="selector-class">.env</span><span class="selector-class">.production</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">使用</span><br><span class="line">process<span class="selector-class">.env</span>.VUE_APP_BASE_API</span><br></pre></td></tr></table></figure><ol start="14"><li>跨域</li></ol><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">前端</span><br><span class="line">dev-sever</span><br><span class="line"></span><br><span class="line">服务端</span><br><span class="line">  - nginx</span><br><span class="line">  proxy_pass</span><br><span class="line">  </span><br><span class="line">  - nodeJs 服务</span><br><span class="line">  router.<span class="keyword">all</span>(<span class="string">&#x27;*&#x27;</span>, <span class="keyword">function</span>(req, res, next) &#123;</span><br><span class="line">    res.<span class="keyword">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, *);</span><br><span class="line">    res.<span class="keyword">header</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, *);</span><br><span class="line">    res.<span class="keyword">header</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>);</span><br><span class="line">    res.<span class="keyword">header</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json;charset=urf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    next()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="15"><li>MVVM 与 MVC 的区别</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MVC</span><br><span class="line">模型、视图、控制器</span><br><span class="line"></span><br><span class="line">MVVM</span><br><span class="line">模型、视图、<span class="keyword">vm</span></span><br><span class="line"><span class="keyword">vm</span> 作为模型、视图桥梁，当模型层数据改变，<span class="keyword">vm</span> 会监测到并通知视图层进行相应的修改</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>Vue核心</strong></p><ul><li>数据驱动<ul><li>单向数据流<ul><li>props</li><li>$emit 事件派发</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eventBus.$on(<span class="string">&#x27;addItem&#x27;</span>, <span class="variable language_">this</span>.<span class="property">handleItemAdd</span>)</span><br><span class="line">eventBus.$emit(<span class="string">&#x27;addItem&#x27;</span>, <span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">eventBus.$off(<span class="string">&#x27;addItem&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li>组件化<ul><li>代码复用、维护性好</li></ul></li></ul><p><strong>生命周期执行顺序</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate  <span class="comment">// 组件实例刚创建，组件属性计算之前</span></span><br><span class="line">created       <span class="comment">// 组件实例创建完成，属性已绑定</span></span><br><span class="line"></span><br><span class="line">beforeMount   <span class="comment">// 模版编译/挂载前</span></span><br><span class="line">mounted       <span class="comment">// 模版编译/挂载后</span></span><br><span class="line"></span><br><span class="line">beforeUpdate  <span class="comment">// 更新后</span></span><br><span class="line">updated       <span class="comment">// 更新前</span></span><br><span class="line"></span><br><span class="line">activated   <span class="comment">// for keep-alive</span></span><br><span class="line">deactivated <span class="comment">// for keep-alive</span></span><br><span class="line"></span><br><span class="line">beforeDestory  <span class="comment">// 销毁前</span></span><br><span class="line">destory        <span class="comment">// 销毁后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// parent   created</span></span><br><span class="line"><span class="comment">// children created</span></span><br><span class="line"><span class="comment">// children mounted</span></span><br><span class="line"><span class="comment">// parent   mounted</span></span><br></pre></td></tr></table></figure><p><strong>computed</strong></p><ul><li>基于响应式依赖进行缓存<ul><li>getter</li><li>setter</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  <span class="attr">site</span>: &#123;</span><br><span class="line">    <span class="comment">// getter</span></span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// setter</span></span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">newValue</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">name</span> = newValue.<span class="title function_">toLowercase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>支持缓存</li><li>监听实例上 data 及 props 传递过来的值</li><li>Vue 实例化时自动执行</li></ul><p><strong>watch</strong></p><ul><li>支持异步</li><li>不支持缓存</li><li>监听实例上 data 及 props 传递过来的值</li><li>检测到数据变化自动执行</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jahaw&#x27;</span>,</span><br><span class="line">    <span class="attr">info</span>: &#123;</span><br><span class="line">      <span class="attr">age</span>: <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">watch</span>: &#123;</span><br><span class="line">  <span class="comment">// 监听适用基本数据类型</span></span><br><span class="line">  <span class="title function_">name</span>(<span class="params">newVal, oldVal</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name&#x27;</span>, newVal, oldVal)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 监听引用类型</span></span><br><span class="line">  <span class="attr">info</span>: &#123;</span><br><span class="line">    <span class="attr">handler</span>: <span class="keyword">function</span>(<span class="params">newVal, oldVal</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;info&#x27;</span>, newVal, oldVal)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">deep</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>methods</strong></p><ul><li>需手动触发执行</li><li>不支持缓存</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">increament</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">number</span>++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>filter</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filter</span>: &#123;</span><br><span class="line">  <span class="attr">reverse</span>: <span class="function"><span class="params">val</span> =&gt;</span> val.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>class动态绑定</strong></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">:class=&quot;&#123; &#x27;active&#x27;:</span> active &#125;&quot;</span><br></pre></td></tr></table></figure><blockquote><p>Vue状态是异步更新 若要在数据变化后修改DOM，应在<code>Vue.nextTick</code>事件回调中操作</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">push</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>())</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;len&#x27;</span>, <span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>keep-alive组件缓存</strong></p><ul><li>activated 钩子，执行 mounted 逻辑(第二次或第N次进入组件，仅执行activated 生命周期函数)</li><li>deactivated 定时器的销毁</li></ul><p><strong>slot插槽</strong></p><ul><li>通过类名插入数据</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&#x27;list-slot&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&#x27;item-slot&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">list-slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">item-slot</span>&gt;</span>Vue<span class="tag">&lt;/<span class="name">item-slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">list-slot</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>作用域插槽</li></ul><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">current-user</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span>=<span class="string">&quot;&#123; user &#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">&#123;&#123; <span class="name">user.age</span> &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">current-user</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">:user</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ul><li>具名插槽</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>动态组件</strong><br><component :is="MyText"></component></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">components</span>: &#123;</span><br><span class="line">  <span class="title class_">MyText</span>,</span><br><span class="line">  <span class="title class_">MyVideo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>异步组件</strong></p><ul><li>import()</li></ul><p><strong>mixin</strong></p><ul><li>抽离组件公共逻辑</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mixin.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Jahaw&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;公共mounted&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// a.vue</span></span><br><span class="line"><span class="keyword">import</span> mixin <span class="keyword">from</span> <span class="string">&#x27;./mixin&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">mixins</span>: [mixin]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ref</strong></p><ul><li>获取组件挂载后真实dom</li></ul><p><strong>vuex</strong></p><ul><li>多个组件共享数据或者是跨组件传递数据</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="import-meta">import.meta</h2><p>使用 vite 做为构建工具，可以通过 <code>import.meta</code>获取对应方法方便快速的处理业务</p><h3 id="环境变量获取">环境变量获取</h3><p><code>import.meta.env</code></p><pre><code>// console.log(import.meta.env)&#123;    &quot;BASE_URL&quot;: &quot;/&quot;,    &quot;MODE&quot;: &quot;development&quot;,    &quot;DEV&quot;: false,    &quot;PROD&quot;: true,    &quot;SSR&quot;: false&#125;</code></pre><p>注意：</p><p>配合<code>.env</code>/<code>.env.development</code>/<code>.env.production</code>等文件设置环境变量使用时，变量<code>Key</code>应该以<code>VITE_</code>为前缀</p><pre><code>&#123;  &quot;script&quot;:&#123;    &quot;dev&quot;: &quot;vite --mode development&quot;  &#125;&#125;</code></pre><blockquote><p>为了防止意外泄漏 env 变量给客户端，只有以 VITE_为前缀的变量才会暴露给 Vite 处理的代码。只会向您的客户端源代码 VITE_SOME_KEY 公开 import.meta.env.VITE_SOME_KEY，但 DB_PASSWORD 不会。</p></blockquote><h3 id="批量处理文件">批量处理文件</h3><p><code>import.meta.globEager</code></p><pre><code>// 读取当前目录下的所有 .ts文件const modules = import.meta.globEager('./**/*.ts')</code></pre><h2 id="ref-和-reactive">ref 和 reactive</h2><p>都可以用来定义响应式数据</p><h3 id="ref">ref</h3><p>主要用于定义基本类型，使用时需要通过 <code>.value</code> 读取或修改</p><p>基本类型：除去 Object，包括：<code>String</code>、<code>Number</code>、<code>boolean</code>、<code>null</code>、<code>undefined</code></p><p>控制台打印数据结构为 <code>RefImpl</code></p><pre><code>// refconst count = ref(0)count.value++console.log(count.value)</code></pre><p>在定义基本类型时，响应式原理是与 vue2.x 类似的 <code>Object.defineProperty()</code>，通过 <code>get</code>、 <code>set</code>读取、修改数据</p><p>不过，ref 也可以定义引用类型的数据，注意，当定义引用类型时，其内部实现则是借助 reactive</p><p>可以通过打印数据在控制台查看结构，分别为：<code>RefImpl</code>、<code>Proxy</code></p><h3 id="reactive">reactive</h3><p><strong>只能</strong>定义引用类型，即 Object，包括：<code>Object</code>、<code>Array</code>、<code>Date</code>、<code>function</code>，定义基本类型时会警告</p><p>使用时，直接通过属性读写</p><pre><code>// reactiveconst state = reactive(&#123;count:0&#125;)state.count++console.log(state.value)</code></pre><p>reactive 默认对对象内的所有属性都进行响应式处理，并可以实现深层监听</p><p>该响应式能力是通过 <code>ES6 Proxy</code>实现的，其可以做到对属性的<strong>新增</strong>、<strong>删除</strong>监听，解决了 <code>defineProperty</code>的缺陷，并且对嵌套属性有着良好的支持，可以轻松实现 <code>a.b.c.d=xx</code>的响应式更新</p><blockquote><p><code>Proxy</code>与 <code>Reflect</code>均为 ES6 语法，一般他俩是一起配合使用，可以很好的做到安全优雅的对属性做出劫持更新</p></blockquote><h3 id="小结">小结</h3><p>模板 tempalte 会自动解包，在模板中使用时，不需要 <code>.value</code></p><p>对于<em>引用类型</em>来说，简单理解即：<strong>ref 本质也是 reactive，ref(obj)等价于 reactive({value: obj})</strong>，<code>ref</code> 的底层实现就是 <code>reactive</code></p><p>可以发现，所谓响应式其实就是对属性的劫持</p><p><code>ref</code>和<code>reactive</code>定义的数据，每一层都是响应式的</p><h2 id="watch、watchEffect">watch、watchEffect</h2><p>监听响应式数据的变化</p><h3 id="watch">watch</h3><p>基本语法和 vue2 类似，不过在这里有一些不同的使用方式</p><h4 id="监听-ref-定义的响应式数据（基本类型）">监听 ref 定义的响应式数据（基本类型）</h4><ul><li><p>函数式写法需要 <code>.value</code>，监听的是一个值的变化</p><p>const count = ref(0);<br>const str = ref(‘abc’);</p><p>// 1. 普通写法<br>// watch 可以省略 .value<br>watch(count, (val, old) =&gt; console.log({ val, old }));</p><p>// 2. 函数写法<br>watch(<br>() =&gt; count.value,<br>(val, old) =&gt; console.log({ val, old }),<br>);</p><p>// 3. 数组写法<br>watch(<br>() =&gt; [count.value, str.value],<br>(val, old) =&gt; console.log({ val, old }),<br>);</p></li></ul><h4 id="监听-ref-定义的响应式数据（引用类型）">监听 ref 定义的响应式数据（引用类型）</h4><ul><li><p>需明白的是，<code>ref</code>定义引用类型，内部是使用 <code>reactive</code>实现的，因此，需要通过 <code>.value</code>拿到响应式对象，再进行属性监听</p><p>const refState = ref({<br>count: 0,<br>str: ‘abc’,<br>});<br>// 1. 普通写法，无效<br>// =&gt; refState.value 有效<br>watch(refState, (val, old) =&gt; console.log({ val, old }));<br>// 2. 函数写法<br>watch(<br>() =&gt; refState.value.count,<br>(val, old) =&gt; console.log({ val, old }),<br>);</p></li></ul><h4 id="监听-reactive-定义的响应式数据">监听 reactive 定义的响应式数据</h4><ul><li><p>需要针对属性监听 <code>state.count</code></p><p>const state = reactive({<br>count: 0,<br>str: ‘abc’,<br>a: {<br>b: {<br>c: ‘a-b-c’,<br>},<br>},<br>});</p><p>// 1. 普通写法<br>// 结果：val, old 新旧值相同，<br>// watch(state, (val, old) =&gt; console.log({ val, old }));</p><p>// 2. 函数写法<br>// 结果：指定属性变化才会触发<br>watch(<br>() =&gt; state.value.a.b.c, // 只监听指定的 属性<br>(val, old) =&gt; console.log({ val, old }),<br>);</p></li></ul><h3 id="watchEffect">watchEffect</h3><p>接收一个函数，不需要设置监听对象，该方法会自动接管函数内部使用到的依赖，当依赖发生更新时，触发该函数执行</p><p>该函数会初始化默认执行一次</p><pre><code>watchEffect(()=&gt;&#123;  if(state.count&gt;1)&#123;    // 只要 count变化，这个 watchEffect函数就会执行一次    // 当 count &gt; 1时，做对应行为  &#125;&#125;)</code></pre><h3 id="watch、watchEffect-小结">watch、watchEffect 小结</h3><p>使用<code>watch</code>时，需要考虑的情况比较多</p><p><code>watch</code>更强调结果，<code>watchEffect</code>强调过程</p><p>就用法方面来说 <code>watchEffect</code>似乎更简单易用~</p><h2 id="shallowRef-和-shallowReactive">shallowRef 和 shallowReactive</h2><ul><li>递归监听和非递归监听</li></ul><p><code>ref</code>和<code>reactive</code>都属于递归监听，也就是数据的每一层都是响应式的，如果数据量比较大，非常消耗性能，非递归监听只会监听数据的第一层。</p><h2 id="script-setup-写法的-props-、context-处理方式">script setup 写法的 props 、context 处理方式</h2><p>在以 <code>&lt;script setup lang=&quot;ts&quot;&gt;</code>形式使用 setup 时，默认整个 script 都是 setup 的函数作用域，我们不必再一一 <code>return</code>定义的每个变量和方法，可以直接使用</p><p>但，对于 <code>props</code>、<code>emit</code>的定义，以及 <code>ctx</code>属性的获取问题</p><p>vue 也针对此，为我们提供了 3 个新 API</p><ul><li><p><code>defineProps</code></p></li><li><p><code>defineEmit</code></p></li><li><p><code>useContext</code></p><p>// 这 3 个 api 和 setup 的属性一一对应<br>setup(props, { emit, ctx}){}</p></li></ul><p>如果想通过父组件获取子组件的属性，需要在子组件中通过 <code>defineExpose</code>定义需要暴露的属性</p><pre><code>// 子组件 Childconst count = ref(0)defineExpose(&#123;  count,&#125;);// 父组件// &lt;Child ref=&quot;ChildRef&quot; /&gt;const ChildRef = ref&lt;RefType&lt;&#123; count: number &#125;&gt;&gt;(0);const count = ChildRef.value.count</code></pre><p>更多 API 见官方文档，说的很详细，这里就不再赘述了</p><h2 id="props-Type-类型定义问题">props Type 类型定义问题</h2><p>抛开 vue 默认的几种基本类型，在一些特殊场景需要定义比较复杂的类型，需要通过 <code>PropType</code> 配合使用</p><p>如定义菜单路由类型</p><pre><code>props: &#123;    menuData: &#123;        type: Array as PropType&lt;MenuDataItem[]&gt;,        default: () =&gt; [],    &#125;,&#125;</code></pre><p>这里如果按照常规类型 <code>Array</code>很难满足我们的需求（只知道是个数据，但是数据形状并不清楚），原始类型写法很难精确推导各属性的类型定义</p><h2 id="prop、ref、emit-数据通信">prop、ref、emit 数据通信</h2><h3 id="prop">prop</h3><p>强调单项数据流（父=&gt;子），类似 react，主要用来传参给子组件</p><h3 id="ref-2">ref</h3><p>两种用法：</p><ul><li><p>以引用的方式把子组件的实例指给 <code>ref</code>，使得可以在父组件中获取到子组件中的所有属性和方法，可以通过配合 <code>defineExpose</code> API 来实现</p></li><li><p>用于获取 DOM 元素</p><p>// 如：在使用 echarts 绑定 DOM 节点时<br>// <div class="chart-box" ref="chartRef"></div></p><p>const chartRef = ref&lt;HTMLDivElement | null&gt;(null);<br>echarts.init(unref(chartRef))</p></li></ul><h3 id="emit">emit</h3><p>主要用于子组件向父组件传递参数和通信<code>emit</code>（子=&gt;父），父组件通过事件方法<code>@event</code>接收</p><pre><code>&lt;!-- 父组件 --&gt;emit('getMessage', '我是父组件！')&lt;!-- 子组件 --&gt;&lt;child @event=&quot;handleMethod&quot;&gt;</code></pre><h2 id="jsx-语法">jsx 语法</h2><p>在使用的过程中发现，jsx 配合模板语法有着极大的灵活性，对于 jsx 语法，有 react 开发经验的应该会感到很熟悉，开发体验上很相似</p><p>但是，对于 vue 来说，有着得天独厚的的优势，它本身作为模板语法，通过对实例方法的注入，指令的使用等，可以快速而高效的进行开发，在一些场景下， jsx 语法 + vue 模板语法有着完全不同的体验~</p><blockquote><p>如：在模板中可以 <code>&lt;div @click=&quot;$router.push('xx')&quot; v-auth=&quot;create&quot;&gt;&lt;/div&gt;</code></p></blockquote><h3 id="Table-组件">Table 组件</h3><p>以比较常见的 table 组件为例，我们封装好可复用的分页逻辑后，再把 <code>columns</code>单出拆分出来用，使用 jsx 语法封装，根据不同组件使用做不同的配置，这样也更方便维护</p><pre><code>export function columnsConfig(refresh: () =&gt; void) &#123;  // ... 其他业务逻辑  const columns: ColumnProps[] = [    &#123;      title: 'IP地址和端口',      dataIndex: 'ip',      width: 150,      customRender: (&#123; record &#125;) =&gt; `$&#123;record.ip&#125;:$&#123;record.port&#125;`,    &#125;,    &#123;      title: '操作',      key: 'action',      width: 200,      fixed: 'right',      customRender: (&#123; record &#125;) =&gt;        &lt;Space&gt;          &lt;Button type=&quot;primary&quot; onClick=&#123;() =&gt; router.push(`/app/product/detail/$&#123;record.id&#125;`)&#125;&gt;详情&lt;/Button&gt;          &lt;Divider type=&quot;vertical&quot; /&gt;          &#123;            record.isSelf &amp;&amp; &lt;Popconfirm              title=&quot;你确定要退出网络吗？&quot;              onConfirm=&#123;async () =&gt; &#123;                const res = await fetchApi.delete(record.id);                if (res) &#123;                  message.success(`已申请退出网络`);                  // 触发列表更新                  refresh?.();                &#125;              &#125;&#125;            &gt;              &lt;Button&gt;删除&lt;/Button&gt;            &lt;/Popconfirm&gt;          &#125;        &lt;/Space&gt;    &#125;,  ];  return columns;&#125;</code></pre><p>当 action 操作列 业务比较复杂时，需要频繁的和其他数据通信，我们也可以把 action 操作列剥离出，在 vue 内部处理，再配合 Table 组件的再封装处理</p><p>Table 组件封装</p><pre><code>&lt;template&gt;  &lt;a-table :columns=&quot;columns&quot;&gt;    &lt;!-- 函数式写法自定义 操作列 --&gt;    &lt;template #action=&quot;&#123; record &#125;&quot;&gt;      &lt;template v-for=&quot;(action, index) in getActions&quot; :key=&quot;`$&#123;index&#125;-$&#123;action.label&#125;`&quot;&gt;        &lt;!-- 气泡确认框 --&gt;        &lt;a-popconfirm          v-if=&quot;action.enable&quot;          :title=&quot;action?.title&quot;          @confirm=&quot;action?.onConfirm(record)&quot;          @cancel=&quot;action?.onCancel(record)&quot;        &gt;          &lt;a @click.prevent=&quot;() =&gt; &#123;&#125;&quot; :type=&quot;action.type&quot;&gt;&#123;&#123; action.label &#125;&#125;&lt;/a&gt;        &lt;/a-popconfirm&gt;        &lt;!-- 按钮 --&gt;        &lt;a v-else @click=&quot;action?.onClick(record)&quot; :type=&quot;action.type&quot;&gt;&#123;&#123; action.label &#125;&#125;&lt;/a&gt;        &lt;!-- 分割线 --&gt;        &lt;a-divider type=&quot;vertical&quot; v-if=&quot;index &lt; getActions.length - 1&quot; /&gt;      &lt;/template&gt;    &lt;/template&gt;  &lt;/a-table&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot;&gt;// action 操作列const getActions = computed(() =&gt; &#123;  return (toRaw(props.actions) || [])    .filter((action) =&gt; hasPermission(action.auth))    .map((action) =&gt; &#123;      const &#123; popConfirm &#125; = action;      return &#123;        type: 'link',        ...action,        ...(popConfirm || &#123;&#125;),        enable: !!popConfirm,      &#125;;    &#125;);&#125;);&lt;/script&gt;</code></pre><p>使用</p><pre><code>// &lt;Table :columns=&quot;columns&quot; :actions=&quot;tableActions&quot;/&gt;export const columns = [  // ...  &#123;    title: '操作',    key: 'action',    width: 120,    slots: &#123; customRender: 'action' &#125;,  &#125;,]const tableActions = ref([  &#123;    label: '编辑',    auth: AuthEnum.user_update, // 配置按钮权限    onClick: async (row) =&gt; &#123;      modalState.visible = true;      const res = await store.fetchDetail(row.id);      if (res) formModel.value = res;    &#125;,  &#125;  // ...]</code></pre><p>这是我在上个项目中实战使用的一点心得，对于开发效率提升还是很明显的，维护起来也是很方便，更多用法也欢迎大家一起交流学习，就目前体验来说 vue3 很棒~</p><h2 id="event-bus">event bus</h2><p>vue3 中移除了实例中挂载 <code>$emit</code>的行为，如果想继续使用可以单独下载对应的 npm 包，如：<a href="https://link.segmentfault.com/?enc=q0f5aUcEdJY8EUyLDg2RGA%3D%3D.fnCmjvlwXezrvuQeuV%2BoqFYejESjlIpkvju8B%2F8RuW81iUjOJh4WJFao7WDyADtu">mitt</a>，该包很轻量，仅 200byte</p><p>api 与用法类似，只是改变为了函数式创建，需要确保单个操作的 emitter 创建唯一</p><pre><code>import mitt from 'mitt'const emitter = mitt()export emitter</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>Vue双向绑定的实现</strong></p><ul><li>数据劫持<ul><li>通过 Object.defineProperties() 对data的每个属性进行了get、set的拦截</li></ul></li><li>发布订阅<ul><li>在数据变动时发布消息给订阅者，出发相应的监听回调</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">  姓名：&lt;input type=<span class="string">&#x27;text&#x27;</span> v-model=<span class="string">&#x27;name&#x27;</span> /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">constructor</span>(<span class="params">&#123; el, data &#125;</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(el, data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">el</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(el)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 初始化data</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="title function_">initData</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 初始化model</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="title function_">initModel</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">initData</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="variable language_">this</span>.<span class="property">data</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[key, value]</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">const</span> val = value;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, key, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">configurable</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">enumerable</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> val;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">set</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            val = newVal</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">initModel</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 获取订阅者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> nodes = <span class="variable language_">this</span>.<span class="property">el</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;[v-model&#x27;</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      nodes.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">const</span> key = item.<span class="title function_">getAttribute</span>(<span class="string">&#x27;v-model&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 初始化 input 默认值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        item.<span class="property">value</span> = <span class="variable language_">this</span>[key];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 绑定 input 事件监听，来设置反向设置 data属性</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        item.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>[key] = evt.<span class="property">target</span>.<span class="property">value</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 实例化</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">data</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">name</span>: <span class="string">&#x27;Jahaw&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 订阅者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">watchers</span> = [];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 添加观察者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">addWatcher</span>(<span class="params">watcher</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">watchers</span>.<span class="title function_">push</span>(watcher)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 通知</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">watchers</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">watcher</span> =&gt;</span> watcher.<span class="title function_">update</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 观察者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">constructor</span>(<span class="params">callback</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">callback</span> = callback;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;update&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="title function_">callback</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 创建订阅者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 创建观察者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> watcher1 = <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;watcher1&#x27;</span>))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> watcher2 = <span class="keyword">new</span> <span class="title class_">Watcher</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;watcher2&#x27;</span>))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 添加观察者</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    dep.<span class="title function_">addWatcher</span>(watcher1)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    dep.<span class="title function_">addWatcher</span>(watcher2)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 触发通知</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    dep.<span class="title function_">notify</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>环境</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;react&quot;</span>: <span class="string">&quot;^17.0.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;react-router-dom&quot;</span>: <span class="string">&quot;^5.2.0&quot;</span>,</span><br></pre></td></tr></table></figure><h1>路由列表</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; lazy &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routerList = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="comment">// 路径</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;首页&quot;</span>, <span class="comment">// 名字</span></span><br><span class="line">    <span class="attr">exact</span>: <span class="literal">true</span>, <span class="comment">// 精准匹配</span></span><br><span class="line">    <span class="attr">component</span>: <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../page/main/index&#x27;</span>)) <span class="comment">// 懒加载方案</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">    <span class="attr">exact</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../page/user/index&#x27;</span>)),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/user/userList&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;用户列表&quot;</span>,</span><br><span class="line">        <span class="attr">exact</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../page/user/userList/index&#x27;</span>)),</span><br><span class="line">        <span class="attr">routes</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/user/userList/userDetail&quot;</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;用户详情&quot;</span>,</span><br><span class="line">            <span class="attr">exact</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../page/user/userList/userDetail/index&#x27;</span>)),</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> routerList;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>组装</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span>, <span class="title class_">Route</span>, <span class="title class_">Switch</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Suspense</span>, <span class="title class_">Fragment</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> routerList <span class="keyword">from</span> <span class="string">&#x27;./routerList&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomRoute</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="comment">// 递归方法</span></span><br><span class="line">  routerListRecursion = <span class="function">(<span class="params">routerList</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(routerList).<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; path, exact, routes, component: LazyComponent &#125;, key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> newItem = &#123; path, exact, routes &#125;;</span><br><span class="line">      <span class="keyword">if</span> (routes &amp;&amp; routes.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">Fragment</span> <span class="attr">key</span>=<span class="string">&#123;</span>`<span class="attr">fragment</span>$&#123;<span class="attr">key</span>&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">key</span>=<span class="string">&#123;key&#125;</span> &#123;<span class="attr">...newItem</span>&#125; <span class="attr">render</span>=<span class="string">&#123;(props)</span> =&gt;</span> <span class="tag">&lt;<span class="name">LazyComponent</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span>&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span> // 为方便组件之间的传参 利用render</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Switch</span> <span class="attr">key</span>=<span class="string">&#123;</span>`<span class="attr">switch</span>$&#123;<span class="attr">key</span>&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;this.routerListRecursion(routes)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">key</span>=<span class="string">&#123;key&#125;</span> &#123;<span class="attr">...newItem</span>&#125; <span class="attr">render</span>=<span class="string">&#123;(props)</span> =&gt;</span> <span class="tag">&lt;<span class="name">LazyComponent</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span>&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">span</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;&gt; // Lazy要求有的Loading组件</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;this.routerListRecursion(routerList)&#125; // 执行递归方法</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">CustomRoute</span>;</span><br></pre></td></tr></table></figure><h1>挂载</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CustomRoute</span> <span class="keyword">from</span> <span class="string">&#x27;./router/index&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">CustomRoute</span>/&gt;</span></span>,</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>临时问题</p><p>PC<br>1. 任务导出后，重新调用拉取任务接口</p><p>小程序<br>1. rpx 动态像素（微信将屏幕宽度分为750rpx）</p><p>uni-app、uview</p><p>taro、taro-ui</p><p>nacobase<br>奥哲穿云<br>宜搭</p><p>ClickPass<br>图表设计器<br>打印设计器</p><p>前端提效类</p><p>数据可视化：<br>Hertzbeat<br><a href="http://osrc.com">osrc.com</a><br>1. go-view<br>2. DataGear<br>3. smartChart<br>4. vue-big-screen-plugin<br>5. Flyfish</p><p>FlyFish</p><p>总结：<br>datart是个自助分析，易用性和灵活性高。datagear适合java项目，二次开发。<br>ajreport适合开发人员使用</p><p>dsback<br>宝塔</p><p>低代码平台<br>Appsmith<br>PagePlug</p><p>快速滚动空白列表问题<br>频繁滚动计算 渲染性能下降</p><p>vercel</p><p>小程序setData数据量过大问题处理？<br>小程序内页面内跳转方式：<br><a href="https://www.cnblogs.com/liuqingxia/p/7844937.html">https://www.cnblogs.com/liuqingxia/p/7844937.html</a><br>小程序发布注意事项：<br><a href="https://zhuanlan.zhihu.com/p/34793110">https://zhuanlan.zhihu.com/p/34793110</a></p><p>1. 已发布的表不支持修改<br>确认要保留以前哪些字段？<br>仅在编辑时保留</p><p>vant weapp</p><p>lerna</p><p>微信小程序转taro: <br>npm i -g @tarojs/cli <br>taro convert</p><p>微信小程序转uni-app</p><p>打包优化（静态宜园，无变化不参与二次打包）<br>分包策略</p><p>raptor<br>js error<br>remax 小程序框架</p><p>一、StackOverFlow<br>二、Medium<br>三、ChinaUnix<br>四、Code Project<br>五、Codeforces</p><p>表单设计器：<br>1. 通过(按钮+弹窗)配置表单项，具体数据来源（将x-render功能模块迁移过来）<br>2. 弹窗中如何获取当前form实例？</p><p>运行态表单项联动：<br>左侧实现自定义业务组件<br>右侧面板新增字段依赖项，给自定义组件配置 dependencies<br>1. 控制兄弟表单项显示隐藏<br>2. 设置其他表单项value 或 datasource<br>3.</p><p>表单视图配置：<br>1. 条件<br>2. 操作按钮（标识与逻辑 Mapping）</p><p>&amp;：生成子类型</p><p>｜：生成父类型</p><p>omit：以一个类型为基础支持剔除某些属性，然后返回一个新类型</p><p>interface只能定义对象类型</p><p>keyof： 帮助我们获取某种类型的所有键，返回的是一个联合类型</p><p>exclude： 找出Type的“差集”，就是将类型A与B对比，返回A中独有的类型。</p><p>extends:</p><p>pick：拣选属性，将 Type 的部分类型 Keys 挑出来，返回这部分类型。</p><p>partial<Type><br>作用：它会将Type内所有属性置为可选，返回一个给定类型Type的子集</p><p>泛型</p><p>运行态<br>遍历字段列表 渲染表单元素<br>Form.setValues设置表单项值</p><p>遍历视图绑定的按钮列表，根据按钮类型执行预设的业务逻辑</p><p>设计态<br>建表，新增字段<br>视图配置：<br>1. 配置字段项 必填、只读、隐藏等属性<br>2. 配置按钮</p><p>setting-form<br>1. components<br>2. effects<br>3. scope</p><p>根据表单配置的联动列表<br>1. 获取条件字段<br>2. 获取联动结果（每个联动项在满足指定条件时，设置被联动字段状态：显示隐藏、是否必填、是否启用、数据状态等）<br>3. 更新数据联动到schema</p><p>本文介绍全球排名前 3 的开源低代码开发平台<br>* AppSmith - 前端极度灵活，支持多数据源接入<br>* Budibase - 内置自动化流程触发器工具，与第三方连接，企业级 IFTTT<br>* ToolJet - 拥有丰富多样的可接入数据源及第三方工具调用</p><p>国内主流低代码平台：<br>1. 钉钉<br>2. 卡拉云<br>3. 简道云<br>4. 氚云<br>5. 明道云<br>6.</p><p>多人协作画板</p><p><a href="https://www.cnblogs.com/huayang1995/p/15905991.html">https://www.cnblogs.com/huayang1995/p/15905991.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="React中的受控组件和非受控组件">React中的受控组件和非受控组件</h3><p>[<a href="https://juejin.cn/post/7020980474025607205">https://juejin.cn/post/7020980474025607205</a>]</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="Command-Line-Interface">Command Line Interface</h3><ul><li>npx create-react-app my-react-app</li><li>npx run eject: 生成可配置的模板(用来自定义项目配置)<br><a href="http://www.cnblogs.com/ye-hcj/p/7191153.html">配置项目介绍</a></li></ul><h3 id="无障碍辅助功能-（Accessibility-a11y">无障碍辅助功能 （Accessibility/a11y)</h3><ul><li>aria-* props 以服务屏幕朗读器用户</li><li></li></ul><h3 id="打包工具">打包工具</h3><ul><li>Webpack</li><li>Rollup</li><li>Browserify</li></ul><h3 id="代码分割">代码分割</h3><ul><li>打包<ul><li>一个将文件引入并合并到一个单独文件的过程，最终形成一个 “bundle”</li></ul></li><li>代码分割<ul><li>代码分割<ul><li>import: 导入由另一个模块导出的绑定</li><li>动态 import()</li><li>React.lazy/Suspense/fallback</li><li>命名导出（Named Exports）</li></ul></li></ul></li></ul><h3 id="Context">Context</h3><blockquote><p>Context 提供了一个无需为每层组件手动添加 props，就能在组件树间进行数据传递的方法</p></blockquote><ul><li>为了共享那些对于一个组件树而言是“全局”的数据<ul><li>谨慎使用，这会使得组件的复用性变差</li></ul></li><li>API</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置默认值</span></span><br><span class="line"><span class="keyword">const</span> defaultValue = <span class="string">&#x27;light&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(defaultValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件会从组件树中离自身最近的那个匹配的 Provider 中读取到当前的 context 值，否则 defaultValue 生效</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&quot;dark&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// 在函数式组件中完成订阅 context</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  &#123; value =&gt; (<span class="tag">&lt;<span class="name">HGroup</span>&gt;</span>&#123; value &#125;<span class="tag">&lt;/<span class="name">HGroup</span>&gt;</span>) &#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">MyContext.Consumer</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="错误边界（Error-Boundaries）">错误边界（Error Boundaries）</h3><ul><li>一种 React 组件<ul><li>可以捕获并打印发生在其子组件树任何位置的 JavaScript 错误，并且，它会渲染出备用 UI</li></ul></li><li>在渲染期间、生命周期方法和整个组件树的构造函数中捕获错误</li><li>static getDerivedStateFromError() 或 componentDidCatch()</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 错误边界 组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 更新 state 使下一次渲染能够显示降级后的 UI</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidCatch</span>(<span class="params">error, errorInfo</span>) &#123;</span><br><span class="line">    <span class="comment">// 将错误日志上报给服务器</span></span><br><span class="line">    <span class="title function_">logErrorToMyService</span>(error, errorInfo);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; hasError &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">if</span> (hasError) &#123;</span><br><span class="line">      <span class="comment">// 你可以自定义降级后的 UI 并渲染</span></span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Something went wrong.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span>; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用</span></span><br><span class="line">&lt;<span class="title class_">ErrorBoundary</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">MyWidget</span> /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">ErrorBoundary</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><strong>无法捕获以下场景中产生的错误：</strong><br>事件处理（了解更多）<br>异步代码（例如 setTimeout 或 requestAnimationFrame 回调函数）<br>服务端渲染<br>它自身抛出来的错误（并非它的子组件）</p></blockquote><h3 id="未捕获错误（Uncaught-Errors）的新行为">未捕获错误（Uncaught Errors）的新行为</h3><ul><li>自 React 16 起，任何未被错误边界捕获的错误将会导致整个 React 组件树被卸载</li></ul><h3 id="Refs-转发">Refs 转发</h3><ul><li>HOC 中 refs 转发</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">logProps</span>(<span class="params">Component</span>) &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">LogProps</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params">prevProps</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;old props:&#x27;</span>, prevProps);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;new props:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">props</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;forwardedRef, ...rest&#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 将自定义的 prop 属性 “forwardedRef” 定义为 ref</span></span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> <span class="attr">ref</span>=<span class="string">&#123;forwardedRef&#125;</span> &#123;<span class="attr">...rest</span>&#125; /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注意 React.forwardRef 回调的第二个参数 “ref”。</span></span><br><span class="line">  <span class="comment">// 我们可以将其作为常规 prop 属性传递给 LogProps，例如 “forwardedRef”</span></span><br><span class="line">  <span class="comment">// 然后它就可以被挂载到被 LogProps 包裹的子组件上。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">LogProps</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">forwardedRef</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Fragments">Fragments</h3><ul><li>允许你将子列表分组，而无需向 DOM 添加额外节点</li><li>可用 <code>[]或&lt;&gt;&lt;/&gt;</code> 来表示</li></ul><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Glossary(props) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      </span><span class="language-xquery">&#123;</span></span><br><span class="line"><span class="language-xquery">        props.items.<span class="keyword">map</span>(<span class="type">item</span> =&gt; (</span></span><br><span class="line"><span class="language-xquery">        // 没有<span class="built_in">`key</span>`，React 会发出一个关键警告</span></span><br><span class="line"><span class="language-xquery">        &lt;React.Fragment<span class="built_in"> key</span>=&#123;<span class="type">item</span><span class="built_in">.id</span>&#125;</span><span class="language-xml">&gt;</span></span><br><span class="line"><span class="language-xml">          </span><span class="language-xml"><span class="tag">&lt;<span class="name">dt</span>&gt;</span></span><span class="language-xquery">&#123;<span class="type">item</span>.term&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          </span><span class="language-xml"><span class="tag">&lt;<span class="name">dd</span>&gt;</span></span><span class="language-xquery">&#123;<span class="type">item</span>.description&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line">      ))</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/dl&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="高阶组件">高阶组件</h3><ul><li>用于复用组件逻辑的一种高级技巧</li><li>一种基于 React 的组合特性而形成的设计模式</li><li><strong>高阶组件是参数为组件，返回值为新组件的函数</strong><ul><li>如上 logProps 函数</li></ul></li><li>HOC 是纯函数，无副作用</li></ul><h3 id="COMMAND-LINE-INTERTACE">COMMAND LINE INTERTACE</h3><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">npx</span> <span class="built_in">create-react-app</span> <span class="string">my-react-app</span></span><br><span class="line"><span class="string">npx</span> <span class="string">run</span> <span class="string">eject</span>: 生成可配置的模板(用来自定义项目配置)</span><br></pre></td></tr></table></figure><p><a href="http://www.cnblogs.com/ye-hcj/p/7191153.html">配置项目介绍</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>答题方式</strong></p><blockquote><p>采用 讲说理列 方法论</p></blockquote><p><strong>类组件与函数组件有什么区别</strong></p><ul><li><p>共同点</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.都可用作基础组件展示UI</span><br><span class="line"><span class="bullet">1.</span> </span><br></pre></td></tr></table></figure></li><li><p>本质上代表两种不同设计思想和心智模式</p><ul><li><p>类组件根基是OOP，面向对象编程</p><ul><li>有继承、有属性、有内部状态管理</li></ul></li><li><p>函数组件根基是FP，也就是函数式编程</p><ul><li>纯函数、相同输入、相同输出</li><li>无内部状态</li><li>通过组合实现更细粒度的逻辑控制与复用</li></ul></li></ul></li></ul><p>相较于类组件、函数组件更纯翠、简单、易测试</p><ul><li>未来趋势<ul><li>通过探索、时间切片与并发模式，以及考虑性能的进一步优化及更合理的代码拆分结构后，认为类组件不能很好的适应未来趋势（原因如下）<ul><li>this模糊性</li><li>因为逻辑散落在生命周期中</li><li>react组件缺少标准的代码拆分方式</li></ul></li></ul></li></ul><p><strong>如何设计React组件</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="React">React</h3><ul><li>一个用于构建用户界面(view)的JavaScript库<ul><li>react.js 是 React 的核心库</li><li>react-dom.js 是提供与 DOM 相关的功能</li><li>React-with-addons.js  用于实现类似数据双向绑定的扩展</li><li>Browser.js 的作用是将 JSX 语法转为 JavaScript 语法</li></ul></li></ul><blockquote><p>用 JavaScript <strong>构建快速响应的大型 Web 应用程序的首选方式</strong></p></blockquote><h3 id="JSX">JSX</h3><ul><li>JavaScript语法扩展</li><li>Babel 会把 JSX 转译成一个名为 React.createElement() 函数调用，并返回 React 元素</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;greeting&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Hello, world!</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line">等同于</span><br><span class="line"><span class="keyword">const</span> element = <span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">  <span class="string">&#x27;h1&#x27;</span>,</span><br><span class="line">  &#123;<span class="attr">className</span>: <span class="string">&#x27;greeting&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;Hello, world!&#x27;</span></span><br><span class="line">); </span><br><span class="line">最终返回结构(简化过的结构), 该对象称为 <span class="title class_">React</span> 元素</span><br><span class="line"><span class="keyword">const</span> element = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;h1&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">className</span>: <span class="string">&#x27;greeting&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>: <span class="string">&#x27;Hello, world!&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;   </span><br></pre></td></tr></table></figure><h3 id="元素渲染">元素渲染</h3><ul><li>React元素（不可变对象）<ul><li>描述你希望在屏幕上看到的内容，React 使用它们来构建DOM并保持随时更新</li></ul></li></ul><h3 id="函数组件与-class-组件">函数组件与 class 组件</h3><ul><li>封装起来的具有独立功能的UI部件</li><li>所有React 组件都必须像纯函数一样保护它们的 props 不被更改</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">ReactDOM</span>.</span></span>render<span class="literal">()</span>：该方法用于将模板转为HTML，并插入到指定的DOM节点。</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">React</span>.</span></span>createClass 方法就用于生成一个组件类</span><br><span class="line">例如：</span><br><span class="line"><span class="keyword">function</span> <span class="constructor">Welcome(<span class="params">props</span>)</span> &#123;</span><br><span class="line">  const &#123; name &#125; = props;</span><br><span class="line">  return &lt;h1&gt;Hello, &#123; name &#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">ReactDOM</span>.</span></span>render(</span><br><span class="line">  &lt;Welcome name=<span class="string">&quot;Sara&quot;</span> /&gt;,</span><br><span class="line">  document.get<span class="constructor">ElementById(&#x27;<span class="params">root</span>&#x27;)</span></span><br><span class="line">);</span><br><span class="line">分析：(注意)</span><br><span class="line"><span class="number">1.</span> 组件类只能包含一个顶层标签(即上面的id为root的元素)</span><br><span class="line">  <span class="number">2.</span> <span class="keyword">class</span>--&gt;className,<span class="keyword">for</span>--&gt;html<span class="constructor">For(<span class="params">class</span>和<span class="params">for</span>是JavaScript的保留字)</span></span><br></pre></td></tr></table></figure><h3 id="State">State</h3><ul><li>私有、完全受控于当前组件</li><li>合并更新、异步更新<ul><li>仅能影响当前以及低于自身的UI</li></ul></li><li><strong>自上而下</strong>或是<strong>单向</strong>的数据流</li><li>React 事件机制中是异步批量更新，setTimeout等异步操作中是同步操作</li></ul><h3 id="组件的生命周期：">组件的生命周期：</h3><p><strong>涉及到页面优化时应该在这些函数中做些事情</strong></p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">挂载阶段:</span><br><span class="line">constructor: 构造函数，最先被执行,我们通常在构造函数里初始化<span class="keyword">state</span>对象或者给自定义方法绑定this</span><br><span class="line">getDerivedStateFromProps(nextProps, prevState): 静态方法,接收到新的属性想去修改我们<span class="keyword">state</span>时使用</span><br><span class="line">render: render函数是纯函数，只返回需要渲染的东西，不应该包含其它的业务逻辑,可以返回原生的DOM、React组件、Fragment、Portals、字符串和数字、Boolean和null等内容</span><br><span class="line">componentDidMount: 组件装载之后调用，此时我们可以获取到DOM节点并操作，比如对canvas，svg的操作，服务器请求，订阅都可以写在这个里面，但是记得在componentWillUnmount中取消订阅</span><br><span class="line"></span><br><span class="line">更新阶段：</span><br><span class="line">getDerivedStateFromProps: 此方法在更新个挂载阶段都可能会调用</span><br><span class="line">shouldComponentUpdate(nextProps, nextState): 有两个参数nextProps和nextState，表示新的属性和变化之后的<span class="keyword">state</span>，返回一个布尔值，true表示会触发重新渲染，false表示不会触发重新渲染，默认返回true,我们通常利用此生命周期来优化React程序性能</span><br><span class="line">render: 更新阶段也会触发此生命周期</span><br><span class="line">getSnapshotBeforeUpdate(prevProps, prevState): 这个方法在render之后，componentDidUpdate之前调用，有两个参数prevProps和prevState，表示之前的属性和之前的<span class="keyword">state</span>，这个函数有一个返回值，会作为第三个参数传给componentDidUpdate，如果你不想要返回值，可以返回null，此生命周期必须与componentDidUpdate搭配使用</span><br><span class="line">componentDidUpdate(prevProps, prevState, snapshot): 该方法在getSnapshotBeforeUpdate方法之后被调用，有三个参数prevProps，prevState，snapshot，表示之前的props，之前的<span class="keyword">state</span>，和snapshot。第三个参数是getSnapshotBeforeUpdate返回的,如果触发某些回调函数时需要用到 DOM 元素的状态，则将对比或计算的过程迁移至 getSnapshotBeforeUpdate，然后在 componentDidUpdate 中统一触发回调或更新状态。</span><br><span class="line"></span><br><span class="line">卸载阶段：</span><br><span class="line">componentWillUnmount()：节点将被移除</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="./images/life-cycle-react.png" alt="react-life-cycle"></p><h3 id="事件处理">事件处理</h3><ul><li>事件的命名采用小驼峰式</li><li>使用 JSX 语法时你需要传入一个函数作为事件处理函数，而不是一个字符串</li><li>显示使用 preventDefault 阻止默认行为</li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">// 注意：class 的方法默认不会绑定 this</span><br><span class="line">class Toggle extends React.Component &#123;</span><br><span class="line"></span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    // 是否等价于 Parent.apply(this, arguments) ？</span><br><span class="line">    super(props);</span><br><span class="line">    this.<span class="keyword">state</span> = &#123; isToggleOn: true &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 事件对象 evt 以及更多的参数将会被隐式的进行传递</span><br><span class="line">  // handleClick(evt) &#123;</span><br><span class="line">  //   evt.preventDefault();</span><br><span class="line">  //   this.<span class="built_in">set</span>State(<span class="keyword">state</span> =&gt; (&#123;</span><br><span class="line">  //     isToggleOn: !<span class="keyword">state</span>.isToggleOn</span><br><span class="line">  //   &#125;));</span><br><span class="line">  // &#125;</span><br><span class="line">  </span><br><span class="line">  // 事件对象 evt 必须显式的进行传递</span><br><span class="line">  handleClick = evt =&gt; &#123;</span><br><span class="line">    evt.preventDefault();</span><br><span class="line">    this.<span class="built_in">set</span>State(<span class="keyword">state</span> =&gt; (&#123;</span><br><span class="line">      isToggleOn: !<span class="keyword">state</span>.isToggleOn</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; isToggleOn &#125; = this.<span class="keyword">state</span>;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">      <span class="variable">&lt;button onClick=&#123;this.handleClick&#125;&gt;</span></span><br><span class="line">        &#123; isToggleOn ? &#x27;ON&#x27; : &#x27;OFF&#x27; &#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="variable">&lt;Toggle /&gt;</span>,</span><br><span class="line">  document.getElementById(&#x27;root&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">react class 组建中 函数该如何优雅定义？</span><br><span class="line"><span class="number">1</span>. class field [Array Function way]</span><br><span class="line"><span class="number">2</span>. bind</span><br><span class="line"><span class="number">3</span>. 组建内部 () =&gt; this.fn(), 每次渲染重新绑定， 当作为 prop 传入子组建时会引发 子组建重新渲染</span><br><span class="line"></span><br><span class="line"><span class="comment"># class 中普通函数在 原型上，箭头函数在 对象上</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="条件渲染">条件渲染</h3><ul><li>元素变量</li><li>与运算符 &amp;&amp;</li><li>三木运算符 condition ? true : false<ul><li>阻止组建渲染</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">condition</span> ? <span class="operator">&lt;</span>Content<span class="operator">&gt;</span> : <span class="keyword">null</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> <span class="keyword">null</span> 不会影响组件的生命周期</span><br></pre></td></tr></table></figure></li></ul><h3 id="列表-key">列表 &amp; key</h3><h3 id="表单">表单</h3><ul><li>受控组件<ul><li>React 的 <strong>state</strong> 为 唯一数据源</li><li>组件控制着用户输入过程中表单发生的操作</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span>&gt;</span>、 <span class="tag">&lt;<span class="name">textarea</span>&gt;</span> 和 <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">在受控组件上通过 props 指定value 会组织用户输入</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>被 React 以以上两种方式控制取值的表单输入元素称为 <strong>受控组件</strong></p></blockquote><ul><li>非受控组建<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span>&gt; 其 value 只读</span><br></pre></td></tr></table></figure></li></ul><h3 id="状态提升">状态提升</h3><ul><li>多个组件需要反映相同的变化数据，建议将共享状态提升到最近的共同父组件中去</li></ul><h3 id="组合、继承">组合、继承</h3><h3 id="React-哲学">React 哲学</h3><ul><li>将设计好的 UI 划分为组件层级<ul><li>单一功能原则</li></ul></li><li>用 React 创建一个静态版本<ul><li>自上而下/自下而上</li></ul></li><li>确定 UI state 的最小（且完整）表示<ul><li>只保留应用所需的可变 state 的最小集合，其他数据均由它们计算产生</li></ul></li><li>确定 state 放置的位置<ul><li>找到根据这个 state 进行渲染的所有组件、将 state 放置在其父级组件中</li></ul></li><li>添加反向数据流<ul><li>事件传递</li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="虚拟DOM">虚拟DOM</h3><ul><li>用来渲染真实 Dom 结构的 JS 对象</li><li>复杂或频繁的DOM操作通常是性能瓶颈产生的原因<ul><li>虚拟DOM与实际DOM之间的渲染很快</li><li>保持稳定的dom结构有助于性能的稳定</li></ul></li><li><a href="https://www.zhihu.com/question/29504639?sort=created">虚拟DOM</a></li></ul><h3 id="实现">实现</h3><ul><li>抽象渲染过程、实现跨平台</li><li>diff 算法，减少 JavaScript 操作真实 DOM 的带来的性能消耗</li><li>一个普通的 JavaScript 对象，包含了 tag、props、children 三个属性</li><li>虚拟DOM库<ul><li>h 函数<ul><li>React 中的 React.createElement<ul><li>babel 将 jsx 转换 h 函数渲染形式</li></ul></li><li>Vue render 函数中的 createElement<ul><li>vue-loader 将模版转换h函数渲染形式</li></ul></li></ul></li></ul></li></ul><p>function h(tag, props, …children) {<br>return {<br>tag,<br>props: props || {},<br>children: children.flat()<br>}<br>}</p><p>虚拟DOM工作原理<br>通过js对象模拟DOM节点<br>在实现上是plain Object<br>render 函数jsx 在Babel插件作用下编译为 React.createElement 中的参数<br>，该函数执行后返回 plain Object，它会描述自己的tag类型、props参数、以及children情况等，plain Object通过树形结构组成虚拟DOM树，当状态发生变更时，会将变更前后的虚拟DOM树进行差异比对，这个过程称为diff，差异结果称为patch</p><p>优点</p><ul><li>改善大规模DOM操作的性能</li><li>规避XSS风险</li><li>以较低的成本实现跨平台开发</li></ul><p>确定</p><ul><li>内存占用较高（要模拟整个页面DOM结构)</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="组件优化方案">组件优化方案</h3><ol><li><p>组件卸载前进行清理操作<br>在组件中为 window 注册的全局事件, 以及定时器, 在组件卸载前要清理掉, 防止组件卸载后继续执行影响应用性能</p></li><li><p>使用PureComponent</p></li></ol><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Component和PureComponent 区别</span><br><span class="line">- 区别点： PureComponent自带通过props和<span class="keyword">state</span>的浅对比来实现 shouldComponentUpate()，而Component没有</span><br><span class="line"></span><br><span class="line">- PureComponent</span><br><span class="line">  - 优点：不需要开发者自己实现shouldComponentUpdate，就可以进行简单的判断来提升性能</span><br><span class="line">  - 缺点：可能会因深层的数据不一致而产生错误的否定判断，从而shouldComponentUpdate结果返回false，界面得不到更新</span><br></pre></td></tr></table></figure><ol start="3"><li>shouldComponentUpdate</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> bool;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>memo</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compareChild</span>(<span class="params">prevProps, nextProps</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> bool;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = <span class="title function_">memo</span>(<span class="title class_">Child</span>, compareChild)</span><br></pre></td></tr></table></figure><ol start="5"><li>组建懒加载</li></ol><ul><li>减少构建时 boundle 体积、加快编译速度</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">LazyHome</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;Home&quot; */</span> <span class="string">&quot;./Home&quot;</span>))</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 组件懒加载时做优雅降级、展示loading效果</span></span><br><span class="line">&lt;<span class="title class_">Suspense</span> fallback=&#123;<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">LazyHome</span> /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Suspense</span>&gt;</span><br></pre></td></tr></table></figure><ol start="6"><li>使用 Fragment 避免额外DOM渲染</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">React</span>.<span class="property">Fragment</span>&gt;...&lt;/<span class="title class_">React</span>.<span class="property">Fragment</span>&gt;</span><br><span class="line">或</span><br><span class="line">&lt;&gt;...&lt;/&gt;</span><br></pre></td></tr></table></figure><ol start="7"><li>不使用内联函数定义</li></ol><ul><li>render 方法每次运行时都会创建该函数的新实例, 导致 React 在进行 Virtual DOM 比对时, 新旧函数比对不相等，导致 React 总是为元素绑定新的函数实例, 而旧的函数实例又要交给垃圾回收器处理.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不推荐</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onFocus</span>=<span class="string">&#123;evt</span> =&gt;</span> console.log(evt)&#125; /&gt;</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 推荐</span></span><br><span class="line">onFocus = <span class="function"><span class="params">evt</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(evt)</span><br><span class="line"></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onFocus</span>=<span class="string">&#123;this.onFocus&#125;</span> /&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="8"><li>类组件中箭头函数</li></ol><ul><li>优点：事件回调中this指向当前组件实例</li><li>缺点：当使用箭头函数时, 该函数被添加为类的实例对象属性, 而不是原型对象属性. 如果组件被多次重用, 每个组件实例对象中都将会有一个相同的函数实例, 降低了函数实例的可重用性造成了资源浪费</li></ul><ol start="9"><li>避免使用内联样式属性</li></ol><ul><li>当使用内联 style 为元素添加样式时, 内联 style 会被编译为 JavaScript 代码, 通过 JavaScript 代码将样式规则映射到元素的身上, 浏览器就会花费更多的时间执行脚本和渲染 UI, 从而增加了组件的渲染时间.</li></ul><ol start="10"><li>创建错误边界ErrorBoundaries</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 记录应用程序错误信息</span></span><br><span class="line"><span class="title function_">componentDidCatch</span>(<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidCatch&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getDerivedStateFromError&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">hasError</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>发生了错误<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="功能权限模型RBAC">功能权限模型RBAC</h2><pre><code>定义: （Role-Based Access Control）模型概要: 权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限</code></pre><p>权限系统设计：<br><a href="https://www.jianshu.com/p/50e1667f2ee2">https://www.jianshu.com/p/50e1667f2ee2</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="渲染流程">渲染流程</h2><p>view —&gt;Action—&gt;Reducer —&gt;Store(render)<br>现象：<br>combineReducers() —&gt; 每个 reducer 被执行 2遍<br>createStore()   —&gt; 每个 reducer 再执行 1遍<br>备注：最终大的 state:{reducerFuncName: state}</p><h2 id="redux-sagas">redux-sagas</h2><p><a href="https://www.jianshu.com/p/6f96bdaaea22">https://www.jianshu.com/p/6f96bdaaea22</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="Redux设计思想">Redux设计思想</h3><ul><li>Web 应用是一个状态机，视图与状态是一一对应的</li><li>所有的状态，保存在一个对象里面</li><li>实现了全局 state 、处理全局 state 的方式和统一的数据处理中心，也就是 store、dispatch 和 reducer</li></ul><p>Redux工作流程梳理：<br>@ 用户发出 Action<br>@ store 自动调用reducer，并且传入当前state、Action 并返回一个新的state<br>@ state 一旦发生变化，store 就会调用监听函数(render | setState) 通过store.getStore()得到当前状态，进而触发view重新渲染<br><img src="./images/redux-flow.jpg" alt="redux-flow"></p><pre><code class="language-javascript">第一节:redux 语法基础生成唯一的store：import &#123; createStore &#125; from 'redux';const store = createStore(fn);// state:store对象某个时点的快照!!!const state = store.getState();// Action：view发出的通知(对象)，携带信息去改变stateconst action = &#123;  type: 'ADD_TODO',  payload: 'Learn Redux'&#125;;// 通过action creator生成Action（简化action的生成） eg:const ADD_TODO = '添加 TODO';function addTodo(text) &#123;  return &#123;    type: ADD_TODO,    text  &#125;&#125;const action = addTodo('Learn Redux');// store.dispatch():view发出Action的唯一方式store.dispatch(action);// reducer:store 的计算过程// `整个应用的初始状态，可以作为 State 的默认值`const reducer = function (state, action) &#123;  // ...  return new_state;&#125;;// 实际应用中，Reducer 函数不用像上面这样手动调用，store.dispatch方法会触发 Reducer 的自动执行# 做法:import &#123; createStore &#125; from 'redux';const store = createStore(reducer);// Reducer是纯函数：保证同样的state必定得到同样的view,所以，reducer中不能改变state。// State 是一个对象function reducer(state, action) &#123;    return Object.assign(&#123;&#125;, state, &#123; thingToChange &#125;); // 或者  return &#123; ...state, ...newState &#125;;&#125;// State 是一个数组function reducer(state, action) &#123;  return [...state, newItem];&#125;设置监听:实现view自动渲染Store.subscribe方法设置监听函数(对于react项目，就是组建的render、getState方法放入listener，实现view自动渲染)。Store.subscribe(listener);解除监听:let unsubscribe = store.subscribe(() =&gt;   console.log(store.getState()));unsubscribe();Reducer拆分:前提: State 的属性名必须与子 Reducer 同名.``合并reducer``import &#123; combineReducers &#125; from 'redux';const chatReducer = combineReducers(&#123;   chatLog,   statusMessage,   userName&#125;)export default todoApp;第二节：中间件与异步操作##（1）Reducer：纯函数，只承担计算 State 的功能，不合适承担其他功能，也承担不了，因为理论上，纯函数不能进行读写操作。（2）View：与 State 一一对应，可以看作 State 的视觉层，也不合适承担其他功能。（3）Action：存放数据的对象，即消息的载体，只能被别人操作，自己不能进行任何操作。##ApplyMiddleware:将所有中间件组成一个数组import &#123; applyMiddleware, createStore &#125; from 'redux';import createLogger from 'redux-logger';import thunk from 'redux-thunk'; // 使得 store.dispatch 参数可以为函数// import promiseMiddleware from 'redux-promise';  // 让 Action Creator 返回一个promise对象import reducer from './reducers';const logger = createLogger();const store = createStore(  reducer,  applyMiddleware(thunk,promise,logger));##异步操作思路##操作开始时，送出一个 Action，触发 State 更新为&quot;正在操作&quot;状态，View 重新渲染操作结束后，再送出一个 Action，触发 State 更新为&quot;操作结束&quot;状态，View 再一次重新渲染常用中间件的介绍:Redux-thunk:AsyncApp组件:class AsyncApp extends Component &#123;  componentDidMount() &#123;     const &#123; dispatch, selectedPost &#125; = this.props;     dispatch(fetchPosts(selectedPost))  // Action creator 返回了一个函数 ，普通的Action Creator 默认返回一个对象  &#125;&#125;;// 使用 redux-thunk 中间件const fetchPosts = postTitle =&gt; (dispatch, getState) =&gt; &#123;  dispatch(requestPosts(postTitle));  // 操作开始  return fetch(`/some/API/$&#123;postTitle&#125;.json`)      .then(response =&gt; response.json())      .then(json =&gt; dispatch(receivePosts(postTitle, json))); // 操作结束  &#125;;&#125;;/**使用redux-promise中间件const fetchPosts =   (dispatch, postTitle) =&gt; new Promise(function (resolve, reject) &#123;    dispatch(requestPosts(postTitle));    return fetch(`/some/API/$&#123;postTitle&#125;.json`)       .then(response =&gt; &#123;         type: 'FETCH_POSTS',         payload: response.json()       &#125;);&#125;);*/第三节:react-redux 数据流管理:UI 组件负责 UI 的呈现(用户维护)容器组件负责管理数据和逻辑(由react-redux自动生成)import &#123; connect &#125; from 'react-redux';const VisibleTodoList = connect(   mapStateToProps,  // 负责输入逻辑，即将state映射到 UI 组件的参数（props）**   mapDispatchToProps // 输出逻辑，即将用户对 UI 组件的操作映射成 Action**)(TodoList);  // TodoList:UI组件 VisibleTodoList:通过connect方法自动生成的容器组件MapStateToProps:介绍mapStateToProps会订阅 Store，每当state更新的时候，就会自动执行，重新计算 UI 组件的参数，从而触发 UI 组件的重新渲染。const mapStateToProps = (state,ownProps) =&gt; &#123;  //ownProps:UI组件的的参数  return &#123;    todos: getVisibleTodos(state.todos, state.visibilityFilter)  // todos:UI组件的同名参数  &#125;&#125;const getVisibleTodos = (todos, filter) =&gt; &#123;   // getVisibleTodos:从state计算出todos的值  switch (filter) &#123;      case 'SHOW_ALL':            return todos      case 'SHOW_COMPLETED':      return todos.filter(t =&gt; t.completed)      case 'SHOW_ACTIVE':      return todos.filter(t =&gt; !t.completed)      default:      throw new Error('Unknown filter: ' + filter)  &#125;&#125;MapDispatchToProps 介绍：建立UI组件的参数到store.dispatch 方法的映射(定义了哪些用户的操作应该当做Action)const mapDispatchToProps = &#123;   // mapDispatchToProps:Object 返回的Action 会由redux自动发出   onClick: (filter) =&gt; &#123;       type: 'SET_VISIBILITY_FILTER',      filter: filter     &#125;;&#125;Provider组件的介绍：`可以让容器组件拿到state`说明:connect 方法生成容器组件后，需要让容器组件拿到state对象，才能生成UI组件参数(props)--推荐下面这种方式import &#123; Provider &#125; from 'react-redux';import &#123; createStore &#125; from 'redux';import todoApp from './reducers';import App from './components/App';let store = createStore(todoApp);render(  &lt;Provider store=&#123;store&#125;&gt;      &lt;Router&gt;        &lt;Route path=&quot;/&quot; component=&#123;App&#125; /&gt;   // 根组件包一层，App所有子组件默认都可以拿到 state（this.props）     &lt;/Router&gt;  &lt;/Provider&gt;,  document.getElementById('root'));Redux数据流：myButton.js中执行的函数必须在ButtonController.js中执行，因为在该文件中才可对数据进行操作。发数据：reducer中包含了dispatcher方法dispatch 用来发出数据store=createstore(todoReducer)action = &#123;&#125;解构对象：let &#123;type,text&#125; =action;模板字符串：&#123;·...$&#123;variable&#125;...·&#125;数组展开与添加：[...state,text]让两个独立模块建立联系 ---&gt; 将其中的一个作为另外一个模块的参数传递过去[redux参考](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html)</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>Flux数据流：</p><p>register生成一个function，dispatch来执行该function<br>view层<br>文本框输入内容：按下回车键(keyCode==13),将输入框中的值存放到store中。</p><p>数据流管理：<br>Flux、vuex、redux<br>Vuex 是一个专为 Vue.js 应用程序开发的状态管理模式</p><p>Weex:</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="useRef">useRef</h3><p>一、什么是 useRef</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">ref</span>Container: MutableRefObject&lt;any&gt; = useRef(initialValue);</span><br></pre></td></tr></table></figure><ul><li>返回一个可变的 ref 对象，该对象只有个 current 属性，初始值为传入的参数( initialValue )。</li><li>返回的 ref 对象在组件的整个生命周期内保持不变</li><li>当更新 current 值时并不会 re-render ，这是与 useState 不同的地方</li><li>更新 useRef 是 side effect (副作用)，所以一般写在 useEffect 或 event handler 里</li><li>useRef 类似于类组件的 this</li><li>useRef 是定义在实例基础上的，如果代码中有多个相同的组件，每个组件的 ref 只跟组件本身有关，跟其他组件的 ref 没有关系。</li></ul><p>二、为什么使用useRef<br>需求： 跨渲染取到状态值</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">LikeButton</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 定义一个实例变量</span></span><br><span class="line">  <span class="keyword">let</span> like = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleAlertClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="string">`you clicked on <span class="subst">$&#123;like.current&#125;</span>`</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          like.current = like.current + 1;</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        &#123;like.current&#125;赞</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleAlertClick&#125;</span>&gt;</span>Alert<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LikeButton</span>;</span><br><span class="line"></span><br><span class="line">结论：不同渲染之间无法共享state状态值</span><br></pre></td></tr></table></figure><p>三、useRef与createRef的区别<br>在一个组件的正常的生命周期中可以大致分为3个阶段：</p><ol><li>从创建组件到挂载到DOM阶段。初始化props以及state, 根据state与props来构建DOM</li><li>组件依赖的props以及state状态发生变更，触发更新</li><li>销毁阶段</li></ol><p>第一个阶段，useRef与createRef没有差别<br>第二个阶段，createRef每次都会返回个新的引用;而useRef不会随着组件的更新而重新创建<br>第三个阶段，两者都会销毁</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useRef, createRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">RefDifference</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> [renderIndex, setRenderIndex] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">let</span> refFromUseRef = useRef&lt;<span class="built_in">number</span>&gt;()</span><br><span class="line">    <span class="keyword">let</span> refFromCreateRef = <span class="title function_">createRef</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(refFromUseRef.<span class="property">current</span>, <span class="string">&#x27;refFromUseRef.current&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(refFromCreateRef.<span class="property">current</span>, <span class="string">&#x27;refFromCreateRef.current&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (!refFromUseRef.<span class="property">current</span>) &#123;</span><br><span class="line">        refFromUseRef.<span class="property">current</span> = renderIndex</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!refFromCreateRef.<span class="property">current</span>) &#123;</span><br><span class="line">        refFromCreateRef.<span class="property">current</span> = renderIndex</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Current render index: &#123;renderIndex&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">b</span>&gt;</span>refFromUseRef<span class="tag">&lt;/<span class="name">b</span>&gt;</span> value: &#123;refFromUseRef.current&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">b</span>&gt;</span>refFromCreateRef<span class="tag">&lt;/<span class="name">b</span>&gt;</span> value:</span></span><br><span class="line"><span class="language-xml">                &#123;refFromCreateRef.current&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setRenderIndex((prev) =&gt; prev + 1)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                Cause re-render</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RefDifference</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">现象：</span><br><span class="line">点击按钮时，从控制台可以看到refFromUseRef.<span class="property">current</span>一直为<span class="number">1</span>(因为refFromUseRef.<span class="property">current</span>已经存在该引用)，而refFromCreateRef.<span class="property">current</span>却是<span class="title function_">undefined</span>(因为createRef 每次渲染都会返回一个新的引用，所以<span class="keyword">if</span>判断时为<span class="literal">true</span>，会被重新赋值，页面就会显示出新的值)</span><br><span class="line"></span><br><span class="line">createRef 每次渲染都会返回一个新的引用，而 useRef 每次都会返回相同的引用</span><br></pre></td></tr></table></figure><p>四、获取子组件的属性或方法</p><blockquote><p>React.forwardRef((props, ref) =&gt; {}) 将父类的ref作为参数传入函数式组件中<br>useImperativeHandle(ref, createHandle, [deps]) // 第一个参数暴露哪个ref;第二个参数暴露什么信息</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">FancyInput</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">focus</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> <span class="attr">...</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">FancyInput</span> = <span class="title function_">forwardRef</span>(<span class="title class_">FancyInput</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 父组件通过 inputRef 可以直接调用子组件 focus 方法</span></span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title class_">React</span>.<span class="title function_">useRef</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;, [inputRef])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">FancyInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结论：<br><strong>useImperativeHandle</strong> 在函数式组件中，用于定义暴露给父组件的ref方法，用来限制子组件对外暴露的信息，只有useImperativeHandle第二个参数定义的属性跟方法才可以在父组件获取到</p><p>五、总结</p><ul><li>useRef可以用来定义变量，这些变量更改之后不会引起页面重新渲染，比如分页获取数据时，存储页码。</li><li>useRef也可以用来区分初始渲染还是更新(通过current有没值，具体见示例库里的didOrUpdate.tsx)</li><li>在DOM节点上定义ref属性，通过.current就可以获取到该DOM元素</li><li>通过forwardRef就可以给函数子组件传入ref属性。</li><li>使用useImperativeHandle用于定义暴露给父组件的ref方法</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="Hooks">Hooks</h3><p><strong>组件类缺陷</strong></p><ul><li>组件逻辑复用繁琐，通常采用 Render Props或高阶组件<ul><li>本质是将复用逻辑提升到父组件中，很容易产生很多包装组件，带来嵌套地域</li></ul></li><li>写法繁琐、需注意事件函数this绑定</li></ul><p><strong>函数组件缺陷</strong></p><ul><li>纯函数、不包含状态</li><li>不支持 生命周期方法</li></ul><p><strong>hook 引入原因</strong></p><ul><li>用于在函数组件中引入状态管理和生命周期方法</li><li>逻辑重用性高，减少代码耦合</li></ul><p><strong>常用 API</strong></p><ul><li><p>useState为函数组件提供状态</p><ul><li>简易版 useState 实现</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> memoizedStates = []  <span class="comment">// 多个useState 时需要使用数组来存</span></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useState</span> (initialState) &#123;</span><br><span class="line">  memoizedStates[index] = memoizedStates[index] || initialState;</span><br><span class="line">  <span class="keyword">let</span> currentIndex = index;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setState</span> (newState) &#123;</span><br><span class="line">      memoizedStates[currentIndex] = newState</span><br><span class="line">      <span class="comment">// 组件渲染</span></span><br><span class="line">      <span class="title function_">render</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [memoizedStates[index++], setState]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 由此可见，组件中按顺序存储state状态</span></span><br></pre></td></tr></table></figure></li><li><p>useContext 共享状态钩子</p><ul><li>在后代组件中用来接收值</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AppContext</span> = <span class="title function_">createContext</span>();</span><br><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span> = (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">AppContext.provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">name:</span> &#x27;<span class="attr">Jahaw</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">AppContext.provider</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Child</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name &#125; = <span class="title function_">useContext</span>(<span class="title class_">AppContext</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123; name &#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>useReducer: action 钩子</p><ul><li>优势：hook 提供共享状态 和 Reducer 函数</li><li>缺陷：无middleware &amp; time travel (Redux 提供)<br><img src="../images/redux-flow.jpg" alt="redux-flow"></li></ul><ul><li><p>useEffect 副作用的操作</p><ul><li>在render后执行(异步执行)</li></ul></li><li><p>useLayoutEffect</p><ul><li>在render前执行(同步执行)</li></ul></li><li><p>useRef 返回可变对象</p></li><li><p>useMemo做好缓存、避免组件计算浪费</p></li><li><p>useCallback</p></li></ul><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fnA = useCallback(fnB, [a])  </span><br><span class="line">将我们传递给它的函数fnB返回，并且将这个结果缓存；当依赖a变更时，会返回新的函数(利用 Set 即可判断是否返回了新的函数)</span><br><span class="line"></span><br><span class="line">应用场景：</span><br><span class="line">有一个父组件，其中包含子组件，子组件接收一个函数作为props；通常而言，如果父组件更新了，子组件也会执行更新；</span><br><span class="line">但是大多数场景下，更新是没有必要的，我们可以借助useCallback来返回函数，然后把这个函数作为props传递给子组件；这样，子组件就能避免不必要的更新。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意点【React闭包】</span></span><br><span class="line">useCallback(() =&gt; <span class="built_in">set</span>State(<span class="keyword">state</span> =&gt; <span class="keyword">state</span> + <span class="number">1</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>React 内部默认采用 <a href="http://Object.is">Object.is</a> 浅比较，使用memo后进行深比较</strong></p><!-- react 性能优化点：调用setState，就会触发组件的重新渲染，无论前后state是否不同父组件更新，子组件也会自动的更新常规优化方案： 1. 使用immutable进行比较，在不相等的时候调用setState；2. 在shouldComponentUpdate中判断前后的props和state，如果没有变化，则返回false来阻止更新 -->]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>setState会有合并操作<br>useEffect包括如下生命周期<br>componentDidMount<br>componentDidUpdate、componentWillUnmount</p><p>return () =&gt; clearTimeout(timer) 作为 componentWillUnmount<br><em>重新render前，先执行useEffect return</em></p><p>deps： <br>componentWillReceiveProps<br>shouldComponentUpdate<br>备注：为了节省性能都是浅比较<br><a href="http://Object.is">Object.is</a>：可做浅比较</p><p>deps:[] 时，effect内部 props和state始终为 initVal初始值</p><p>通信：<br>上层创建引用，再传递给子组件(违反了封装原则)<br>forwardRef((props,ref)=&gt;123)<br>useImperativeHandle：向上层暴漏本组件的部分方法(限制外界对本组件的访问)</p><p>useContext：做组件状态共享</p><p>react靠顺序识别临近几个hooks的</p><p>mis-order(乱序)问题：<br>组件书写注意事项：<br>1. 无限循环更新<br>2. Hooks 不能写在if里</p><p>第一：<br>不能在useEffect中使用useState,会产生死循环，变了执行render，render执行useEffect</p><p>第二：<br>不能在if判断中使用useEffect</p><p>hooks是根据hook顺序来确定每次值的变化，一旦变化了就发生不可预期的错误<br>链表结构变化导致变量与方法对应不上</p><p>useLayoutEffect 在render前执行 (同步执行)<br>useEffect在render后执行(异步执行)</p><p>useMemo做好缓存、避免组件计算浪费</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="AngularJS">AngularJS</h3><p><strong>SPA:单页面应用程序</strong></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">特点</span><br><span class="line">定义：页面跳转无刷新</span><br><span class="line">方法：利用路由控制页面跳转<span class="comment">--URL的哈希值</span></span><br><span class="line"></span><br><span class="line">优点：</span><br><span class="line">页面切换流畅：对某个dom元素进行替换来显示不同页面</span><br><span class="line">前后端分离：前后端分离，和后端交互只有数据。</span><br><span class="line">数据绑定：模型改变更新视图的方法。</span><br></pre></td></tr></table></figure><p><strong>angular优缺点</strong></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">##优点：</span><br><span class="line"><span class="number">1.</span>AngularJS模板功能强大丰富，自带了极其丰富的angular指令(扩展的html属性)。</span><br><span class="line"><span class="number">2.</span>AngularJS是完全可扩展的，与其他库的兼容效果很好，每一个功能可以修改或更换，以满足开发者独特的开发流程和功能的需求。</span><br><span class="line"><span class="number">3.</span>AngularJS是一个比较完善的前端MVC框架，包含服务，模板，数据双向绑定，模块化，路由，过滤器，依赖注入等所有功能；</span><br><span class="line"><span class="number">4.</span>AngularJS是互联网巨人谷歌开发，这也意味着他有一个坚实的基础和社区支持。</span><br><span class="line"> </span><br><span class="line">##缺点：</span><br><span class="line"><span class="number">1</span>、AngularJS强约束导致学习成本较高，对前端不友好。但遵守 AngularJS 的约定时，生产力会很高，对 Java 程序员友好。</span><br><span class="line"><span class="number">2</span>、AngularJS不利于SEO，因为所有内容都是动态获取并渲染生成的，搜索引擎没法爬取。</span><br><span class="line"> </span><br><span class="line">##性能问题：AngularJS作为 MVVM 框架，因为实现了数据的双向绑定，对于大数组、复杂对象会存在性能问题</span><br><span class="line">angular中包含的功能模块；</span><br><span class="line">var app=angular.<span class="keyword">module</span>(<span class="string">&#x27;app&#x27;</span>,[]);</span><br><span class="line">app.controller(<span class="string">&#x27;myCtrl&#x27;</span>,[$scope,function($scope)&#123;</span><br><span class="line">    <span class="comment">//逻辑部分...</span></span><br><span class="line">&#125;])</span><br><span class="line">服务：app.server()---&gt;创建一个自定义的服务</span><br><span class="line">模块：templateUrl:<span class="string">&#x27;./component/contentBox.html&#x27;</span>;</span><br><span class="line">数据双向绑定:v-<span class="keyword">module</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">模块化:在定义angular应用程序时，将引入的外部文件模块(zepto.js)写在<span class="string">&quot;[]&quot;</span>中。</span><br><span class="line">路由：通过config函数(配置路由规则)将<span class="string">&quot;$routeProvider&quot;</span>注入到我们的配置函数并使用$routeProvider.whenAPI来定义我们的路由规则 </span><br><span class="line">##$routeProvider 为我们提供了 when(path,object) &amp; <span class="keyword">otherwise</span>(object) 函数按顺序定义所有路由##              </span><br><span class="line">过滤器 ：app.filter()来自定义过滤器</span><br><span class="line">依赖注入 ：比如创建了一个服务,作为另外一个函数的参数,即可在该函数中使用该参数的一些属性和方法了。--&gt;称为##依赖注入##</span><br></pre></td></tr></table></figure><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">Angular介绍：作者用了四年写出的框架</span></span><br><span class="line"><span class="language-xml">1. 干什么</span></span><br><span class="line"><span class="language-xml">重复劳动---获取、事件、创建</span></span><br><span class="line"><span class="language-xml">比如：列表的排序，</span></span><br><span class="line"><span class="language-xml">接管UI</span></span><br><span class="line"><span class="language-xml">构建CRUD应用(90%的web应用都是CRUD应用)</span></span><br><span class="line"><span class="language-xml">如游戏、图形界面，这种DOM操作很频繁也很复杂的应用，更适用于轻量级的、简单的技术如jQuery。</span></span><br><span class="line"><span class="language-xml"> 构建一个CRUD应用可能用到的全部内容包括：数据绑定、基本模板标识符、表单验证、路由、深度链接、组件重用、依赖注入。</span></span><br><span class="line"><span class="language-xml">  测试方面包括：单元测试、端对端测试、模拟和自动化测试框架。</span></span><br><span class="line"><span class="language-xml">  具有目录布局和测试脚本的种子应用作为起点</span></span><br><span class="line"><span class="language-xml">2. 好在哪？</span></span><br><span class="line"><span class="language-xml"> 1自动同步2节约精力，放在主要的业务逻辑上3规范整体的开发</span></span><br><span class="line"><span class="language-xml">库、框架：</span></span><br><span class="line"><span class="language-xml">相同点：都是预先定义好的东西，在开发中省事</span></span><br><span class="line"><span class="language-xml">不同点：angularjs框架(框架在用人)：限制程序员</span></span><br><span class="line"><span class="language-xml">      库(人用库)：方便程序员，不适于大型开发</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">3. 限制</span></span><br><span class="line"><span class="language-xml">https://angularjs.org/</span></span><br><span class="line"><span class="language-xml">4. 介绍：</span></span><br><span class="line"><span class="language-xml">angularjs是一个mvc框架、</span></span><br><span class="line"><span class="language-xml">angularjs数据交互</span></span><br><span class="line"><span class="language-xml">1 原生js中的部分东西--angularjs用不了，angular中所有的东西都在$scope中</span></span><br><span class="line"><span class="language-xml">2 数据多了就不可以使用ng-init、</span><span class="template-variable">&#123;&#123;&#125;&#125;</span><span class="language-xml">、来显示数据</span></span><br><span class="line"><span class="language-xml">3 数据的依赖和注入(把依赖项注入进去)</span></span><br><span class="line"><span class="language-xml">如：  函数：函数的参数由调用者决定。</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">angularjs脏检机制：</span></span><br><span class="line"><span class="language-xml">1.不会脏检查所有的对象，当对象绑定到html中，这个对象添加为检查对象(watcher)</span></span><br><span class="line"><span class="language-xml">2.不会脏检查所有属性，当属性绑定到html中，这个属性会被列为检查属性</span></span><br><span class="line"><span class="language-xml">3.在angular程序初始化时，会将绑定的对象的属性添加为监听对象，也就是说一个对象绑定了N个属性，就会有N个watcher</span></span><br><span class="line"><span class="language-xml">具体参考 : http://www.cnblogs.com/wdlhao/p/5727335.html</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">##路由## 指令(可扩展的html属性)##--------&gt;核心</span></span><br><span class="line"><span class="language-xml">路由：浏览器根据一定的url 规则匹配来展示不同的页面</span></span><br><span class="line"><span class="language-xml">Router 模块监听浏览器的哈希值，显示不同的页面</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">AngularJS 通过 ng-directives 扩展了 HTML。</span></span><br><span class="line"><span class="language-xml">MVC：降低项目的耦合度。MVC---&gt;MVP--&gt;MVVM(数据、变现分离)</span></span><br><span class="line"><span class="language-xml">// 例如：<span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span>,改变p标签为div只要ng-app不变，则该模块不会发生变化。</span></span><br><span class="line"><span class="language-xml">Model：(模型):是应用程序中用于处理程序数据逻辑的部分，通常模型对象负责在数据库中存取数据。</span></span><br><span class="line"><span class="language-xml">View：(视图)：是应用程序中处理数据显示的部分，通常视图是依据模型数据创建的。</span></span><br><span class="line"><span class="language-xml">Controller：(控制器)：是应用程序中处理用户交互的部分，通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。</span></span><br><span class="line"><span class="language-xml">优势：有利于管理复杂的应用程序。</span></span><br><span class="line"><span class="language-xml">ng-app 指令定义一个 AngularJS 应用程序，告诉angular管理哪些模块。</span></span><br><span class="line"><span class="language-xml">ng-model 指令把元素值（比如输入域的值）绑定到应用程序--数据源。</span></span><br><span class="line"><span class="language-xml">ng-bind 指令把应用程序数据绑定到 HTML 视图。</span></span><br><span class="line"><span class="language-xml">ng-show：该指令将数据显示或者隐藏。</span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.static.runoob.com/libs/angular.js/1.4.6/angular.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>名字 : <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;name&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span>&lt;/</span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello </span><span class="template-variable">&#123;&#123;<span class="name">name</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><img src="./images/angularjs/expression.png" alt="expression"></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">实例讲解：</span></span><br><span class="line"><span class="language-xml">当网页加载完毕，AngularJS 自动开启。</span></span><br><span class="line"><span class="language-xml">ng-app 指令告诉 AngularJS，<span class="tag">&lt;<span class="name">div</span>&gt;</span> 元素是 AngularJS 应用程序 的&quot;所有者&quot;。</span></span><br><span class="line"><span class="language-xml">ng-model 指令把输入域的值绑定到应用程序变量 name。</span></span><br><span class="line"><span class="language-xml">ng-bind 指令把应用程序变量 name 绑定到某个段落的 innerHTML，通常写在html标签中。</span></span><br><span class="line"><span class="language-xml">指令：</span></span><br><span class="line"><span class="language-xml">AngularJS 指令是以 ng 作为前缀的 HTML 属性。</span></span><br><span class="line"><span class="language-xml">ng-init 指令初始化 AngularJS 应用程序变量</span></span><br><span class="line"><span class="language-xml">指令加在标签内部不用加 </span><span class="template-variable">&#123;&#123; &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">AngularJs表达式（相当于模板）</span></span><br><span class="line"><span class="language-xml">可以包含文字、运算符、变量</span></span><br><span class="line"><span class="language-xml">AngularJS 表达式写在双大括号内：</span><span class="template-variable">&#123;&#123; <span class="name">expression</span> &#125;&#125;</span><span class="language-xml">。</span></span><br><span class="line"><span class="language-xml">AngularJS 表达式把数据绑定到 HTML，这与 ng-bind 指令有异曲同工之妙，指向控制器中的$scope对象。</span></span><br><span class="line"><span class="language-xml">如：<span class="tag">&lt;<span class="name">三种输出写法</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span> <span class="attr">ng-init</span>=<span class="string">&quot;quantity=1;cost=5&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>总价： <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">&quot;quantity * cost&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>总价： <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-template</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123;<span class="name">quantity</span> * cost&#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>总价： </span><span class="template-variable">&#123;&#123; <span class="name">quantity</span> * cost &#125;&#125;</span><span class="language-xml"> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">AngularJS 将在表达式书写的位置&quot;输出&quot;数据。</span></span><br><span class="line"><span class="language-xml">AngularJs应用</span></span><br><span class="line"><span class="language-xml">AngularJS 模块（Module） 定义了 AngularJS 应用。</span></span><br><span class="line"><span class="language-xml">AngularJS 控制器（Controller） 用于控制 AngularJS 应用。 </span></span><br><span class="line"><span class="language-xml">ng-app指令定义了应用, ng-controller 定义了控制器。</span></span><br><span class="line"><span class="language-xml">例如：</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;myApp&quot;</span> <span class="attr">ng-controller</span>=<span class="string">&quot;myCtrl&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;firstName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> 姓: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;lastName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> 姓名: </span><span class="template-variable">&#123;&#123;<span class="name">firstName</span> + <span class="string">&quot; &quot;</span> + lastName&#125;&#125;</span><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//  AngularJS模块定义应用</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="keyword">var</span> app = angular.<span class="title function_">module</span>(<span class="string">&#x27;myApp&#x27;</span>, [ ], <span class="keyword">function</span>(<span class="params">$provide</span>)&#123; &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">参数说明：模块名 ，<span class="string">&quot; &quot;</span>  , 配置函数(供给控制器使用) </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//  AngularJS控制器控制应用(myCtrl控制器属于myApp模块)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">app.<span class="title function_">controller</span>(<span class="string">&#x27;myCtrl&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope</span>) &#123; $scope.<span class="property">firstName</span>= <span class="string">&quot;John&quot;</span>; $scope.<span class="property">lastName</span>= <span class="string">&quot;Doe&quot;</span>; &#125;); </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//第三个参数是配置函数</span></span><br><span class="line"><span class="language-xml">//  AngularJS表达式</span></span><br><span class="line"><span class="language-xml">// AngularJS对象</span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot; &quot;</span> <span class="attr">ng-init</span>=<span class="string">&quot;person=&#123; firstName:&#x27;John&#x27;,lastName:&#x27; Doe&#x27;&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// AngularJS数组</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot; &quot;</span> <span class="attr">ng-init</span>=<span class="string">&quot;points=[1,2,3,4,5]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// AngularJS表达式与JavaScript表达式</span></span><br><span class="line"><span class="language-xml">类似于 JavaScript 表达式，AngularJS 表达式可以包含字母，操作符，变量。 </span></span><br><span class="line"><span class="language-xml">与 JavaScript 表达式不同，AngularJS 表达式可以写在 HTML 中。</span></span><br><span class="line"><span class="language-xml">与 JavaScript 表达式不同，AngularJS 表达式不支持条件判断，循环及异常。</span></span><br><span class="line"><span class="language-xml">与 JavaScript 表达式不同，AngularJS 表达式支持过滤器。</span></span><br><span class="line"><span class="language-xml">//AngularJS指令</span></span><br><span class="line"><span class="language-xml">AngularJS指令是扩展的HTML属性，带有前缀 ng-;</span></span><br><span class="line"><span class="language-xml">// AngularJS数据绑定</span></span><br><span class="line"><span class="language-xml">AngularJS 中的数据绑定，通过ng-model=&quot; &quot;(把元素值绑定到了应用程序)同步了 AngularJS 表达式与 AngularJS 数据。</span></span><br><span class="line"><span class="language-xml">1 ng-repeat指令:重复一个html元素</span></span><br><span class="line"><span class="language-xml">  ng-repeat=&quot; x in names&quot; ：x指代了names数组中的元素。</span></span><br><span class="line"><span class="language-xml">2 ng-repeat指令循环一个对象数组上</span></span><br><span class="line"><span class="language-xml">  x 指代了names对象</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot; &quot;</span> <span class="attr">ng-init</span>=<span class="string">&quot;name=[</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">&#123;name:&#x27;Jani&#x27;,country:&#x27;norway&#x27;&#125;,</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">&#123;name:&#x27;Jani&#x27;,country:&#x27;norway&#x27;&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>循环对象：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">&quot;x in names&quot;</span>&gt;</span>  &#123; &#123; x.name+&#x27; ,&#x27; +x.country &#125;&#125; <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//  name为$scope中的$scope.names=name;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">ng-app:指令在网页加载完毕之时自动初始化应用程序。</span></span><br><span class="line"><span class="language-xml">ng-init：为AngularJS应用程序定义了初始值。</span></span><br><span class="line"><span class="language-xml">ng-model：绑定html元素到应用程序数据。</span></span><br><span class="line"><span class="language-xml">ng-repeat：对于集合（数组中）的每个项克隆一次html元素。</span></span><br><span class="line"><span class="language-xml">##angular.element:该方法用来获取遍历结束之后的生成的DOM元素##</span></span><br><span class="line"><span class="language-xml">$index:显示遍历数组的下标。</span></span><br><span class="line"><span class="language-xml">$first：是否为头元素</span></span><br><span class="line"><span class="language-xml">$middle:是否为非头非尾元素</span></span><br><span class="line"><span class="language-xml">$last:是否为尾元素</span></span><br><span class="line"><span class="language-xml">ng-include:加载其他页面</span></span><br><span class="line"><span class="language-xml">ng-if=&quot;false&quot;：让数据不显示。</span></span><br><span class="line"><span class="language-xml">//创建自定义的指令！！！（通过使用.directive函数）来添加自定义的指令，在html元素中添加自定义指令名。</span></span><br><span class="line"><span class="language-xml">``限制指令只能通过特定的方式来调用``</span></span><br><span class="line"><span class="language-xml">//---------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="language-xml">// AngularJS模型</span></span><br><span class="line"><span class="language-xml">   ng-model：指令用于绑定了应用程序数据到html控制器（input select textarea）</span></span><br><span class="line"><span class="language-xml">   ng-model 指令可以将输入域的值与 AngularJS 创建的变量绑定</span></span><br><span class="line"><span class="language-xml">    双向绑定：在修改输入域的值时，AngularJS属性的值也将修改。</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;myApp&quot;</span> <span class="attr">ng-controller</span>=<span class="string">&quot;myCtrl&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">名字：<span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>你输入了：</span><span class="template-variable">&#123;&#123; <span class="name">name</span> &#125;&#125;</span><span class="language-xml"> <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   验证用于输入</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;myForm&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">Email:</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;myAddress&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">&quot;myForm.myAddress.$error.email&quot;</span>&gt;</span>不是一个合法的邮箱地址<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span></span><br><span class="line"><span class="language-xml">提示信息会在 ng-show 属性返回 true 的情况下显示。</span></span><br><span class="line"><span class="language-xml">内置的一些方法用于表单的验证</span></span><br><span class="line"><span class="language-xml">应用状态</span></span><br><span class="line"><span class="language-xml">ng-model 指令可以为应用数据提供状态值(invalid, dirty, touched, error):</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;myForm&quot;</span> <span class="attr">ng-init</span>=<span class="string">&quot;myText = &#x27;test@runoob.com&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    Email:</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;myAddress&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;myText&quot;</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">&#123;&#123;<span class="name">myForm.myAddress.$valid</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">&#123;&#123;<span class="name">myForm.myAddress.$dirty</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">&#123;&#123;<span class="name">myForm.myAddress.$touched</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> css类</span></span><br><span class="line"><span class="language-xml">ng-model指令基于他们的状态为html元素提供了css类。</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">//   AngularJS Scope(作用域)</span></span><br><span class="line"><span class="language-xml">Scope(作用域) 是应用在 HTML (视图) 和 JavaScript (控制器)之间的纽带。</span></span><br><span class="line"><span class="language-xml">Scope是一个对象（可应用在视图和控制器上）</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;myApp&quot;</span> <span class="attr">ng-controller</span>=<span class="string">&quot;myCtrl&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">carname</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> app = angular.<span class="title function_">module</span>(<span class="string">&#x27;myApp&#x27;</span>, []);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">app.<span class="title function_">controller</span>(<span class="string">&#x27;myCtrl&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $scope.<span class="property">carname</span> = <span class="string">&quot;Volvo&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 此时将myCtrl控制器非全局，只属于app模块所有(局部模块)。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">当在控制器中添加$scope对象时，视图（html）可以获取了这些属性。</span></span><br><span class="line"><span class="language-xml">scope是一个指向应用model的object，也是表达式执行的上下文。</span></span><br><span class="line"><span class="language-xml">控制器中第二个参数，$http</span></span><br><span class="line"><span class="language-xml">$http.get(&#x27;./mock/checkUser.json&#x27;).then(</span></span><br><span class="line"><span class="language-xml">function()&#123;</span></span><br><span class="line"><span class="language-xml">&#125;,</span></span><br><span class="line"><span class="language-xml">function()&#123;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">);</span></span><br><span class="line"><span class="language-xml">AngularJS应用组成：</span></span><br><span class="line"><span class="language-xml">view（视图）即html</span></span><br><span class="line"><span class="language-xml">model（模型）即当前视图中可用的数据</span></span><br><span class="line"><span class="language-xml">controller（控制器），即JavaScript函数，可添加或修改属性</span></span><br><span class="line"><span class="language-xml">scope是模型，是一个JavaScript对象，带有属性和方法，这些属性和方法可以在视图和控制器中使用。</span></span><br><span class="line"><span class="language-xml">//根作用域</span></span><br><span class="line"><span class="language-xml">$rootScope 可作用于整个应用中。是各个 controller 中 scope 的桥梁。用 rootscope 定义的值，可以在各个 controller 中使用。</span></span><br><span class="line"><span class="language-xml">//AngularJS控制器</span></span><br><span class="line"><span class="language-xml">控制器是 JavaScript 对象，由标准的 JavaScript 对象的构造函数 创建</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;myApp&quot;</span> <span class="attr">ng-controller</span>=<span class="string">&quot;myCtrl&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;firstName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">姓: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;lastName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">姓名: </span><span class="template-variable">&#123;&#123;<span class="name">firstName</span> + <span class="string">&quot; &quot;</span> + lastName&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> app = angular.<span class="title function_">module</span>(<span class="string">&#x27;myApp&#x27;</span>, []);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">app.<span class="title function_">controller</span>(<span class="string">&#x27;myCtrl&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $scope.<span class="property">firstName</span> = <span class="string">&quot;John&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $scope.<span class="property">lastName</span> = <span class="string">&quot;Doe&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">//解析：</span></span><br><span class="line"><span class="language-xml">AngularJS 应用程序由 ng-app 定义。应用程序在 <span class="tag">&lt;<span class="name">div</span>&gt;</span> 内运行。</span></span><br><span class="line"><span class="language-xml">ng-controller=&quot;myCtrl&quot; 属性是一个 AngularJS 指令。用于定义一个控制器。</span></span><br><span class="line"><span class="language-xml">myCtrl 函数是一个 JavaScript 函数。</span></span><br><span class="line"><span class="language-xml">AngularJS 使用$scope 对象来调用控制器。</span></span><br><span class="line"><span class="language-xml">在 AngularJS 中， $scope 是一个应用对象(属于应用变量和函数)。</span></span><br><span class="line"><span class="language-xml">控制器的 $scope （相当于作用域、控制范围）用来保存AngularJS Model(模型)的对象。</span></span><br><span class="line"><span class="language-xml">控制器在作用域中创建了两个属性 (firstName 和 lastName)。</span></span><br><span class="line"><span class="language-xml">ng-model 指令绑定输入域到控制器的属性（firstName 和 lastName）。</span></span><br><span class="line"><span class="language-xml">注意：控制器本身也是一个对象哦！</span></span><br><span class="line"><span class="language-xml">// 外部文件中的控制器：只需要把<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">标签中的代码复制到名为personController.js的外部文件中即可。</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">![strategy](./images/angularjs/strategy.png)</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">//  AngularJS的依赖和注入</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">var</span> A=  <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"> <span class="variable language_">this</span>.<span class="property">getName</span>=<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">return</span>  <span class="string">&quot;张三&quot;</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">           <span class="keyword">var</span>  a= <span class="keyword">new</span> A;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">var</span> B=<span class="keyword">function</span> (<span class="params"></span>)&#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="comment">// B 依赖于 a</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">write</span>( a.<span class="property">getName</span> ());</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;  </span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="comment">//  a 注入b</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">var</span> b=<span class="keyword">new</span> <span class="title function_">B</span>();</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="comment">//js 里的2 个方法</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="number">1</span>  将a传入到b里面去</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="number">2</span>  a是全局变量</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">angular是怎么知道变量发生了变化：</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="number">1</span> 能通过固定的接口才能改变变量的值，比如说只能通过set（）设置变量的值，set（）被调用的时候比较一下就知道了。</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">缺点：写法繁琐</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&lt;div id=<span class="string">&quot;a&quot;</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">obj.<span class="property">b</span>.....        <span class="comment">//view层</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&lt;/div&gt;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&lt;script&gt;                    <span class="comment">//model层：数据模块</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">var</span>  obj=&#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="attr">b</span>:<span class="number">300</span>;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="attr">set</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">obj[key]=val;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;a &quot;</span>).<span class="property">innerHTML</span>=val;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">obj.<span class="title function_">set</span>(<span class="string">&quot;b&quot;</span>,<span class="number">300</span>);</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="number">2</span>  脏检查，将原对象复制一份快照，在某个事件，比较现在对象与快照的值，如果不一样就表明发生变化，，这个策略要保留两份变量，而且要遍历对象，比较每个属性，这样会有一定性能问题。</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">angular的实现是使用脏检查</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">angular的策略：</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">（<span class="number">1</span>）不会脏检查所有的对象，当对象被绑定到html中，这个对象添加为检查对象（watcher）</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">（<span class="number">2</span>）不会脏检查所有的属性，同样当属性被绑定后，这个属性会被列为检查的属性。</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"> （<span class="number">3</span>）在angular程序初始化时，会将绑定的对象的属性添加为监听对象（watcher），也就是说一个对象绑定了N个属性，就会添加N个watcher。</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">什么时候去脏检查：</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="title class_">Controller</span>初始化的时候，所有以ng-开头的事件执行后，都会触发脏检查。</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">$apply仅仅只是进入了angular context，然后通过$digest去触发脏检查</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">$apply如果不给参数的话，会检查$scope里的所有监听的属性，推荐给上参数。</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span></span><br></pre></td></tr></table></figure><p><img src="./images/angularjs/digest.png" alt="digest"></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;firstController&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123; <span class="name">date</span> &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> firstController=<span class="keyword">function</span>(<span class="params">$scope</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$scope.<span class="property">date</span>=<span class="keyword">new</span> <span class="title class_">Date</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$scope.$apply(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$scope.<span class="property">date</span>=<span class="keyword">new</span> <span class="title class_">Date</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//.......会去触发脏检查</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;，<span class="number">1000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><img src="./images/angularjs/watch.png" alt="watch"></p><p><img src="./images/angularjs/provider.png" alt="provider"></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">$scope对象的$watch的使用：</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">var firstController=function ()&#123;</span></span><br><span class="line"><span class="language-xml">$scope.name=&quot;张三&quot;;</span></span><br><span class="line"><span class="language-xml">$scope.date=&#123;</span></span><br><span class="line"><span class="language-xml">name:&quot;李四&quot;;</span></span><br><span class="line"><span class="language-xml">count:20;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">$scope.count=0;</span></span><br><span class="line"><span class="language-xml">//监听一个model，model每次改变时都会触发第二个函数。</span></span><br><span class="line"><span class="language-xml">$scope.$watch(&quot;name&quot;,function(newValue,oldValue)&#123;</span></span><br><span class="line"><span class="language-xml"> ++$scope.count;</span></span><br><span class="line"><span class="language-xml">if($scope.count&gt;30)&#123;</span></span><br><span class="line"><span class="language-xml">$scope.name=&quot;已经大于30次了&quot;;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">)</span></span><br><span class="line"><span class="language-xml">//第三个参数必写！监听一个date对象，只有该对象的类型发生改变时才会触发该函数。</span></span><br><span class="line"><span class="language-xml">$scope.$watch(&quot;date&quot;,function()&#123;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">&#125;,true)</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">五个核心组件</span></span><br><span class="line"><span class="language-xml">value：是一个简单的 javascript 对象，用于向控制器传递值（配置阶段）</span></span><br><span class="line"><span class="language-xml">factory 是一个函数用于返回值。在 service 和 controller 需要时创建。</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">//  函数会影响全局命名空间</span></span><br><span class="line"><span class="language-xml">AngularJS 模块让所有函数的作用域在该模块下，</span></span><br><span class="line"><span class="language-xml">因为他们很容易被其他脚本文件覆盖。</span></span><br><span class="line"><span class="language-xml">novalidate属性是在html5 中新增的，禁用了使用浏览器的默认验证。</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> app=angular.<span class="title function_">module</span>(<span class="string">&quot;myApp&quot;</span>, [ ]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">app.<span class="title function_">controller</span>(<span class="string">&quot;formCtrl&quot;</span> ,<span class="keyword">function</span>(<span class="params">$scope</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$scope.<span class="property">master</span>=&#123; <span class="attr">firstName</span>:<span class="string">&quot;john&quot;</span> ,<span class="attr">lastName</span>:<span class="string">&quot;doe&quot;</span>&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$scope.<span class="property">reset</span>=<span class="keyword">function</span> (<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$scope.<span class="property">user</span>=angular.<span class="title function_">copy</span>($scope.<span class="property">master</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//设置了user对象等于master对象。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$scope.<span class="title function_">reset</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">定义服务：$provider</span></span><br><span class="line"><span class="language-xml">angular是用$provider对象来实现自动依赖注入机制，注入机制通过调用一个provider的$get()方法，把得到的对象作为参数进行相关调用。</span></span><br><span class="line"><span class="language-xml">$provider.provider是一种定义服务的方法，$provider还提供了很多简便的方法，这些简单的方法还直接被module所引用。</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//第三个参数是模块的配置，自动注入机制</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> myApp=angular.<span class="title function_">module</span>(<span class="string">&quot;myApp&quot;</span>,[ ] ,<span class="keyword">function</span> (<span class="params">$provider</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//自定义服务</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$provider.<span class="title function_">provider</span>(<span class="string">&quot;CustomService&quot;</span> ,<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">this</span>.<span class="property">$get</span>=<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 返回一个对象，该对象在任何控制器中均可得到。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">message</span>:<span class="string">&quot;CustomService Message&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//将CustomService传入之后，即可调用该服务。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">myApp.<span class="title function_">controller</span>(<span class="string">&quot;firstController&quot;</span>,<span class="keyword">function</span> (<span class="params">$scope,CustomService</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$scope.<span class="property">name</span>=<span class="string">&quot;张三&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">CustomService</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//##如何在多个控制器中共享数据##</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//1 通过作用域链来共享数据,多个兄弟节点不便于操作。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">   首先在对应的js文件中定义三个controller--每个controller中有对应的me</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&lt;div ng-controller=<span class="string">&quot;countryController&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span></span><span class="template-variable">&#123;&#123;<span class="name">name</span>&#125;&#125;</span><span class="language-xml"><span class="language-javascript">   <span class="comment">//中国</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> &lt;div ng-controller=<span class="string">&quot;stateController&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     </span></span><span class="template-variable">&#123;&#123;<span class="name">$parent.name</span>&#125;&#125;</span><span class="language-xml"> - </span><span class="template-variable">&#123;&#123;<span class="name">name</span>&#125;&#125;</span><span class="language-xml"><span class="language-javascript">    <span class="comment">//中国 - 陕西</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     &lt;div ng-controller=<span class="string">&quot;cityController&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       </span></span><span class="template-variable">&#123;&#123;<span class="name">$parent.$parent.name</span>&#125;&#125;</span><span class="language-xml"> - </span><span class="template-variable">&#123;&#123;<span class="name">$parent.name</span>&#125;&#125;</span><span class="language-xml"> - </span><span class="template-variable">&#123;&#123;<span class="name">name</span>&#125;&#125;</span><span class="language-xml"><span class="language-handlebars"><span class="language-xml">    //中国 - 陕西 - 西安</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">推荐第二种 :</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;countryController as countryCtrl&quot;</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  </span></span></span><span class="template-variable">&#123;&#123;<span class="name">countryCtrl.name</span>&#125;&#125;</span><span class="language-xml"><span class="language-javascript">   <span class="comment">//中国</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> &lt;div ng-controller=<span class="string">&quot;stateController as stateCtrl&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     </span></span><span class="template-variable">&#123;&#123;<span class="name">countryCtrl.name</span>&#125;&#125;</span><span class="language-xml"> - </span><span class="template-variable">&#123;&#123;<span class="name">stateCtrl.name</span>&#125;&#125;</span><span class="language-xml"><span class="language-javascript">    <span class="comment">//中国 - 陕西</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     &lt;div ng-controller=<span class="string">&quot;cityController as cityCtrl&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       </span></span><span class="template-variable">&#123;&#123;<span class="name">countryCtrl.name</span>&#125;&#125;</span><span class="language-xml"> - </span><span class="template-variable">&#123;&#123;<span class="name">stateCtrl.name</span>&#125;&#125;</span><span class="language-xml"> - </span><span class="template-variable">&#123;&#123;<span class="name">cityCtrl.name</span>&#125;&#125;</span><span class="language-xml"><span class="language-handlebars"><span class="language-xml">    //中国 - 陕西 - 西安</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">对应js文件</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">var myApp = angular.module(&#x27;myApp&#x27;,[]);</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">myApp.controller(&#x27;countryController&#x27;,function()&#123;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">   this.name=&#x27;中国&#x27;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;);</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">//2 通过.factory和.service方法来实现数据共享，利用数据自动注入！</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">// 问题：主要在哪些方面有应用？？？</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;myApp&quot;</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;firstController&quot;</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">first.date<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;date.name&quot;</span>/&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">first.Date<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;Date.message&quot;</span>/&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">first-name:</span></span></span><span class="template-variable">&#123;&#123;<span class="name">date.name</span>&#125;&#125;</span><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">first-message:</span></span></span><span class="template-variable">&#123;&#123;<span class="name">Date.message</span>&#125;&#125;</span><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;secondController&quot;</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">ng-model</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">second-name:</span></span></span><span class="template-variable">&#123;&#123;<span class="name">date.name</span>&#125;&#125;</span><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">second-message:</span></span></span><span class="template-variable">&#123;&#123;<span class="name">Date.message</span>&#125;&#125;</span><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">angular.<span class="title function_">module</span>(<span class="string">&#x27;myApp&#x27;</span>, [])</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="comment">//（推荐使用）原因：可返回任何数据类型，而.service只能返回对象。</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">.<span class="title function_">factory</span>( <span class="string">&quot;Date&quot;</span>,<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="comment">//this.$get=function () &#123;&#125;</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="keyword">return</span> &#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="attr">message</span>:<span class="string">&quot;共享的数据&quot;</span>;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;)  </span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  <span class="comment">//angularJS自动帮我们注入数据Date,这样即可保证调用的数据都是从服务端获取的。</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">.<span class="title function_">controller</span>(<span class="string">&#x27;firstController&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope,<span class="built_in">Date</span></span>)&#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="comment">//  此时的data是一个引用类型</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">$scope.<span class="property">date</span>=&#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="attr">name</span>:<span class="string">&quot;张三&quot;</span>;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">$scope.<span class="property">Date</span>=<span class="title class_">Date</span>;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;)</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">.<span class="title function_">controller</span>(<span class="string">&#x27;secondController&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope,<span class="built_in">Date</span></span>)&#123;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="comment">//     第一个输入域与第二个输入域的值相同（利用指针指向了原始对象）。</span></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">$scope.<span class="property">date</span>=$scope.<span class="property">$$prevSibling</span>.<span class="property">date</span>;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">$scope.<span class="property">Date</span>=<span class="title class_">Date</span>;</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">&#125;)</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//  什么是angular过滤器</span></span><br><span class="line"><span class="language-xml">是对数据的格式化，或者筛选的函数，可以直接在模板中通过一种语法使用。</span></span><br><span class="line"><span class="language-xml"> . </span><span class="template-variable">&#123;&#123; <span class="name">expression</span> | filter &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"> . </span><span class="template-variable">&#123;&#123; <span class="name">expression</span> | filter1 | filter2 &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"> . </span><span class="template-variable">&#123;&#123; <span class="name">expression</span> | filter1:param,....&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"> .</span><span class="template-variable">&#123;&#123; <span class="name">expression</span> [| filter_name[:parameter_value] ... ] &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">例子：</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot;myApp&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;firstController&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//123 , 456 , 789 每隔3位添加一个分隔符。</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">P</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">123456789</span> | number&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">P</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//12 , 345.679  自动保存三位有效数字。</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">123456.6789</span> | number:3&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// $999,999.00 默认为美金</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">999999</span> | currency &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">P</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">999999</span> | currency:<span class="string">&#x27;￥&#x27;</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// rmb999,999.00 </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">999999</span> | currency:<span class="string">&#x27;rmb&#x27;</span> &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">P</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//  date  重点</span></span><br><span class="line"><span class="language-xml">//  [1,2,3]</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">[1,2,3,4,5,6,7]</span>  |  limitTo:3 &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//  [5,6,7]</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">[1,2,3,4,5,6,7]</span>  |  limitTo:-3 &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//  转小写</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">Date.message</span> | lowercase &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// 转大写</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; <span class="name">Date.message</span> | uppercase &#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">/**</span></span><br><span class="line"><span class="language-xml"> angular.module(&#x27;myApp&#x27; , [ ]).factory(&#x27;Date&#x27;,function ()&#123;</span></span><br><span class="line"><span class="language-xml">return &#123;</span></span><br><span class="line"><span class="language-xml">message:&#x27;Hello World&#x27;,</span></span><br><span class="line"><span class="language-xml">city : [</span></span><br><span class="line"><span class="language-xml">         &#123;  name:&#x27;上海&#x27;,</span></span><br><span class="line"><span class="language-xml">  py:&#x27;shanghai&#x27; &#125;,</span></span><br><span class="line"><span class="language-xml">         &#123;   name:&#x27;北京&#x27;,</span></span><br><span class="line"><span class="language-xml">  py:&#x27;beijing&#x27;  &#125;</span></span><br><span class="line"><span class="language-xml">]</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">过滤器filter</span></span><br><span class="line"><span class="language-xml">*/</span></span><br><span class="line"><span class="language-xml">//  [[&quot;name&quot;:&quot;上海11212&quot;,&quot;py&quot;:&quot;shagnhai&quot;]]</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123; <span class="name">date.city</span> | filter:<span class="string">&#x27;上海&#x27;</span> &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//  [ ] 匹配到一个空数组</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123; <span class="name">date.city</span> | filter:<span class="string">&#x27;name&#x27;</span> &#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//  常用指令介绍</span></span><br><span class="line"><span class="language-xml">1. ng-include:引入外部html页面--到该div中。</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-include</span>=<span class="string">&quot;index.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">2. <span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-model</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">angular路由：#+标记：来区分不同的逻辑页面。</span></span><br><span class="line"><span class="language-xml">允许我们通过不同的&quot;URL&quot;访问不同的内容。</span></span><br><span class="line"><span class="language-xml">html5 : iframe</span></span><br><span class="line"><span class="language-xml">angular: 路由</span></span><br><span class="line"><span class="language-xml">实现后台管理系统右侧页面的更新与切换--（多视图的单页Web应用）---SPA</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">自定义指令的介绍：</span></span><br><span class="line"><span class="language-xml">``定义是需要驼峰式写法``</span></span><br><span class="line"><span class="language-xml">index.html</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">&quot;&#x27;myController&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">hello-world</span> <span class="attr">message1</span>=<span class="string">&quot;</span></span></span><span class="template-variable">&#123;&#123;<span class="name">messages1</span>&#125;&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">hello-world</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">var myApp=angular.module(&#x27;myApp&#x27;,[]);</span></span><br><span class="line"><span class="language-xml">myApp.controller(&#x27;myController&#x27;,[&#x27;$scope&#x27;,function($scope)&#123;</span></span><br><span class="line"><span class="language-xml">   $scope.message1 = &#x27;www&#x27;;</span></span><br><span class="line"><span class="language-xml">   $scope.message2 = &#x27;www&#x27;;</span></span><br><span class="line"><span class="language-xml">   $scope.changeChild = function()&#123;</span></span><br><span class="line"><span class="language-xml"> $scope.message1 = &#x27;ccc&#x27;;   // 父元素改变，子元素也改变，子元素的message1 继承自父元素</span></span><br><span class="line"><span class="language-xml">   &#125;</span></span><br><span class="line"><span class="language-xml">&#125;)</span></span><br><span class="line"><span class="language-xml">myApp.directive(&quot;helloWorld&quot;,function()&#123;  // 该指令要做什么事!!!</span></span><br><span class="line"><span class="language-xml">return&#123;</span></span><br><span class="line"><span class="language-xml">//定义指令的用法</span></span><br><span class="line"><span class="language-xml">retrict:&#x27;EAMC&#x27;,</span></span><br><span class="line"><span class="language-xml">//E:元素、C：class名、M：注释、A：元素属性------不写则默认为EA。</span></span><br><span class="line"><span class="language-xml">template:&#x27;<span class="tag">&lt;<span class="name">div</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;  // 引用<span class="tag">&lt;<span class="name">hello-world</span>&gt;</span> 即可将template所对应的模板结构插入到html中</span></span><br><span class="line"><span class="language-xml">          emplateUrl:&#x27;../data/tpl1.html&#x27;     // 通过<span class="tag">&lt;<span class="name">hello-world</span>&gt;</span>引入外部html文件--最外层只能有一个根标签</span></span><br><span class="line"><span class="language-xml">replace:true,  // 去除自定义的外层标签 <span class="tag">&lt;<span class="name">hello-world</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">scope:&#123;message1:&#x27;@message1&#x27;&#125;,  //只有message1从外层$scope上获取,其他变量均来自自己内部scope上</span></span><br><span class="line"><span class="language-xml">controller:function($scope)&#123;   // 该控制器只控制 tpl1.html 优先从内部$scope中找绑定的属性</span></span><br><span class="line"><span class="language-xml">$scope.message1=&#x27;qqq&#x27;;</span></span><br><span class="line"><span class="language-xml">$scope.message2=&#x27;aaa&#x27;;</span></span><br><span class="line"><span class="language-xml">$scope.changeChild = function()&#123;</span></span><br><span class="line"><span class="language-xml">     $scope.message1 = &#x27;ccc&#x27;;   // 继承完之后 ,子元素内部事件只能更改自己内部的值</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">&#125;);</span></span><br><span class="line"><span class="language-xml">//使用：</span></span><br><span class="line"><span class="language-xml">tpl1.html---要求模板中无message2时不让其显示--该如何做?</span></span><br><span class="line"><span class="language-xml">答 : 通过指令内部的 scope 来断开与外部$scope 的连接 </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">message1</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">message2</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span>   <span class="comment">&lt;!--若内部scope对象为空,则message2 不显示!!!--&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">属性写法：</span></span><br><span class="line"><span class="language-xml">A:<span class="tag">&lt;<span class="name">div</span> <span class="attr">hello-world</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">E:<span class="tag">&lt;<span class="name">hello-world</span>&gt;</span><span class="tag">&lt;/<span class="name">hello-world</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">C:class写法：<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;helloWorld&gt;&lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">M:&lt;!--directive:hello-world--&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">angularjs中的事件触发机制</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">事件触发器---$emit</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">$on:在元素上添加监听事件</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">$scope.$emit(&#x27;event&#x27;);---向上级进行触发事件!!!</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">$scope.$broadcast(&#x27;event&#x27;);---向下级触发事件!!!</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">恒向无法触发事件!!!</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">//-----------------------------------------------------------------------</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">Batarang ：谷歌浏览器插件，开发angular </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">依赖管理工具：bower </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">Bower init,--install----,uninstall </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">配置文件：bower.json 管理第三方依赖</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">.bowerrc ：修改安装目录</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">//------------------------------------------------------------------------</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">内置服务扩展：</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">$scope.myUrl = $location.absUrl();</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">获取当前url 地址</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">$http:向服务器发送请求</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">$timeout:settimeout ()</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">$interval:setInterval ()</span></span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">一、控制器的合理使用、显示和隐式的依赖注入</span><br><span class="line">         不要在controller中做以下事情：</span><br><span class="line">1. 任何类型的DOM操作(controller中应该仅仅包含业务逻辑,表现逻辑放controller中会影响业务逻辑的可测试性，解决方式：将变现逻辑放在directive中)</span><br><span class="line">2. <span class="keyword">Input</span> formatting(输入格式化)---使用angular formcontrols代替</span><br><span class="line">3. Output filtering(输出格式化过滤)--使用angular filter代替</span><br><span class="line">4. 执行无状态或有状态的、controller共享的代码，使用angular services代替</span><br><span class="line">5. 实例化或管理其他组件的生命周期(例如：创建一个服务实例)-在模块中做</span><br><span class="line">二、指令和HTML校验</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">三、扩展</span><br><span class="line"></span><br><span class="line">一、Angularjs原理</span><br><span class="line">1. 双向数据绑定</span><br><span class="line">UI&lt;----&gt;数据</span><br><span class="line">脏检查(原理)：<span class="variable">$scope</span>上谁变了，谁没变</span><br><span class="line"><span class="keyword">var</span> json=&#123;a:12,b:5,c:33&#125;;</span><br><span class="line"><span class="keyword">var</span> oldJson=<span class="keyword">copy</span>(json);</span><br><span class="line"><span class="comment">// 对大型数据操作不便，影响性能。</span></span><br><span class="line"><span class="comment">//对json进行操作-----</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> oldJson)&#123;</span><br><span class="line"><span class="keyword">if</span>(oldJson[i] != json[i])&#123;</span><br><span class="line"><span class="comment">//数据发生了变化</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">2. 依赖、注入(让函数决定自己需要什么)</span><br><span class="line"><span class="comment">//  脏检查</span></span><br><span class="line"><span class="keyword">window</span>.onload=function()&#123;</span><br><span class="line"><span class="keyword">var</span> oTxt=document.getElementById(&#x27;txt1);</span><br><span class="line"><span class="keyword">var</span> aEle=document.getElementsByTagName(&#x27;*&#x27;);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=0;i&lt;aEle.length;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(aEle[i].ngModel)&#123;</span><br><span class="line">aEle[i].ngModel</span><br><span class="line"><span class="comment">// 查看ngModel对应的数据</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;&quot;</span> id=<span class="string">&quot;txt1&quot;</span> ng-model=<span class="string">&quot;a&quot;</span>&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"><span class="comment">//  依赖和注入</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> <span class="variable">$scope</span>=&#123;a:12,b:5,c:99,q:55,i:99&#125;;</span><br><span class="line">function show(a,b,c)&#123;</span><br><span class="line">alert(argument.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1. 要知道show要什么</span></span><br><span class="line"><span class="keyword">var</span> str=show.<span class="keyword">toString</span>();</span><br><span class="line"><span class="comment">//将函数转为字符串</span></span><br><span class="line">str.<span class="keyword">split</span>(&#x27;&#123;&#x27;)[0].<span class="built_in">match</span>(/\(.*\)/)[0].<span class="keyword">replace</span>(/\s+/<span class="keyword">g</span>,&#x27;&#x27;);</span><br><span class="line"><span class="comment">//提取函数参数的方法</span></span><br><span class="line">str=str.substring(1,str.length-1);</span><br><span class="line"><span class="keyword">var</span> arr=str.<span class="keyword">split</span>(&#x27;,&#x27;);</span><br><span class="line">console.<span class="built_in">log</span>(arr);</span><br><span class="line"><span class="comment">//根据这个数组从$scope中挑东西 </span></span><br><span class="line"><span class="comment">//alert(str);</span></span><br><span class="line"><span class="comment">//2. 给它相应的东西</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">args</span>=[];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=0;i&lt;arr.length;i++)&#123;</span><br><span class="line"><span class="keyword">args</span>[i]=<span class="variable">$scope</span>[arr[i]];</span><br><span class="line">&#125;</span><br><span class="line">show.apply(null,<span class="keyword">args</span>);</span><br><span class="line"><span class="comment">//3. 由函数决定参数--</span></span><br><span class="line">function show(a,c,i.q)&#123;</span><br><span class="line">alert(argument.length);</span><br><span class="line">console.<span class="built_in">log</span>(argument);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">二、ES6</span><br><span class="line">http:<span class="comment">//kangax.github.io/es5-compat-table/es6/</span></span><br><span class="line">查看浏览器对es6 语法的支持情况</span><br><span class="line">Babel 转码器：</span><br><span class="line"></span><br><span class="line">三、NodeJS</span><br><span class="line">四、KOA</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">给元素加事件：</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot; &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-init</span>=<span class="string">&quot;arr=[12,5,8,33,75];&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>   <span class="attr">ng-model</span>=<span class="string">num</span>&quot;&quot;&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span>  <span class="attr">ng-click</span>=<span class="string">&quot;arr.push(num)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">&quot;item in arr&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">item</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">ng-click=&quot;remove($index)&quot;;</span></span><br><span class="line"><span class="language-xml">ng-keydown=&quot;add($scope)&quot;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">/*</span></span><br><span class="line"><span class="language-xml">• 数据是核心！！！</span></span><br><span class="line"><span class="language-xml">*/</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">ng-click=&quot;bShow=!bShow&quot;-------&gt;开关</span></span><br><span class="line"><span class="language-xml">ng-show=&quot;false &quot;:不显示&quot;true&quot;:显示</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot; &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;按钮&quot;</span>  <span class="attr">ng-click</span>=<span class="string">&quot;bShow=!bShow&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-show</span>=<span class="string">&quot;bShow&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:200px;height:200px;background:#ccc;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">angularjs数据交互</span></span><br><span class="line"><span class="language-xml">1 原生js中的部分东西--angularjs用不了</span></span><br><span class="line"><span class="language-xml">2 数据多了就不可以使用ng-init、</span><span class="template-variable">&#123;&#123;&#125;&#125;</span><span class="language-xml">、来显示数据</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="面包屑">面包屑</h3><p><a href="https://github.com/LANIF-UI/dva-boot-admin">https://github.com/LANIF-UI/dva-boot-admin</a><br><a href="https://github.com/kuhami/react-ant">https://github.com/kuhami/react-ant</a><br><a href="https://github.com/zkboys/react-admin">https://github.com/zkboys/react-admin</a><br><a href="https://github.com/kuhami/react-ant-pro">https://github.com/kuhami/react-ant-pro</a><br><a href="https://github.com/MudOnTire/antd-pro-page-tabs">https://github.com/MudOnTire/antd-pro-page-tabs</a><br><a href="https://github.com/zpr1g/ant-design-pro-plus">https://github.com/zpr1g/ant-design-pro-plus</a><br><a href="https://github.com/lengjh/antd-design-pro-tabs">https://github.com/lengjh/antd-design-pro-tabs</a><br><a href="https://github.com/alitajs/alita/tree/master/packages/tabs-layout">https://github.com/alitajs/alita/tree/master/packages/tabs-layout</a></p><p>react-router-cache-route （推荐）<br>React Activation （和上面的工具同一个作者，Vue 中功能在 React 中的实现，配合 babel 预编译实现更稳定的 KeepAlive 功能）<br>umi-plugin-keep-alive （上面轮子的 umi 插件）<br>react-keeper （774 star）<br>react-antd-multi-tabs-admin (73 star，Antd多标签页后台管理模板）<br>react-live-route （207 star，也是一种缓存路由的轮子）<br>React Ant （232 star，基于Ant Design Pro 2.0 的多标签页tabs)<br>Ant Design Pro Plus （ 88 star，基于 ant-design-pro 做一些微小的工作）<br>React Admin （83 star，基于 Ant Design React 的管理系统架构）<br>ant_pro_tabs （82 star，基于 Ant Design Pro 4 实现多标签页面，包括：路由联动，列表，多详情页共存，自动新增、关闭标签等功能）<br>Antd Pro Page Tabs （ 54 star，Ant Design Pro 多页签，基于 UmiJS ）<br>alita/packages/tabs-layout（基于 umi 的移动端 react 框架的缓存插件）</p><p><a href="https://zhuanlan.zhihu.com/p/30669007">https://zhuanlan.zhihu.com/p/30669007</a></p><p><a href="https://github.com/careteenL/webpack-hmr">https://github.com/careteenL/webpack-hmr</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>react 16之前为 stack reconciler<br>递归遍历所有vDom节点进行diff比对，直至完成才释放主线程，不可中断！<br>例如：递归遍历复杂tree结构复，容易爆栈或cpu较慢，来不及响应</p><p>react 16之后 fiber reconciler</p><p>单向链表<br>可中断遍历，在中断时响应级别更高的操作</p><p>目的：<br>用户交互体验及开发体验的更新</p><p>Fiber架构</p><p>fiber: 单例的js对象<br>render: 产生 FiberNode 节点的vDom 树<br>通过前后树 比较 产生 更新序列<br>通常与useState相关</p><p>commit: <br>执行更新序列 updateQueue<br>通常与useEffect相关</p><p>Fiber架构中，react是通过render和commit两个phase来完成组建更新的</p><p><em>effect和state 形成更新链表，通过次序追踪所有问题</em></p><p>immer<br>不可变数据流</p><p>FiberNode：<br>1. stateNode<br>2. tag<br>3. type<br>4. updateQueue <br>5. memorizeState 环状链表，存储节点状态<br>6. memorizeProps</p><p>reconcile：协调算法(协调器)<br>对新旧状态生成的dom树，通过diff算法进行节点比对，计算需要更新的树节点</p><p>renderer: 渲染器<br>根据环境，渲染虚拟组建树</p><p>笔记本帧频60hz 即1s渲染60帧动画</p><p>渲染进程：<br>GUI渲染线程<br>JS引擎县城</p><p>arch</p><p>插件：<br>eslint-plugin-react-hook： hook语法检查</p><p>props作为形参 传递给函数组建（函数作用域下的变量）<br>函数组建的创建：props和state 对应不同的render 结果</p><p>变量提升：js执行时，将当前作用域下var以及function声明的变量提升至作用域顶部</p><p>形参相当于函数中定义的变量，实参是在运行时的函数调用时传入的参数</p><p>数据驱动视图<br>避免频繁dom查找，更新等操作哦</p><p>react源码<br>1. 虚拟dom<br>2. fiber<br>3. 根据虚拟dom构建fiber树<br>4. 根据虚拟dom及fiber树算diff结果<br>5. fiber与dom diff关系<br>6. <br>虚拟dom<br>描述真实dom的纯js对象，包含key,type,props<br><a href="http://babeljs.cn">babeljs.cn</a>： 可查看编译后的虚拟dom<br>React.createElement(tag, props, children1,children2)返回值即虚拟dom</p><p>DISABLE_NEW_TRAMFOR=true<br>沿用react17之前的转换器<br>jsx-transformer<br>编译打包阶段：jsx/tsx 转换成 createElement<br>浏览器执行阶段：createElement返回虚拟dom<br>ReactDOM.render：将虚拟dom 转换成真实dom插入容器</p><p>key唯一标识一个元素<br>ref 标识元素引用<br>$$typeof symbol类型，唯一标识一个react元素</p><p>fiber<br>id=root 节点称为rootFiber<br>一个虚拟dom在fiber树中对应一个fiber节点</p><p>构建fiber树<br>深度优先编历的过程，生成可中断的链表（effect副作用链），之后进行相应的dom操作</p><p>begonWork： 前序二叉树遍历<br>complateUnitWork： 按照二叉树后续排序方式执行<br>线性执行</p><p>react源码中一个节点只有一个子节点时，且该子节点为文本节点时，不会为子节点创建fiber节点</p><p>fiber链条</p><p>保留属性<br>key<br>type<br>Object.hasOwnProperty</p><hr><p>React dom diff</p><ol><li>react 基于flow 做代码检查</li></ol><p>虚拟dom</p><p>fiber<br>指针<br>return：指向父亲<br>child：指向大儿子<br>sibling： 指向弟弟</p><p>根据虚拟dom构建 fiber树</p><p>diff时如何根据 fiber树和虚拟dom算 diff结果</p><p>ReactDOM.render将虚拟dom渲染为真实dom并挂载至指定节点</p><p>React源码中，如果一个节点只有一个子节点，而且这个节点是文本节点的话，不会为此节点创建fiber节点</p><p>每个节点称为一个工作单元performUnitOfWork</p><p>beginWork（从上往下）- 开始顺序<br>通过深度优先遍历方式（二叉树前序方式）遍历fiber 树<br>先纵向 再横向</p><p>complateWork(从下往上) - 完成顺序<br>按二叉树后序（左右根）登记副作用链updateQueue</p><p>commit阶段执行updateQueue</p><p>副作用对应dom节点的增删改</p><p>案例：<br>班主任，班长，组长1、组长2，<br>组员1-1、组员1-2<br>组员2-1、组员2-2</p><p>ReactWorkTags 声明fiber标签</p><p>FiberRoot 容器对象 containerInfo div#root</p><p>hostRootFiber<br>fiber树的根节点，由createHostRootFiber 创建</p><p>hostComponent<br>原生节点 div、span等</p><ol><li>建立映射关系<br>FiberRoot.current = hostRootFiber;<br>hostRootFiber.stateNode = FiberRoot;</li></ol><p>stateNode含义: 指真实 dom 节点</p><ol start="2"><li>初始化更新队列</li></ol><blockquote><p>环状链表: 所有fiber 都会将更细内容放在更新队列中</p></blockquote><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> updateQueue = &#123;</span><br><span class="line">  shared: &#123;</span><br><span class="line">    pending: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">enqueueUpdate: 向当前fiber的更新队列中添加一个更新</span><br><span class="line">pending 永远指向最新的更新</span><br><span class="line">pending.<span class="keyword">next</span> 永远指向第一个更新</span><br><span class="line"></span><br><span class="line">updateContainer 将虚拟 DOM element 变成真实 dom 并渲染到 <span class="built_in">container</span> 容器中</span><br><span class="line"></span><br><span class="line">重点：不论哪个fiber发生更新，都会向上查找 根 FiberRoot, 然后开始调度更新</span><br><span class="line"></span><br><span class="line">performSyncWorkOnRoot：根据老的fiber树和更新对象创建新的fiber树，然后根据新的fiber树的状态更新真实dom</span><br><span class="line">根据新的虚拟dom 和老的fiber树进行对比，得到新的fiber树及diff结果</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">双缓冲: 两个fiber树不停的复用</span><br><span class="line"></span><br><span class="line">reactFiberFlag：给fiber添加副作用标识符，表示此fiber对应的dom节点要进行何种操作(CRUD)</span><br><span class="line"></span><br><span class="line">在dom diff过程中，会给fiber添加 副作用(链表)</span><br><span class="line"></span><br><span class="line">alternate： fiber树的替身。</span><br><span class="line">最大限度复用</span><br><span class="line"></span><br><span class="line">current 代表和当前页面中真实DOM完全一样的fiber树</span><br><span class="line"></span><br><span class="line">文本节点也是一个fiber节点</span><br><span class="line"></span><br><span class="line">·</span><br><span class="line"></span><br><span class="line">更新</span><br><span class="line">render</span><br><span class="line"><span class="number">1.</span> 根据新的虚拟DOM创建新的fiber树(根据老fiber和新的虚拟dom进行对比，创建新的fiber树)</span><br><span class="line"><span class="number">2.</span> 利用diff算法，找出新旧fiber树的差异，</span><br></pre></td></tr></table></figure><p>VDOM由 createElement创建<br>fiber 是 render里创建</p><p>一般情况下: 一个VDOM节点创建一个fiber节点</p><pre><code>commit根据diff结果，将新fiber树的内容同步到真实dom更新完后，新的fiber树就成为fiberRoot.currentfiber的主要目的？简化比对过程？优化性能？答案： 不是主要目的：- 可暂停，然后再恢复 - 每个fiber都是一个工作单元，每完成一个工作单元，会判断浏览器有没有更重要的任务去做，如果有，则暂停，让浏览器执行渲染之类更重要的工作。等浏览器忙完了，再回来继续执行render生成下一个fiber- 实际上有了fiber性能更差，但是解决了之前不可中断问题(页面掉帧、卡顿)为什么副作用用二进制表示，这样做的好处是？fiber终止渲染，react要开启并发渲染？怎么暂停和恢复？更新的时候都向上找根fiber，这样做是性能问题吧？react是怎么解决这种性能问题？workLoopSync: 开启工作循环，自上而下构建fiber树performUnitOfWork: 执行每个工作单元beginWork: 创建当前fiber的子fiberHostRoot 指原生树的根节点HostComponent fiber 树和dom树 大部分情况是一一对应的(一个fiber节点对应一个真实dom节点，除类组件和函数组件之外)**参考连接**- https://juejin.cn/post/7020239613000155150</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="Diff算法">Diff算法</h3><ul><li>减少了DOM节点的更新<ul><li>只更新发生变化了的DOM节点(DOM树：子节点越多，算法越慢，因为要对每个DOM节点进行遍历，判断每个节点是否发生了变化，如果变化了则进行数据更新)</li><li><a href="www.infoq.com/cn/articles/react-dom-diff">link</a></li></ul></li><li>算法思想<ul><li>逐层进行节点比较:解决了纵向深层的问题，找到不一样的则直接进行销毁，然后再进行新的创建</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">如：key 正确的使用方式</span><br><span class="line"><span class="comment">// 提高效率：减少DOM节点的操作[如果有key值，则不会直接砍掉，而是相互交换位置]</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ListItem</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;props.value&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">NumberList</span>(<span class="params">props</span>) &#123;</span><br><span class="line"> <span class="keyword">const</span> numbers = props.<span class="property">numbers</span>;</span><br><span class="line"> <span class="keyword">const</span> listItems = numbers.<span class="title function_">map</span>(<span class="function">(<span class="params">number</span>) =&gt;</span></span><br><span class="line">       <span class="language-xml"><span class="tag">&lt;<span class="name">ListItem</span> <span class="attr">key</span>=<span class="string">&#123;number.toString()&#125;</span> <span class="attr">value</span>=<span class="string">&#123;number&#125;</span> /&gt;</span></span> </span><br><span class="line">); </span><br><span class="line">  <span class="keyword">return</span> ( <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span> &#123;listItems&#125; <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span> ); </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>( <span class="language-xml"><span class="tag">&lt;<span class="name">NumberList</span> <span class="attr">numbers</span>=<span class="string">&#123;numbers&#125;</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>) );</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>[react17.x 源码解析(2)——fiber 树的构建与更新]</h1><p>下面我们结合源码，来看一下实际工作过程中 fiber 树的构建与更新过程。</p><p><strong>mount 过程</strong><br>react 首次 mount 开始执行时，以 ReactDOM.render 为入口函数，会经过如下一系列的函数调用：<br>ReactDOM.render——&gt; legacyRenderSubtreeIntoContainer——&gt;legacyCreateRootFromDOMContainer——&gt;createLegacyRoot——&gt;ReactDOMBlockingRoot——&gt;ReactDOMRoot——&gt;createRootImpl——&gt;createContainer——&gt;createFiberRoot——&gt;createHostFiber——&gt;createFiber</p><p>在 createFiber 函数中，调用 FiberNode 构造函数，创建了 rootFiber,他是 react 应用的根 fiber:</p><pre><code>// packages/react-reconciler/src/ReactFiber.old.jsconst createFiber = function(  tag: WorkTag,  pendingProps: mixed,  key: null | string,  mode: TypeOfMode,): Fiber &#123;  return new FiberNode(tag, pendingProps, key, mode);&#125;;</code></pre><p>在 createFiberRoot 函数中，调用 FiberRootNode 构造函数，创建了 fiberRoot,他指向真实根 dom 节点。</p><pre><code>// packages/react-reconciler/src/ReactFiberRoot.old.jsexport function createFiberRoot(  containerInfo: any,  tag: RootTag,  hydrate: boolean,  hydrationCallbacks: null | SuspenseHydrationCallbacks,): FiberRoot &#123;  const root: FiberRoot = (new FiberRootNode(containerInfo, tag, hydrate): any);  if (enableSuspenseCallback) &#123;    root.hydrationCallbacks = hydrationCallbacks;  &#125;  const uninitializedFiber = createHostRootFiber(tag);  root.current = uninitializedFiber;  uninitializedFiber.stateNode = root;  initializeUpdateQueue(uninitializedFiber);  return root;&#125;</code></pre><p>另外 createFiberRoot 函数中，还让 rootFiber 的 stateNode 字段指向了 fiberRoot,fiberRoot 的 current 字段指向了 rootFiber。从而一颗最原始的 fiber 树根节点就创建完成了：<br><img src="../images/17.x/fiberRoot-rootFiber.png" alt="image"><br>上面的 rootFiber 和 fiberRoot 创建完成后，react 就会根据 jsx 的内容去创建详细的 dom 树了，例如有如下的 jsx:<br><img src="../images/17.x/eg-jsx-1.png" alt="image"></p><p>react 对于 fiber 结构的创建和 更新，都是采用深度优先遍历，从 rootFiber(此处对应 id 为 root 的节点)开始，首先创建 child a1,然后发现 a1 有子节点 b1,继续对 b1 进行遍历，b1 有子节点 c1,再去创建 c1 的子节点 d1、d2、d3，直至发现 d1、d2、d3 都没有子节点来了，再回去创建 c2.</p><p>上面的过程中，每个节点开始创建时，执行 beginWork 流程，直至该节点的所有子孙节点都创建（更新）完成后，执行 completeWork 流程，流程的图示如下：<br><img src="../images/17.x/completeWork.png" alt="image"></p><p><strong>update 过程</strong><br>update 时，react 会根据新的 jsx 内容创建新的 workInProgress fiber，还是通过深度优先遍历，对发生改变的 fiber 打上不同的 flags 副作用标签，并通过 firstEffect、nextEffect 等字段形成 Effect List 链表。<br>例如上面的 jsx 结构，发生了如下的更新：</p><p><img src="../images/17.x/eg-jsx-1-update.png" alt="image"><br>react 会根据新的 jsx 解析后的内容调用 createWorkInProgress 函数创建 workInProgress fiber,对其标记副作用：</p><pre><code>// packages/react-reconciler/src/ReactFiber.old.jsexport function createWorkInProgress(current: Fiber, pendingProps: any): Fiber &#123;  let workInProgress = current.alternate;  if (workInProgress === null) &#123; // 区分 mount 还是 update    workInProgress = createFiber(      current.tag,      pendingProps,      current.key,      current.mode,    );    workInProgress.elementType = current.elementType;    workInProgress.type = current.type;    workInProgress.stateNode = current.stateNode;    if (__DEV__) &#123;      workInProgress._debugID = current._debugID;      workInProgress._debugSource = current._debugSource;      workInProgress._debugOwner = current._debugOwner;      workInProgress._debugHookTypes = current._debugHookTypes;    &#125;    workInProgress.alternate = current;    current.alternate = workInProgress;  &#125; else &#123;    workInProgress.pendingProps = pendingProps;    workInProgress.type = current.type;    workInProgress.subtreeFlags = NoFlags;    workInProgress.deletions = null;    if (enableProfilerTimer) &#123;      workInProgress.actualDuration = 0;      workInProgress.actualStartTime = -1;    &#125;  &#125;  // 重置所有的副作用  workInProgress.flags = current.flags &amp; StaticMask;  workInProgress.childLanes = current.childLanes;  workInProgress.lanes = current.lanes;  workInProgress.child = current.child;  workInProgress.memoizedProps = current.memoizedProps;  workInProgress.memoizedState = current.memoizedState;  workInProgress.updateQueue = current.updateQueue;  // 克隆依赖  const currentDependencies = current.dependencies;  workInProgress.dependencies =    currentDependencies === null      ? null      : &#123;          lanes: currentDependencies.lanes,          firstContext: currentDependencies.firstContext,        &#125;;  workInProgress.sibling = current.sibling;  workInProgress.index = current.index;  workInProgress.ref = current.ref;  if (enableProfilerTimer) &#123;    workInProgress.selfBaseDuration = current.selfBaseDuration;    workInProgress.treeBaseDuration = current.treeBaseDuration;  &#125;  if (__DEV__) &#123;    workInProgress._debugNeedsRemount = current._debugNeedsRemount;    switch (workInProgress.tag) &#123;      case IndeterminateComponent:      case FunctionComponent:      case SimpleMemoComponent:        workInProgress.type = resolveFunctionForHotReloading(current.type);        break;      case ClassComponent:        workInProgress.type = resolveClassForHotReloading(current.type);        break;      case ForwardRef:        workInProgress.type = resolveForwardRefForHotReloading(current.type);        break;      default:        break;    &#125;  &#125;  return workInProgress;&#125;</code></pre><p>最终生成的 workInProgress fiber 图示如下：<br><img src="../images/17.x/workInProgress-fiber.png" alt="image"><br>然后如上面所说，current fiber 和 workInProgress fiber 中对应的 alternate 会相互指向，然后 workInProgress fiber 完全创建完成后，fiberRoot 的 current 字段的指向会从 current fiber 中的 rootFiber 改为 workInProgress fiber 中的 rootFiber:<br><img src="../images/17.x/workInProgress-fiber-1.png" alt="image"></p><p>然后如上面所说，current fiber 和 workInProgress fiber 中对应的 alternate 会相互指向，然后 workInProgress fiber 完全创建完成后，fiberRoot 的 current 字段的指向会从 current fiber 中的 rootFiber 改为 workInProgress fiber 中的 rootFiber:<br><img src="../images/17.x/workInProgress-fiber-2.png" alt="image"></p><p>下面我们将探究以下部分内容的源码：</p><ul><li>更新任务的触发</li><li>更新任务的插件</li><li>reconciler 过程同步和异步遍历及执行任务</li><li>scheduler 是如何实现帧空闲时间调度任务以及中断任务的</li></ul><p><strong>触发更新</strong></p><p>触发更新的方式主要有以下几种：ReactDOM.render、setState、forUpdate 以及 hooks 中的 useState 等，关于 hooks 的我们后面再详细讲解，这里先关注前三种情况。</p><p><strong>ReactDOM.render</strong></p><p>ReactDOM.render 作为 react 应用程序的入口函数，在页面首次渲染时便会触发，页面 dom 的首次创建，也属于触发 react 更新的一种情况。其整体流程如下：<br><img src="../images/17.x/reactDom-render.png" alt="image"></p><p>首先调用 legacyRenderSubtreeIntoContainer 函数，校验根节点 root 是否存在，若不存在，调用 legacyCreateRootFromDOMContainer 创建根节点 root、rootFiber 和 fiberRoot 并绑定他们之间的引用关系，然后调用 updateContaioner 去批量执行后面的更新流程；若存在，直接调用 updateContainer 去批量执行后面的更新流程：</p><pre><code>// packages/react-dom/src/client/ReactDOMLegacy.jsfunction legacyRenderSubtreeIntoContainer(  parentComponent: ?React$Component&lt;any, any&gt;,  children: ReactNodeList,  container: Container,  forceHydrate: boolean,  callback: ?Function,) &#123;  // ...  let root: RootType = (container._reactRootContainer: any);  let fiberRoot;  if (!root) &#123;    // 首次渲染时根节点不存在    // 通过 legacyCreateRootFromDOMContainer 创建根节点、fiberRoot 和 rootFiber    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(      container,      forceHydrate,    );    fiberRoot = root._internalRoot;    if (typeof callback === 'function') &#123;      const originalCallback = callback;      callback = function() &#123;        const instance = getPublicRootInstance(fiberRoot);        originalCallback.call(instance);      &#125;;    &#125;    // 非批量执行更新流程    unbatchedUpdates(() =&gt; &#123;      updateContainer(children, fiberRoot, parentComponent, callback);    &#125;);  &#125; else &#123;    fiberRoot = root._internalRoot;    if (typeof callback === 'function') &#123;      const originalCallback = callback;      callback = function() &#123;        const instance = getPublicRootInstance(fiberRoot);        originalCallback.call(instance);      &#125;;    &#125;    // 批量执行更新流程    updateContainer(children, fiberRoot, parentComponent, callback);  &#125;  return getPublicRootInstance(fiberRoot);&#125;</code></pre><p>updateContainer 函数中，主要做了以下几件事情：</p><ul><li>requestEventTime:获取更新触发的时间</li><li>requestUpdateLane:获取当前任务优先级</li><li>createUpdate:创建更新</li><li>enqueueUpdate:将任务推进更新队列</li><li>scheduleUpdateOnFiber:调度更新</li></ul><p>关于这几个函数稍后会详细降到：</p><pre><code>export function updateContainer(element:ReactNodeList,container:OpaqueRoot,parentComponent:?React$Component&lt;any,any&gt;,callback:?Function,):Lane&#123;// ...const current = container.current;const eventTime = requestEventTime();//获取更新触发的时间// ...const lane = requestUpdateLane(current);//获取任务优先级if (enableSchedulingProfiler)&#123;markRenderScheduled(lane);&#125;const context = getContextForSubtree(parentComponent);if (container.context === null)&#123; container.context = context;&#125;else&#123;container.pendingContext = context;&#125;const update = createUpdate(eventTime,lane);//创建更新任务update.payload = &#123;element&#125;;callback = callback === undefined ? null : callback;if(callback !== null)&#123; update.callback = callback;&#125; enqueueUpdate(current,update);//将任务推入更新队列 scheduleUpdateOnFiber(current,lane,eventTime);//schedule进度调度 return lane;&#125;</code></pre><p><strong>setState</strong></p><p>setState 是类组件中我们最常用的修改状态的方法，状态修改会触发更新流程，其执行过程如下：<br><img src="../images/17.x/setState-flow.png" alt="image"></p><p>class 组件在原型链上定义了 setState 方法，其调用了触发器 updater 上的 enqueueSetState 方法：<br><img src="../images/17.x/setState-sourceCode.png" alt="image"><br>然后我们再来看以下 updater 上定义的 enqueueSetState 方法，一看到这我们就了然了，和 updateContainer 方法中做的事情几乎一模一样，都是触发后续的更新调度。<br><img src="../images/17.x/enqueueSetState.png" alt="image"></p><p><strong>forceUpdate</strong><br>forceUpdate 的流程与 setState 几乎一模一样：<br><img src="../images/17.x/forceUpdate.png" alt="image"><br>同样其调用了触发器 updater 上的 enqueueForceUpdate 方法，enqueueForceUpdate 方法也同样是触发了一系列的更新流程：</p><p><img src="../images/17.x/enqueueForceUpdate.png" alt="image"></p><p><strong>创建更新任务</strong></p><p>可以发现，上述的三种触发更新的动作，最后殊途同归，都会走上上述流程图中从 requestEventTime 到 scheduleUpdateOnFiber 这一流程，去创建更新任务，我们先详细看一下更新任务是如何创建的。</p><p><strong>获取更新触发时间</strong></p><p>前面讲到过，react 执行更新过程中，会将更新任务拆解，每一帧优先执行高优先级的任务，从而保证用户体验的流畅。那么即使对于同样优先级的任务，在任务多的情况下该优先执行哪一些呢？</p><p>react 通过 requestEventTime 方法去创建一个 currentEventTime，用于标识更新任务触发的时间，对于相同时间的任务，会批量去执行。同样优先级的任务，currentEventTime 值越小，就会越早执行。</p><p>我们看一下 requestEventTime 方法的实现：</p><p><img src="../images/17.x/requestEventTime.png" alt="image"></p><p>在这个方法中，（executionContext &amp; (RenderContext | CommitContext)）做了二进制运算，RenderContext 代表着 react 正在计算更新，CommitContext 代表着 react 正在提交更新。所以这句话是判断当前 react 是否处在计算或者提交更新的阶段，如果是则直接返回 now()。<br><img src="../images/17.x/reactFiberWorkLoop.old.png" alt="image"><br>再来看一下 now 的代码，这里的意思是，当前后的更新任务时间差小于 10ms 时，直接采用上次的 Scheduler_now,这样可以抹平 10ms 内更新任务的时间差，有利于批量更新：</p><pre><code>// packages/react-reconciler/src/SchedulerWithReactIntegration.old.jsexport const now = initailTimeMs &lt; 10000 ? Scheuler_now : ()=&gt;Scheduler_now() - initialTimeMs;</code></pre><p>综上所述，requestEvent 做的事情如下：</p><ul><li>在 react 的 render 和 commit 阶段我们直接获取更新任务的触发事件，并抹平相差 10ms 以内的更新任务以便批量执行。</li><li>当 currentEventTime 不等于 NoTimestamp 时，则判断其正在执行浏览器事件，react 想要同样优先级的更新任务保持相同的时间，所以直接返回上次的 currentEventTime</li><li>如果是 react 上次中断之后的首次更新，那么给 currentEventTime 赋一个新的值</li></ul><p><strong>划分更新任务优先级</strong><br>说完了相同优先级任务的触发时间，那么任务的优先级又是如何划分的呢？这里就要提到 requestUpdateLane,我们来看一下源码：<br><img src="../images/17.x/requestUpdateLane.png" alt="image"><br>它首先找出会通过 getCurrentPriorityLevel 方法，根据 Scheduler 中记录的事件优先级，获取任务调度的优先级 schedulerPriority。然后通过 findUpdateLane 方法计算得出 lane，作为更新过程中的优先级。</p><p>findUpdateLane 这个方法中，按照事件的类型，匹配不同级别的 lane,事件类型的优先级划分如下，值越高，代表的优先级越高：<br><img src="../images/17.x/reactFiberLane.png" alt="image"></p><p><strong>创建更新对象</strong><br>eventTime 和 lane 都创建好了之后，就该创建更新了，createUpdate 就是基于上面两个方法所创建的 eventTime 和 lane,去创建一个更新对象：<br><img src="../images/17.x/createUpdate.png" alt="image"></p><p><strong>关联 fiber 的更新对列</strong></p><p>创建好了 update 对象之后，紧接着调用 enqueueUpdate 方法把 update 对象放到关联的 fiber 的 updateQueue 对列之中：</p><pre><code>// packages/react-reconciler/src/ReactUpdateQueue.old.jsexport function enqueueUpdate&lt;State&gt;(fiber: Fiber, update: Update&lt;State&gt;) &#123;  // 获取当前 fiber 的更新队列  const updateQueue = fiber.updateQueue;  if (updateQueue === null) &#123;    // 若 updateQueue 为空，表示 fiber 还未渲染，直接退出    return;  &#125;  const sharedQueue: SharedQueue&lt;State&gt; = (updateQueue: any).shared;  const pending = sharedQueue.pending;  if (pending === null) &#123;    // pending 为 null 时表示首次更新，创建循环列表    update.next = update;  &#125; else &#123;    // 将 update 插入到循环列表中    update.next = pending.next;    pending.next = update;  &#125;  sharedQueue.pending = update;  // ...&#125;</code></pre><p><strong>根据任务类型执行不同更新</strong><br>reconciler 阶段会协调任务去执行，以 scheduleUpdateOnFiber 为入口函数，首先会调用 checkForNestedUpdates 方法，检查嵌套的更新数量，若嵌套数量大于 50 层时，被认为是循环更新（无限更新）。此时会抛出异常，避免了例如在类组件 render 函数中调用了 setState 这种死循环的情况。</p><p>然后通过 markUpdateLaneFromFiberToRoot 方法，向上递归更新 fiber 的 lane,lane 的更新很简单，就是将当前任务 lane 与之前 lane 进行二进制或运算叠加。</p><p><img src="../images/17.x/scheduleUpdateOnFiber.png" alt="image"></p><p>然后会根据任务类型以及当前线程所处的 react 执行阶段，去判断进行何种类型的更新：</p><p><strong>执行同步更新</strong></p><p>当任务的类型为同步任务，并且当前的 js 主线程空闲（没有正在执行的 react 任务时），会通过 performSyncWorkOnRoot(root)方法开始执行同步任务。</p><p>performSynWorkOnRoot(root)方法开始执行同步任务。<br>performSyncWorkOnRoot 里面主要做了两件事：</p><ul><li>renderRootSync 从根节点开始进行同步渲染任务</li><li>commitRoot 执行 commit 流程</li></ul><p><img src="../images/17.x/performSyncWorkOnRoot.png" alt="image"></p><p>当任务类型为同步类型，但是 js 主线程非空闲时。会执行 ensureRootIsScheduled 方法：</p><p><img src="../images/17.x/ensureRootIsScheduled.png" alt="image"></p><p>ensureRootIsScheduled 方法中，会先看到加入了新的任务后根节点任务优先级是否有变更，如果无变更，说明新的任务会被当前的 schedule 一同执行；如果有变更，则创建新的 schedule,然后也是调用 performSyncWorkOnRoot(root)方法开始执行同步任务。</p><p><strong>执行可中断更新</strong></p><p>当任务的类型不是同类型时，react 也会执行 ensureRootIsScheduled 方法，因为是异步任务，最终会执行 performConcurrentWorkOnRoot 方法，去进行可中断的更新，下面会详细讲到。</p><p><strong>workLoop</strong></p><p>同步</p><p>以同步更新为例，performSyncWorkOnRoot 会经过以下流程，performSyncWorkOnRoot——&gt;renderRootSync——&gt;workLoopSync。</p><p>workLoopSync 中，只要 workInProgress(workInProgress fiber 树中新创建的 fiber 节点) 不为 null，就会一直循环，执行 performUnitOfwork 函数。</p><p><img src="../images/17.x/workLoopSync.png" alt="image"></p><p><strong>可中断</strong></p><p>可中断模式下，performConcurrentWorkOnRoot 会执行以下过程：performConcurrentWorkOnRoot——&gt;renderRootConcurrent——&gt;workLoopConcurrent。</p><p>相比较于 workLoopSync,workLoopConcurrent 在每一次对 workInProgress 执行 performUnitOfWork 前，会先判断以下 shouldYield（）的值。若为 false 则继续执行，若为 true 则中断执行。</p><p><img src="../images/17.x/workLoopConcurrent.png" alt="image"></p><p><strong>performUnitOfWork</strong></p><p>最终无论是同步执行任务，还是可中断地执行任务，都会进入 performUnitOfWork 函数中。</p><p>performUnitOfWork 中会以 fiber 作为单元，进行协调过程。每次 beginWork 执行后都会更新 workIngProgress，从而响应了上面 workLoop 的循环。</p><p>直至 fiber 树便利完成后，workInProgress 此时值为 null，执行 completeUnitOfWork 函数。</p><p><img src="../images/17.x/performUnitOfWork.png" alt="image"></p><p><strong>beginWork</strong></p><p>beginWork 是根据当前执行环境，封装调用了 originalBeginWork 函数：</p><p><img src="../images/17.x/beginWork.png" alt="image"></p><p>originalBeginWork 中，会根据 workInProgress 的 tag 属性，执行不同类型的 react 元素的更新函数。但是他们都大同小异，不论是 tag 是何种类型，更新函数最终都会去调用 reconcileChildren 函数。</p><p><img src="../images/17.x/beginWork-sourceCode.png" alt="image"></p><p>以 updateHostRoot 为例，根据根 fiber 是否存在，去执行 mountChildFibers 或者 reconcileChildren:</p><p><img src="../images/17.x/updateHostRoot.png" alt="image"></p><p>reconcileChildren 做的事情就是 react 的另一核心之一 diff 过程，在下一篇文章中会详细讲。</p><p><strong>completeUnitOfWork</strong></p><p>当 workInProgress 为 null 时，也就是当前任务的 fiber 树遍历完之后，就进入到了 completeUnitOfWork 函数。</p><p>经过了 beginWork 操作，workInProgress 节点已经被打上了 flags 副作用标签。completeUnitOfWork 方法中主要是逐层收集 effects 链，最终收集到 root 上，供接下来的 commit 阶段使用。</p><p>completeUnitOfWork 结束后，render 阶段便结束了，后面就到了 commit 阶段。</p><p><img src="../images/17.x/completeUnitOfWork.png" alt="image"></p><p><strong>scheduler</strong></p><p><strong>实现帧空闲调度任务</strong></p><p>浏览器会在每一帧空闲时刻去执行 react 更新任务，那么空闲时刻去执行是如何实现的呢？我们很容易联想到一个 api——————requestldleCallback。但由于 requestldleCallback 的兼容性问题以及 react 对应部分高优先级任务可能牺牲部分帧的需要，react 通过自己实现了类似的功能代替了 requestldleCallback。</p><p>我们上面讲到执行可中断更新时，performConcurrentWorkOnRoot 函数时通过 scheduleCallback 包裹起来的：<br>scheduleCallback(<br>schedulerPriorityLevel,<br>performConcurrentWorkOnRoot.bind(null,root),<br>)</p><p>scheduleCallback 函数是引用了 packages/scheduler/src/Scheduler.js 路径下的 unstable_scheduleCallback 函数，我们来看一下这个函数，他会去按计划插入调度任务：<br><img src="../images/17.x/unstable-scheduleCallback.png" alt="image"></p><p>将任务插入了调度队列之后，会通过 requestHostCallback 函数去调度任务。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>[react17.x 源码解析(1)——源码目录及 react 架构]</h1><p>react 的源码目录如下，主要有三个文件夹：</p><ul><li>fixtures:一些测试 demo,方便 react 编码时的测试</li><li>packages: react 的主要源码内容</li><li>script: 和 react 打包、编译、本地开发相关的命令</li></ul><p>我们要探究的源码内容，都存放在 packages 文件夹下：</p><p><img src="../images/17.x/folder.png" alt="image"></p><p>根据 packages 下面各个部分的功能，我将其划分为了几个模块：</p><p><strong>核心 api</strong><br>react 的核心 api 都位于 packages/react 文件夹下，包括 createElement、memo、context 以及 hooks 等，凡是通过 react 包引入的 api,都位于此文件夹下。</p><p><strong>调度和协调</strong><br>调度和协调是 react16 fiber 出现后的核心功能，和他们相关的包如下：</p><ul><li>scheduler:对任务进行调度，根据优先级排序</li><li>react-conciler:diff 算法相关，对 fiber 进行副作用标记<br><img src="../images/17.x/scheduler.png" alt="image"></li></ul><p><strong>渲染</strong><br>和渲染相关的内容包括以下几个目录：</p><ul><li>react-art:canvas、svg 等内容的渲染</li><li>react-dom:浏览器环境下的渲染，也是我们本系列中主要涉及讲解的渲染的包</li><li>react-native-renderer: 用于原生环境渲染相关</li><li>react-noop-renderer: 用于调试环境的渲染</li></ul><p><strong>辅助包</strong></p><ul><li>shared:定义了 react 的公共方法和变量</li><li>react-is:react 中的类型判断</li></ul><p><strong>其他</strong><br>其他的包和本次 react 源码探究的关联不是很多，不过多介绍。</p><p><strong>react 架构</strong><br>react 为了保证页面能够流畅渲染，react16 之后的更新过程分为 render 和 commit 两个阶段。render 阶段包括 Scheduler(调度器)和 Reconciler(协调器)，commit 阶段包括 Renderer(渲染器)：</p><p><img src="../images/17.x/arch.png" alt="image"></p><p><strong>触发更新</strong><br>触发更新的方式主要有以下几种：ReactDOM.render(包括首次渲染)、setState、forUpdate、hooks 中的 useState 以及 ref 的改变等引起的。</p><p><strong>scheduler</strong><br>当首次渲染或组件状态发生更新等情况时，此时页面就要发生渲染了。scheduler 过程会对诸多的任务进行优先级排序，让浏览器的每一帧优先执行高优先级的任务（例如动画、用户点击输入事件等），从而防止 react 的更新任务太大影响到用户交互，保证了页面的流畅性。</p><p><strong>reconciler</strong><br>reconciler 过程中，会开始根据优先级执行更新任务。这一过程主要是根据最新状态构建新的 fiber 树，与之前的 fiber 树进行 diff 对比，对 fiber 节点标记不同的副作用，对渲染过程中真实 dom 的增删改。</p><p><strong>commit</strong><br>在 render 阶段中，最终会生成一个 effectList 数组，记录了页面真实 dom 的新增、删除和替换等以及一些事件响应，commit 会根据 effectList 对真实的页面进行更新，从而实现页面的改变。</p><p><strong>jsx 的转换</strong><br>在 React16 版本及之前，应用程序通过@babel/preset-react 将 jsx 语法转换为 React.createElement 的 js 代码，因此需要显示将 React 引入，才能正常调用 createElement。<br>React17 版本之后，官方与 babel 进行了合作，直接通过将 react/jsx-runtime 对 jsx 语法进行了新的转换而不依赖 React.createElement,转换的结果便是可直接供 ReactDOM.render 使用的 ReactElement 对象。因此如果在 React17 版本后只是用 jsx 语法不使用其它的 react 提供的 api,可以不引入 React，应用程序依然能够正常运行。</p><p><strong>React.createElement 源码</strong><br>虽然现在 react17 之后我们可以不再依赖 React.createElement 这个 api 了，但是实际场景中以及很多开源包中可能会有很多通过 React.createElement 手动创建元素的场景，所以推荐学习一下 Reat.createElement 源码。</p><p>React.createElement 其接收三个或以上参数：</p><ul><li>type:要创建的 React 元素类型，可以是标签名称字符串，如’div’或者’span’等；也可以说是 React 组件类型（class 组件或者函数组件）；或者是 React fragment 类型。</li><li>config:写在标签上的属性的集合，js 对象格式，若标签上未添加任何属性则为 null。</li><li>children:从第三个参数开始后的参数为当前创建的 React 元素的子节点，每个参数的类型，若是当前元素节点的 textContent 则为字符串类型；否则为新的 React.createElement 创建的元素。</li></ul><p>函数中会对参数进行一系列的解析，源码如下，对源码相关的理解都用注释进行了标记：</p><pre><code>export function createElement(type,config,children)&#123; let propName; //记录标签上的属性集合 const props = &#123;&#125;; let key = null; let ref = null; let self = null; let source = null; //config不为null时，说明标签上有属性，将属性添加到props中 //其中，key和ref为react提供的特殊属性，不加入到props中，而是用key和ref单独记录 if(config !=null)&#123; if(hasValidRef(config))&#123; //有合法的ref时，则给ref赋值 ref = config.ref; if(__DEV__)&#123; warnIfStringRefCannotBeAutoConverted(config); &#125; &#125; if(hasValidKey(config))&#123; //有合法的key时，则给key赋值 key = '' + config.key; &#125; //self和source是开发环境下对代码在编译器中位置信息进行记录，用于开发环境下调试 self = config.__self === undefined ? null : config.__self; source = config.__source === undefined ? null : config.__source; // 将config中除key、ref、__self、__source之外的属性添加到props中 for(propName in config)&#123;  if(  hasOwnProperty.call(config,propName)&amp;&amp;  !RESERVED_PROPS.hasOwnProperty(propName)  )&#123;  props[propName] = config[propName];  &#125; &#125; &#125; //将子节点添加到props的children属性上 const childrenLength = arguments.length -2; if(childrenLength===1)&#123; //共3个参数时表示只有一个子节点，直接将子节点赋值给props的children属性 props.children = children; &#125;else if (childrenLength &gt; 1)&#123; //3个以上参数时表示有多个子节点，将子节点push到一个数组中然后将数组赋值给props的children const childArray = Array(childrenLength); for(let i=0;i&lt;childrenLength;i++)&#123; childArray[i] = arguments[i+2]; &#125; //开发环境下冻结 childArray,防止被随意修改 if(__DEV__)&#123;  if(Object.freeze)&#123;  Object.freeze(childArray);  &#125; &#125; props.children = childArray; &#125; //如果有defaultProps,对其遍历并且将用户在标签上未对其手动设置属性添加props中 //此处针对class组件类型 if(type &amp;&amp; type.defaultProps)&#123;  const defaultProps = type.defaultProps;  for(propName in defaultProps)&#123;   if(props[propName]===undefined)&#123;    props[porpName] = defaultProps[propName];   &#125;  &#125; &#125; // key 和 ref不挂载到prps上 // 开发环境若想通过props.key 或者props.ref获取warning if(__DEV__)&#123;   if(key || ref)&#123;     const displayName = typeof type === 'function' ? type.displayName || type.name || 'Unknown' : type; if(key)&#123; defineKeyPropWarningGetter(props,displayName); &#125; if (ref)&#123; defineRefPropWarningGetter(props,displayName); &#125;   &#125; &#125; // 调用 ReactElement并返回 return ReactElement( type, key, self, source, ReactCurrentOwner.current, props, )&#125;</code></pre><p>由此可知，React.createElement 做的事情主要有：</p><ul><li><p>解析 config 参数中是否有合法的 key、ref、__source 和__self 属性，若存在分别赋值给 key、ref、source 和 self；将剩余的属性解析挂载到 props 上</p></li><li><p>除 type 和 config 外后面的参数，挂载到 props.children 上</p></li><li><p>针对类组件，如果 type.defaultProps 存在，遍历 type.defaultProps 的属性，如果 props 不存在该属性，则添加到 props 上</p></li><li><p>将 type、key、ref、self、props 等信息，调用 ReactElement 等函数创建虚拟 dom，ReactElement 主要是在开发环境下通过 Object.defineProperty 将_store、_self、_source 设置为不可枚举，提高 element 比较时的性能：</p><p>const ReactElement = function(type,key,ref,self,source,owner,props){<br>const element = {<br>//用于表示是否为 ReactElement<br>&amp;&amp;typeof:REACT_ELEMENT_TYPE,</p><p>// 用于创建真实 dom 的相关信息<br>type:type,<br>key:key,<br>ref:ref,<br>props:props,</p><p>_owner:owner,<br>};<br>if(<strong>DEV</strong>){<br>element._store = {};<br>//开发环境下将_store、_self、_source 设置为不可枚举，提高 element 的比较性能<br>Object.defineProperty(element._store,‘validated’,{<br>configurable:false,<br>enumerable:false,<br>writable:true,<br>value:false,<br>})<br>Object.defineProperty(element, ‘_self’, {<br>configurable: false,<br>enumerable: false,<br>writable: false,<br>value: self,<br>});</p><pre><code>Object.defineProperty(element, '_source', &#123;  configurable: false,  enumerable: false,  writable: false,  value: source,&#125;);// 冻结 element 和 props，防止被手动修改if (Object.freeze) &#123;  Object.freeze(element.props);  Object.freeze(element);&#125;</code></pre><p>}</p><p>return element;<br>};</p></li></ul><p>所以通过流程图总结一下 createElement 所做的事情如下：<br><img src="../images/17.x/createElement.png" alt="image"></p><p><strong>React.Component 源码</strong></p><pre><code>function Component(props,context,updater)&#123;//接收props,context,updater进行初始化，挂载到this上this.props = props;this.context = context;this.refs = emptyObject;//updater 上挂载了isMounted、enqueueForceUpdate、enqueueSetState等触发器方法this.updater = updater || ReactNoopUpdateQueue;&#125;//原型链上挂载 isReactComponent,在ReactDOM.render时用于和函数组件作区分Component.prototype.isReactComponent = &#123;&#125;;//给类组件添加`this.setState`方法Component.prototype.setState = function(partialState,callback)&#123;//验证参数是否合法 invariant( typeof partialState === 'object' || typeof partialState === 'function' || partialState == null ); //添加至 enqueueSetState队列 this.updater.enqueueSetState(this,partialState,callback,'setState');&#125;;// 给类组件添加 `this.forceUpdate`方法Component.prototype.forceUpdate = function(callback)&#123;//添加至 enqueueForceUpdate队列this.updater.enqueueForceUpdate(this,callback,'forceUpdate');&#125;</code></pre><p>从源码上可以得知，React.Component 主要做了以下几件事情：</p><ul><li>将 props,context,updater 挂载到 this 上</li><li>在 Component 原型链上添加 isReactComponent 对象，用于标记类组件</li><li>在 Component 原型链上添加 setState 方法</li><li>在 Component 原型链上添加 forceUpdate 方法</li></ul><p>这样我们就理解了 react 类组件的 super()作用，以及 this.setState 和 this.forceUpdate 的由来</p><p><strong>总结</strong><br>react17 之后 babel 对 jsx 的转换就是比之前多了一步 React.createElement 的动作：<br><img src="../images/17.x/babel-jsx.png" alt="image"></p><p>通过 babel 及 React.createElement,将 jsx 转换为了浏览器能识别的原生 js 语法，为 react 后续对状态改变、事件响应以及页面更新奠定了基础。</p><p><strong>fiber 节点结构</strong></p><p>fiber 是一种数据结构，每个 fiber 节点的内部，都保存了 dom 相关信息、fiber 树相关的引用、要更新时的副作用等，我们可以看下源码中的 fiber 结构：</p><pre><code>export type Fiber = &#123;|//作为静态数据结构，存储节点dom相关信息tag:WorkTag,//组件的类型，取决于react的元素类型key:null | string,elementType:any,//元素类型type:any,//定义与此fiber关联的功能或类。对于组件，他指向构造函数；对于DOM元素，他指定HTML tagstateNode:any,//真实dom节点// fiber链表树相关return:Fiber|null,//父 fiberchild:Fiber|null,//第一个子fibersibling: Fiber | null,//下一个兄弟fiberindex:number,//在父fiber下面的子fiber中的下标ref: |null |(((handle:mixed)=&gt;void)&amp;&#123;_stringRef:?string,...&#125;) |RefObject, //工作单元，用于计算 state和props渲染 pendingProps:any,//本次渲染需要使用props memoizedProps:any,//上次渲染使用的props updateQueue:mixed,//用于状态更新、回调函数、DOM更新的队列 memoizedState:any,//上次渲染后的state状态 dependencies:Dependencies | null, //contexts、events等依赖 mode:TypeOfMode, //副作用相关 flags:Flags,//记录更新时当前fiber的副作用（删除、更新、替换等）状态 subtreeFlags:Flags, //当前子树的副作用状态 deletions:Array&lt;Fiber&gt; | null, //要删除的子fiber nextEffet:Fiber | null,//下一个有副作用的fiber firstEffect:Fiber | null,//指向第一个有副作用的fiber lastEffectZ: Fiber | null,//指向最后一个有副作用的fiber //优先级相关 lanes:Lanes, childLanes:Lanes, alternate:Fiber | null,//指向workInProgress fiber树中对应的节点 actualDuration?:number, actualStartTime?:number, selfBaseDuration?:number, treeBaseDuration?:number, _debugID?:number, _debugSource?:Source | null, _debugOwner?:Fiber | null, _debugIsCurrentlyTiming?:boolean, _debugNeedsRemount?:bollean, _debugHookTypes?:Array&lt;HooKType&gt; | null,|&#125;;</code></pre><p><strong>dom 相关属性</strong></p><p>fiber 中和 dom 节点相关的信息主要关注 tag、key、type、和 stateNode。</p><p><strong>tag</strong></p><p>fiber 中 tag 属性的 ts 类型为 workType,用于标记不同的 react 组件类型，我们可以看一下源码中 workType 的枚举值；</p><pre><code>//packages/react-reconciler/src/ReactWorkTags.jsexport const FunctionComponent = 0;export const ClassComponent = 1;export const IndeterminateComponent =2;export const HostRoot = 3;export const HostPortal = 4;export const HostComponent = 5;export const HostText = 6;export const Fragment = 7;export const Mode = 8;export const ContextConsumer = 9;export const ContextProvider = 10;export const ForwardRef = 11;export const Profiler = 12;export const SuspenseComponent = 13;export const MemoComponent = 14;export const SimpleMemoComponent = 15;export const LazyComponent = 16;export const IncompleteClassComponent = 17;export const DehydratedFragment = 18;export const SuspenseListComponent = 19;export const FundamentalComponent = 20;export const ScopeComponent = 21;export const Block = 22;export const OffscreenComponent = 23;export const LegacyHiddenComponent = 24;</code></pre><p>在 react 协调时，beginWork 和 completeWork 等流程时，都会根据 tag 类型的不同，去执行不同的函数处理 fiber 节点。</p><p><strong>key 和 type</strong><br>key 和 type 两项用于 react diff 过程中确定 fiber 是否可以复用。<br>key 为用户定义的唯一值。type 定义与此 fiber 关联的功能或类。对于组件，他指向函数或者类本身；对于 DOM 元素，他指定 HTML tag。</p><p><strong>stateNode</strong><br>stateNode 用于记录当前 fiber 所对应的真实 dom 节点或者当前虚拟组件的实例，这么做的原因第一是为了实现 Ref，第二是为了实现真实 dom 的跟踪。</p><p><strong>链表树相关属性</strong><br>我们看一下和 fiber 链表树构建相关的 return、child 和 sibling 几个字段：</p><ul><li>return:指定父 fiber,若没有父 fiber 则为 null</li><li>child: 指向第一个子 fiber，若没有任何子 fiber 则为 null</li><li>sibling:指向下一个兄弟 fiber,若没有下一个兄弟 fiber 则为 null<br>通过这几个字段，各个 fiber 节点构成了 fiber 链表树结构：<br><img src="../images/17.x/fiberTree.png" alt="image"></li></ul><p><strong>副作用相关属性</strong><br>首先理解一下 react 中的副作用，举一个生活中比较通俗的例子：我们感冒了本来吃点药就没事了，但是吃了药身体过敏了，而这个过敏就是副作用。<strong>react 中，我们修改了 state、props、ref 等数据，除了数据改变之外，还引起 dom 的变化，这种 render 阶段不能完成的工作，我们称之为副作用。</strong></p><p><strong>flags</strong><br>react 中通过 flags 记录每个节点 diff 后需要变更的状态，例如 dom 的添加、替换、删除等。<br><img src="../images/17.x/reactFiberFlags.png" alt="image"></p><p>Effect List<br>在 render 阶段，react 会采用深度优化先遍历，对 fiber 数进行遍历，把每一个副作用的 fiber 筛选出来，最后构建生成一个只带副作用的 Effect list 链表。和该链表相关的字段有 firstEffect、nextEffect 和 lastEffect:<br><img src="../images/17.x/effectList.png" alt="image"></p><p>firstEffect 指向第一个有副作用的 fiber 节点，lastEffect 指向最后一个有副作用的节点，中间的节点全部通过 nextEffect 链接，最终形成 Effect 链表。</p><p>在 commit 阶段，React 拿到 Effect list 链表中的数据后，根据每一个 fiber 节点的 flags 类型，对相应的 DOM 进行更改。</p><p><strong>其它</strong><br>其它需要重点关注一下的属性还有 lane 和 alternate。</p><p><strong>lane</strong><br>lane 代表 react 要执行的 fiber 任务的优先级，通过这个字段，render 阶段 react 确定应该优先将哪些任务提交到 commit 阶段去执行。</p><p>我们看一下源码中 lane 的枚举值：<br><img src="../images/17.x/enum-lane.png" alt="image"></p><p>同 Flags 的枚举值一样，Lanes 也是用 31 位的二进制数表示，表示了 31 条赛道，位数越小的赛道，代表的优先级越高。<br>例如 InputDiscreteHydrationLane、InputDiscreteLanes、InputContinuousHydrationLane 等用户交互引起的更新的优先级较高，DefaultLanes 这种请求数据引起更新的优先级中等，而 OffscreenLane、IdleLanes 这种优先级较低。<br>优先级越低的任务，在 render 阶段越容易被打断，commit 执行的时机越靠后。</p><p><strong>alternate</strong></p><p>当 react 的状态发生更新时，当前页面所对应的 fiber 树称为 current Fiber,同时 react 会根据新的状态构建一颗新的 fiber 树，称为 workInProgress Fiber。current Fiber 中每个 fiber 节点通过 alternate 字段，指向 workInProgress Fiber 中对应的 fiber 节点。同样 workInProgress Fiber 中的 fiber 节点的 alternate 字段也会指向 current Fiber 中对应的 fiber 节点。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>[react17.x 源码解析(3)——fiber 树的构建与更新续]</h1><p>react 通过 new MessageChannel()创建了消息通道，当发现 js 线程空闲时，通过 postMessage 通知 scheduler 开始调度。然后 react 接收到调度开始的通知时，就通过 performWorkUntilDeadline 函数去更新当前帧的结束时间，以及执行任务。从而实现了帧空闲时间的任务调度。</p><pre><code>// packages/scheduler/src/forks/SchedulerHostConfig.default.js// 获取当前设备每帧的时长forceFrameRate = function(fps) &#123;  // ...  if (fps &gt; 0) &#123;    yieldInterval = Math.floor(1000 / fps);  &#125; else &#123;    yieldInterval = 5;  &#125;&#125;;// 帧结束前执行任务const performWorkUntilDeadline = () =&gt; &#123;  if (scheduledHostCallback !== null) &#123;    const currentTime = getCurrentTime();    // 更新当前帧的结束时间    deadline = currentTime + yieldInterval;    const hasTimeRemaining = true;    try &#123;      const hasMoreWork = scheduledHostCallback(        hasTimeRemaining,        currentTime,      );      // 如果还有调度任务就执行      if (!hasMoreWork) &#123;        isMessageLoopRunning = false;        scheduledHostCallback = null;      &#125; else &#123;        // 没有调度任务就通过 postMessage 通知结束        port.postMessage(null);      &#125;    &#125; catch (error) &#123;      // ..      throw error;    &#125;  &#125; else &#123;    isMessageLoopRunning = false;  &#125;  needsPaint = false;&#125;;// 通过 MessageChannel 创建消息通道，实现任务调度通知const channel = new MessageChannel();const port = channel.port2;channel.port1.onmessage = performWorkUntilDeadline;// 通过 postMessage，通知 scheduler 已经开始了帧调度requestHostCallback = function(callback) &#123;  scheduledHostCallback = callback;  if (!isMessageLoopRunning) &#123;    isMessageLoopRunning = true;    port.postMessage(null);  &#125;&#125;;</code></pre><p><strong>任务中断</strong></p><p>前面说到可中断模式下的 workLoop,每次遍历执行 performUnitOfWork 前会先判断 shouYield 的值</p><pre><code>// packages/react-reconciler/src/ReactFiberWorkLoop.old.jsfunction workLoopConcurrent() &#123;  while (workInProgress !== null &amp;&amp; !shouldYield()) &#123;    performUnitOfWork(workInProgress);  &#125;&#125;</code></pre><p>再看一下 shouYield 的值是如何获取的：</p><pre><code>//packages\scheduler\src\SchedulerPostTask.jsexport function unstable_shouldYield() &#123;  return getCurrentTime() &gt;= deadline;&#125;</code></pre><p>getCurrentTime 获取的是当前的时间戳，deadline 上面讲到了是浏览器每一帧结束的时间戳。也就是说 concurrent 模式下，react 会将这些非同步任务放到浏览器每一帧空闲时间段去执行，若每一帧结束未执行完，则中断当前任务，待到浏览器下一帧空闲再继续执行。</p><p><strong>总结 react render 阶段的设计思想</strong></p><ul><li>当发生渲染或者更新操作时，react 去创建一系列的任务，任务带有优先级，然后构建 workInProgress fiber 树链表。</li><li>遍历任务链表去执行任务。每一帧帧先执行浏览器的渲染等任务，如果当前帧还有空闲时间，则执行任务，直到当前帧的时间用完。如果当前帧已经没有空闲时间，就等到下一帧的空闲时间再去执行。如果当前帧没有空闲时间但是当前任务链表有任务到期了或者立即基执行任务，那么必须执行的时候就以丢失几帧的代价，执行这些任务。执行完的任务都会被从链表中删除。</li></ul><p>执行过程中的流程图如下：<br><img src="../images/17.x/render-flow.png" alt="image"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">给元素加事件</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot; &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-init</span>=<span class="string">&quot;arr=[12,5,8,33,75];&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>   <span class="attr">ng-model</span>=<span class="string">num</span>&quot;&quot;&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span>  <span class="attr">ng-click</span>=<span class="string">&quot;arr.push(num)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">&quot;item in arr&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">item</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">ng-click=&quot;remove($index)&quot;;</span></span><br><span class="line"><span class="language-xml">ng-keydown=&quot;add($scope)&quot;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">/*</span></span><br><span class="line"><span class="language-xml">• 数据是核心！！！</span></span><br><span class="line"><span class="language-xml">*/</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">ng-click=&quot;bShow=!bShow&quot;-------&gt;开关</span></span><br><span class="line"><span class="language-xml">ng-show=&quot;false &quot;:不显示&quot;true&quot;:显示</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>=<span class="string">&quot; &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;按钮&quot;</span>  <span class="attr">ng-click</span>=<span class="string">&quot;bShow=!bShow&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-show</span>=<span class="string">&quot;bShow&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:200px;height:200px;background:#ccc;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">angularjs数据交互</span></span><br><span class="line"><span class="language-xml">1 原生js中的部分东西--angularjs用不了</span></span><br><span class="line"><span class="language-xml">2 数据多了就不可以使用ng-init、</span><span class="template-variable">&#123;&#123;&#125;&#125;</span><span class="language-xml">、来显示数据</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeJS Promise并发控制 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcurrencyPromisePool</span> &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(limit) &#123;</span><br><span class="line">    <span class="keyword">this</span>.limit = limit;</span><br><span class="line">    <span class="keyword">this</span>.runningNum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.queue = [];</span><br><span class="line">    <span class="keyword">this</span>.results = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  all(promises = []) &#123;</span><br><span class="line">    <span class="keyword">return</span> new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> promise of promises) &#123;</span><br><span class="line">        <span class="comment">// 发送所有 promise</span></span><br><span class="line">        <span class="keyword">this</span>._run(promise, resolve, reject);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _run(promise, resolve, reject) &#123;</span><br><span class="line">    <span class="comment">// 超出限制的 promise 入队</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.runningNum &gt;= <span class="keyword">this</span>.limit) &#123;</span><br><span class="line">      console.log(<span class="string">&quot;&gt;&gt;&gt; 达到上限，入队：&quot;</span>, promise);</span><br><span class="line">      <span class="keyword">this</span>.queue.push(promise);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 正在运行的 promise</span></span><br><span class="line">    ++<span class="keyword">this</span>.runningNum;</span><br><span class="line">    promise()</span><br><span class="line">      .then(res =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.results.push(res);</span><br><span class="line">        --<span class="keyword">this</span>.runningNum;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 运行结束条件：队列长度 &amp;&amp; 正在运行的数量</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.queue.length === <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.runningNum === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> resolve(<span class="keyword">this</span>.results);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 队列还有则，出队，然后递归调用</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.queue.length) &#123;</span><br><span class="line">          <span class="keyword">this</span>._run(<span class="keyword">this</span>.queue.shift(), resolve, reject);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="keyword">catch</span>(reject);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promises = [];</span><br><span class="line"><span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="number">15</span>; ++i) &#123;</span><br><span class="line">  promises.push(() =&gt; new Promise(resolve =&gt; &#123;</span><br><span class="line">    console.log(`$&#123;i&#125; start`);</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(`$&#123;i&#125; end`);</span><br><span class="line">      resolve(i);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pool = new ConcurrencyPromisePool(<span class="number">2</span>);</span><br><span class="line">pool.all(promises).then(res =&gt; &#123;</span><br><span class="line">  console.log(res);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>Vue 移动端企业级实战 - 长列表虚拟滚动插件封装</h1><h2 id="虚拟滚动概述">虚拟滚动概述</h2><p><strong>场景引入</strong></p><blockquote><p><strong>思考：</strong></p><p>​老板让我开发一个 类似 新浪新闻  移动端 H5 Web页面，需要怎样设计，才能符合**「 企业实践标准 」**？</p></blockquote><p>根据用户行为，滑动下拉置底，使用 Axios ，按需请求分页数据，追加显示页面。</p><blockquote><p><strong>思考：</strong></p><p>​如果，我们不断下拉访问，页面中有大量的新闻列表的时候，用户会不会有不好的体验？</p></blockquote><blockquote><p><strong>案例：</strong></p><p>​使用 Vue 构建一个页面，直接将 10000 条新闻类列表数据显示到页面上，体验效果</p><p>​         <em>PS：通过 Chrome 浏览器性能分析工具  <strong>Performance</strong>，监测分析页面前端性能数据</em></p><p>​FPS，每秒帧数，图表上的红色块表示长时间帧，很可能会出现卡顿；</p><p>​CPU，CPU消耗占用，实体图越多消耗越高</p><p>​NET，网络请求效率</p><p>​通过 CHrome 浏览器内存分析工具 Memory，监测分析内存消耗情况</p></blockquote><p>一个长列表 Web 页面，如果需要展示成千上万条数据，那么页面中就会有数万甚至数十万的HTML节点，会巨大的消耗浏览器性能，进而给用户造成非常不友好的体验。</p><ol><li>页面等待时间极长，用户体验差；</li><li>CPU 计算能力不够，滑动会卡顿；</li><li>GPU 渲染能力不够，页面会跳屏；</li><li>RAM 内存容量不够，浏览器崩溃。</li></ol><blockquote><p><strong>思考：</strong></p><p>​前端如何优化这种 「 长列表 」显示场景，才能符合**「 企业最佳实践标准 」**？</p></blockquote><ol><li>不把长列表数据一次性全部直接显示在页面上；</li><li>截取长列表一部分数据用来填充屏幕容器区域；</li><li>长列表数据不可视部分使用使用空白占位填充；</li><li>监听滚动事件根据滚动位置动态改变可视列表；</li><li>监听滚动事件根据滚动位置动态改变空白填充。</li></ol><p>我们也把上面的优化行为简称为 <strong>「 虚拟滚动 」</strong></p><blockquote><p><strong>案例：</strong></p><p>​同样使用 Vue 构建一个页面，使用虚拟滚动显示 10000 条数据，监听分析前端性能数据</p><p>​      <em>PS：通过 Chrome 浏览器元素查阅工具 <strong>Elements</strong>，查看空白填充区域动态变化效果</em></p></blockquote><p><strong>概念介绍</strong></p><p>虚拟滚动，就是根据 **「 容器可视区域 」<strong>的 <strong>「 列表容积数量 」</strong>，监听用户滑动或者滚动事件，动态截取 <strong>「 长列表数据 」</strong> 中的</strong>「 部分数据 」**渲染到页面上，动态使用空白占位填充容器 <strong>「上下滚动区域内容 」</strong> ，模拟实现 <strong>「 原生滚动效果 」</strong>。</p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guh52gg4tyj60xs0r3whx02.jpg" alt="虚拟滚动实现" style="zoom:80%;" /><p><strong>课程安排</strong></p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guh52kz1w2j60rs0n1dib02.jpg" alt="课程安排" style="zoom:60%;float:left" /><h2 id="基础案例准备">基础案例准备</h2><h3 id="使用-Express-Mockjs-模拟新闻类列表API接口">使用 Express + Mockjs 模拟新闻类列表API接口</h3><p><a href="https://www.expressjs.com.cn/starter/hello-world.html">Express 官方文档快速入门</a></p><p><a href="http://mockjs.com/">Mockjs 官方文档快速入门</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Mock 构建本地服务器输出数据结果</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Mock</span> = <span class="built_in">require</span>(<span class="string">&#x27;mockjs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="comment">//根据传入的参数 num，生成 num 条模拟的数据列表</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generatorList</span>(<span class="params">num</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Mock</span>.<span class="title function_">mock</span>(&#123;</span><br><span class="line">    [<span class="string">`list|<span class="subst">$&#123;num&#125;</span>`</span>]: [&#123;</span><br><span class="line">      <span class="comment">// 模拟 ID，自增方式追加</span></span><br><span class="line">      <span class="string">&#x27;id|+1&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="comment">// 模拟标题，中文字符串长度为 20 位到 30 位</span></span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;@ctitle(15,25)&quot;</span>,</span><br><span class="line">      <span class="comment">// 模拟图片索引，自然数从 0 到 15</span></span><br><span class="line">      <span class="attr">image</span>: <span class="string">&quot;@natural(0,15)&quot;</span>,</span><br><span class="line">      <span class="comment">// 模拟访问人数，自然数从 0 到 99999</span></span><br><span class="line">      <span class="attr">reads</span>: <span class="string">&quot;@natural(0,99999)&quot;</span>,</span><br><span class="line">      <span class="comment">// 模拟新闻来源，中文字符串长度为 3 到 10 位</span></span><br><span class="line">      <span class="attr">from</span>: <span class="string">&quot;@ctitle(3,7)&quot;</span>,</span><br><span class="line">      <span class="comment">// 模拟发布时间，时间格式</span></span><br><span class="line">      <span class="attr">date</span>:<span class="string">&quot;@date(&#x27;yyyy-MM-dd&#x27;)&quot;</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//允许跨域请求返回数据</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;*&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT, GET, POST, DELETE, OPTIONS&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>);</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//截取路由并反馈数据</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/data&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// 获取 get 请求数据条数参数 num</span></span><br><span class="line">  <span class="keyword">const</span> &#123; num &#125; = req.<span class="property">query</span>;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="title function_">generatorList</span>(num));</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//设置端口并打印对应调用结果</span></span><br><span class="line"><span class="keyword">const</span> server = app.<span class="title function_">listen</span>(<span class="number">4000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;本地mock服务启动，接口地址为：http://localhost:4000/data?num=请求列表数量&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="基于-Vue-Cli-脚手架准备基础案例">基于 Vue-Cli  脚手架准备基础案例</h3><img src="https://tva1.sinaimg.cn/large/008i3skNly1guh52ntn9ej619b0u0q6k02.jpg" alt="代码结构" style="zoom:35%;float:left;" /><blockquote><p>PS：企业级应用开发，在 Vue WebPack 中灵活配置，可以让我们的项目更加灵活可靠</p></blockquote><h2 id="基础功能实现">基础功能实现</h2><h3 id="使用-Axios-引入模拟数据">使用 Axios 引入模拟数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入axios，并加到原型链中</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$axios</span> = axios;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 数据请求状态判断</span></span><br><span class="line">      <span class="attr">isRequestStatus</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 提示显示信息</span></span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&quot;小二正在努力，请耐心等待...&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 分批发送请求时，先请求一部分数据保证数据显示</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getAllListData</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">if</span> (!!request &amp;&amp; request.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">allDataList</span> = [...request];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isRequestStatus</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 发送请求获取新的请求模拟数据，这个是跨域请求的网络mock数据</span></span><br><span class="line">    <span class="title function_">getAllListData</span>(<span class="params">num</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isRequestStatus</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="string">&quot;小二正在努力，请耐心等待...&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$axios</span></span><br><span class="line">        .<span class="title function_">get</span>(<span class="string">&quot;http://localhost:4000/data?num=&quot;</span> + num)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isRequestStatus</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">allListData</span> = res.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="string">&quot;亲，网络请求出错啦！赶快检查吧...&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="计算滚动容器最大列表容积">计算滚动容器最大列表容积</h3><p>根据滚动容器 DOM 元素高度 <code>this.$refs.scrollContainer.innerHeight</code> 和单条数据的固定高度  <code>oneHeight</code> ，计算当前滚动容器最大列表容积数量  <code>containSize</code> 。</p><blockquote><p><strong>注意：</strong></p><p>​当屏幕 <code>Resize</code> 改变窗口，或者 <code>orientationchange</code> 手机横竖屏切换时，滚动容器最大容积数需要动态计算</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给滚动容器加一个 ref 属性，用来获取当前滚动容器的 DOM 节点</span></span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;scroll-container&quot;</span> ref=<span class="string">&quot;scrollContainer&quot;</span>&gt;</span><br><span class="line"><span class="comment">// 首先在data中声明两个属性</span></span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 列表单条条数据 CSS 高度，这个数值需要固定，根据 CSS 值手动填写，如此才能准确的计算容积</span></span><br><span class="line">    <span class="attr">oneHeight</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="comment">// 当前页面可以容纳的列表最大数量</span></span><br><span class="line">    <span class="attr">containSize</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 根据显示区域高度，计算可以容纳最大列表数量</span></span><br><span class="line"> <span class="variable language_">this</span>.<span class="title function_">myresize</span>();</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onresize</span> = <span class="variable language_">this</span>.<span class="property">myresize</span>;</span><br><span class="line"> <span class="variable language_">window</span>.<span class="property">orientationchange</span> = <span class="variable language_">this</span>.<span class="property">myresize</span>;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="comment">// 监听窗口变化动态计算容器最大容积数</span></span><br><span class="line">  <span class="attr">myresize</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">scrollContainer</span>.<span class="property">offsetHeight</span>);</span><br><span class="line">    <span class="comment">// 容积数量可能只截取了单条数据的一部分，所以要进位加一</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">containSize</span> = </span><br><span class="line">      <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">scrollContainer</span>.<span class="property">offsetHeight</span> / <span class="variable language_">this</span>.<span class="property">oneHeight</span>) + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>思考：</strong></p><p>​现在我将 <code>className</code> 为 <code>scroll-container </code>或者<code> news-box</code> 的高度 100% 设置取消会是什么结果？为什么会这样？</p><ol><li>当前 ref 节点 DOM 元素 <code>scrollContainer </code>的高度竟然成了 84，这是什么原因呢？</li><li>原来，这个时候异步请求的新闻列表数据填充虽然改变了 DOM 结构，但是 DOM 计算是异步的，所以导致了这个时候计算的容器高度，仅仅是底部 msg 信息提示 DOM 节点的高度，如何解决？</li><li>使用<code> this.nextTick()</code> 解决数据变化后 DOM 更新后的节点信息获取，我们发现变成了 10000 ，这是因为填充了100条高度为100的列表数据导致。</li></ol></blockquote><blockquote><p><strong>注意：</strong></p><p>​我们在学习虚拟滚动前，务必要非常清醒的去理解，盒元素高度继承的原理，以及子元素高度溢出滚动的原理。如果滚动容器 CSS 高度使用百分比限制的话，要注意其父元素的高度需要指定，父元素的父元素一样需要指定高度，依次类推，只有这样，才会有当前滚动容器内部的滚动效果。</p></blockquote><h3 id="监听滚动事件动态截取数据">监听滚动事件动态截取数据</h3><p>监听用户滚动、滑动事件，根据滚动位置，动态计算当前可视区域起始数据的索引位置 <code>startIndex</code>，再根据  <code>containSize</code>，计算结束数据的索引位置 <code>endIndex</code>，最后根据<code>startIndex</code>与 <code>endIndex</code>截取长列表所有数据 <code>allDataList</code> 中需显示的数据列表 <code>showDataList</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给滚动容器添加滚动事件 @scroll=&quot;handleScroll&quot;</span></span><br><span class="line"><span class="comment">// 使用passive修饰符，确保默认滚动行为有效</span></span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;scroll-container&quot;</span> ref=<span class="string">&quot;scrollContainer&quot;</span> @scroll.<span class="property">passive</span>=<span class="string">&quot;handleScroll&quot;</span>&gt;</span><br><span class="line"><span class="comment">// 显示容器最大容积截取的数组数据</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in showDataList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml">data() &#123;</span></span><br><span class="line"><span class="language-xml">  return &#123;</span></span><br><span class="line"><span class="language-xml">    // 可视元素开始索引</span></span><br><span class="line"><span class="language-xml">    startIndex:0</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">computed: &#123;</span></span><br><span class="line"><span class="language-xml">    // 根据 starIndex 和屏幕容积 containSize 计算 endIndex</span></span><br><span class="line"><span class="language-xml">    endIndex() &#123;</span></span><br><span class="line"><span class="language-xml">      let endIndex = this.startIndex + this.containSize;</span></span><br><span class="line"><span class="language-xml">      // 判断截取到最后元素是否存在，如果不存在则只取最后一位</span></span><br><span class="line"><span class="language-xml">      if (!this.allDataList[endIndex]) &#123;</span></span><br><span class="line"><span class="language-xml">        endIndex = this.allDataList.length - 1;</span></span><br><span class="line"><span class="language-xml">      &#125;</span></span><br><span class="line"><span class="language-xml">      return endIndex;</span></span><br><span class="line"><span class="language-xml">    &#125;,</span></span><br><span class="line"><span class="language-xml">    // 根据容器最大容积数，截取显示，实际需要渲染列表，这里也通过计算属性动态依赖计算</span></span><br><span class="line"><span class="language-xml">    showDataList() &#123;</span></span><br><span class="line"><span class="language-xml">      // 根据 starIndex 和 endIndex，截取 allDataList 对应需要显示部分 showDataList</span></span><br><span class="line"><span class="language-xml">      return this.allDataList.slice(this.startIndex, this.endIndex);</span></span><br><span class="line"><span class="language-xml">    &#125;</span></span><br><span class="line"><span class="language-xml">&#125;,</span></span><br><span class="line"><span class="language-xml">methods: &#123;</span></span><br><span class="line"><span class="language-xml">  // 监听容器滚动事件</span></span><br><span class="line"><span class="language-xml">  handleScroll() &#123;</span></span><br><span class="line"><span class="language-xml">    this.startIndex = ~~(</span></span><br><span class="line"><span class="language-xml">       this.$refs.scrollContainer.scrollTop / this.oneHeight</span></span><br><span class="line"><span class="language-xml">    );</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">// 给容器添加 Y 轴可滚动 CSS 属性</span></span><br><span class="line"><span class="language-xml">.scroll-container &#123;</span></span><br><span class="line"><span class="language-xml">   overflow-y: auto;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>注意：</strong></p><ol><li>务必给 scroll-container 添加   overflow-y: auto; 的 CSS 属性，Vue 才能监听滚动触发事件；</li><li>使用 Computed 计算属性，可以依赖性的计算创建对应属性；</li><li>数组操作 splice 会改变原始数组，slice 不会改变原始数组</li></ol></blockquote><h3 id="使用计算属性动态设置上下空白占位">使用计算属性动态设置上下空白占位</h3><blockquote><p><strong>思考：</strong></p><p>​我们设置了根据容器滚动位移动态截取 <code>ShowDataList </code> 数据，现在我们滚动一下发现滚动 2 条列表数据后，就无法滚动了，这个原因是什么呢？</p><p>​在容器滚动过程中，因为动态移除、添加数据节点丢失，进而强制清除了顶部列表元素 DOM 节点，导致滚动条定位向上移位一个列表元素高度，进而出现了死循环</p></blockquote><p>根据 <code>startIndex</code> 和 <code>endIndex</code> 的位置，使用计算属性，动态的计算并设置，上下空白填充的高度样式 <code>blankFillStyle</code>，使用 padding 或者 margin 进行空白占位都是可以的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 添加上下空白占位 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;blankFillStyle&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- 循环遍历元素 --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line"><span class="comment">// blankFillStyle 依赖 计算上下空白占位高度样式</span></span><br><span class="line"><span class="title function_">blankFillStyle</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">paddingTop</span>: <span class="variable language_">this</span>.<span class="property">startIndex</span> * <span class="number">100</span> + <span class="string">&quot;px&quot;</span>,</span><br><span class="line"><span class="attr">paddingBottom</span>: (<span class="variable language_">this</span>.<span class="property">allDataList</span>.<span class="property">length</span> - <span class="variable language_">this</span>.<span class="property">endIndex</span>) * <span class="number">100</span> + <span class="string">&quot;px&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意：</strong></p><ol><li>填充样式必须以盒子包裹的方式包裹所有节点；</li><li>使用计算属性来自动依赖输出  <code>blankFillStyle</code> 对象;</li><li>在Vue中可以使用对象直接操作 Style 样式，但是要注意「 驼峰式 」的命名规则。</li></ol></blockquote><blockquote><p><strong>思考：</strong></p><p>​如果填充样式，使用上下分散占位方式，没有包裹内部列表节点会出现什么现象？为什么？需要怎样处理呢？</p><p>​<code>@mousewheel.passive=&quot;handleScroll&quot; </code></p><p>​<code>@touchmove.passive=&quot;handleScroll&quot;</code></p></blockquote><h2 id="完整功能实现">完整功能实现</h2><h3 id="下拉置底自动请求加载数据">下拉置底自动请求加载数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 分批发送请求时，先请求一部分数据保证数据显示</span></span><br><span class="line">    <span class="keyword">let</span> request = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getAllListData</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">if</span> (!!request &amp;&amp; request.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">allDataList</span> = [...request];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isRequestStatus</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 发送请求获取新的请求模拟数据，这个是跨域请求的网络mock数据</span></span><br><span class="line">    <span class="title function_">getAllListData</span>(<span class="params">num</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isRequestStatus</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="string">&quot;小二正在努力，请耐心等待...&quot;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$axios</span></span><br><span class="line">        .<span class="title function_">get</span>(<span class="string">&quot;http://localhost:4000/data?num=&quot;</span> + num)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isRequestStatus</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">return</span> res.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="string">&quot;亲，网络请求出错啦！赶快检查吧...&quot;</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;，</span><br><span class="line">    <span class="comment">// 监听容器滚动事件</span></span><br><span class="line">    <span class="title function_">handleScroll</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 获取当前容器在scoll事件中距离顶部的位移 scrollTop 计算可视元素开始索引</span></span><br><span class="line">      <span class="keyword">let</span> <span class="title class_">CurrentStartIndex</span> = ~~(</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">scrollContainer</span>.<span class="property">scrollTop</span> / <span class="variable language_">this</span>.<span class="property">oneHeight</span></span><br><span class="line">     );</span><br><span class="line">      <span class="comment">// 如果当前可视元素开始索引和记录的 startIndex 开始索引发生变化，才需要更改 showDataList</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">CurrentStartIndex</span> === <span class="variable language_">this</span>.<span class="property">startIndex</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">// 当前可视元素索引发生变化后，更新记录的 startIndex 值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">startIndex</span> = <span class="title class_">CurrentStartIndex</span>;</span><br><span class="line">      <span class="comment">// PS：因为计算属性依赖关系，startIndex 发生变化，endIndex 会自动触发计算属性的操作</span></span><br><span class="line">      <span class="comment">// 同理，根据计算属性依赖关系，showDataList 也会自动触发返回新的值</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 如果下拉到了底部，并且上一次请求已经完成，则触发新的数据更新</span></span><br><span class="line">      <span class="comment">// 使用 this.loadingTag 状态进行节流，防止非必要触发</span></span><br><span class="line">      <span class="keyword">if</span> ( <span class="variable language_">this</span>.<span class="property">containSize</span> + currentIndex &gt; <span class="variable language_">this</span>.<span class="property">listData</span>.<span class="property">length</span> - <span class="number">1</span>  </span><br><span class="line">           &amp;&amp; !<span class="variable language_">this</span>.<span class="property">loadingTag</span> ) &#123;</span><br><span class="line">           <span class="comment">// 请求新的20条新闻数据，如果没有请求到数据则直接return</span></span><br><span class="line">           <span class="keyword">let</span> newListData = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getAllListData</span>(<span class="number">20</span>);</span><br><span class="line">           <span class="keyword">if</span> (!!newListData &amp;&amp; newListData.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">           <span class="comment">// 使用拓展运算符将请求的最新数据写进所有数据的列表</span></span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">listData</span> = [...<span class="variable language_">this</span>.<span class="property">listData</span>, ...newListData];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="滚动事件节流定时器优化">滚动事件节流定时器优化</h3><blockquote><p><strong>思考：</strong></p><p>​监听滚动事件触发对应函数方法的频率是极高的，该如何做好页面节流优化呢？</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在data中声明一个属性scrollState用来记录滚动状态</span></span><br><span class="line"><span class="comment">// 监听滚动（滑动）事件，</span></span><br><span class="line"><span class="title function_">handelScroll</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="comment">// 只有scrollState值为true的时候才会具体执行 </span></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">scrollState</span>) &#123;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">scrollState</span> = <span class="literal">false</span>;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="title function_">setDataStartIndex</span>();</span><br><span class="line">       <span class="keyword">var</span> mytimer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">scrollState</span> = <span class="literal">true</span>;</span><br><span class="line">         <span class="variable language_">window</span>.<span class="built_in">clearTimeout</span>(mytimer);</span><br><span class="line">       &#125;,<span class="number">60</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">setDataStartIndex</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 获取当前容器在scoll事件中距离顶部的位移 scrollTop 计算可视元素开始索引</span></span><br><span class="line">      <span class="keyword">let</span> <span class="title class_">CurrentStartIndex</span> = ~~(</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">scrollContainer</span>.<span class="property">scrollTop</span> / <span class="variable language_">this</span>.<span class="property">oneHeight</span></span><br><span class="line">     );</span><br><span class="line">      <span class="comment">// 如果当前可视元素开始索引和记录的 startIndex 开始索引发生变化，才需要更改 showDataList</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">CurrentStartIndex</span> === <span class="variable language_">this</span>.<span class="property">startIndex</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">// 当前可视元素索引发生变化后，更新记录的 startIndex 值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">startIndex</span> = <span class="title class_">CurrentStartIndex</span>;</span><br><span class="line">      <span class="comment">// PS：因为计算属性依赖关系，startIndex 发生变化，endIndex 会自动触发计算属性的操作</span></span><br><span class="line">      <span class="comment">// 同理，根据计算属性依赖关系，showDataList 也会自动触发返回新的值</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 如果下拉到了底部，并且上一次请求已经完成，则触发新的数据更新</span></span><br><span class="line">      <span class="comment">// 使用 this.loadingTag 状态进行节流，防止非必要触发</span></span><br><span class="line">      <span class="keyword">if</span> ( <span class="variable language_">this</span>.<span class="property">containSize</span> + currentIndex &gt; <span class="variable language_">this</span>.<span class="property">listData</span>.<span class="property">length</span> - <span class="number">1</span>  </span><br><span class="line">           &amp;&amp; !<span class="variable language_">this</span>.<span class="property">loadingTag</span> ) &#123;</span><br><span class="line">           <span class="comment">// 请求新的20条新闻数据，如果没有请求到数据则直接return</span></span><br><span class="line">           <span class="keyword">let</span> newListData = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getAllListData</span>(<span class="number">20</span>);</span><br><span class="line">           <span class="keyword">if</span> (!!newListData &amp;&amp; newListData.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">           <span class="comment">// 使用拓展运算符将请求的最新数据写进所有数据的列表</span></span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">listData</span> = [...<span class="variable language_">this</span>.<span class="property">listData</span>, ...newListData];</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="滚动事件节流请求动画帧优化">滚动事件节流请求动画帧优化</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame">requestAnimationFrame 介绍</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//兼容低版本浏览器</span></span><br><span class="line"><span class="keyword">let</span> requestAnimationFrame =</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">requestAnimationFrame</span> ||</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">mozRequestAnimationFrame</span> ||</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">webkitRequestAnimationFrame</span> ||</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">msRequestAnimationFrame</span>;</span><br><span class="line"><span class="comment">//浏览器防抖优化：根据浏览器FPS采用递归方法，队列调用requestAnimationFrame方法实现优化</span></span><br><span class="line"><span class="keyword">let</span> fps = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">let</span> interval = <span class="number">1000</span> / fps;</span><br><span class="line"><span class="keyword">let</span> then = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line"><span class="title function_">requestAnimationFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">  <span class="keyword">let</span> delta = now - then;</span><br><span class="line">  then = now;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setDataStartIndex</span>();</span><br><span class="line">  <span class="keyword">if</span> (delta &gt;= interval) &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="variable language_">arguments</span>.<span class="property">callee</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="设置上下滚动缓冲消除快速滚动白屏">设置上下滚动缓冲消除快速滚动白屏</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line"><span class="comment">// 用来保存实际要渲染到页面的数据</span></span><br><span class="line"><span class="title function_">showListData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 设置起始、结尾位置索引</span></span><br><span class="line"><span class="keyword">let</span> startIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> endIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 如果当前滚动的位置还没有完成一屏，则从第1条开始，截取到当前索引位置+屏幕容积+向下缓冲屏幕容积</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentIndex</span> &lt;= <span class="variable language_">this</span>.<span class="property">containSize</span>) &#123;</span><br><span class="line">      startIndex = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      startIndex = <span class="variable language_">this</span>.<span class="property">currentIndex</span> - <span class="variable language_">this</span>.<span class="property">containSize</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    endIndex = <span class="variable language_">this</span>.<span class="property">currentIndex</span> + <span class="variable language_">this</span>.<span class="property">containSize</span> * <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 判断截取到最后元素是否存在，如果不存在则只取最后一位</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">listData</span>[endIndex]) &#123;</span><br><span class="line">      endIndex = <span class="variable language_">this</span>.<span class="property">listData</span>.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">listData</span>.<span class="title function_">slice</span>(startIndex, endIndex);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 用来动态的计算上下空白padding的占位样式</span></span><br><span class="line">  <span class="title function_">wrapperStyle</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> paddingTop = <span class="string">&quot;0px&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> paddingBottom = <span class="string">&quot;0px&quot;</span>;</span><br><span class="line">    <span class="comment">// 判断当前滚动位置</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentIndex</span> &gt; <span class="variable language_">this</span>.<span class="property">containSize</span>) &#123;</span><br><span class="line">      <span class="comment">// 当当前滚动位置大于屏幕容积后才填充空白</span></span><br><span class="line">      paddingTop =</span><br><span class="line">        (<span class="variable language_">this</span>.<span class="property">currentIndex</span> - <span class="variable language_">this</span>.<span class="property">containSize</span>) * <span class="variable language_">this</span>.<span class="property">oneHeight</span> + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> endIndex = <span class="variable language_">this</span>.<span class="property">currentIndex</span> + <span class="variable language_">this</span>.<span class="property">containSize</span> * <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 判断截取到最后元素是否存在，只有最后一个元素存在则填充下空白</span></span><br><span class="line">    <span class="keyword">if</span> (!!<span class="variable language_">this</span>.<span class="property">listData</span>[endIndex]) &#123;</span><br><span class="line">      paddingBottom =</span><br><span class="line">        (<span class="variable language_">this</span>.<span class="property">listData</span>.<span class="property">length</span> - endIndex) * <span class="variable language_">this</span>.<span class="property">oneHeight</span> + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      paddingTop,</span><br><span class="line">      paddingBottom</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="路由切换定位列表滚动位置">路由切换定位列表滚动位置</h3><blockquote><p><strong>思考：</strong></p><p>​当我们滚动了一段列表后，点击一条新闻查看新闻详情，然后再返回列表页面，发现列表回到顶部了，这个体验很不好，该如何解决？</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 app.vue 文件的路由出口添加 keepAlive </span></span><br><span class="line">&lt;keep-alive&gt;</span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span></span><br><span class="line">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 index.vue 文件中记录相关信息</span></span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 在data中声明一个属性，用来保存路由切换后的偏移定位</span></span><br><span class="line">    <span class="attr">scrollTop</span>: <span class="number">0</span>  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">setDataStartIndex</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 根据滚动事件，获取当前容器在scoll事件中距离顶部的位移</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">scrollTop</span> = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">scrollContainer</span>.<span class="property">scrollTop</span>;</span><br><span class="line">  <span class="comment">// 根据 scrollTop 计算可视元素开始索引</span></span><br><span class="line">      <span class="keyword">let</span> <span class="title class_">CurrentStartIndex</span> = ~~( <span class="variable language_">this</span>.<span class="property">scrollTop</span> / <span class="variable language_">this</span>.<span class="property">oneHeight</span> );</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">activated</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//在keep-alive路由模式下，切换路由时确保能够返回用户之前所在位置</span></span><br><span class="line"><span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">scrollContainer</span>.<span class="property">scrollTop</span> = <span class="variable language_">this</span>.<span class="property">scrollTop</span>;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="插件封装调用">插件封装调用</h2><h3 id="剥离代码构建插件文件并直接调用">剥离代码构建插件文件并直接调用</h3><ol><li>在 src 文件夹下，创建 plugins 文件夹，用来保存我们的自定义插件，并创建插件 VirtualScroll.vue 文件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;scroll-container&quot; ref=&quot;scrollContainer&quot; @scroll.passive=&quot;handleScroll&quot;&gt;</span><br><span class="line">      &lt;!-- 滚动容器内部数据 --&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">   // 对应实现虚拟滚动的脚本文件</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">  .scroll-container &#123;</span><br><span class="line">  /* 对应实现虚拟滚动的 css 文件*/</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>新建 index.js 文件输出插件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">VirtualScroll</span> <span class="keyword">from</span> <span class="string">&#x27;./VirtualScroll.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> plugin = &#123;</span><br><span class="line">    <span class="title function_">install</span>(<span class="params">Vue</span>) &#123;</span><br><span class="line">        <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&quot;VirtualScroll&quot;</span>, <span class="title class_">VirtualScroll</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> plugin;</span><br></pre></td></tr></table></figure><ol start="3"><li>在 main.js 文件中，给 Vue 添加全局插件属性</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入定制化虚拟滚动插件并注册到Vue全局实例上，这里需要注意先后顺序，我们的定制化插件中会用到iView中的组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VirtualScroll</span> <span class="keyword">from</span> <span class="string">&quot;./plugins&quot;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VirtualScroll</span>);</span><br></pre></td></tr></table></figure><ol start="4"><li>在 index.vue 文件中调用插件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;news-box&quot;&gt;</span><br><span class="line">    &lt;virtual-scroll /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="调用插件并传递-Props-参数">调用插件并传递 Props 参数</h3><p>调用插件的时候，需要抽离关键定制化的参数信息，向子组件进行通信使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">virtual-scroll</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:msg</span> =<span class="string">&quot;msg&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:oneHeight</span> =<span class="string">&quot;oneHeight&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:requestUrl</span> =<span class="string">&quot;requestUrl&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:oneRequestDataLength</span> =<span class="string">&quot;oneRequestDataLength&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 请求数据提示信息</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">msg</span>: <span class="string">&quot;小二正在努力，请耐心等待...&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 记录单条数据的高度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">oneHeight</span>: <span class="number">100</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 数据请求的 Url</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">requestUrl</span>: <span class="string">&quot;http://localhost:4000/data?num=&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 单次请求数据的条数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">oneRequestDataLength</span>: <span class="number">20</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>在组件中使用 props 接收父组件传递过来的参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="comment">// 请求数据提示信息</span></span><br><span class="line">    <span class="attr">msg</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="string">&quot;小二正在努力，请耐心等待...&quot;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 记录单条数据的高度</span></span><br><span class="line">    <span class="attr">oneHeight</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="number">100</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 数据请求的 Url</span></span><br><span class="line">    <span class="attr">requestUrl</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="string">&quot;http://localhost:4000/data?num=&quot;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 单次请求数据的条数</span></span><br><span class="line">    <span class="attr">oneRequestDataLength</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="number">20</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改关键传递过来的参数信息</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> newList = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getNewsList</span>(<span class="variable language_">this</span>.<span class="property">oneRequestDataLength</span>);</span><br><span class="line"><span class="comment">// 使用父组件传递过来的请求地址 requestUrl 来替代写死的地址</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$axios</span>.<span class="title function_">get</span>(<span class="variable language_">this</span>.<span class="property">requestUrl</span> + num)</span><br><span class="line"><span class="comment">// 追加请求新的数据</span></span><br><span class="line"><span class="keyword">let</span> newList = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getNewsList</span>(<span class="variable language_">this</span>.<span class="property">oneRequestDataLength</span>);</span><br></pre></td></tr></table></figure><h3 id="使用作用域插槽传递单条元素结构">使用作用域插槽传递单条元素结构</h3><p>将 VirtualScroll.vue 组件内部的单条元素的 html 结构、css 样式、data 数据，使用作用域插槽传递出去</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in showDataList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">:thisItem</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在 index.vue 接收子组件中传递过来的单条元素内容，结构、数据、样式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;virtual-scroll v-slot:default=&quot;oneItem&quot;&gt;</span><br><span class="line">    &lt;router-link class=&quot;one-new&quot; to=&quot;/article&quot;&gt;</span><br><span class="line">    &lt;!-- 新闻左侧标题、评论、来源部分 --&gt;</span><br><span class="line">    &lt;div class=&quot;new-left&quot;&gt;</span><br><span class="line">        &lt;h3&gt;&#123;&#123; oneItem.thisItem.title &#125;&#125;&lt;/h3&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;img src=&quot;../assets/icons/msg.png&quot; alt=&quot;评&quot; /&gt;</span><br><span class="line">            &lt;span&gt;&#123;&#123; oneItem.thisItem.reads &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;&#123;&#123; oneItem.thisItem.from &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;h4&gt;&#123;&#123; oneItem.thisItem.date &#125;&#125;&lt;/h4&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 新闻右侧图片部分 --&gt;</span><br><span class="line">    &lt;div class=&quot;new-right&quot;&gt;</span><br><span class="line">        &lt;img :src=&quot;imgsList[oneItem.thisItem.image]&quot; alt=&quot;PIC&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/router-link&gt;</span><br><span class="line">&lt;/virtual-scroll&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.news-box &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  max-width: 800px;</span><br><span class="line">  height: 100%;</span><br><span class="line">  .one-new &#123;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    display: block;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: row;</span><br><span class="line">    flex-wrap: nowrap;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    border-bottom: 1px solid #ddd;</span><br><span class="line">    padding: 14px 10px 5px;</span><br><span class="line">    .new-left &#123;</span><br><span class="line">      height: 80px;</span><br><span class="line">      position: relative;</span><br><span class="line">      h3 &#123;</span><br><span class="line">        padding: 0;</span><br><span class="line">        margin: 0;</span><br><span class="line">        font-size: 16px;</span><br><span class="line">        text-align: justify;</span><br><span class="line">        color: #555;</span><br><span class="line">      &#125;</span><br><span class="line">      div &#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        width: 100%;</span><br><span class="line">        bottom: 10px;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: row;</span><br><span class="line">        flex-wrap: nowrap;</span><br><span class="line">        justify-content: space-between;</span><br><span class="line">        align-items: center;</span><br><span class="line">        p &#123;</span><br><span class="line">          display: flex;</span><br><span class="line">          flex-direction: row;</span><br><span class="line">          flex-wrap: nowrap;</span><br><span class="line">          justify-content: space-between;</span><br><span class="line">          align-items: center;</span><br><span class="line">          img &#123;</span><br><span class="line">            height: 16px;</span><br><span class="line">          &#125;</span><br><span class="line">          span &#123;</span><br><span class="line">            font-size: 12px;</span><br><span class="line">            color: #555;</span><br><span class="line">            margin-left: 3px;</span><br><span class="line">            margin-right: 3px;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        h4 &#123;</span><br><span class="line">          font-size: 12px;</span><br><span class="line">          color: #888;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .new-right &#123;</span><br><span class="line">      margin-left: 10px;</span><br><span class="line">      img &#123;</span><br><span class="line">        height: 68px;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="技术场景拓展简介">技术场景拓展简介</h2><ol><li>使用上下空白占位的方式实现虚拟滚动</li><li>横屏滑动实现虚拟滚动</li><li>浮动模型实现虚拟滚动</li><li>微信小程序长列表虚拟滚动实现</li></ol><p><a href="https://developers.weixin.qq.com/miniprogram/dev/extended/component-plus/recycle-view.html">小程序长列表组件 - RecycleView</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[var worker = new Worker('worker.js');worker.onmessage = function (event) {  // document.getElementById('result').textContent = event.data;  console.log('result >>', event.data)};]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[// 备注：Worker 线程内部还能再新建 Worker 线程（目前只有 Firefox 浏览器支持）// settingsvar num_workers = 10;var items_per_worker = 1000000;// start the workersvar result = 0;var pending_workers = num_workers;for (var i = 0; i < num_workers; i += 1) {  var worker = new Worker('core.js');  worker.postMessage(i * items_per_worker);  worker.postMessage((i + 1) * items_per_worker);  worker.onmessage = storeResult;}// handle the resultsfunction storeResult(event) {  result += event.data;  pending_workers -= 1;  if (pending_workers <= 0)    postMessage(result); // finished!}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[var start;onmessage = getStart;function getStart(event) {  start = event.data;  onmessage = getEnd;}var end;function getEnd(event) {  end = event.data;  onmessage = null;  work();}function work() {  var result = 0;  for (var i = start; i < end; i += 1) {    // perform some complex calculation here    result += 1;  }  postMessage(result);  close();}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[let Queue = (function () {    const items = new WeakMap();//WeakMap对象是密钥/值对的集合，其中密钥被弱引用。键必须是对象，值可以是任意值。    class Queue {        constructor () {            items.set(this, []);        }        enqueue(...element) {//向队列尾部添加一个（或多个）新的项            let q = items.get(this);            q.push(...element);        }        dequeue() {//移除队列的第一个（排在队列最前面的）项，并返回被移除的元素。            let q = items.get(this);            let r = q.shift();            return r;        }        front() {//返回队列中第一个元素——最先被添加，也将是最先被移除的元素。队列不做任何变动（不移除元素，只返回元素信息）            let q = items.get(this);            return q[0];        }        isEmpty(){//如果队列中不包含任何元素，返回true，否则返回false。            return items.get(this).length == 0;        }        size(){//返回队列包含的元素个数，与数组的length属性类似。            let q = items.get(this);            return q.length;        }        clear(){//清空队列里面的元素。            items.set(this, []);        }        print(){//打印队列为String到控制台            console.log(this.toString());        }        toString(){//输出队列以String模式。            return items.get(this).toString();        }    }    return Queue;})();let queue = new Queue();//实例化]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[initPlUploader() {        this.plUploader = new plupload.Uploader({          runtimes: 'html5,flash,silverlight,html4',          url: 'http://oss.aliyuncs.com',          browse_button: 'pickfiles',          filters: {            mime_types: [              { title: 'Image files', extensions: 'jpg,gif,png,bmp' }            ],            max_file_size: '10mb',            prevent_duplicates: true          },          init: {            FilesAdded: function(up, files) {              console.log('有新文件添加至队列')              up.start()            },            BeforeUpload: this.beforeUpload,            UploadProgress: this.uploadProgress,            FileUploaded: this.fileUploaded,            Error: this.error          }        })        this.plUploader.init()      }    =====================================================var swfu;     window.onload = function () {    var settings_object = {//定义参数配置对象        upload_url : "http://www.swfupload.org/upload.php",            flash_url : "http://www.swfupload.org/swfupload.swf",            file_post_name : "Filedata",            post_params : {           "post_param_name_1" : "post_param_value_1",           "post_param_name_2" : "post_param_value_2",           "post_param_name_n" : "post_param_value_n"            },            use_query_string : false,            requeue_on_error : false,            http_success : [201, 202],            assume_success_timeout : 0,            file_types : "*.jpg;*.gif",            file_types_description: "Web Image Files",            file_size_limit : "1024",            file_upload_limit : 10,            file_queue_limit : 2,             debug : false,                 prevent_swf_caching : false,            preserve_relative_urls : false,                 button_placeholder_id : "element_id",            button_image_url : "http://www.swfupload.org/button_sprite.png",            button_width : 61,            button_height : 22,            button_text : "<b>Click</b> <span class="redText">here</span>",            button_text_style : ".redText { color: #FF0000; }",            button_text_left_padding : 3,            button_text_top_padding : 2,            button_action : SWFUpload.BUTTON_ACTION.SELECT_FILES,            button_disabled : false,            button_cursor : SWFUpload.CURSOR.HAND,            button_window_mode : SWFUpload.WINDOW_MODE.TRANSPARENT,                 swfupload_loaded_handler : swfupload_loaded_function,            file_dialog_start_handler : file_dialog_start_function,            file_queued_handler : file_queued_function,            file_queue_error_handler : file_queue_error_function,            file_dialog_complete_handler : file_dialog_complete_function,            upload_start_handler : upload_start_function,            upload_progress_handler : upload_progress_function,            upload_error_handler : upload_error_function,            upload_success_handler : upload_success_function,            upload_complete_handler : upload_complete_function,            debug_handler : debug_function,    };         swfu = new SWFUpload(settings_object);//实例化一个SWFUpload，传入参数配置对象};/*定义各种事件监听函数*/function swfupload_loaded_function(){}function file_dialog_start_function(){}...等等]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[// 用户上传 type=filevar reader = new FileReader();var AllowImgFileSize = 2100000; //上传图片最大值(单位字节)（ 2 M = 2097152 B ）超过2M上传失败var file = $("#image")[0].files[0];var imgUrlBase64;if (file) {  //将文件以Data URL形式读入页面    imgUrlBase64 = reader.readAsDataURL(file);  reader.onload = function (e) {    //var ImgFileSize = reader.result.substring(reader.result.indexOf(",") + 1).length;//截取base64码部分（可选可不选，需要与后台沟通）    if (AllowImgFileSize != 0 && AllowImgFileSize < reader.result.length) {      alert( '上传失败，请上传不大于2M的图片！');      return;    }else{      //执行上传操作      alert(reader.result);    }  }}// 本站function(){  var url = "static/img/js1.jpg";//这是站内的一张图片资源，采用的相对路径    convertImgToBase64(url, function(base64Img){    //转化后的base64    alert(base64Img);  });             }//实现将项目的图片转化成base64function convertImgToBase64(url, callback, outputFormat){  var canvas = document.createElement('CANVAS'),      ctx = canvas.getContext('2d'),　　     img = new Image;　　 img.crossOrigin = 'Anonymous';　　 img.onload = function(){　　canvas.height = img.height;　　canvas.width = img.width;　　ctx.drawImage(img,0,0);　　var dataURL = canvas.toDataURL(outputFormat || 'image/png');　　callback.call(this, dataURL);　　canvas = null;   };　　img.src = url;}// 网络图片转 base64function base64Fn(){　var url="http://p1.pstatp.com/large/435d000085555bd8de10";  getBase64(url)  .then(function(base64){    console.log(base64);//处理成功打印在控制台  },function(err){    console.log(err);//打印异常信息  });                        }    //传入图片路径，返回base64function getBase64(img){  // width、height调用时传入具体像素值，控制大小 ,不传则默认图像大小  function getBase64Image(img,width,height) {    var canvas = document.createElement("canvas");    canvas.width = width ? width : img.width;    canvas.height = height ? height : img.height;    var ctx = canvas.getContext("2d");    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);    var dataURL = canvas.toDataURL();    return dataURL;  }  var image = new Image();  image.crossOrigin = '';  image.src = img;  var deferred=$.Deferred();  if(img){    image.onload =function (){      deferred.resolve(getBase64Image(image));// 将base64传给done上传处理    }    return deferred.promise();// onload完成后再return sessionStorage['imgTest']  }}  // // 拓展一：后台需要以纯字符串的形式上传（即去掉data:image/png;base64，截取字符串即可）//       reader.result.substring(reader.result.indexOf(",") + 1)// 拓展二：判断base64资源大小，超过2M不让上传        // var AllowImgFileSize = 2100000;    //上传图片最大值(单位字节)（ 2 M = 2097152 B ）        // if (AllowImgFileSize != 0 && AllowImgFileSize < reader.result.length) {        //   alert( '上传失败，请上传不大于2M的图片！');        //   return;        // }      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[/** * mOxie - multi-runtime File API & XMLHttpRequest L2 Polyfill * v1.2.1 * * Copyright 2013, Moxiecode Systems AB * Released under GPL License. * * License: http://www.plupload.com/license * Contributing: http://www.plupload.com/contributing * * Date: 2014-05-14 */!function(e,t){"use strict";function n(e,t){for(var n,i=[],r=0;r<e.length;++r){if(n=s[e[r]]||o(e[r]),!n)throw"module definition dependecy not found: "+e[r];i.push(n)}t.apply(null,i)}function i(e,i,r){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(r===t)throw"invalid module definition, definition function must be specified";n(i,function(){s[e]=r.apply(null,arguments)})}function r(e){return!!s[e]}function o(t){for(var n=e,i=t.split(/[.\/]/),r=0;r<i.length;++r){if(!n[i[r]])return;n=n[i[r]]}return n}function a(n){for(var i=0;i<n.length;i++){for(var r=e,o=n[i],a=o.split(/[.\/]/),u=0;u<a.length-1;++u)r[a[u]]===t&&(r[a[u]]={}),r=r[a[u]];r[a[a.length-1]]=s[o]}}var s={},u="moxie/core/utils/Basic",c="moxie/core/I18n",l="moxie/core/utils/Mime",d="moxie/core/utils/Env",f="moxie/core/utils/Dom",h="moxie/core/Exceptions",p="moxie/core/EventTarget",m="moxie/core/utils/Encode",g="moxie/runtime/Runtime",v="moxie/runtime/RuntimeClient",y="moxie/file/Blob",w="moxie/file/File",E="moxie/file/FileInput",_="moxie/file/FileDrop",x="moxie/runtime/RuntimeTarget",b="moxie/file/FileReader",R="moxie/core/utils/Url",T="moxie/file/FileReaderSync",A="moxie/xhr/FormData",S="moxie/xhr/XMLHttpRequest",O="moxie/runtime/Transporter",I="moxie/image/Image",D="moxie/runtime/html5/Runtime",N="moxie/runtime/html5/file/Blob",L="moxie/core/utils/Events",M="moxie/runtime/html5/file/FileInput",C="moxie/runtime/html5/file/FileDrop",F="moxie/runtime/html5/file/FileReader",H="moxie/runtime/html5/xhr/XMLHttpRequest",P="moxie/runtime/html5/utils/BinaryReader",k="moxie/runtime/html5/image/JPEGHeaders",U="moxie/runtime/html5/image/ExifParser",B="moxie/runtime/html5/image/JPEG",z="moxie/runtime/html5/image/PNG",G="moxie/runtime/html5/image/ImageInfo",q="moxie/runtime/html5/image/MegaPixel",X="moxie/runtime/html5/image/Image",j="moxie/runtime/flash/Runtime",V="moxie/runtime/flash/file/Blob",W="moxie/runtime/flash/file/FileInput",Y="moxie/runtime/flash/file/FileReader",$="moxie/runtime/flash/file/FileReaderSync",J="moxie/runtime/flash/xhr/XMLHttpRequest",Z="moxie/runtime/flash/runtime/Transporter",K="moxie/runtime/flash/image/Image",Q="moxie/runtime/silverlight/Runtime",et="moxie/runtime/silverlight/file/Blob",tt="moxie/runtime/silverlight/file/FileInput",nt="moxie/runtime/silverlight/file/FileDrop",it="moxie/runtime/silverlight/file/FileReader",rt="moxie/runtime/silverlight/file/FileReaderSync",ot="moxie/runtime/silverlight/xhr/XMLHttpRequest",at="moxie/runtime/silverlight/runtime/Transporter",st="moxie/runtime/silverlight/image/Image",ut="moxie/runtime/html4/Runtime",ct="moxie/runtime/html4/file/FileInput",lt="moxie/runtime/html4/file/FileReader",dt="moxie/runtime/html4/xhr/XMLHttpRequest",ft="moxie/runtime/html4/image/Image";i(u,[],function(){var e=function(e){var t;return e===t?"undefined":null===e?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t=function(i){var r;return n(arguments,function(o,s){s>0&&n(o,function(n,o){n!==r&&(e(i[o])===e(n)&&~a(e(n),["array","object"])?t(i[o],n):i[o]=n)})}),i},n=function(e,t){var n,i,r,o;if(e){try{n=e.length}catch(a){n=o}if(n===o){for(i in e)if(e.hasOwnProperty(i)&&t(e[i],i)===!1)return}else for(r=0;n>r;r++)if(t(e[r],r)===!1)return}},i=function(t){var n;if(!t||"object"!==e(t))return!0;for(n in t)return!1;return!0},r=function(t,n){function i(r){"function"===e(t[r])&&t[r](function(e){++r<o&&!e?i(r):n(e)})}var r=0,o=t.length;"function"!==e(n)&&(n=function(){}),t&&t.length||n(),i(r)},o=function(e,t){var i=0,r=e.length,o=new Array(r);n(e,function(e,n){e(function(e){if(e)return t(e);var a=[].slice.call(arguments);a.shift(),o[n]=a,i++,i===r&&(o.unshift(null),t.apply(this,o))})})},a=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n}return-1},s=function(t,n){var i=[];"array"!==e(t)&&(t=[t]),"array"!==e(n)&&(n=[n]);for(var r in t)-1===a(t[r],n)&&i.push(t[r]);return i.length?i:!1},u=function(e,t){var i=[];return n(e,function(e){-1!==a(e,t)&&i.push(e)}),i.length?i:null},c=function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},l=function(){var e=0;return function(t){var n=(new Date).getTime().toString(32),i;for(i=0;5>i;i++)n+=Math.floor(65535*Math.random()).toString(32);return(t||"o_")+n+(e++).toString(32)}}(),d=function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},f=function(e){if("string"!=typeof e)return e;var t={t:1099511627776,g:1073741824,m:1048576,k:1024},n;return e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),n=e[2],e=+e[1],t.hasOwnProperty(n)&&(e*=t[n]),e};return{guid:l,typeOf:e,extend:t,each:n,isEmptyObj:i,inSeries:r,inParallel:o,inArray:a,arrayDiff:s,arrayIntersect:u,toArray:c,trim:d,parseSizeStr:f}}),i(c,[u],function(e){var t={};return{addI18n:function(n){return e.extend(t,n)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(t){var n=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=n.shift();return"undefined"!==e.typeOf(t)?t:""})}}}),i(l,[u,c],function(e,t){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",i={mimes:{},extensions:{},addMimeType:function(e){var t=e.split(/,/),n,i,r;for(n=0;n<t.length;n+=2){for(r=t[n+1].split(/ /),i=0;i<r.length;i++)this.mimes[r[i]]=t[n];this.extensions[t[n]]=r}},extList2mimes:function(t,n){var i=this,r,o,a,s,u=[];for(o=0;o<t.length;o++)for(r=t[o].extensions.split(/\s*,\s*/),a=0;a<r.length;a++){if("*"===r[a])return[];if(s=i.mimes[r[a]])-1===e.inArray(s,u)&&u.push(s);else{if(!n||!/^\w+$/.test(r[a]))return[];u.push("."+r[a])}}return u},mimes2exts:function(t){var n=this,i=[];return e.each(t,function(t){if("*"===t)return i=[],!1;var r=t.match(/^(\w+)\/(\*|\w+)$/);r&&("*"===r[2]?e.each(n.extensions,function(e,t){new RegExp("^"+r[1]+"/").test(t)&&[].push.apply(i,n.extensions[t])}):n.extensions[t]&&[].push.apply(i,n.extensions[t]))}),i},mimes2extList:function(n){var i=[],r=[];return"string"===e.typeOf(n)&&(n=e.trim(n).split(/\s*,\s*/)),r=this.mimes2exts(n),i.push({title:t.translate("Files"),extensions:r.length?r.join(","):"*"}),i.mimes=n,i},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};return i.addMimeType(n),i}),i(d,[u],function(e){function t(e,t,n){var i=0,r=0,o=0,a={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},s=function(e){return e=(""+e).replace(/[_\-+]/g,"."),e=e.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),e.length?e.split("."):[-8]},u=function(e){return e?isNaN(e)?a[e]||-7:parseInt(e,10):0};for(e=s(e),t=s(t),r=Math.max(e.length,t.length),i=0;r>i;i++)if(e[i]!=t[i]){if(e[i]=u(e[i]),t[i]=u(t[i]),e[i]<t[i]){o=-1;break}if(e[i]>t[i]){o=1;break}}if(!n)return o;switch(n){case">":case"gt":return o>0;case">=":case"ge":return o>=0;case"<=":case"le":return 0>=o;case"==":case"=":case"eq":return 0===o;case"<>":case"!=":case"ne":return 0!==o;case"":case"<":case"lt":return 0>o;default:return null}}var n=function(e){var t="",n="?",i="function",r="undefined",o="object",a="major",s="model",u="name",c="type",l="vendor",d="version",f="architecture",h="console",p="mobile",m="tablet",g={has:function(e,t){return-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()}},v={rgx:function(){for(var t,n=0,a,s,u,c,l,d,f=arguments;n<f.length;n+=2){var h=f[n],p=f[n+1];if(typeof t===r){t={};for(u in p)c=p[u],typeof c===o?t[c[0]]=e:t[c]=e}for(a=s=0;a<h.length;a++)if(l=h[a].exec(this.getUA())){for(u=0;u<p.length;u++)d=l[++s],c=p[u],typeof c===o&&c.length>0?2==c.length?t[c[0]]=typeof c[1]==i?c[1].call(this,d):c[1]:3==c.length?t[c[0]]=typeof c[1]!==i||c[1].exec&&c[1].test?d?d.replace(c[1],c[2]):e:d?c[1].call(this,d,c[2]):e:4==c.length&&(t[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):e):t[c]=d?d:e;break}if(l)break}return t},str:function(t,i){for(var r in i)if(typeof i[r]===o&&i[r].length>0){for(var a=0;a<i[r].length;a++)if(g.has(i[r][a],t))return r===n?e:r}else if(g.has(i[r],t))return r===n?e:r;return t}},y={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},w={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[u,d,a],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[u,"Opera"],d,a],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[u,d,a],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[u,"IE"],d,a],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[u,"Yandex"],d,a],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[u,/_/g," "],d,a],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[u,d,a],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[u,"Dolphin"],d,a],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[u,"Chrome"],d,a],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[u,"Android Browser"],d,a],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[d,a,[u,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[d,a,u],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[u,[a,v.str,y.browser.oldsafari.major],[d,v.str,y.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[u,d,a],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[u,"Netscape"],d,a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[u,d,a]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[u,d],[/rv\:([\w\.]+).*(gecko)/i],[d,u]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[u,[d,v.str,y.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[u,"Windows"],[d,v.str,y.os.windows.version]],[/\((bb)(10);/i],[[u,"BlackBerry"],d],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[u,d],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[u,"Symbian"],d],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[u,"Firefox OS"],d],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[u,d],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[u,"Chromium OS"],d],[/(sunos)\s?([\w\.]+\d)*/i],[[u,"Solaris"],d],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[u,d],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[u,"iOS"],[d,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[u,[d,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[u,d]]},E=function(e){var n=e||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:t);this.getBrowser=function(){return v.rgx.apply(this,w.browser)},this.getEngine=function(){return v.rgx.apply(this,w.engine)},this.getOS=function(){return v.rgx.apply(this,w.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this.setUA(n)};return(new E).getResult()}(),i=function(){var t={define_property:function(){return!1}(),create_canvas:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),return_response_type:function(t){try{if(-1!==e.inArray(t,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;if(n.open("get","/"),"responseType"in n)return n.responseType=t,n.responseType!==t?!1:!0}}catch(i){}return!1},use_data_uri:function(){var e=new Image;return e.onload=function(){t.use_data_uri=1===e.width&&1===e.height},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return t.use_data_uri&&("IE"!==r.browser||r.version>=9)},use_data_uri_of:function(e){return t.use_data_uri&&33e3>e||t.use_data_uri_over32kb()},use_fileinput:function(){var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled}};return function(n){var i=[].slice.call(arguments);return i.shift(),"function"===e.typeOf(t[n])?t[n].apply(this,i):!!t[n]}}(),r={can:i,browser:n.browser.name,version:parseFloat(n.browser.major),os:n.os.name,osVersion:n.os.version,verComp:t,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return r.OS=r.os,r}),i(f,[d],function(e){var t=function(e){return"string"!=typeof e?e:document.getElementById(e)},n=function(e,t){if(!e.className)return!1;var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");return n.test(e.className)},i=function(e,t){n(e,t)||(e.className=e.className?e.className.replace(/\s+$/,"")+" "+t:t)},r=function(e,t){if(e.className){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})}},o=function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},a=function(t,n){function i(e){var t,n,i=0,r=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===s.compatMode?s.documentElement:s.body,i=n.left+t.scrollLeft,r=n.top+t.scrollTop),{x:i,y:r}}var r=0,o=0,a,s=document,u,c;if(t=t,n=n||s.body,t&&t.getBoundingClientRect&&"IE"===e.browser&&(!s.documentMode||s.documentMode<8))return u=i(t),c=i(n),{x:u.x-c.x,y:u.y-c.y};for(a=t;a&&a!=n&&a.nodeType;)r+=a.offsetLeft||0,o+=a.offsetTop||0,a=a.offsetParent;for(a=t.parentNode;a&&a!=n&&a.nodeType;)r-=a.scrollLeft||0,o-=a.scrollTop||0,a=a.parentNode;return{x:r,y:o}},s=function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}};return{get:t,hasClass:n,addClass:i,removeClass:r,getStyle:o,getPos:a,getSize:s}}),i(h,[u],function(e){function t(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": RuntimeError "+this.code}var i={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return e.extend(n,i),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function t(e){this.code=e,this.name="OperationNotAllowedException"}return e.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": ImageError "+this.code}var i={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return e.extend(n,i),n.prototype=Error.prototype,n}(),FileException:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": FileException "+this.code}var i={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return e.extend(n,i),n.prototype=Error.prototype,n}(),DOMException:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": DOMException "+this.code}var i={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return e.extend(n,i),n.prototype=Error.prototype,n}(),EventException:function(){function t(e){this.code=e,this.name="EventException"}return e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}}),i(p,[h,u],function(e,t){function n(){var n={};t.extend(this,{uid:null,init:function(){this.uid||(this.uid=t.guid("uid_"))},addEventListener:function(e,i,r,o){var a=this,s;return e=t.trim(e),/\s/.test(e)?void t.each(e.split(/\s+/),function(e){a.addEventListener(e,i,r,o)}):(e=e.toLowerCase(),r=parseInt(r,10)||0,s=n[this.uid]&&n[this.uid][e]||[],s.push({fn:i,priority:r,scope:o||this}),n[this.uid]||(n[this.uid]={}),void(n[this.uid][e]=s))},hasEventListener:function(e){return e?!(!n[this.uid]||!n[this.uid][e]):!!n[this.uid]},removeEventListener:function(e,i){e=e.toLowerCase();var r=n[this.uid]&&n[this.uid][e],o;if(r){if(i){for(o=r.length-1;o>=0;o--)if(r[o].fn===i){r.splice(o,1);break}}else r=[];r.length||(delete n[this.uid][e],t.isEmptyObj(n[this.uid])&&delete n[this.uid])}},removeAllEventListeners:function(){n[this.uid]&&delete n[this.uid]},dispatchEvent:function(i){var r,o,a,s,u={},c=!0,l;if("string"!==t.typeOf(i)){if(s=i,"string"!==t.typeOf(s.type))throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);i=s.type,s.total!==l&&s.loaded!==l&&(u.total=s.total,u.loaded=s.loaded),u.async=s.async||!1}if(-1!==i.indexOf("::")?!function(e){r=e[0],i=e[1]}(i.split("::")):r=this.uid,i=i.toLowerCase(),o=n[r]&&n[r][i]){o.sort(function(e,t){return t.priority-e.priority}),a=[].slice.call(arguments),a.shift(),u.type=i,a.unshift(u);var d=[];t.each(o,function(e){a[0].target=e.scope,d.push(u.async?function(t){setTimeout(function(){t(e.fn.apply(e.scope,a)===!1)},1)}:function(t){t(e.fn.apply(e.scope,a)===!1)})}),d.length&&t.inSeries(d,function(e){c=!e})}return c},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(e){var n;"array"!==t.typeOf(e)&&(e=[e]);for(var i=0;i<e.length;i++)n="on"+e[i],"function"===t.typeOf(this[n])?this.addEventListener(e[i],this[n]):"undefined"===t.typeOf(this[n])&&(this[n]=null)}})}return n.instance=new n,n}),i(m,[],function(){var e=function(e){return unescape(encodeURIComponent(e))},t=function(e){return decodeURIComponent(escape(e))},n=function(e,n){if("function"==typeof window.atob)return n?t(window.atob(e)):window.atob(e);var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,o,a,s,u,c,l,d,f=0,h=0,p="",m=[];if(!e)return e;e+="";do s=i.indexOf(e.charAt(f++)),u=i.indexOf(e.charAt(f++)),c=i.indexOf(e.charAt(f++)),l=i.indexOf(e.charAt(f++)),d=s<<18|u<<12|c<<6|l,r=d>>16&255,o=d>>8&255,a=255&d,m[h++]=64==c?String.fromCharCode(r):64==l?String.fromCharCode(r,o):String.fromCharCode(r,o,a);while(f<e.length);return p=m.join(""),n?t(p):p},i=function(t,n){if(n&&e(t),"function"==typeof window.btoa)return window.btoa(t);var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,o,a,s,u,c,l,d,f=0,h=0,p="",m=[];if(!t)return t;do r=t.charCodeAt(f++),o=t.charCodeAt(f++),a=t.charCodeAt(f++),d=r<<16|o<<8|a,s=d>>18&63,u=d>>12&63,c=d>>6&63,l=63&d,m[h++]=i.charAt(s)+i.charAt(u)+i.charAt(c)+i.charAt(l);while(f<t.length);p=m.join("");var g=t.length%3;return(g?p.slice(0,g-3):p)+"===".slice(g||3)};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:i}}),i(g,[u,f,p],function(e,t,n){function i(n,r,a,s,u){var c=this,l,d=e.guid(r+"_"),f=u||"browser";n=n||{},o[d]=this,a=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},a),n.preferred_caps&&(f=i.getMode(s,n.preferred_caps,f)),l=function(){var t={};return{exec:function(e,n,i,r){return l[n]&&(t[e]||(t[e]={context:this,instance:new l[n]}),t[e].instance[i])?t[e].instance[i].apply(this,r):void 0},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,i){"function"===e.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context),n.removeInstance(i)})}}}(),e.extend(this,{initialized:!1,uid:d,type:r,mode:i.getMode(s,n.required_caps,f),shimid:d+"_container",clients:0,options:n,can:function(t,n){var r=arguments[2]||a;if("string"===e.typeOf(t)&&"undefined"===e.typeOf(n)&&(t=i.parseCaps(t)),"object"===e.typeOf(t)){for(var o in t)if(!this.can(o,t[o],r))return!1;return!0}return"function"===e.typeOf(r[t])?r[t].call(this,n):n===r[t]},getShimContainer:function(){var n,i=t.get(this.shimid);return i||(n=this.options.container?t.get(this.options.container):document.body,i=document.createElement("div"),i.id=this.shimid,i.className="moxie-shim moxie-shim-"+this.type,e.extend(i.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.appendChild(i),n=null),i},getShim:function(){return l},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return c[e]&&c[e][t]?c[e][t].apply(this,n):c.shimExec.apply(this,arguments)},destroy:function(){if(c){var e=t.get(this.shimid);e&&e.parentNode.removeChild(e),l&&l.removeAllInstances(),this.unbindAll(),delete o[this.uid],this.uid=null,d=c=l=e=null}}}),this.mode&&n.required_caps&&!this.can(n.required_caps)&&(this.mode=!1)}var r={},o={};return i.order="html5,flash,silverlight,html4",i.getRuntime=function(e){return o[e]?o[e]:!1},i.addConstructor=function(e,t){t.prototype=n.instance,r[e]=t},i.getConstructor=function(e){return r[e]||null},i.getInfo=function(e){var t=i.getRuntime(e);return t?{uid:t.uid,type:t.type,mode:t.mode,can:function(){return t.can.apply(t,arguments)}}:null},i.parseCaps=function(t){var n={};return"string"!==e.typeOf(t)?t||{}:(e.each(t.split(","),function(e){n[e]=!0}),n)},i.can=function(e,t){var n,r=i.getConstructor(e),o;return r?(n=new r({required_caps:t}),o=n.mode,n.destroy(),!!o):!1},i.thatCan=function(e,t){var n=(t||i.order).split(/\s*,\s*/);for(var r in n)if(i.can(n[r],e))return n[r];return null},i.getMode=function(t,n,i){var r=null;if("undefined"===e.typeOf(i)&&(i="browser"),n&&!e.isEmptyObj(t)){if(e.each(n,function(n,i){if(t.hasOwnProperty(i)){var o=t[i](n);if("string"==typeof o&&(o=[o]),r){if(!(r=e.arrayIntersect(r,o)))return r=!1}else r=o}}),r)return-1!==e.inArray(i,r)?i:r[0];if(r===!1)return!1}return i},i.capTrue=function(){return!0},i.capFalse=function(){return!1},i.capTest=function(e){return function(){return!!e}},i}),i(v,[h,u,g],function(e,t,n){return function i(){var i;t.extend(this,{connectRuntime:function(r){function o(t){var s,u;return t.length?(s=t.shift(),(u=n.getConstructor(s))?(i=new u(r),i.bind("Init",function(){i.initialized=!0,setTimeout(function(){i.clients++,a.trigger("RuntimeInit",i)},1)}),i.bind("Error",function(){i.destroy(),o(t)}),i.mode?void i.init():void i.trigger("Error")):void o(t)):(a.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),void(i=null))}var a=this,s;if("string"===t.typeOf(r)?s=r:"string"===t.typeOf(r.ruid)&&(s=r.ruid),s){if(i=n.getRuntime(s))return i.clients++,i;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}o((r.runtime_order||n.order).split(/\s*,\s*/))},getRuntime:function(){return i&&i.uid?i:(i=null,null)},disconnectRuntime:function(){i&&--i.clients<=0&&(i.destroy(),i=null)}})}}),i(y,[u,m,v],function(e,t,n){function i(o,a){function s(t,n,o){var a,s=r[this.uid];return"string"===e.typeOf(s)&&s.length?(a=new i(null,{type:o,size:n-t}),a.detach(s.substr(t,a.size)),a):null}n.call(this),o&&this.connectRuntime(o),a?"string"===e.typeOf(a)&&(a={data:a}):a={},e.extend(this,{uid:a.uid||e.guid("uid_"),ruid:o,size:a.size||0,type:a.type||"",slice:function(e,t,n){return this.isDetached()?s.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return r[this.uid]?r[this.uid]:null},detach:function(e){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),e=e||"";var n=e.match(/^data:([^;]*);base64,/);n&&(this.type=n[1],e=t.atob(e.substring(e.indexOf("base64,")+7))),this.size=e.length,r[this.uid]=e},isDetached:function(){return!this.ruid&&"string"===e.typeOf(r[this.uid])},destroy:function(){this.detach(),delete r[this.uid]}}),a.data?this.detach(a.data):r[this.uid]=a}var r={};return i}),i(w,[u,l,y],function(e,t,n){function i(i,r){var o,a;if(r||(r={}),a=r.type&&""!==r.type?r.type:t.getFileMime(r.name),r.name)o=r.name.replace(/\\/g,"/"),o=o.substr(o.lastIndexOf("/")+1);else{var s=a.split("/")[0];o=e.guid((""!==s?s:"file")+"_"),t.extensions[a]&&(o+="."+t.extensions[a][0])}n.apply(this,arguments),e.extend(this,{type:a||"",name:o||e.guid("file_"),lastModifiedDate:r.lastModifiedDate||(new Date).toLocaleString()})}return i.prototype=n.prototype,i}),i(E,[u,l,f,h,p,c,w,g,v],function(e,t,n,i,r,o,a,s,u){function c(r){var c=this,d,f,h;if(-1!==e.inArray(e.typeOf(r),["string","node"])&&(r={browse_button:r}),f=n.get(r.browse_button),!f)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR);h={accept:[{title:o.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:f.parentNode||document.body},r=e.extend({},h,r),"string"==typeof r.required_caps&&(r.required_caps=s.parseCaps(r.required_caps)),"string"==typeof r.accept&&(r.accept=t.mimes2extList(r.accept)),d=n.get(r.container),d||(d=document.body),"static"===n.getStyle(d,"position")&&(d.style.position="relative"),d=f=null,u.call(c),e.extend(c,{uid:e.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){c.convertEventPropsToHandlers(l),c.bind("RuntimeInit",function(t,i){c.ruid=i.uid,c.shimid=i.shimid,c.bind("Ready",function(){c.trigger("Refresh")},999),c.bind("Change",function(){var t=i.exec.call(c,"FileInput","getFiles");c.files=[],e.each(t,function(e){return 0===e.size?!0:void c.files.push(new a(c.ruid,e))})},999),c.bind("Refresh",function(){var t,o,a,s;a=n.get(r.browse_button),s=n.get(i.shimid),a&&(t=n.getPos(a,n.get(r.container)),o=n.getSize(a),s&&e.extend(s.style,{top:t.y+"px",left:t.x+"px",width:o.w+"px",height:o.h+"px"})),s=a=null}),i.exec.call(c,"FileInput","init",r)}),c.connectRuntime(e.extend({},r,{required_caps:{select_file:!0}}))},disable:function(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===e.typeOf(t)?!0:t)},refresh:function(){c.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===e.typeOf(this.files)&&e.each(this.files,function(e){e.destroy()}),this.files=null}})}var l=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return c.prototype=r.instance,c}),i(_,[c,f,h,u,w,v,p,l],function(e,t,n,i,r,o,a,s){function u(n){var a=this,u;"string"==typeof n&&(n={drop_zone:n}),u={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?i.extend({},u,n):u,n.container=t.get(n.drop_zone)||document.body,"static"===t.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=s.mimes2extList(n.accept)),o.call(a),i.extend(a,{uid:i.guid("uid_"),ruid:null,files:null,init:function(){a.convertEventPropsToHandlers(c),a.bind("RuntimeInit",function(e,t){a.ruid=t.uid,a.bind("Drop",function(){var e=t.exec.call(a,"FileDrop","getFiles");a.files=[],i.each(e,function(e){a.files.push(new r(a.ruid,e))})},999),t.exec.call(a,"FileDrop","init",n),a.dispatchEvent("ready")}),a.connectRuntime(n)},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var c=["ready","dragenter","dragleave","drop","error"];return u.prototype=a.instance,u}),i(x,[u,v,p],function(e,t,n){function i(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return i.prototype=n.instance,i}),i(b,[u,m,h,p,y,w,x],function(e,t,n,i,r,o,a){function s(){function i(e,i){function l(e){o.readyState=s.DONE,o.error=e,o.trigger("error"),d()}function d(){c.destroy(),c=null,o.trigger("loadend")}function f(t){c.bind("Error",function(e,t){l(t)}),c.bind("Progress",function(e){o.result=t.exec.call(c,"FileReader","getResult"),o.trigger(e)}),c.bind("Load",function(e){o.readyState=s.DONE,o.result=t.exec.call(c,"FileReader","getResult"),o.trigger(e),d()}),t.exec.call(c,"FileReader","read",e,i)}if(c=new a,this.convertEventPropsToHandlers(u),this.readyState===s.LOADING)return l(new n.DOMException(n.DOMException.INVALID_STATE_ERR));if(this.readyState=s.LOADING,this.trigger("loadstart"),i instanceof r)if(i.isDetached()){var h=i.getSource();switch(e){case"readAsText":case"readAsBinaryString":this.result=h;break;case"readAsDataURL":this.result="data:"+i.type+";base64,"+t.btoa(h)}this.readyState=s.DONE,this.trigger("load"),d()}else f(c.connectRuntime(i.ruid));else l(new n.DOMException(n.DOMException.NOT_FOUND_ERR))}var o=this,c;e.extend(this,{uid:e.guid("uid_"),readyState:s.EMPTY,result:null,error:null,readAsBinaryString:function(e){i.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){i.call(this,"readAsDataURL",e)},readAsText:function(e){i.call(this,"readAsText",e)},abort:function(){this.result=null,-1===e.inArray(this.readyState,[s.EMPTY,s.DONE])&&(this.readyState===s.LOADING&&(this.readyState=s.DONE),c&&c.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),c&&(c.getRuntime().exec.call(this,"FileReader","destroy"),c.disconnectRuntime()),o=c=null}})}var u=["loadstart","progress","load","abort","error","loadend"];return s.EMPTY=0,s.LOADING=1,s.DONE=2,s.prototype=i.instance,s}),i(R,[],function(){var e=function(t,n){for(var i=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],r=i.length,o={http:80,https:443},a={},s=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,u=s.exec(t||"");r--;)u[r]&&(a[i[r]]=u[r]);if(!a.scheme){n&&"string"!=typeof n||(n=e(n||document.location.href)),a.scheme=n.scheme,a.host=n.host,a.port=n.port;var c="";/^[^\/]/.test(a.path)&&(c=n.path,/(\/|\/[^\.]+)$/.test(c)?c+="/":c=c.replace(/\/[^\/]+$/,"/")),a.path=c+(a.path||"")}return a.port||(a.port=o[a.scheme]||80),a.port=parseInt(a.port,10),a.path||(a.path="/"),delete a.source,a},t=function(t){var n={http:80,https:443},i=e(t);return i.scheme+"://"+i.host+(i.port!==n[i.scheme]?":"+i.port:"")+i.path+(i.query?i.query:"")},n=function(t){function n(e){return[e.scheme,e.host,e.port].join("/")}return"string"==typeof t&&(t=e(t)),n(e())===n(t)};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n}}),i(T,[u,v,m],function(e,t,n){return function(){function i(e,t){if(!t.isDetached()){var i=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),i}var r=t.getSource();switch(e){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(r);case"readAsText":for(var o="",a=0,s=r.length;s>a;a++)o+=String.fromCharCode(r[a]);return o}}t.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return i.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return i.call(this,"readAsDataURL",e)},readAsText:function(e){return i.call(this,"readAsText",e)}})}}),i(A,[h,u,y],function(e,t,n){function i(){var e,i=[];t.extend(this,{append:function(r,o){var a=this,s=t.typeOf(o);o instanceof n?e={name:r,value:o}:"array"===s?(r+="[]",t.each(o,function(e){a.append(r,e)})):"object"===s?t.each(o,function(e,t){a.append(r+"["+t+"]",e)}):"null"===s||"undefined"===s||"number"===s&&isNaN(o)?a.append(r,"false"):i.push({name:r,value:o.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return e&&e.value||null},getBlobName:function(){return e&&e.name||null},each:function(n){t.each(i,function(e){n(e.value,e.name)}),e&&n(e.value,e.name)},destroy:function(){e=null,i=[]}})}return i}),i(S,[u,h,p,m,R,g,x,y,T,A,d,l],function(e,t,n,i,r,o,a,s,u,c,l,d){function f(){this.uid=e.guid("uid_")}function h(){function n(e,t){return y.hasOwnProperty(e)?1===arguments.length?l.can("define_property")?y[e]:v[e]:void(l.can("define_property")?y[e]=t:v[e]=t):void 0}function u(t){function i(){k&&(k.destroy(),k=null),s.dispatchEvent("loadend"),s=null}function r(r){k.bind("LoadStart",function(e){n("readyState",h.LOADING),s.dispatchEvent("readystatechange"),s.dispatchEvent(e),I&&s.upload.dispatchEvent(e)}),k.bind("Progress",function(e){n("readyState")!==h.LOADING&&(n("readyState",h.LOADING),s.dispatchEvent("readystatechange")),s.dispatchEvent(e)}),k.bind("UploadProgress",function(e){I&&s.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),k.bind("Load",function(t){n("readyState",h.DONE),n("status",Number(r.exec.call(k,"XMLHttpRequest","getStatus")||0)),n("statusText",p[n("status")]||""),n("response",r.exec.call(k,"XMLHttpRequest","getResponse",n("responseType"))),~e.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),U=r.exec.call(k,"XMLHttpRequest","getAllResponseHeaders"),s.dispatchEvent("readystatechange"),n("status")>0?(I&&s.upload.dispatchEvent(t),s.dispatchEvent(t)):(N=!0,s.dispatchEvent("error")),i()}),k.bind("Abort",function(e){s.dispatchEvent(e),i()}),k.bind("Error",function(e){N=!0,n("readyState",h.DONE),s.dispatchEvent("readystatechange"),D=!0,s.dispatchEvent(e),i()}),r.exec.call(k,"XMLHttpRequest","send",{url:E,method:_,async:w,user:b,password:R,headers:x,mimeType:A,encoding:T,responseType:s.responseType,withCredentials:s.withCredentials,options:P},t)}var s=this;M=(new Date).getTime(),k=new a,"string"==typeof P.required_caps&&(P.required_caps=o.parseCaps(P.required_caps)),P.required_caps=e.extend({},P.required_caps,{return_response_type:s.responseType}),t instanceof c&&(P.required_caps.send_multipart=!0),L||(P.required_caps.do_cors=!0),P.ruid?r(k.connectRuntime(P)):(k.bind("RuntimeInit",function(e,t){r(t)}),k.bind("RuntimeError",function(e,t){s.dispatchEvent("RuntimeError",t)}),k.connectRuntime(P))}function g(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),M=C=null}var v=this,y={timeout:0,readyState:h.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},w=!0,E,_,x={},b,R,T=null,A=null,S=!1,O=!1,I=!1,D=!1,N=!1,L=!1,M,C,F=null,H=null,P={},k,U="",B;e.extend(this,y,{uid:e.guid("uid_"),upload:new f,open:function(o,a,s,u,c){var l;if(!o||!a)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(o)||i.utf8_encode(o)!==o)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~e.inArray(o.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(_=o.toUpperCase()),~e.inArray(_,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(a=i.utf8_encode(a),l=r.parseUrl(a),L=r.hasSameOrigin(l),E=r.resolveUrl(a),(u||c)&&!L)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(b=u||l.user,R=c||l.pass,w=s||!0,w===!1&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);S=!w,O=!1,x={},g.call(this),n("readyState",h.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(r,o){var a=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==h.OPENED||O)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(r)||i.utf8_encode(r)!==r)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return r=e.trim(r).toLowerCase(),~e.inArray(r,a)||/^(proxy\-|sec\-)/.test(r)?!1:(x[r]?x[r]+=", "+o:x[r]=o,!0)},getAllResponseHeaders:function(){return U||""},getResponseHeader:function(t){return t=t.toLowerCase(),N||~e.inArray(t,["set-cookie","set-cookie2"])?null:U&&""!==U&&(B||(B={},e.each(U.split(/\r\n/),function(t){var n=t.split(/:\s+/);2===n.length&&(n[0]=e.trim(n[0]),B[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])})})),B.hasOwnProperty(t))?B[t].header+": "+B[t].value:null},overrideMimeType:function(i){var r,o;if(~e.inArray(n("readyState"),[h.LOADING,h.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(i=e.trim(i.toLowerCase()),/;/.test(i)&&(r=i.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(i=r[1],r[2]&&(o=r[2])),!d.mimes[i])throw new t.DOMException(t.DOMException.SYNTAX_ERR);F=i,H=o},send:function(n,r){if(P="string"===e.typeOf(r)?{ruid:r}:r?r:{},this.convertEventPropsToHandlers(m),this.upload.convertEventPropsToHandlers(m),this.readyState!==h.OPENED||O)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(n instanceof s)P.ruid=n.ruid,A=n.type||"application/octet-stream";else if(n instanceof c){if(n.hasBlob()){var o=n.getBlob();P.ruid=o.ruid,A=o.type||"application/octet-stream"}}else"string"==typeof n&&(T="UTF-8",A="text/plain;charset=UTF-8",n=i.utf8_encode(n));this.withCredentials||(this.withCredentials=P.required_caps&&P.required_caps.send_browser_cookies&&!L),I=!S&&this.upload.hasEventListener(),N=!1,D=!n,S||(O=!0),u.call(this,n)},abort:function(){if(N=!0,S=!1,~e.inArray(n("readyState"),[h.UNSENT,h.OPENED,h.DONE]))n("readyState",h.UNSENT);else{if(n("readyState",h.DONE),O=!1,!k)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);k.getRuntime().exec.call(k,"XMLHttpRequest","abort",D),D=!0}},destroy:function(){k&&("function"===e.typeOf(k.destroy)&&k.destroy(),k=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var p={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};f.prototype=n.instance;var m=["loadstart","progress","abort","error","load","timeout","loadend"],g=1,v=2;return h.UNSENT=0,h.OPENED=1,h.HEADERS_RECEIVED=2,h.LOADING=3,h.DONE=4,h.prototype=n.instance,h}),i(O,[u,m,v,p],function(e,t,n,i){function r(){function i(){l=d=0,c=this.result=null}function o(t,n){var i=this;u=n,i.bind("TransportingProgress",function(t){d=t.loaded,l>d&&-1===e.inArray(i.state,[r.IDLE,r.DONE])&&a.call(i)},999),i.bind("TransportingComplete",function(){d=l,i.state=r.DONE,c=null,i.result=u.exec.call(i,"Transporter","getAsBlob",t||"")},999),i.state=r.BUSY,i.trigger("TransportingStarted"),a.call(i)}function a(){var e=this,n,i=l-d;f>i&&(f=i),n=t.btoa(c.substr(d,f)),u.exec.call(e,"Transporter","receive",n,l)}var s,u,c,l,d,f;n.call(this),e.extend(this,{uid:e.guid("uid_"),state:r.IDLE,result:null,transport:function(t,n,r){var a=this;if(r=e.extend({chunk_size:204798},r),(s=r.chunk_size%3)&&(r.chunk_size+=3-s),f=r.chunk_size,i.call(this),c=t,l=t.length,"string"===e.typeOf(r)||r.ruid)o.call(a,n,this.connectRuntime(r));else{var u=function(e,t){a.unbind("RuntimeInit",u),o.call(a,n,t)};this.bind("RuntimeInit",u),this.connectRuntime(r)}},abort:function(){var e=this;e.state=r.IDLE,u&&(u.exec.call(e,"Transporter","clear"),e.trigger("TransportingAborted")),i.call(e)},destroy:function(){this.unbindAll(),u=null,this.disconnectRuntime(),i.call(this)}})}return r.IDLE=0,r.BUSY=1,r.DONE=2,r.prototype=i.instance,r}),i(I,[u,f,h,T,S,g,v,O,d,p,y,w,m],function(e,t,n,i,r,o,a,s,u,c,l,d,f){function h(){function i(e){e||(e=this.getRuntime().exec.call(this,"Image","getInfo")),this.size=e.size,this.width=e.width,this.height=e.height,this.type=e.type,this.meta=e.meta,""===this.name&&(this.name=e.name)}function c(t){var i=e.typeOf(t);try{if(t instanceof h){if(!t.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);m.apply(this,arguments)}else if(t instanceof l){if(!~e.inArray(t.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);g.apply(this,arguments)}else if(-1!==e.inArray(i,["blob","file"]))c.call(this,new d(null,t),arguments[1]);else if("string"===i)/^data:[^;]*;base64,/.test(t)?c.call(this,new l(null,{data:t}),arguments[1]):v.apply(this,arguments);else{if("node"!==i||"img"!==t.nodeName.toLowerCase())throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);c.call(this,t.src,arguments[1])}}catch(r){this.trigger("error",r.code)}}function m(t,n){var i=this.connectRuntime(t.ruid);this.ruid=i.uid,i.exec.call(this,"Image","loadFromImage",t,"undefined"===e.typeOf(n)?!0:n)}function g(t,n){function i(e){r.ruid=e.uid,e.exec.call(r,"Image","loadFromBlob",t)}var r=this;r.name=t.name||"",t.isDetached()?(this.bind("RuntimeInit",function(e,t){i(t)}),n&&"string"==typeof n.required_caps&&(n.required_caps=o.parseCaps(n.required_caps)),this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):i(this.connectRuntime(t.ruid))}function v(e,t){var n=this,i;i=new r,i.open("get",e),i.responseType="blob",i.onprogress=function(e){n.trigger(e)},i.onload=function(){g.call(n,i.response,!0)},i.onerror=function(e){n.trigger(e)},i.onloadend=function(){i.destroy()},i.bind("RuntimeError",function(e,t){n.trigger("RuntimeError",t)}),i.send(null,t)}a.call(this),e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){i.call(this)},999),this.convertEventPropsToHandlers(p),c.apply(this,arguments)},downsize:function(t){var i={width:this.width,height:this.height,crop:!1,preserveHeaders:!0};t="object"==typeof t?e.extend(i,t):e.extend(i,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>h.MAX_RESIZE_WIDTH||this.height>h.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);this.getRuntime().exec.call(this,"Image","downsize",t.width,t.height,t.crop,t.preserveHeaders)}catch(r){this.trigger("error",r.code)}},crop:function(e,t,n){this.downsize(e,t,!0,n)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);var e=this.connectRuntime(this.ruid);return e.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return e||(e="image/jpeg"),"image/jpeg"!==e||t||(t=90),this.getRuntime().exec.call(this,"Image","getAsBlob",e,t)},getAsDataURL:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",e,t)},getAsBinaryString:function(e,t){var n=this.getAsDataURL(e,t);return f.atob(n.substring(n.indexOf("base64,")+7))},embed:function(i){function r(){if(u.can("create_canvas")){var t=a.getAsCanvas();if(t)return i.appendChild(t),t=null,a.destroy(),void o.trigger("embedded")}var r=a.getAsDataURL(c,l);if(!r)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",r.length))i.innerHTML='<img src="'+r+'" width="'+a.width+'" height="'+a.height+'" />',a.destroy(),o.trigger("embedded");else{var d=new s;d.bind("TransportingComplete",function(){v=o.connectRuntime(this.result.ruid),o.bind("Embedded",function(){e.extend(v.getShimContainer().style,{top:"0px",left:"0px",width:a.width+"px",height:a.height+"px"}),v=null},999),v.exec.call(o,"ImageView","display",this.result.uid,m,g),a.destroy()}),d.transport(f.atob(r.substring(r.indexOf("base64,")+7)),c,e.extend({},p,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:i}))}}var o=this,a,c,l,d,p=arguments[1]||{},m=this.width,g=this.height,v;try{if(!(i=t.get(i)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>h.MAX_RESIZE_WIDTH||this.height>h.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);if(c=p.type||this.type||"image/jpeg",l=p.quality||90,d="undefined"!==e.typeOf(p.crop)?p.crop:!1,p.width)m=p.width,g=p.height||m;else{var y=t.getSize(i);y.w&&y.h&&(m=y.w,g=y.h)}return a=new h,a.bind("Resize",function(){r.call(o)}),a.bind("Load",function(){a.downsize(m,g,d,!1)}),a.clone(this,!1),a}catch(w){this.trigger("error",w.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var p=["progress","load","error","resize","embedded"];return h.MAX_RESIZE_WIDTH=6500,h.MAX_RESIZE_HEIGHT=6500,h.prototype=c.instance,h}),i(D,[u,h,g,d],function(e,t,n,i){function r(t){var r=this,s=n.capTest,u=n.capTrue,c=e.extend({access_binary:s(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return r.can("access_binary")&&!!a.Image},display_media:s(i.can("create_canvas")||i.can("use_data_uri_over32kb")),do_cors:s(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:s(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&("IE"!==i.browser||i.version>9)}()),filter_by_extension:s(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),return_response_headers:u,return_response_type:function(e){return"json"===e&&window.JSON?!0:i.can("return_response_type",e)},return_status_code:u,report_upload_progress:s(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return r.can("access_binary")&&i.can("create_canvas")},select_file:function(){return i.can("use_fileinput")&&window.File},select_folder:function(){return r.can("select_file")&&"Chrome"===i.browser&&i.version>=21},select_multiple:function(){return!(!r.can("select_file")||"Safari"===i.browser&&"Windows"===i.os||"iOS"===i.os&&i.verComp(i.osVersion,"7.0.4","<"))},send_binary_string:s(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:s(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||r.can("send_binary_string")},slice_blob:s(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return r.can("slice_blob")&&r.can("send_multipart")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||"IE"===i.browser&&i.version>=10||!!~e.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:u},arguments[2]);n.call(this,t,arguments[1]||o,c),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(r),e=r=null}}(this.destroy)}),e.extend(this.getShim(),a)}var o="html5",a={};return n.addConstructor(o,r),a}),i(N,[D,y],function(e,t){function n(){function e(e,t,n){var i;if(!window.File.prototype.slice)return(i=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(r){return e.slice(t,n-t)}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))}}return e.Blob=n}),i(L,[u],function(e){function t(){this.returnValue=!1}function n(){this.cancelBubble=!0}var i={},r="moxie_"+e.guid(),o=function(o,a,s,u){var c,l;a=a.toLowerCase(),o.addEventListener?(c=s,o.addEventListener(a,c,!1)):o.attachEvent&&(c=function(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=t,e.stopPropagation=n,s(e)},o.attachEvent("on"+a,c)),o[r]||(o[r]=e.guid()),i.hasOwnProperty(o[r])||(i[o[r]]={}),l=i[o[r]],l.hasOwnProperty(a)||(l[a]=[]),l[a].push({func:c,orig:s,key:u})},a=function(t,n,o){var a,s;if(n=n.toLowerCase(),t[r]&&i[t[r]]&&i[t[r]][n]){a=i[t[r]][n];for(var u=a.length-1;u>=0&&(a[u].orig!==o&&a[u].key!==o||(t.removeEventListener?t.removeEventListener(n,a[u].func,!1):t.detachEvent&&t.detachEvent("on"+n,a[u].func),a[u].orig=null,a[u].func=null,a.splice(u,1),o===s));u--);if(a.length||delete i[t[r]][n],e.isEmptyObj(i[t[r]])){delete i[t[r]];try{delete t[r]}catch(c){t[r]=s}}}},s=function(t,n){t&&t[r]&&e.each(i[t[r]],function(e,i){a(t,i,n)})};return{addEvent:o,removeEvent:a,removeAllEvents:s}}),i(M,[D,u,f,L,l,d],function(e,t,n,i,r,o){function a(){var e=[],a;t.extend(this,{init:function(s){var u=this,c=u.getRuntime(),l,d,f,h,p,m;a=s,e=[],f=a.accept.mimes||r.extList2mimes(a.accept,c.can("filter_by_extension")),d=c.getShimContainer(),d.innerHTML='<input id="'+c.uid+'" type="file" style="font-size:999px;opacity:0;"'+(a.multiple&&c.can("select_multiple")?"multiple":"")+(a.directory&&c.can("select_folder")?"webkitdirectory directory":"")+(f?' accept="'+f.join(",")+'"':"")+" />",l=n.get(c.uid),t.extend(l.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),h=n.get(a.browse_button),c.can("summon_file_dialog")&&("static"===n.getStyle(h,"position")&&(h.style.position="relative"),p=parseInt(n.getStyle(h,"z-index"),10)||1,h.style.zIndex=p,d.style.zIndex=p-1,i.addEvent(h,"click",function(e){var t=n.get(c.uid);t&&!t.disabled&&t.click(),e.preventDefault()},u.uid)),m=c.can("summon_file_dialog")?h:d,i.addEvent(m,"mouseover",function(){u.trigger("mouseenter")},u.uid),i.addEvent(m,"mouseout",function(){u.trigger("mouseleave")},u.uid),i.addEvent(m,"mousedown",function(){u.trigger("mousedown")},u.uid),i.addEvent(n.get(a.container),"mouseup",function(){u.trigger("mouseup")},u.uid),l.onchange=function g(){if(e=[],a.directory?t.each(this.files,function(t){"."!==t.name&&e.push(t)}):e=[].slice.call(this.files),"IE"!==o.browser&&"IEMobile"!==o.browser)this.value="";else{var n=this.cloneNode(!0);this.parentNode.replaceChild(n,this),n.onchange=g}u.trigger("change")},u.trigger({type:"ready",async:!0}),d=null},getFiles:function(){return e},disable:function(e){var t=this.getRuntime(),i;(i=n.get(t.uid))&&(i.disabled=!!e)},destroy:function(){var t=this.getRuntime(),r=t.getShim(),o=t.getShimContainer();i.removeAllEvents(o,this.uid),i.removeAllEvents(a&&n.get(a.container),this.uid),i.removeAllEvents(a&&n.get(a.browse_button),this.uid),o&&(o.innerHTML=""),r.removeInstance(this.uid),e=a=o=r=null}})}return e.FileInput=a}),i(C,[D,u,f,L,l],function(e,t,n,i,r){function o(){function e(e){if(!e.dataTransfer||!e.dataTransfer.types)return!1;var n=t.toArray(e.dataTransfer.types||[]);return-1!==t.inArray("Files",n)||-1!==t.inArray("public.file-url",n)||-1!==t.inArray("application/x-moz-file",n)}function o(e){for(var n=[],i=0;i<e.length;i++)[].push.apply(n,e[i].extensions.split(/\s*,\s*/));return-1===t.inArray("*",n)?n:[]}function a(e){if(!f.length)return!0;var n=r.getFileExtension(e.name);return!n||-1!==t.inArray(n,f)}function s(e,n){var i=[];t.each(e,function(e){var t=e.webkitGetAsEntry();if(t)if(t.isFile){var n=e.getAsFile();a(n)&&d.push(n)}else i.push(t)}),i.length?u(i,n):n()}function u(e,n){var i=[];t.each(e,function(e){i.push(function(t){c(e,t)})}),t.inSeries(i,function(){n()})}function c(e,t){e.isFile?e.file(function(e){a(e)&&d.push(e),t()},function(){t()}):e.isDirectory?l(e,t):t()}function l(e,t){function n(e){r.readEntries(function(t){t.length?([].push.apply(i,t),n(e)):e()},e)}var i=[],r=e.createReader();n(function(){u(i,t)})}var d=[],f=[],h;t.extend(this,{init:function(n){var r=this,u;h=n,f=o(h.accept),u=h.container,i.addEvent(u,"dragover",function(t){e(t)&&(t.preventDefault(),t.dataTransfer.dropEffect="copy")},r.uid),i.addEvent(u,"drop",function(n){e(n)&&(n.preventDefault(),d=[],n.dataTransfer.items&&n.dataTransfer.items[0].webkitGetAsEntry?s(n.dataTransfer.items,function(){r.trigger("drop")}):(t.each(n.dataTransfer.files,function(e){a(e)&&d.push(e)}),r.trigger("drop")))},r.uid),i.addEvent(u,"dragenter",function(e){r.trigger("dragenter")},r.uid),i.addEvent(u,"dragleave",function(e){r.trigger("dragleave")},r.uid)},getFiles:function(){return d},destroy:function(){i.removeAllEvents(h&&n.get(h.container),this.uid),d=f=h=null}})}return e.FileDrop=o}),i(F,[D,m,u],function(e,t,n){function i(){function e(e){return t.atob(e.substring(e.indexOf("base64,")+7))}var i,r=!1;n.extend(this,{read:function(e,t){var o=this;i=new window.FileReader,i.addEventListener("progress",function(e){o.trigger(e)}),i.addEventListener("load",function(e){o.trigger(e)}),i.addEventListener("error",function(e){o.trigger(e,i.error)}),i.addEventListener("loadend",function(){i=null}),"function"===n.typeOf(i[e])?(r=!1,i[e](t.getSource())):"readAsBinaryString"===e&&(r=!0,i.readAsDataURL(t.getSource()))},getResult:function(){return i&&i.result?r?e(i.result):i.result:null},abort:function(){i&&i.abort()},destroy:function(){i=null}})}return e.FileReader=i}),i(H,[D,u,l,R,w,y,A,h,d],function(e,t,n,i,r,o,a,s,u){function c(){function e(e,t){var n=this,i,r;i=t.getBlob().getSource(),r=new window.FileReader,r.onload=function(){t.append(t.getBlobName(),new o(null,{type:i.type,data:r.result})),f.send.call(n,e,t)},r.readAsBinaryString(i)}function c(){return!window.XMLHttpRequest||"IE"===u.browser&&u.version<8?function(){for(var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}}():new window.XMLHttpRequest}function l(e){var t=e.responseXML,n=e.responseText;return"IE"===u.browser&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(n)),t&&("IE"===u.browser&&0!==t.parseError||!t.documentElement||"parsererror"===t.documentElement.tagName)?null:t}function d(e){var t="----moxieboundary"+(new Date).getTime(),n="--",i="\r\n",r="",a=this.getRuntime();if(!a.can("send_binary_string"))throw new s.RuntimeError(s.RuntimeError.NOT_SUPPORTED_ERR);return h.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e.each(function(e,a){r+=e instanceof o?n+t+i+'Content-Disposition: form-data; name="'+a+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+i+"Content-Type: "+(e.type||"application/octet-stream")+i+i+e.getSource()+i:n+t+i+'Content-Disposition: form-data; name="'+a+'"'+i+i+unescape(encodeURIComponent(e))+i}),r+=n+t+n+i}var f=this,h,p;t.extend(this,{send:function(n,r){var s=this,l="Mozilla"===u.browser&&u.version>=4&&u.version<7,f="Android Browser"===u.browser,m=!1;if(p=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),h=c(),h.open(n.method,n.url,n.async,n.user,n.password),r instanceof o)r.isDetached()&&(m=!0),r=r.getSource();else if(r instanceof a){if(r.hasBlob())if(r.getBlob().isDetached())r=d.call(s,r),m=!0;else if((l||f)&&"blob"===t.typeOf(r.getBlob().getSource())&&window.FileReader)return void e.call(s,n,r);if(r instanceof a){var g=new window.FormData;r.each(function(e,t){e instanceof o?g.append(t,e.getSource()):g.append(t,e)}),r=g}}h.upload?(n.withCredentials&&(h.withCredentials=!0),h.addEventListener("load",function(e){s.trigger(e)}),h.addEventListener("error",function(e){s.trigger(e)}),h.addEventListener("progress",function(e){s.trigger(e)}),h.upload.addEventListener("progress",function(e){s.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):h.onreadystatechange=function v(){switch(h.readyState){case 1:break;case 2:break;case 3:var e,t;try{i.hasSameOrigin(n.url)&&(e=h.getResponseHeader("Content-Length")||0),h.responseText&&(t=h.responseText.length)}catch(r){e=t=0}s.trigger({type:"progress",lengthComputable:!!e,total:parseInt(e,10),loaded:t});break;case 4:h.onreadystatechange=function(){},s.trigger(0===h.status?"error":"load")}},t.isEmptyObj(n.headers)||t.each(n.headers,function(e,t){h.setRequestHeader(t,e)}),""!==n.responseType&&"responseType"in h&&(h.responseType="json"!==n.responseType||u.can("return_response_type","json")?n.responseType:"text"),m?h.sendAsBinary?h.sendAsBinary(r):!function(){for(var e=new Uint8Array(r.length),t=0;t<r.length;t++)e[t]=255&r.charCodeAt(t);h.send(e.buffer)}():h.send(r),s.trigger("loadstart")},getStatus:function(){try{if(h)return h.status}catch(e){}return 0},getResponse:function(e){var t=this.getRuntime();try{switch(e){case"blob":var i=new r(t.uid,h.response),o=h.getResponseHeader("Content-Disposition");if(o){var a=o.match(/filename=([\'\"'])([^\1]+)\1/);a&&(p=a[2])}return i.name=p,i.type||(i.type=n.getFileMime(p)),i;case"json":return u.can("return_response_type","json")?h.response:200===h.status&&window.JSON?JSON.parse(h.responseText):null;case"document":return l(h);default:return""!==h.responseText?h.responseText:null}}catch(s){return null}},getAllResponseHeaders:function(){try{return h.getAllResponseHeaders()}catch(e){}return""},abort:function(){h&&h.abort()},destroy:function(){f=p=null}})}return e.XMLHttpRequest=c}),i(P,[],function(){return function(){function e(e,t){var n=r?0:-8*(t-1),i=0,a;for(a=0;t>a;a++)i|=o.charCodeAt(e+a)<<Math.abs(n+8*a);return i}function n(e,t,n){n=3===arguments.length?n:o.length-t-1,o=o.substr(0,t)+e+o.substr(n+t)}function i(e,t,i){var o="",a=r?0:-8*(i-1),s;for(s=0;i>s;s++)o+=String.fromCharCode(t>>Math.abs(a+8*s)&255);n(o,e,i)}var r=!1,o;return{II:function(e){return e===t?r:void(r=e)},init:function(e){r=!1,o=e},SEGMENT:function(e,t,i){switch(arguments.length){case 1:return o.substr(e,o.length-e-1);case 2:return o.substr(e,t);case 3:n(i,e,t);break;default:return o}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(n,r){return r===t?e(n,4):void i(n,r,4)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var i="";for(n+=t;n>t;t++)i+=String.fromCharCode(e(t,1));return i}}}}),i(k,[P],function(e){return function t(n){var i=[],r,o,a,s=0;if(r=new e,r.init(n),65496===r.SHORT(0)){for(o=2;o<=n.length;)if(a=r.SHORT(o),a>=65488&&65495>=a)o+=2;else{if(65498===a||65497===a)break;s=r.SHORT(o+2)+2,a>=65505&&65519>=a&&i.push({hex:a,name:"APP"+(15&a),start:o,length:s,segment:r.SEGMENT(o,s)}),o+=s}return r.init(null),{headers:i,restore:function(e){var t,n;for(r.init(e),o=65504==r.SHORT(2)?4+r.SHORT(4):2,n=0,t=i.length;t>n;n++)r.SEGMENT(o,0,i[n].segment),o+=i[n].length;return e=r.SEGMENT(),r.init(null),e},strip:function(e){var n,i,o;for(i=new t(e),n=i.headers,i.purge(),r.init(e),o=n.length;o--;)r.SEGMENT(n[o].start,n[o].length,"");return e=r.SEGMENT(),r.init(null),e},get:function(e){for(var t=[],n=0,r=i.length;r>n;n++)i[n].name===e.toUpperCase()&&t.push(i[n].segment);return t},set:function(e,t){var n=[],r,o,a;for("string"==typeof t?n.push(t):n=t,r=o=0,a=i.length;a>r&&(i[r].name===e.toUpperCase()&&(i[r].segment=n[o],i[r].length=n[o].length,o++),!(o>=n.length));r++);},purge:function(){i=[],r.init(null),r=null}}}}}),i(U,[u,P],function(e,n){return function i(){function i(e,n){var i=a.SHORT(e),r,o,s,u,d,f,h,p,m=[],g={};for(r=0;i>r;r++)if(h=f=e+12*r+2,s=n[a.SHORT(h)],s!==t){switch(u=a.SHORT(h+=2),d=a.LONG(h+=2),h+=4,m=[],u){case 1:case 7:for(d>4&&(h=a.LONG(h)+c.tiffHeader),o=0;d>o;o++)m[o]=a.BYTE(h+o);break;case 2:d>4&&(h=a.LONG(h)+c.tiffHeader),g[s]=a.STRING(h,d-1);continue;case 3:for(d>2&&(h=a.LONG(h)+c.tiffHeader),o=0;d>o;o++)m[o]=a.SHORT(h+2*o);break;case 4:for(d>1&&(h=a.LONG(h)+c.tiffHeader),o=0;d>o;o++)m[o]=a.LONG(h+4*o);break;case 5:for(h=a.LONG(h)+c.tiffHeader,o=0;d>o;o++)m[o]=a.LONG(h+4*o)/a.LONG(h+4*o+4);break;case 9:for(h=a.LONG(h)+c.tiffHeader,o=0;d>o;o++)m[o]=a.SLONG(h+4*o);break;case 10:for(h=a.LONG(h)+c.tiffHeader,o=0;d>o;o++)m[o]=a.SLONG(h+4*o)/a.SLONG(h+4*o+4);break;default:continue}p=1==d?m[0]:m,g[s]=l.hasOwnProperty(s)&&"object"!=typeof p?l[s][p]:p}return g}function r(){var e=c.tiffHeader;return a.II(18761==a.SHORT(e)),42!==a.SHORT(e+=2)?!1:(c.IFD0=c.tiffHeader+a.LONG(e+=2),u=i(c.IFD0,s.tiff),"ExifIFDPointer"in u&&(c.exifIFD=c.tiffHeader+u.ExifIFDPointer,delete u.ExifIFDPointer),"GPSInfoIFDPointer"in u&&(c.gpsIFD=c.tiffHeader+u.GPSInfoIFDPointer,delete u.GPSInfoIFDPointer),!0)}function o(e,t,n){var i,r,o,u=0;if("string"==typeof t){var l=s[e.toLowerCase()];for(var d in l)if(l[d]===t){t=d;break}}i=c[e.toLowerCase()+"IFD"],r=a.SHORT(i);for(var f=0;r>f;f++)if(o=i+12*f+2,a.SHORT(o)==t){u=o+8;break}return u?(a.LONG(u,n),!0):!1}var a,s,u,c={},l;return a=new n,s={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return c={tiffHeader:10},e!==t&&e.length?(a.init(e),65505===a.SHORT(0)&&"EXIF\x00"===a.STRING(4,5).toUpperCase()?r():!1):!1},TIFF:function(){return u},EXIF:function(){var t;if(t=i(c.exifIFD,s.exif),t.ExifVersion&&"array"===e.typeOf(t.ExifVersion)){for(var n=0,r="";n<t.ExifVersion.length;n++)r+=String.fromCharCode(t.ExifVersion[n]);t.ExifVersion=r}return t},GPS:function(){var t;return t=i(c.gpsIFD,s.gps),t.GPSVersionID&&"array"===e.typeOf(t.GPSVersionID)&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:o("exif",e,t)},getBinary:function(){return a.SEGMENT()},purge:function(){a.init(null),a=u=null,c={}}}}}),i(B,[u,h,k,P,U],function(e,t,n,i,r){function o(o){function a(){for(var e=0,t,n;e<=u.length;){if(t=c.SHORT(e+=2),t>=65472&&65475>=t)return e+=5,{height:c.SHORT(e),width:c.SHORT(e+=2)};n=c.SHORT(e+=2),e+=n-2}return null}function s(){d&&l&&c&&(d.purge(),l.purge(),c.init(null),u=f=l=d=c=null)}var u,c,l,d,f,h;if(u=o,c=new i,c.init(u),65496!==c.SHORT(0))throw new t.ImageError(t.ImageError.WRONG_FORMAT);l=new n(o),d=new r,h=!!d.init(l.get("app1")[0]),f=a.call(this),e.extend(this,{type:"image/jpeg",size:u.length,width:f&&f.width||0,height:f&&f.height||0,setExif:function(t,n){return h?("object"===e.typeOf(t)?e.each(t,function(e,t){d.setExif(t,e)}):d.setExif(t,n),void l.set("app1",d.getBinary())):!1},writeHeaders:function(){return arguments.length?l.restore(arguments[0]):u=l.restore(u)},stripHeaders:function(e){return l.strip(e)},purge:function(){s.call(this)}}),h&&(this.meta={tiff:d.TIFF(),exif:d.EXIF(),gps:d.GPS()})}return o}),i(z,[h,u,P],function(e,t,n){function i(i){function r(){var e,t;return e=a.call(this,8),"IHDR"==e.type?(t=e.start,{width:u.LONG(t),height:u.LONG(t+=4)}):null}function o(){u&&(u.init(null),s=d=c=l=u=null)}function a(e){var t,n,i,r;return t=u.LONG(e),n=u.STRING(e+=4,4),i=e+=4,r=u.LONG(e+t),{length:t,type:n,start:i,CRC:r}}var s,u,c,l,d;s=i,u=new n,u.init(s),function(){var t=0,n=0,i=[35152,20039,3338,6666];for(n=0;n<i.length;n++,t+=2)if(i[n]!=u.SHORT(t))throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),d=r.call(this),t.extend(this,{type:"image/png",size:s.length,width:d.width,height:d.height,purge:function(){o.call(this)}}),o.call(this)}return i}),i(G,[u,h,B,z],function(e,t,n,i){return function(r){var o=[n,i],a;a=function(){for(var e=0;e<o.length;e++)try{return new o[e](r)}catch(n){}throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){}}),e.extend(this,a),this.purge=function(){a.purge(),a=null}}}),i(q,[],function(){function e(e,i,r){var o=e.naturalWidth,a=e.naturalHeight,s=r.width,u=r.height,c=r.x||0,l=r.y||0,d=i.getContext("2d");t(e)&&(o/=2,a/=2);var f=1024,h=document.createElement("canvas");h.width=h.height=f;for(var p=h.getContext("2d"),m=n(e,o,a),g=0;a>g;){for(var v=g+f>a?a-g:f,y=0;o>y;){var w=y+f>o?o-y:f;p.clearRect(0,0,f,f),p.drawImage(e,-y,-g);var E=y*s/o+c<<0,_=Math.ceil(w*s/o),x=g*u/a/m+l<<0,b=Math.ceil(v*u/a/m);d.drawImage(h,0,0,w,v,E,x,_,b),y+=f}g+=f}h=p=null}function t(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var i=document.createElement("canvas");i.width=i.height=1;var r=i.getContext("2d");return r.drawImage(e,-t+1,0),0===r.getImageData(0,0,1,1).data[3]}return!1}function n(e,t,n){var i=document.createElement("canvas");i.width=1,i.height=n;var r=i.getContext("2d");r.drawImage(e,0,0);for(var o=r.getImageData(0,0,1,n).data,a=0,s=n,u=n;u>a;){var c=o[4*(u-1)+3];0===c?s=u:a=u,u=s+a>>1}i=null;var l=u/n;return 0===l?1:l}return{isSubsampled:t,renderTo:e}}),i(X,[D,u,h,m,w,G,q,l,d],function(e,t,n,i,r,o,a,s,u){function c(){function e(){if(!E&&!y)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return E||y}function c(e){return i.atob(e.substring(e.indexOf("base64,")+7))}function l(e,t){return"data:"+(t||"")+";base64,"+i.btoa(e)}function d(e){var t=this;y=new Image,y.onerror=function(){g.call(this),t.trigger("error",n.ImageError.WRONG_FORMAT)},y.onload=function(){t.trigger("load")},y.src=/^data:[^;]*;base64,/.test(e)?e:l(e,x.type)}function f(e,t){var i=this,r;return window.FileReader?(r=new FileReader,r.onload=function(){t(this.result)},r.onerror=function(){i.trigger("error",n.ImageError.WRONG_FORMAT)},r.readAsDataURL(e),void 0):t(e.getAsDataURL())}function h(n,i,r,o){var a=this,s,u,c=0,l=0,d,f,h,g;if(R=o,g=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==t.inArray(g,[5,6,7,8])){var v=n;n=i,i=v}return d=e(),r?(n=Math.min(n,d.width),i=Math.min(i,d.height),s=Math.max(n/d.width,i/d.height)):s=Math.min(n/d.width,i/d.height),s>1&&!r&&o?void this.trigger("Resize"):(E||(E=document.createElement("canvas")),f=Math.round(d.width*s),h=Math.round(d.height*s),r?(E.width=n,E.height=i,f>n&&(c=Math.round((f-n)/2)),h>i&&(l=Math.round((h-i)/2))):(E.width=f,E.height=h),R||m(E.width,E.height,g),p.call(this,d,E,-c,-l,f,h),this.width=E.width,this.height=E.height,b=!0,void a.trigger("Resize"))}function p(e,t,n,i,r,o){if("iOS"===u.OS)a.renderTo(e,t,{width:r,height:o,x:n,y:i});else{var s=t.getContext("2d");s.drawImage(e,n,i,r,o)}}function m(e,t,n){switch(n){case 5:case 6:case 7:case 8:E.width=t,E.height=e;break;default:E.width=e,E.height=t}var i=E.getContext("2d");switch(n){case 2:i.translate(e,0),i.scale(-1,1);break;case 3:i.translate(e,t),i.rotate(Math.PI);break;case 4:i.translate(0,t),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-t);break;case 7:i.rotate(.5*Math.PI),i.translate(e,-t),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-e,0)}}function g(){w&&(w.purge(),w=null),_=y=E=x=null,b=!1}var v=this,y,w,E,_,x,b=!1,R=!0;t.extend(this,{loadFromBlob:function(e){var t=this,i=t.getRuntime(),r=arguments.length>1?arguments[1]:!0;if(!i.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return x=e,e.isDetached()?(_=e.getSource(),void d.call(this,_)):void f.call(this,e.getSource(),function(e){r&&(_=c(e)),d.call(t,e)})},loadFromImage:function(e,t){this.meta=e.meta,x=new r(null,{name:e.name,size:e.size,type:e.type}),d.call(this,t?_=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var t=this.getRuntime(),n;return!w&&_&&t.can("access_image_binary")&&(w=new o(_)),n={width:e().width||0,height:e().height||0,type:x.type||s.getFileMime(x.name),size:_&&_.length||x.size||0,name:x.name||"",meta:w&&w.meta||this.meta||{}}},downsize:function(){h.apply(this,arguments)},getAsCanvas:function(){return E&&(E.id=this.uid+"_canvas"),E},getAsBlob:function(e,t){return e!==this.type&&h.call(this,this.width,this.height,!1),new r(null,{name:x.name||"",type:e,data:v.getAsBinaryString.call(this,e,t)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!b)return y.src;if("image/jpeg"!==e)return E.toDataURL("image/png");try{return E.toDataURL("image/jpeg",t/100)}catch(n){return E.toDataURL("image/jpeg")}},getAsBinaryString:function(e,t){if(!b)return _||(_=c(v.getAsDataURL(e,t))),_;if("image/jpeg"!==e)_=c(v.getAsDataURL(e,t));else{var n;t||(t=90);try{n=E.toDataURL("image/jpeg",t/100)}catch(i){n=E.toDataURL("image/jpeg")}_=c(n),w&&(_=w.stripHeaders(_),R&&(w.meta&&w.meta.exif&&w.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),_=w.writeHeaders(_)),w.purge(),w=null)}return b=!1,_},destroy:function(){v=null,g.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return e.Image=c}),i(j,[u,d,f,h,g],function(e,t,n,i,r){function o(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}function a(a){var c=this,l;a=e.extend({swf_url:t.swf_url},a),r.call(this,a,s,{access_binary:function(e){return e&&"browser"===c.mode},access_image_binary:function(e){return e&&"browser"===c.mode},display_media:r.capTrue,do_cors:r.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===c.mode},resize_image:r.capTrue,return_response_headers:!1,return_response_type:function(t){return"json"===t&&window.JSON?!0:!e.arrayDiff(t,["","text","document"])||"browser"===c.mode},return_status_code:function(t){return"browser"===c.mode||!e.arrayDiff(t,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:function(e){return e&&"browser"===c.mode},send_browser_cookies:function(e){return e&&"browser"===c.mode},send_custom_headers:function(e){return e&&"browser"===c.mode},send_multipart:r.capTrue,slice_blob:function(e){return e&&"browser"===c.mode},stream_upload:function(e){return e&&"browser"===c.mode},summon_file_dialog:!1,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||"client"===c.mode},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:function(e){return e?"browser":"client"},access_image_binary:function(e){return e?"browser":"client"},report_upload_progress:function(e){return e?"browser":"client"},return_response_type:function(t){return e.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(e){return e?"browser":"client"},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"browser":"client"},stream_upload:function(e){return e?"client":"browser"},upload_filesize:function(t){return e.parseSizeStr(t)>=2097152?"client":"browser"}},"client"),o()<10&&(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec(this.uid,e,t,n)},init:function(){var n,r,o;o=this.getShimContainer(),e.extend(o.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+a.swf_url+'" ',"IE"===t.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===t.browser?(r=document.createElement("div"),o.appendChild(r),r.outerHTML=n,r=o=null):o.innerHTML=n,l=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(e){return function(){e.call(c),clearTimeout(l),a=l=e=c=null}}(this.destroy)},u)}var s="flash",u={};return r.addConstructor(s,a),u}),i(V,[j,y],function(e,t){var n={slice:function(e,n,i,r){var o=this.getRuntime();return 0>n?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size)),0>i?i=Math.max(e.size+i,0):i>0&&(i=Math.min(i,e.size)),e=o.shimExec.call(this,"Blob","slice",n,i,r||""),e&&(e=new t(o.uid,e)),e}};return e.Blob=n}),i(W,[j],function(e){var t={init:function(e){this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready")}};return e.FileInput=t}),i(Y,[j,m],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var i="",r={read:function(e,t){var r=this,o=r.getRuntime();return"readAsDataURL"===e&&(i="data:"+(t.type||"")+";base64,"),r.bind("Progress",function(t,r){r&&(i+=n(r,e))}),o.shimExec.call(this,"FileReader","readAsBase64",t.uid)},getResult:function(){return i},destroy:function(){i=null}};return e.FileReader=r}),i($,[j,m],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var i={read:function(e,t){var i,r=this.getRuntime();return(i=r.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===e&&(i="data:"+(t.type||"")+";base64,"+i),n(i,e,t.type)):null}};return e.FileReaderSync=i}),i(J,[j,u,y,w,T,A,O],function(e,t,n,i,r,o,a){var s={send:function(e,i){function r(){e.transport=l.mode,l.shimExec.call(c,"XMLHttpRequest","send",e,i)}function s(e,t){l.shimExec.call(c,"XMLHttpRequest","appendBlob",e,t.uid),i=null,r()}function u(e,t){var n=new a;n.bind("TransportingComplete",function(){t(this.result)}),n.transport(e.getSource(),e.type,{ruid:l.uid})}var c=this,l=c.getRuntime();if(t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){l.shimExec.call(c,"XMLHttpRequest","setRequestHeader",t,e.toString())}),i instanceof o){var d;if(i.each(function(e,t){e instanceof n?d=t:l.shimExec.call(c,"XMLHttpRequest","append",t,e)}),i.hasBlob()){var f=i.getBlob();f.isDetached()?u(f,function(e){f.destroy(),s(d,e)}):s(d,f)}else i=null,r()}else i instanceof n?i.isDetached()?u(i,function(e){i.destroy(),i=e.uid,r()}):(i=i.uid,r()):r()},getResponse:function(e){var n,o,a=this.getRuntime();if(o=a.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(o=new i(a.uid,o),"blob"===e)return o;try{if(n=new r,~t.inArray(e,["","text"]))return n.readAsText(o);if("json"===e&&window.JSON)return JSON.parse(n.readAsText(o))}finally{o.destroy()}}return null},abort:function(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return e.XMLHttpRequest=s}),i(Z,[j,y],function(e,t){var n={getAsBlob:function(e){var n=this.getRuntime(),i=n.shimExec.call(this,"Transporter","getAsBlob",e);return i?new t(n.uid,i):null}};return e.Transporter=n}),i(K,[j,u,O,y,T],function(e,t,n,i,r){var o={loadFromBlob:function(e){function t(e){r.shimExec.call(i,"Image","loadFromBlob",e.uid),i=r=null}var i=this,r=i.getRuntime();if(e.isDetached()){var o=new n;o.bind("TransportingComplete",function(){t(o.result.getSource())}),o.transport(e.getSource(),e.type,{ruid:r.uid})}else t(e.getSource())},loadFromImage:function(e){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",e.uid)},getAsBlob:function(e,t){var n=this.getRuntime(),r=n.shimExec.call(this,"Image","getAsBlob",e,t);return r?new i(n.uid,r):null},getAsDataURL:function(){var e=this.getRuntime(),t=e.Image.getAsBlob.apply(this,arguments),n;return t?(n=new r,n.readAsDataURL(t)):null}};return e.Image=o}),i(Q,[u,d,f,h,g],function(e,t,n,i,r){function o(e){var t=!1,n=null,i,r,o,a,s,u=0;try{try{n=new ActiveXObject("AgControl.AgControl"),n.IsVersionSupported(e)&&(t=!0),n=null}catch(c){var l=navigator.plugins["Silverlight Plug-In"];if(l){for(i=l.description,"1.0.30226.2"===i&&(i="2.0.30226.2"),r=i.split(".");r.length>3;)r.pop();for(;r.length<4;)r.push(0);for(o=e.split(".");o.length>4;)o.pop();do a=parseInt(o[u],10),s=parseInt(r[u],10),u++;while(u<o.length&&a===s);s>=a&&!isNaN(a)&&(t=!0)}}}catch(d){t=!1}return t}function a(a){var c=this,l;a=e.extend({xap_url:t.xap_url},a),r.call(this,a,s,{access_binary:r.capTrue,access_image_binary:r.capTrue,display_media:r.capTrue,do_cors:r.capTrue,drag_and_drop:!1,report_upload_progress:r.capTrue,resize_image:r.capTrue,return_response_headers:function(e){return e&&"client"===c.mode},return_response_type:function(e){return"json"!==e?!0:!!window.JSON},return_status_code:function(t){return"client"===c.mode||!e.arrayDiff(t,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:r.capTrue,send_browser_cookies:function(e){return e&&"browser"===c.mode},send_custom_headers:function(e){return e&&"client"===c.mode},send_multipart:r.capTrue,slice_blob:r.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:r.capTrue,use_http_method:function(t){return"client"===c.mode||!e.arrayDiff(t,["GET","POST"])}},{return_response_headers:function(e){return e?"client":"browser"},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"client":["client","browser"]},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"client":"browser"},use_http_method:function(t){return e.arrayDiff(t,["GET","POST"])?"client":["client","browser"]}}),o("2.0.31005.0")&&"Opera"!==t.browser||(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec(this.uid,e,t,n)},init:function(){var e;e=this.getShimContainer(),e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+a.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/></object>',l=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},"Windows"!==t.OS?1e4:5e3)},destroy:function(e){return function(){e.call(c),clearTimeout(l),a=l=e=c=null}}(this.destroy)},u)}var s="silverlight",u={};return r.addConstructor(s,a),u}),i(et,[Q,u,V],function(e,t,n){return e.Blob=t.extend({},n)}),i(tt,[Q],function(e){var t={init:function(e){function t(e){for(var t="",n=0;n<e.length;n++)t+=(""!==t?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");return t}this.getRuntime().shimExec.call(this,"FileInput","init",t(e.accept),e.name,e.multiple),this.trigger("ready")}};return e.FileInput=t}),i(nt,[Q,f,L],function(e,t,n){var i={init:function(){var e=this,i=e.getRuntime(),r;return r=i.getShimContainer(),n.addEvent(r,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},e.uid),n.addEvent(r,"dragenter",function(e){e.preventDefault();var n=t.get(i.uid).dragEnter(e);n&&e.stopPropagation()},e.uid),n.addEvent(r,"drop",function(e){e.preventDefault();var n=t.get(i.uid).dragDrop(e);n&&e.stopPropagation()},e.uid),i.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=i}),i(it,[Q,u,Y],function(e,t,n){return e.FileReader=t.extend({},n)}),i(rt,[Q,u,$],function(e,t,n){return e.FileReaderSync=t.extend({},n)}),i(ot,[Q,u,J],function(e,t,n){return e.XMLHttpRequest=t.extend({},n)}),i(at,[Q,u,Z],function(e,t,n){return e.Transporter=t.extend({},n)}),i(st,[Q,u,K],function(e,t,n){return e.Image=t.extend({},n,{getInfo:function(){var e=this.getRuntime(),n=["tiff","exif","gps"],i={meta:{}},r=e.shimExec.call(this,"Image","getInfo");return r.meta&&t.each(n,function(e){var t=r.meta[e],n,o,a,s;if(t&&t.keys)for(i.meta[e]={},o=0,a=t.keys.length;a>o;o++)n=t.keys[o],s=t[n],s&&(/^(\d|[1-9]\d+)$/.test(s)?s=parseInt(s,10):/^\d*\.\d+$/.test(s)&&(s=parseFloat(s)),i.meta[e][n]=s)}),i.width=parseInt(r.width,10),i.height=parseInt(r.height,10),i.size=parseInt(r.size,10),i.type=r.type,i.name=r.name,i}})}),i(ut,[u,h,g,d],function(e,t,n,i){function r(t){var r=this,s=n.capTest,u=n.capTrue;n.call(this,t,o,{access_binary:s(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:s(a.Image&&(i.can("create_canvas")||i.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:s(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),resize_image:function(){return a.Image&&r.can("access_binary")&&i.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return"json"===t&&window.JSON?!0:!!~e.inArray(t,["text","document",""])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},select_file:function(){return i.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return r.can("select_file")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||!!~e.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:u,use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}}),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(r),e=r=null}}(this.destroy)}),e.extend(this.getShim(),a)}var o="html4",a={};return n.addConstructor(o,r),a}),i(ct,[ut,u,f,L,l,d],function(e,t,n,i,r,o){function a(){function e(){var r=this,l=r.getRuntime(),d,f,h,p,m,g;g=t.guid("uid_"),d=l.getShimContainer(),a&&(h=n.get(a+"_form"),h&&t.extend(h.style,{top:"100%"})),p=document.createElement("form"),p.setAttribute("id",g+"_form"),p.setAttribute("method","post"),p.setAttribute("enctype","multipart/form-data"),p.setAttribute("encoding","multipart/form-data"),t.extend(p.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),m=document.createElement("input"),m.setAttribute("id",g),m.setAttribute("type","file"),m.setAttribute("name",c.name||"Filedata"),m.setAttribute("accept",u.join(",")),t.extend(m.style,{fontSize:"999px",opacity:0}),p.appendChild(m),d.appendChild(p),t.extend(m.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===o.browser&&o.version<10&&t.extend(m.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),m.onchange=function(){var t;this.value&&(t=this.files?this.files[0]:{name:this.value},s=[t],this.onchange=function(){},e.call(r),r.bind("change",function i(){var e=n.get(g),t=n.get(g+"_form"),o;r.unbind("change",i),r.files.length&&e&&t&&(o=r.files[0],e.setAttribute("id",o.uid),t.setAttribute("id",o.uid+"_form"),t.setAttribute("target",o.uid+"_iframe")),e=t=null},998),m=p=null,r.trigger("change"))},l.can("summon_file_dialog")&&(f=n.get(c.browse_button),i.removeEvent(f,"click",r.uid),i.addEvent(f,"click",function(e){m&&!m.disabled&&m.click(),e.preventDefault()},r.uid)),a=g,d=h=f=null}var a,s=[],u=[],c;t.extend(this,{init:function(t){var o=this,a=o.getRuntime(),s;c=t,u=t.accept.mimes||r.extList2mimes(t.accept,a.can("filter_by_extension")),s=a.getShimContainer(),function(){var e,r,u;e=n.get(t.browse_button),a.can("summon_file_dialog")&&("static"===n.getStyle(e,"position")&&(e.style.position="relative"),r=parseInt(n.getStyle(e,"z-index"),10)||1,e.style.zIndex=r,s.style.zIndex=r-1),u=a.can("summon_file_dialog")?e:s,i.addEvent(u,"mouseover",function(){o.trigger("mouseenter")},o.uid),i.addEvent(u,"mouseout",function(){o.trigger("mouseleave")},o.uid),i.addEvent(u,"mousedown",function(){o.trigger("mousedown")},o.uid),i.addEvent(n.get(t.container),"mouseup",function(){o.trigger("mouseup")},o.uid),e=null}(),e.call(this),s=null,o.trigger({type:"ready",async:!0})},getFiles:function(){return s},disable:function(e){var t;(t=n.get(a))&&(t.disabled=!!e)},destroy:function(){var e=this.getRuntime(),t=e.getShim(),r=e.getShimContainer();i.removeAllEvents(r,this.uid),i.removeAllEvents(c&&n.get(c.container),this.uid),i.removeAllEvents(c&&n.get(c.browse_button),this.uid),r&&(r.innerHTML=""),t.removeInstance(this.uid),a=s=u=c=r=t=null}})}return e.FileInput=a}),i(lt,[ut,F],function(e,t){return e.FileReader=t}),i(dt,[ut,u,f,R,h,L,y,A],function(e,t,n,i,r,o,a,s){function u(){function e(e){var t=this,i,r,a,s,u=!1;if(l){if(i=l.id.replace(/_iframe$/,""),r=n.get(i+"_form")){for(a=r.getElementsByTagName("input"),s=a.length;s--;)switch(a[s].getAttribute("type")){case"hidden":a[s].parentNode.removeChild(a[s]);break;case"file":u=!0}a=[],u||r.parentNode.removeChild(r),r=null}setTimeout(function(){o.removeEvent(l,"load",t.uid),l.parentNode&&l.parentNode.removeChild(l);var n=t.getRuntime().getShimContainer();n.children.length||n.parentNode.removeChild(n),n=l=null,e()},1)}}var u,c,l;t.extend(this,{send:function(d,f){function h(){var n=m.getShimContainer()||document.body,r=document.createElement("div");r.innerHTML='<iframe id="'+g+'_iframe" name="'+g+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',l=r.firstChild,n.appendChild(l),o.addEvent(l,"load",function(){var n;try{n=l.contentWindow.document||l.contentDocument||window.frames[l.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)?u=n.title.replace(/^(\d+).*$/,"$1"):(u=200,c=t.trim(n.body.innerHTML),p.trigger({type:"progress",loaded:c.length,total:c.length}),w&&p.trigger({type:"uploadprogress",loaded:w.size||1025,total:w.size||1025}))}catch(r){if(!i.hasSameOrigin(d.url))return void e.call(p,function(){p.trigger("error")});u=404}e.call(p,function(){p.trigger("load")})},p.uid)}var p=this,m=p.getRuntime(),g,v,y,w;if(u=c=null,f instanceof s&&f.hasBlob()){if(w=f.getBlob(),g=w.uid,y=n.get(g),v=n.get(g+"_form"),!v)throw new r.DOMException(r.DOMException.NOT_FOUND_ERR)}else g=t.guid("uid_"),v=document.createElement("form"),v.setAttribute("id",g+"_form"),v.setAttribute("method",d.method),v.setAttribute("enctype","multipart/form-data"),v.setAttribute("encoding","multipart/form-data"),v.setAttribute("target",g+"_iframe"),m.getShimContainer().appendChild(v);f instanceof s&&f.each(function(e,n){if(e instanceof a)y&&y.setAttribute("name",n);else{var i=document.createElement("input");t.extend(i,{type:"hidden",name:n,value:e}),y?v.insertBefore(i,y):v.appendChild(i)}}),v.setAttribute("action",d.url),h(),v.submit(),p.trigger("loadstart")},getStatus:function(){return u},getResponse:function(e){if("json"===e&&"string"===t.typeOf(c)&&window.JSON)try{return JSON.parse(c.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(n){return null}return c},abort:function(){var t=this;l&&l.contentWindow&&(l.contentWindow.stop?l.contentWindow.stop():l.contentWindow.document.execCommand?l.contentWindow.document.execCommand("Stop"):l.src="about:blank"),e.call(this,function(){t.dispatchEvent("abort")})}})}return e.XMLHttpRequest=u}),i(ft,[ut,X],function(e,t){return e.Image=t}),a([u,c,l,d,f,h,p,m,g,v,y,w,E,_,x,b,R,T,A,S,O,I,L])}(this);;(function(e){"use strict";var t={},n=e.moxie.core.utils.Basic.inArray;return function r(e){var i,s;for(i in e)s=typeof e[i],s==="object"&&!~n(i,["Exceptions","Env","Mime"])?r(e[i]):s==="function"&&(t[i]=e[i])}(e.moxie),t.Env=e.moxie.core.utils.Env,t.Mime=e.moxie.core.utils.Mime,t.Exceptions=e.moxie.core.Exceptions,e.mOxie=t,e.o||(e.o=t),t})(this);/** * Plupload - multi-runtime File Uploader * v2.1.2 * * Copyright 2013, Moxiecode Systems AB * Released under GPL License. * * License: http://www.plupload.com/license * Contributing: http://www.plupload.com/contributing * * Date: 2014-05-14 */;(function(e,t,n){function s(e){function r(e,t,r){var i={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};i[e]?n[i[e]]=t:r||(n[e]=t)}var t=e.required_features,n={};if(typeof t=="string")o.each(t.split(/\s*,\s*/),function(e){r(e,!0)});else if(typeof t=="object")o.each(t,function(e,t){r(t,e)});else if(t===!0){e.chunk_size>0&&(n.slice_blob=!0);if(e.resize.enabled||!e.multipart)n.send_binary_string=!0;o.each(e,function(e,t){r(t,!!e,!0)})}return n}var r=e.setTimeout,i={},o={VERSION:"2.1.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,get:function(n){var r=[],i;t.typeOf(n)!=="array"&&(n=[n]);var s=n.length;while(s--)i=t.get(n[s]),i&&r.push(i);return r.length?r:null},each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return e?(""+e).replace(n,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,n;n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,""),e},buildUrl:function(e,t){var n="";return o.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},formatSize:function(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}if(e===n||/\D/.test(e))return o.translate("N/A");var r=Math.pow(1024,4);return e>r?t(e/r,1)+" "+o.translate("tb"):e>(r/=1024)?t(e/r,1)+" "+o.translate("gb"):e>(r/=1024)?t(e/r,1)+" "+o.translate("mb"):e>1024?Math.round(e/1024)+" "+o.translate("kb"):e+" "+o.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e,n){var r,i;return r=new o.Uploader(e),i=t.Runtime.thatCan(r.getOption().required_features,n||e.runtimes),r.destroy(),i},addFileFilter:function(e,t){i[e]=t}};o.addFileFilter("mime_types",function(e,t,n){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:o.FILE_EXTENSION_ERROR,message:o.translate("File extension error."),file:t}),n(!1)):n(!0)}),o.addFileFilter("max_file_size",function(e,t,n){var r;e=o.parseSize(e),t.size!==r&&e&&t.size>e?(this.trigger("Error",{code:o.FILE_SIZE_ERROR,message:o.translate("File size error."),file:t}),n(!1)):n(!0)}),o.addFileFilter("prevent_duplicates",function(e,t,n){if(e){var r=this.files.length;while(r--)if(t.name===this.files[r].name&&t.size===this.files[r].size){this.trigger("Error",{code:o.FILE_DUPLICATE_ERROR,message:o.translate("Duplicate file error."),file:t}),n(!1);return}}n(!0)}),o.Uploader=function(e){function g(){var e,t=0,n;if(this.state==o.STARTED){for(n=0;n<f.length;n++)!e&&f[n].status==o.QUEUED?(e=f[n],this.trigger("BeforeUpload",e)&&(e.status=o.UPLOADING,this.trigger("UploadFile",e))):t++;t==f.length&&(this.state!==o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",f))}}function y(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,b()}function b(){var e,t;d.reset();for(e=0;e<f.length;e++)t=f[e],t.size!==n?(d.size+=t.origSize,d.loaded+=t.loaded*t.origSize/t.size):d.size=n,t.status==o.DONE?d.uploaded++:t.status==o.FAILED?d.failed++:d.queued++;d.size===n?d.percent=f.length>0?Math.ceil(d.uploaded/f.length*100):0:(d.bytesPerSec=Math.ceil(d.loaded/((+(new Date)-p||1)/1e3)),d.percent=d.size>0?Math.ceil(d.loaded/d.size*100):0)}function w(){var e=c[0]||h[0];return e?e.getRuntime().uid:!1}function E(e,n){if(e.ruid){var r=t.Runtime.getInfo(e.ruid);if(r)return r.can(n)}return!1}function S(){this.bind("FilesAdded FilesRemoved",function(e){e.trigger("QueueChanged"),e.refresh()}),this.bind("CancelUpload",O),this.bind("BeforeUpload",C),this.bind("UploadFile",k),this.bind("UploadProgress",L),this.bind("StateChanged",A),this.bind("QueueChanged",b),this.bind("Error",_),this.bind("FileUploaded",M),this.bind("Destroy",D)}function x(e,n){var r=this,i=0,s=[],u={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:l,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};o.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(u[t]=e[t])}),e.browse_button&&o.each(e.browse_button,function(n){s.push(function(s){var a=new t.FileInput(o.extend({},u,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:n}));a.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(r.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),i++,c.push(this),s()},a.onchange=function(){r.addFile(this.files)},a.bind("mouseenter mouseleave mousedown mouseup",function(r){v||(e.browse_button_hover&&("mouseenter"===r.type?t.addClass(n,e.browse_button_hover):"mouseleave"===r.type&&t.removeClass(n,e.browse_button_hover)),e.browse_button_active&&("mousedown"===r.type?t.addClass(n,e.browse_button_active):"mouseup"===r.type&&t.removeClass(n,e.browse_button_active)))}),a.bind("mousedown",function(){r.trigger("Browse")}),a.bind("error runtimeerror",function(){a=null,s()}),a.init()})}),e.drop_element&&o.each(e.drop_element,function(e){s.push(function(n){var s=new t.FileDrop(o.extend({},u,{drop_zone:e}));s.onready=function(){var e=t.Runtime.getInfo(this.ruid);r.features.dragdrop=e.can("drag_and_drop"),i++,h.push(this),n()},s.ondrop=function(){r.addFile(this.files)},s.bind("error runtimeerror",function(){s=null,n()}),s.init()})}),t.inSeries(s,function(){typeof n=="function"&&n(i)})}function T(e,r,i){var s=new t.Image;try{s.onload=function(){if(r.width>this.width&&r.height>this.height&&r.quality===n&&r.preserve_headers&&!r.crop)return this.destroy(),i(e);s.downsize(r.width,r.height,r.crop,r.preserve_headers)},s.onresize=function(){i(this.getAsBlob(e.type,r.quality)),this.destroy()},s.onerror=function(){i(e)},s.load(e)}catch(o){i(e)}}function N(e,n,r){function f(e,t,n){var r=a[e];switch(e){case"max_file_size":e==="max_file_size"&&(a.max_file_size=a.filters.max_file_size=t);break;case"chunk_size":if(t=o.parseSize(t))a[e]=t,a.send_file_name=!0;break;case"multipart":a[e]=t,t||(a.send_file_name=!0);break;case"unique_names":a[e]=t,t&&(a.send_file_name=!0);break;case"filters":o.typeOf(t)==="array"&&(t={mime_types:t}),n?o.extend(a.filters,t):a.filters=t,t.mime_types&&(a.filters.mime_types.regexp=function(e){var t=[];return o.each(e,function(e){o.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?t.push("\\.*"):t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}(a.filters.mime_types));break;case"resize":n?o.extend(a.resize,t,{enabled:!0}):a.resize=t;break;case"prevent_duplicates":a.prevent_duplicates=a.filters.prevent_duplicates=!!t;break;case"browse_button":case"drop_element":t=o.get(t);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":a[e]=t,n||(u=!0);break;default:a[e]=t}n||i.trigger("OptionChanged",e,t,r)}var i=this,u=!1;typeof e=="object"?o.each(e,function(e,t){f(t,e,r)}):f(e,n,r),r?(a.required_features=s(o.extend({},a)),l=s(o.extend({},a,{required_features:!0}))):u&&(i.trigger("Destroy"),x.call(i,a,function(e){e?(i.runtime=t.Runtime.getInfo(w()).type,i.trigger("Init",{runtime:i.runtime}),i.trigger("PostInit")):i.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")})}))}function C(e,t){if(e.settings.unique_names){var n=t.name.match(/\.([^.]+)$/),r="part";n&&(r=n[1]),t.target_name=t.id+"."+r}}function k(e,n){function h(){u-->0?r(p,1e3):(n.loaded=f,e.trigger("Error",{code:o.HTTP_ERROR,message:o.translate("HTTP Error."),file:n,response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()}))}function p(){var d,v,g={},y;if(n.status!==o.UPLOADING||e.state===o.STOPPED)return;e.settings.send_file_name&&(g.name=n.target_name||n.name),s&&a.chunks&&c.size>s?(y=Math.min(s,c.size-f),d=c.slice(f,f+y)):(y=c.size,d=c),s&&a.chunks&&(e.settings.send_chunk_number?(g.chunk=Math.ceil(f/s),g.chunks=Math.ceil(c.size/s)):(g.offset=f,g.total=c.size)),m=new t.XMLHttpRequest,m.upload&&(m.upload.onprogress=function(t){n.loaded=Math.min(n.size,f+t.loaded),e.trigger("UploadProgress",n)}),m.onload=function(){if(m.status>=400){h();return}u=e.settings.max_retries,y<c.size?(d.destroy(),f+=y,n.loaded=Math.min(f,c.size),e.trigger("ChunkUploaded",n,{offset:n.loaded,total:c.size,response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()}),t.Env.browser==="Android Browser"&&e.trigger("UploadProgress",n)):n.loaded=n.size,d=v=null,!f||f>=c.size?(n.size!=n.origSize&&(c.destroy(),c=null),e.trigger("UploadProgress",n),n.status=o.DONE,e.trigger("FileUploaded",n,{response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()})):r(p,1)},m.onerror=function(){h()},m.onloadend=function(){this.destroy(),m=null},e.settings.multipart&&a.multipart?(m.open("post",i,!0),o.each(e.settings.headers,function(e,t){m.setRequestHeader(t,e)}),v=new t.FormData,o.each(o.extend(g,e.settings.multipart_params),function(e,t){v.append(t,e)}),v.append(e.settings.file_data_name,d),m.send(v,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:l,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})):(i=o.buildUrl(e.settings.url,o.extend(g,e.settings.multipart_params)),m.open("post",i,!0),m.setRequestHeader("Content-Type","application/octet-stream"),o.each(e.settings.headers,function(e,t){m.setRequestHeader(t,e)}),m.send(d,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:l,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url}))}var i=e.settings.url,s=e.settings.chunk_size,u=e.settings.max_retries,a=e.features,f=0,c;n.loaded&&(f=n.loaded=s?s*Math.floor(n.loaded/s):0),c=n.getSource(),e.settings.resize.enabled&&E(c,"send_binary_string")&&!!~t.inArray(c.type,["image/jpeg","image/png"])?T.call(this,c,e.settings.resize,function(e){c=e,n.size=e.size,p()}):p()}function L(e,t){y(t)}function A(e){if(e.state==o.STARTED)p=+(new Date);else if(e.state==o.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==o.UPLOADING&&(e.files[t].status=o.QUEUED,b())}function O(){m&&m.abort()}function M(e){b(),r(function(){g.call(e)},1)}function _(e,t){t.code===o.INIT_ERROR?e.destroy():t.file&&(t.file.status=o.FAILED,y(t.file),e.state==o.STARTED&&(e.trigger("CancelUpload"),r(function(){g.call(e)},1)))}function D(e){e.stop(),o.each(f,function(e){e.destroy()}),f=[],c.length&&(o.each(c,function(e){e.destroy()}),c=[]),h.length&&(o.each(h,function(e){e.destroy()}),h=[]),l={},v=!1,p=m=null,d.reset()}var u=o.guid(),a,f=[],l={},c=[],h=[],p,d,v=!1,m;a={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},N.call(this,e,null,!0),d=new o.QueueProgress,o.extend(this,{id:u,uid:u,state:o.STOPPED,features:{},runtime:null,files:f,settings:a,total:d,init:function(){var e=this;typeof a.preinit=="function"?a.preinit(e):o.each(a.preinit,function(t,n){e.bind(n,t)}),S.call(this);if(!a.browse_button||!a.url){this.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")});return}x.call(this,a,function(n){typeof a.init=="function"?a.init(e):o.each(a.init,function(t,n){e.bind(n,t)}),n?(e.runtime=t.Runtime.getInfo(w()).type,e.trigger("Init",{runtime:e.runtime}),e.trigger("PostInit")):e.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")})})},setOption:function(e,t){N.call(this,e,t,!this.runtime)},getOption:function(e){return e?a[e]:a},refresh:function(){c.length&&o.each(c,function(e){e.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=o.STARTED&&(this.state=o.STARTED,this.trigger("StateChanged"),g.call(this))},stop:function(){this.state!=o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){v=arguments[0]!==n?arguments[0]:!0,c.length&&o.each(c,function(e){e.disable(v)}),this.trigger("DisableBrowse",v)},getFile:function(e){var t;for(t=f.length-1;t>=0;t--)if(f[t].id===e)return f[t]},addFile:function(e,n){function c(e,n){var r=[];t.each(s.settings.filters,function(t,n){i[n]&&r.push(function(r){i[n].call(s,t,e,function(e){r(!e)})})}),t.inSeries(r,n)}function h(e){var i=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!l)return!1;e.ruid=l,e.connectRuntime(l)}h(new o.File(e))}else e instanceof t.Blob?(h(e.getSource()),e.destroy()):e instanceof o.File?(n&&(e.name=n),u.push(function(t){c(e,function(n){n||(f.push(e),a.push(e),s.trigger("FileFiltered",e)),r(t,1)})})):t.inArray(i,["file","blob"])!==-1?h(new t.File(null,e)):i==="node"&&t.typeOf(e.files)==="filelist"?t.each(e.files,h):i==="array"&&(n=null,t.each(e,h))}var s=this,u=[],a=[],l;l=w(),h(e),u.length&&t.inSeries(u,function(){a.length&&s.trigger("FilesAdded",a)})},removeFile:function(e){var t=typeof e=="string"?e:e.id;for(var n=f.length-1;n>=0;n--)if(f[n].id===t)return this.splice(n,1)[0]},splice:function(e,t){var r=f.splice(e===n?0:e,t===n?f.length:t),i=!1;return this.state==o.STARTED&&(o.each(r,function(e){if(e.status===o.UPLOADING)return i=!0,!1}),i&&this.stop()),this.trigger("FilesRemoved",r),o.each(r,function(e){e.destroy()}),i&&this.start(),r},bind:function(e,t,n){var r=this;o.Uploader.prototype.bind.call(this,e,function(){var e=[].slice.call(arguments);return e.splice(0,1,r),t.apply(this,e)},0,n)},destroy:function(){this.trigger("Destroy"),a=d=null,this.unbindAll()}})},o.Uploader.prototype=t.EventTarget.instance,o.File=function(){function n(n){o.extend(this,{id:o.guid(),name:n.name||n.fileName,type:n.type||"",size:n.size||n.fileSize,origSize:n.size||n.fileSize,loaded:0,percent:0,status:o.QUEUED,lastModifiedDate:n.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return t.inArray(t.typeOf(e),["blob","file"])!==-1?e:null},getSource:function(){return e[this.id]?e[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete e[this.id])}}),e[this.id]=n}var e={};return n}(),o.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=o})(window,mOxie);]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>案列参考链接：<br><a href="https://segmentfault.com/a/1190000015705532">https://segmentfault.com/a/1190000015705532</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head><meta charset="UTF-8"><title>最基本的使用——plupload演示demo</title><script src="js/jquery-1.10.2.min.js"></script><script src="js/plupload.full.min.js"></script><style>body{ font-size: 12px;}body,p,div{ padding: 0; margin: 0;}.wraper{ padding: 30px 0;}.btn-wraper{ text-align: center;}.btn-wraper input{ margin: 0 10px;}#file-list{ width: 350px; margin: 20px auto;}#file-list li{ margin-bottom: 10px;}.file-name{ line-height: 30px;}.progress{ height: 4px; font-size: 0; line-height: 4px; background: orange; width: 0;}.tip1{text-align: center; font-size:14px; padding-top:10px;}    .tip2{text-align: center; font-size:12px; padding-top:10px; color:#b00}    .catalogue{ position: fixed; _position:absolute; _width:200px; left: 0; top: 0; border: 1px solid #ccc;padding: 10px; background: #eee}    .catalogue a{ line-height: 30px; color: #0c0}    .catalogue li{ padding: 0; margin: 0; list-style: none;}    </style></head><body><p class="tip2">注意：该demo把上传的地址设为了一个静态的html页面，所以文件并不会真正的上传到服务器，但这不会影响上传功能的演示！</p><div class="wraper"><div class="btn-wraper"><input type="button" value="选择文件..." id="browse" /><input type="button" value="开始上传" id="upload-btn" /></div><ul id="file-list"></ul></div><ul class="catalogue"><li><a href="index.html">1、最基本的使用demo</a></li><li><a href="index2.html">2、文件过滤功能demo</a></li><li><a href="index3.html">3、拖拽上传功能demo</a></li><li><a href="index4.html">4、图片预览功能demo</a></li><li><a href="http://chaping.github.io/plupload/doc/">Plupload文档</a></li></ul><script>var uploader = new plupload.Uploader({ //实例化一个plupload上传对象browse_button : 'browse',url : 'upload.html',flash_swf_url : 'js/Moxie.swf',silverlight_xap_url : 'js/Moxie.xap',});uploader.init(); //初始化//绑定文件添加进队列事件uploader.bind('FilesAdded',function(uploader,files){for(var i = 0, len = files.length; i<len; i++){var file_name = files[i].name; //文件名//构造html来更新UIvar html = '<li id="file-' + files[i].id +'"><p class="file-name">' + file_name + '</p><p class="progress"></p></li>';$(html).appendTo('#file-list');}});//绑定文件上传进度事件uploader.bind('UploadProgress',function(uploader,file){$('#file-'+file.id+' .progress').css('width',file.percent + '%');//控制进度条});//上传按钮$('#upload-btn').click(function(){uploader.start(); //开始上传});</script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head><meta charset="UTF-8"><title>文件过滤功能——plupload演示demo</title><script src="js/jquery-1.10.2.min.js"></script><script src="js/plupload.full.min.js"></script><style>body{ font-size: 12px;}body,p,div{ padding: 0; margin: 0;}.wraper{ padding: 30px 0;}.btn-wraper{ text-align: center;}.btn-wraper input{ margin: 0 10px;}#file-list{ width: 350px; margin: 20px auto;}#file-list li{ margin-bottom: 10px;}.file-name{ line-height: 30px;}.progress{ height: 4px; font-size: 0; line-height: 4px; background: orange; width: 0;}.tip1{text-align: center; font-size:14px; padding-top:10px;}    .tip2{text-align: center; font-size:12px; padding-top:10px; color:#b00}    .catalogue{ position: fixed; _position:absolute; _width:200px; left: 0; top: 0; border: 1px solid #ccc;padding: 10px; background: #eee}    .catalogue a{ line-height: 30px; color: #0c0}    .catalogue li{ padding: 0; margin: 0; list-style: none;}</style></head><body><p class="tip1">该demo只允许选取jpg,gif,png,bmp格式的图片文件和rar格式的压缩文件，且文件体积不能超过100Kb，而且不允许选择重复的文件</p><p class="tip2">注意：该demo把上传的地址设为了一个静态的html页面，所以文件并不会真正的上传到服务器，但这不会影响上传功能的演示！</p><div class="wraper"><div class="btn-wraper"><input type="button" value="选择文件..." id="browse" /><input type="button" value="开始上传" id="upload-btn" /></div><ul id="file-list"></ul></div><ul class="catalogue"><li><a href="index.html">1、最基本的使用demo</a></li><li><a href="index2.html">2、文件过滤功能demo</a></li><li><a href="index3.html">3、拖拽上传功能demo</a></li><li><a href="index4.html">4、图片预览功能demo</a></li><li><a href="http://chaping.github.io/plupload/doc/">Plupload文档</a></li></ul><script>var uploader = new plupload.Uploader({ //实例化一个plupload上传对象browse_button : 'browse',url : 'upload.html',flash_swf_url : 'js/Moxie.swf',silverlight_xap_url : 'js/Moxie.xap',filters: {  mime_types : [ //只允许上传图片文件和rar压缩文件    { title : "图片文件", extensions : "jpg,gif,png,bmp" },     { title : "RAR压缩文件", extensions : "zip" }  ],  max_file_size : '100kb', //最大只能上传100kb的文件  prevent_duplicates : true //不允许队列中存在重复文件}});uploader.init(); //初始化//绑定文件添加进队列事件uploader.bind('FilesAdded',function(uploader,files){for(var i = 0, len = files.length; i<len; i++){var file_name = files[i].name; //文件名//构造html来更新UIvar html = '<li id="file-' + files[i].id +'"><p class="file-name">' + file_name + '</p><p class="progress"></p></li>';$(html).appendTo('#file-list');}});//绑定文件上传进度事件uploader.bind('UploadProgress',function(uploader,file){$('#file-'+file.id+' .progress').css('width',file.percent + '%');//控制进度条});//上传按钮$('#upload-btn').click(function(){uploader.start(); //开始上传});</script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head><meta charset="UTF-8"><title>拖拽上传——plupload演示demo</title><script src="js/jquery-1.10.2.min.js"></script><script src="js/plupload.full.min.js"></script><style>body{ font-size: 12px;}body,p,div{ padding: 0; margin: 0;}.wraper{ padding: 30px 0;}.btn-wraper{ text-align: center;}.btn-wraper input{ margin: 0 10px;}#file-list{ width: 350px; margin: 20px auto;}#file-list li{ margin-bottom: 10px;}.file-name{ line-height: 30px;}.progress{ height: 4px; font-size: 0; line-height: 4px; background: orange; width: 0;}    .tip1{text-align: center; font-size:14px; padding-top:10px;}    .tip2{text-align: center; font-size:12px; padding-top:10px; color:#b00}#drag-area{ border: 1px solid #ccc; height: 150px; line-height: 150px; text-align: center; color: #aaa; width: 600px; margin: 10px auto;}.catalogue{ position: fixed; _position:absolute; _width:200px; left: 0; top: 0; border: 1px solid #ccc;padding: 10px; background: #eee}    .catalogue a{ line-height: 30px; color: #0c0}    .catalogue li{ padding: 0; margin: 0; list-style: none;}</style></head><body><p class="tip1">拖拽上传功能：可以在配置参数中指定一个元素作为拖拽上传的区域，只有HTML5运行时才支持该功能</p><p class="tip2">注意：该demo把上传的地址设为了一个静态的html页面，所以文件并不会真正的上传到服务器，但这不会影响上传功能的演示！</p><div class="wraper"><p id="drag-area">把要上传的文件拖放到这里(请使用支持html5的浏览器)</p><div class="btn-wraper"><input type="button" value="选择文件..." id="browse" /><input type="button" value="开始上传" id="upload-btn" /></div><ul id="file-list"></ul></div><ul class="catalogue"><li><a href="index.html">1、最基本的使用demo</a></li><li><a href="index2.html">2、文件过滤功能demo</a></li><li><a href="index3.html">3、拖拽上传功能demo</a></li><li><a href="index4.html">4、图片预览功能demo</a></li><li><a href="http://chaping.github.io/plupload/doc/">Plupload文档</a></li></ul><script>var uploader = new plupload.Uploader({ //实例化一个plupload上传对象browse_button : 'browse',url : 'upload.html',flash_swf_url : 'js/Moxie.swf',silverlight_xap_url : 'js/Moxie.xap',drop_element : 'drag-area'});uploader.init(); //初始化//绑定文件添加进队列事件uploader.bind('FilesAdded',function(uploader,files){for(var i = 0, len = files.length; i<len; i++){var file_name = files[i].name; //文件名//构造html来更新UIvar html = '<li id="file-' + files[i].id +'"><p class="file-name">' + file_name + '</p><p class="progress"></p></li>';$(html).appendTo('#file-list');}});//绑定文件上传进度事件uploader.bind('UploadProgress',function(uploader,file){$('#file-'+file.id+' .progress').css('width',file.percent + '%');//控制进度条});//上传按钮$('#upload-btn').click(function(){uploader.start(); //开始上传});</script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[/*! jQuery v1.10.2 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license//@ sourceMappingURL=jquery-1.10.2.min.map*/(function(e,t){var n,r,i=typeof t,o=e.location,a=e.document,s=a.documentElement,l=e.jQuery,u=e.$,c={},p=[],f="1.10.2",d=p.concat,h=p.push,g=p.slice,m=p.indexOf,y=c.toString,v=c.hasOwnProperty,b=f.trim,x=function(e,t){return new x.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=/\S+/g,C=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,E=/^[\],:{}\s]*$/,S=/(?:^|:|,)(?:\s*\[)+/g,A=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,j=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,D=/^-ms-/,L=/-([\da-z])/gi,H=function(e,t){return t.toUpperCase()},q=function(e){(a.addEventListener||"load"===e.type||"complete"===a.readyState)&&(_(),x.ready())},_=function(){a.addEventListener?(a.removeEventListener("DOMContentLoaded",q,!1),e.removeEventListener("load",q,!1)):(a.detachEvent("onreadystatechange",q),e.detachEvent("onload",q))};x.fn=x.prototype={jquery:f,constructor:x,init:function(e,n,r){var i,o;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof x?n[0]:n,x.merge(this,x.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:a,!0)),k.test(i[1])&&x.isPlainObject(n))for(i in n)x.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(o=a.getElementById(i[2]),o&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=a,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):x.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),x.makeArray(e,this))},selector:"",length:0,toArray:function(){return g.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return x.each(this,e,t)},ready:function(e){return x.ready.promise().done(e),this},slice:function(){return this.pushStack(g.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(x.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:h,sort:[].sort,splice:[].splice},x.fn.init.prototype=x.fn,x.extend=x.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"==typeof s||x.isFunction(s)||(s={}),u===l&&(s=this,--l);u>l;l++)if(null!=(o=arguments[l]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(x.isPlainObject(r)||(n=x.isArray(r)))?(n?(n=!1,a=e&&x.isArray(e)?e:[]):a=e&&x.isPlainObject(e)?e:{},s[i]=x.extend(c,a,r)):r!==t&&(s[i]=r));return s},x.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===x&&(e.$=u),t&&e.jQuery===x&&(e.jQuery=l),x},isReady:!1,readyWait:1,holdReady:function(e){e?x.readyWait++:x.ready(!0)},ready:function(e){if(e===!0?!--x.readyWait:!x.isReady){if(!a.body)return setTimeout(x.ready);x.isReady=!0,e!==!0&&--x.readyWait>0||(n.resolveWith(a,[x]),x.fn.trigger&&x(a).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===x.type(e)},isArray:Array.isArray||function(e){return"array"===x.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[y.call(e)]||"object":typeof e},isPlainObject:function(e){var n;if(!e||"object"!==x.type(e)||e.nodeType||x.isWindow(e))return!1;try{if(e.constructor&&!v.call(e,"constructor")&&!v.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}if(x.support.ownLast)for(n in e)return v.call(e,n);for(n in e);return n===t||v.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||a;var r=k.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=x.buildFragment([e],t,i),i&&x(i).remove(),x.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=x.trim(n),n&&E.test(n.replace(A,"@").replace(j,"]").replace(S,"")))?Function("return "+n)():(x.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||x.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&x.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(D,"ms-").replace(L,H)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:b&&!b.call("\ufeff\u00a0")?function(e){return null==e?"":b.call(e)}:function(e){return null==e?"":(e+"").replace(C,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?x.merge(n,"string"==typeof e?[e]:e):h.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(m)return m.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else while(n[o]!==t)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return d.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),x.isFunction(e)?(r=g.call(arguments,2),i=function(){return e.apply(n||this,r.concat(g.call(arguments)))},i.guid=e.guid=e.guid||x.guid++,i):t},access:function(e,n,r,i,o,a,s){var l=0,u=e.length,c=null==r;if("object"===x.type(r)){o=!0;for(l in r)x.access(e,n,l,r[l],!0,a,s)}else if(i!==t&&(o=!0,x.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(x(e),n)})),n))for(;u>l;l++)n(e[l],r,s?i:i.call(e[l],l,n(e[l],r)));return o?e:c?n.call(e):u?n(e[0],r):a},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),x.ready.promise=function(t){if(!n)if(n=x.Deferred(),"complete"===a.readyState)setTimeout(x.ready);else if(a.addEventListener)a.addEventListener("DOMContentLoaded",q,!1),e.addEventListener("load",q,!1);else{a.attachEvent("onreadystatechange",q),e.attachEvent("onload",q);var r=!1;try{r=null==e.frameElement&&a.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!x.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}_(),x.ready()}}()}return n.promise(t)},x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=x.type(e);return x.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=x(a),function(e,t){var n,r,i,o,a,s,l,u,c,p,f,d,h,g,m,y,v,b="sizzle"+-new Date,w=e.document,T=0,C=0,N=st(),k=st(),E=st(),S=!1,A=function(e,t){return e===t?(S=!0,0):0},j=typeof t,D=1<<31,L={}.hasOwnProperty,H=[],q=H.pop,_=H.push,M=H.push,O=H.slice,F=H.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",W=R.replace("w","w#"),$="\\["+P+"*("+R+")"+P+"*(?:([*^$|!~]?=)"+P+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+W+")|)|)"+P+"*\\]",I=":("+R+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+$.replace(3,8)+")*)|.*)\\)|)",z=RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g"),X=RegExp("^"+P+"*,"+P+"*"),U=RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),V=RegExp(P+"*[+~]"),Y=RegExp("="+P+"*([^\\]'\"]*)"+P+"*\\]","g"),J=RegExp(I),G=RegExp("^"+W+"$"),Q={ID:RegExp("^#("+R+")"),CLASS:RegExp("^\\.("+R+")"),TAG:RegExp("^("+R.replace("w","w*")+")"),ATTR:RegExp("^"+$),PSEUDO:RegExp("^"+I),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:RegExp("^(?:"+B+")$","i"),needsContext:RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/^(?:input|select|textarea|button)$/i,tt=/^h\d$/i,nt=/'|\\/g,rt=RegExp("\\\\([\\da-f]{1,6}"+P+"?|("+P+")|.)","ig"),it=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{M.apply(H=O.call(w.childNodes),w.childNodes),H[w.childNodes.length].nodeType}catch(ot){M={apply:H.length?function(e,t){_.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function at(e,t,n,i){var o,a,s,l,u,c,d,m,y,x;if((t?t.ownerDocument||t:w)!==f&&p(t),t=t||f,n=n||[],!e||"string"!=typeof e)return n;if(1!==(l=t.nodeType)&&9!==l)return[];if(h&&!i){if(o=Z.exec(e))if(s=o[1]){if(9===l){if(a=t.getElementById(s),!a||!a.parentNode)return n;if(a.id===s)return n.push(a),n}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(s))&&v(t,a)&&a.id===s)return n.push(a),n}else{if(o[2])return M.apply(n,t.getElementsByTagName(e)),n;if((s=o[3])&&r.getElementsByClassName&&t.getElementsByClassName)return M.apply(n,t.getElementsByClassName(s)),n}if(r.qsa&&(!g||!g.test(e))){if(m=d=b,y=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){c=mt(e),(d=t.getAttribute("id"))?m=d.replace(nt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",u=c.length;while(u--)c[u]=m+yt(c[u]);y=V.test(e)&&t.parentNode||t,x=c.join(",")}if(x)try{return M.apply(n,y.querySelectorAll(x)),n}catch(T){}finally{d||t.removeAttribute("id")}}}return kt(e.replace(z,"$1"),t,n,i)}function st(){var e=[];function t(n,r){return e.push(n+=" ")>o.cacheLength&&delete t[e.shift()],t[n]=r}return t}function lt(e){return e[b]=!0,e}function ut(e){var t=f.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ct(e,t){var n=e.split("|"),r=e.length;while(r--)o.attrHandle[n[r]]=t}function pt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||D)-(~e.sourceIndex||D);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function dt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ht(e){return lt(function(t){return t=+t,lt(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}s=at.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},r=at.support={},p=at.setDocument=function(e){var n=e?e.ownerDocument||e:w,i=n.defaultView;return n!==f&&9===n.nodeType&&n.documentElement?(f=n,d=n.documentElement,h=!s(n),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){p()}),r.attributes=ut(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=ut(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=ut(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),r.getById=ut(function(e){return d.appendChild(e).id=b,!n.getElementsByName||!n.getElementsByName(b).length}),r.getById?(o.find.ID=function(e,t){if(typeof t.getElementById!==j&&h){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},o.filter.ID=function(e){var t=e.replace(rt,it);return function(e){return e.getAttribute("id")===t}}):(delete o.find.ID,o.filter.ID=function(e){var t=e.replace(rt,it);return function(e){var n=typeof e.getAttributeNode!==j&&e.getAttributeNode("id");return n&&n.value===t}}),o.find.TAG=r.getElementsByTagName?function(e,n){return typeof n.getElementsByTagName!==j?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},o.find.CLASS=r.getElementsByClassName&&function(e,n){return typeof n.getElementsByClassName!==j&&h?n.getElementsByClassName(e):t},m=[],g=[],(r.qsa=K.test(n.querySelectorAll))&&(ut(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||g.push("\\["+P+"*(?:value|"+B+")"),e.querySelectorAll(":checked").length||g.push(":checked")}),ut(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&g.push("[*^$]="+P+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(r.matchesSelector=K.test(y=d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ut(function(e){r.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),m.push("!=",I)}),g=g.length&&RegExp(g.join("|")),m=m.length&&RegExp(m.join("|")),v=K.test(d.contains)||d.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},A=d.compareDocumentPosition?function(e,t){if(e===t)return S=!0,0;var i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return i?1&i||!r.sortDetached&&t.compareDocumentPosition(e)===i?e===n||v(w,e)?-1:t===n||v(w,t)?1:c?F.call(c,e)-F.call(c,t):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return S=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:c?F.call(c,e)-F.call(c,t):0;if(o===a)return pt(e,t);r=e;while(r=r.parentNode)s.unshift(r);r=t;while(r=r.parentNode)l.unshift(r);while(s[i]===l[i])i++;return i?pt(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},n):f},at.matches=function(e,t){return at(e,null,null,t)},at.matchesSelector=function(e,t){if((e.ownerDocument||e)!==f&&p(e),t=t.replace(Y,"='$1']"),!(!r.matchesSelector||!h||m&&m.test(t)||g&&g.test(t)))try{var n=y.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return at(t,f,null,[e]).length>0},at.contains=function(e,t){return(e.ownerDocument||e)!==f&&p(e),v(e,t)},at.attr=function(e,n){(e.ownerDocument||e)!==f&&p(e);var i=o.attrHandle[n.toLowerCase()],a=i&&L.call(o.attrHandle,n.toLowerCase())?i(e,n,!h):t;return a===t?r.attributes||!h?e.getAttribute(n):(a=e.getAttributeNode(n))&&a.specified?a.value:null:a},at.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},at.uniqueSort=function(e){var t,n=[],i=0,o=0;if(S=!r.detectDuplicates,c=!r.sortStable&&e.slice(0),e.sort(A),S){while(t=e[o++])t===e[o]&&(i=n.push(o));while(i--)e.splice(n[i],1)}return e},a=at.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=a(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=a(t);return n},o=at.selectors={cacheLength:50,createPseudo:lt,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(rt,it),e[3]=(e[4]||e[5]||"").replace(rt,it),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||at.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&at.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=mt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(rt,it).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=N[e+" "];return t||(t=RegExp("(^|"+P+")"+e+"("+P+"|$)"))&&N(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==j&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=at.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var u,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!l&&!s;if(m){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[b]||(m[b]={}),u=c[e]||[],d=u[0]===T&&u[1],f=u[0]===T&&u[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[T,d,f];break}}else if(v&&(u=(t[b]||(t[b]={}))[e])&&u[0]===T)f=u[1];else while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[b]||(p[b]={}))[e]=[T,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=o.pseudos[e]||o.setFilters[e.toLowerCase()]||at.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],o.setFilters.hasOwnProperty(e.toLowerCase())?lt(function(e,n){var i,o=r(e,t),a=o.length;while(a--)i=F.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:lt(function(e){var t=[],n=[],r=l(e.replace(z,"$1"));return r[b]?lt(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:lt(function(e){return function(t){return at(e,t).length>0}}),contains:lt(function(e){return function(t){return(t.textContent||t.innerText||a(t)).indexOf(e)>-1}}),lang:lt(function(e){return G.test(e||"")||at.error("unsupported lang: "+e),e=e.replace(rt,it).toLowerCase(),function(t){var n;do if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!o.pseudos.empty(e)},header:function(e){return tt.test(e.nodeName)},input:function(e){return et.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ht(function(){return[0]}),last:ht(function(e,t){return[t-1]}),eq:ht(function(e,t,n){return[0>n?n+t:n]}),even:ht(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:ht(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:ht(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ht(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}},o.pseudos.nth=o.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[n]=ft(n);for(n in{submit:!0,reset:!0})o.pseudos[n]=dt(n);function gt(){}gt.prototype=o.filters=o.pseudos,o.setFilters=new gt;function mt(e,t){var n,r,i,a,s,l,u,c=k[e+" "];if(c)return t?0:c.slice(0);s=e,l=[],u=o.preFilter;while(s){(!n||(r=X.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(i=[])),n=!1,(r=U.exec(s))&&(n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),s=s.slice(n.length));for(a in o.filter)!(r=Q[a].exec(s))||u[a]&&!(r=u[a](r))||(n=r.shift(),i.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?at.error(e):k(e,l).slice(0)}function yt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function vt(e,t,n){var r=t.dir,o=n&&"parentNode"===r,a=C++;return t.first?function(t,n,i){while(t=t[r])if(1===t.nodeType||o)return e(t,n,i)}:function(t,n,s){var l,u,c,p=T+" "+a;if(s){while(t=t[r])if((1===t.nodeType||o)&&e(t,n,s))return!0}else while(t=t[r])if(1===t.nodeType||o)if(c=t[b]||(t[b]={}),(u=c[r])&&u[0]===p){if((l=u[1])===!0||l===i)return l===!0}else if(u=c[r]=[p],u[1]=e(t,n,s)||i,u[1]===!0)return!0}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function xt(e,t,n,r,i){var o,a=[],s=0,l=e.length,u=null!=t;for(;l>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),u&&t.push(s));return a}function wt(e,t,n,r,i,o){return r&&!r[b]&&(r=wt(r)),i&&!i[b]&&(i=wt(i,o)),lt(function(o,a,s,l){var u,c,p,f=[],d=[],h=a.length,g=o||Nt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:xt(g,f,e,s,l),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,l),r){u=xt(y,d),r(u,[],s,l),c=u.length;while(c--)(p=u[c])&&(y[d[c]]=!(m[d[c]]=p))}if(o){if(i||e){if(i){u=[],c=y.length;while(c--)(p=y[c])&&u.push(m[c]=p);i(null,y=[],u,l)}c=y.length;while(c--)(p=y[c])&&(u=i?F.call(o,p):f[c])>-1&&(o[u]=!(a[u]=p))}}else y=xt(y===a?y.splice(h,y.length):y),i?i(null,a,y,l):M.apply(a,y)})}function Tt(e){var t,n,r,i=e.length,a=o.relative[e[0].type],s=a||o.relative[" "],l=a?1:0,c=vt(function(e){return e===t},s,!0),p=vt(function(e){return F.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==u)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;i>l;l++)if(n=o.relative[e[l].type])f=[vt(bt(f),n)];else{if(n=o.filter[e[l].type].apply(null,e[l].matches),n[b]){for(r=++l;i>r;r++)if(o.relative[e[r].type])break;return wt(l>1&&bt(f),l>1&&yt(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(z,"$1"),n,r>l&&Tt(e.slice(l,r)),i>r&&Tt(e=e.slice(r)),i>r&&yt(e))}f.push(n)}return bt(f)}function Ct(e,t){var n=0,r=t.length>0,a=e.length>0,s=function(s,l,c,p,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,C=u,N=s||a&&o.find.TAG("*",d&&l.parentNode||l),k=T+=null==C?1:Math.random()||.1;for(w&&(u=l!==f&&l,i=n);null!=(h=N[b]);b++){if(a&&h){g=0;while(m=e[g++])if(m(h,l,c)){p.push(h);break}w&&(T=k,i=++n)}r&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,r&&b!==v){g=0;while(m=t[g++])m(x,y,l,c);if(s){if(v>0)while(b--)x[b]||y[b]||(y[b]=q.call(p));y=xt(y)}M.apply(p,y),w&&!s&&y.length>0&&v+t.length>1&&at.uniqueSort(p)}return w&&(T=k,u=C),x};return r?lt(s):s}l=at.compile=function(e,t){var n,r=[],i=[],o=E[e+" "];if(!o){t||(t=mt(e)),n=t.length;while(n--)o=Tt(t[n]),o[b]?r.push(o):i.push(o);o=E(e,Ct(i,r))}return o};function Nt(e,t,n){var r=0,i=t.length;for(;i>r;r++)at(e,t[r],n);return n}function kt(e,t,n,i){var a,s,u,c,p,f=mt(e);if(!i&&1===f.length){if(s=f[0]=f[0].slice(0),s.length>2&&"ID"===(u=s[0]).type&&r.getById&&9===t.nodeType&&h&&o.relative[s[1].type]){if(t=(o.find.ID(u.matches[0].replace(rt,it),t)||[])[0],!t)return n;e=e.slice(s.shift().value.length)}a=Q.needsContext.test(e)?0:s.length;while(a--){if(u=s[a],o.relative[c=u.type])break;if((p=o.find[c])&&(i=p(u.matches[0].replace(rt,it),V.test(s[0].type)&&t.parentNode||t))){if(s.splice(a,1),e=i.length&&yt(s),!e)return M.apply(n,i),n;break}}}return l(e,f)(i,t,!h,n,V.test(e)),n}r.sortStable=b.split("").sort(A).join("")===b,r.detectDuplicates=S,p(),r.sortDetached=ut(function(e){return 1&e.compareDocumentPosition(f.createElement("div"))}),ut(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ct("type|href|height|width",function(e,n,r){return r?t:e.getAttribute(n,"type"===n.toLowerCase()?1:2)}),r.attributes&&ut(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ct("value",function(e,n,r){return r||"input"!==e.nodeName.toLowerCase()?t:e.defaultValue}),ut(function(e){return null==e.getAttribute("disabled")})||ct(B,function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}),x.find=at,x.expr=at.selectors,x.expr[":"]=x.expr.pseudos,x.unique=at.uniqueSort,x.text=at.getText,x.isXMLDoc=at.isXML,x.contains=at.contains}(e);var O={};function F(e){var t=O[e]={};return x.each(e.match(T)||[],function(e,n){t[n]=!0}),t}x.Callbacks=function(e){e="string"==typeof e?O[e]||F(e):x.extend({},e);var n,r,i,o,a,s,l=[],u=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=l.length,n=!0;l&&o>a;a++)if(l[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,l&&(u?u.length&&c(u.shift()):r?l=[]:p.disable())},p={add:function(){if(l){var t=l.length;(function i(t){x.each(t,function(t,n){var r=x.type(n);"function"===r?e.unique&&p.has(n)||l.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=l.length:r&&(s=t,c(r))}return this},remove:function(){return l&&x.each(arguments,function(e,t){var r;while((r=x.inArray(t,l,r))>-1)l.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?x.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],o=0,this},disable:function(){return l=u=r=t,this},disabled:function(){return!l},lock:function(){return u=t,r||p.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!l||i&&!u||(t=t||[],t=[e,t.slice?t.slice():t],n?u.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},x.extend({Deferred:function(e){var t=[["resolve","done",x.Callbacks("once memory"),"resolved"],["reject","fail",x.Callbacks("once memory"),"rejected"],["notify","progress",x.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return x.Deferred(function(n){x.each(t,function(t,o){var a=o[0],s=x.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&x.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?x.extend(e,r):r}},i={};return r.pipe=r.then,x.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=g.call(arguments),r=n.length,i=1!==r||e&&x.isFunction(e.promise)?r:0,o=1===i?e:x.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?g.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,l,u;if(r>1)for(s=Array(r),l=Array(r),u=Array(r);r>t;t++)n[t]&&x.isFunction(n[t].promise)?n[t].promise().done(a(t,u,n)).fail(o.reject).progress(a(t,l,s)):--i;return i||o.resolveWith(u,n),o.promise()}}),x.support=function(t){var n,r,o,s,l,u,c,p,f,d=a.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*")||[],r=d.getElementsByTagName("a")[0],!r||!r.style||!n.length)return t;s=a.createElement("select"),u=s.appendChild(a.createElement("option")),o=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t.getSetAttribute="t"!==d.className,t.leadingWhitespace=3===d.firstChild.nodeType,t.tbody=!d.getElementsByTagName("tbody").length,t.htmlSerialize=!!d.getElementsByTagName("link").length,t.style=/top/.test(r.getAttribute("style")),t.hrefNormalized="/a"===r.getAttribute("href"),t.opacity=/^0.5/.test(r.style.opacity),t.cssFloat=!!r.style.cssFloat,t.checkOn=!!o.value,t.optSelected=u.selected,t.enctype=!!a.createElement("form").enctype,t.html5Clone="<:nav></:nav>"!==a.createElement("nav").cloneNode(!0).outerHTML,t.inlineBlockNeedsLayout=!1,t.shrinkWrapBlocks=!1,t.pixelPosition=!1,t.deleteExpando=!0,t.noCloneEvent=!0,t.reliableMarginRight=!0,t.boxSizingReliable=!0,o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!u.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}o=a.createElement("input"),o.setAttribute("value",""),t.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),l=a.createDocumentFragment(),l.appendChild(o),t.appendChecked=o.checked,t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip;for(f in x(t))break;return t.ownLast="0"!==f,x(function(){var n,r,o,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",l=a.getElementsByTagName("body")[0];l&&(n=a.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",l.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=d.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=p&&0===o[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",x.swap(l,null!=l.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===d.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(a.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(l.style.zoom=1)),l.removeChild(n),n=d=o=r=null)}),n=s=l=u=r=o=null,t}({});var B=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;function R(e,n,r,i){if(x.acceptData(e)){var o,a,s=x.expando,l=e.nodeType,u=l?x.cache:e,c=l?e[s]:e[s]&&s;if(c&&u[c]&&(i||u[c].data)||r!==t||"string"!=typeof n)return c||(c=l?e[s]=p.pop()||x.guid++:s),u[c]||(u[c]=l?{}:{toJSON:x.noop}),("object"==typeof n||"function"==typeof n)&&(i?u[c]=x.extend(u[c],n):u[c].data=x.extend(u[c].data,n)),a=u[c],i||(a.data||(a.data={}),a=a.data),r!==t&&(a[x.camelCase(n)]=r),"string"==typeof n?(o=a[n],null==o&&(o=a[x.camelCase(n)])):o=a,o}}function W(e,t,n){if(x.acceptData(e)){var r,i,o=e.nodeType,a=o?x.cache:e,s=o?e[x.expando]:x.expando;if(a[s]){if(t&&(r=n?a[s]:a[s].data)){x.isArray(t)?t=t.concat(x.map(t,x.camelCase)):t in r?t=[t]:(t=x.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!I(r):!x.isEmptyObject(r))return}(n||(delete a[s].data,I(a[s])))&&(o?x.cleanData([e],!0):x.support.deleteExpando||a!=a.window?delete a[s]:a[s]=null)}}}x.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?x.cache[e[x.expando]]:e[x.expando],!!e&&!I(e)},data:function(e,t,n){return R(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return R(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&x.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),x.fn.extend({data:function(e,n){var r,i,o=null,a=0,s=this[0];if(e===t){if(this.length&&(o=x.data(s),1===s.nodeType&&!x._data(s,"parsedAttrs"))){for(r=s.attributes;r.length>a;a++)i=r[a].name,0===i.indexOf("data-")&&(i=x.camelCase(i.slice(5)),$(s,i,o[i]));x._data(s,"parsedAttrs",!0)}return o}return"object"==typeof e?this.each(function(){x.data(this,e)}):arguments.length>1?this.each(function(){x.data(this,e,n)}):s?$(s,e,x.data(s,e)):null},removeData:function(e){return this.each(function(){x.removeData(this,e)})}});function $(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(P,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:B.test(r)?x.parseJSON(r):r}catch(o){}x.data(e,n,r)}else r=t}return r}function I(e){var t;for(t in e)if(("data"!==t||!x.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}x.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=x._data(e,n),r&&(!i||x.isArray(r)?i=x._data(e,n,x.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=x.queue(e,t),r=n.length,i=n.shift(),o=x._queueHooks(e,t),a=function(){x.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return x._data(e,n)||x._data(e,n,{empty:x.Callbacks("once memory").add(function(){x._removeData(e,t+"queue"),x._removeData(e,n)})})}}),x.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?x.queue(this[0],e):n===t?this:this.each(function(){var t=x.queue(this,e,n);x._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&x.dequeue(this,e)})},dequeue:function(e){return this.each(function(){x.dequeue(this,e)})},delay:function(e,t){return e=x.fx?x.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=x.Deferred(),a=this,s=this.length,l=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--)r=x._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(l));return l(),o.promise(n)}});var z,X,U=/[\t\r\n\f]/g,V=/\r/g,Y=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,G=/^(?:checked|selected)$/i,Q=x.support.getSetAttribute,K=x.support.input;x.fn.extend({attr:function(e,t){return x.access(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){x.removeAttr(this,e)})},prop:function(e,t){return x.access(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return e=x.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,l="string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(T)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(U," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=x.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,l=0===arguments.length||"string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(T)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(U," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?x.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):x.isFunction(e)?this.each(function(n){x(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var t,r=0,o=x(this),a=e.match(T)||[];while(t=a[r++])o.hasClass(t)?o.removeClass(t):o.addClass(t)}else(n===i||"boolean"===n)&&(this.className&&x._data(this,"__className__",this.className),this.className=this.className||e===!1?"":x._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(U," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=x.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=i?e.call(this,n,x(this).val()):e,null==o?o="":"number"==typeof o?o+="":x.isArray(o)&&(o=x.map(o,function(e){return null==e?"":e+""})),r=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))});if(o)return r=x.valHooks[o.type]||x.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(V,""):null==n?"":n)}}}),x.extend({valHooks:{option:{get:function(e){var t=x.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,l=0>i?s:o?i:0;for(;s>l;l++)if(n=r[l],!(!n.selected&&l!==i||(x.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&x.nodeName(n.parentNode,"optgroup"))){if(t=x(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n,r,i=e.options,o=x.makeArray(t),a=i.length;while(a--)r=i[a],(r.selected=x.inArray(x(r).val(),o)>=0)&&(n=!0);return n||(e.selectedIndex=-1),o}}},attr:function(e,n,r){var o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===i?x.prop(e,n,r):(1===s&&x.isXMLDoc(e)||(n=n.toLowerCase(),o=x.attrHooks[n]||(x.expr.match.bool.test(n)?X:z)),r===t?o&&"get"in o&&null!==(a=o.get(e,n))?a:(a=x.find.attr(e,n),null==a?t:a):null!==r?o&&"set"in o&&(a=o.set(e,r,n))!==t?a:(e.setAttribute(n,r+""),r):(x.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(T);if(o&&1===e.nodeType)while(n=o[i++])r=x.propFix[n]||n,x.expr.match.bool.test(n)?K&&Q||!G.test(n)?e[r]=!1:e[x.camelCase("default-"+n)]=e[r]=!1:x.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!x.support.radioValue&&"radio"===t&&x.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!x.isXMLDoc(e),a&&(n=x.propFix[n]||n,o=x.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var t=x.find.attr(e,"tabindex");return t?parseInt(t,10):Y.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:-1}}}}),X={set:function(e,t,n){return t===!1?x.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&x.propFix[n]||n,n):e[x.camelCase("default-"+n)]=e[n]=!0,n}},x.each(x.expr.match.bool.source.match(/\w+/g),function(e,n){var r=x.expr.attrHandle[n]||x.find.attr;x.expr.attrHandle[n]=K&&Q||!G.test(n)?function(e,n,i){var o=x.expr.attrHandle[n],a=i?t:(x.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;return x.expr.attrHandle[n]=o,a}:function(e,n,r){return r?t:e[x.camelCase("default-"+n)]?n.toLowerCase():null}}),K&&Q||(x.attrHooks.value={set:function(e,n,r){return x.nodeName(e,"input")?(e.defaultValue=n,t):z&&z.set(e,n,r)}}),Q||(z={set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},x.expr.attrHandle.id=x.expr.attrHandle.name=x.expr.attrHandle.coords=function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&""!==i.value?i.value:null},x.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&r.specified?r.value:t},set:z.set},x.attrHooks.contenteditable={set:function(e,t,n){z.set(e,""===t?!1:t,n)}},x.each(["width","height"],function(e,n){x.attrHooks[n]={set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}}})),x.support.hrefNormalized||x.each(["href","src"],function(e,t){x.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),x.support.style||(x.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),x.support.optSelected||(x.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){x.propFix[this.toLowerCase()]=this}),x.support.enctype||(x.propFix.enctype="encoding"),x.each(["radio","checkbox"],function(){x.valHooks[this]={set:function(e,n){return x.isArray(n)?e.checked=x.inArray(x(e).val(),n)>=0:t}},x.support.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return!0}function ot(){return!1}function at(){try{return a.activeElement}catch(e){}}x.event={global:{},add:function(e,n,r,o,a){var s,l,u,c,p,f,d,h,g,m,y,v=x._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=x.guid++),(l=v.events)||(l=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof x===i||e&&x.event.triggered===e.type?t:x.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(T)||[""],u=n.length;while(u--)s=rt.exec(n[u])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),g&&(p=x.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=x.event.special[g]||{},d=x.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&x.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=l[g])||(h=l[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),x.event.global[g]=!0);e=null}},remove:function(e,t,n,r,i){var o,a,s,l,u,c,p,f,d,h,g,m=x.hasData(e)&&x._data(e);if(m&&(c=m.events)){t=(t||"").match(T)||[""],u=t.length;while(u--)if(s=rt.exec(t[u])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=x.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=o=f.length;while(o--)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));l&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||x.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)x.event.remove(e,d+t[u],n,r,!0);x.isEmptyObject(c)&&(delete m.handle,x._removeData(e,"events"))}},trigger:function(n,r,i,o){var s,l,u,c,p,f,d,h=[i||a],g=v.call(n,"type")?n.type:n,m=v.call(n,"namespace")?n.namespace.split("."):[];if(u=f=i=i||a,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+x.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),l=0>g.indexOf(":")&&"on"+g,n=n[x.expando]?n:new x.Event(g,"object"==typeof n&&n),n.isTrigger=o?2:3,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:x.makeArray(r,[n]),p=x.event.special[g]||{},o||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!o&&!p.noBubble&&!x.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(u=u.parentNode);u;u=u.parentNode)h.push(u),f=u;f===(i.ownerDocument||a)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((u=h[d++])&&!n.isPropagationStopped())n.type=d>1?c:p.bindType||g,s=(x._data(u,"events")||{})[n.type]&&x._data(u,"handle"),s&&s.apply(u,r),s=l&&u[l],s&&x.acceptData(u)&&s.apply&&s.apply(u,r)===!1&&n.preventDefault();if(n.type=g,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(h.pop(),r)===!1)&&x.acceptData(i)&&l&&i[g]&&!x.isWindow(i)){f=i[l],f&&(i[l]=null),x.event.triggered=g;try{i[g]()}catch(y){}x.event.triggered=t,f&&(i[l]=f)}return n.result}},dispatch:function(e){e=x.event.fix(e);var n,r,i,o,a,s=[],l=g.call(arguments),u=(x._data(this,"events")||{})[e.type]||[],c=x.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=x.event.handlers.call(this,e,u),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((x.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,l),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],l=n.delegateCount,u=e.target;if(l&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!=this;u=u.parentNode||this)if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(o=[],a=0;l>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?x(r,this).index(u)>=0:x.find(r,this,null,[u]).length),o[r]&&o.push(i);o.length&&s.push({elem:u,handlers:o})}return n.length>l&&s.push({elem:this,handlers:n.slice(l)}),s},fix:function(e){if(e[x.expando])return e;var t,n,r,i=e.type,o=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new x.Event(o),t=r.length;while(t--)n=r[t],e[n]=o[n];return e.target||(e.target=o.srcElement||a),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,s=n.button,l=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||a,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&l&&(e.relatedTarget=l===e.target?n.toElement:l),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==at()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===at()&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},click:{trigger:function(){return x.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t},_default:function(e){return x.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=x.extend(new x.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?x.event.trigger(i,null,t):x.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},x.removeEvent=a.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},x.Event=function(e,n){return this instanceof x.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&x.extend(this,n),this.timeStamp=e&&e.timeStamp||x.now(),this[x.expando]=!0,t):new x.Event(e,n)},x.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},x.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!x.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),x.support.submitBubbles||(x.event.special.submit={setup:function(){return x.nodeName(this,"form")?!1:(x.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=x.nodeName(n,"input")||x.nodeName(n,"button")?n.form:t;r&&!x._data(r,"submitBubbles")&&(x.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),x._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&x.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return x.nodeName(this,"form")?!1:(x.event.remove(this,"._submit"),t)}}),x.support.changeBubbles||(x.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(x.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),x.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),x.event.simulate("change",this,e,!0)})),!1):(x.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!x._data(t,"changeBubbles")&&(x.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||x.event.simulate("change",this.parentNode,e,!0)}),x._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return x.event.remove(this,"._change"),!Z.test(this.nodeName)}}),x.support.focusinBubbles||x.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){x.event.simulate(t,e.target,x.event.fix(e),!0)};x.event.special[t]={setup:function(){0===n++&&a.addEventListener(e,r,!0)},teardown:function(){0===--n&&a.removeEventListener(e,r,!0)}}}),x.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return x().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=x.guid++)),this.each(function(){x.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,x(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){x.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){x.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?x.event.trigger(e,n,r,!0):t}});var st=/^.[^:#\[\.,]*$/,lt=/^(?:parents|prev(?:Until|All))/,ut=x.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};x.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(x(e).filter(function(){for(t=0;i>t;t++)if(x.contains(r[t],this))return!0}));for(t=0;i>t;t++)x.find(e,r[t],n);return n=this.pushStack(i>1?x.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t,n=x(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(x.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e||[],!0))},filter:function(e){return this.pushStack(ft(this,e||[],!1))},is:function(e){return!!ft(this,"string"==typeof e&&ut.test(e)?x(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,o=[],a=ut.test(e)||"string"!=typeof e?x(e,t||this.context):0;for(;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(11>n.nodeType&&(a?a.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){n=o.push(n);break}return this.pushStack(o.length>1?x.unique(o):o)},index:function(e){return e?"string"==typeof e?x.inArray(this[0],x(e)):x.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?x(e,t):x.makeArray(e&&e.nodeType?[e]:e),r=x.merge(this.get(),n);return this.pushStack(x.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x.dir(e,"parentNode")},parentsUntil:function(e,t,n){return x.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return x.dir(e,"nextSibling")},prevAll:function(e){return x.dir(e,"previousSibling")},nextUntil:function(e,t,n){return x.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return x.dir(e,"previousSibling",n)},siblings:function(e){return x.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return x.sibling(e.firstChild)},contents:function(e){return x.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:x.merge([],e.childNodes)}},function(e,t){x.fn[e]=function(n,r){var i=x.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=x.filter(r,i)),this.length>1&&(ct[e]||(i=x.unique(i)),lt.test(e)&&(i=i.reverse())),this.pushStack(i)}}),x.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!x(o).is(r)))1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ft(e,t,n){if(x.isFunction(t))return x.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return x.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(st.test(t))return x.filter(t,e,n);t=x.filter(t,e)}return x.grep(e,function(e){return x.inArray(e,t)>=0!==n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Ct=/^(?:checkbox|radio)$/i,Nt=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:x.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(a),Dt=jt.appendChild(a.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,x.fn.extend({text:function(e){return x.access(this,function(e){return e===t?x.text(this):this.empty().append((this[0]&&this[0].ownerDocument||a).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Lt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Lt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?x.filter(e,this):this,i=0;for(;null!=(n=r[i]);i++)t||1!==n.nodeType||x.cleanData(Ft(n)),n.parentNode&&(t&&x.contains(n.ownerDocument,n)&&_t(Ft(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&x.cleanData(Ft(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&x.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return x.clone(this,e,t)})},html:function(e){return x.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!x.support.htmlSerialize&&mt.test(e)||!x.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(x.cleanData(Ft(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=x.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],i=e[t++];i&&(r&&r.parentNode!==i&&(r=this.nextSibling),x(this).remove(),i.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=d.apply([],e);var r,i,o,a,s,l,u=0,c=this.length,p=this,f=c-1,h=e[0],g=x.isFunction(h);if(g||!(1>=c||"string"!=typeof h||x.support.checkClone)&&Nt.test(h))return this.each(function(r){var i=p.eq(r);g&&(e[0]=h.call(this,r,i.html())),i.domManip(e,t,n)});if(c&&(l=x.buildFragment(e,this[0].ownerDocument,!1,!n&&this),r=l.firstChild,1===l.childNodes.length&&(l=r),r)){for(a=x.map(Ft(l,"script"),Ht),o=a.length;c>u;u++)i=l,u!==f&&(i=x.clone(i,!0,!0),o&&x.merge(a,Ft(i,"script"))),t.call(this[u],i,u);if(o)for(s=a[a.length-1].ownerDocument,x.map(a,qt),u=0;o>u;u++)i=a[u],kt.test(i.type||"")&&!x._data(i,"globalEval")&&x.contains(s,i)&&(i.src?x._evalUrl(i.src):x.globalEval((i.text||i.textContent||i.innerHTML||"").replace(St,"")));l=r=null}return this}});function Lt(e,t){return x.nodeName(e,"table")&&x.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Ht(e){return e.type=(null!==x.find.attr(e,"type"))+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function _t(e,t){var n,r=0;for(;null!=(n=e[r]);r++)x._data(n,"globalEval",!t||x._data(t[r],"globalEval"))}function Mt(e,t){if(1===t.nodeType&&x.hasData(e)){var n,r,i,o=x._data(e),a=x._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)x.event.add(t,n,s[n][r])}a.data&&(a.data=x.extend({},a.data))}}function Ot(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!x.support.noCloneEvent&&t[x.expando]){i=x._data(t);for(r in i.events)x.removeEvent(t,r,i.handle);t.removeAttribute(x.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),x.support.html5Clone&&e.innerHTML&&!x.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Ct.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){x.fn[e]=function(e){var n,r=0,i=[],o=x(e),a=o.length-1;for(;a>=r;r++)n=r===a?this:this.clone(!0),x(o[r])[t](n),h.apply(i,n.get());return this.pushStack(i)}});function Ft(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||x.nodeName(o,n)?s.push(o):x.merge(s,Ft(o,n));return n===t||n&&x.nodeName(e,n)?x.merge([e],s):s}function Bt(e){Ct.test(e.type)&&(e.defaultChecked=e.checked)}x.extend({clone:function(e,t,n){var r,i,o,a,s,l=x.contains(e.ownerDocument,e);if(x.support.html5Clone||x.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(x.support.noCloneEvent&&x.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||x.isXMLDoc(e)))for(r=Ft(o),s=Ft(e),a=0;null!=(i=s[a]);++a)r[a]&&Ot(i,r[a]);if(t)if(n)for(s=s||Ft(e),r=r||Ft(o),a=0;null!=(i=s[a]);a++)Mt(i,r[a]);else Mt(e,o);return r=Ft(o,"script"),r.length>0&&_t(r,!l&&Ft(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,l,u,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++)if(o=e[h],o||0===o)if("object"===x.type(o))x.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),l=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[l]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--)s=s.lastChild;if(!x.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!x.support.tbody){o="table"!==l||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--)x.nodeName(u=o.childNodes[i],"tbody")&&!u.childNodes.length&&o.removeChild(u)}x.merge(d,s.childNodes),s.textContent="";while(s.firstChild)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));s&&f.removeChild(s),x.support.appendChecked||x.grep(Ft(d,"input"),Bt),h=0;while(o=d[h++])if((!r||-1===x.inArray(o,r))&&(a=x.contains(o.ownerDocument,o),s=Ft(f.appendChild(o),"script"),a&&_t(s),n)){i=0;while(o=s[i++])kt.test(o.type||"")&&n.push(o)}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,l=x.expando,u=x.cache,c=x.support.deleteExpando,f=x.event.special;for(;null!=(n=e[s]);s++)if((t||x.acceptData(n))&&(o=n[l],a=o&&u[o])){if(a.events)for(r in a.events)f[r]?x.event.remove(n,r):x.removeEvent(n,r,a.handle);u[o]&&(delete u[o],c?delete n[l]:typeof n.removeAttribute!==i?n.removeAttribute(l):n[l]=null,p.push(o))}},_evalUrl:function(e){return x.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),x.fn.extend({wrapAll:function(e){if(x.isFunction(e))return this.each(function(t){x(this).wrapAll(e.call(this,t))});if(this[0]){var t=x(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return x.isFunction(e)?this.each(function(t){x(this).wrapInner(e.call(this,t))}):this.each(function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=x.isFunction(e);return this.each(function(n){x(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){x.nodeName(this,"body")||x(this).replaceWith(this.childNodes)}).end()}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+w+")(.*)$","i"),Yt=RegExp("^("+w+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+w+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===x.css(e,"display")||!x.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++)r=e[a],r.style&&(o[a]=x._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=x._data(r,"olddisplay",ln(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&x._data(r,"olddisplay",i?n:x.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}x.fn.extend({css:function(e,n){return x.access(this,function(e,n,r){var i,o,a={},s=0;if(x.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=x.css(e,n[s],!1,o);return a}return r!==t?x.style(e,n,r):x.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){nn(this)?x(this).show():x(this).hide()})}}),x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":x.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,l=x.camelCase(n),u=e.style;if(n=x.cssProps[l]||(x.cssProps[l]=tn(u,l)),s=x.cssHooks[n]||x.cssHooks[l],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:u[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(x.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||x.cssNumber[l]||(r+="px"),x.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(u[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{u[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,l=x.camelCase(n);return n=x.cssProps[l]||(x.cssProps[l]=tn(e.style,l)),s=x.cssHooks[n]||x.cssHooks[l],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||x.isNumeric(o)?o||0:a):a}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),l=s?s.getPropertyValue(n)||s[n]:t,u=e.style;return s&&(""!==l||x.contains(e.ownerDocument,e)||(l=x.style(e,n)),Yt.test(l)&&Ut.test(n)&&(i=u.width,o=u.minWidth,a=u.maxWidth,u.minWidth=u.maxWidth=u.width=l,l=s.width,u.width=i,u.minWidth=o,u.maxWidth=a)),l}):a.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),l=s?s[n]:t,u=e.style;return null==l&&u&&u[n]&&(l=u[n]),Yt.test(l)&&!zt.test(n)&&(i=u.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),u.left="fontSize"===n?"1em":l,l=u.pixelLeft+"px",u.left=i,a&&(o.left=a)),""===l?"auto":l});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2)"margin"===n&&(a+=x.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=x.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=x.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=x.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=x.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(x.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function ln(e){var t=a,n=Gt[e];return n||(n=un(e,t),"none"!==n&&n||(Pt=(Pt||x("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=un(e,t),Pt.detach()),Gt[e]=n),n}function un(e,t){var n=x(t.createElement(e)).appendTo(t.body),r=x.css(n[0],"display");return n.remove(),r}x.each(["height","width"],function(e,n){x.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(x.css(e,"display"))?x.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,i),i):0)}}}),x.support.opacity||(x.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=x.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===x.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),x(function(){x.support.reliableMarginRight||(x.cssHooks.marginRight={get:function(e,n){return n?x.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!x.support.pixelPosition&&x.fn.position&&x.each(["top","left"],function(e,n){x.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?x(e).position()[n]+"px":r):t}}})}),x.expr&&x.expr.filters&&(x.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!x.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||x.css(e,"display"))},x.expr.filters.visible=function(e){return!x.expr.filters.hidden(e)}),x.each({margin:"",padding:"",border:"Width"},function(e,t){x.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(x.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=x.prop(this,"elements");return e?x.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!x(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Ct.test(e))}).map(function(e,t){var n=x(this).val();return null==n?null:x.isArray(n)?x.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),x.param=function(e,n){var r,i=[],o=function(e,t){t=x.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=x.ajaxSettings&&x.ajaxSettings.traditional),x.isArray(e)||e.jquery&&!x.isPlainObject(e))x.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(x.isArray(t))x.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==x.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),x.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var mn,yn,vn=x.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Cn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Nn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=x.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=o.href}catch(Ln){yn=a.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(T)||[];if(x.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){var o={},a=e===jn;function s(l){var u;return o[l]=!0,x.each(e[l]||[],function(e,l){var c=l(n,r,i);return"string"!=typeof c||a||o[c]?a?!(u=c):t:(n.dataTypes.unshift(c),s(c),!1)}),u}return s(n.dataTypes[0])||!o["*"]&&s("*")}function _n(e,n){var r,i,o=x.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&x.extend(!0,e,r),e}x.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,l=e.indexOf(" ");return l>=0&&(i=e.slice(l,e.length),e=e.slice(0,l)),x.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&x.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?x("<div>").append(x.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){x.fn[t]=function(e){return this.on(t,e)}}),x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Cn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":x.parseJSON,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?_n(_n(e,x.ajaxSettings),t):_n(x.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,l,u,c,p=x.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?x(f):x.event,h=x.Deferred(),g=x.Callbacks("once memory"),m=p.statusCode||{},y={},v={},b=0,w="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!c){c={};while(t=Tn.exec(a))c[t[1].toLowerCase()]=t[2]}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return b||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else C.always(e[C.status]);return this},abort:function(e){var t=e||w;return u&&u.abort(t),k(0,t),this}};if(h.promise(C).complete=g.add,C.success=C.done,C.error=C.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=x.trim(p.dataType||"*").toLowerCase().match(T)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(mn[3]||("http:"===mn[1]?"80":"443")))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=x.param(p.data,p.traditional)),qn(An,p,n,C),2===b)return C;l=p.global,l&&0===x.active++&&x.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Nn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(x.lastModified[o]&&C.setRequestHeader("If-Modified-Since",x.lastModified[o]),x.etag[o]&&C.setRequestHeader("If-None-Match",x.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&C.setRequestHeader("Content-Type",p.contentType),C.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)C.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,C,p)===!1||2===b))return C.abort();w="abort";for(i in{success:1,error:1,complete:1})C[i](p[i]);if(u=qn(jn,p,n,C)){C.readyState=1,l&&d.trigger("ajaxSend",[C,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){C.abort("timeout")},p.timeout));try{b=1,u.send(y,k)}catch(N){if(!(2>b))throw N;k(-1,N)}}else k(-1,"No Transport");function k(e,n,r,i){var c,y,v,w,T,N=n;2!==b&&(b=2,s&&clearTimeout(s),u=t,a=i||"",C.readyState=e>0?4:0,c=e>=200&&300>e||304===e,r&&(w=Mn(p,C,r)),w=On(p,w,C,c),c?(p.ifModified&&(T=C.getResponseHeader("Last-Modified"),T&&(x.lastModified[o]=T),T=C.getResponseHeader("etag"),T&&(x.etag[o]=T)),204===e||"HEAD"===p.type?N="nocontent":304===e?N="notmodified":(N=w.state,y=w.data,v=w.error,c=!v)):(v=N,(e||!N)&&(N="error",0>e&&(e=0))),C.status=e,C.statusText=(n||N)+"",c?h.resolveWith(f,[y,N,C]):h.rejectWith(f,[C,N,v]),C.statusCode(m),m=t,l&&d.trigger(c?"ajaxSuccess":"ajaxError",[C,p,c?y:v]),g.fireWith(f,[C,N]),l&&(d.trigger("ajaxComplete",[C,p]),--x.active||x.event.trigger("ajaxStop")))}return C},getJSON:function(e,t,n){return x.get(e,t,n,"json")},getScript:function(e,n){return x.get(e,t,n,"script")}}),x.each(["get","post"],function(e,n){x[n]=function(e,r,i,o){return x.isFunction(r)&&(o=o||i,i=r,r=t),x.ajax({url:e,type:n,dataType:o,data:r,success:i})}});function Mn(e,n,r){var i,o,a,s,l=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in l)if(l[s]&&l[s].test(o)){u.unshift(s);break}if(u[0]in r)a=u[0];else{for(s in r){if(!u[0]||e.converters[s+" "+u[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==u[0]&&u.unshift(a),r[a]):t}function On(e,t,n,r){var i,o,a,s,l,u={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(a=u[l+" "+o]||u["* "+o],!a)for(i in u)if(s=i.split(" "),s[1]===o&&(a=u[l+" "+s[0]]||u["* "+s[0]])){a===!0?a=u[i]:u[i]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(p){return{state:"parsererror",error:a?p:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),x.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=a.head||x("head")[0]||a.documentElement;return{send:function(t,i){n=a.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Fn=[],Bn=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Fn.pop()||x.expando+"_"+vn++;return this[e]=!0,e}}),x.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,l=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return l||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=x.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,l?n[l]=n[l].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||x.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,Fn.push(o)),s&&x.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}x.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=x.ajaxSettings.xhr(),x.support.cors=!!Rn&&"withCredentials"in Rn,Rn=x.support.ajax=!!Rn,Rn&&x.ajaxTransport(function(n){if(!n.crossDomain||x.support.cors){var r;return{send:function(i,o){var a,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)l[s]=n.xhrFields[s];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)l.setRequestHeader(s,i[s])}catch(u){}l.send(n.hasContent&&n.data||null),r=function(e,i){var s,u,c,p;try{if(r&&(i||4===l.readyState))if(r=t,a&&(l.onreadystatechange=x.noop,$n&&delete Pn[a]),i)4!==l.readyState&&l.abort();else{p={},s=l.status,u=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(p.text=l.responseText);try{c=l.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,u)},n.async?4===l.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},x(e).unload($n)),Pn[a]=r),l.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=Yn.exec(t),o=i&&i[3]||(x.cssNumber[e]?"":"px"),a=(x.cssNumber[e]||"px"!==o&&+r)&&Yn.exec(x.css(n.elem,e)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],i=i||[],a=+r||1;do s=s||".5",a/=s,x.style(n.elem,e,a+o);while(s!==(s=n.cur()/r)&&1!==s&&--l)}return i&&(a=n.start=+a||+r||0,n.unit=o,n.end=i[1]?a+(i[1]+1)*i[2]:+i[2]),n}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=x.now()}function Zn(e,t,n){var r,i=(Qn[t]||[]).concat(Qn["*"]),o=0,a=i.length;for(;a>o;o++)if(r=i[o].call(n,t,e))return r}function er(e,t,n){var r,i,o=0,a=Gn.length,s=x.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;var t=Xn||Kn(),n=Math.max(0,u.startTime+u.duration-t),r=n/u.duration||0,o=1-r,a=0,l=u.tweens.length;for(;l>a;a++)u.tweens[a].run(o);return s.notifyWith(e,[u,o,n]),1>o&&l?n:(s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)u.tweens[n].run(1);return t?s.resolveWith(e,[u,t]):s.rejectWith(e,[u,t]),this}}),c=u.props;for(tr(c,u.opts.specialEasing);a>o;o++)if(r=Gn[o].call(u,e,c,u.opts))return r;return x.map(c,Zn,u),x.isFunction(u.opts.start)&&u.opts.start.call(e,u),x.fx.timer(x.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function tr(e,t){var n,r,i,o,a;for(n in e)if(r=x.camelCase(n),i=t[r],o=e[n],x.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),a=x.cssHooks[r],a&&"expand"in a){o=a.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}x.Animation=x.extend(er,{tweener:function(e,t){x.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,l,u=this,c={},p=e.style,f=e.nodeType&&nn(e),d=x._data(e,"fxshow");n.queue||(s=x._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,x.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===x.css(e,"display")&&"none"===x.css(e,"float")&&(x.support.inlineBlockNeedsLayout&&"inline"!==ln(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",x.support.shrinkWrapBlocks||u.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],Vn.exec(i)){if(delete t[r],o=o||"toggle"===i,i===(f?"hide":"show"))continue;c[r]=d&&d[r]||x.style(e,r)}if(!x.isEmptyObject(c)){d?"hidden"in d&&(f=d.hidden):d=x._data(e,"fxshow",{}),o&&(d.hidden=!f),f?x(e).show():u.done(function(){x(e).hide()}),u.done(function(){var t;x._removeData(e,"fxshow");for(t in c)x.style(e,t,c[t])});for(r in c)a=Zn(f?d[r]:0,r,u),r in d||(d[r]=a.start,f&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}x.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(x.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=x.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[x.cssProps[e.prop]]||x.cssHooks[e.prop])?x.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.each(["toggle","show","hide"],function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=x.isEmptyObject(e),o=x.speed(t,n,r),a=function(){var t=er(this,x.extend({},e),o);(i||x._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=x.timers,a=x._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&x.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=x._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=x.timers,a=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}x.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),x.speed=function(e,t,n){var r=e&&"object"==typeof e?x.extend({},e):{complete:n||!n&&t||x.isFunction(e)&&e,duration:e,easing:n&&t||t&&!x.isFunction(t)&&t};return r.duration=x.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in x.fx.speeds?x.fx.speeds[r.duration]:x.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){x.isFunction(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},x.timers=[],x.fx=rr.prototype.init,x.fx.tick=function(){var e,n=x.timers,r=0;for(Xn=x.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||x.fx.stop(),Xn=t},x.fx.timer=function(e){e()&&x.timers.push(e)&&x.fx.start()},x.fx.interval=13,x.fx.start=function(){Un||(Un=setInterval(x.fx.tick,x.fx.interval))},x.fx.stop=function(){clearInterval(Un),Un=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fx.step={},x.expr&&x.expr.filters&&(x.expr.filters.animated=function(e){return x.grep(x.timers,function(t){return e===t.elem}).length}),x.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){x.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s)return n=s.documentElement,x.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o},x.offset={setOffset:function(e,t,n){var r=x.css(e,"position");"static"===r&&(e.style.position="relative");var i=x(e),o=i.offset(),a=x.css(e,"top"),s=x.css(e,"left"),l=("absolute"===r||"fixed"===r)&&x.inArray("auto",[a,s])>-1,u={},c={},p,f;l?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),x.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(u.top=t.top-o.top+p),null!=t.left&&(u.left=t.left-o.left+f),"using"in t?t.using.call(e,u):i.css(u)}},x.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===x.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),x.nodeName(e[0],"html")||(n=e.offset()),n.top+=x.css(e[0],"borderTopWidth",!0),n.left+=x.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-x.css(r,"marginTop",!0),left:t.left-n.left-x.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s;while(e&&!x.nodeName(e,"html")&&"static"===x.css(e,"position"))e=e.offsetParent;return e||s})}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);x.fn[e]=function(i){return x.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?x(a).scrollLeft():o,r?o:x(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return x.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}x.each({Height:"height",Width:"width"},function(e,n){x.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){x.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return x.access(this,function(n,r,i){var o;return x.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?x.css(n,r,s):x.style(n,r,i,s)},n,a?i:t,a,null)}})}),x.fn.size=function(){return this.length},x.fn.andSelf=x.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=x:(e.jQuery=e.$=x,"function"==typeof define&&define.amd&&define("jquery",[],function(){return x}))})(window);]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head><meta charset="UTF-8"><title>图片上传前的预览——plupload演示demo</title><script src="js/jquery-1.10.2.min.js"></script><script src="js/plupload.full.min.js"></script><style>body{ font-size: 12px;}body,p,div{ padding: 0; margin: 0;}.wraper{ padding: 30px 0;}.btn-wraper{ text-align: center;}.btn-wraper input{ margin: 0 10px;}#file-list{ width: 350px; margin: 20px auto;}#file-list li{ margin-bottom: 10px;}.file-name{ line-height: 30px;}.progress{ height: 4px; font-size: 0; line-height: 4px; background: orange; width: 0;}.tip1{text-align: center; font-size:14px; padding-top:10px;}    .tip2{text-align: center; font-size:12px; padding-top:10px; color:#b00}    .catalogue{ position: fixed; _position:absolute; _width:200px; left: 0; top: 0; border: 1px solid #ccc;padding: 10px; background: #eee}    .catalogue a{ line-height: 30px; color: #0c0}    .catalogue li{ padding: 0; margin: 0; list-style: none;}</style></head><body><p class="tip1">本demo实现的图片预览功能需要浏览器支持data URL，IE8+以及其他标准浏览器都是支持的</p><div class="wraper"><div class="btn-wraper"><input type="button" value="选择文件..." id="browse" /></div><ul id="file-list"></ul></div><ul class="catalogue"><li><a href="index.html">1、最基本的使用demo</a></li><li><a href="index2.html">2、文件过滤功能demo</a></li><li><a href="index3.html">3、拖拽上传功能demo</a></li><li><a href="index4.html">4、图片预览功能demo</a></li><li><a href="http://chaping.github.io/plupload/doc/">Plupload文档</a></li></ul><script>var uploader = new plupload.Uploader({ //实例化一个plupload上传对象browse_button : 'browse',url : 'upload.html',flash_swf_url : 'js/Moxie.swf',silverlight_xap_url : 'js/Moxie.xap',filters: {  mime_types : [ //只允许上传图片文件    { title : "图片文件", extensions : "jpg,gif,png" }  ]}});uploader.init(); //初始化//绑定文件添加进队列事件uploader.bind('FilesAdded',function(uploader,files){for(var i = 0, len = files.length; i<len; i++){var file_name = files[i].name; //文件名//构造html来更新UIvar html = '<li id="file-' + files[i].id +'"><p class="file-name">' + file_name + '</p><p class="progress"></p></li>';$(html).appendTo('#file-list');!function(i){previewImage(files[i],function(imgsrc){$('#file-'+files[i].id).append('<img src="'+ imgsrc +'" />');})    }(i);}});//plupload中为我们提供了mOxie对象//有关mOxie的介绍和说明请看：https://github.com/moxiecode/moxie/wiki/API//如果你不想了解那么多的话，那就照抄本示例的代码来得到预览的图片吧function previewImage(file,callback){//file为plupload事件监听函数参数中的file对象,callback为预览图片准备完成的回调函数if(!file || !/image\//.test(file.type)) return; //确保文件是图片if(file.type=='image/gif'){//gif使用FileReader进行预览,因为mOxie.Image只支持jpg和pngvar fr = new mOxie.FileReader();fr.onload = function(){callback(fr.result);fr.destroy();fr = null;}fr.readAsDataURL(file.getSource());}else{var preloader = new mOxie.Image();preloader.onload = function() {preloader.downsize( 300, 300 );//先压缩一下要预览的图片,宽300，高300var imgsrc = preloader.type=='image/jpeg' ? preloader.getAsDataURL('image/jpeg',80) : preloader.getAsDataURL(); //得到图片src,实质为一个base64编码的数据callback && callback(imgsrc); //callback传入的参数为预览图片的urlpreloader.destroy();preloader = null;};preloader.load( file.getSource() );}}</script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br></pre></td><td class="code"><pre><span class="line">定义：css预处理器(以编程的方式书写css)</span><br><span class="line">关键知识点：</span><br><span class="line">变量、嵌套、运算、混入、继承、颜色处理、函数</span><br><span class="line">简单对比：</span><br><span class="line">Sass：使用ruby编写,so 在服务端进行编译</span><br><span class="line">Less：js编写,在浏览器端处理</span><br><span class="line">Scss格式编写css-----&#123;&#125;</span><br><span class="line"></span><br><span class="line">##SASS##</span><br><span class="line">安装：安装ruby</span><br><span class="line">**快速入门---理论知识**</span><br><span class="line"><span class="number">1.</span>在指定文件夹中创建demo.scss文本文件(@charset <span class="string">&quot;utf-8&quot;</span>:设置支持中文注释)。</span><br><span class="line"><span class="number">2.</span>命令行中：</span><br><span class="line">    sass demo.scss:css/demo.css</span><br><span class="line">    即可在指定的css文件中生成css样式表文件。</span><br><span class="line">    例如：E:\homework\sass\day01&gt;sass demo01.scss:css/demo05.css</span><br><span class="line"><span class="comment">//---------------------------</span></span><br><span class="line">**自动编译命令**</span><br><span class="line"><span class="number">1.</span> watch命令</span><br><span class="line">语法：sass --watch 要监听的目录：编译后的css文件的位置</span><br><span class="line">   sass --watch .:css中<span class="string">&quot;.&quot;</span>表示当前目录。</span><br><span class="line">   例如：E:\homework\sass\day01&gt;sass --watch .:css --style compact</span><br><span class="line">   自动编译所有sass文件。</span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line">**编译输出格式**</span><br><span class="line">nested:嵌套</span><br><span class="line">compact:紧凑--(常用)</span><br><span class="line">语法：sass --watch .:css --style compact</span><br><span class="line">expanded:扩展--完全标准化的格式(常用)</span><br><span class="line">语法：sass --watch .:css --style expanded</span><br><span class="line">compressed：压缩---一行,常用于在线项目的小文件。</span><br><span class="line">语法：sass --watch .:css --style compressed</span><br><span class="line"><span class="comment">//----------------------------------</span></span><br><span class="line">**sass扩展名**</span><br><span class="line">.sass(sass3<span class="number">.0</span>-版本)和.scss(sass3<span class="number">.0</span>+版本,常用)</span><br><span class="line"><span class="comment">//-----------------------------------</span></span><br><span class="line">SASS编程基础</span><br><span class="line"><span class="number">1.</span> 变量--variables</span><br><span class="line">    普通变量：</span><br><span class="line">    $fontSize:<span class="number">12</span>px;</span><br><span class="line">    body&#123;</span><br><span class="line">        font-<span class="keyword">size</span>: $fontSize;</span><br><span class="line">    &#125;</span><br><span class="line">    默认变量</span><br><span class="line">    $baseLineHeight:<span class="number">1.5</span> !<span class="keyword">default</span>;</span><br><span class="line">    body&#123;</span><br><span class="line">       $baseLineHeight:<span class="number">2</span>;  </span><br><span class="line">   div&#123;</span><br><span class="line">     line-height: $baseLineHeight; <span class="comment">//局部变量优先</span></span><br><span class="line">   &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    默认变量的覆盖，在默认变量前后，从新声明变量并赋值即可；默认变量是基于组件化开发的过程中，进行优化处理的</span><br><span class="line">    特殊变量：变量作为属性或其他情况下，必须使用#&#123;$variable&#125;的形式进行调用。</span><br><span class="line">    $borderDirection:top !<span class="keyword">default</span>;</span><br><span class="line">    $baseFontSize:<span class="number">16</span>px;</span><br><span class="line">    $baseLineHeight:<span class="number">1.5</span>; <span class="comment">//设置1.5倍的行高!!!</span></span><br><span class="line">    #top_nav&#123;</span><br><span class="line">        border-#&#123;$borderDirection&#125;:<span class="number">1</span>px solid #ccc;</span><br><span class="line">    &#125;  </span><br><span class="line">    body&#123; font:#&#123;$baseFontSize&#125;/#&#123;$baseLineHeight&#125; &#125;</span><br><span class="line">    全局变量：在变量后面增加[!<span class="keyword">global</span>]即可声明全局变量。</span><br><span class="line">    <span class="comment">//-------------------------------------------------</span></span><br><span class="line">    <span class="number">1.</span> 嵌套</span><br><span class="line">        选择器嵌套(推荐)</span><br><span class="line">        例如：demo.scss </span><br><span class="line">        #top_nav&#123;</span><br><span class="line">            font-<span class="keyword">size</span>:<span class="number">16</span>px;</span><br><span class="line">            li&#123;</span><br><span class="line">                width: <span class="number">100</span>px;</span><br><span class="line">                list-style:none;</span><br><span class="line">            &#125;</span><br><span class="line">            a&#123;</span><br><span class="line">                display: block;</span><br><span class="line">                &amp;:hover&#123;     <span class="comment">// 伪类嵌套</span></span><br><span class="line">                    <span class="keyword">color</span>:#ddd;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        属性嵌套(不常用):某些属性拥有同样的单词开头。</span><br><span class="line">        例如：demo.scss</span><br><span class="line">        #top_nav_li&#123;</span><br><span class="line">            border:&#123;</span><br><span class="line">                style:solid;</span><br><span class="line">                left&#123;</span><br><span class="line">                    width:<span class="number">4</span>px;</span><br><span class="line">                    <span class="keyword">color</span>:#ccc;</span><br><span class="line">                &#125;</span><br><span class="line">                right&#123;</span><br><span class="line">                    width:<span class="number">2</span>px;</span><br><span class="line">                    <span class="keyword">color</span>:#e8e8e8;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      伪元素嵌套--清除浮动最常用的方法</span><br><span class="line">.clearfix&#123;</span><br><span class="line">    *zoom:<span class="number">1</span>;</span><br><span class="line">    &amp;:after&#123;</span><br><span class="line">        <span class="keyword">clear</span>:both;</span><br><span class="line">        content:<span class="string">&quot;&quot;</span>;</span><br><span class="line">        display:block;</span><br><span class="line">        height:<span class="number">0</span>;</span><br><span class="line">        visibility:hidden;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------</span></span><br><span class="line">Partials &amp;&amp; @import</span><br><span class="line">Partials(小部分)：命名规范<span class="string">&quot;以下划线开头&quot;</span>，这样的scss文件不会被编译成css文件。</span><br><span class="line">Partials是用来定义公共样式或者组件样式的。专门用于被其他scss文件import进行使用的。</span><br><span class="line">    例如：_base.scss</span><br><span class="line">    *&#123; margin: <span class="number">0</span>;padding: <span class="number">0</span>;&#125;_</span><br><span class="line">    在其他scss文件中引入该_base.scss文件 </span><br><span class="line">    @import <span class="string">&quot;base&quot;</span>;_</span><br><span class="line">    div.box&#123; font-<span class="keyword">size</span>:<span class="number">12</span>px;&#125;</span><br><span class="line"><span class="comment">//-----------------------------------------------</span></span><br><span class="line">**注释**</span><br><span class="line">  多行：在编译出的css文件中会保留，压缩输出格式中不会被保留</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 多行注释</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  单行：在输出css文件时不保留</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  强制注释：在多行注释的开头添加感叹号！表示强制保留</span><br><span class="line">  <span class="comment">/*!</span></span><br><span class="line"><span class="comment">   * 强制注释 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">//------------------------------------------------</span></span><br><span class="line">**SASS** </span><br><span class="line">  sass支持其中七种主要数据类型</span><br><span class="line"> <span class="number">1</span> 数字(例如： <span class="number">1.2</span>, <span class="number">13</span>, <span class="number">10</span>px)</span><br><span class="line"><span class="number">2</span> 字符串(例如：<span class="string">&quot;foo&quot;</span>, <span class="string">&#x27;bar&#x27;</span>, baz)</span><br><span class="line"><span class="number">3</span> 颜色(例如：blue, #<span class="number">04</span>a3f9, rgba(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>))</span><br><span class="line"><span class="number">4</span> 布尔值(例如： true, false)</span><br><span class="line"><span class="number">5</span> 空值(例如： null)</span><br><span class="line"><span class="number">6</span> 列表(list)， 用空格或逗号分隔 (例如： <span class="number">1.5</span>em <span class="number">1</span>em <span class="number">0</span> <span class="number">2</span>em, Helvetica, Arial,</span><br><span class="line">sans-serif)</span><br><span class="line"><span class="number">7</span> 映射(例如： (key1: value1, key2: value2))</span><br><span class="line"><span class="comment">//-------------------------------------</span></span><br><span class="line">**SASS** </span><br><span class="line"><span class="number">1.</span> sass中对数字进行运算，同时支持数字函数运算</span><br><span class="line">    sass -i;(<span class="string">&#x27;+&#x27;</span> , <span class="string">&#x27;-&#x27;</span> , <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)--进行运算的属性值,单位必须相同</span><br><span class="line"><span class="number">2.</span> 支持字符串操作(+、-、/等连接)</span><br><span class="line">    <span class="string">&#x27;study &#x27;</span> + <span class="string">&#x27;hard&#x27;</span>   ---&gt; <span class="string">&#x27;study hard&#x27;</span></span><br><span class="line">    <span class="string">&#x27;study &#x27;</span> + hard   ---&gt; <span class="string">&#x27;study hard&#x27;</span></span><br><span class="line">     study + <span class="string">&#x27;hard&#x27;</span>   ---&gt; study hard   ---无引号的字符串</span><br><span class="line"><span class="number">3.</span> 支持字符串函数：</span><br><span class="line">    $greeting:<span class="string">&quot;hello sass&quot;</span>;</span><br><span class="line">    to-upper-<span class="keyword">case</span>($greeting)、str-length、</span><br><span class="line">    str-index($greeting,<span class="string">&quot;sass&quot;</span>)----结果：<span class="number">7</span>？？？</span><br><span class="line"><span class="number">4.</span> 颜色----颜色函数  adjust-hue</span><br><span class="line">    Eg:div&#123; <span class="keyword">color</span>:(#<span class="number">010203</span> + #<span class="number">040506</span>);&#125;----div&#123; <span class="keyword">color</span>:#<span class="number">050709</span>;&#125;</span><br><span class="line">    rgb &amp; rgba:红、绿、蓝、透明度</span><br><span class="line">    如：background-<span class="keyword">color</span>:rgba(<span class="number">255</span>,<span class="number">193</span>,<span class="number">50</span>);</span><br><span class="line">    hsl &amp; hsla:色相、饱和度、明度、透明度--工业界颜色标准</span><br><span class="line">    如：background-<span class="keyword">color</span>:hsl(<span class="number">38</span>,<span class="number">100</span>%,<span class="number">76</span>%)</span><br><span class="line">    函数：</span><br><span class="line">    @ adjust-hue(要调整的颜色，调整的值)--H:色相修改</span><br><span class="line">    @ lighten(变亮) &amp; darken(变暗)--明度修改</span><br><span class="line">    $base-<span class="keyword">color</span>:#<span class="number">888</span>;</span><br><span class="line">    $light-<span class="keyword">color</span>:lighten($base-<span class="keyword">color</span>,<span class="number">20</span>%);</span><br><span class="line">    $light-<span class="keyword">color</span>:darken($base-<span class="keyword">color</span>,<span class="number">20</span>%);</span><br><span class="line">    @ saturate(饱和) &amp; desatruate(不饱和)--饱和度修改</span><br><span class="line">    $base-<span class="keyword">color</span>:hsl(<span class="number">221</span>,<span class="number">50</span>%,<span class="number">50</span>%);</span><br><span class="line">    $saturate-<span class="keyword">color</span>:saturate($base-<span class="keyword">color</span>,<span class="number">20</span>%);</span><br><span class="line">    $saturate-<span class="keyword">color</span>:desatruate($base-<span class="keyword">color</span>,<span class="number">20</span>%);</span><br><span class="line">    @ opacity &amp; transparentize</span><br><span class="line">    opacity():加深透明度</span><br><span class="line">    transparentize():降低透明度</span><br><span class="line"><span class="number">5.</span> 列表</span><br><span class="line">    List表示列表类型的值，在css中就是表示属性的一串值。列表中的值可以使用空格或逗号分隔。</span><br><span class="line">    语法：$列表名:值<span class="number">1</span>,值<span class="number">2</span></span><br><span class="line">    $border:#ccc solid <span class="number">1</span>px;  值就是列表</span><br><span class="line">    列表可以包含其他的列表</span><br><span class="line">    padding:<span class="number">10</span>px <span class="number">5</span>px,<span class="number">5</span>px <span class="number">5</span>px;值的列表中有两个列表，用逗号分隔。</span><br><span class="line">    padding:(<span class="number">10</span>px <span class="number">5</span>px) (<span class="number">5</span>px <span class="number">5</span>px);可以用括号分开，编译成css时会去掉这些括号。</span><br><span class="line">列表函数</span><br><span class="line">sass中的列表相当于其他语言中的数组。   </span><br><span class="line">具体参考API</span><br><span class="line"><span class="number">6.</span> map 和相关函数</span><br><span class="line">map 就是列表项目中带名称的列表</span><br><span class="line">$map：(key1:value1, key2:value2, key3:value3)</span><br><span class="line">  $var(key1:value1, key2:value2..):声明一个 Map</span><br><span class="line">  length($map):获取 map 中的元素对个数</span><br><span class="line">  map-get($map, key):获取$map 中名称为 key 的值</span><br><span class="line">  map-keys($map):获取指定$map 中所有的 key</span><br><span class="line">  map-values($map):获取指定$map 中所有的 value</span><br><span class="line">  map-has-key($map, key):判断在$map 中是否包含指定的 key</span><br><span class="line">  map-merge($map1, $map2):将$map1 和$map2 合并在一起</span><br><span class="line">  map-remove($map, key):将指定名称的 key 从$map 中移除</span><br><span class="line"><span class="number">7.</span> 布尔值</span><br><span class="line">    用来表示真/假的判断。</span><br><span class="line"><span class="number">8.</span> interpolation---插值</span><br><span class="line">    可以将一个值插入到另一个值中。</span><br><span class="line">    sass中可以将表达式放在#&#123;$variable&#125;中，用于使用变量的值。</span><br><span class="line">    $name:<span class="string">&quot;info&quot;</span>;</span><br><span class="line">    $attr:<span class="string">&quot;border&quot;</span>;</span><br><span class="line">    .alert-#&#123;$name&#125;&#123;</span><br><span class="line">    #&#123;$attr&#125;-<span class="keyword">color</span>:#ccc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">9.</span> 控制指令---<span class="keyword">control</span> Directives</span><br><span class="line">    满足某些条件时使用指定的样式。</span><br><span class="line">    <span class="number">1</span> $use-prefixes:true;</span><br><span class="line">    $theme:<span class="string">&quot;dark&quot;</span></span><br><span class="line">    body&#123;</span><br><span class="line">        @if $theme==dark&#123;</span><br><span class="line">            background-<span class="keyword">color</span>:#fff;</span><br><span class="line">        &#125; @else <span class="keyword">if</span> $theme==light&#123;</span><br><span class="line">            background-<span class="keyword">color</span>:#<span class="number">000</span>;</span><br><span class="line">        &#125; @else&#123;</span><br><span class="line">            background-<span class="keyword">color</span>:#ccc; </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">2</span> @for指令用于重复处理一组指令</span><br><span class="line">      @for $var from &lt;开始值&gt; through &lt;结束值&gt;   <span class="comment">// 包括结束值</span></span><br><span class="line">      @for $var from &lt;start&gt; to &lt;end&gt;          <span class="comment">// 不包括结束值</span></span><br><span class="line">      to 和 through 都是表示一个区间，唯一的区别就是停止循环的地方不一样。$var 可以是任意一个变量名称如$i，&lt;start&gt;和&lt;end&gt;是 SASS 表达式并且必须是整数</span><br><span class="line">      $columns:<span class="number">4</span>;</span><br><span class="line">      @for $i from <span class="number">1</span> through $columns&#123;</span><br><span class="line">            .col-#&#123;$i&#125;&#123;</span><br><span class="line">                width:<span class="number">100</span>%/$columns *$i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">3</span> @each 在 Sass 中主要被用来进行列表或者映射数据的循环</span><br><span class="line">主要表示形式：@each $var <span class="keyword">in</span> &lt;list&gt;</span><br><span class="line">$var 可以是任意变量名称，&lt;list&gt;是 SASS 表达式并且必须是 list</span><br><span class="line">    $icons:success <span class="keyword">error</span> <span class="keyword">warning</span>;</span><br><span class="line">    @each $icon <span class="keyword">in</span> $icons&#123;</span><br><span class="line">        .icon-#&#123;$icon&#125;&#123;</span><br><span class="line">            background-images:url(../images/icons/#&#123;$icon&#125;.png);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">4</span> @while 指令在 SASS 中用于循环重复处理样式，直到@while 表达式返回 false</span><br><span class="line">        $i:<span class="number">6</span>;</span><br><span class="line">        @while $i&gt;<span class="number">0</span>&#123;</span><br><span class="line">            .item-#&#123;#$i&#125;&#123; width:<span class="number">2</span>em*$i; &#125;</span><br><span class="line">            $i:$i<span class="number">-2</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="number">10.</span> Sass代码重用</span><br><span class="line"><span class="number">1.</span>继承扩展---inheritance(@extend)**---编译结果包含基类</span><br><span class="line">作用：减少重复代码</span><br><span class="line">注意：继承某个样式时也会继承某个样式的扩展(@extend)</span><br><span class="line">.btn&#123;</span><br><span class="line">    padding:<span class="number">6</span>px <span class="number">10</span>px;</span><br><span class="line">    border:<span class="number">1</span>px solid silver;</span><br><span class="line">    font-<span class="keyword">size</span>:<span class="number">14</span>px;</span><br><span class="line">&#125;</span><br><span class="line">.btn-primary&#123;</span><br><span class="line">    @extend .btn;</span><br><span class="line">    <span class="keyword">color</span>:white;</span><br><span class="line">    background-<span class="keyword">color</span>:red;</span><br><span class="line">&#125;</span><br><span class="line">编译结果: .btn, .btn-primary&#123;    </span><br><span class="line">    padding: <span class="number">6</span>px <span class="number">10</span>px;</span><br><span class="line">    border: <span class="number">1</span>px solid silver;</span><br><span class="line">    font-<span class="keyword">size</span>: <span class="number">14</span>px;</span><br><span class="line">&#125;</span><br><span class="line">.btn-primary&#123;</span><br><span class="line">    <span class="keyword">color</span>: white;</span><br><span class="line">    background-<span class="keyword">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">2.</span>占位符%placeholder---编译结果不包含基类</span><br><span class="line">%btn&#123;</span><br><span class="line">    padding:<span class="number">6</span>px <span class="number">10</span>px;</span><br><span class="line">    border:<span class="number">1</span>px solid silver;</span><br><span class="line">    font-<span class="keyword">size</span>:<span class="number">14</span>px;</span><br><span class="line">&#125;</span><br><span class="line">.btn-primary&#123;</span><br><span class="line">    @extend %btn;   <span class="comment">// 配合继承和占位符来实现去掉基类</span></span><br><span class="line">    <span class="keyword">color</span>:white;</span><br><span class="line">    background-<span class="keyword">color</span>:red;</span><br><span class="line">&#125;</span><br><span class="line">编译结果: .btn-primary&#123;    </span><br><span class="line">    padding: <span class="number">6</span>px <span class="number">10</span>px;</span><br><span class="line">    border: <span class="number">1</span>px solid silver;</span><br><span class="line">    font-<span class="keyword">size</span>: <span class="number">14</span>px;</span><br><span class="line">    <span class="keyword">color</span>: white;</span><br><span class="line">    background-<span class="keyword">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">3.</span>**混合--Mixin**</span><br><span class="line">sass中可以通过@mixin声明混合，可以传递参数，参数名称以$开始，多个参数之间用逗号分隔，@mixin的混合代码块由@include来调用。</span><br><span class="line">宏：可重用的代码块</span><br><span class="line">多参数混合</span><br><span class="line">@mixin horizontal-line($border:<span class="number">1</span>px dashed #ccc,$padding:<span class="number">10</span>px)&#123;   <span class="comment">// 定义 ---可重用的代码块</span></span><br><span class="line">    border-bottom:$border;</span><br><span class="line">    border-top:$padding;</span><br><span class="line">    border-bottom:$padding;</span><br><span class="line">&#125;</span><br><span class="line">div.top_nav&#123;@include horizontal-line(<span class="number">1</span>px solid #ccc)&#125;   <span class="comment">// 调用</span></span><br><span class="line">.top_nav li&#123;@include horizontal-line($padding: <span class="number">15</span>px)&#125;</span><br><span class="line">实际开发中继承(@extend %placeholder)  与 混合宏的使用及比较：</span><br><span class="line">（<span class="number">1</span>）继承和混合宏都能实现相同代码块的重用，极大提高开发效率;</span><br><span class="line">（<span class="number">2</span>）继承的使用一般不存在代码冗余，而混合宏的使用会存在代码冗余;  原因：@include 引入代码块</span><br><span class="line">（<span class="number">3</span>）继承不可以传递参数，而混合宏可以传递参数;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line">用户自定义函数---function</span><br><span class="line">将一些值交给函数进行处理，具体的处理方式由定义的函数具体的设定确定。</span><br><span class="line">    语法：</span><br><span class="line">    @function 函数名称(参数列表)&#123;</span><br><span class="line">        <span class="comment">//数据处理</span></span><br><span class="line">    &#125;</span><br><span class="line">    如： </span><br><span class="line">    $colors:(light:#ffffff,dark:#<span class="number">000000</span>);</span><br><span class="line">    @function <span class="keyword">color</span>($key)&#123;</span><br><span class="line">        @return map-get($colors,$key);    </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//----------------------------------------------</span></span><br><span class="line">   警告 VS 错误</span><br><span class="line">在自己设计的函数或者 Mixin 中，可以包含一些警告或者错误提示信息，用户在错误使用</span><br><span class="line">函数或者 mixin 时，就会看到这样的错误提示。</span><br><span class="line"> @warn:警告信息——会出现在命令行窗口中，编译提示</span><br><span class="line"> @error:错误信息——会出现在编译后的 css 文件中，错误提示</span><br><span class="line">@warn message; 警告信息，警告信息一般会在执行 scss 程序生成 css 时触发，所以</span><br><span class="line">出现在命令行中。</span><br><span class="line">@error message; 错误信息，错误信息直接显示在编译的 css 文件中。</span><br><span class="line">如： </span><br><span class="line">$colors:(light:#ffffff,dark:#<span class="number">000000</span>);</span><br><span class="line">@function <span class="keyword">color</span>($key)&#123;</span><br><span class="line">  @if not map-has-key($colors,$key)&#123;</span><br><span class="line">    @warn <span class="string">&quot;在$colors 里没有找到 #&#123;$key&#125; 这个key&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  @return map-get($colors,$key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>什么是声明语句?什么是声明文件？如何书写声明文件？如何声明文件中的依赖？如何发布声明文件？如何拆分声明文件？</p><h1>声明文件</h1><p>当使用第三方库时，我们需要引用它的声明文件，才能获得对应的代码补全、接口提示等功能。</p><h2 id="新语法索">新语法索</h2><p>由于本章涉及大量新语法，故在本章开头列出新语法的索引，方便大家在使用这些新语法时能快速查找到对应的讲解：</p><ul><li><a href="#declare-var"><code>declare var</code></a> 声明全局变量</li><li><a href="#declare-function"><code>declare function</code></a> 声明全局方法</li><li><a href="#declare-class"><code>declare class</code></a> 声明全局类</li><li><a href="#declare-enum"><code>declare enum</code></a> 声明全局枚举类型</li><li><a href="#declare-namespace"><code>declare namespace</code></a> 声明（含有子属性的）全局对象</li><li><a href="#interface-%E5%92%8C-type"><code>interface</code> 和 <code>type</code></a> 声明全局类型</li><li><a href="#export"><code>export</code></a> 导出变量</li><li><a href="#export-namespace"><code>export namespace</code></a> 导出（含有子属性的）对象</li><li><a href="#export-default"><code>export default</code></a> ES6 默认导出</li><li><a href="#export-1"><code>export =</code></a> commonjs 导出模块</li><li><a href="#export-as-namespace"><code>export as namespace</code></a> UMD 库声明全局变量</li><li><a href="#declare-global"><code>declare global</code></a> 扩展全局变量</li><li><a href="#declare-module"><code>declare module</code></a> 扩展模块</li><li><a href="#san-xie-xian-zhi-ling"><code>/// &lt;reference /&gt;</code></a> 三斜线指令</li></ul><h2 id="什么是声明语句">什么是声明语句</h2><p>假如我们想使用第三方库 jQuery，一种常见的方式是在 html 中通过 <code>&lt;script&gt;</code> 标签引入 jQuery，然后就可以使用全局变量 <code>$</code> 或 <code>jQuery</code> 了。</p><p>我们通常这样获取一个 <code>id</code> 是 <code>foo</code> 的元素：</p><p>$(‘#foo’);// orjQuery(‘#foo’);</p><p>但是在 ts 中，编译器并不知道 <code>$</code> 或 <code>jQuery</code> 是什么东西<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/01-jquery">1</a>：</p><p>jQuery(‘#foo’);// ERROR: Cannot find name ‘jQuery’.</p><p>这时，我们需要使用 <code>declare var</code> 来定义它的类型<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/02-declare-var">2</a>：</p><p>declare var jQuery: (selector: string) =&gt; any;jQuery(‘#foo’);</p><p>上例中，<code>declare var</code> 并没有真的定义一个变量，只是定义了全局变量 <code>jQuery</code> 的类型，仅仅会用于编译时的检查，在编译结果中会被删除。它编译结果是：</p><p>jQuery(‘#foo’);</p><p>除了 <code>declare var</code> 之外，还有其他很多种声明语句，将会在后面详细介绍。</p><h2 id="什么是声明文件">什么是声明文件</h2><p>通常我们会把声明语句放到一个单独的文件（<code>jQuery.d.ts</code>）中，这就是声明文件<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/03-jquery-d-ts">3</a>：</p><p>// src/jQuery.d.ts<br>declare var jQuery: (selector: string) =&gt; any;<br>// src/index.ts<br>jQuery(‘#foo’);</p><p>声明文件必需以 <code>.d.ts</code> 为后缀。</p><p>一般来说，ts 会解析项目中所有的 <code>*.ts</code> 文件，当然也包含以 <code>.d.ts</code> 结尾的文件。所以当我们将 <code>jQuery.d.ts</code> 放到项目中时，其他所有 <code>*.ts</code> 文件就都可以获得 <code>jQuery</code> 的类型定义了。</p><p>/path/to/project<br>├── src<br>|  ├── index.ts<br>|  └── jQuery.d.ts<br>└── tsconfig.json</p><p>假如仍然无法解析，那么可以检查下 <code>tsconfig.json</code> 中的 <code>files</code>、<code>include</code> 和 <code>exclude</code> 配置，确保其包含了 <code>jQuery.d.ts</code> 文件。</p><p>这里只演示了全局变量这种模式的声明文件，假如是通过模块导入的方式使用第三方库的话，那么引入声明文件又是另一种方式了，将会在后面详细介绍。</p><h3 id="第三方声明文件">第三方声明文件</h3><p>当然，jQuery 的声明文件不需要我们定义了，社区已经帮我们定义好了：<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/jquery/index.d.ts">jQuery in DefinitelyTyped</a>。</p><p>我们可以直接下载下来使用，但是更推荐的是使用 <code>@types</code> 统一管理第三方库的声明文件。</p><p><code>@types</code> 的使用方式很简单，直接用 npm 安装对应的声明模块即可，以 jQuery 举例：</p><p>npm install @types/jquery --save-dev</p><p>可以在<a href="https://microsoft.github.io/TypeSearch/">这个页面</a>搜索你需要的声明文件。</p><h2 id="书写声明文件-a-class-“anchor”">书写声明文件&lt;a class=“anchor”</h2><p>当一个第三方库没有提供声明文件时，我们就需要自己书写声明文件了。前面只介绍了最简单的声明文件内容，而真正书写一个声明文件并不是一件简单的事，以下会详细介绍如何书写声明文件。</p><p>在不同的场景下，声明文件的内容和使用方式会有所区别。</p><p>库的使用场景主要有以下几种：</p><ul><li><a href="#quan-ju-bian-liang">全局变量</a>：通过 <code>&lt;script&gt;</code> 标签引入第三方库，注入全局变量</li><li><a href="#npm-bao">npm 包</a>：通过 <code>import foo from 'foo'</code> 导入，符合 ES6 模块规范</li><li><a href="#umd-ku">UMD 库</a>：既可以通过 <code>&lt;script&gt;</code> 标签引入，又可以通过 <code>import</code> 导入</li><li><a href="#zhi-jie-kuo-zhan-quan-ju-bian-liang">直接扩展全局变量</a>：通过 <code>&lt;script&gt;</code> 标签引入后，改变一个全局变量的结构</li><li><a href="#zai-npm-bao-huo-umd-ku-zhong-kuo-zhan-quan-ju-bian-liang">在 npm 包或 UMD 库中扩展全局变量</a>：引用 npm 包或 UMD 库后，改变一个全局变量的结构</li><li><a href="#mo-kuai-cha-jian">模块插件</a>：通过 <code>&lt;script&gt;</code> 或 <code>import</code> 导入后，改变另一个模块的结构</li></ul><h3 id="全局变量">全局变量</h3><p>全局变量是最简单的一种场景，之前举的例子就是通过 <code>&lt;script&gt;</code> 标签引入 jQuery，注入全局变量 <code>$</code> 和 <code>jQuery</code>。</p><p>使用全局变量的声明文件时，如果是以 <code>npm install @types/xxx --save-dev</code> 安装的，则不需要任何配置。如果是将声明文件直接存放于当前项目中，则建议和其他源码一起放到 <code>src</code> 目录下（或者对应的源码目录下）：</p><p>/path/to/project<br>├── src<br>|  ├── index.ts<br>|  └── jQuery.d.ts<br>└── tsconfig.json</p><p>如果没有生效，可以检查下 <code>tsconfig.json</code> 中的 <code>files</code>、<code>include</code> 和 <code>exclude</code> 配置，确保其包含了 <code>jQuery.d.ts</code> 文件。</p><p>全局变量的声明文件主要有以下几种语法：</p><ul><li><a href="#declare-var"><code>declare var</code></a> 声明全局变量</li><li><a href="#declare-function"><code>declare function</code></a> 声明全局方法</li><li><a href="#declare-class"><code>declare class</code></a> 声明全局类</li><li><a href="#declare-enum"><code>declare enum</code></a> 声明全局枚举类型</li><li><a href="#declare-namespace"><code>declare namespace</code></a> 声明（含有子属性的）全局对象</li><li><a href="#interface-he-type"><code>interface</code> 和 <code>type</code></a> 声明全局类型</li></ul><h4 id="declare-var§"><code>declare var</code><a href="#declare-var">§</a></h4><p>在所有的声明语句中，<code>declare var</code> 是最简单的，如之前所学，它能够用来定义一个全局变量的类型。与其类似的，还有 <code>declare let</code> 和 <code>declare const</code>，使用 <code>let</code> 与使用 <code>var</code> 没有什么区别：</p><p>// src/jQuery.d.ts<br>declare let jQuery: (selector: string) =&gt; any;<br>// src/index.ts<br>jQuery(‘#foo’);<br>//  使用  declare let  定义的  jQuery  类型，允许修改这个全局变量<br>jQuery = function(selector) {<br>    return document.querySelector(selector);<br>};</p><p>而当我们使用 <code>const</code> 定义时，表示此时的全局变量是一个常量，不允许再去修改它的值了<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/04-declare-const-jquery">4</a>：</p><p>// src/jQuery.d.ts<br>declare const jQuery: (selector: string) =&gt; any;<br>jQuery(‘#foo’);<br>//  使用  declare const  定义的  jQuery  类型，禁止修改这个全局变量<br>jQuery = function(selector) {<br>    return document.querySelector(selector);<br>};<br>// ERROR: Cannot assign to ‘jQuery’ because it is a constant or a read-only property.</p><p>一般来说，全局变量都是禁止修改的常量，所以大部分情况都应该使用 <code>const</code> 而不是 <code>var</code> 或 <code>let</code>。</p><p>需要注意的是，声明语句中只能定义类型，切勿在声明语句中定义具体的实现<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/05-declare-jquery-value">5</a>：</p><p>declare const jQuery = function(selector) {<br>    return document.querySelector(selector);<br>};<br>// ERROR: An implementation cannot be declared in ambient contexts.</p><h4 id="declare-function"><code>declare function</code></h4><p><code>declare function</code> 用来定义全局函数的类型。jQuery 其实就是一个函数，所以也可以用 <code>function</code> 来定义：</p><p>// src/jQuery.d.ts<br>declare function jQuery(selector: string): any;<br>// src/index.ts<br>jQuery(‘#foo’);</p><p>在函数类型的声明语句中，函数重载也是支持的<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/06-declare-function">6</a>：</p><p>// src/jQuery.d.ts<br>declare function jQuery(selector: string): any;<br>declare function jQuery(domReadyCallback: () =&gt; any): any;<br>// src/index.ts<br>jQuery(‘#foo’);<br>jQuery(function() {<br>    alert(‘Dom Ready!’);<br>});</p><h4 id="declare-class"><code>declare class</code></h4><p>当全局变量是一个类的时候，我们用 <code>declare class</code> 来定义它的类型<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/07-declare-class">7</a>：</p><p>// src/Animal.d.ts<br>declare class Animal {<br>    name: string;<br>    constructor(name: string);<br>    sayHi(): string;<br>}<br>// src/index.ts<br>let cat = new Animal(‘Tom’);</p><p>同样的，<code>declare class</code> 语句也只能用来定义类型，不能用来定义具体的实现，比如定义 <code>sayHi</code> 方法的具体实现则会报错：</p><p>// src/Animal.d.ts</p><p>declare class Animal {<br>    name: string;<br>    constructor(name: string);<br>    sayHi() {<br>        return `My name is ${<a href="http://this.name">this.name</a>}`;<br>    };<br>    // ERROR: An implementation cannot be declared in ambient contexts.<br>}</p><h4 id="declare-enum"><code>declare enum</code></h4><p>使用 <code>declare enum</code> 定义的枚举类型也称作外部枚举（Ambient Enums），举例如下<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/08-declare-enum">8</a>：</p><p>// src/Directions.d.ts<br>declare enum Directions {<br>    Up,<br>    Down,<br>    Left,<br>    Right<br>}<br>// src/index.ts<br>let directions = [Directions.Up, Directions.Down, Directions.Left, Directions.Right]</p><p>与其他全局变量的类型声明一致，<code>declare enum</code> 仅用来定义类型，而不是具体的值。</p><p><code>Directions.d.ts</code> 仅仅会用于编译时的检查，声明文件里的内容在编译结果中会被删除。它编译结果是：</p><p>var directions = [Directions.Up, Directions.Down, Directions.Left, Directions.Right];</p><p>其中 <code>Directions</code> 是由第三方库定义好的全局变量。</p><h4 id="declare-namespace"><code>declare namespace</code></h4><p><code>namespace</code> 是 ts 早期时为了解决模块化而创造的关键字，中文称为命名空间。</p><p>由于历史遗留原因，在早期还没有 ES6 的时候，ts 提供了一种模块化方案，使用 <code>module</code> 关键字表示内部模块。但由于后来 ES6 也使用了 <code>module</code> 关键字，ts 为了兼容 ES6，使用 <code>namespace</code> 替代了自己的 <code>module</code>，更名为命名空间。</p><p>随着 ES6 的广泛应用，现在已经不建议再使用 ts 中的 <code>namespace</code>，而推荐使用 ES6 的模块化方案了，故我们不再需要学习 <code>namespace</code> 的使用了。</p><p><code>namespace</code> 被淘汰了，但是在声明文件中，<code>declare namespace</code> 还是比较常用的，它用来表示全局变量是一个对象，包含很多子属性。</p><p>比如 <code>jQuery</code> 是一个全局变量，它是一个对象，提供了一个 <code>jQuery.ajax</code> 方法可以调用，那么我们就应该使用 <code>declare namespace jQuery</code> 来声明这个拥有多个子属性的全局变量。</p><p>// src/jQuery.d.ts<br>declare namespace jQuery {<br>    function ajax(url: string, settings?: any): void;<br>}<br>// src/index.ts<br>jQuery.ajax(‘/api/get_something’);</p><p>注意，在 <code>declare namespace</code> 内部，我们直接使用 <code>function ajax</code> 来声明函数，而不是使用 <code>declare function ajax</code>。类似的，也可以使用 <code>const</code>, <code>class</code>, <code>enum</code> 等语句<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/09-declare-namespace">9</a>：</p><p>// src/jQuery.d.ts<br>declare namespace jQuery {<br>    function ajax(url: string, settings?: any): void;<br>    const version: number;<br>    class Event {<br>        blur(eventType: EventType): void<br>    }<br>    enum EventType {<br>        CustomClick<br>    }<br>}<br>// src/index.ts<br>jQuery.ajax(‘/api/get_something’);<br>console.log(jQuery.version);<br>const e = new jQuery.Event();<br>e.blur(jQuery.EventType.CustomClick);</p><h5 id="嵌套的命名空间">嵌套的命名空间</h5><p>如果对象拥有深层的层级，则需要用嵌套的 <code>namespace</code> 来声明深层的属性的类型<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/10-declare-namespace-nesting">10</a>：</p><p>// src/jQuery.d.ts<br>declare namespace jQuery {<br>    function ajax(url: string, settings?: any): void;<br>    namespace fn {<br>        function extend(object: any): void;<br>    }<br>}<br>// src/index.ts<br>jQuery.ajax(‘/api/get_something’);<br>jQuery.fn.extend({<br>    check: function() {<br>        return this.each(function() {<br>            this.checked = true;<br>        });<br>    }<br>});</p><p>假如 <code>jQuery</code> 下仅有 <code>fn</code> 这一个属性（没有 <code>ajax</code> 等其他属性或方法），则可以不需要嵌套 <code>namespace</code><a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/11-declare-namespace-dot">11</a>：</p><p>// src/jQuery.d.ts<br>declare namespace jQuery.fn {<br>    function extend(object: any): void;<br>}<br>// src/index.ts<br>jQuery.fn.extend({<br>    check: function() {<br>        return this.each(function() {<br>            this.checked = true;<br>        });<br>    }<br>});</p><h4 id="interface-和-type"><code>interface</code> 和 <code>type</code></h4><p>除了全局变量之外，可能有一些类型我们也希望能暴露出来。在类型声明文件中，我们可以直接使用 <code>interface</code> 或 <code>type</code> 来声明一个全局的接口或类型<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/12-interface">12</a>：</p><p>// src/jQuery.d.ts<br>interface AjaxSettings {<br>    method?: ‘GET’ | ‘POST’<br>    data?: any;<br>}<br>declare namespace jQuery {<br>    function ajax(url: string, settings?: AjaxSettings): void;<br>}</p><p>这样的话，在其他文件中也可以使用这个接口或类型了：</p><p>// src/index.ts<br>let settings: AjaxSettings = {<br>    method: ‘POST’,<br>    data: {<br>        name: ‘foo’<br>    }<br>};<br>jQuery.ajax(‘/api/post_something’, settings);</p><p><code>type</code> 与 <code>interface</code> 类似，不再赘述。</p><h5 id="防止命名冲突">防止命名冲突</h5><p>暴露在最外层的 <code>interface</code> 或 <code>type</code> 会作为全局类型作用于整个项目中，我们应该尽可能的减少全局变量或全局类型的数量。故最好将他们放到 <code>namespace</code> 下<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/13-avoid-name-conflict">13</a>：</p><p>// src/jQuery.d.ts<br>declare namespace jQuery {<br>    interface AjaxSettings {<br>        method?: ‘GET’ | ‘POST’<br>        data?: any;<br>    }<br>    function ajax(url: string, settings?: AjaxSettings): void;<br>}</p><p>注意，在使用这个 <code>interface</code> 的时候，也应该加上 <code>jQuery</code> 前缀：</p><p>// src/index.ts<br>let settings: jQuery.AjaxSettings = {<br>    method: ‘POST’,<br>    data: {<br>        name: ‘foo’<br>    }<br>};<br>jQuery.ajax(‘/api/post_something’, settings);</p><h4 id="声明合并">声明合并</h4><p>假如 jQuery 既是一个函数，可以直接被调用 <code>jQuery('#foo')</code>，又是一个对象，拥有子属性 <code>jQuery.ajax()</code>（事实确实如此），那么我们可以组合多个声明语句，它们会不冲突的合并起来<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/14-declaration-merging">14</a>：</p><p>// src/jQuery.d.ts<br>declare function jQuery(selector: string): any;<br>declare namespace jQuery {<br>    function ajax(url: string, settings?: any): void;<br>}<br>// src/index.ts<br>jQuery(‘#foo’);<br>jQuery.ajax(‘/api/get_something’);</p><p>关于声明合并的更多用法，可以查看<a href="../advanced/declaration-merging.html">声明合并</a>章节。</p><h3 id="npm-包">npm 包</h3><p>一般我们通过 <code>import foo from 'foo'</code> 导入一个 npm 包，这是符合 ES6 模块规范的。</p><p>在我们尝试给一个 npm 包创建声明文件之前，需要先看看它的声明文件是否已经存在。一般来说，npm 包的声明文件可能存在于两个地方：</p><ol><li>与该 npm 包绑定在一起。判断依据是 <code>package.json</code> 中有 <code>types</code> 字段，或者有一个 <code>index.d.ts</code> 声明文件。这种模式不需要额外安装其他包，是最为推荐的，所以以后我们自己创建 npm 包的时候，最好也将声明文件与 npm 包绑定在一起。</li><li>发布到 <code>@types</code> 里。我们只需要尝试安装一下对应的 <code>@types</code> 包就知道是否存在该声明文件，安装命令是 <code>npm install @types/foo --save-dev</code>。这种模式一般是由于 npm 包的维护者没有提供声明文件，所以只能由其他人将声明文件发布到 <code>@types</code> 里了。</li></ol><p>假如以上两种方式都没有找到对应的声明文件，那么我们就需要自己为它写声明文件了。由于是通过 <code>import</code> 语句导入的模块，所以声明文件存放的位置也有所约束，一般有两种方案：</p><ol><li>创建一个 <code>node_modules/@types/foo/index.d.ts</code> 文件，存放 <code>foo</code> 模块的声明文件。这种方式不需要额外的配置，但是 <code>node_modules</code> 目录不稳定，代码也没有被保存到仓库中，无法回溯版本，有不小心被删除的风险，故不太建议用这种方案，一般只用作临时测试。</li><li>创建一个 <code>types</code> 目录，专门用来管理自己写的声明文件，将 <code>foo</code> 的声明文件放到 <code>types/foo/index.d.ts</code> 中。这种方式需要配置下 <code>tsconfig.json</code> 中的 <code>paths</code> 和 <code>baseUrl</code> 字段。</li></ol><p>目录结构：</p><p>/path/to/project<br>├── src<br>|  └── index.ts<br>├── types<br>|  └── foo<br>|     └── index.d.ts<br>└── tsconfig.json</p><p><code>tsconfig.json</code> 内容：</p><p>{<br>    “compilerOptions”: {<br>        “module”: “commonjs”,<br>        “baseUrl”: “./”,<br>        “paths”: {<br>            “<em>&quot;: [&quot;types/</em>”]<br>        }<br>    }<br>}</p><p>如此配置之后，通过 <code>import</code> 导入 <code>foo</code> 的时候，也会去 <code>types</code> 目录下寻找对应的模块的声明文件了。</p><p>注意 <code>module</code> 配置可以有很多种选项，不同的选项会影响模块的导入导出模式。这里我们使用了 <code>commonjs</code> 这个最常用的选项，后面的教程也都默认使用的这个选项。</p><p>不管采用了以上两种方式中的哪一种，我都<strong>强烈建议</strong>大家将书写好的声明文件（通过给第三方库发 pull request，或者直接提交到 <code>@types</code> 里）发布到开源社区中，享受了这么多社区的优秀的资源，就应该在力所能及的时候给出一些回馈。只有所有人都参与进来，才能让 ts 社区更加繁荣。</p><p>npm 包的声明文件主要有以下几种语法：</p><ul><li><a href="#export"><code>export</code></a> 导出变量</li><li><a href="#export-namespace"><code>export namespace</code></a> 导出（含有子属性的）对象</li><li><a href="#export-default"><code>export default</code></a> ES6 默认导出</li><li><a href="#export-1"><code>export =</code></a> commonjs 导出模块</li></ul><h4 id="export"><code>export</code></h4><p>npm 包的声明文件与全局变量的声明文件有很大区别。在 npm 包的声明文件中，使用 <code>declare</code> 不再会声明一个全局变量，而只会在当前文件中声明一个局部变量。只有在声明文件中使用 <code>export</code> 导出，然后在使用方 <code>import</code> 导入后，才会应用到这些类型声明。</p><p><code>export</code> 的语法与普通的 ts 中的语法类似，区别仅在于声明文件中禁止定义具体的实现<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/15-export">15</a>：</p><p>// types/foo/index.d.ts<br>export const name: string;<br>export function getName(): string;<br>export class Animal {<br>    constructor(name: string);<br>    sayHi(): string;<br>}<br>export enum Directions {<br>    Up,<br>    Down,<br>    Left,<br>    Right<br>}<br>export interface Options {<br>    data: any;<br>}</p><p>对应的导入和使用模块应该是这样：</p><p>// src/index.ts<br>import { name, getName, Animal, Directions, Options } from ‘foo’;<br>console.log(name);<br>let myName = getName();<br>let cat = new Animal(‘Tom’);<br>let directions = [Directions.Up, Directions.Down, Directions.Left, Directions.Right];<br>let options: Options = {<br>    data: {<br>        name: ‘foo’<br>    }<br>};</p><h5 id="混用-declare-和-export">混用 <code>declare</code> 和 <code>export</code></h5><p>我们也可以使用 <code>declare</code> 先声明多个变量，最后再用 <code>export</code> 一次性导出。上例的声明文件可以等价的改写为<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/16-declare-and-export">16</a>：</p><p>// types/foo/index.d.ts<br>declare const name: string;<br>declare function getName(): string;<br>declare class Animal {<br>    constructor(name: string);<br>    sayHi(): string;<br>}<br>declare enum Directions {<br>    Up,<br>    Down,<br>    Left,<br>    Right<br>}<br>interface Options {<br>    data: any;<br>}<br>export { name, getName, Animal, Directions, Options };</p><p>注意，与全局变量的声明文件类似，<code>interface</code> 前是不需要 <code>declare</code> 的。</p><h4 id="export-namespace"><code>export namespace</code></h4><p>与 <code>declare namespace</code> 类似，<code>export namespace</code> 用来导出一个拥有子属性的对象<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/17-export-namespace">17</a>：</p><p>// types/foo/index.d.ts<br>export namespace foo {<br>    const name: string;<br>    namespace bar {<br>        function baz(): string;<br>    }<br>}<br>// src/index.ts<br>import { foo } from ‘foo’;<br>console.log(<a href="http://foo.name">foo.name</a>);<br>foo.bar.baz();</p><h4 id="export-default"><code>export default</code></h4><p>在 ES6 模块系统中，使用 <code>export default</code> 可以导出一个默认值，使用方可以用 <code>import foo from 'foo'</code> 而不是 <code>import &#123; foo &#125; from 'foo'</code> 来导入这个默认值。</p><p>在类型声明文件中，<code>export default</code> 用来导出默认值的类型<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/18-export-default">18</a>：</p><p>// types/foo/index.d.ts<br>export default function foo(): string;<br>// src/index.ts<br>import foo from ‘foo’;<br>foo();</p><p>注意，只有 <code>function</code>、<code>class</code> 和 <code>interface</code> 可以直接默认导出，其他的变量需要先定义出来，再默认导出<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/19-export-default-enum-error">19</a>：</p><p>// types/foo/index.d.ts<br>export default enum Directions {<br>// ERROR: Expression expected.<br>    Up,<br>    Down,<br>    Left,<br>    Right<br>}</p><p>上例中 <code>export default enum</code> 是错误的语法，需要使用 <code>declare enum</code> 定义出来，然后使用 <code>export default</code> 导出：</p><p>// types/foo/index.d.ts<br>declare enum Directions {<br>    Up,<br>    Down,<br>    Left,<br>    Right<br>}<br>export default Directions;</p><p>针对这种默认导出，我们一般会将导出语句放在整个声明文件的最前面<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/20-export-default-enum">20</a>：</p><p>// types/foo/index.d.ts<br>export default Directions;<br>declare enum Directions {<br>    Up,<br>    Down,<br>    Left,<br>    Right<br>}</p><h4 id="export-2"><code>export =</code></h4><p>在 commonjs 规范中，我们用以下方式来导出一个模块：</p><p>//  整体导出<br>module.exports = foo;<br>//  单个导出<br>exports.bar = bar;</p><p>在 ts 中，针对这种模块导出，有多种方式可以导入，第一种方式是 <code>const ... = require</code>：</p><p>//  整体导入<br>const foo = require(‘foo’);<br>//  单个导入<br>const bar = require(‘foo’).bar;</p><p>第二种方式是 <code>import ... from</code>，注意针对整体导出，需要使用 <code>import * as</code> 来导入：</p><p>//  整体导入<br>import * as foo from ‘foo’;<br>//  单个导入<br>import { bar } from ‘foo’;</p><p>第三种方式是 <code>import ... require</code>，这也是 ts 官方推荐的方式：</p><p>//  整体导入<br>import foo = require(‘foo’);<br>//  单个导入<br>import bar = foo.bar;</p><p>对于这种使用 commonjs 规范的库，假如要为它写类型声明文件的话，就需要使用到 <code>export =</code> 这种语法了<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/21-export-equal">21</a>：</p><p>// types/foo/index.d.ts</p><p>export = foo;</p><p>declare function foo(): string;<br>declare namespace foo {<br>    const bar: number;<br>}</p><p>需要注意的是，上例中使用了 <code>export =</code> 之后，就不能再单个导出 <code>export &#123; bar &#125;</code> 了。所以我们通过声明合并，使用 <code>declare namespace foo</code> 来将 <code>bar</code> 合并到 <code>foo</code> 里。</p><p>准确地讲，<code>export =</code> 不仅可以用在声明文件中，也可以用在普通的 ts 文件中。实际上，<code>import ... require</code> 和 <code>export =</code> 都是 ts 为了兼容 AMD 规范和 commonjs 规范而创立的新语法，由于并不常用也不推荐使用，所以这里就不详细介绍了，感兴趣的可以看<a href="https://www.typescriptlang.org/docs/handbook/modules.html#export--and-import--require">官方文档</a>。</p><p>由于很多第三方库是 commonjs 规范的，所以声明文件也就不得不用到 <code>export =</code> 这种语法了。但是还是需要再强调下，相比与 <code>export =</code>，我们更推荐使用 ES6 标准的 <code>export default</code> 和 <code>export</code>。</p><h3 id="UMD-库">UMD 库</h3><p>既可以通过 <code>&lt;script&gt;</code> 标签引入，又可以通过 <code>import</code> 导入的库，称为 UMD 库。相比于 npm 包的类型声明文件，我们需要额外声明一个全局变量，为了实现这种方式，ts 提供了一个新语法 <code>export as namespace</code>。</p><h4 id="export-as-namespace"><code>export as namespace</code></h4><p>一般使用 <code>export as namespace</code> 时，都是先有了 npm 包的声明文件，再基于它添加一条 <code>export as namespace</code> 语句，即可将声明好的一个变量声明为全局变量，举例如下<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/22-export-as-namespace">22</a>：</p><p>// types/foo/index.d.ts<br>export as namespace foo;<br>export = foo;<br>declare function foo(): string;<br>declare namespace foo {<br>    const bar: number;<br>}</p><p>当然它也可以与 <code>export default</code> 一起使用：</p><p>// types/foo/index.d.ts<br>export as namespace foo;<br>export default foo;<br>declare function foo(): string;<br>declare namespace foo {<br>    const bar: number;<br>}</p><h3 id="直接扩展全局变量">直接扩展全局变量</h3><p>有的第三方库扩展了一个全局变量，可是此全局变量的类型却没有相应的更新过来，就会导致 ts 编译错误，此时就需要扩展全局变量的类型。比如扩展 <code>String</code> 类型<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/23-merge-global-interface">23</a>：</p><p>interface String {<br>    prependHello(): string;<br>}<br>‘foo’.prependHello();</p><p>通过声明合并，使用 <code>interface String</code> 即可给 <code>String</code> 添加属性或方法。</p><p>也可以使用 <code>declare namespace</code> 给已有的命名空间添加类型声明<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/24-merge-global-namespace">24</a>：</p><p>// types/jquery-plugin/index.d.ts<br>declare namespace JQuery {<br>    interface CustomOptions {<br>        bar: string;<br>    }<br>}<br>interface JQueryStatic {<br>    foo(options: JQuery.CustomOptions): string;<br>}<br>// src/index.ts<br>jQuery.foo({<br>    bar: ‘’<br>});</p><h3 id="在-npm-包或-UMD-库中扩展全局变量">在 npm 包或 UMD 库中扩展全局变量</h3><p>如之前所说，对于一个 npm 包或者 UMD 库的声明文件，只有 <code>export</code> 导出的类型声明才能被导入。所以对于 npm 包或 UMD 库，如果导入此库之后会扩展全局变量，则需要使用另一种语法在声明文件中扩展全局变量的类型，那就是 <code>declare global</code>。</p><h4 id="declare-global"><code>declare global</code></h4><p>使用 <code>declare global</code> 可以在 npm 包或者 UMD 库的声明文件中扩展全局变量的类型<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/25-declare-global">25</a>：</p><p>// types/foo/index.d.ts<br>declare global {<br>    interface String {<br>        prependHello(): string;<br>    }<br>}<br>export {};<br>// src/index.ts<br>‘bar’.prependHello();</p><p>注意即使此声明文件不需要导出任何东西，仍然需要导出一个空对象，用来告诉编译器这是一个模块的声明文件，而不是一个全局变量的声明文件。</p><h3 id="模块插件">模块插件</h3><p>有时通过 <code>import</code> 导入一个模块插件，可以改变另一个原有模块的结构。此时如果原有模块已经有了类型声明文件，而插件模块没有类型声明文件，就会导致类型不完整，缺少插件部分的类型。ts 提供了一个语法 <code>declare module</code>，它可以用来扩展原有模块的类型。</p><h4 id="declare-module"><code>declare module</code></h4><p>如果是需要扩展原有模块的话，需要在类型声明文件中先引用原有模块，再使用 <code>declare module</code> 扩展原有模块<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/26-declare-module">26</a>：</p><p>// types/moment-plugin/index.d.ts<br>import * as moment from ‘moment’;<br>declare module ‘moment’ {<br>    export function foo(): moment.CalendarKey;<br>}<br>// src/index.ts<br>import * as moment from ‘moment’;<br>import ‘moment-plugin’;<br>moment.foo();</p><p><code>declare module</code> 也可用于在一个文件中一次性声明多个模块的类型<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/27-multiple-declare-module">27</a>：</p><p>// types/foo-bar.d.ts<br>declare module ‘foo’ {<br>    export interface Foo {<br>        foo: string;<br>    }<br>}<br>declare module ‘bar’ {<br>    export function bar(): string;<br>}<br>// src/index.ts<br>import { Foo } from ‘foo’;<br>import * as bar from ‘bar’;<br>let f: Foo;<br>bar.bar();</p><h3 id="声明文件中的依赖">声明文件中的依赖</h3><p>一个声明文件有时会依赖另一个声明文件中的类型，比如在前面的 <code>declare module</code> 的例子中，我们就在声明文件中导入了 <code>moment</code>，并且使用了 <code>moment.CalendarKey</code> 这个类型：</p><p>// types/moment-plugin/index.d.ts<br>import * as moment from ‘moment’;<br>declare module ‘moment’ {<br>    export function foo(): moment.CalendarKey;<br>}</p><p>除了可以在声明文件中通过 <code>import</code> 导入另一个声明文件中的类型之外，还有一个语法也可以用来导入另一个声明文件，那就是三斜线指令。</p><h4 id="三斜线指令">三斜线指令</h4><p>与 <code>namespace</code> 类似，三斜线指令也是 ts 在早期版本中为了描述模块之间的依赖关系而创造的语法。随着 ES6 的广泛应用，现在已经不建议再使用 ts 中的三斜线指令来声明模块之间的依赖关系了。</p><p>但是在声明文件中，它还是有一定的用武之地。</p><p>类似于声明文件中的 <code>import</code>，它可以用来导入另一个声明文件。与 <code>import</code> 的区别是，当且仅当在以下几个场景下，我们才需要使用三斜线指令替代 <code>import</code>：</p><ul><li>当我们在<strong>书写</strong>一个全局变量的声明文件时</li><li>当我们需要<strong>依赖</strong>一个全局变量的声明文件时</li></ul><h5 id="书写一个全局变量的声明文件"><strong>书写</strong>一个全局变量的声明文件</h5><p>这些场景听上去很拗口，但实际上很好理解——在全局变量的声明文件中，是不允许出现 <code>import</code>, <code>export</code> 关键字的。一旦出现了，那么他就会被视为一个 npm 包或 UMD 库，就不再是全局变量的声明文件了。故当我们在书写一个全局变量的声明文件时，如果需要引用另一个库的类型，那么就必须用三斜线指令了<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/28-triple-slash-directives">28</a>：</p><p>// types/jquery-plugin/index.d.ts<br>/// <reference types="jquery" /><br>declare function foo(options: JQuery.AjaxSettings): string;<br>// src/index.ts<br>foo({});</p><p>三斜线指令的语法如上，<code>///</code> 后面使用 xml 的格式添加了对 <code>jquery</code> 类型的依赖，这样就可以在声明文件中使用 <code>JQuery.AjaxSettings</code> 类型了。</p><p>注意，三斜线指令必须放在文件的最顶端，三斜线指令的前面只允许出现单行或多行注释。</p><h5 id="依赖一个全局变量的声明文件"><strong>依赖</strong>一个全局变量的声明文件</h5><p>在另一个场景下，当我们需要依赖一个全局变量的声明文件时，由于全局变量不支持通过 <code>import</code> 导入，当然也就必须使用三斜线指令来引入了<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/29-triple-slash-directives-global">29</a>：</p><p>// types/node-plugin/index.d.ts<br>/// <reference types="node" /><br>export function foo(p: NodeJS.Process): string;<br>// src/index.ts<br>import { foo } from ‘node-plugin’;<br>foo(global.process);</p><p>在上面的例子中，我们通过三斜线指引入了 <code>node</code> 的类型，然后在声明文件中使用了 <code>NodeJS.Process</code> 这个类型。最后在使用到 <code>foo</code> 的时候，传入了 <code>node</code> 中的全局变量 <code>process</code>。</p><p>由于引入的 <code>node</code> 中的类型都是全局变量的类型，它们是没有办法通过 <code>import</code> 来导入的，所以这种场景下也只能通过三斜线指令来引入了。</p><p>以上两种使用场景下，都是由于需要书写或需要依赖全局变量的声明文件，所以必须使用三斜线指令。在其他的一些不是必要使用三斜线指令的情况下，就都需要使用 <code>import</code> 来导入。</p><h5 id="拆分声明文件">拆分声明文件</h5><p>当我们的全局变量的声明文件太大时，可以通过拆分为多个文件，然后在一个入口文件中将它们一一引入，来提高代码的可维护性。比如 <code>jQuery</code> 的声明文件就是这样的：</p><p>// node_modules/@types/jquery/index.d.ts</p><p>/// <reference types="sizzle" /><br>/// <reference path="JQueryStatic.d.ts" /><br>/// <reference path="JQuery.d.ts" /><br>/// <reference path="misc.d.ts" /><br>/// <reference path="legacy.d.ts" /></p><p>export = jQuery;</p><p>其中用到了 <code>types</code> 和 <code>path</code> 两种不同的指令。它们的区别是：<code>types</code> 用于声明对另一个库的依赖，而 <code>path</code> 用于声明对另一个文件的依赖。</p><p>上例中，<code>sizzle</code> 是与 <code>jquery</code> 平行的另一个库，所以需要使用 <code>types=&quot;sizzle&quot;</code> 来声明对它的依赖。而其他的三斜线指令就是将 <code>jquery</code> 的声明拆分到不同的文件中了，然后在这个入口文件中使用 <code>path=&quot;foo&quot;</code> 将它们一一引入。</p><h5 id="其他三斜线指令">其他三斜线指令</h5><p>除了这两种三斜线指令之外，还有其他的三斜线指令，比如 <code>/// &lt;reference no-default-lib=&quot;true&quot;/&gt;</code>, <code>/// &lt;amd-module /&gt;</code> 等，但它们都是废弃的语法，故这里就不介绍了，详情可见<a href="https://www.typescriptlang.org/docs/handbook/triple-slash-directives.html">官网</a>。</p><h3 id="自动生成声明文件">自动生成声明文件</h3><p>如果库的源码本身就是由 ts 写的，那么在使用 <code>tsc</code> 脚本将 ts 编译为 js 的时候，添加 <code>declaration</code> 选项，就可以同时也生成 <code>.d.ts</code> 声明文件了。</p><p>我们可以在命令行中添加 <code>--declaration</code>（简写 <code>-d</code>），或者在 <code>tsconfig.json</code> 中添加 <code>declaration</code> 选项。这里以 <code>tsconfig.json</code> 为例：</p><p>{<br>    “compilerOptions”: {<br>        “module”: “commonjs”,<br>        “outDir”: “lib”,<br>        “declaration”: true,<br>    }<br>}</p><p>上例中我们添加了 <code>outDir</code> 选项，将 ts 文件的编译结果输出到 <code>lib</code> 目录下，然后添加了 <code>declaration</code> 选项，设置为 <code>true</code>，表示将会由 ts 文件自动生成 <code>.d.ts</code> 声明文件，也会输出到 <code>lib</code> 目录下。</p><p>运行 <code>tsc</code> 之后，目录结构如下<a href="https://github.com/xcatliu/typescript-tutorial/tree/master/examples/declaration-files/30-auto-d-ts">30</a>：</p><p>/path/to/project<br>├── lib<br>|  ├── bar<br>|  |  ├── index.d.ts<br>|  |  └── index.js<br>|  ├── index.d.ts<br>|  └── index.js<br>├── src<br>|  ├── bar<br>|  |  └── index.ts<br>|  └── index.ts<br>├── package.json<br>└── tsconfig.json</p><p>在这个例子中，<code>src</code> 目录下有两个 ts 文件，分别是 <code>src/index.ts</code> 和 <code>src/bar/index.ts</code>，它们被编译到 <code>lib</code> 目录下的同时，也会生成对应的两个声明文件 <code>lib/index.d.ts</code> 和 <code>lib/bar/index.d.ts</code>。它们的内容分别是：</p><p>// src/index.ts<br>export * from ‘./bar’;<br>export default function foo() {<br>    return ‘foo’;<br>}<br>// src/bar/index.ts<br>export function bar() {<br>    return ‘bar’;<br>}<br>// lib/index.d.ts<br>export * from ‘./bar’;<br>export default function foo(): string;<br>// lib/bar/index.d.ts<br>export declare function bar(): string;</p><p>可见，自动生成的声明文件基本保持了源码的结构，而将具体实现去掉了，生成了对应的类型声明。</p><p>使用 <code>tsc</code> 自动生成声明文件时，每个 ts 文件都会对应一个 <code>.d.ts</code> 声明文件。这样的好处是，使用方不仅可以在使用 <code>import foo from 'foo'</code> 导入默认的模块时获得类型提示，还可以在使用 <code>import bar from 'foo/lib/bar'</code> 导入一个子模块时，也获得对应的类型提示。</p><p>除了 <code>declaration</code> 选项之外，还有几个选项也与自动生成声明文件有关，这里只简单列举出来，不做详细演示了：</p><ul><li><code>declarationDir</code> 设置生成 <code>.d.ts</code> 文件的目录</li><li><code>declarationMap</code> 对每个 <code>.d.ts</code> 文件，都生成对应的 <code>.d.ts.map</code>（sourcemap）文件</li><li><code>emitDeclarationOnly</code> 仅生成 <code>.d.ts</code> 文件，不生成 <code>.js</code> 文件</li></ul><h2 id="发布声明文件">发布声明文件</h2><p>当我们为一个库写好了声明文件之后，下一步就是将它发布出去了。</p><p>此时有两种方案：</p><ol><li>将声明文件和源码放在一起</li><li>将声明文件发布到 <code>@types</code> 下</li></ol><p>这两种方案中优先选择第一种方案。保持声明文件与源码在一起，使用时就不需要额外增加单独的声明文件库的依赖了，而且也能保证声明文件的版本与源码的版本保持一致。</p><p>仅当我们在给别人的仓库添加类型声明文件，但原作者不愿意合并 pull request 时，才需要使用第二种方案，将声明文件发布到 <code>@types</code> 下。</p><h3 id="将声明文件和源码放在一起">将声明文件和源码放在一起</h3><p>如果声明文件是通过 <code>tsc</code> 自动生成的，那么无需做任何其他配置，只需要把编译好的文件也发布到 npm 上，使用方就可以获取到类型提示了。</p><p>如果是手动写的声明文件，那么需要满足以下条件之一，才能被正确的识别：</p><ul><li>给 <code>package.json</code> 中的 <code>types</code> 或 <code>typings</code> 字段指定一个类型声明文件地址</li><li>在项目根目录下，编写一个 <code>index.d.ts</code> 文件</li><li>针对入口文件（<code>package.json</code> 中的 <code>main</code> 字段指定的入口文件），编写一个同名不同后缀的 <code>.d.ts</code> 文件</li></ul><p>第一种方式是给 <code>package.json</code> 中的 <code>types</code> 或 <code>typings</code> 字段指定一个类型声明文件地址。比如：</p><p>{<br>  “name”: “foo”,<br>  “version”: “1.0.0”,<br>  “main”: “lib/index.js”,<br>  “types”: “foo.d.ts”,<br>}</p><p>指定了 <code>types</code> 为 <code>foo.d.ts</code> 之后，导入此库的时候，就会去找 <code>foo.d.ts</code> 作为此库的类型声明文件了。</p><p><code>typings</code> 与 <code>types</code> 一样，只是另一种写法。</p><p>如果没有指定 <code>types</code> 或 <code>typings</code>，那么就会在根目录下寻找 <code>index.d.ts</code> 文件，将它视为此库的类型声明文件。</p><p>如果没有找到 <code>index.d.ts</code> 文件，那么就会寻找入口文件（<code>package.json</code> 中的 <code>main</code> 字段指定的入口文件）是否存在对应同名不同后缀的 <code>.d.ts</code> 文件。</p><p>比如 <code>package.json</code> 是这样时：</p><p>{<br>  “name”: “foo”,<br>  “version”: “1.0.0”,<br>  “main”: “lib/index.js”<br>}</p><p>就会先识别 <code>package.json</code> 中是否存在 <code>types</code> 或 <code>typings</code> 字段。发现不存在，那么就会寻找是否存在 <code>index.d.ts</code> 文件。如果还是不存在，那么就会寻找是否存在 <code>lib/index.d.ts</code> 文件。假如说连 <code>lib/index.d.ts</code> 都不存在的话，就会被认为是一个没有提供类型声明文件的库了。</p><p>有的库为了支持导入子模块，比如 <code>import bar from 'foo/lib/bar'</code>，就需要额外再编写一个类型声明文件 <code>lib/bar.d.ts</code> 或者 <code>lib/bar/index.d.ts</code>，这与自动生成声明文件类似，一个库中同时包含了多个类型声明文件。</p><h3 id="将声明文件发布到-types-下">将声明文件发布到 <code>@types</code> 下</h3><p>如果我们是在给别人的仓库添加类型声明文件，但原作者不愿意合并 pull request，那么就需要将声明文件发布到 <code>@types</code> 下。</p><p>与普通的 npm 模块不同，<code>@types</code> 是统一由 <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/">DefinitelyTyped</a> 管理的。要将声明文件发布到 <code>@types</code> 下，就需要给 <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/">DefinitelyTyped</a> 创建一个 pull-request，其中包含了类型声明文件，测试代码，以及 <code>tsconfig.json</code> 等。</p><p>pull-request 需要符合它们的规范，并且通过测试，才能被合并，稍后就会被自动发布到 <code>@types</code> 下。</p><p>在 <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/">DefinitelyTyped</a> 中创建一个新的类型声明，需要用到一些工具，<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/">DefinitelyTyped</a> 的文档中已经有了<a href="https://github.com/DefinitelyTyped/DefinitelyTyped#create-a-new-package">详细的介绍</a>，这里就不赘述了，以官方文档为准。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="TypeScript">TypeScript</h3><ol><li>静态类型监测【】</li></ol><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">利用 tsc 或 ts-<span class="keyword">node</span> <span class="title">读取tsconfig</span>.json 进行文件编译</span><br></pre></td></tr></table></figure><p>初始化<br>tsc --init</p><p>创建工程<br>npx create-react-app react-typescript-demo --template typescript</p><p>好处</p><ul><li>编码规范, 比如对属性和参数类型的检验</li><li>安装库对应的类型文件, typescript进行错误语法提示</li></ul><p>单行忽略<br>// @ts-ignore</p><p>文件忽略<br>// @ts-nocheck</p><p>对某些文件进行检查<br>// @ts-check</p><p>midway 中间件框架</p><p>webpack 工作原理<br>低代码<br>微前端</p><p>开发环境:</p><ul><li>dist</li></ul><p>工程化<br>vue 双向绑定原理</p><ul><li>v-model<ul><li>defineProperty</li><li>proxy</li></ul></li></ul><h2 id="发布订阅">发布订阅</h2><p><strong>三斜线指令</strong><br><a href="https://www.gowhich.com/blog/958">链接</a></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;reference <span class="type">path</span>=&quot;./node.d.ts&quot; /&gt;</span><br><span class="line">/// &lt;reference <span class="keyword">types</span>=&quot;node&quot; /&gt;</span><br><span class="line"><span class="type">path</span> 类型声明的是对本地文件的依赖，包含路径信息。</span><br><span class="line"><span class="keyword">types</span> 类型声明的是对 node_modules/@<span class="keyword">types</span> 文件夹下的类型的依赖，不包含路径信息。</span><br></pre></td></tr></table></figure><p><a href="https://juejin.cn/post/6844904093568221191">https://juejin.cn/post/6844904093568221191</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="类型声明">类型声明</h3><h1>TypeScirpt 类型声明完全指南</h1><p>**类型声明（Type Declaration）<strong>或者</strong>类型定义（Type Definition）**文件是一个以<code>.d.ts</code>作为文件后缀名的 TypeScript 文件。它们与普通<code>.ts</code>文件有什么区别呢？有什么特征呢？接下来，一起深入了解下。</p><h2 id="一-d-ts文件">一.<code>.d.ts</code>文件</h2><p>类型声明文件的后缀名为<code>.d.ts</code>，文件中只包含与类型相关的代码，不包含逻辑代码，它们的作用旨在为开发者提供类型信息，所以它们只在开发阶段起作用。</p><blockquote><p>在<a href="http://pengfeixc.com/blogs/javascript/tsconfig">TypeScript 编译</a>文章中介绍过，typescript 编译后会将类型信息移除，类型信息仅在开发阶段起作用。</p></blockquote><p>类型声明，即类型的声明，例如<code>interface</code>、<code>function</code>和<code>class</code>，下面是一个<code>interface</code>声明。</p><pre><code>// Person接口类型声明interface Person &#123;    name: string;    age: number;&#125;// 使用Person接口const xm: Person = &#123;    name: &quot;XiaoMing&quot;,    age: 8&#125;;</code></pre><h2 id="二-全局声明">二.全局声明</h2><p>**全局声明（global declaration）**在任何 TypeScript 项目或者 TypeScript 代码片段中都会起作用的。例如当你写下<code>const p = new Promise();</code>时，TypeScript 编译器不会去编译你的代码，因为<code>const p = new Promise();</code>语法错误了，如果你使用的是 vscode IDE，那么 vscode 向下图中那样提示你（个人写代码，习惯用白色背景，vscode 默认的背景色是黑色，虽然主题色不同，但是提示是相同的）。</p><p><img src="https://pengfeiw.github.io/images/blog/138.jpg" alt="vscode Promise类型错误"></p><p>vscode 就是根据全局声明检测到你的语法错误的。每个 TypeScript 程序都可以使用全局声明，无需显示的用<code>import</code>语句导入。</p><p>从 IDE 的提示中，可以看到<code>Promise</code>类型是定义在<code>lib.es2015.promise.d.ts</code>文件中的，由 TypeScript 提供，TypeScript 提供的很多这样的声明文件，被称作<strong>标准库</strong>（这些声明文件会随 TypeScript 一起安装）。</p><blockquote><p>使用<code>lib</code>编译选项，你可以控制哪些标准库被引入到当前项目。也可以设置<code>noLib</code>为<code>true</code>，这样会在项目中禁用所有标准库。更多内容请点击<a href="http://pengfeixc.com/blogs/javascript/tsconfig">Compilation</a>。</p></blockquote><p>为了手动的去加载一些全局声明文件，我们需要告诉 TypeScript 编译器声明文件的位置。可以通过<code>typeRoots</code>和<code>types</code>编译选项设置，关于这些内容，我也在<a href="http://pengfeixc.com/blogs/javascript/tsconfig">Compilation</a>里面讲解过。</p><p>接下来，动手实践。创建以下文件结构。</p><pre><code>project/    types/        common/            main.d.ts            package.json    program.ts    tsconfig.json</code></pre><p>在我们的项目中，我们需要一些公共类型，在每个 ts 文件中都可以使用这些公共类型，所以我打算在<code>project/types/common/main.d.ts</code>中存放这些公共类型声明，使用<code>typeRoots</code>告诉 TypeScript 声明文件的位置。TypeScript 编译器会根据<a href="https://pengfeixc.com/blogs/javascript/typescript-module-system"><strong>Node 模块定位策略</strong></a>导入<code>typeRoots</code>指定的目录下的声明文件，如果没有提供<code>typeRoots</code>选项，默认会导入<code>node_modules/@types</code>文件夹中的声明文件。</p><p><code>node_modules/@types</code>是<code>typeRoots</code>的默认值，<code>node_modules/@types</code>的目的仅仅是为了提供公共包的类型声明，目录下的每个声明模块的根目录下都应该包含一个<code>index.d.ts</code>文件，用来作为 typescirpt 入口声明文件，如果没有<code>index.d.ts</code>文件，它应该有一个<code>package.json</code>文件，<code>package.json</code>文件需要指出入口声明文件的位置。</p><p>现在我需要把<code>project/types/common/main.d.ts</code>文件，作为入口声明文件，所以在<code>project/types/common/package.json</code>文件中需要添加以下内容。</p><pre><code>&#123;    &quot;name&quot;: &quot;common&quot;,    &quot;version&quot;: &quot;1.0.0&quot;,    &quot;typings&quot;: &quot;main.d.ts&quot;&#125;</code></pre><p><code>typings</code>用于指示入口声明文件的位置。</p><p>接下来，配置<code>typeRoots</code>，告诉 TypeScript 自定义全局声明的位置，修改<code>tsconfig.json</code>文件内容如下。</p><pre><code>&#123;    &quot;files&quot;: [        &quot;./program.ts&quot;    ],    &quot;compilerOptions&quot;: &#123;        &quot;typeRoots&quot;: [            &quot;./types&quot;        ]    &#125;&#125;</code></pre><p>在<code>main.d.ts</code>文件中添加声明信息。</p><pre><code>interface Person &#123;    firstName: string;    lastName: string;    age: number;&#125;</code></pre><p>有了声明信息，可以在<code>program.ts</code>中使用该类型了。</p><p><img src="https://pengfeiw.github.io/images/blog/139.jpg" alt="vscode IDE"></p><p>正如图片中显示的那样，定义了<code>Person</code>类型的<code>ross</code>变量，因为赋值与类型不兼容，所以 IDE 报错，IDE 还给出了声明文件的位置。修改 program.ts 文件如下，修复错误。</p><pre><code>const ross: Person = &#123;    firstName: &quot;Ross&quot;,    lastName: &quot;Geller&quot;,    age: 20&#125;;</code></pre><h2 id="三-声明模块化">三.声明模块化</h2><p>在上面的例子中，TypeScript 仅仅知道<code>main.d.ts</code>声明文件，假如项目中包含几千个声明信息，将这些声明全部放到<code>main.d.ts</code>文件中，会使项目变得非常糟糕，不好维护。因此，需要将声明模块化。</p><p>在<a href="http://pengfeixc.com/blogs/javascript/typescript-namespace">命名空间</a>教程中，我介绍过可以使用<code>&lt;reference /&gt;</code>指令，在编译阶段添加一些文件。当然我们也可以在声明文件中使用该指令。首先<code>project/types/common/</code>文件夹下添加<code>functions.d.ts</code>和<code>interfaces.d.ts</code>文件。</p><p><code>interfaces.d.ts</code>提供<code>common</code>包中所有的接口类型信息，<code>functions.d.ts</code>提供<code>common</code>包中所有的函数类型信息。并在<code>main.d.ts</code>文件中，使用<code>&lt;reference /&gt;</code>指令引入它们。</p><pre><code>// types/common/main.d.ts/// &lt;reference path=&quot;./interfaces.d.ts&quot; /&gt;/// &lt;reference path=&quot;./functions.d.ts&quot; /&gt;-----------------------------------------------// types/common/interfaces.d.tsinterface Person &#123;    firstName: string;    lastName: string;    age: number;&#125;------------------------------------------------// types/common/functions.d.tstype GetFullName = ( p: Person ) =&gt; string;</code></pre><p>有一点值得注意的是，我们可以在<code>functions.d.ts</code>文件中，使用<code>interfaces.d.ts</code>文件中定义的<code>Person</code>接口，这是因为使用<code>&lt;reference /&gt;</code>指定，指定的文件可以共享类型声明。</p><p>修改<code>program.ts</code>文件使用定义的类型。</p><pre><code>const ross: Person = &#123;    firstName: &quot;Ross&quot;,    lastName: &quot;Geller&quot;,    age: 20&#125;;const getPersonName: GetFullName = (p: Person) =&gt; &#123;    return `$&#123;p.firstName&#125; $&#123;p.lastName&#125;`;&#125;;console.log(getPersonName(ross));</code></pre><h2 id="四-第三方声明">四.第三方声明</h2><p>目前，已经知道了如何创建自定义全局声明文件。某些情况下，我们需要安装第三方提供的 npm 声明文件包。</p><p>在<a href="http://pengfeixc.com/blogs/javascript/tsconfig">Compilation</a>文章中我提到过<a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a>社区，它们为我们提供了很多第三方 npm 声明文件包，例如<code>@types/lodash</code>和<code>@types/node</code>等等。你可以使用 npm 安装<a href="https://www.npmjs.com/org/types"><code>@types</code></a>下的声明包。</p><pre><code>npm install -D @types/node</code></pre><p>这些包会被下载到<code>node_modules/@types</code>文件夹下，这也是为什么<code>typeRoots</code>的默认值为<code>node_modules/@types</code>。如果你想在默认值的基础上额外添加一个声明文件夹目录，需要给<code>typeRoots</code>指定两个值。</p><pre><code>&#123;    &quot;files&quot;: [        &quot;./program.ts&quot;    ],    &quot;compilerOptions&quot;: &#123;        &quot;typeRoots&quot;: [            &quot;./node_modules/@types&quot;,            &quot;./types&quot;        ]    &#125;&#125;</code></pre><h2 id="五-环境相关的声明">五.环境相关的声明</h2><p>某些值，只存在于运行时。例如<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window"><code>window</code></a>对象，它只存在于浏览器环境中，同样的还有 node 中的<a href="https://nodejs.org/api/globals.html#globals_global"><code>global</code></a>。</p><p>如果当你在 TypeScript 程序中，使用<code>window</code>或者<code>glbal</code>时，typescirpt 编译器报错了<code>cannot find name 'window'</code>。这是正常的，因为没有定义<code>window</code>变量。所以，如果没有定义，我们如何使用<code>window</code>对象呢？</p><p>我们需要使用<code>declare</code>关键字告诉 TypeScript 编译器，<code>window</code>变量存在，不要再报错了。</p><pre><code>declare var window: any;</code></pre><p>这句代码，被称为<strong>环境声明（ambient declaration）</strong>，其中<code>window</code>被称为<strong>环境值（ambient value）</strong>。有了这个声明，TypeScript 会认为这个<code>any</code>类型的<code>window</code>变量已经定义了，所以在任何地方使用<code>window</code>变量都不会报错了。</p><p>你也可以为环境值提供指定的类型，例如<code>declare var window: Person;</code></p><p>接下来，在<code>main.d.ts</code>文件中添加一个环境值<code>XiaoMing</code>。</p><pre><code>/// &lt;reference path=&quot;./interfaces.d.ts&quot; /&gt;/// &lt;reference path=&quot;./functions.d.ts&quot; /&gt;declare var XiaoMing: Person;</code></pre><p>然后在<code>program.ts</code>中使用它。</p><pre><code>console.log(XiaoMing.age);</code></pre><p>如果没有写错的话，TypeScript 不会报错。</p><h2 id="六-命名空间的声明">六.命名空间的声明</h2><p>在前面的例子中，我们提供了<code>types/common</code>声明包，定义了全局<code>Person</code>接口类型，全局的接口类型有一个弊端，就是很容易被其他包里的声明文件类型覆盖（类型冲突）。</p><p>为了避免这个问题，最好的解决方式是将类型定义在命名空间里。在<a href="https://pengfeixc.com/blogs/javascript/typescript-namespace">namespace</a>文章中，介绍了 namespace 的用法，我们可以在命名空间里定义类型声明。</p><p>修改声明文件内容如下。</p><pre><code>// types/common/main.d.ts/// &lt;reference path=&quot;./interfaces.d.ts&quot; /&gt;/// &lt;reference path=&quot;./functions.d.ts&quot; /&gt;--------------------------------------------------------------------// types/common/interfaces.d.tsdeclare namespace common &#123;    interface Person &#123;        firstName: string;        lastName: string;        age: number;    &#125;&#125;--------------------------------------------------------------------// types/common/functions.d.tsdeclare namespace common &#123;    type GetFullName = ( p: Person ) =&gt; string;&#125;</code></pre><p>这里定义的命名空间类型与<a href="https://pengfeixc.com/blogs/javascript/typescript-namespace">namespace</a>文章中有点不一样，区别在于使用了 declare 关键字。因为<code>namespace</code>是一个值（object），在声明文件<code>.d.ts</code>文件中应该将<code>namespace</code>定义成环境值，这样我们可以在任何<code>ts</code>文件中，通过<code>common</code>命名空间使用<code>common.&lt;type&gt;</code>类型，例如<code>common.Person</code>。</p><blockquote><p>再次提醒，在声明文件中只允许包含声明信息，因为命名空间是一个 object，所以不能在声明文件中定义它，但是我们可以将命名空间定义成环境值。</p></blockquote><p>并且，当命名空间被定义在声明文件中，<code>export</code>关键字就不需要了，命名空间内部的所有类型，都被隐式 export。另外，你不能从命名空间中导出一个值，只允许导出类型。</p><h2 id="七-类型扩展">七.类型扩展</h2><p>当 typescript 预见多个同名接口类型，它会自动合并这些接口类型成为一个声明。</p><p>namespace 也有类似的行为，当声明一个已经存在的命名空间时，typescript 会自动扩展已经存在的命名空间。所以当接口和命名空间在全局环境中，可以重新声明它们来达到扩展它们的目的。</p><p>更新声明文件。</p><pre><code>// types/common/main.d.ts/// &lt;reference path=&quot;./interfaces.d.ts&quot; /&gt;/// &lt;reference path=&quot;./functions.d.ts&quot; /&gt;--------------------------------------------------------// types/common/interfaces.d.tsinterface Person &#123;    firstName: string;    lastName: string;    age: number;&#125;--------------------------------------------------------// types/common/functions.d.tsdeclare namespace common &#123;    type GetFullName = ( p: Person ) =&gt; string;&#125;</code></pre><p>更新<code>program.ts</code>。</p><pre><code>interface Person &#123;    email: string;&#125;interface Number &#123;    isEven(): boolean;&#125;const ross: Person = &#123;    firstName: &quot;Ross&quot;,    lastName: &quot;Geller&quot;,    age: 29,    email: &quot;ross@geller.com&quot;&#125;;const isAgeEven = ross.age.isEven();console.log(&quot;isAgeEven&quot;, isAgeEven);</code></pre><p>此时 typescript 并不会报错。在<code>program.ts</code>中扩展了<code>Person</code>接口和<code>Number</code>（内置类型）接口。</p><p>但是，这并不适用于模块系统，值和类型只能在<strong>script</strong>文件中共享，<strong>script</strong>文件就是不包含<code>import</code>和<code>export</code>语句的文件。</p><p>可以在<code>program.ts</code>文件最后面添加一行代码<code>export &#123;&#125;</code>。此时 typescript 应该会给出以下错误信息。</p><pre><code>Type '&#123; firstName: string; lastName: string; age: number; email: string; &#125;' is not assignable to type 'Person'.Object literal may only specify known properties, and 'firstName' does not exist in type 'Person'.ts(2322)Property 'age' does not exist on type 'Person'.ts(2339)</code></pre><p>因为，添加<code>export &#123;&#125;</code>代码，将<code>program.ts</code>文件转换成了模块（module），这种情况下，typescript 不会扩展全局环境中的类型，而是在当前模块内重新声明该类型。</p><p>那么如何在模块中，扩展全局环境中的类型呢？TypeScript 提供了<code>declare global</code>环境声明语句，使用它，可以在模块内给全局作用域添加声明。</p><p>更新<code>program.ts</code>，使用<code>declare global</code>语句。</p><pre><code>declare global &#123;    // 扩展全局Person接口    interface Person &#123;        email: string;    &#125;&#125;declare global &#123;    // 扩展全局Number接口    interface Number &#123;        isEven(): boolean;    &#125;    var version: string;&#125;const ross: Person = &#123;    firstName: 'Ross',    lastName: 'Geller',    age: 29,    email: 'ross@geller.com'&#125;const isAgeEven = ross.age.isEven();console.log( 'isAgeEven', isAgeEven );export &#123;&#125;</code></pre><p>这次 typescript 不会报错，并且成功在 module 内扩展了全局类型。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>详解 tsconfig.json 文件</h1><p>个人很喜欢 TypeScirpt，用 Ts 写代码要比 Js 舒服太多，可以大大提高写代码的效率，减少代码维护的工作量。因为有 C++、C#的基础，我上手 Ts 的速度也很快。虽然使用起来并没有什么困难，但是很长一段时间，没有去了解 typescirpt 的编译过程及配置，所以自己也不能算是真正的了解它。</p><p>工欲善其事必先利其器，如果你对 ts 的配置及编译过程不是很了解的话，那么这篇文章应该会对你有所帮助。</p><p>接下来的内容需要你的环境安装 TypeScript，请确保安装了 TypeScript，否则<code>tsc</code>命令无法识别。</p><h2 id="一-tsc">一.tsc</h2><p>Ts 提供了一个命令行功能<code>tsc</code>，使用它可以将 Ts 文件编译成 Js 文件。</p><p>首先创建一个文件夹和<code>index.ts</code>文件，进入<code>learnTsConfig</code>文件夹。</p><pre><code>mkdir learnTsConfigmkdir learnTsConfig/srctouch learnTsConfig/src/index.tscd learnTsConfig</code></pre><p>可以在<code>index.ts</code>文件中输入一些 Ts 代码，例如：</p><pre><code>// src/index.tstype FuncType = () =&gt; void;const sayHello: FuncType = () =&gt; &#123;    console.log(&quot;Hello Ts&quot;);&#125;;</code></pre><p>然后使用<code>tsc [ts file]</code>命令编译文件:</p><pre><code>tsc src/index.ts</code></pre><p>可以看到，在<code>src/index.ts</code>同目录下，有个<code>index.js</code>文件生成，该文件就是编译后生成的文件，<code>src/index.js</code>文件内容如下：</p><pre><code>var sayHello = function () &#123;    console.log(&quot;Hello Ts&quot;);&#125;;</code></pre><p>为 tsc 命令指定 ts 文件，不适用于项目中，我们不可能将所有要编译的文件路径都添加在 tsc 命令后面，所以通常用<strong>JSON 配置文件（tsconfig.json）<strong>配置 tsc 编译器。当执行<code>tsc</code>命令时，ts 编译器会首先在当前目录寻找<code>tsconfig.json</code>文件，如果当前目录没有<code>tsconfig.json</code>文件，它会一直向上级目录寻找，直到找到一个<code>tsconfig.json</code>文件，<code>tsconfig.json</code>文件所在的目录为项目的</strong>根目录</strong>。</p><p>如果最终没有找到一个<code>tsconfig.json</code>文件，执行<code>tsc</code>命令将不会编译任何文件，只会输出版本号及 help 信息。</p><p>下面详细介绍<strong>tsconfig.json</strong>文件。</p><h2 id="二-tsconfig-json文件">二.<code>tsconfig.json</code>文件</h2><p><code>tsconfig.json</code>文件支持<a href="https://json5.org/">JSON5</a>的内容，所以可以在<code>tsconfig.json</code>文件中添加注释，使用单引号代。</p><p><code>tsconfig.json</code>文件结构如下：</p><pre><code>&#123;    &quot;files&quot;: [],    // ...    &quot;compilerOptions&quot;: &#123;        &quot;target&quot;: &quot;ES6&quot;,        &quot;module&quot;: &quot;CommonJS&quot;,        &quot;outDir&quot;: &quot;./dist/development&quot;    &#125;&#125;</code></pre><p>下面我将配置选项分为编译选项（compilerOptions 字段下的配置项）和非编译选项（compilerOptions 字段外的根级选项）进行介绍。</p><p>首先在<code>learnTsConfig</code>目录下，新建<code>tsconfig.json</code>文件。</p><pre><code>touch tsconfig.json</code></pre><h3 id="非编译选项">非编译选项</h3><p>非编译选项通常控制的是 typescript 编译器要编译的项目（文件）信息，例如要编译的 ts 文件。</p><ol><li><code>files</code></li></ol><p><code>files</code>选项用于指示哪些文件需要编译，可以添加一组文件路径，支持相对路径和绝对路径，相对路径是相对于项目根目录的，即 tsconfig.json 文件所在的目录，建议大家使用相对路径，避免使用绝对路径，这样即使项目换了环境也不用更改配置。</p><p>在根目录下新建文件<code>outerIndex.ts</code>文件，此时目录结构如下</p><pre><code>learnTsConfig/    src/        index.ts    outerIndex.ts    tsconfig.json</code></pre><p>在 tsconfig.json 文件中输入以下内容：</p><pre><code>&#123;    // files选项用于设置需要编译的文件    &quot;files&quot;: [        &quot;outerIndex.ts&quot;,        &quot;src/index.ts&quot;    ]&#125;</code></pre><p>执行<code>tsc</code>命令进行编译，编译后的文件结构如下：</p><pre><code>learnTsConfig/    src/        index.ts        index.js    outerIndex.ts    outerIndex.js    tsconfig.json</code></pre><ol start="2"><li><code>include</code> &amp; <code>exclude</code></li></ol><p>如果项目中文件较少的情况下，使用<code>files</code>选项设置要编译的目标文件是一个不错的选择，但是当文件特别多或者项目文件更新频繁的时候，将所有要编译的文件都写在<code>files</code>数组中就比较麻烦，每次添加一个 ts 文件，都要更新<code>files</code>选项。</p><p>所以 ts 还提供了<code>include</code>选项，这个选项与<code>files</code>类似，但是你可以使用<strong>模式匹配</strong>，删掉之前编译的 js 文件，更改<code>tsconfig.ts</code>文件内容如下：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;src/*.ts&quot;    ]&#125;</code></pre><p>执行<code>tsc</code>编译，文件结构如下，仅<code>src/</code>目录下的<code>index.ts</code>被编译。</p><pre><code>learnTsConfig/    src/        index.ts        index.js    outerIndex.ts    tsconfig.json</code></pre><p><code>exclude</code>作用于<code>include</code>正好相反，用于排除某些文件，也支持<strong>模式匹配</strong>，清理 js 文件，更新<code>tsconfig.ts</code>文件内容如下：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;*.ts&quot;    ],    &quot;exclude&quot;: [        &quot;src/*.ts&quot;    ]&#125;</code></pre><p><code>include</code>选项表示，编译根目录下的所有 ts 文件，<code>exclude</code>表示排除<code>src/</code>目录下所有 ts 文件，所以<code>tsc</code>编译后的文件结构如下:</p><pre><code>learnTsConfig/    src/        index.ts    outerIndex.ts    outerIndex.js    tsconfig.json</code></pre><p>在用模式匹配时，可以不用显示添加<code>.ts</code>后缀，默认情况下 typescript 会自动寻找<code>.ts</code>文件和<code>.d.ts</code>文件，如果你设置了<code>allowJS</code>编译选项（后面介绍编译选项内容）为 true，typescript 还会寻找<code>.js</code>文件。<code>src/**/*</code>等价为<code>src/**/*.ts</code>和<code>src/**/*.d.ts</code>（如果<code>allowJs</code>为 true，还包括<code>src/**/*.js</code>）。</p><p>有些文件夹，typescript 会自动排除，例如<code>node_modules</code>、<code>bower_components</code>、<code>jspm_packages</code>和<code>&lt;outDir&gt;</code>。如果你要强制 ts 编译这些文件夹中的 ts 文件，需要指定<code>files</code>文件选项。</p><h3 id="编译选项">编译选项</h3><p>编译选项即<code>compilerOptions</code>字段下的相关配置。</p><h4 id="输出文件">输出文件</h4><ol><li><code>outDir</code></li></ol><p>默认情况下，ts 编译后的 js 文件，与源文件都在同一个目录下。使用<code>outDir</code>选项可以指定编译后的文件所在的目录。清理之前编译生成的 js 文件。</p><pre><code>learnTsConfig/    src/        index.ts    outerIndex.ts    tsconfig.json</code></pre><p>更新<code>tsconfig.json</code>文件：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;    &#125;&#125;</code></pre><p>然后执行<code>tsc</code>命令进行编译，编译后会生成<code>dist/</code>文件夹，<code>dist/</code>目录下即编译生成的 js 文件，目录下的结构与项目目录结构相同。</p><pre><code>learnTsConfig/    dist/        src/            index.js        outerIndex.js    src/        index.ts    outerIndex.ts    tsconfig.json</code></pre><ol start="2"><li><code>rootDir</code></li></ol><p>typescirpt 项目的默认的根目录为<code>tsconfig.json</code>文件所在的目录，所有的相对路径都是相对于这个根目录的。我们可以通过<code>rootDir</code>选项，更改项目的根目录位置。删除 dist 文件夹，更新<code>tsconfig.json</code>文件：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;rootDir&quot;: &quot;..&quot;    &#125;&#125;</code></pre><p>执行 tsc 命令，编译后的目录如下：</p><pre><code>learnTsConfig/    dist/        learnTsConfig/            src/                index.js            outerIndex.js    src/        index.ts    outerIndex.ts    tsconfig.json</code></pre><p>大多数情况下，我们保持 TypeScript 默认行为即可，使用<code>tsconfig.json</code>文件所在位置为项目的根目录。</p><ol start="3"><li><code>removeComments</code></li></ol><p><code>removeComments</code>选项用于删除编译后的 js 文件中的注释代码。</p><p>首先清理项目，更新<code>tsconfig.json</code>文件如下：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,    &#125;&#125;</code></pre><p>更新<code>src/index.ts</code>文件内容：</p><pre><code>type FuncType = () =&gt; void;// print info: Hello Tsconst sayHello: FuncType = () =&gt; &#123;    console.log(&quot;Hello Ts&quot;);&#125;;</code></pre><p><code>tsc</code>编译，编译后的<code>dist/src/index.js</code>文件内容如下：</p><pre><code>// print info: Hello Tsvar sayHello = function () &#123;    console.log(&quot;Hello Ts&quot;);&#125;;</code></pre><p>可以看到注释内容并未去掉。更新<code>tsconfig.json</code>文件：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true    &#125;&#125;</code></pre><p>再次编译，编译后的<code>dist/src/index.js</code>文件如下：</p><pre><code>var sayHello = function () &#123;    console.log(&quot;Hello Ts&quot;);&#125;;</code></pre><p>可以看到，注释内容被删掉了。</p><ol start="4"><li><code>module</code></li></ol><p>假设你正在开发的项目，需要在 nodejs 环境中运行，在项目中你使用了<code>import</code>引入模块，但是<code>nodejs</code>并不支持，nodejs 使用的是<a href="http://javascript.ruanyifeng.com/nodejs/module.html">CommonJS</a>模块系统。为了使编译后的 js 文件<code>import</code>语句转换为<code>require</code>语句，你可以配置<code>&quot;module&quot;: &quot;CommonJS&quot;</code>。</p><p>下面，我们手动试一下。更新<code>tsconfig.js</code>文件：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true,        &quot;module&quot;: &quot;CommonJS&quot;    &#125;&#125;</code></pre><p>在 src 目录下添加 add.ts 文件，内容如下：</p><pre><code>/** * Add two numbers * @param a a number * @param b a number * @returns &#123;number&#125; sum */export const add = (a: number, b: number):number =&gt; &#123;    return a + b;&#125;;</code></pre><p>更新<code>src/index.ts</code>文件：</p><pre><code>import &#123;add&#125; from &quot;./add&quot;console.log(add(3, 5));</code></pre><p>编译文件，查看<code>dist/src/index.js</code>内容如下，可以看到<code>import</code>语句已经转换为<code>require</code>语句。</p><pre><code>&quot;use strict&quot;;exports.__esModule = true;var add_1 = require(&quot;./add&quot;);console.log(add_1.add(3, 5));</code></pre><ol start="5"><li><code>outFile</code></li></ol><p><code>outFile</code>可以指定编译后的结果文件被打包成一个<strong>bundle</strong>，即一个 js 文件，前提是<code>module</code>选项被设置成<code>System</code>或者<code>AMD</code>。如果想要支持其他的 module 选项，可以借助<a href="https://www.webpackjs.com/">webpack</a>、<a href="https://www.parceljs.cn/">parcel</a>等工具。</p><p>简单的尝试一下，更新<code>tsconfig.json</code>文件如下：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outFile&quot;: &quot;dist/bundle.js&quot;,        &quot;removeComments&quot;: true,        &quot;module&quot;: &quot;AMD&quot;    &#125;&#125;</code></pre><p>编译后仅有<code>dist/bundle.js</code>文件生成。</p><h4 id="source-map">source map</h4><ol><li><code>sourceMap</code></li></ol><p>首先，简单介绍下<strong>source-map</strong>文件。source-map 文件表示编译的源文件与输出的结果文件的一种映射关系，在项目调试时起到非常重要的作用，可以让我们在浏览器开发者工具中显示源文件代码进行调试，要知道浏览器运行的是编译后的代码，如果调试看着编译后的代码，那么调试是一件多么痛苦的事啊。</p><p>source-map 文件由编译工具自动生成，以<code>.map</code>后缀结尾，它是一个 JSON 文件，结构如下。</p><pre><code>&#123;    &quot;version&quot;: 3,    &quot;file&quot;: &quot;bundle.js&quot;,    &quot;sourceRoot&quot;: &quot;&quot;,    &quot;sources&quot;: [        &quot;../outerIndex.ts&quot;,        &quot;../src/add.ts&quot;,        &quot;../src/index.ts&quot;    ],    &quot;names&quot;: [],    &quot;mappings&quot;: &quot;AAAA,IAAM,SAAS...&quot;&#125;</code></pre><p><code>file</code>字段表示与该 source-map 文件对应的输出文件名称，<code>sources</code>字段表示的是编译源文件。<code>mapping</code>属性是<strong>base64 编码值</strong>，表示源文件与输出文件之间的关系。</p><p>而编译后输出的文件末尾会有<code>sourceMappingURL</code>字段的注释，表示 map 文件位置，这个注释会被浏览器读取，用于定位 map 文件。</p><pre><code>// b.jsvar b = 'B';//# sourceMappingURL=b.js.map</code></pre><p>为了生成 source-map 文件，可以设置<code>sourceMap</code>字段为 true。</p><p>更新<code>tsconfig.json</code>文件：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outFile&quot;: &quot;dist/bundle.js&quot;,        &quot;removeComments&quot;: true,        &quot;module&quot;: &quot;AMD&quot;,        &quot;sourceMap&quot;: true    &#125;&#125;</code></pre><p>执行<code>tsc</code>命令，编译后会生成<code>dist/bundle.js</code>和<code>dist/bundle.js.map</code>。</p><ol start="2"><li><code>inlineSourceMap</code></li></ol><p><code>sourceMap</code>选项，会为编译后的 js 文件生成一个分离的<code>.map</code>文件。设置<code>inlineSourceMap</code>为 true 的话，可以避免生成<code>.map</code>文件，将 map 直接内嵌在编译后的 js 文件中。</p><p>更新<code>tsconfig.json</code>文件：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outFile&quot;: &quot;dist/bundle.js&quot;,        &quot;removeComments&quot;: true,        &quot;module&quot;: &quot;AMD&quot;,        &quot;inlineSourceMap&quot;: true    &#125;&#125;</code></pre><p>进行编译后，查看编译后的<code>dist/bundle.js</code>文件:</p><pre><code>...//# sourceMappingURL=data:application/json;base64,...</code></pre><p>可以看到<code>sourceMappingURL</code>后面直接紧跟着 base64 数据（map 文件内容）。</p><h4 id="类型声明">类型声明</h4><p>typescript 最重要的作用是使 js 支持类型，变成一种强类型语言。</p><ol><li><code>declaration</code></li></ol><p>设置<code>declaration</code>字段为 true，可以自动生成声明文件。</p><p>更新<code>tsconfig.json</code>文件：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true,        &quot;declaration&quot;: true    &#125;&#125;</code></pre><p>执行 tsc 命令编译，可以看到<code>dist/**/*.d.ts</code>文件生成，该文件是对应的<code>*.js</code>文件的的声明文件。通过这些声明文件，ts 编译器可以知道 package 的 API 结构，即使编译后的 JavaScript 文件不包含任何类型信息。</p><p>生成的 dist 文件目录如下：</p><pre><code>dist/    src/        add.d.ts        add.js        index.d.ts        index.js    outerIndex.d.ts    outInder.js</code></pre><ol start="2"><li><code>declarationDir</code></li></ol><p>当<code>declaration</code>设置为<code>ture</code>时，ts 编译器将对应的.d.ts 文件放入到编译后的 js 文件同级目录下。可以通过设置<code>declarationDir</code>将所有声明文件放到同一个目录下。</p><p>更新<code>tsconfig.json</code>文件如下：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true,        &quot;declaration&quot;: true,        &quot;declarationDir&quot;: &quot;dist/types&quot;,    &#125;&#125;</code></pre><p>执行 tsc 命令，可以看到<code>dist/types/</code>目录生成，目录下结构与源文件目录相同，只不过都是<code>.d.ts</code>声明文件。</p><ol start="3"><li><code>lib</code></li></ol><p>typescirpt 内置了一些 TypeScirpt 声明文件，例如<code>Promise</code>、<code>Object.freeze</code>和浏览器的 API 的声明。这些声明文件可以提供代码提示和警告功能。通常存放在<code>lib</code>文件夹下，我们称之为标准库。通过设置<code>lib</code>字段，手动选择导入哪些库。</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true,        &quot;declaration&quot;: true,        &quot;declarationDir&quot;: &quot;dist/types&quot;,        &quot;lib&quot;: [ &quot;ES5&quot;, &quot;ES2015.Promise&quot;, &quot;DOM&quot; ]    &#125;&#125;</code></pre><ol start="4"><li><code>typeRoots</code></li></ol><p>当你将你的 typescript 程序，发布为 npm 包时，你可能发布的是编译后的 JavaScript 包，这样非 typescript 程序可以引入该 npm 包，为了提供声明信息，你也可以提供对应的声明文件，这样 typescirpt 编译器和 IDE（例如 vscode）可以根据声明文件，提供类型提示、错误提示。为了生成声明文件，你只需要将<code>declaration</code>设置为<code>true</code>即可。</p><p>但是并不是所有的程序都是 typescript 写的，例如<a href="https://www.lodashjs.com/">lodash</a>，它本身就是 javascript 编写的，所以无法使用 ts 提供的功能，自动生成声明文件。所以需要手动为没有声明文件的 npm 包提供声明文件。</p><p><a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a>社区的工作就是为那些比较流行的没有声明文件的 npm 包，提供声明文件。你可以通过安装以<code>@types</code>开头的声明文件包为某个 npm 包提供声明文件。</p><p>例如<code>npm install @types/lodash</code>，<code>@types/lodash</code>就是<code>lodash</code>包的声明文件。</p><p>默认情况下，typescript 会从<code>node_modules/@types</code>文件夹下导入所有类型声明至全局空间，需要注意只会导入 script 文件中的声明至全局空间，module 文件对全局空间是隐藏的。</p><p><strong>type-root</strong>就是包的声明文件存储的目录，可以通过<code>typeRoots</code>选项设置一系列为文件路径，指示 typescript 从哪些地方导入类型信息，默认值为<code>node_modules/@types</code>。</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true,        &quot;declaration&quot;: true,        &quot;declarationDir&quot;: &quot;dist/types&quot;,        &quot;typeRoots&quot;: [&quot;./my-types&quot;]    &#125;&#125;</code></pre><p>通过设置<code>&quot;typeRoots&quot;: [&quot;./my-types&quot;]</code>，typescript 将会只从<code>my-types</code>文件夹下导入声明信息，而不是从<code>node_modules</code>文件夹下。</p><ol start="5"><li><code>types</code></li></ol><p><code>typeRoots</code>用于导入目录下所有的声明至全局空间，但是如果设置了<code>types</code>，则只会导入<code>types</code>指定的包声明至全局空间。</p><pre><code>&#123;    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;types&quot;: [ &quot;node&quot;, &quot;moment&quot; ] // 导入node_modules文件夹下的@types/node和@types/moment，其他包将会被忽略    &#125;&#125;</code></pre><h4 id="JavaScript-编译">JavaScript 编译</h4><p>默认情况下，typescript 编译是不包括 js 文件的。可以通过<code>allowJS</code>和<code>checkJS</code>更改这一默认行为。</p><ol><li><code>allowJS</code></li></ol><p>当你在 typescript 文件中使用<code>import</code>语句引入模块时，例如<code>import &#123;add&#125; from &quot;./add</code>，默认情况下 ts 编译器会自动寻找<code>src/add.ts</code>和<code>src/add.d.ts</code>，它不会去考虑<code>src/add.js</code>，我们可以通过将<code>allowJS</code>设置为<code>true</code>来更改这一默认行为。</p><p>首先，更新<code>tsconfig.json</code>文件如下：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true,        &quot;declaration&quot;: true,    &#125;&#125;</code></pre><p>新建<code>src/add.js</code>，输入以下代码：</p><pre><code>export const add = (a, b) =&gt; &#123;    return a + b;&#125;;</code></pre><p>在<code>src/index.js</code>中引入<code>add</code>函数：</p><pre><code>import &#123;add&#125; from &quot;./add&quot;;console.log(add(3, 5));</code></pre><p>默认情况下，<code>allowJS</code>是<code>false</code>，所以此时进行 tsc 编译后，编译后的<code>dist/src/</code>目录下是不会包含<code>add.js</code>文件的。</p><p>更新<code>tsconfig.json</code>文件，将<code>allowJS</code>设置为 true。</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true,        &quot;declaration&quot;: true,        &quot;allowJs&quot;: true    &#125;&#125;</code></pre><p>重新编译，编译后<code>dist/src/</code>目录下会新增<code>add.d.ts</code>文件和<code>add.js</code>文件。</p><p>所以如果，你想要的你的项目支持 js 文件，只需要设置<code>&quot;allowJs&quot;: true</code>即可。</p><ol start="2"><li><code>checkJs</code></li></ol><p>使用<code>allowJS</code>可以让编译器在编译阶段包含 js 文件，但是编译器并不会对 js 文件进行<strong>类型检查</strong>。类型检查是 ts 的一个重要的特性，有了类型检查，大大提高了我们的开发效率，所以为了能工让 ts 编译器对 js 文件进行类型检查，需要设置<code>&quot;checkJS&quot;: true</code>。</p><p>为了进一步解释，首先在<code>add.js</code>的顶部添加<code>const num = parseInt(1.5);</code>。</p><p>然后使用 tsc 编译，编译成功。</p><p>然后更新<code>tsconfig.json</code>文件：</p><pre><code>&#123;    &quot;include&quot;: [        &quot;**/*.ts&quot;,    ],    &quot;compilerOptions&quot;: &#123;        &quot;outDir&quot;: &quot;dist&quot;,        &quot;removeComments&quot;: true,        &quot;declaration&quot;: true,        &quot;allowJs&quot;: true,        &quot;checkJs&quot;: true    &#125;&#125;</code></pre><p>再使用 tsc 编译，编译应该会报错。</p><pre><code>src/add.js:1:22 - error TS2345: Argument of type '1.5' is not assignable to parameter of type 'string'.1 const num = parseInt(1.5);                       ~~~Found 1 error.</code></pre><p>因为此时<code>checkJS</code>为 true，ts 编译器会对 js 文件进行类型检查，<code>parseInt</code>函数接受的参数为字符串，但是<code>1.5</code>是<code>number</code>类型，类型不兼容，所以编译失败。如果你是用的是 vscode 编辑器，开启了<code>checkJS</code>后，在你敲<code>const num = parseInt(1.5);</code>这句代码时，编辑器应该会给出智能错误提示。</p><h2 id="三-总结">三.总结</h2><p>tsconfig 的配置字段有很多，本篇内容旨在介绍它的基本用法和基本结构，并不包含所有的内容。希望通过这篇文章，你能了解 tsc 编译器，知道如何去配置 tsc 编译器，理解它的原理。</p><p>更多的 tsconfig 配置，请查阅<a href="https://www.typescriptlang.org/tsconfig">TSConfig Reference</a>。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="WebAssembly">WebAssembly</h3><p>JavaScript 调用 WebAssembly JavaScript API</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="TypeScript">TypeScript</h2><p><strong>Typescript基本数据类型</strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">any</span>: 任意类型</span><br><span class="line"></span><br><span class="line"><span class="attr">number</span>: 数值类型</span><br><span class="line"></span><br><span class="line"><span class="attr">boolean</span>: 布尔类型</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span>[]：数组类型</span><br><span class="line"></span><br><span class="line"><span class="title class_">Tuple</span>: 元组</span><br><span class="line">用来表示已知元素数量和类型的数组，各元素的类型不必相同，对应位置的类型需要相同</span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: [<span class="built_in">string</span>, <span class="built_in">number</span>] = [<span class="string">&#x27;hello&#x27;</span>, <span class="number">123</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">enum</span>: 枚举</span><br><span class="line">定义带名称的常量(数字或字符串)</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> <span class="title class_">Color</span> &#123; </span><br><span class="line">  <span class="title class_">Green</span> = <span class="string">&#x27;Green&#x27;</span>, </span><br><span class="line">  <span class="title class_">Blue</span> = <span class="string">&#x27;Blue&#x27;</span>, </span><br><span class="line">  <span class="title class_">White</span> = <span class="string">&#x27;White&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span>： 标识方法返回的类型</span><br><span class="line"><span class="keyword">const</span> <span class="attr">loop</span>: <span class="built_in">void</span> = <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line"><span class="literal">null</span>： 表示对象值缺失</span><br><span class="line"></span><br><span class="line"><span class="literal">undefined</span>： 用于初始化变量为一个未定义的值</span><br><span class="line"></span><br><span class="line"><span class="built_in">never</span>： 其他类型（包括<span class="literal">null</span>和<span class="literal">undefined</span>）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">疑问：</span><br><span class="line">?.可选操作符</span><br><span class="line">?可选参数</span><br><span class="line">?? 和||类型，区别在于 判断时不会忽略<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> B &#123;</span><br><span class="line">  name?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> implemented B &#123;</span><br><span class="line">  name!: sting <span class="comment">// `!` 强调name不为空值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">交叉类型: 由多个类型组成， 用<span class="string">`&amp;`</span> 连接</span><br><span class="line">联合类型: 某个变量是其中一中类型， 用<span class="string">`|`</span> 分割</span><br><span class="line"><span class="attr">eg</span>: </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">location</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">fn</span>: <span class="function">(<span class="params">value: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Contact</span> &#123;</span><br><span class="line">  <span class="attr">phone</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">location</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">fn</span>: <span class="function">(<span class="params">value: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 交叉类型</span></span><br><span class="line"><span class="keyword">type</span> info = <span class="title class_">Person</span> &amp; <span class="title class_">Contact</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">a</span>: info = &#123; </span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;11&#x27;</span>, </span><br><span class="line">  <span class="attr">phone</span>: <span class="number">12434</span>, </span><br><span class="line">  <span class="attr">location</span>: <span class="built_in">never</span>,         <span class="comment">// 同名基础类型属性的合并返回: never</span></span><br><span class="line">  <span class="attr">fn</span>: <span class="function">(<span class="params">value: <span class="built_in">never</span></span>) =&gt;</span> &#123;  <span class="comment">// 同名非基础类型属性可以正常合并</span></span><br><span class="line">    <span class="keyword">return</span> value.<span class="title function_">toString</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 联合类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">attr</span>: <span class="title class_">Person</span> | <span class="title class_">Contact</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">omit</span><br><span class="line">以一个类型为基础支持剔除某些属性，然后返回一个新类型。</span><br><span class="line"><span class="title class_">Omit</span>&lt;<span class="title class_">Type</span>, <span class="title class_">Keys</span>&gt;: 取<span class="title class_">Type</span>所有的属性，然后移除其中的keys，作用在对象类型或<span class="keyword">interface</span>上</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span>只能定义对象类型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type 定义任意类型(一旦定义不可添加新属性)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">typeof 获取一个变量或对象的类型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keyof</span><br><span class="line">获取某种类型所有的属性，返回联合类型</span><br><span class="line">eg:</span><br><span class="line">type k1 = keyof <span class="title class_">Person</span>; // &#x27;name&#x27; | &#x27;location&#x27; | &#x27;fn&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Exclude</span></span><br><span class="line"><span class="title class_">Exclude</span>&lt;T, U&gt;: 把 T 类型中属于 U 类型的部分去除掉，返回新的类型(找 T 的差集)</span><br><span class="line">eg:</span><br><span class="line">type myType = <span class="title class_">Exclude</span>&lt;<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">boolean</span>, <span class="built_in">boolean</span>&gt;</span><br><span class="line">var a: myType = false; // a的类型仅能赋值为 <span class="built_in">string</span> | <span class="built_in">number</span> 类型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pick</span><br><span class="line">从指定类型中挑出某些属性,返回挑出属性组成的类型</span><br><span class="line">eg:</span><br><span class="line">type <span class="title class_">User</span> = &#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">lastName</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">UserName</span> = <span class="title class_">Pick</span>&lt;<span class="title class_">User</span>, <span class="string">&quot;firstName&quot;</span> | <span class="string">&quot;lastName&quot;</span>&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>:<span class="title class_">UserName</span> = &#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">lastName</span>: <span class="string">&quot;Doe&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">partial</span><br><span class="line">将类型的属性置为可选</span><br><span class="line"><span class="keyword">type</span> partial&lt;T&gt;= &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[p]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extends</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">断言</span><br><span class="line"><span class="number">1.</span> <span class="keyword">as</span> 语法</span><br><span class="line"><span class="keyword">let</span> <span class="attr">value</span>: <span class="built_in">any</span> = <span class="string">&quot;this is a string&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">length</span>: <span class="built_in">number</span> = (value <span class="keyword">as</span> <span class="built_in">string</span>).<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> !确定断言</span><br><span class="line"><span class="keyword">let</span> name!: <span class="built_in">string</span>;</span><br><span class="line">&gt; 对编译器说：<span class="string">&quot;有一个名为 name 的属性，其类型为 string | undefined。它以值 undefined 开始。但每次获取或设置该属性时，我都希望将其视为类型 string。&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="浏览器端-js-运行机制-Event-Loop">浏览器端 js 运行机制 Event Loop</h3><!-- ![exec-logic](./images/exec-logic.png) --><blockquote><p>在浏览器环境中，有JS引擎线程和渲染线程，且两个线程互斥、Node环境中，只有JS 线程</p></blockquote><ul><li><p>JS 单线程</p><ul><li>同一个时间只能做一件事</li><li>浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM，否则带来很多同步问题</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">比如： 假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？</span><br></pre></td></tr></table></figure><ul><li>特指JS 引擎线程</li></ul></li><li><p>同步任务(Synchronous)</p><ul><li>在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务，形成一个执行栈（Execution Context Stack）</li></ul></li><li><p>异步任务(Asynchronous: JS引擎分配任务至以下两个队列)</p><ul><li><p>宏任务(Macrotask/task Queue)</p><table><thead><tr><th>事件</th><th style="text-align:center">浏览器</th><th style="text-align:center">Node</th></tr></thead><tbody><tr><td>setTimeout</td><td style="text-align:center">√</td><td style="text-align:center">√</td></tr><tr><td>setInterval</td><td style="text-align:center">√</td><td style="text-align:center">√</td></tr><tr><td>setImmediate</td><td style="text-align:center">x</td><td style="text-align:center">√</td></tr><tr><td>requestAnimationFrame</td><td style="text-align:center">√</td><td style="text-align:center">x</td></tr></tbody></table></li><li><p>微任务队列(Microtask/jobs Queue)</p><table><thead><tr><th>事件</th><th style="text-align:center">浏览器</th><th style="text-align:center">Node</th></tr></thead><tbody><tr><td>process.nextTick</td><td style="text-align:center">x</td><td style="text-align:center">√</td></tr><tr><td>MutationObserver</td><td style="text-align:center">√</td><td style="text-align:center">x</td></tr><tr><td>Promise.then catch finally</td><td style="text-align:center">√</td><td style="text-align:center">√</td></tr></tbody></table></li></ul><p><img src="./images/macrotask-microtask.png" alt="macrotask-microtask"></p></li></ul><p><strong>Event Loop</strong></p><blockquote><p>JS 是一门单线程语言，它的异步和多线程是通过 <strong>Event Loop(事件循环机制)</strong> 实现的</p></blockquote><p>主要由三部分组成</p><ul><li>调用栈 Call Stack<ul><li>帧Frame： 被压入的函数 fn</li></ul></li><li>消息队列 Message Queue<ul><li>fetch</li><li>事件回调<ul><li>setTimeout 中的事件回调入队消息队列</li><li>setInterval 中的事件回调入队消息队列</li></ul></li><li>会在调用栈清空时执行</li></ul></li><li>微任务队列 Microtask Queue<ul><li>promise</li><li>async/await</li><li>会在调用栈清空时立即执行，并且处理期间，新加入的微任务也会一同执行</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># <span class="attr">eg</span>:</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;script start&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 start&quot;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>(); <span class="comment">// 返回 Promise 放入事件队列 并让出主线程</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async1 end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timeout&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">  <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;script end&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出结果</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">script start</span></span><br><span class="line"><span class="string">async1 start</span></span><br><span class="line"><span class="string">async2 -&gt; 任务队列 添加任务1、【console.log(&quot;async1 end&quot;)】</span></span><br><span class="line"><span class="string">promise1 -&gt; resolve -&gt; 任务队列添加任务2 【console.log(&#x27;promise2&#x27;)】</span></span><br><span class="line"><span class="string">script end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">开始执行任务队列</span></span><br><span class="line"><span class="string">async1 end</span></span><br><span class="line"><span class="string">promise2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">执行宏任务</span></span><br><span class="line"><span class="string">timeout</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><h3 id="Node-js-环境下-Event-Loop">Node.js 环境下 Event Loop</h3><p><img src="./images/event-loop.node.png" alt="node-event-loop"></p><ul><li>运行机制</li></ul><ol><li>V8引擎解析JavaScript脚本</li><li>解析后的代码，调用Node API</li><li>libuv库负责Node API的执行。它将不同的任务分配给不同的线程，形成一个Event Loop（事件循环），以异步的方式将任务的执行结果返回给V8引擎</li><li>V8引擎再将结果返回给用户</li></ol><h3 id="JS异步编程的四种方式">JS异步编程的四种方式</h3><ul><li><p>回调函数</p><ul><li>优点：简单、容易理解和部署</li><li>缺点：不利于代码的阅读和维护，各个部分之间高度耦合（Coupling），流程会很混乱，而且每个任务只能指定一个回调函数</li></ul></li><li><p>事件驱动模式</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    f1.<span class="title function_">trigger</span>(<span class="string">&#x27;done&#x27;</span> , f2);   <span class="comment">// f1执行完成后，立即触发done事件，从而开始执行f2 </span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>发布/订阅模式</p></li><li><p>Promise</p><ul><li>每一个异步任务返回一个Promise对象，该对象有一个then方法，允许指定回调函数</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># <span class="title class_">Thunk</span>函数: 将参数放到一个临时函数之中，再将这个临时函数传入函数体</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">runAsync</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// executor函数在Promise构造函数返回新建对象前被调用 </span></span><br><span class="line">    <span class="comment">// resolve() 作为func2函数的参数</span></span><br><span class="line">    <span class="comment">// reject()  作为func3函数的参数</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">runAsync</span>()</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function"><span class="params">res</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res),</span><br><span class="line">    <span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">  )</span><br></pre></td></tr></table></figure><ul><li>Js协程<ul><li>异步编程的解决方案</li><li>执行过程<ul><li>第一步，协程A开始执行。</li><li>第二步，协程A执行到一半，进入暂停，执行权转移到协程B。</li><li>第三步，（一段时间后）协程B交还执行权。</li><li>第四步，协程A恢复执行。</li></ul></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncJob</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...其他代码</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="keyword">yield</span> <span class="title function_">readFile</span>(fileA);</span><br><span class="line">  <span class="comment">// ...其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Generator</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params">x</span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="keyword">yield</span> x + <span class="number">2</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>(<span class="number">1</span>); <span class="comment">// 返回一个内部指针（遍历器 ）</span></span><br><span class="line">g.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123; value: 3, done: false &#125;</span></span><br><span class="line"><span class="comment">// value :yield 语句表达式值</span></span><br><span class="line"><span class="comment">// Done:Generator函数是否执行完毕</span></span><br><span class="line">go.<span class="keyword">return</span>() <span class="comment">// 关闭生成器 &#123; value: undefined, Done: true&#125;</span></span><br><span class="line">g.<span class="keyword">throw</span>(<span class="string">&quot;err&quot;</span>) <span class="comment">// 抛出错误</span></span><br></pre></td></tr></table></figure><ul><li>几种<code>I/O</code>处理 写法的优化</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> readFile = <span class="keyword">function</span> (<span class="params">fileName</span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(fileName, <span class="keyword">function</span>(<span class="params">error, data</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) <span class="title function_">reject</span>(error);</span><br><span class="line">      <span class="title function_">resolve</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gen = <span class="keyword">function</span>* ()&#123;</span><br><span class="line">  <span class="keyword">var</span> f1 = <span class="keyword">yield</span> <span class="title function_">readFile</span>(<span class="string">&#x27;/etc/fstab&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> f2 = <span class="keyword">yield</span> <span class="title function_">readFile</span>(<span class="string">&#x27;/etc/shells&#x27;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(f1.<span class="title function_">toString</span>());</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(f2.<span class="title function_">toString</span>());</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>();</span><br><span class="line">g.<span class="title function_">next</span>();</span><br><span class="line">g.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"># 使用<span class="keyword">async</span>来处理</span><br><span class="line"><span class="keyword">var</span> asyncReadFile = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> f1 = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="string">&#x27;/etc/fstab&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> f2 = <span class="keyword">await</span> <span class="title function_">readFile</span>(<span class="string">&#x27;/etc/shells&#x27;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(f1.<span class="title function_">toString</span>());</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(f2.<span class="title function_">toString</span>());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>Web Worker<ul><li>利用CPU多核计算能力,HTML5中的Web Worker 允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。</li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<ul><li>JS中长用的几种数组遍历方式</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">map</span>():对数组中每一项运行给定函数。返回每次函数调用的结果组成的数组(新数组)</span><br><span class="line"><span class="keyword">const</span> arr=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line">arr1 = arr.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;<span class="keyword">return</span> item*<span class="number">2</span>&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr1);</span><br><span class="line"><span class="comment">// [2, 4, 6, 8, 10, 12]</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">filter</span>():对数组中的每一项运行给定函数，返回结果为<span class="literal">true</span>的项组成的新数组</span><br><span class="line"><span class="keyword">const</span> sporter=[</span><br><span class="line">  &#123; <span class="attr">name</span>:<span class="string">&#x27;aa&#x27;</span>, <span class="attr">isHell</span>:<span class="literal">null</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>:<span class="string">&#x27;bb&#x27;</span>, <span class="attr">isHell</span>:<span class="literal">null</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>:<span class="string">&#x27;bb&#x27;</span>, <span class="attr">isHell</span>:<span class="literal">true</span> &#125;</span><br><span class="line">]; </span><br><span class="line"></span><br><span class="line"><span class="comment">// isHell:true--&gt;签到</span></span><br><span class="line"><span class="keyword">const</span> arr = sporter.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">item</span>)&#123;<span class="keyword">return</span> item.<span class="property">isHell</span>&#125;)</span><br><span class="line"><span class="comment">// [&#123;name:&#x27;bb&#x27;,isHell:true&#125;] </span></span><br><span class="line"></span><br><span class="line">数组去重：filter</span><br><span class="line"><span class="keyword">var</span> r=[],arr = [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;strawberry&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;strawberry&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,len=arr.<span class="property">length</span>;i&lt;len;i++)&#123;</span><br><span class="line">  <span class="keyword">if</span>(r.<span class="title function_">indexOf</span>(arr[i]) === -<span class="number">1</span>)&#123;</span><br><span class="line">    r.<span class="title function_">push</span>(arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = arr.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">item,index,self</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> self.<span class="title function_">indexOf</span>(item) === index;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">every</span>()对数组中的每一项运行给定函数，如果该函数对每一项都返回<span class="literal">true</span>，则返回<span class="literal">true</span>;</span><br><span class="line"><span class="title function_">some</span>()对数组中的每一项运行给定函数，如果该函数对任一项返回<span class="literal">true</span>，则返回<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isIn; <span class="comment">//标识</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,len=sporter.<span class="property">length</span>;i&lt;len;i++)&#123;</span><br><span class="line">  <span class="keyword">if</span>(!sporter[i].<span class="property">isHell</span>)&#123;</span><br><span class="line">    isIn=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span>;  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 案例：运动员进场如果需要每一个球员都必须签到，球队才能进场</span></span><br><span class="line"><span class="keyword">const</span> arr = sporter.<span class="title function_">every</span>(<span class="keyword">function</span> (<span class="params">item</span>)&#123;<span class="keyword">return</span> item.<span class="property">isHell</span>&#125;);</span><br><span class="line"><span class="comment">// 运动员进场只需要球队任意一个运动员签到，球队就能进场</span></span><br><span class="line"><span class="keyword">const</span> arr = sporter.<span class="title function_">some</span>(<span class="keyword">function</span> (<span class="params">item</span>)&#123;<span class="keyword">return</span> item.<span class="property">isHell</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">reduce</span>():**重点对两个参数理解**作用效果和原理就是 </span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">reduce</span>(f) = <span class="title function_">f</span>(<span class="title function_">f</span>(<span class="title function_">f</span>(x1, x2), x3), x4) </span><br><span class="line"><span class="comment">// [x1, x2, x3, x4]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sum=<span class="number">0</span>,arr=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,len=arr.<span class="property">length</span>;i&lt;len;i++)&#123;</span><br><span class="line">  sum+=arr[i]</span><br><span class="line">&#125;</span><br><span class="line">sum=arr.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">a,b</span>) &#123;<span class="keyword">return</span> a+b&#125;);</span><br><span class="line">**<span class="keyword">for</span>...<span class="keyword">in</span> 循环遍历的结果是数组元素的下标， <span class="keyword">for</span>...<span class="keyword">of</span> 遍历的结果是元素的值**</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line">arr.<span class="property">foo</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// logs &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;foo&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> arr) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// logs &quot;3&quot;, &quot;5&quot;, &quot;7&quot; // 注意这里没有 hello</span></span><br><span class="line">&#125;</span><br><span class="line">利用<span class="keyword">for</span>...<span class="keyword">in</span> 遍历对象---&gt;遍历该对象所有可枚举的属性：</span><br><span class="line"><span class="keyword">let</span> obj=&#123;<span class="string">&quot;name&quot;</span>:lijiahao,<span class="string">&quot;age&quot;</span>:<span class="number">24</span>,<span class="string">&quot;sex&quot;</span>:man&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">// logs name age sex</span></span><br><span class="line">&#125;</span><br><span class="line">利用<span class="keyword">for</span>...<span class="keyword">of</span> ：</span><br><span class="line"><span class="number">1</span>、遍历字符串</span><br><span class="line"><span class="number">2</span>、遍历类数组对象</span><br><span class="line"><span class="number">3</span>、支持 <span class="title class_">Map</span> 和 <span class="title class_">Set</span> 对象遍历</span><br><span class="line"><span class="attr">typeof</span>:判断基本数据类型</span><br><span class="line"><span class="title class_">Instanceof</span>:判断某个对象是否属于某一类</span><br><span class="line">迭代器</span><br><span class="line">数组的<span class="attr">iterator</span>:</span><br><span class="line">arr[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]()</span><br><span class="line"><span class="keyword">var</span> arr = [<span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> eArr = arr[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(eArr.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// w</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(eArr.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// y</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(eArr.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// k</span></span><br><span class="line">数组的<span class="title function_">value</span>():</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> eArr = arr.<span class="title function_">values</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(eArr.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// w</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(eArr.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// y</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(eArr.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// k</span></span><br><span class="line"><span class="title class_">Map</span>对象：</span><br><span class="line"><span class="keyword">var</span> myMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">var</span> keyString = <span class="string">&#x27;a string&#x27;</span>,</span><br><span class="line">    keyObj = &#123;&#125;,</span><br><span class="line">    keyFunc = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="comment">// setting the values</span></span><br><span class="line">myMap.<span class="title function_">set</span>(keyString, <span class="string">&quot;value associated with &#x27;a string&#x27;&quot;</span>);</span><br><span class="line">myMap.<span class="title function_">set</span>(keyObj, <span class="string">&#x27;value associated with keyObj&#x27;</span>);</span><br><span class="line">myMap.<span class="title function_">set</span>(keyFunc, <span class="string">&#x27;value associated with keyFunc&#x27;</span>);</span><br><span class="line">myMap.<span class="property">size</span>; <span class="comment">// 3</span></span><br><span class="line"><span class="comment">// getting the values</span></span><br><span class="line">myMap.<span class="title function_">get</span>(keyString); <span class="comment">// value associated with &#x27;a string&#x27;</span></span><br><span class="line">myMap.<span class="title function_">get</span>(<span class="string">&#x27;a string&#x27;</span>);   <span class="comment">// &quot;value associated with &#x27;a string&#x27;&quot;</span></span><br><span class="line">                       <span class="comment">// because keyString === &#x27;a string&#x27;</span></span><br><span class="line">myMap.<span class="title function_">get</span>(&#123;&#125;);           <span class="comment">// undefined, because keyObj !== &#123;&#125;</span></span><br><span class="line">myMap.<span class="title function_">get</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;) <span class="comment">// undefined, because keyFunc !== function () &#123;&#125;</span></span><br><span class="line"><span class="title class_">Case</span>：</span><br><span class="line"><span class="keyword">let</span> myMap = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&quot;a&quot;</span>, <span class="number">1</span>], [<span class="string">&quot;b&quot;</span>, <span class="number">2</span>], [<span class="string">&quot;c&quot;</span>, <span class="number">3</span>]]);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> [key,value] <span class="keyword">of</span> myMap)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(key+<span class="string">&quot; : &quot;</span>+value) </span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Set</span>对象:</span><br><span class="line">words=[<span class="string">&quot;ruby&quot;</span>,<span class="string">&quot;java&quot;</span>,<span class="string">&quot;ruby&quot;</span>,<span class="string">&quot;java&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> uniqueWords=<span class="keyword">new</span> <span class="title class_">Set</span>(words);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> word <span class="keyword">of</span> uniqueWords)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(word) </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable constant_">JS</span>几种常用的<span class="string">&quot;跳转语句&quot;</span>:</span><br><span class="line"><span class="attr">return</span>:终止函数体的运行，并返回一个值</span><br><span class="line"><span class="attr">break</span>:终止整个循环，不再进行判断</span><br><span class="line">如：<span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;     <span class="comment">//  0\0\1\2  ----中断此次循环</span></span><br><span class="line">  <span class="keyword">if</span> (i==<span class="number">3</span>)&#123; <span class="keyword">break</span>;&#125;</span><br><span class="line">  x=x + <span class="string">&quot;\&quot; + i;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">continue:结束本次循环，接着去判断是否执行下次循环</span></span><br><span class="line"><span class="string">for (i=0;i&lt;=10;i++)&#123;    // 跳过 i = 3 的循环</span></span><br><span class="line"><span class="string"> if (i==3) continue;</span></span><br><span class="line"><span class="string">  x=x + &quot;</span><span class="title class_">The</span> number is <span class="string">&quot; + i + &quot;</span>&lt;br&gt;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Js中的错误处理：</span></span><br><span class="line"><span class="string">try &#123;</span></span><br><span class="line"><span class="string">  allert(&quot;</span><span class="number">123</span><span class="string">&quot;);     // 定义在执行时进行错误测试的代码块</span></span><br><span class="line"><span class="string">&#125;catch(err)&#123;</span></span><br><span class="line"><span class="string">  console.log(err);  // 定义当 try 代码块发生错误时，所执行的代码块</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="普通-JS-函数">普通 JS 函数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">`</span></span><br><span class="line"><span class="string">return (</span></span><br><span class="line"><span class="string">  async function(mouseEvent)&#123;</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;fnStr&#125;</span></span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">)`</span>)()</span><br></pre></td></tr></table></figure><h2 id="组件生命周期事件">组件生命周期事件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lifeEvents = &#123;</span><br><span class="line">  <span class="title function_">vnodeBeforeMount</span>(<span class="params">evt: any</span>) &#123;</span><br><span class="line">    <span class="title function_">generateFunc</span>(fnStr, e)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成高级函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fnStr 用户方法体代码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e 执行生命周期的动态组件实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateFunc</span>(<span class="params">fnStr: string, e: any</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// npmPkgs 便于拷贝 echarts 示例时设置 option 的formatter等相关内容</span></span><br><span class="line">    <span class="title class_">Function</span>(<span class="string">`</span></span><br><span class="line"><span class="string">      &quot;use strict&quot;;</span></span><br><span class="line"><span class="string">      return (</span></span><br><span class="line"><span class="string">        async function(e, components, node_modules)&#123;</span></span><br><span class="line"><span class="string">          const &#123;<span class="subst">$&#123;<span class="built_in">Object</span>.keys(npmPkgs).join()&#125;</span>&#125; = node_modules;</span></span><br><span class="line"><span class="string">          <span class="subst">$&#123;fnStr&#125;</span></span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      )`</span>)().<span class="title function_">bind</span>(e?.<span class="property">component</span>)(e, components, npmPkgs)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>DOMContentLoaded</strong></p><ul><li>当纯HTML被完全加载以及解析时触发，不必等待样式表，图片或者子框架完全加载</li></ul><p><strong>onload</strong></p><ul><li>页面加载完毕触发</li></ul><p><strong>DOMContentLoaded和onload区别</strong></p><table><thead><tr><th>-</th><th><strong>DOMContentLoaded</strong></th><th><strong>onload</strong></th></tr></thead><tbody><tr><td>执行时机</td><td>在<code>html</code><strong>解析完毕</strong>后执行</td><td>在页面<strong>所有元素（包括图片+页面）加载完成</strong>后执行</td></tr><tr><td>执行次数</td><td>可执行多次、并且可以按顺序得到执行</td><td>只执行最后一个</td></tr></tbody></table><p><strong>defer</strong></p><ul><li>在<code>html解析完成</code>后，在触发<code>DOMContentLoaded事件</code>前执行</li></ul><p><strong>浏览器加载步骤</strong></p><ol><li>解析html结构</li><li>加载外部js脚本和样式表文件（<strong>预扫描</strong>）</li><li>解析并执行js脚本</li><li>Dom树构建完成（html解析完毕），触发<code>onready</code>即<code>DOMContentLoaded</code>事件</li><li>加载图片等外部文件（完成后触发 图片的 <code>onload</code>）</li><li>页面加载完毕（完成后触发 页面的<code>onload</code>）</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&#x27;a.js&#x27;</span> defer&gt;&lt;/srcipt&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;b.js&#x27;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;/<span class="name">srcipt</span>&gt;</span></span></span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;event start&#x27;</span>)</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DOMContentLoaded finish&#x27;</span>))</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onload finish&#x27;</span>))</span></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> i = <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">while</span>(i &lt; <span class="number">100</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      i++;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;compute finished&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="Async-函数原理">Async 函数原理</h3><ul><li>generator + co 合体</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">spawn</span>(<span class="params">genF</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> gen = <span class="title function_">genF</span>();</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">step</span>(<span class="params">nextF</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> next;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        next = <span class="title function_">nextF</span>();</span><br><span class="line">      &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reject</span>(e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(next.<span class="property">done</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">resolve</span>(next.<span class="property">value</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(next.<span class="property">value</span>).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">v</span>) &#123;</span><br><span class="line">        <span class="title function_">step</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> gen.<span class="title function_">next</span>(v); &#125;);</span><br><span class="line">      &#125;, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="title function_">step</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> gen.<span class="keyword">throw</span>(e); &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">step</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> gen.<span class="title function_">next</span>(<span class="literal">undefined</span>); &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="并发请求-Concurrent-Fetch">并发请求 Concurrent Fetch</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 方案一：</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">logInFetch</span>(<span class="params">urls</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> r_json = urls.<span class="title function_">map</span>(<span class="keyword">async</span> url =&gt; (<span class="keyword">await</span> <span class="title function_">fetch</span>(url)));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">of</span> r_json) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> item.<span class="title function_">text</span>())</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案二： 并行执行独立的异步操作，并收集这些异步操作完成的结果</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">allSettled</span>([</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/api1&#x27;</span>),</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/api2&#x27;</span>),</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/api3&#x27;</span>),</span><br><span class="line">])</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="js-继承-封装-多态">js 继承 封装 多态</h2><h3 id="new">new</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> 一个对象，发生经历如下步骤：</span><br><span class="line"><span class="number">1.</span> 创建一个对象</span><br><span class="line"><span class="number">2.</span> 将对象的 <span class="string">`__proto__`</span> 指向构造函数的 <span class="string">`prototype`</span></span><br><span class="line"><span class="number">3.</span> 将构造函数的作用域赋值给新对象[因此<span class="variable language_">this</span>指向这个对象]</span><br><span class="line"><span class="number">4.</span> 执行构造函数中的代码[为该对象添加属性]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">自定义实现 <span class="keyword">new</span> 操作符功能</span><br><span class="line"><span class="keyword">var</span> _new = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> instance = [].<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">  o.<span class="property">__proto__</span> = instance.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  instance.<span class="title function_">apply</span>(o, <span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="寄生组合式继承">寄生组合式继承</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">clone</span> (parent, child) &#123;    </span><br><span class="line">  child.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(parent.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  child.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = child;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">species</span> = <span class="string">&quot;animal&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getSpecies</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">species</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 对比 子类 原型指向父类实例，这种继承方式有啥区别？</span></span><br><span class="line"><span class="comment"> * Cat.prototype = new Animal();</span></span><br><span class="line"><span class="comment"> * 1. Object.create 就可以减少组合继承中多进行一次构造的过程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">clone</span>(<span class="title class_">Animal</span>, <span class="title class_">Cat</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;毛毛&#x27;</span>, <span class="number">12</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="title function_">getName</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="title function_">getSpecies</span>());</span><br></pre></td></tr></table></figure><h3 id="ES6-的-extends">ES6 的 extends</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">species</span> = <span class="string">&quot;animal&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 原型方法</span></span><br><span class="line">  <span class="comment">// 即 Animal.prototype.getSpecies = function() &#123; &#125;</span></span><br><span class="line">  <span class="comment">// 下面可以简写为 getSpecies() &#123;...&#125;</span></span><br><span class="line">  getSpecies = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;species:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">species</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="comment">// 子类中存在构造函数，则需要在使用“this”之前首先调用 super()。</span></span><br><span class="line">    <span class="variable language_">super</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span>  = age;</span><br><span class="line">  &#125;</span><br><span class="line">  getName = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name: &quot;</span>, <span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> mm = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;毛毛&#x27;</span>, <span class="number">20</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mm)</span><br><span class="line">mm.<span class="title function_">getName</span>()</span><br><span class="line">mm.<span class="title function_">getSpecies</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 备注</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">extend</span>(<span class="params">Cat, Animal</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="keyword">var</span> c = <span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> a) &#123;</span><br><span class="line">    c[i] = a[i];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 模拟class 时用来表示super的(javascript 本身无此属性)</span></span><br><span class="line">  c.<span class="property">uber</span> = a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(<span class="title class_">Cat</span>, <span class="title class_">Animal</span>);</span><br></pre></td></tr></table></figure><h3 id="extends-底层实现">extends 底层实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_possibleConstructorReturn</span> (self, call) &#123; </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> call &amp;&amp; (<span class="keyword">typeof</span> call === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> call === <span class="string">&#x27;function&#x27;</span>) ? call : self; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_inherits</span> (subClass, superClass) &#123; </span><br><span class="line">  <span class="comment">// 这里可以看到</span></span><br><span class="line">subClass.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(superClass &amp;&amp; superClass.<span class="property"><span class="keyword">prototype</span></span>, &#123; </span><br><span class="line"><span class="attr">constructor</span>: &#123; </span><br><span class="line"><span class="attr">value</span>: subClass, </span><br><span class="line"><span class="attr">enumerable</span>: <span class="literal">false</span>, </span><br><span class="line"><span class="attr">writable</span>: <span class="literal">true</span>, </span><br><span class="line"><span class="attr">configurable</span>: <span class="literal">true</span> </span><br><span class="line">&#125; </span><br><span class="line">&#125;); </span><br><span class="line"><span class="keyword">if</span> (superClass) <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span> ? <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(subClass, superClass) : subClass.<span class="property">__proto__</span> = superClass; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Parent</span> = <span class="keyword">function</span> <span class="title function_">Parent</span> () &#123;</span><br><span class="line"><span class="comment">// 验证是否是 Parent 构造出来的 this</span></span><br><span class="line"><span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, <span class="title class_">Parent</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Child</span> = (<span class="keyword">function</span> (<span class="params">_Parent</span>) &#123;</span><br><span class="line"><span class="title function_">_inherits</span>(<span class="title class_">Child</span>, _Parent);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span> () &#123;</span><br><span class="line"><span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, <span class="title class_">Child</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">_possibleConstructorReturn</span>(<span class="variable language_">this</span>, (<span class="title class_">Child</span>.<span class="property">__proto__</span> || <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(<span class="title class_">Child</span>)).<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Child</span>;</span><br><span class="line">&#125;(<span class="title class_">Parent</span>));</span><br></pre></td></tr></table></figure><h3 id="多态">多态</h3><ul><li>同一行为具有多种不同 表现形式</li><li>因 <code>多重继承</code> 使得 方法具有多态性</li><li>将<code>做什么</code> 和 <code>谁去做以及怎样去做</code> 分开</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用es6 class简化代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">sayName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Parent&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span>&#123;</span><br><span class="line">  <span class="title function_">sayName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Child&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> <span class="title class_">Child</span>();</span><br><span class="line">child.<span class="title function_">sayName</span>(); <span class="comment">// &#x27;Child&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line">parent.<span class="title function_">sayName</span>(); <span class="comment">// &#x27;Parent&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="封装">封装</h3><ul><li>行为内部的具体实现进行包装</li></ul><h3 id="instanceof-底层实现">instanceof 底层实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;wangwang&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;mimi&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(a.<span class="property">__proto__</span> === b.<span class="property"><span class="keyword">prototype</span></span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(a.<span class="property">__proto__</span> === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    a = a.<span class="property">__proto__</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">myInstanceof</span>(d, <span class="title class_">Dog</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="单例模式">单例模式</h3><blockquote><p>限制一个类只能有一个实例化对象</p></blockquote><ul><li>es5</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">SingletonStencil</span> = (<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Singleton</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Singleton</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> instance = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!instance)&#123;</span><br><span class="line">      instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="title class_">SingletonStencil</span>(<span class="string">&#x27;张三&#x27;</span>).<span class="title function_">getName</span>();</span><br><span class="line"><span class="keyword">var</span> b = <span class="title class_">SingletonStencil</span>(<span class="string">&#x27;李四&#x27;</span>).<span class="title function_">getName</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, a === b);</span><br></pre></td></tr></table></figure><ul><li>es6</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingletonStencil</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">instance</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getInstance</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">instance</span> = <span class="variable language_">this</span>.<span class="property">instance</span> || <span class="keyword">new</span> <span class="title class_">SingletonStencil</span>(name)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">instance</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="title class_">SingletonStencil</span>.<span class="title function_">getInstance</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> b = <span class="title class_">SingletonStencil</span>.<span class="title function_">getInstance</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, a === b);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://juejin.cn/post/6977774991798435854">https://juejin.cn/post/6977774991798435854</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="发布订阅模式">发布订阅模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventEmitter</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 事件对象，存放订阅的名字和事件</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">events</span> = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 订阅事件的方法，添加订阅者</span></span><br><span class="line">    <span class="title function_">on</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">events</span>[eventName])&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">events</span>[eventName] = [callback]</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">push</span>(callback)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 触发事件的方法，发布消息</span></span><br><span class="line">    <span class="title function_">emit</span>(<span class="params">eventName</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">events</span>[eventName] &amp;&amp; <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> <span class="title function_">cb</span>())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 发布2，有参数</span></span><br><span class="line">    <span class="title function_">emit2</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> eventName = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);<span class="comment">//第一个参数为事件名称eventName，并移除</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">forEach</span>(<span class="function"><span class="params">cb</span> =&gt;</span> cb.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 移除订阅事件</span></span><br><span class="line">    <span class="title function_">removeListener</span>(<span class="params">eventName,callback</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">events</span>[eventName])&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">events</span>[eventName] = <span class="variable language_">this</span>.<span class="property">events</span>[eventName].<span class="title function_">filter</span>(<span class="function"><span class="params">cb</span> =&gt;</span> cb != callback)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 只执行一次订阅的事件，然后移除</span></span><br><span class="line">    <span class="title function_">once</span>(<span class="params">eventName,callback</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">           <span class="title function_">callback</span>()</span><br><span class="line">           <span class="variable language_">this</span>.<span class="title function_">removeListener</span>(eventName,fn)</span><br><span class="line">        &#125;       </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">on</span>(eventName,fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> em = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();</span><br><span class="line">em.<span class="title function_">on</span>(<span class="string">&quot;work&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;work everyday&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">em.<span class="title function_">emit</span>(<span class="string">&quot;work&quot;</span>) <span class="comment">// work everyday</span></span><br><span class="line"></span><br><span class="line">em.<span class="title function_">once</span>(<span class="string">&quot;only&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;just love you&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">em.<span class="title function_">emit</span>(<span class="string">&quot;only&quot;</span>) <span class="comment">// just love you</span></span><br><span class="line"></span><br><span class="line">em.<span class="title function_">emit</span>(<span class="string">&quot;work&quot;</span>) <span class="comment">// work everyday</span></span><br><span class="line">em.<span class="title function_">emit</span>(<span class="string">&quot;only&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试移除</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeMoney</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;make one million money&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">em.<span class="title function_">on</span>(<span class="string">&quot;money&quot;</span>,makeMoney)</span><br><span class="line">em.<span class="title function_">emit</span>(<span class="string">&quot;money&quot;</span>) <span class="comment">// make one million money</span></span><br><span class="line">em.<span class="title function_">removeListener</span>(<span class="string">&quot;money&quot;</span>, makeMoney)</span><br><span class="line">em.<span class="title function_">emit</span>(<span class="string">&quot;money&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 赚一个亿是不可能的，但只能爱一人</span></span><br><span class="line"></span><br><span class="line">em.<span class="title function_">on</span>(<span class="string">&quot;study&quot;</span>, <span class="keyword">function</span> (<span class="params">val, val2</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;study&#x27;</span> + val + val2)</span><br><span class="line">&#125;)</span><br><span class="line">em.<span class="title function_">emit2</span>(<span class="string">&quot;study&quot;</span>,<span class="number">1</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[/** * 函数组合 * @param  {...any} fns 函数集(每个函数仅接收一个参数) * @returns 新函数 * 把处理数据的函数像管道一样连接起来，让数据穿过管道得到最终结果 * 特点： * 1. 上游函数输入作为下游函数输入 */ function compose(...fns) {  return (...args) => fns.reduce((arg, currentFn) => currentFn.apply(this, Array.isArray(arg) ? arg : [arg]), args)}function fn1(...args) {  return args.reduce((total, current) => (total += current, total), 0)}function fn2(arg) {  return 2 * arg;}function fn3(arg) {  return arg + 'aaa';}const res = compose(fn1, fn2, fn3)(1, 2, 3);console.log(res)]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[/** *  */function flat(arr) {  const result = [];  (function innerFlat(arr) {    for(let item of arr) {      if(Array.isArray(item)) {        innerFlat(item)      }else{        result.push(item)      }    }  })(arr)  return result;}console.log(flat([1, [2, 3, [4, 5]]]))]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[/** * 题目一: * 实现一个promiseTimeout函数，该函数接收两个参数：第一个参数为promise，第二个参数为number类型，该函数作用： * 1. 若promise在第二个参数给定的时间内处于pending状态，则返回一个rejected的promise，其reason为 new Error('promise time out') * 2. 若promise在第二个参数给定的时间内处于非pending状态，则返回该promise */const timeout = time => new Promise((resolve, reject) => (  setTimeout(reject, time, new Error('promise time out'))))const p = time => new Promise(resolve => setTimeout(resolve, time, 'resolved'))const promiseTimeout = (promise, time) => Promise.race([promise, timeout(time)])console.log(  promiseTimeout(p(6000), 1000))/** * 题目二: */const obj = {};const arr = [1, 2, 3];function fn(arrTemp, objTemp) {  arrTemp = [];  objTemp.a = 1;  objTemp = { b: 2 };}fn(arr, obj)console.log('arr=', arr, 'obj=', obj);/** * 题目三： */function find(data, target, k) {  let ret = [];  const dfs = (d, k) => {    if(k === 0) {      const t = d.queryselectorAll(`${target}`);      ret = ret.concat(...t)    }else {      if(d.children.length) {        for(let i = 0; i< d.children.length; i++) {          dfs(d.children[i], k-1)        }      }    }  }  dfs(data, k)  return ret;}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[function defaultEquality(a, b) {  // 必须都是数组  if(!Array.isArray(a) || !Array.isArray(b)) {    return false;  }  // 长度必须相等  if(a.length !== b.length) {    return false;  }  for(let index = 0; index < a.length; index++) {    if(a[index] !== b[index]) {      return false;    }  }  return true;}// reselector 或者react.memo 都是只保存最近一次缓存function cacheLastMemo(fn, equalitycheck = defaultEquality) {    let lastArgs   = null;  let lastResult = null;  return function(...args) {    if(!equalitycheck(lastArgs, args)){      console.log('get result from fn')      lastResult = fn.apply(this, args)    }else {      console.log('get result from cache')          }    lastArgs = args;    return lastResult;  }}function division(a, b) {  return a / b;}const divisionMemo = cacheLastMemo(division)console.log(divisionMemo(10, 2))console.log(divisionMemo(10, 2))]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[// 串形执行 Promisefunction runPromiseInSequence(arr, input) {  return arr.reduce(    (promiseChain, currentFn) => promiseChain.then(currentFn),    Promise.resolve(input)  )}function p1(a) {  return new Promise(resolve => resolve(a * 1))}function p2(a) {  return new Promise(resolve => resolve(a * 2))}function p3(a) {  return a * 3   // return Promise.resolve(a * 3)}function p4(a) {  return new Promise(resolve => resolve(a * 4))}const promiseArr = [p1, p2, p3, p4];runPromiseInSequence(promiseArr, 1).then(console.log)]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[// Fibonacci 数列/** * 递归 * 1. 要有边界条件，防止无限递归 * 2. 要有子问题，复杂问题分解，确定递归公式 * eg: 1、1、2、3、5、8、13、21、... */function fib(n) {  if(n < 3) return 1;  return fib(n - 2) + fib(n - 1);}// 循环function fib2(n) {  let first = 1, second = 1;  while(n-- > 2) {    [first, second] = [second, first + second];  }  return second;}console.log(fib(3))/** * 尾调用优化 * 1. 最后一步是调用另一个函数，不一定出现在函数尾部，主要是最后一步操作即可 * 2. 并且最后一步不能有其他操作，比如前面return fib(n-2) + fib(n-1) */function fibTail(n, first = 1, second = 1) {  if(n < 3) return second;  return fibTail(n-1, second, first+second)}/** * 展开数组 */function flat(arr) {  const result = [];  (function innerFlat(arr) {    for(let i = 0; i < arr.length; i++) {      const element = arr[i];      if(Array.isArray(element)){        innerFlat(element)      }else{        result.push(element)      }    }  })(arr)  return result;}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="数据类型">数据类型</h2><h3 id="JavaScript-数据类型">JavaScript 数据类型</h3><ul><li>undefined</li><li>Null</li><li>Boolean</li><li>String</li><li>Number</li><li>Symbol</li><li>BigInt</li><li>Object<ul><li>Array</li><li>RegExp</li><li>Date</li><li>Math</li><li>Function</li></ul></li></ul><h3 id="数据存储">数据存储</h3><ul><li>基本类型存储在栈内存，被引用或拷贝时，会创建一个完全相等的变量</li><li>引用类型存储在堆内存，存储的是地址，多个引用指向同一个地址</li></ul><h3 id="数据类型检测">数据类型检测</h3><ul><li><p>typeof[判断基本数据类型]</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="number">1</span> <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;1&#x27;</span> <span class="comment">// &#x27;string&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span> <span class="comment">// &#x27;undefined&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">true</span> <span class="comment">// &#x27;boolean&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="title class_">Symbol</span>() <span class="comment">// &#x27;symbol&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span> <span class="comment">// &#x27;object&#x27;[JS的Bug, 可用 === 来判断]</span></span><br><span class="line"><span class="keyword">typeof</span> [] <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> &#123;&#125; <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="variable language_">console</span> <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="variable language_">console</span>.<span class="property">log</span> <span class="comment">// &#x27;function&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>instanceof[判断对象是否属于某种类型]</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Car</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> benz = <span class="keyword">new</span> <span class="title class_">Car</span>()</span><br><span class="line">benz <span class="keyword">instanceof</span> <span class="title class_">Car</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p>自定义 instanceof 的底层实现</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">left, right</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里先用typeof来判断基础数据类型，如果是，直接返回false</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> left !== <span class="string">&#x27;object&#x27;</span> || left === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// getPrototypeOf是Object对象自带的API，能够拿到参数的原型对象</span></span><br><span class="line">  <span class="keyword">let</span> proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(left);</span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>) &#123;                  <span class="comment">// 循环往下寻找，直到找到相同的原型对象</span></span><br><span class="line">    <span class="keyword">if</span>(proto === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(proto === right.<span class="property"><span class="keyword">prototype</span></span>) <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 找到相同原型对象，返回true</span></span><br><span class="line">    proto = <span class="title class_">Object</span>.<span class="title function_">getPrototypeof</span>(proto);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 验证一下自己实现的myInstanceof是否OK</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">myInstanceof</span>(<span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">123</span>), <span class="title class_">Number</span>));    <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">myInstanceof</span>(<span class="number">123</span>, <span class="title class_">Number</span>));                <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li><li><p>Object.prototype.toString[Object 的原型方法、返回’[object Xxx]', 其中 Xxx是对象的类型]</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">toString</span>(&#123;&#125;)       <span class="comment">// &quot;[object Object]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(&#123;&#125;)  <span class="comment">// 同上结果，加上call也ok</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="number">1</span>)    <span class="comment">// &quot;[object Number]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="string">&#x27;1&#x27;</span>)  <span class="comment">// &quot;[object String]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">true</span>)  <span class="comment">// &quot;[object Boolean]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;)  <span class="comment">// &quot;[object Function]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">null</span>)   <span class="comment">//&quot;[object Null]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">undefined</span>) <span class="comment">//&quot;[object Undefined]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="regexp">/123/g</span>)    <span class="comment">//&quot;[object RegExp]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()) <span class="comment">//&quot;[object Date]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>([])       <span class="comment">//&quot;[object Array]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="variable language_">document</span>)  <span class="comment">//&quot;[object HTMLDocument]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="variable language_">window</span>)   <span class="comment">//&quot;[object Window]&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>全局通用数据类型判断</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getType</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> type  = <span class="keyword">typeof</span> obj;</span><br><span class="line">  <span class="keyword">if</span> (type !== <span class="string">&quot;object&quot;</span>) &#123;    <span class="comment">// 先进行typeof判断，如果是基础数据类型，直接返回</span></span><br><span class="line">    <span class="keyword">return</span> type;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 对于typeof返回结果是object的，再进行如下的判断，正则返回结果</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj).<span class="title function_">replace</span>(<span class="regexp">/^\[object (\S+)\]$/</span>, <span class="string">&#x27;$1&#x27;</span>);  <span class="comment">// 注意正则中间有个空格</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 代码验证，需要注意大小写，哪些是typeof判断，哪些是toString判断？思考下 */</span></span><br><span class="line"><span class="title function_">getType</span>([])     <span class="comment">// &quot;Array&quot; typeof []是object，因此toString返回</span></span><br><span class="line"><span class="title function_">getType</span>(<span class="string">&#x27;123&#x27;</span>)  <span class="comment">// &quot;string&quot; typeof 直接返回</span></span><br><span class="line"><span class="title function_">getType</span>(<span class="variable language_">window</span>) <span class="comment">// &quot;Window&quot; toString返回</span></span><br><span class="line"><span class="title function_">getType</span>(<span class="literal">null</span>)   <span class="comment">// &quot;Null&quot;首字母大写，typeof null是object，需toString来判断</span></span><br><span class="line"><span class="title function_">getType</span>(<span class="literal">undefined</span>)   <span class="comment">// &quot;undefined&quot; typeof 直接返回</span></span><br><span class="line"><span class="title function_">getType</span>()            <span class="comment">// &quot;undefined&quot; typeof 直接返回</span></span><br><span class="line"><span class="title function_">getType</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;) <span class="comment">// &quot;function&quot; typeof能判断，因此首字母小写</span></span><br><span class="line"><span class="title function_">getType</span>(<span class="regexp">/123/g</span>)      <span class="comment">//&quot;RegExp&quot; toString返回</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="数据类型转换">数据类型转换</h3><ul><li><p>强制类型转换</p><ul><li><p>Number() 方法的强制转换规则</p><ul><li>如果是布尔值，true 和 false 分别被转换为 1 和 0</li><li>如果是数字，返回自身</li><li>如果是 null，返回 0</li><li>如果是 undefined，返回 NaN</li><li>如果是字符串，遵循以下规则:<ul><li>如果字符串中只包含数字（或者是 0X / 0x 开头的十六进制数字字符串，允许包含正负号），则将其转换为十进制</li><li>如果字符串中包含有效的浮点格式，将其转换为浮点数值</li><li>如果是空字符串，将其转换为 0</li><li>如果不是以上格式的字符串，均返回 NaN</li></ul></li><li>如果是 Symbol，抛出错误；</li><li>如果是对象，并且部署了 [Symbol.toPrimitive] ，那么调用此方法，否则调用对象的 valueOf() 方法，然后依据前面的规则转换返回的值；如果转换的结果是 NaN ，则调用对象的 toString() 方法，再次依照前面的顺序转换返回对应的值（Object 转换规则会在下面细讲）</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Number</span>(<span class="literal">true</span>);        <span class="comment">// 1</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="literal">false</span>);       <span class="comment">// 0</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="string">&#x27;0111&#x27;</span>);      <span class="comment">//111</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="literal">null</span>);        <span class="comment">//0</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="string">&#x27;&#x27;</span>);          <span class="comment">//0</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="string">&#x27;1a&#x27;</span>);        <span class="comment">//NaN</span></span><br><span class="line"><span class="title class_">Number</span>(-<span class="number">0X11</span>);       <span class="comment">//-17</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="string">&#x27;0X11&#x27;</span>)       <span class="comment">//17</span></span><br></pre></td></tr></table></figure></li><li><p>Boolean() 方法的强制转换规则</p><ul><li>除了 undefined、 null、 false、 ‘’、 0（包括 +0，-0）、 NaN 转换出来是 false，其他都是 true</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Boolean</span>(<span class="number">0</span>)          <span class="comment">//false</span></span><br><span class="line"><span class="title class_">Boolean</span>(<span class="literal">null</span>)       <span class="comment">//false</span></span><br><span class="line"><span class="title class_">Boolean</span>(<span class="literal">undefined</span>)  <span class="comment">//false</span></span><br><span class="line"><span class="title class_">Boolean</span>(<span class="title class_">NaN</span>)        <span class="comment">//false</span></span><br><span class="line"><span class="title class_">Boolean</span>(<span class="number">1</span>)          <span class="comment">//true</span></span><br><span class="line"><span class="title class_">Boolean</span>(<span class="number">13</span>)         <span class="comment">//true</span></span><br><span class="line"><span class="title class_">Boolean</span>(<span class="string">&#x27;12&#x27;</span>)       <span class="comment">//true</span></span><br></pre></td></tr></table></figure></li><li><p>隐式类型转换</p><ul><li>凡是通过逻辑运算符 (&amp;&amp;、 ||、 !)、运算符 (+、-、*、/)、关系操作符 (&gt;、 &lt;、 &lt;= 、&gt;=)、相等运算符 (==) 或者 if/while 条件的操作，如果遇到两个数据类型不一样的情况，都会出现隐式类型转换</li><li>常用 ‘==’ 和 ‘+’ 隐式转换规则<ul><li><p>‘==’ 的隐式类型转换规则</p><ul><li>如果类型相同，无须进行类型转换</li><li>如果其中一个操作值是 null 或者 undefined，那么另一个操作符必须为 null 或者 undefined，才会返回 true，否则都返回 false</li><li>如果其中一个是 Symbol 类型，那么返回 false</li><li>两个操作值如果为 string 和 number 类型，那么就会将字符串转换为 number</li><li>如果一个操作值是 boolean，那么转换成 number</li><li>如果一个操作值为 object 且另一方为 string、number 或者 symbol，就会把 object 转为原始类型再进行判断（调用 object 的 valueOf/toString 方法进行转换</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span>        <span class="comment">// true  规则2</span></span><br><span class="line"><span class="literal">null</span> == <span class="number">0</span>               <span class="comment">// false 规则2</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span> == <span class="literal">null</span>              <span class="comment">// false 规则2</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span> == <span class="number">0</span>                 <span class="comment">// true  规则4 字符串转隐式转换成Number之后再对比</span></span><br><span class="line"><span class="string">&#x27;123&#x27;</span> == <span class="number">123</span>            <span class="comment">// true  规则4 字符串转隐式转换成Number之后再对比</span></span><br><span class="line"><span class="number">0</span> == <span class="literal">false</span>              <span class="comment">// true  e规则 布尔型隐式转换成Number之后再对比</span></span><br><span class="line"><span class="number">1</span> == <span class="literal">true</span>               <span class="comment">// true  e规则 布尔型隐式转换成Number之后再对比</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">valueOf</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span>++;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 注意这里a又可以等于1、2、3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a == <span class="number">1</span> &amp;&amp; a == <span class="number">2</span> &amp;&amp; a ==<span class="number">3</span>);  <span class="comment">//true f规则 Object隐式转换</span></span><br><span class="line"><span class="comment">// 注：但是执行过3遍之后，再重新执行a==3或之前的数字就是false，因为value已经加上去了，这里需要注意一下</span></span><br></pre></td></tr></table></figure></li><li><p>‘+’ 的隐式类型转换规则</p><ul><li>当 ‘+’ 号两边都是数字时，进行的是加法运算</li><li>两边都是字符串，则直接拼接，无须进行隐式类型转换</li><li>其中有一个是纯对象、数组、正则等，则默认调用对象的转换方法会存在优先级,然后再进行拼接[priority]</li><li>其中有一个是数字，另外一个是 undefined、null、布尔型或数字，则会将其转换成数字进行加法运算</li><li>如果其中一个是字符串、一个是数字，则按照字符串规则进行拼接</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="number">2</span>        <span class="comment">// 3  常规情况</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> + <span class="string">&#x27;2&#x27;</span>    <span class="comment">// &#x27;12&#x27; 常规情况</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> + <span class="literal">undefined</span>   <span class="comment">// &quot;1undefined&quot; 规则1，undefined转换字符串</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> + <span class="literal">null</span>        <span class="comment">// &quot;1null&quot; 规则1，null转换字符串</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> + <span class="literal">true</span>        <span class="comment">// &quot;1true&quot; 规则1，true转换字符串</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> + <span class="number">1n</span>          <span class="comment">// &#x27;11&#x27; 比较特殊字符串和BigInt相加，BigInt转换为字符串</span></span><br><span class="line"><span class="number">1</span> + <span class="literal">undefined</span>     <span class="comment">// NaN  规则2，undefined转换数字相加NaN</span></span><br><span class="line"><span class="number">1</span> + <span class="literal">null</span>          <span class="comment">// 1    规则2，null转换为0</span></span><br><span class="line"><span class="number">1</span> + <span class="literal">true</span>          <span class="comment">// 2    规则2，true转换为1，二者相加为2</span></span><br><span class="line"><span class="number">1</span> + <span class="number">1n</span>            <span class="comment">// 错误  不能把BigInt和Number类型直接混合相加</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> + <span class="number">3</span>           <span class="comment">// &#x27;13&#x27; 规则3，字符串拼接</span></span><br></pre></td></tr></table></figure></li><li><p>Object 的转换规则[]</p><ul><li>如果部署了 Symbol.toPrimitive 方法，优先调用再返回；</li><li>调用 valueOf()，如果转换为基础类型，则返回；</li><li>调用 toString()，如果转换为基础类型，则返回；</li><li>如果都没有返回基础类型，会报错</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="title function_">valueOf</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">toPrimitive</span>]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj + <span class="number">1</span>); <span class="comment">// 输出5</span></span><br><span class="line"><span class="comment">// 两个特殊的case：</span></span><br><span class="line"><span class="number">10</span> + &#123;&#125;</span><br><span class="line"><span class="comment">// &quot;10[object Object]&quot;，注意：&#123;&#125;会默认调用valueOf是&#123;&#125;，不是基础类型继续转换，调用toString，返回结果&quot;[object Object]&quot;，于是和10进行&#x27;+&#x27;运算，按照字符串拼接规则来，参考&#x27;+&#x27;的规则C</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="literal">undefined</span>,<span class="number">4</span>,<span class="number">5</span>] + <span class="number">10</span></span><br><span class="line"><span class="comment">// &quot;1,2,,4,510&quot;，注意[1,2,undefined,4,5]会默认先调用valueOf结果还是这个数组，不是基础数据类型继续转换，也还是调用toString，返回&quot;1,2,,4,5&quot;，然后再和10进行运算，还是按照字符串拼接规则，参考&#x27;+&#x27;的第3条规则</span></span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul></li></ul><h3 id="案例">案例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;123&#x27;</span> == <span class="number">123</span>   <span class="comment">// false</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span> == <span class="literal">null</span>    <span class="comment">// false</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span> == <span class="number">0</span>        <span class="comment">// false or true?</span></span><br><span class="line">[] == <span class="number">0</span>        <span class="comment">// false or true?</span></span><br><span class="line">[] == <span class="string">&#x27;&#x27;</span>       <span class="comment">// false or true?</span></span><br><span class="line">[] == ![]      <span class="comment">// false or true?</span></span><br><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span> <span class="comment">//  false or true?</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="literal">null</span>)     <span class="comment">// 返回什么？</span></span><br><span class="line"><span class="title class_">Number</span>(<span class="string">&#x27;&#x27;</span>)      <span class="comment">// 返回什么？</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">&#x27;&#x27;</span>);    <span class="comment">// 返回什么？</span></span><br><span class="line">&#123;&#125;+<span class="number">10</span>           <span class="comment">// 返回什么？</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">toPrimitive</span>]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">valueOf</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">300</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj + <span class="number">200</span>);</span><br></pre></td></tr></table></figure><h3 id="js-内置对象的装箱拆箱">js 内置对象的装箱拆箱</h3><ul><li>装箱：把基本数据类型转化为对应的引用数据类型的操作(Boolean、Object、String)<ul><li>隐式装箱</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> const <span class="selector-tag">a</span> = <span class="string">&#x27;sun&#x27;</span></span><br><span class="line">const <span class="selector-tag">b</span> = <span class="selector-tag">a</span><span class="selector-class">.indexof</span>(<span class="string">&#x27;s&#x27;</span>) <span class="comment">// 0 // 返回下标</span></span><br><span class="line"><span class="comment">// 上面代码在后台实际的步骤为：</span></span><br><span class="line">let <span class="selector-tag">a</span> = new <span class="built_in">String</span>(<span class="string">&#x27;sun&#x27;</span>)</span><br><span class="line">const <span class="selector-tag">b</span> = <span class="selector-tag">a</span><span class="selector-class">.indexof</span>(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"> <span class="selector-tag">a</span> = null</span><br><span class="line"> ```  </span><br><span class="line"> - 显示装箱</span><br></pre></td></tr></table></figure>const a = new String('sun')<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 拆箱：通常通过引用类型的<span class="built_in">valueOf</span>()或者<span class="built_in">toString</span>()进行转换</span><br></pre></td></tr></table></figure></li></ul><p>const name = new String(‘sun’)<br>const age = new Number(24)<br>console.log(typeof name) // object<br>console.log(typeof age) //  object<br>// 拆箱操作<br>console.log(typeof age.valueOf()); // number // 24  基本的数字类型<br>console.log(typeof name.valueOf()); // string  // ‘sun’ 基本的字符类型<br>console.log(typeof age.toString()); // string  // ‘24’ 基本的字符类型<br>console.log(typeof name.toString()); // string  // ‘sun’ 基本的字符类型</p><pre><code></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></td><td class="code"><pre><span class="line">整数或者小数：^[<span class="number">0</span><span class="number">-9</span>]+\.&#123;<span class="number">0</span>,<span class="number">1</span>&#125;[<span class="number">0</span><span class="number">-9</span>]&#123;<span class="number">0</span>,<span class="number">2</span>&#125;$</span><br><span class="line">只能输入数字：<span class="string">&quot;^[0-9]*$&quot;</span>。</span><br><span class="line">只能输入n位的数字：<span class="string">&quot;^\d&#123;n&#125;$&quot;</span>。</span><br><span class="line">只能输入至少n位的数字：<span class="string">&quot;^\d&#123;n,&#125;$&quot;</span>。</span><br><span class="line">只能输入m~n位的数字：。<span class="string">&quot;^\d&#123;m,n&#125;$&quot;</span></span><br><span class="line">只能输入零和非零开头的数字：<span class="string">&quot;^(0|[1-9][0-9]*)$&quot;</span>。</span><br><span class="line">只能输入有两位小数的正实数：<span class="string">&quot;^[0-9]+(.[0-9]&#123;2&#125;)?$&quot;</span>。</span><br><span class="line">只能输入有<span class="number">1</span>~<span class="number">3</span>位小数的正实数：<span class="string">&quot;^[0-9]+(.[0-9]&#123;1,3&#125;)?$&quot;</span>。</span><br><span class="line">只能输入非零的正整数：<span class="string">&quot;^\+?[1-9][0-9]*$&quot;</span>。</span><br><span class="line">只能输入非零的负整数：<span class="string">&quot;^\-[1-9][]0-9&quot;</span>*$。</span><br><span class="line">只能输入长度为<span class="number">3</span>的字符：<span class="string">&quot;^.&#123;3&#125;$&quot;</span>。</span><br><span class="line">只能输入由<span class="number">26</span>个英文字母组成的字符串：<span class="string">&quot;^[A-Za-z]+$&quot;</span>。</span><br><span class="line">只能输入由<span class="number">26</span>个大写英文字母组成的字符串：<span class="string">&quot;^[A-Z]+$&quot;</span>。</span><br><span class="line">只能输入由<span class="number">26</span>个小写英文字母组成的字符串：<span class="string">&quot;^[a-z]+$&quot;</span>。</span><br><span class="line">只能输入由数字和<span class="number">26</span>个英文字母组成的字符串：<span class="string">&quot;^[A-Za-z0-9]+$&quot;</span>。</span><br><span class="line">只能输入由数字、<span class="number">26</span>个英文字母或者下划线组成的字符串：<span class="string">&quot;^\w+$&quot;</span>。</span><br><span class="line">验证用户密码：<span class="string">&quot;^[a-zA-Z]\w&#123;5,17&#125;$&quot;</span>正确格式为：以字母开头，长度在<span class="number">6</span>~<span class="number">18</span>之间，只能包含字符、数字和下划线。</span><br><span class="line">验证是否含有^<span class="comment">%&amp;&#x27;,;=?$\&quot;等字符：&quot;[^%&amp;&#x27;,;=?$\x22]+&quot;。</span></span><br><span class="line">只能输入汉字：<span class="string">&quot;^[\u4e00-\u9fa5]&#123;0,&#125;$&quot;</span></span><br><span class="line">验证<span class="symbol">Email</span>地址：<span class="string">&quot;^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$&quot;</span>。</span><br><span class="line">验证<span class="symbol">InternetURL</span>：<span class="string">&quot;^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$&quot;</span>。</span><br><span class="line">验证电话号码：<span class="string">&quot;^(\(\d&#123;3,4&#125;-)|\d&#123;3.4&#125;-)?\d&#123;7,8&#125;$&quot;</span>正确格式为：<span class="string">&quot;XXX-XXXXXXX&quot;</span>、<span class="string">&quot;XXXX-XXXXXXXX&quot;</span>、<span class="string">&quot;XXX-XXXXXXX&quot;</span>、<span class="string">&quot;XXX-XXXXXXXX&quot;</span>、<span class="string">&quot;XXXXXXX&quot;</span>和<span class="string">&quot;XXXXXXXX&quot;</span>。</span><br><span class="line">验证身份证号（<span class="number">15</span>位或<span class="number">18</span>位数字）：<span class="string">&quot;^\d&#123;15&#125;|\d&#123;18&#125;$&quot;</span>。</span><br><span class="line">验证一年的<span class="number">12</span>个月：<span class="string">&quot;^(0?[1-9]|1[0-2])$&quot;</span>正确格式为：<span class="string">&quot;01&quot;</span>〜<span class="string">&quot;09&quot;</span>和<span class="string">&quot;1&quot;</span>〜<span class="string">&quot;12&quot;</span>。</span><br><span class="line">验证一个月的<span class="number">31</span>天：<span class="string">&quot;^((0?[1-9])|((1|2)[0-9])|30|31)$&quot;</span>正确格式为；<span class="string">&quot;01&quot;</span>〜<span class="string">&quot;09&quot;</span>和<span class="string">&quot;1&quot;</span>〜<span class="string">&quot;31&quot;</span>。 匹配中文字符的正则表达式： [\u4e00-\u9fa5]</span><br><span class="line"></span><br><span class="line">匹配双字节字符(包括汉字在内)：[^\x00-\xff]</span><br><span class="line"></span><br><span class="line">应用：计算字符串的长度（一个双字节字符长度计<span class="number">2</span>，<span class="symbol">ASCII</span>字符计<span class="number">1</span>）</span><br><span class="line"><span class="symbol">String</span>.prototype.len=function()&#123;return this.replace(/[^\x00-\xff]/g,<span class="string">&quot;aa&quot;</span>).length;&#125;</span><br><span class="line"></span><br><span class="line">匹配空行的正则表达式：\n[\s| ]*\r</span><br><span class="line"></span><br><span class="line">匹配html标签的正则表达式：&lt;(.*)&gt;(.*)&lt;\/(.*)&gt;|&lt;(.*)\/&gt;</span><br><span class="line"></span><br><span class="line">匹配首尾空格的正则表达式：(^\s*)|(\s*$)</span><br><span class="line"></span><br><span class="line">应用：javascript中没有像vbscript那样的trim函数，我们就可以利用这个表达式来实现，如下：</span><br><span class="line"></span><br><span class="line"><span class="symbol">String</span>.prototype.trim = function()</span><br><span class="line">&#123;</span><br><span class="line">return this.replace(/(^\s*)|(\s*$)/g, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">利用正则表达式分解和转换<span class="symbol">IP</span>地址：</span><br><span class="line"></span><br><span class="line">下面是利用正则表达式匹配<span class="symbol">IP</span>地址，并将<span class="symbol">IP</span>地址转换成对应数值的<span class="symbol">Javascript</span>程序：</span><br><span class="line"></span><br><span class="line">function <span class="symbol">IP2V</span>(ip)</span><br><span class="line">&#123;</span><br><span class="line">re=/(\d+)\.(\d+)\.(\d+)\.(\d+)/g //匹配<span class="symbol">IP</span>地址的正则表达式</span><br><span class="line">if(re.test(ip))</span><br><span class="line">&#123;</span><br><span class="line">return <span class="symbol">RegExp</span>.$<span class="number">1</span>*<span class="symbol">Math</span>.pow(<span class="number">255</span>,<span class="number">3</span>))+<span class="symbol">RegExp</span>.$<span class="number">2</span>*<span class="symbol">Math</span>.pow(<span class="number">255</span>,<span class="number">2</span>))+<span class="symbol">RegExp</span>.$<span class="number">3</span>*<span class="number">255</span>+<span class="symbol">RegExp</span>.$<span class="number">4</span>*<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">throw new <span class="symbol">Error</span>(<span class="string">&quot;Not a valid IP address!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">不过上面的程序如果不用正则表达式，而直接用split函数来分解可能更简单，程序如下：</span><br><span class="line"></span><br><span class="line">var ip=<span class="string">&quot;10.100.20.168&quot;</span></span><br><span class="line">ip=ip.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">alert(<span class="string">&quot;IP值是：&quot;</span>+(ip[<span class="number">0</span>]*<span class="number">255</span>*<span class="number">255</span>*<span class="number">255</span>+ip[<span class="number">1</span>]*<span class="number">255</span>*<span class="number">255</span>+ip[<span class="number">2</span>]*<span class="number">255</span>+ip[<span class="number">3</span>]*<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">匹配<span class="symbol">Email</span>地址的正则表达式：\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*</span><br><span class="line"></span><br><span class="line">匹配网址<span class="symbol">URL</span>的正则表达式：http://([\w-]+\.)+[\w-]+(/[\w- ./?<span class="comment">%&amp;=]*)?</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">利用正则表达式限制网页表单里的文本框输入内容：</span><br><span class="line"></span><br><span class="line">用正则表达式限制只能输入中文：onkeyup=<span class="string">&quot;value=value.replace(/[^\u4E00-\u9FA5]/g,&#x27;&#x27;)&quot;</span> onbeforepaste=<span class="string">&quot;clipboardData.setData(&#x27;text&#x27;,clipboardData.getData(&#x27;text&#x27;).replace(/[^\u4E00-\u9FA5]/g,&#x27;&#x27;))&quot;</span></span><br><span class="line"></span><br><span class="line">用正则表达式限制只能输入全角字符： onkeyup=<span class="string">&quot;value=value.replace(/[^\uFF00-\uFFFF]/g,&#x27;&#x27;)&quot;</span> onbeforepaste=<span class="string">&quot;clipboardData.setData(&#x27;text&#x27;,clipboardData.getData(&#x27;text&#x27;).replace(/[^\uFF00-\uFFFF]/g,&#x27;&#x27;))&quot;</span></span><br><span class="line"></span><br><span class="line">用正则表达式限制只能输入数字：onkeyup=<span class="string">&quot;value=value.replace(/[^\d]/g,&#x27;&#x27;) &quot;</span>onbeforepaste=<span class="string">&quot;clipboardData.setData(&#x27;text&#x27;,clipboardData.getData(&#x27;text&#x27;).replace(/[^\d]/g,&#x27;&#x27;))&quot;</span></span><br><span class="line"></span><br><span class="line">用正则表达式限制只能输入数字和英文：onkeyup=<span class="string">&quot;value=value.replace(/[\W]/g,&#x27;&#x27;) &quot;</span>onbeforepaste=<span class="string">&quot;clipboardData.setData(&#x27;text&#x27;,clipboardData.getData(&#x27;text&#x27;).replace(/[^\d]/g,&#x27;&#x27;))&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配中文字符的正则表达式： [\u4e00-\u9fa5]</span><br><span class="line"></span><br><span class="line">评注：匹配中文还真是个头疼的事，有了这个表达式就好办了</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配双字节字符(包括汉字在内)：[^\x00-\xff]</span><br><span class="line"></span><br><span class="line">评注：可以用来计算字符串的长度（一个双字节字符长度计<span class="number">2</span>，<span class="symbol">ASCII</span>字符计<span class="number">1</span>）</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配空白行的正则表达式：\n\s*\r</span><br><span class="line"></span><br><span class="line">评注：可以用来删除空白行</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配<span class="symbol">HTML</span>标记的正则表达式：&lt;(\<span class="symbol">S</span>*?)[^&gt;]*&gt;.*?|&lt;.*? /&gt;</span><br><span class="line"></span><br><span class="line">评注：网上流传的版本太糟糕，上面这个也仅仅能匹配部分，对于复杂的嵌套标记依旧无能为力</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配首尾空白字符的正则表达式：^\s*|\s*$</span><br><span class="line"></span><br><span class="line">评注：可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配<span class="symbol">Email</span>地址的正则表达式：\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*</span><br><span class="line"></span><br><span class="line">评注：表单验证时很实用</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配网址<span class="symbol">URL</span>的正则表达式：[a-zA-z]+://[^\s]*</span><br><span class="line"></span><br><span class="line">评注：网上流传的版本功能很有限，上面这个基本可以满足需求</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配帐号是否合法(字母开头，允许<span class="number">5</span><span class="number">-16</span>字节，允许字母数字下划线)：^[a-zA-<span class="symbol">Z</span>][a-zA-<span class="symbol">Z0</span><span class="number">-9</span><span class="symbol">_</span>]&#123;<span class="number">4</span>,<span class="number">15</span>&#125;$</span><br><span class="line"></span><br><span class="line">评注：表单验证时很实用</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配国内电话号码：\d&#123;<span class="number">3</span>&#125;-\d&#123;<span class="number">8</span>&#125;|\d&#123;<span class="number">4</span>&#125;-\d&#123;<span class="number">7</span>&#125;</span><br><span class="line"></span><br><span class="line">评注：匹配形式如 <span class="number">0511</span><span class="number">-4405222</span> 或 <span class="number">021</span><span class="number">-87888822</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配腾讯<span class="symbol">QQ</span>号：[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]&#123;<span class="number">4</span>,&#125;</span><br><span class="line"></span><br><span class="line">评注：腾讯<span class="symbol">QQ</span>号从<span class="number">10000</span>开始</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配中国邮政编码：[<span class="number">1</span><span class="number">-9</span>]\d&#123;<span class="number">5</span>&#125;(?!\d)</span><br><span class="line"></span><br><span class="line">评注：中国邮政编码为<span class="number">6</span>位数字</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配身份证：\d&#123;<span class="number">15</span>&#125;|\d&#123;<span class="number">18</span>&#125;</span><br><span class="line"></span><br><span class="line">评注：中国的身份证为<span class="number">15</span>位或<span class="number">18</span>位</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配ip地址：\d+\.\d+\.\d+\.\d+</span><br><span class="line"></span><br><span class="line">评注：提取ip地址时有用</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配特定数字：</span><br><span class="line"></span><br><span class="line">^[<span class="number">1</span><span class="number">-9</span>]\d*$　 　 //匹配正整数</span><br><span class="line"></span><br><span class="line">^-[<span class="number">1</span><span class="number">-9</span>]\d*$ 　 //匹配负整数</span><br><span class="line"></span><br><span class="line">^-?[<span class="number">1</span><span class="number">-9</span>]\d*$　　 //匹配整数</span><br><span class="line"></span><br><span class="line">^[<span class="number">1</span><span class="number">-9</span>]\d*|<span class="number">0</span>$　 //匹配非负整数（正整数 + <span class="number">0</span>）</span><br><span class="line"></span><br><span class="line">^-[<span class="number">1</span><span class="number">-9</span>]\d*|<span class="number">0</span>$　　 //匹配非正整数（负整数 + <span class="number">0</span>）</span><br><span class="line"></span><br><span class="line">^[<span class="number">1</span><span class="number">-9</span>]\d*\.\d*|<span class="number">0</span>\.\d*[<span class="number">1</span><span class="number">-9</span>]\d*$　　 //匹配正浮点数</span><br><span class="line"></span><br><span class="line">^-([<span class="number">1</span><span class="number">-9</span>]\d*\.\d*|<span class="number">0</span>\.\d*[<span class="number">1</span><span class="number">-9</span>]\d*)$　 //匹配负浮点数</span><br><span class="line"></span><br><span class="line">^-?([<span class="number">1</span><span class="number">-9</span>]\d*\.\d*|<span class="number">0</span>\.\d*[<span class="number">1</span><span class="number">-9</span>]\d*|<span class="number">0</span>?\<span class="number">.0</span>+|<span class="number">0</span>)$　 //匹配浮点数</span><br><span class="line"></span><br><span class="line">^[<span class="number">1</span><span class="number">-9</span>]\d*\.\d*|<span class="number">0</span>\.\d*[<span class="number">1</span><span class="number">-9</span>]\d*|<span class="number">0</span>?\<span class="number">.0</span>+|<span class="number">0</span>$　　 //匹配非负浮点数（正浮点数 + <span class="number">0</span>）</span><br><span class="line"></span><br><span class="line">^(-([<span class="number">1</span><span class="number">-9</span>]\d*\.\d*|<span class="number">0</span>\.\d*[<span class="number">1</span><span class="number">-9</span>]\d*))|<span class="number">0</span>?\<span class="number">.0</span>+|<span class="number">0</span>$　　//匹配非正浮点数（负浮点数 + <span class="number">0</span>）</span><br><span class="line"></span><br><span class="line">评注：处理大量数据时有用，具体应用时注意修正</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">匹配特定字符串：</span><br><span class="line"></span><br><span class="line">^[<span class="symbol">A</span>-<span class="symbol">Za</span>-z]+$　　//匹配由<span class="number">26</span>个英文字母组成的字符串</span><br><span class="line"></span><br><span class="line">^[<span class="symbol">A</span>-<span class="symbol">Z</span>]+$　　//匹配由<span class="number">26</span>个英文字母的大写组成的字符串</span><br><span class="line"></span><br><span class="line">^[a-z]+$　　//匹配由<span class="number">26</span>个英文字母的小写组成的字符串</span><br><span class="line"></span><br><span class="line">^[<span class="symbol">A</span>-<span class="symbol">Za</span>-z0<span class="number">-9</span>]+$　　//匹配由数字和<span class="number">26</span>个英文字母组成的字符串</span><br><span class="line"></span><br><span class="line">^\w+$　　//匹配由数字、<span class="number">26</span>个英文字母或者下划线组成的字符串</span><br><span class="line"></span><br><span class="line">评注：最基本也是最常用的一些表达式</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">整理出来的一些常用的正则表达式所属分类: <span class="symbol">JScript</span>  (三)</span><br><span class="line"></span><br><span class="line"><span class="symbol">Email</span> : /^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$/</span><br><span class="line"></span><br><span class="line">isEmail1 : /^\w+([\.\-]\w+)*\@\w+([\.\-]\w+)*\.\w+$/;</span><br><span class="line"></span><br><span class="line">isEmail2 : /^.*@[^<span class="symbol">_</span>]*$/;</span><br><span class="line"></span><br><span class="line"><span class="symbol">Phone</span> : /^((\(\d&#123;<span class="number">3</span>&#125;\))|(\d&#123;<span class="number">3</span>&#125;\-))?(\(<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;\)|<span class="number">0</span>\d&#123;<span class="number">2</span>,<span class="number">3</span>&#125;-)?[<span class="number">1</span><span class="number">-9</span>]\d&#123;<span class="number">6</span>,<span class="number">7</span>&#125;$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">Mobile</span> : /^((\(\d&#123;<span class="number">3</span>&#125;\))|(\d&#123;<span class="number">3</span>&#125;\-))?<span class="number">13</span>\d&#123;<span class="number">9</span>&#125;$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">Url</span> : /^http:\/\/[<span class="symbol">A</span>-<span class="symbol">Za</span>-z0<span class="number">-9</span>]+\.[<span class="symbol">A</span>-<span class="symbol">Za</span>-z0<span class="number">-9</span>]+[\/=\?<span class="comment">%\-&amp;_~`@[\]\&#x27;:+!]*([^&lt;&gt;\&quot;\&quot;])*$/</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">IdCard</span> : /^\d&#123;<span class="number">15</span>&#125;(\d&#123;<span class="number">2</span>&#125;[<span class="symbol">A</span>-<span class="symbol">Za</span>-z0<span class="number">-9</span>])?$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">Currency</span> : /^\d+(\.\d+)?$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">Number</span> : /^\d+$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">Code</span> : /^[<span class="number">1</span><span class="number">-9</span>]\d&#123;<span class="number">5</span>&#125;$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">QQ</span> : /^[<span class="number">1</span><span class="number">-9</span>]\d&#123;<span class="number">4</span>,<span class="number">8</span>&#125;$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">Integer</span> : /^[-\+]?\d+$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">Double</span> : /^[-\+]?\d+(\.\d+)?$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">English</span> : /^[<span class="symbol">A</span>-<span class="symbol">Za</span>-z]+$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">Chinese</span> : /^[\u0391-\uFFE5]+$/</span><br><span class="line"></span><br><span class="line"><span class="symbol">UnSafe</span> : /^(([<span class="symbol">A</span>-<span class="symbol">Z</span>]*|[a-z]*|\d*|[-<span class="symbol">_</span>\~!@#\$<span class="comment">%\^&amp;\*\.\(\)\[\]\&#123;\&#125;&lt;&gt;\?\\\/\&#x27;\&quot;]*)|.&#123;0,5&#125;)$|\s/</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">PassWord</span> :^[\\w]&#123;<span class="number">6</span>,<span class="number">12</span>&#125;$</span><br><span class="line"></span><br><span class="line"><span class="symbol">ZipCode</span> : ^[\\d]&#123;<span class="number">6</span>&#125;</span><br><span class="line"></span><br><span class="line">/^(\+\d+ )?(\(\d+\) )?[\d ]+$/; //这个是国际通用的电话号码判断</span><br><span class="line"></span><br><span class="line">/^(<span class="number">1</span>[<span class="number">0</span><span class="number">-2</span>]\d|\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;)$/; //这个是年龄的判断</span><br><span class="line"></span><br><span class="line">/^\d+\.\d&#123;<span class="number">2</span>&#125;$/;  //这个是判断输入的是否为货币值</span><br><span class="line"></span><br><span class="line"> &lt;!-- <span class="symbol">IP</span>地址有效性验证函数--&gt;</span><br><span class="line"></span><br><span class="line"> &lt;script language=javascript runat=server&gt;</span><br><span class="line"></span><br><span class="line">    ip_ip = <span class="string">&#x27;(25[0-5]|2[0-4]\\d|1\\d\\d|\\d\\d|\\d)&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    ip_ipdot = ip + <span class="string">&#x27;\\.&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    isIPaddress = new <span class="symbol">RegExp</span>(<span class="string">&#x27;^&#x27;</span>+ip_ipdot+ip_ipdot+ipdot+ip_ip+<span class="string">&#x27;$&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">应用：计算字符串的长度（一个双字节字符长度计<span class="number">2</span>，<span class="symbol">ASCII</span>字符计<span class="number">1</span>）</span><br><span class="line"></span><br><span class="line"><span class="symbol">String</span>.prototype.len=function()&#123;return this.replace([^\x00-\xff]/g,<span class="string">&quot;aa&quot;</span>).length;&#125;</span><br><span class="line"></span><br><span class="line">应用：javascript中没有像vbscript那样的trim函数，我们就可以利用这个表达式来实现，如下：</span><br><span class="line"></span><br><span class="line"><span class="symbol">String</span>.prototype.trim = function()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    return this.replace(/(^\s*)|(\s*$)/g, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">匹配空行的正则表达式：\n[\s| ]*\r</span><br><span class="line"></span><br><span class="line">匹配<span class="symbol">HTML</span>标记的正则表达式：/&lt;(.*)&gt;.*&lt;\/\<span class="number">1</span>&gt;|&lt;(.*) \/&gt;/</span><br><span class="line"></span><br><span class="line">匹配首尾空格的正则表达式：(^\s*)|(\s*$)</span><br><span class="line"></span><br><span class="line">匹配<span class="symbol">Email</span>地址的正则表达式：\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*</span><br><span class="line"></span><br><span class="line">匹配网址<span class="symbol">URL</span>的正则表达式：http://([\w-]+\.)+[\w-]+(/[\w- ./?<span class="comment">%&amp;=]*)?</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">^\d+$　　//匹配非负整数（正整数 + <span class="number">0</span>）</span><br><span class="line"></span><br><span class="line">^[<span class="number">0</span><span class="number">-9</span>]*[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*$　　//匹配正整数</span><br><span class="line"></span><br><span class="line">^((-\d+)|(<span class="number">0</span>+))$　　//匹配非正整数（负整数 + <span class="number">0</span>）</span><br><span class="line"></span><br><span class="line">^-[<span class="number">0</span><span class="number">-9</span>]*[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*$　　//匹配负整数</span><br><span class="line"></span><br><span class="line">^-?\d+$　　　　//匹配整数</span><br><span class="line"></span><br><span class="line">^\d+(\.\d+)?$　　//匹配非负浮点数（正浮点数 + <span class="number">0</span>）</span><br><span class="line"></span><br><span class="line">^(([<span class="number">0</span><span class="number">-9</span>]+\.[<span class="number">0</span><span class="number">-9</span>]*[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*)|([<span class="number">0</span><span class="number">-9</span>]*[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*\.[<span class="number">0</span><span class="number">-9</span>]+)|([<span class="number">0</span><span class="number">-9</span>]*[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*))$　//匹配正浮点数</span><br><span class="line"></span><br><span class="line">^((-\d+(\.\d+)?)|(<span class="number">0</span>+(\<span class="number">.0</span>+)?))$　　//匹配非正浮点数（负浮点数 + <span class="number">0</span>）</span><br><span class="line"></span><br><span class="line">^(-(([<span class="number">0</span><span class="number">-9</span>]+\.[<span class="number">0</span><span class="number">-9</span>]*[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*)|([<span class="number">0</span><span class="number">-9</span>]*[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*\.[<span class="number">0</span><span class="number">-9</span>]+)|([<span class="number">0</span><span class="number">-9</span>]*[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]*)))$ //匹配负浮点数</span><br><span class="line"></span><br><span class="line">^(-?\d+)(\.\d+)?</span><br><span class="line"></span><br><span class="line">车牌的正则: /^[\u4e00-\u9fa5][<span class="symbol">A</span>-<span class="symbol">Z</span>][<span class="symbol">A</span>-<span class="symbol">Z</span>\d]&#123;<span class="number">5</span>&#125;$/</span><br><span class="line"></span><br><span class="line">车架号正则: /^[a-zA-<span class="symbol">Z</span>\d]&#123;<span class="number">17</span>&#125;$/ (产品定义是否兼容小写?)</span><br><span class="line"></span><br><span class="line">手机号正则: /^<span class="number">1</span>\d&#123;<span class="number">10</span>&#125;$/  || /^[<span class="number">1</span>][<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">8</span>][<span class="number">0</span><span class="number">-9</span>]&#123;<span class="number">9</span>&#125;$/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="JavaScript">JavaScript</h2><ul><li><p>执行上下文</p><blockquote><p>当前 JavaScript 代码被解析和执行时所在环境的抽象概念</p></blockquote><ul><li>全局执行上下文 window<ul><li>默认、最基础上下文</li><li>不在任何函数中的代码都位于全局执行上下文中<ul><li>let、const 声明的全局变量不会挂载至 window 上（形成块级作用域）</li></ul>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> length = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;Jahaw&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">length</span>, <span class="variable language_">window</span>.<span class="property">name</span>)</span><br><span class="line"><span class="comment">// window.length: 属性返回当前窗口中包含的框架数量(框架包括frame和iframe两种元素)</span></span><br><span class="line"><span class="comment">// window.name:   当前window的名称</span></span><br></pre></td></tr></table></figure></li></ul></li><li>函数执行上下文<ul><li>函数执行时创建</li></ul></li><li>eval 函数作用域<br><a href="https://zhuanlan.zhihu.com/p/348452188">参考链接</a></li></ul></li><li><p>window 与 top 区别</p></li></ul><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">top:</span> 最顶级父窗口</span><br><span class="line"><span class="symbol">parent:</span> 父窗口</span><br><span class="line"><span class="symbol">self:</span> 当前窗口</span><br><span class="line"><span class="symbol">opener:</span> 用open方法打开当前窗口的那个窗口</span><br></pre></td></tr></table></figure><ul><li><p>js Function</p><ul><li>创建方式<ul><li>函数声明</li></ul>  <figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">sum</span>(n)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">n</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>函数表达式(函数字面量)</li></ul>  <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">sum</span> = <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">n</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="built_in">sum</span> = <span class="keyword">function</span>(<span class="params">n</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>自执行函数</li></ul>  <figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="built_in">console</span>.<span class="built_in">log</span>(<span class="number">123</span>)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></li><li>区别</li></ul>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">函数声明：解析器会先读取函数声明，并使其在执行任何代码之前可以访问</span><br><span class="line">函数表达式：必须等到解析器执行到它所在的代码行才会真正被解释执行</span><br><span class="line">自执行函数：严格来说也叫函数表达式，它主要用于创建一个新的作用域，在此作用域内声明的变量，不会和其它作用域内的变量冲突或混淆，大多是以匿名函数方式存在，且立即自动执行</span><br></pre></td></tr></table></figure><ul><li>this</li></ul>  <figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">函数的调用方式决定了 this 的值（运行时绑定）</span><br><span class="line">ES5:</span><br><span class="line">- B.call(A, args1, args2, ...)</span><br><span class="line">- 第一个参数 为 this 指向， 参数列表第一个参数为 <span class="literal">null</span>， <span class="literal">undefined</span> 时默认指向 window</span><br><span class="line">- 改变 this 后再执行 函数</span><br><span class="line">- 判断数据类型</span><br><span class="line"></span><br><span class="line">- B.apply(A, arguments)</span><br><span class="line">- 功能同call, 参数为 数组</span><br><span class="line"></span><br><span class="line">- B.bind(A)</span><br><span class="line">- bind() 改变this 后，不执行函数，返回一个绑定新 this 的函数</span><br><span class="line">```<span class="language-javascript">javascript</span></span><br><span class="line"><span class="language-javascript"># bind 函数具体实现</span></span><br><span class="line"><span class="language-javascript"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">bind</span> = <span class="keyword">function</span>(<span class="params">obj, arg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> context = <span class="variable language_">this</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> arg = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(argument, <span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> bound = <span class="keyword">function</span>(<span class="params">newArg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">arg = arg.<span class="title function_">concat</span>(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(newArg));</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">return</span> context.<span class="title function_">apply</span>(obj, arg)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 考虑原型链：new 一个 bind 生成的新函数时，必须的条件：要继承原函数的原型</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 寄生组合继承</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> F = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">F.<span class="property"><span class="keyword">prototype</span></span> = context.<span class="property"><span class="keyword">prototype</span></span>;</span></span><br><span class="line"><span class="language-javascript">bound.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">F</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">return</span> bound;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br></pre></td></tr></table></figure><pre><code>  ES6: Arrow Function （箭头函数 不提供自身this绑定、arguments、super等）</code></pre>  <figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">![this](./images/find-this.jpeg)</span><br><span class="line"></span><br><span class="line">- arguments</span><br><span class="line">- 所有（非箭头）函数中都可用的局部变量</span><br><span class="line">- 对应于传递给函数的参数的类数组对象, 除了length属性和索引元素之外没有任何<span class="built_in">Array</span>属性</span><br><span class="line">- 可转换 为真正数组</span><br><span class="line">```<span class="language-javascript">javascript</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 方案一：</span></span></span><br><span class="line"><span class="language-javascript"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 方案二：</span></span></span><br><span class="line"><span class="language-javascript"><span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">arguments</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&gt; callee caller</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">arguments</span>.<span class="property">callee</span> 当前函数</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">name</span> 当前函数的名字</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">对于自执行函数(匿名函数) 可使用<span class="variable language_">arguments</span>.<span class="title function_">callee</span>()再次执行</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">a,b</span>)&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>.<span class="property">callee</span> === fn); <span class="comment">// true</span></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(fn.<span class="property">length</span>);         <span class="comment">// 形参的长度，就是函数定义参数数量</span></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>.<span class="property">length</span>);        <span class="comment">// 实参的长度，也就是实际传入的参数</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// arguments.callee.length &lt; arguments.length 相当于 形参&lt;实参</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">caller</span> 调用当前函数的外层函数</span></span><br></pre></td></tr></table></figure></li><li><p>递归 + setTimeout 实现 setInterval</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 场景：</span></span><br><span class="line"><span class="comment">* 1. setInterval 轮询在网络不好时出现请求堆积</span></span><br><span class="line"><span class="comment">* 2. setInterval 执行函数时间 &lt; 设定时间 导致逻辑错误</span></span><br><span class="line"><span class="comment">* 3. setInterval 对自己调用的代码是否报错不关心</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 例如：hello world 未按照 设定时间 2s 来执行</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>), <span class="number">2000</span>)</span><br><span class="line">&#125;, <span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">interval</span>(<span class="params">s,fn</span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="title function_">timeOut</span> = (<span class="params">s,fn</span>) =&gt; &#123;</span><br><span class="line"><span class="title function_">fn</span>();</span><br><span class="line">timer = <span class="built_in">setTimeout</span>(timeOut,s)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">timeOut</span>(s,timeOut);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 调用上面的方法</span></span><br><span class="line"><span class="title function_">setInter</span>(<span class="number">3000</span>,<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello world!&quot;</span>))</span><br><span class="line"><span class="comment">// 终止定时器</span></span><br><span class="line"><span class="built_in">clearTimeout</span>(timer)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>防抖<ul><li>在最后一次事件后才触发一次函数</li><li>应用场景：输入框模糊搜索、发短信、浏览器窗口resize造成计算过多(echarts图表调整大小)</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line"><span class="keyword">var</span> _arguments = <span class="variable language_">arguments</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">fn.<span class="title function_">apply</span>(_this, _arguments);</span><br><span class="line">&#125;, delay)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*案列：监听用户输入进行模糊查询</span></span><br><span class="line"><span class="comment">*&lt;input class=&quot;.search&quot; /&gt;</span></span><br><span class="line"><span class="comment">*   &lt;script&gt;</span></span><br><span class="line"><span class="comment">*   var search = document.querySelector(&#x27;.search&#x27;);</span></span><br><span class="line"><span class="comment">*   var counter = 0;</span></span><br><span class="line"><span class="comment">*function searchChange() &#123;</span></span><br><span class="line"><span class="comment">*counter++;</span></span><br><span class="line"><span class="comment">*       console.log(&#x27;发送&#x27; + counter + &#x27;网络请求&#x27;)</span></span><br><span class="line"><span class="comment">*   &#125;</span></span><br><span class="line"><span class="comment">*   var _searchChange = debounce(searchChange, 500);</span></span><br><span class="line"><span class="comment">*search.oninput = _searchChange;</span></span><br><span class="line"><span class="comment">*&lt;/script&gt;</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><ul><li>节流<ul><li>多次触发同一个函数，同一段时间内只执行一次</li><li>原理: 利用时间差（当前和上次执行）来过滤中间过程触发的函数执行</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, interval</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> last = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line"><span class="keyword">var</span> _arguments = <span class="variable language_">arguments</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line"><span class="keyword">if</span>(now - last &gt; interval) &#123;</span><br><span class="line">fn.<span class="title function_">apply</span>(_this, _arguments);</span><br><span class="line">last = now;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://juejin.im/post/6844904170332356616">link</a></p><ul><li>浅拷贝<ul><li>创建一个新对象，这个对象有着原始对象属性值的一份精确拷贝。<br>如果属性是基本类型，拷贝的就是基本类型的值，<br>如果属性是引用类型，拷贝的就是内存地址 ，<br>所以如果其中一个对象改变了这个地址，就会影响到另一个对象。</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">eg：</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> objCopy = &#123;&#125;;</span><br><span class="line">    <span class="comment">// for...in 以任意顺序遍历一个对象的除Symbol以外的可枚举属性</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        objCopy[key] = obj[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> objCopy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, </span><br><span class="line"><span class="attr">age</span>: <span class="number">18</span>, </span><br><span class="line"><span class="attr">car</span>: &#123; <span class="attr">brand</span>: <span class="string">&quot;Ferrari&quot;</span>,  <span class="attr">type</span>: <span class="string">&quot;430&quot;</span> &#125;,</span><br><span class="line"><span class="attr">eat</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;can eat!&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> personCopy = <span class="title function_">copy</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(target, ...sources):</span><br><span class="line">定义：将所有可枚举属性的值从一个或多个源对象复制到目标对象【拷贝对象的第一层基本类型，引用类型拷贝的还是个指针】</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123; ...person &#125;;</span><br></pre></td></tr></table></figure><ul><li>深拷贝<ul><li>深拷贝会拷贝所有的属性，并拷贝属性指向的动态分配的内存。<br>深拷贝相比于浅拷贝速度较慢并且花销较大。拷贝前后两个对象互不影响。</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="title class_">Symbol</span>(<span class="string">&quot;dd&quot;</span>),</span><br><span class="line">  <span class="attr">fn</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(a)); <span class="comment">// &#123; a: 1 &#125;</span></span><br><span class="line">结论：<span class="title class_">JSON</span>.<span class="property">stringify</span> 在序列化 对象时自动忽略 <span class="literal">undefined</span>、symbol、函数这三种情况</span><br><span class="line"></span><br><span class="line">简单对象深拷贝 eg：</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(obj === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> target = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj) ? [] : &#123;&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> obj[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">target[key] = <span class="title function_">deepClone</span>(obj[key])</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">target[key] = obj[key]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Decorator</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">target</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取一个对象所有自身属性[不需去原型链上找]的描述符</span></span><br><span class="line">  <span class="keyword">const</span> desc = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(target.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;desc&quot;</span>, desc)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(desc)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&#x27;construtor&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> func = desc[key].<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;function&#x27;</span> === <span class="keyword">typeof</span> func) &#123;</span><br><span class="line">      <span class="comment">// 在原型对象上定义新的属性/修改一个对象现有属性，并返回此对象</span></span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target.<span class="property"><span class="keyword">prototype</span></span>, key, &#123;</span><br><span class="line">        <span class="title function_">value</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;before&#x27;</span> + key);</span><br><span class="line">          <span class="keyword">const</span> ret = func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;after&#x27;</span> + key);</span><br><span class="line">          <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">readonly</span>(<span class="params">target, key, descriptor</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;target&#x27;</span>, target);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;key&#x27;</span>, key)</span><br><span class="line">  </span><br><span class="line">  descriptor.<span class="property">writable</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validate</span>(<span class="params">target, key, descriptor</span>) &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@target</span> 装饰的属性所描述类的原型[eg: Car.prototype/类本身]</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@key</span> 装饰属性的key</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@descriptor</span> 装饰的对象的描述对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> func = descriptor.<span class="property">value</span>;</span><br><span class="line">  descriptor.<span class="property">value</span> = <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> num <span class="keyword">of</span> args) &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="string">&#x27;number&#x27;</span> !== <span class="keyword">typeof</span> num) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`<span class="subst">$&#123;num&#125;</span> is not number`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@log</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Numberic</span> &#123;</span><br><span class="line"></span><br><span class="line">  @readonly <span class="variable constant_">PI</span> = <span class="number">3.1415926</span>;</span><br><span class="line"></span><br><span class="line">  @validate </span><br><span class="line">  <span class="title function_">add</span>(<span class="params">...nums</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">p, n</span>) =&gt;</span> (p + n), <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance =  <span class="keyword">new</span> <span class="title class_">Numberic</span>();</span><br><span class="line"></span><br><span class="line">instance.<span class="title function_">add</span>();     <span class="comment">// 0</span></span><br><span class="line">instance.<span class="property">PI</span> = <span class="number">100</span>;   <span class="comment">// no writable</span></span><br><span class="line">instance.<span class="title function_">add</span>(<span class="string">&#x27;x&#x27;</span>);   <span class="comment">// x is not number</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">非常类似，但是一定不要把 <span class="variable constant_">JS</span> 中的装饰器叫做是“注解”，因为这两者的原理和实现的功能还是有所区别的，在 <span class="title class_">Java</span> 中，注解主要是对某个对象进行标注，然后在运行时或者编译时，可以通过例如反射这样的机制拿到被标注的对象，对其进行一些逻辑包装。而 <span class="title class_">Decorator</span> 的原理和作用则更为简单，就是包装对象，然后返回一个新的对象描述（descriptor），其作用也非常单一简单，基本上就是获取包装对象的宿主、键值几个有限的信息。</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Decorator 与 Java Annotation 区别<ul><li>在 Java 中，注解主要是对某个对象进行标注，然后在运行时或者编译时，可以通过例如反射这样的机制拿到被标注的对象，对其进行一些逻辑包装</li><li>Decorator就是包装对象，然后返回一个新的对象描述（descriptor），其作用也非常单一简单，基本上就是获取包装对象的宿主、键值几个有限的信息</li></ul></li></ul><p><strong>Dom标准事件流的触发的先后顺序为：先捕获再冒泡</strong></p><p><img src="./images/capture.bubble.jpeg" alt="capture-bubble"></p><ul><li><p>事件流</p><ul><li>定义：描述的是从页面接收事件的顺序</li><li>DOM2级事件流 包括以下几个阶段<ul><li>事件捕获：当鼠标点击或者触发dom事件时（被触发dom事件的这个元素被叫作事件源），浏览器会从根节点 =&gt;事件源（由外到内）进行事件传播</li><li>目标事件</li><li>事件冒泡<ul><li>事件从最深的节点开始，然后逐步向上传播事件</li><li>事件源 =&gt;根节点（由内到外）进行事件传播</li></ul></li><li>事件处理操作：addEventListener  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">element.<span class="title function_">addEventListener</span>(eventName, <span class="keyword">function</span>, useCapture);</span><br><span class="line"><span class="comment">// eventName: 事件名称</span></span><br><span class="line"><span class="comment">// function: 事件处理函数</span></span><br><span class="line"><span class="comment">// useCapture</span></span><br><span class="line"><span class="comment">//   false: 表示在事件冒泡阶段调用事件处理函数[默认值]</span></span><br><span class="line"><span class="comment">//   true: 则表示在事件捕获阶段调用处理函数</span></span><br></pre></td></tr></table></figure></li></ul></li><li>事件委托【事件代理】<ul><li>利用事件冒泡，只指定一个事件处理程序，就可以管理某一类型的所有事件</li><li>委托它们父级代为执行事件</li><li>提高页面性能<ul><li>减少内存消耗，绑定的事件处理程序个数减少</li><li>减少Dom访问次数，进而减少重排和重绘的次数</li><li>动态添加的子元素也会绑定事件处理程序</li></ul></li></ul></li></ul>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eg</span>:</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&#x27;ul&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">var</span> oUl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;ul&#x27;</span>);</span><br><span class="line">oUl.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params">evt</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> evt = evt || <span class="variable language_">window</span>.<span class="property">event</span>;</span><br><span class="line"><span class="keyword">var</span> target = evt.<span class="property">tatget</span> || evt.<span class="property">srcElement</span>;</span><br><span class="line"><span class="keyword">if</span>(target.<span class="property">nodeName</span>.<span class="title function_">toLowerCase</span>() == <span class="string">&#x27;li&#x27;</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target.<span class="property">innerHTML</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 防止内存泄漏</span></span><br><span class="line">oUl = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>Ramda 函数式编程类库</p></blockquote><ul><li>函数柯里化<ul><li>把接受多个参数的函数变换成接收单一参数（最初函数的第一个参数）的函数，返回接收剩余参数及结果的新函数的技术</li><li>作用</li><li>参数复用</li></ul>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">addThreeNumbers</span> = (<span class="params">x, y, z</span>) =&gt; x + y + z;</span><br><span class="line"><span class="keyword">const</span> curriedAddaddThreeNumbers = R.<span class="title function_">curry</span>(addThreeNumbers);</span><br><span class="line"><span class="keyword">const</span> f = <span class="title function_">curriedAddaddThreeNumbers</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f</span>(<span class="number">3</span>));</span><br><span class="line"><span class="comment">// 拿上面 f这个函数举例，只要传入一个参数 z，执行，计算结果就是 1 + 2 + z 的结果，1 和 2 这两个参数就直接可以复用了。</span></span><br></pre></td></tr></table></figure><ul><li>提前返回</li><li>每次调用函数时，它只接受一部分参数，并返回一个函数（提前返回）</li><li>延迟执行</li><li>直到(延迟执行)传递所有参数为止</li><li>自定义柯里化工具函数</li><li>思路：要判断当前传入函数的参数个数 (args.length) 是否大于等于原函数所需参数个数 (fn.length) ，如果是，则执行当前函数；如果是小于，则返回一个函数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">curry</span> = (<span class="params">fn, ...args</span>) =&gt; (</span><br><span class="line">args.<span class="property">length</span> &gt;= fn.<span class="property">length</span></span><br><span class="line">? <span class="title function_">fn</span>(...args)</span><br><span class="line">: <span class="function">(<span class="params">..._args</span>) =&gt;</span> <span class="title function_">curry</span>(fn, ...args, ..._args);</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add1</span>(<span class="params">x, y, z</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> x + y + z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> add = <span class="title function_">curry</span>(add1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>)(<span class="number">3</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">1</span>)(<span class="number">2</span>, <span class="number">3</span>));</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="深浅拷贝">深浅拷贝</h2><h3 id="浅拷贝的原理和实现">浅拷贝的原理和实现</h3><blockquote><p>自己创建一个新的对象，来接受你要重新复制或引用的对象值。如果对象属性是基本的数据类型，复制的就是基本类型的值给新对象；但如果属性是引用数据类型，复制的就是内存中的地址，如果其中一个对象改变了这个内存中的地址，肯定会影响到另一个对象</p></blockquote><ul><li>Object.assign<ul><li>它不会拷贝对象的继承属性；</li><li>它不会拷贝对象的不可枚举的属性；</li><li>可以拷贝 Symbol 类型的属性</li></ul></li></ul><blockquote><p>object.assign 的语法为：Object.assign(target, …sources)</p></blockquote><ul><li>扩展运算符方式</li><li>concat 拷贝数组</li><li>slice 拷贝数组[不影响原始数组]</li></ul><blockquote><p>arr.slice(begin, end)</p></blockquote><h3 id="自定义浅拷贝">自定义浅拷贝</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">shallowClone</span> = target =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">&#x27;object&#x27;</span> &amp;&amp; target !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> cloneTarget = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) ? []: &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">      <span class="keyword">if</span> (target.<span class="title function_">hasOwnProperty</span>(prop)) &#123;</span><br><span class="line">          cloneTarget[prop] = target[prop];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cloneTarget;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// copilot 优化后</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shallowClone</span> = target =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">&#x27;object&#x27;</span> &amp;&amp; target !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) ? [...target] : &#123;...target&#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="深拷贝原理及实现">深拷贝原理及实现</h3><blockquote><p>将一个对象从内存中完整地拷贝出来一份给目标对象，并从堆内存中开辟一个全新的空间存放新对象，且新对象的修改并不会改变原对象，二者实现真正的分离</p></blockquote><ul><li><p>JSON.stringify</p><ul><li>拷贝的对象的值中如果有函数、undefined、symbol 这几种类型，经过 JSON.stringify 序列化之后的字符串中这个键值对会消失</li><li>拷贝 Date 引用类型会变成字符串</li><li>无法拷贝不可枚举的属性</li><li>无法拷贝对象的原型链</li><li>拷贝 RegExp 引用类型会变成空对象</li><li>对象中含有 NaN、Infinity 以及 -Infinity，JSON 序列化的结果会变成 null</li><li>无法拷贝对象的循环应用，即对象成环 (obj[key] = obj)</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">function</span> <span class="title function_">Obj</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">func</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="title function_">alert</span>(<span class="number">1</span>) &#125;; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">obj</span> = &#123;<span class="attr">a</span>:<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">und</span> = <span class="literal">undefined</span>; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reg</span> = <span class="regexp">/123/</span>; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">0</span>); </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">NaN</span> = <span class="title class_">NaN</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">infinity</span> = <span class="title class_">Infinity</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sym</span> = <span class="title class_">Symbol</span>(<span class="number">1</span>);</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">let</span> obj1 = <span class="keyword">new</span> <span class="title class_">Obj</span>();</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj1,<span class="string">&#x27;innumerable&#x27;</span>,&#123; </span><br><span class="line">    <span class="attr">enumerable</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">value</span>:<span class="string">&#x27;innumerable&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj1&#x27;</span>,obj1);</span><br><span class="line">  <span class="keyword">let</span> str = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj1);</span><br><span class="line">  <span class="keyword">let</span> obj2 = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(str);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj2&#x27;</span>,obj2);</span><br><span class="line">  <span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 递归</span></span><br><span class="line"><span class="string">  - 这个深拷贝函数并不能复制不可枚举的属性以及 Symbol 类型</span></span><br><span class="line"><span class="string">  - 这种方法只是针对普通的引用类型的值做递归复制，而对于 Array、Date、RegExp、Error、Function 这样的引用类型并不能正确地拷贝</span></span><br><span class="line"><span class="string">  - 对象的属性里面成环，即循环引用没有解决</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">  `</span><span class="string">``</span>javascript</span><br><span class="line">  <span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">a</span>:&#123;</span><br><span class="line">      <span class="attr">b</span>:<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj</span>) &#123; </span><br><span class="line">    <span class="keyword">let</span> cloneObj = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;                 <span class="comment">//遍历</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> obj[key] ===<span class="string">&#x27;object&#x27;</span>) &#123; </span><br><span class="line">        cloneObj[key] = <span class="title function_">deepClone</span>(obj[key])  <span class="comment">//是对象就再次调用该函数递归</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cloneObj[key] = obj[key]  <span class="comment">//基本类型的话直接复制值</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cloneObj</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> obj2 = <span class="title function_">deepClone</span>(obj1);</span><br><span class="line">  obj1.<span class="property">a</span>.<span class="property">b</span> = <span class="number">2</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(obj2);   <span class="comment">//  &#123;a:&#123;b:1&#125;&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>改良版</p><ul><li>针对能够遍历对象的不可枚举属性以及 Symbol 类型，我们可以使用 Reflect.ownKeys 方法</li><li>当参数为 Date、RegExp 类型，则直接生成一个新的实例返回</li><li>利用 Object 的 getOwnPropertyDescriptors 方法可以获得对象的所有属性，以及对应的特性，顺便结合 Object 的 create 方法创建一个新对象，并继承传入原对象的原型链</li><li>利用 WeakMap 类型作为 Hash 表，因为 WeakMap 是弱引用类型，可以有效防止内存泄漏（你可以关注一下 Map 和 weakMap 的关键区别，这里要用 weakMap），作为检测循环引用很有帮助，如果存在循环，则引用直接返回 WeakMap 存储的值</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isComplexDataType</span> = obj =&gt; (<span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> obj === <span class="string">&#x27;function&#x27;</span>) &amp;&amp; (obj !== <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> deepClone = <span class="keyword">function</span> (<span class="params">obj, hash = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj.<span class="property">constructor</span> === <span class="title class_">Date</span>) </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(obj)       <span class="comment">// 日期对象直接返回一个新的日期对象</span></span><br><span class="line">  <span class="keyword">if</span> (obj.<span class="property">constructor</span> === <span class="title class_">RegExp</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(obj)     <span class="comment">//正则对象直接返回一个新的正则对象</span></span><br><span class="line">  <span class="comment">//如果循环引用了就用 weakMap 来解决</span></span><br><span class="line">  <span class="keyword">if</span> (hash.<span class="title function_">has</span>(obj)) <span class="keyword">return</span> hash.<span class="title function_">get</span>(obj)</span><br><span class="line">  <span class="keyword">let</span> allDesc = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(obj)</span><br><span class="line">  <span class="comment">//遍历传入参数所有键的特性</span></span><br><span class="line">  <span class="keyword">let</span> cloneObj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj), allDesc)</span><br><span class="line">  <span class="comment">//继承原型链</span></span><br><span class="line">  hash.<span class="title function_">set</span>(obj, cloneObj)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(obj)) &#123; </span><br><span class="line">    cloneObj[key] = (<span class="title function_">isComplexDataType</span>(obj[key]) &amp;&amp; <span class="keyword">typeof</span> obj[key] !== <span class="string">&#x27;function&#x27;</span>) ? <span class="title function_">deepClone</span>(obj[key], hash) : obj[key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneObj</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 下面是验证代码</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">num</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">str</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">boolean</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">unf</span>: <span class="literal">undefined</span>,</span><br><span class="line">  <span class="attr">nul</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;我是一个对象&#x27;</span>, <span class="attr">id</span>: <span class="number">1</span> &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  <span class="attr">func</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;我是一个函数&#x27;</span>) &#125;,</span><br><span class="line">  <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">0</span>),</span><br><span class="line">  <span class="attr">reg</span>: <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;/我是一个正则/ig&#x27;</span>),</span><br><span class="line">  [<span class="title class_">Symbol</span>(<span class="string">&#x27;1&#x27;</span>)]: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;innumerable&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="string">&#x27;不可枚举属性&#x27;</span> &#125;</span><br><span class="line">);</span><br><span class="line">obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(obj, <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(obj))</span><br><span class="line">obj.<span class="property">loop</span> = obj    <span class="comment">// 设置loop成循环引用的属性</span></span><br><span class="line"><span class="keyword">let</span> cloneObj = <span class="title function_">deepClone</span>(obj)</span><br><span class="line">cloneObj.<span class="property">arr</span>.<span class="title function_">push</span>(<span class="number">4</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj&#x27;</span>, obj)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;cloneObj&#x27;</span>, cloneObj)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<ul><li>Js中的数字由64位浮点数组成</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = <span class="number">0.1</span>+<span class="number">0.2</span>; <span class="comment">// result will be 0.30000000000000004 --17个小数位</span></span><br><span class="line"><span class="comment">// 0.30000000000000004 --17个小数位</span></span><br><span class="line"><span class="comment">// js中的浮点数相加并不总是100%正确</span></span><br></pre></td></tr></table></figure><ul><li>Js 根据前缀来解析数值常量</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> y = <span class="number">0377</span>;     八进制数</span><br><span class="line"><span class="keyword">var</span> z = <span class="number">0xFF</span>;     十六进制数</span><br><span class="line">使用 <span class="title function_">toString</span>() 函数即可将数字转换为不同进制</span><br><span class="line"><span class="keyword">var</span> myNumber=<span class="number">128</span>;</span><br><span class="line">myNumber.<span class="title function_">toString</span>(<span class="number">16</span>);<span class="regexp">/ 128.toString(16);   /</span><span class="regexp">/ returns 80---转化为16进制数</span></span><br><span class="line"><span class="regexp">parseInt(myNumber,16);   /</span><span class="regexp">/ 128 ---转换为十进制数</span></span><br></pre></td></tr></table></figure><ul><li>Ajax函数的封装</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">method,url,<span class="string">&quot;&quot;</span>,success</span>) &#123;</span><br><span class="line">  <span class="comment">// 创建一个对象</span></span><br><span class="line">  <span class="keyword">var</span> xhr=<span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>) &#123;</span><br><span class="line">    xhr=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    xhr=<span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHttp&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 发送信息,根据请求方式更改url </span></span><br><span class="line">  <span class="keyword">if</span> (method===<span class="string">&quot;get&quot;</span> &amp;&amp; date) &#123;</span><br><span class="line">    url+=<span class="string">&quot;?&quot;</span>+date;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 对请求方式进行判断并进行发送</span></span><br><span class="line">  <span class="keyword">if</span> (method===<span class="string">&quot;get&quot;</span>) &#123;</span><br><span class="line">    xhr.<span class="title function_">send</span>();</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;content-type&quot;</span>,<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">    xhr.<span class="title function_">send</span>(date);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 设置回调函数</span></span><br><span class="line">  xhr.<span class="property">onreadystatechange</span>=<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.<span class="property">status</span>===<span class="number">200</span>) &#123;</span><br><span class="line">        success&amp;&amp;<span class="title function_">success</span>();</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;出错了：&quot;</span>+xhr.<span class="property">status</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">请求状态解析:</span><br><span class="line"><span class="number">1.</span> 未打开</span><br><span class="line"><span class="number">2.</span> 未发送</span><br><span class="line"><span class="number">3.</span> 已获取响应体</span><br><span class="line"><span class="number">4.</span> 正在下载响应体</span><br><span class="line"><span class="number">5.</span> 请求完成</span><br><span class="line"></span><br><span class="line">当我们多个请求需要依赖于上一个请求的服务端响应时，回调函数中<span class="title class_">Ajax</span> 的层级逐步提高，可维护性极度下降----回调地狱!!!</span><br></pre></td></tr></table></figure><ul><li>Promise</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise 初始状态是 pending</span></span><br><span class="line"><span class="comment">// resolve 被调用时，将 Promise 状态改为成功(fulfilled)</span></span><br><span class="line"><span class="comment">// reject 被调用时，将 Promise 状态改为失败(rejected)</span></span><br><span class="line"><span class="comment">// 该匿名函数抛出错误时，Promise 状态为失败(rejected)</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;) </span><br><span class="line">a.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">val</span>)&#123;</span><br><span class="line">  <span class="comment">// then() 有两个函数作为参数，onfulfilled 和 onrejected</span></span><br><span class="line">  <span class="comment">// 当 Promise 状态为 fulfilled 时，调用 then 的 onfulfilled 方法</span></span><br><span class="line">  <span class="comment">// 当 Promise 状态为 rejected 时，调用 then 的 onrejected 方法</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(val)    </span><br><span class="line">  <span class="comment">// then() 方法返回 Promise 对象实例，所以可被链式调用</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="comment">// 链式调用的第二个环节，处理上一个环节返回的 Promise 对象</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(val)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>关于控制台输出undefined的问题</p><ul><li>控制台输出的是你输入的表达式计算出的结果</li><li>如果你输入的是js语句，或者没有返回值的函数，就输出undefined</li></ul></li><li><p>变量提升</p><ul><li>Javascript语言是&quot;先解析，后运行&quot;，解析时就已经完成了变量声明</li></ul></li><li><p>获取网页大小方法汇总</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPagearea</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 文档的渲染模式： 怪异模式</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">compatMode</span> == <span class="string">&quot;BackCompat&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">width</span>: <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">scrollWidth</span>, <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span>),</span><br><span class="line">    　<span class="attr">height</span>: <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">scrollHeight</span>, <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 文档的渲染： 标准模式</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">width</span>: <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollWidth</span>, <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>),</span><br><span class="line">      <span class="attr">height</span>: <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollHeight</span>, <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ret = <span class="title function_">getPagearea</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;结果为::&quot;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(ret));</span><br></pre></td></tr></table></figure><ul><li><p>原型链<br><img src="./images/prototype.jpg" alt="原型链"></p></li><li><p>检测对象的属性是定义在原型上还是自身上</p><ul><li>遍历对像原型的属性消耗性能</li><li>hasOwnProperty 唯一一个只涉及对象自身属性而不会遍历原型链的方法</li></ul></li></ul><p>In运算符：</p><ul><li><p>for…in</p><ul><li>以任意顺序遍历一个对象的除<code>Symbol</code>以外的<code>可枚举属性</code></li><li>通过 Object.defineProperty 定义的属性，<code>可枚举</code> 标识符 默认为 false</li></ul></li><li><p>forEach</p><ul><li>适用于遍历数组时会自动跳过val为null/undefined的元素</li><li>遍历数组时index为Number类型</li></ul></li><li><p>void</p><ul><li>JavaScript 中非常重要的关键字，该操作符指定要<code>计算一个表达式但是不返回值</code></li></ul><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">href=<span class="string">&quot;#&quot;</span> 与 href=<span class="string">&quot;javascript:void(0)&quot;</span> 的区别</span><br><span class="line"><span class="number">1.</span> 包含了一个位置信息，默认的锚是<span class="meta">#top 也就是网页的上端</span></span><br><span class="line"><span class="number">2.</span> javascript:<span class="keyword">void</span>(<span class="number">0</span>), 仅仅表示一个死链接</span><br></pre></td></tr></table></figure></li></ul><p><strong>用记事本编写程序代码，以utf-8保存时，会加特殊字符，导致程序出BUG</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="HTML5-Drag-Api-总结">HTML5 Drag Api 总结</h3><p><img src="../images/drag-drop.jpg" alt="drag-api"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE HTML><html lang="zh-CN"><head>    <title></title>    <meta charset="UTF-8">    <style>        *{            margin: 0;            padding: 0;        }        body{          margin-top: 200px;          display: flex;          justify-content: space-around;          align-items: center;        }        #target{          width: 250px;          height: 250px;          background:url('../images/drag-drop.jpg') no-repeat center/300px 300px;          border: 1px solid #ccc;        }        #drag{          width: 200px;          height: 200px;          background-color: #bbbbbb;        }    </style></head><body>    <!-- 编辑页面使左边为拖拽到的位置，右边为所要拖拽的元素 -->    <div id="target"></div>    <div id="drag" draggable="true"></div>    <script>        drag.ondragstart = function(e){          this.style.background = 'blue';          this.innerText = '开始被拖动';          //改变下面这个属性          e.dataTransfer.effectAllowd = 'linkMove'        }        drag.ondrag = function(){          this.innerText = '正在被拖动';        }        drag.ondragend = function(){          this.innerText = '拖动结束';        }        target.ondragenter = function(e){                    this.innerText = '拖动元素进入目标元素'          e.dataTransfer.dropEffect = 'copy'         }        target.ondragover = function(e){          e.preventDefault()                             this.innerText = '拖动元素在目标元素内移动';        }        target.ondragleave = function(){          this.innerText = '拖动元素移出目标元素'         }        target.ondrop = function(e){          e.preventDefault();          this.innerText = '目标元素完全接受拖动元素'                      // document.body.removeChild(drag)        }    </script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="作用域和闭包">作用域和闭包</h3><ol><li>理解词法作用域和动态作用域</li><li>理解 JavaScript的作用域和作用域链</li><li>理解 JavaScript的执行上下文栈，可以应用堆栈信息快速定位问题</li><li>this的原理以及几种不同使用场景的取值</li><li>闭包的实现原理和作用，可以列举几个开发中闭包的实际应用</li><li>理解堆栈溢出和内存泄漏的原理，如何防止</li><li>如何处理循环的异步操作</li><li>理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理</li></ol><ul><li>自定义实现 flat</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]];</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">flat</span>(<span class="params">arr</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> result = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> val <span class="keyword">of</span> arr)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(val))&#123;</span><br><span class="line">result = result.<span class="title function_">concat</span>(<span class="title function_">flat</span>(val))</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">result.<span class="title function_">push</span>(val)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>自定义实现 Symbol</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">当调用 Symbol 的时候，会采用以下步骤：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1 如果使用 new ，就报错</span></span><br><span class="line"><span class="comment">2 如果 description 是 undefined，让 descString 为 undefined</span></span><br><span class="line"><span class="comment">3 否则 让 descString 为 ToString(description)</span></span><br><span class="line"><span class="comment">4 如果报错，就返回</span></span><br><span class="line"><span class="comment">5 返回一个新的唯一的 Symbol 值，它的内部属性 [[Description]] 值为 descString</span></span><br><span class="line"><span class="comment">考虑到还需要定义一个 [[Description]] 属性，如果直接返回一个基本类型的值，是无法做到这一点的，所以我们最终还是返回一个对象。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">为了防止不会出现同名的属性，毕竟这是一个非常重要的特性，迫不得已，我们需要修改 toString 方法，</span></span><br><span class="line"><span class="comment">让它返回一个唯一值，所以第 8 点就无法实现了，而且我们还需要再写一个用来生成 唯一值的方法，就命名为 generateName，我们将该唯一值添加到返回对象的 __Name__ 属性中保存下来</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">7.Symbol 值不能与其他类型的值进行运算，会报错。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">以 + 操作符为例，当进行隐式类型转换的时候，会先调用对象的 valueOf 方法，如果没有返回基本值，就会再调用 toString 方法，所以我们考虑在 valueOf 方法中进行报错，比如：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">10. Symbol 作为属性名，该属性不会出现在 for...in、for...of 循环中，也不会被 Object.keys()、Object.getOwnPropertyNames()、JSON.stringify() 返回。但是，它也不是私有属性，有一个 Object.getOwnPropertySymbols 方法，可以获取指定对象的所有 Symbol 属性名。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">11. 有时，我们希望重新使用同一个Symbol值，Symbol.for方法可以做到这一点。它接受一个字符串作为参数，然后搜索有没有以该参数作为名称的Symbol值。如果有，就返回这个Symbol值，否则就新建并返回一个以该字符串为名称的Symbol值。</span></span><br><span class="line"><span class="comment">这个实现类似于函数记忆，我们建立一个对象，用来储存已经创建的 Symbol 值即可。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">12. Symbol.keyFor 方法返回一个已登记的 Symbol 类型值的 key。</span></span><br><span class="line"><span class="comment">遍历 forMap,查找该值对应的键值即可。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">var</span> root = <span class="variable language_">this</span>;</span><br><span class="line"><span class="keyword">var</span> generateName = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">var</span> postfix = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">descString</span>) &#123;</span><br><span class="line">postfix++;</span><br><span class="line"><span class="keyword">return</span> <span class="string">`@@<span class="subst">$&#123;descString&#125;</span>_<span class="subst">$&#123;postfix&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> forMap = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">SymbolPolyfill</span> = <span class="keyword">function</span> <span class="title function_">Symbol</span>(<span class="params">description</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">SymbolPolyfill</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Symbol is not a constructor&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> descString = description === <span class="literal">undefined</span> ? <span class="literal">undefined</span> : description;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> symbol = <span class="title class_">Object</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line"><span class="attr">toString</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">__Name__</span>;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">valueOf</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Cannot convert a Symbol value&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(symbol, &#123;</span><br><span class="line"><span class="string">&quot;__Description__&quot;</span>: &#123;</span><br><span class="line"><span class="attr">value</span>: descString,</span><br><span class="line"><span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;__Name__&quot;</span>: &#123;</span><br><span class="line"><span class="attr">value</span>: <span class="title function_">generateName</span>(descString),</span><br><span class="line"><span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> symbol;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(<span class="title class_">SymbolPolyfill</span>, &#123;</span><br><span class="line"><span class="string">&#x27;for&#x27;</span>: &#123;</span><br><span class="line"><span class="attr">value</span>: <span class="keyword">function</span>(<span class="params">description</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> descString = description === <span class="literal">undefined</span> ? <span class="literal">undefined</span> : <span class="title class_">String</span>(description)</span><br><span class="line"><span class="keyword">return</span> forMap[descString] ? forMap[descString] : forMap[descString] = <span class="title class_">SymbolPolyfill</span>(descString);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&#x27;keyFor&#x27;</span>: &#123;</span><br><span class="line"><span class="attr">value</span>: <span class="keyword">function</span>(<span class="params">symbol</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> forMap) &#123;</span><br><span class="line"><span class="keyword">if</span> (forMap[key] === symbol) <span class="keyword">return</span> key;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">root.<span class="property">SymbolPolyfill</span> = <span class="title class_">SymbolPolyfill</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">SymbolPolyfill</span>(<span class="number">1</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">SymbolPolyfill</span>(<span class="number">1</span>).<span class="title function_">toString</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">String</span>(<span class="title class_">SymbolPolyfill</span>(<span class="number">1</span>)));</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="title class_">SymbolPolyfill</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="title class_">SymbolPolyfill</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a === b); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line">o[a] = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">o[b] = <span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o); <span class="comment">// Object &#123; &quot;@@foo_1&quot;: &quot;hello&quot;, &quot;@@foo_2&quot;: &quot;hi&quot; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span> + symbol); <span class="comment">// 报错</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>JavaScript作用域和作用域链</p><ul><li>作用域： 决定了代码区块中变量的可见性<ul><li>词法作用域：函数的作用域在函数定义的时候就决定了（取决于函数定义的位置）</li><li>动态作用域：函数的作用域在函数调用的时候就决定了（取决于函数的调用）</li></ul>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">var</span> value = <span class="number">2</span>;</span><br><span class="line"><span class="title function_">foo</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">bar</span>();<span class="comment">//1</span></span><br><span class="line"><span class="comment">// javascript 采用的词法作用域</span></span><br></pre></td></tr></table></figure></li><li>作用域链： 内层作用域可以访问外层作用域中的变量(由里至外)</li></ul></li><li><p>处理循环的异步操作</p><ul><li>await</li><li>递归调用</li></ul>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getMoney</span>(<span class="params">i</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> money=[<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>]</span><br><span class="line">  compute.<span class="title function_">exec</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i &lt; money.<span class="property">length</span> ) &#123;  </span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(money[i]);</span><br><span class="line">      i++;</span><br><span class="line">  <span class="title function_">getMoney</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getMoney</span>(<span class="number">0</span>);<span class="comment">//开始调用</span></span><br></pre></td></tr></table></figure></li><li><p>理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理</p><ul><li>避免变量污染，命名冲突</li><li>提高代码利用率</li><li>提高维护性</li><li>依赖关系的管理</li><li>AMD CMD CommonJS</li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="原型和原型链">原型和原型链</h3><ol><li>理解原型设计模式以及 JavaScript中的原型规则</li><li>instanceof的底层实现原理，手动实现一个 instanceof</li><li>实现继承的几种方式以及他们的优缺点</li><li>至少说出一种开源项目(如 Node)中应用原型继承的案例</li><li>可以描述 new一个对象的详细过程，手动实现一个 new操作符</li><li>理解 es6class构造以及继承的底层实现原理</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="变量和类型">变量和类型</h3><ol><li>JavaScript规定了几种语言类型</li><li>JavaScript对象的底层数据结构是什么</li><li>Symbol类型在实际开发中的应用、可手动实现一个简单的 Symbol</li><li>JavaScript中的变量在内存中的具体存储形式</li><li>基本类型对应的内置对象，以及他们之间的装箱拆箱操作</li><li>理解值类型和引用类型</li><li>null和 undefined的区别</li><li>至少可以说出三种判断 JavaScript数据类型的方式，以及他们的优缺点，如何准确的判断数组类型</li><li>可能发生隐式类型转换的场景以及转换原则，应如何避免或巧妙应用</li><li>出现小数精度丢失的原因， JavaScript可以存储的最大数字、最大安全数字， JavaScript处理大数字的方法、避免精度丢失的方法</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="语法和API">语法和API</h3><ol><li>理解 ECMAScript和 JavaScript的关系</li><li>熟练运用 es5、 es6提供的语法规范</li><li>熟练掌握 JavaScript提供的全局对象（例如 Date、 Math）、全局函数（例如 decodeURI、 isNaN）、全局属性（例如 Infinity、 undefined）</li><li>熟练应用 map、 reduce、 filter 等高阶函数解决问题</li><li>setInterval需要注意的点，使用 settimeout实现 setInterval</li><li>JavaScript提供的正则表达式 API、可以使用正则表达式（邮箱校验、 URL解析、去重等）解决常见问题</li><li>JavaScript异常处理的方式，统一的异常处理方案</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="执行机制">执行机制</h3><ol><li>为何 try里面放 return， finally还会执行，理解其内部机制</li><li>JavaScript如何实现异步编程，可以详细描述 EventLoop机制</li><li>宏任务和微任务分别有哪些</li><li>可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法</li><li>使用 Promise实现串行</li><li>Node与浏览器 EventLoop的差异</li><li>如何在保证页面运行流畅的情况下处理海量数据</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字节长度-字符长度</span></span><br><span class="line"><span class="comment"> * charCodeAt() 方法返回指定位置字符的 Unicode 编码(码点)。这个返回值是 0 - 65535 之间的整数</span></span><br><span class="line"><span class="comment"> * charAt() 方法从一个字符串中返回指定的字符</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 65535 是计算机16位二进制最大数 2^16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">byteLength</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> length = <span class="number">0</span>;</span><br><span class="line">  <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">this</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">char, index</span>) &#123;</span><br><span class="line">    <span class="comment">// 字符编码大于255，说明是双字节字符</span></span><br><span class="line">    <span class="keyword">if</span> (char.<span class="title function_">charCodeAt</span>(index) &gt; <span class="number">255</span>) &#123;</span><br><span class="line">      length += <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      length++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取文本px宽度</span></span><br><span class="line"><span class="comment"> * font&#123;String&#125;: 字体样式 eg: normal 36px Robot</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pxWidth</span> = <span class="keyword">function</span> (<span class="params">font</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pxWidth</span>.<span class="property">canvas</span> || (<span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pxWidth</span>.<span class="property">canvas</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>));</span><br><span class="line">  <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line"></span><br><span class="line">  font &amp;&amp; (context.<span class="property">font</span> = font);</span><br><span class="line">  <span class="keyword">const</span> metrics = context.<span class="title function_">measureText</span>(<span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> metrics.<span class="property">width</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">DETAULT_STR</span> =</span><br><span class="line">  <span class="string">&#x27;text1#&#123;begin_d19e228fd984e3e39f428b1828bf0471&#125;#&#123;fm-SM8eIUMMK5&#125;#&#123;createrId&#125;text2#&#123;end_d19e228fd984e3e39f428b1828bf0471&#125;#&#123;fm-SM8eIUMMK5&#125;#&#123;createrId&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按指定规则提取变量</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">exactVarsFromString</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  str: string = <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">  pattern = /\#\&#123;(.+?)\&#125;/g,</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">const</span> list = [];</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    result = pattern.<span class="title function_">exec</span>(str);</span><br><span class="line">    <span class="comment">// console.log(&#x27;result=&#x27;, result);</span></span><br><span class="line">    result &amp;&amp; list.<span class="title function_">push</span>(result[<span class="number">1</span>]);</span><br><span class="line">  &#125; <span class="keyword">while</span> (result);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO 测试</span></span><br><span class="line"><span class="comment">// const result = exactVarsFromString(DETAULT_STR);</span></span><br><span class="line"><span class="comment">// console.log(&#x27;result&#x27;, result);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">stringReplacement</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  str: string,</span></span><br><span class="line"><span class="params">  patten: any,</span></span><br><span class="line"><span class="params">  replacement: string = <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params"></span>) =&gt; str.<span class="title function_">replace</span>(patten, replacement);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line"><span class="comment">// result [</span></span><br><span class="line"><span class="comment">//   &#x27;begin_d19e228fd984e3e39f428b1828bf0471&#x27;,</span></span><br><span class="line"><span class="comment">//   &#x27;fm-SM8eIUMMK5&#x27;,</span></span><br><span class="line"><span class="comment">//   &#x27;createrId&#x27;,</span></span><br><span class="line"><span class="comment">//   &#x27;end_d19e228fd984e3e39f428b1828bf0471&#x27;,</span></span><br><span class="line"><span class="comment">//   &#x27;fm-SM8eIUMMK5&#x27;,</span></span><br><span class="line"><span class="comment">//   &#x27;createrId&#x27;</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 移除对象循环引用并返回序列化后的对象</span></span><br><span class="line"><span class="comment"> * JSON.stringify(json, getCircularReplacer(), 4)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getJsonStr</span> = (<span class="params">json: <span class="built_in">Object</span>, indent: number = <span class="number">2</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">seen</span>: <span class="title class_">WeakSet</span>&lt;object&gt; | <span class="literal">null</span> = <span class="keyword">new</span> <span class="title class_">WeakSet</span>();</span><br><span class="line">  <span class="keyword">const</span> json_str = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(</span><br><span class="line">    json,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">key: string, value: any</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span> &amp;&amp; value !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (seen?.<span class="title function_">has</span>(value)) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        seen?.<span class="title function_">add</span>(value);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;,</span><br><span class="line">    indent,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  seen = <span class="literal">null</span>; <span class="comment">// 释放cache</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> json_str;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>Symbol 实现原理</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> root = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> generateName = (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> postfix = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">descString</span>)&#123;</span><br><span class="line">      postfix++;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;@@&#x27;</span> + descString + <span class="string">&#x27;_&#x27;</span> + postfix</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">SymbolPolyfill</span> = <span class="keyword">function</span> <span class="title function_">Symbol</span>(<span class="params">description</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">SymbolPolyfill</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Symbol is not a constructor&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> descString = description === <span class="literal">undefined</span> ? <span class="literal">undefined</span> : <span class="title class_">String</span>(description)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> symbol = <span class="title class_">Object</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">      <span class="attr">toString</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">__Name__</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">valueOf</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(symbol, &#123;</span><br><span class="line">      <span class="string">&#x27;__Description__&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: descString,</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;__Name__&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="title function_">generateName</span>(descString),</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> symbol;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> forMap = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(<span class="title class_">SymbolPolyfill</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;for&#x27;</span>: &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="keyword">function</span>(<span class="params">description</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> descString = description === <span class="literal">undefined</span> ? <span class="literal">undefined</span> : <span class="title class_">String</span>(description)</span><br><span class="line">        <span class="keyword">return</span> forMap[descString] ? forMap[descString] : forMap[descString] = <span class="title class_">SymbolPolyfill</span>(descString);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;keyFor&#x27;</span>: &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="keyword">function</span>(<span class="params">symbol</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> forMap) &#123;</span><br><span class="line">            <span class="keyword">if</span> (forMap[key] === symbol) <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  root.<span class="property">SymbolPolyfill</span> = <span class="title class_">SymbolPolyfill</span>;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>优化</strong></p><ul><li>Javascript中的垃圾回收及内存优化</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;before&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;override a&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> a = b; <span class="comment">//重写a</span></span><br><span class="line"><span class="title class_">Js</span>解释器检测到 <span class="string">&quot;before&quot;</span> 字符失去引用，释放该字符所存储的空间。</span><br><span class="line">例如:函数中变量的回收说明</span><br><span class="line">调用函数<span class="title function_">fun</span>() 函数中的变量被标记为<span class="string">&quot;进入环境&quot;</span>，其他变量被标记为<span class="string">&quot;外环境&quot;</span>，js解释器会清除掉所有外环境中没有被引用的变量</span><br></pre></td></tr></table></figure><ul><li>针对数据的优化</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="title class_">Object</span></span><br><span class="line"><span class="comment">// 删除obj对象的所有属性，高效的将obj转化为一个崭新的对象！</span></span><br><span class="line"></span><br><span class="line">cr.<span class="property">wipe</span> = <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(p))</span><br><span class="line">    <span class="keyword">delete</span> obj[p];</span><br><span class="line">  &#125; </span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>数组<span class="title class_">Array</span>的优化:</span><br><span class="line">将数组<span class="title class_">Array</span>.<span class="property">length</span> = <span class="number">0</span>;替代 <span class="title class_">Array</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>方法的优化</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="总结">总结</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">vue  vue-router  vuex  iview  fetch  npm  render vue原理</span><br><span class="line">es6</span><br><span class="line">*<span class="title class_">Map</span> 一个key对应一个value    <span class="keyword">for</span>..<span class="property">of</span>  forEach</span><br><span class="line">*<span class="title class_">Set</span>  自动过滤</span><br><span class="line">promise</span><br><span class="line">*generator</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">await</span></span><br><span class="line">nodejs</span><br><span class="line">模块 <span class="title class_">CommonJs</span>规范</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span><span class="built_in">require</span></span><br><span class="line">*fs文件系统模块</span><br><span class="line">readFile readFileSync 同步读取 不接收回调函数,直接返回结果,读取文件发生错误,用<span class="keyword">try</span> <span class="keyword">catch</span>捕获该错误</span><br><span class="line">writeFile writeFileSync</span><br><span class="line">stat获取文件信息</span><br><span class="line">createReadStream 从文件流读取文本内容 data事件表示流的数据已经可以读取了 end事件表示这个流已经到末尾了，没有数据可以读取了  error事件表示出错</span><br><span class="line">createWriteStream 以流的形式写入文件 不断调用<span class="title function_">write</span>()方法，最后以<span class="title function_">end</span>()结束</span><br><span class="line">stream流数据结构 pipe</span><br><span class="line">*http</span><br><span class="line">createServer 创建http server，并传入回调函数</span><br><span class="line">express</span><br><span class="line">koa1<span class="number">.0</span> </span><br><span class="line">koa2</span><br><span class="line"><span class="title class_">JavaScript</span></span><br><span class="line">事件循环机制</span><br><span class="line">*深浅拷贝</span><br><span class="line"><span class="title class_">Array</span>   slice、concat、<span class="title class_">Array</span>.<span class="title function_">from</span>()  只能实现一维数组的深拷贝</span><br><span class="line"><span class="title class_">Object</span><span class="title class_">Object</span>.<span class="title function_">assign</span>()只能实现一维对象的深拷贝</span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj)) 不能深拷贝含有<span class="literal">undefined</span>、<span class="keyword">function</span>、<span class="built_in">symbol</span>值的对象</span><br><span class="line"><span class="literal">undefined</span>、任意的函数以及<span class="built_in">symbol</span>值，在序列化过程中被忽略（出现在非数组对象的属性值中）或被转换为<span class="literal">null</span>（出现在数组中）</span><br><span class="line">递归</span><br><span class="line">*高阶函数</span><br><span class="line">将函数作为参数</span><br><span class="line">map reduce filter</span><br><span class="line">call apply bind</span><br><span class="line">*<span class="title class_">JSON</span>数据  </span><br><span class="line">序列化<span class="title class_">JSON</span>.<span class="title function_">stringify</span>()</span><br><span class="line">第二个参数用于控制如何筛选对象的键值（指定输出的属性/传入一个函数，对每个键值对先处理） </span><br><span class="line">第三个参数为<span class="string">&quot; &quot;</span>,按缩进输出</span><br><span class="line">精确控制如何序列化对象，给这个对象定义一个<span class="title function_">toJSON</span>()的方法，直接返回<span class="title class_">JSON</span>应该序列化的数据</span><br><span class="line">反序列化 <span class="title class_">JSON</span>.<span class="title function_">parse</span>()</span><br><span class="line">第二个参数接受一个函数，对解析出的属性先处理</span><br><span class="line">*循环遍历</span><br><span class="line"><span class="keyword">for</span>...<span class="keyword">in</span>  遍历的是对象的属性名称 可遍历原型链上新增的可枚举属性 对于不存在的数组项不遍历</span><br><span class="line"><span class="keyword">for</span>...<span class="keyword">of</span>  遍历的是对象的值</span><br><span class="line">forEach   遍历数组 不返回</span><br><span class="line">map   遍历数组 返回新的数组</span><br><span class="line"><span class="built_in">object</span>.<span class="property">keys</span> 遍历对象 不包括原型中的属性，返回由属性名组成的数组</span><br><span class="line"><span class="variable language_">this</span></span><br><span class="line">*闭包</span><br><span class="line">函数中<span class="keyword">return</span>一个函数 不会立即执行，需再调用一下  每次调用都返回一个新的函数</span><br><span class="line">返回函数不要引用任何循环变量，或者后续会发生变化的变量</span><br><span class="line">要引用循环变量  再创建一个函数，用该函数的参数绑定循环变量当前的值  创建一个匿名函数并立刻执行</span><br><span class="line">借助闭包封装私有变量</span><br><span class="line">把多参数的函数变成单参数的函数</span><br><span class="line">*浏览器对象 </span><br><span class="line"><span class="variable language_">window</span>不但充当全局对象 而且表示浏览器窗口</span><br><span class="line">navigator对象 表示浏览器的信息</span><br><span class="line">screen对象表示屏幕的信息</span><br><span class="line">location对象表示当前页面的url信息 location.<span class="title function_">reload</span>() location.<span class="title function_">assign</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"><span class="variable language_">document</span>对象 表示当前页面，整个dom树的根节点</span><br><span class="line">history对象保存了浏览器的历史记录</span><br><span class="line">*正则对象</span><br><span class="line">匹配正则正则对象.<span class="title function_">test</span>(<span class="string">&quot;字符串&quot;</span>) 返回<span class="literal">true</span>/<span class="literal">false</span></span><br><span class="line">切分字符串字符串.<span class="title function_">split</span>(正则表达式)</span><br><span class="line">()分组正则对象.<span class="title function_">exec</span>(<span class="string">&quot;字符串&quot;</span>)  提取子串</span><br><span class="line">贪婪匹配加？采用非贪婪匹配</span><br><span class="line">全局搜索可以多次执行<span class="title function_">exec</span>()方法来搜索一个匹配的字符串</span><br><span class="line"><span class="title class_">Git</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<ul><li>underscore：成熟的第三方库</li><li>JQuery：全局变量$</li></ul><blockquote><p>JQuery统一了不同浏览器之间的DOM操作的差异，让我们可以简单地对DOM进行操作，underscore则提供了一套完善的函数式编程的接口，让我们更方便地在JavaScript中实现函数式编程。</p></blockquote><pre><code class="language-javascript">underscore：全局变量 &quot;_&quot;_.map([1,2,3],(x)=&gt;x*x);   //新的数组[1,4,9]_.map(&#123; a: 1, b: 2, c: 3 &#125;, (v, k) =&gt; k + '=' + v); //新的对象 ['a=1', 'b=2', 'c=3']_.mapObject()_.every([1, 4, 7, -3, -9], (x) =&gt; x &gt; 0); // false---所有元素均要满足_.some([1, 4, 7, -3, -9], (x) =&gt; x &gt; 0); // true ---某个元素满足即可var arr = [3, 5, 7, 9];_.max(arr); // 9_.max([]);  //-Infinity _.min(arr); // 3_.min([]);  //Infinity使用前应先判断是否为空_.max(&#123; a: 1, b: 2, c: 3 &#125;); // 3  只作用于value把集合的元素按照key归类var scores = [20, 81, 75, 40, 91, 59, 77, 66, 72, 88, 99];var groups = _.groupBy(scores, function (x) &#123;  if (x &lt; 60) &#123;    return 'C';  &#125;  else if (x &lt; 80) &#123;    return 'B';  &#125;  else &#123;    return 'A';  &#125;&#125;);//结果 &#123;   A: [81, 91, 88, 99],  B: [75, 77, 66, 72],  C: [20, 40, 59] &#125;官方文档：http://underscorejs.org/#collectionsArrays_.flatten([1, [2], [3, [[4], [5]]]]); // [1, 2, 3, 4, 5] 多维数组转化为一维数组zip()把两个或多个数组的所有元素按索引对齐，然后按索引合并成新数组var names = ['Adam', 'Lisa', 'Bart'];var scores = [85, 92, 59];_.zip(names, scores);// [['Adam', 85], ['Lisa', 92], ['Bart', 59]]unzip()：作用与zip()函数相反//转化为Object_.object(names, scores);// &#123;Adam: 85, Lisa: 92, Bart: 59&#125;// 从0开始小于30，步长5:_.range(0, 30, 5); // [0, 5, 10, 15, 20, 25]// 从0开始大于-10，步长-1:_.range(0, -10, -1); // [0, -1, -2, -3, -4, -5, -6, -7, -8, -9]**止步,具体操作学习 es6 !!!****</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="视口">视口</h3><ul><li>桌面端指的是浏览器的可视区域</li><li>移动端指的就是Viewport中的Layout Viewport(布局视口)</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">根据css3规范，视口单位主要包括以下<span class="number">4</span>个:</span><br><span class="line">      <span class="number">1</span>.vw：<span class="number">1</span>vw等于视口宽度的<span class="number">1</span>%。</span><br><span class="line">      <span class="number">2</span>.vh：<span class="number">1</span>vh等于视口高度的<span class="number">1</span>%。</span><br><span class="line">      <span class="number">3</span>.vmin：选取vw和vh中最小的那个。</span><br><span class="line">      <span class="number">4</span>.vmax：选取vw和vh中最大的那个</span><br><span class="line">比如：浏览器高度<span class="number">950</span>px , 宽度为<span class="number">1920</span>px, <span class="number">1</span> vh = <span class="number">950</span>px<span class="regexp">/100 = 9.5 px  1vw = 1920px/</span><span class="number">100</span> =<span class="number">19.2</span> px</span><br></pre></td></tr></table></figure><h3 id="Rem-适配">Rem 适配</h3><ul><li>iphone 5(width:320px)</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.获取html的宽</span></span><br><span class="line"><span class="keyword">const</span> htmlwidth=<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span> || <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span>; <span class="comment">// 有些浏览器documentElement获取不到,那就使用后面的body</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(htmlwidth);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.htmlDom</span></span><br><span class="line"><span class="keyword">let</span> htmlDom=<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;html&quot;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(htmlDom);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.设置根元素样式</span></span><br><span class="line">htmlDom.<span class="property">style</span>.<span class="property">fontSize</span>=htmlwidth/<span class="number">20</span>+<span class="string">&#x27;px&#x27;</span>;<span class="comment">//记住这个20是等份的意思,这样每一份是16px,即1rem=16px;</span></span><br></pre></td></tr></table></figure><ul><li>iphone 6+</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ================================================</span></span><br><span class="line"><span class="comment">    *   设置根元素font-size</span></span><br><span class="line"><span class="comment">    * 当设备宽度为375(iPhone6)时，根元素font-size=16px; </span></span><br><span class="line"><span class="comment">    × ================================================</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params">doc, win</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> docEl = win.<span class="property">document</span>.<span class="property">documentElement</span>;</span><br><span class="line">  <span class="keyword">var</span> resizeEvt = <span class="string">&#x27;orientationchange&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span> ? <span class="string">&#x27;orientationchange&#x27;</span> : <span class="string">&#x27;resize&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> refreshRem = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> clientWidth = win.<span class="property">innerWidth</span></span><br><span class="line">                      || doc.<span class="property">documentElement</span>.<span class="property">clientWidth</span></span><br><span class="line">                      || doc.<span class="property">body</span>.<span class="property">clientWidth</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(clientWidth)</span><br><span class="line">    <span class="keyword">if</span> (!clientWidth) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">var</span> fz;</span><br><span class="line">    <span class="keyword">var</span> width = clientWidth;</span><br><span class="line">    fz = <span class="number">16</span> * width / <span class="number">375</span>;</span><br><span class="line">    docEl.<span class="property">style</span>.<span class="property">fontSize</span> = fz + <span class="string">&#x27;px&#x27;</span>;<span class="comment">//这样每一份也是16px,即1rem=16px</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!doc.<span class="property">addEventListener</span>) <span class="keyword">return</span>;</span><br><span class="line">  win.<span class="title function_">addEventListener</span>(resizeEvt, refreshRem, <span class="literal">false</span>);</span><br><span class="line">  doc.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, refreshRem, <span class="literal">false</span>);</span><br><span class="line">  <span class="title function_">refreshRem</span>();</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="variable language_">document</span>, <span class="variable language_">window</span>);</span><br></pre></td></tr></table></figure><h3 id="等比例缩放">等比例缩放</h3><p>window.innerWidth<br>window.screen<br>以iPhone 5手机屏幕为例，1vw =320/100;<br>HTML:font-size:100px;<br>下面布局以根元素字体大小为基准进行相应的宽高转换，<br>优点：屏幕变大，显示信息增多<br>参考：网易，淘宝，天猫<br>百分比布局：<br>拉钩</p><p>总像素点=倍率*逻辑分辨率<br>倍率：用成倍的像素点来描述之前的某一个像素点，使得图片显示更清晰，同理，像密越大ppi</p><p>高德地图API的使用：使用其内部对象定义的一些方法来对页面地图做一个显示</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<ul><li>早期记录</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br></pre></td><td class="code"><pre><span class="line">详细语法参考:</span><br><span class="line">http:<span class="comment">//es6.ruanyifeng.com/#docs/destructuring</span></span><br><span class="line">babel:用来编译es6为浏览器认识的es5.</span><br><span class="line">Traceur:用来编译es6为浏览器认识的es5.（Chrome）</span><br><span class="line"></span><br><span class="line">let:声明的变量拥有块级作用域</span><br><span class="line">let声明的全局变量不是全局对象的属性---&gt;window.name 错误！！！</span><br><span class="line">形如<span class="keyword">for</span> (let x...)的循环在每次迭代时都为x创建新的绑定</span><br><span class="line">let声明的变量直到控制流到达该变量被定义的代码行时才会被装载，所以在到达之前使用该变量会触发错误</span><br><span class="line">用let重定义变量会抛出一个语法错误（SyntaxError）</span><br><span class="line"></span><br><span class="line">Const声明的变量只可以在声明时进行赋值，并且不赋值会报错！！！</span><br><span class="line"></span><br><span class="line">##数组的复制：</span><br><span class="line">concat、slice、展开操作符(es6)</span><br><span class="line"><span class="keyword">var</span> fruit=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> f=[...fruit];   <span class="comment">//  即可完成数组的复制!!!</span></span><br><span class="line"></span><br><span class="line">解构数组：</span><br><span class="line">Let [, ,third] = [<span class="string">&#x27;foo&#x27;</span>,<span class="string">&#x27;bar&#x27;</span>,<span class="string">&#x27;baz&#x27;</span>];</span><br><span class="line"><span class="comment">//third = &#x27;baz&#x27;</span></span><br><span class="line">let [head, ...tail] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="comment">//head // 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//tail // [2, 3, 4]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let [x, y, ...z] = [<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// x  &quot;a&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// y  undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// z  []</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------</span></span><br><span class="line">es6暴露接口：</span><br><span class="line">export default</span><br><span class="line"></span><br><span class="line">对象的合并： 复制一个或者多个对象来组合成一个新的对象。</span><br><span class="line">Object.assign(target,...sources)</span><br><span class="line">target:目标对象</span><br><span class="line">sources：多个源对象</span><br><span class="line">描述:如果目标对象中的属性具有相同的键，则属性将被源中的属性覆盖.</span><br><span class="line"></span><br><span class="line">原生js回顾： </span><br><span class="line">一、</span><br><span class="line">常用循环遍历数组的方法？</span><br><span class="line">原生js中的forEach--&gt;</span><br><span class="line">该方法中有三个参数：</span><br><span class="line">参数一：遍历的当前项 | 参数二：当前项的下标 | 参数三：原数组</span><br><span class="line"><span class="keyword">var</span> arr=[<span class="number">1</span>,<span class="number">23</span>,<span class="number">45</span>,<span class="number">32</span>,<span class="number">15</span>];</span><br><span class="line"><span class="keyword">var</span> res=arr.forEach(function(item,index,arr)&#123;</span><br><span class="line">arr[index]=item * <span class="number">10</span>;</span><br><span class="line">&#125;,<span class="keyword">this</span>)</span><br><span class="line">console.log(res);  <span class="comment">//undefined:说明仅仅是遍历数组中的每一项，不会对原数组进行修改，但是可以通过索引对原数组进行修改(@@修改了指向@@)</span></span><br><span class="line">console.log(arr);</span><br><span class="line"><span class="number">1.</span> 原生js中的map()---&gt;复制数组-(生成新的数组)</span><br><span class="line"><span class="keyword">var</span> arr=[<span class="number">1</span>,<span class="number">23</span>,<span class="number">45</span>,<span class="number">32</span>,<span class="number">15</span>];</span><br><span class="line"><span class="keyword">var</span> arr2=arr.map(function(item,index,arr)&#123;</span><br><span class="line"><span class="keyword">return</span> item;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(arr2);</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>  concat 的使用</span><br><span class="line">    <span class="keyword">var</span> arr=[<span class="number">12</span>,<span class="number">35</span>,<span class="number">45</span>,<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">var</span> arr1=[];</span><br><span class="line">    <span class="keyword">var</span> f=arr1.concat(arr);</span><br><span class="line">    console.log(f);</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>  语法：array.slice(start, end) 包含开始,不包含结束--返回新的数组</span><br><span class="line">    <span class="keyword">var</span> arr=[<span class="number">12</span>,<span class="number">35</span>,<span class="number">45</span>,<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">var</span> len=arr.length;</span><br><span class="line">    <span class="keyword">var</span> arr1=arr.slice(<span class="number">0</span>,len);</span><br><span class="line">    console.log(arr1);</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>  $.map():将一个数组中的元素转换到另一个数组中,   返回新的数组</span><br><span class="line"><span class="keyword">var</span> arr=[<span class="number">1</span>,<span class="number">23</span>,<span class="number">45</span>,<span class="number">32</span>,<span class="number">15</span>];</span><br><span class="line"><span class="keyword">var</span> arr2=jQuery.map(arr,function(v)&#123;</span><br><span class="line"><span class="keyword">return</span> v;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(arr2);</span><br><span class="line">each():以匹配的每一个元素作为上下文来执行一个回调函数。</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>  es6中</span><br><span class="line">     <span class="keyword">var</span> arr =[<span class="number">1</span>,<span class="number">23</span>,<span class="number">35</span>,<span class="number">45</span>];</span><br><span class="line"><span class="keyword">var</span> f=[...arr]; <span class="comment">//展开操作符来实现数组的复制</span></span><br><span class="line">console.log(f);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 微软面试题：</span></span><br><span class="line"><span class="comment">//  一个国王，100颗豆，五个人一次取豆，(每个人豆足够聪明，并尽可能的去杀更多的人，那么这五个人如何取豆？？？)</span></span><br><span class="line"><span class="comment">// 20.19.18.17.</span></span><br><span class="line">console.log(<span class="string">&#x27;es2015&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  Babel:es6--&gt;es5的转码器</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">let与const及var的区别：</span></span><br><span class="line"><span class="comment">  1. let:声明的变量拥有块级作用域</span></span><br><span class="line"><span class="comment">  2. let声明的全局变量不是全局对象的属性---&gt;window.name 错误！！！</span></span><br><span class="line"><span class="comment">      let a=1;</span></span><br><span class="line"><span class="comment">      console.log(window.a);</span></span><br><span class="line"><span class="comment">      结果：undefined</span></span><br><span class="line"><span class="comment">      var a=1;</span></span><br><span class="line"><span class="comment">      console.log(window.a);</span></span><br><span class="line"><span class="comment">      结果：1</span></span><br><span class="line"><span class="comment">  3. 形如for (let x...)的循环在每次迭代时都为x创建新的绑定</span></span><br><span class="line"><span class="comment">      &quot;异步&quot;打印循环变量：当执行到setTimeout时，此任务先暂停并保存，继续执行后续任务，当条件满足时，再将setTimeout的执行任务放回任务队列的后面。</span></span><br><span class="line"><span class="comment">    因为JavaScript是单线程的，它会先执行完整个循环的同步内容之后，才去执行其中的异步操作</span></span><br><span class="line"><span class="comment">      for(var i = 0;i&lt;10;i++)&#123;</span></span><br><span class="line"><span class="comment">          setTimeout(function()&#123;</span></span><br><span class="line"><span class="comment">              console.log(i)</span></span><br><span class="line"><span class="comment">          &#125;,100)</span></span><br><span class="line"><span class="comment">        &#125;  // 输出全是10</span></span><br><span class="line"><span class="comment">    // 输出全是10的原因是因为i是全局变量，最后访问的都是全局变量i，而每次循环改变i的值就是改变全局变量的值，故而输出值均为10</span></span><br><span class="line"><span class="comment">    闭包来解决该问题：</span></span><br><span class="line"><span class="comment">      for(var i = 0;i&lt;10;i++)&#123;</span></span><br><span class="line"><span class="comment">        (function()&#123;</span></span><br><span class="line"><span class="comment">            var j = i;</span></span><br><span class="line"><span class="comment">            setTimeout(function()&#123;</span></span><br><span class="line"><span class="comment">                console.log(j);</span></span><br><span class="line"><span class="comment">            &#125;,100)</span></span><br><span class="line"><span class="comment">        &#125;)()</span></span><br><span class="line"><span class="comment">      &#125;  // 输出0123456789;</span></span><br><span class="line"><span class="comment">      使用es6中的let来解决该问题</span></span><br><span class="line"><span class="comment">      for(let i = 0;i&lt;10;i++)&#123;</span></span><br><span class="line"><span class="comment">          setTimeout(function()&#123;</span></span><br><span class="line"><span class="comment">              console.log(i)</span></span><br><span class="line"><span class="comment">          &#125;,100)</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">  4. let声明的变量直到控制流到达该变量被定义的代码行时才会被装载，所以在到达之前使用该变量会触发错误</span></span><br><span class="line"><span class="comment">  5. 用let重定义变量会抛出一个语法错误（SyntaxError）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  1. const声明的变量只可以在声明时进行赋值，并且不赋值会报错！！！</span></span><br><span class="line"><span class="comment">       const fruit = &#x27;apple&#x27;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Es5  es3 以前,js内置只有 全局作用域 和 函数作用域&#123;&#125;</span></span><br><span class="line"><span class="comment">//  var 介绍</span></span><br><span class="line"><span class="comment">  1. var ：只是函数作用域。只有函数能约束它的作用范围。</span></span><br><span class="line"><span class="comment">    function fuc()&#123;</span></span><br><span class="line"><span class="comment">      var i=0;</span></span><br><span class="line"><span class="comment">      console.log(i);//i=0</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">  console.log(i);//undefined:函数外面访问不到函数内部定义的变量</span></span><br><span class="line"><span class="comment">  2. 代码块</span></span><br><span class="line"><span class="comment">  [</span></span><br><span class="line"><span class="comment">  var i=0;</span></span><br><span class="line"><span class="comment">  console.log(i);// i=0</span></span><br><span class="line"><span class="comment">]</span></span><br><span class="line"><span class="comment">代码块外面：console.log(i);--&gt;i=0</span></span><br><span class="line"><span class="comment">代码块对var 定义的变量不起约束作用，代码块外面可以访问到代码块中定义的函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 1.let块作用域</span></span><br><span class="line"><span class="comment">// if(true) &#123;</span></span><br><span class="line"><span class="comment">//   let x = 8;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(x);   ret:报错!!!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.const 恒量</span></span><br><span class="line"><span class="comment">// const fruit = &#x27;apple&#x27;;</span></span><br><span class="line"><span class="comment">// // const不允许修改</span></span><br><span class="line"><span class="comment">// fruit = &#x27;banana&#x27;;  ret：报错!!!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const fruit = [];  // 可操作</span></span><br><span class="line"><span class="comment">// fruit.push(&#x27;banana&#x27;);</span></span><br><span class="line"><span class="comment">// console.log(fruit);</span></span><br><span class="line"><span class="comment">// fruit = [&#x27;x&#x27;];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var arr = [&#x27;a&#x27;,&#x27;b&#x27;];</span></span><br><span class="line"><span class="comment">// var arr2 = arr;</span></span><br><span class="line"><span class="comment">// arr2[0] = &#x27;c&#x27;;</span></span><br><span class="line"><span class="comment">// console.log(arr);</span></span><br><span class="line"><span class="comment">// 可用来在引入第三方库时对变量的命名。</span></span><br><span class="line"><span class="comment">// const Vue=require(&#x27;Vue&#x27;);</span></span><br><span class="line"></span><br><span class="line">结构:ES6 允许按照一定的模式从数组或者对象中取值，对变量进行赋值，这种称为解构。</span><br><span class="line">不完全解构:等号左边的模式，只匹配一部分等号右边的数组。</span><br><span class="line">注意：ES6内部使用严格相等运算符(===),判断一个位置是否有值。如果一个数组成员不严格相等于undefined，默认值是不会生效的。</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.解构数组:将数组中的某个元素赋值给某个变量。</span></span><br><span class="line"><span class="comment">// function breakfast() &#123;</span></span><br><span class="line"><span class="comment">//   return [&#x27;cake&#x27;, &#x27;apple&#x27;, &#x27;egg&#x27;];</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var [dessert, fruit, chicken] = breakfast();</span></span><br><span class="line"><span class="comment">// console.log(dessert);  //  cake</span></span><br><span class="line"><span class="comment">// console.log(fruit);   //  apple</span></span><br><span class="line"><span class="comment">// console.log(chicken);  //  egg</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.解构对象---对象的属性没有次序，变量必须与属性同名!!!</span></span><br><span class="line"><span class="comment">// function breakfast() &#123;</span></span><br><span class="line"><span class="comment">//   return &#123;dessert: &#x27;cake&#x27;,fruit: &#x27;apple&#x27;,chicken: &#x27;egg&#x27;&#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">``属性名一致</span><br><span class="line"> <span class="keyword">var</span> &#123;dessert,fruit,chicken&#125; = breakfast();</span><br><span class="line"><span class="comment">// console.log(dessert, fruit, chicken);   // ret：cake apple egg</span></span><br><span class="line">``属性名不一致--注意匹配规则</span><br><span class="line"><span class="comment">//  var &#123;dessert:f_dessert,fruit：f_fruit,chicken:f_chicken&#125; = breakfast();</span></span><br><span class="line">``对象解构默认值</span><br><span class="line"><span class="keyword">var</span> &#123;x=<span class="number">1</span>,y=<span class="number">5</span>&#125; = &#123;x:<span class="number">1</span>&#125;;    默认值</span><br><span class="line">console.log(x);</span><br><span class="line">``对象解构默认值条件---对象的属性值严格等于undefined</span><br><span class="line"><span class="keyword">var</span> &#123;x=<span class="number">1</span>,y=<span class="number">5</span>&#125; = &#123;x:undefined,y:<span class="literal">null</span>&#125;;     <span class="comment">// 1,null</span></span><br><span class="line">``现有对象的方法:对象的解构赋值，可以很方便的将现有对象的方法，赋值到某个变量上</span><br><span class="line"><span class="keyword">var</span> x;   <span class="comment">// 声明变量 x    已声明变量的结构赋值</span></span><br><span class="line">(&#123;x&#125; = &#123;x:<span class="number">1</span>&#125;)   </span><br><span class="line">console.log(Math.sin(Math.PI/<span class="number">6</span>));   <span class="comment">// 0.499...</span></span><br><span class="line">let &#123;sin, cos, tan&#125; = Math;</span><br><span class="line">console.log(sin(Math.PI/<span class="number">6</span>));  <span class="comment">// 0.499...</span></span><br><span class="line">``字符串的结构赋值--被转换为类数组的对象</span><br><span class="line"><span class="keyword">const</span> [a,b,c,d,e] = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">console.log(a);  <span class="comment">// H</span></span><br><span class="line"><span class="keyword">const</span> &#123;length:len&#125; = <span class="string">&quot;Hello&quot;</span>  <span class="comment">// console.log(len);  5</span></span><br><span class="line"></span><br><span class="line">对象变量键值的设置语法:</span><br><span class="line">let myKey = <span class="string">&#x27;key&#x27;</span>;</span><br><span class="line">let obj = &#123;</span><br><span class="line">   [myKey]:<span class="string">&#x27;one&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 5.模板字符串</span></span><br><span class="line"><span class="comment">// var dessert = &#x27;cake&#x27;,</span></span><br><span class="line"><span class="comment">//      drink = &#x27;tea&#x27;;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// var brekfast = &#x27;今天的早餐是&#x27; + dessert + &#x27;和&#x27; + drink;</span></span><br><span class="line"><span class="comment">// console.log(brekfast);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// var brekfast2 = `今天的早餐是$&#123;dessert&#125;和$&#123;drink&#125;`;</span></span><br><span class="line"><span class="comment">// console.log(brekfast2);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.带标签的模板字符串</span></span><br><span class="line"><span class="comment">// var dessert = &#x27;cake&#x27;,</span></span><br><span class="line"><span class="comment">//     drink = &#x27;tea&#x27;;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// var breakfast = tag`今天的早餐是$&#123;dessert&#125;和$&#123;drink&#125;!`;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  function tag(string, val1, val2)&#123;  //---该函数会将模板字符串以变量为切割点分割为数组。</span></span><br><span class="line"><span class="comment">//    console.log(string);    //ret : [&quot;今天的早餐是&quot;, &quot;和&quot;, &quot;!&quot;]</span></span><br><span class="line"><span class="comment">//    console.log(val1);      //ret : cake</span></span><br><span class="line"><span class="comment">//    console.log(val2);       //ret : tea</span></span><br><span class="line"><span class="comment">//  &#125; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  ...val:可用于输出模板字符串中所有的变量。</span></span><br><span class="line"><span class="comment">// function tag(string, ...val)&#123;</span></span><br><span class="line"><span class="comment">//   console.log(string);  //  [&quot;今天的早餐是&quot;, &quot;和&quot;, &quot;!&quot;]</span></span><br><span class="line"><span class="comment">//   console.log(val);     //  [&quot;cake&quot;, &quot;tea&quot;]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.判断字符串里是否含有关键字</span></span><br><span class="line"><span class="comment">// 原生js：利用indexOf():返回关键字在字符串中首次出现的位置。</span></span><br><span class="line"><span class="comment">// var dessert = &#x27;cake&#x27;,</span></span><br><span class="line"><span class="comment">//     drink = &#x27;tea&#x27;;</span></span><br><span class="line"><span class="comment">// var brekfast2 = `今天的早餐是$&#123;dessert&#125;和$&#123;drink&#125;`;</span></span><br><span class="line"><span class="comment">//   es6 中返回的是Boolean类型</span></span><br><span class="line"><span class="comment">// console.log(brekfast2.startsWith(&#x27;今天&#x27;));</span></span><br><span class="line"><span class="comment">// console.log(brekfast2.endsWith(&#x27;ea&#x27;));</span></span><br><span class="line"><span class="comment">// console.log(brekfast2.includes(&#x27;ca&#x27;));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8.默认参数</span></span><br><span class="line"><span class="comment">// function add(x, y = 5) &#123;</span></span><br><span class="line"><span class="comment">//   return x + y;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// console.log(add(2,3));</span></span><br><span class="line"><span class="comment">// console.log(add(2, 10));</span></span><br><span class="line">``函数参数的解构赋值---函数参数为一个类数组</span><br><span class="line">对象</span><br><span class="line">function <span class="function"><span class="title">fun</span><span class="params">([x, y])</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> x + y;</span><br><span class="line"> &#125;</span><br><span class="line">console.log(add([<span class="number">1</span>,<span class="number">3</span>]));</span><br><span class="line">function <span class="function"><span class="title">fun</span><span class="params">(&#123;x=<span class="number">0</span>,y=<span class="number">0</span>&#125;= &#123;&#125;)</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> [x,y];</span><br><span class="line"> &#125;</span><br><span class="line">console.log(<span class="function"><span class="title">fun</span><span class="params">(&#123;x:100,y:200&#125;)</span></span>);  [<span class="number">100</span>,<span class="number">200</span>]</span><br><span class="line">console.log(<span class="function"><span class="title">fun</span><span class="params">(&#123;x:100&#125;)</span></span>);        [<span class="number">100</span>,<span class="number">0</span>] 不给参数则默认为<span class="number">0</span></span><br><span class="line">console.log(<span class="function"><span class="title">fun</span><span class="params">(&#123;&#125;)</span></span>);             [<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">console.log(<span class="function"><span class="title">fun</span><span class="params">()</span></span>);               [<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">注意这两中写法的不同点:</span><br><span class="line">function <span class="function"><span class="title">fun</span><span class="params">(&#123;x,y&#125; = &#123;x:0,y:0&#125;)</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> [x,y];</span><br><span class="line"> &#125;</span><br><span class="line">console.log(<span class="function"><span class="title">fun</span><span class="params">(&#123;x:100,y:200&#125;)</span></span>);  [<span class="number">100</span>,<span class="number">200</span>]</span><br><span class="line">console.log(<span class="function"><span class="title">fun</span><span class="params">(&#123;x:100&#125;)</span></span>);        [<span class="number">100</span>,undefined] 不给参数则默认为<span class="number">0</span></span><br><span class="line">console.log(<span class="function"><span class="title">fun</span><span class="params">(&#123;&#125;)</span></span>);             [undefined,undefined]</span><br><span class="line">``上面三项并没有进行对象的结构赋值``</span><br><span class="line">console.log(<span class="function"><span class="title">fun</span><span class="params">()</span></span>);               [<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">   ---&gt;默认没有在函数参数中做结构赋值, 而是把<span class="string">&quot;&#123;x,y&#125; = &#123;x:0,y:0&#125;&quot;</span> 当做函数内部语句进行运行--对象结构赋值</span><br><span class="line">**结构赋值的应用**</span><br><span class="line"><span class="number">1</span> .交换变量的值:</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>; <span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">ES5:</span><br><span class="line"> <span class="keyword">var</span> temp; temp = a; a = b; b = temp;   <span class="comment">// 多出一部分内存 temp 一值占用空间</span></span><br><span class="line">Es6:</span><br><span class="line">[a,b] = [b,a];</span><br><span class="line"><span class="number">2</span> .从函数返回多个值</span><br><span class="line">###参考标题 <span class="number">3</span> --&gt;返回一个数组 </span><br><span class="line">           <span class="number">4</span> --&gt;返回一个对象</span><br><span class="line"><span class="number">3</span> .函数参数的定义</span><br><span class="line">参数是一组有次序的值--传入一个数组 --- </span><br><span class="line">function <span class="function"><span class="title">fun</span><span class="params">([x,y,z])</span></span>&#123;</span><br><span class="line">   <span class="comment">//  x = 100</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">fun</span><span class="params">([<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>])</span></span>;</span><br><span class="line">参数是一组无次序的值--传入一个对象</span><br><span class="line">function <span class="function"><span class="title">fun</span><span class="params">(&#123;id,name,age&#125;)</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">fun</span><span class="params">(&#123;id:&#x27;007&#x27;,name:&#x27;<span class="type">conan</span>&#x27;,age:28&#125;)</span></span>;</span><br><span class="line"><span class="number">4</span> .提取json数据</span><br><span class="line"><span class="keyword">var</span> jsonData = &#123;</span><br><span class="line">   id:<span class="string">&#x27;007&#x27;</span>,</span><br><span class="line">   name:<span class="string">&#x27;conan&#x27;</span>,</span><br><span class="line">   age:<span class="number">28</span>,</span><br><span class="line">   score:&#123;</span><br><span class="line">      Chinese:<span class="number">98</span>,Math:<span class="number">148</span>,English:<span class="number">107</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">let &#123;id:number,name,age,score:score&#125; = jsonData;   <span class="comment">// 通过对象的结构赋值 需要哪个取哪个</span></span><br><span class="line">console.log(number);</span><br><span class="line"><span class="number">5</span> .函数参数的默认值</span><br><span class="line"><span class="number">6</span> .遍历Map结构----映射对象</span><br><span class="line"><span class="keyword">var</span> map = new Map();</span><br><span class="line">Map.<span class="keyword">set</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;007&#x27;</span>);</span><br><span class="line">Map.<span class="keyword">set</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;conan&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span>(let [key,value] of map)&#123;</span><br><span class="line">   Console.log(key + <span class="string">&#x27;is&#x27;</span> + value);     <span class="comment">//  id is 007</span></span><br><span class="line">&#125;</span><br><span class="line">获取Map结构的key</span><br><span class="line"><span class="keyword">for</span>(let [key] of map)&#123;</span><br><span class="line">   Console.log(value);     <span class="comment">//  007</span></span><br><span class="line">&#125;</span><br><span class="line">获取Map结构的value</span><br><span class="line"><span class="keyword">for</span>(let [,value] of map)&#123;</span><br><span class="line">   Console.log(value);     <span class="comment">//  007</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 9.展开操作符：一个数组或者对象在一次调用中将它们的内容分割为&quot;独立的参数&quot;。</span></span><br><span class="line"><span class="comment">// var fruit = [&#x27;apple&#x27;, &#x27;banana&#x27;, &#x27;pear&#x27;];</span></span><br><span class="line"><span class="comment">//  可用于数组的拷贝。</span></span><br><span class="line"><span class="comment">// var f = [...fruit, &#x27;bread&#x27;];</span></span><br><span class="line"><span class="comment">// f[0] = &#x27;a&#x27;;</span></span><br><span class="line"><span class="comment">// console.log(f);</span></span><br><span class="line"><span class="comment">// console.log(fruit);</span></span><br><span class="line">展开对象: 将一个对象可枚举的属性复制到另一个对象上。</span><br><span class="line">let person = &#123;</span><br><span class="line">    name: <span class="string">&#x27;payen&#x27;</span>,</span><br><span class="line">    sex: <span class="string">&#x27;male&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line">person = &#123;...person, age: <span class="number">19</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10.剩余操作符 ----- rest语法</span></span><br><span class="line"><span class="comment">// function breakfast(dessert, drink, ...foods) &#123;</span></span><br><span class="line"><span class="comment">//   console.log(dessert);</span></span><br><span class="line"><span class="comment">//   console.log(drink);</span></span><br><span class="line"><span class="comment">//   console.log(foods);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// console.log(breakfast(&#x27;cake&#x27;, &#x27;tea&#x27;, &#x27;a&#x27;, &#x27;egg&#x27;, &#x27;peat&#x27;));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 11.解构参数</span></span><br><span class="line"><span class="comment">// function breakfast(dessert, drink, &#123;a,b&#125;) &#123;</span></span><br><span class="line"><span class="comment">//   console.log(dessert, drink);</span></span><br><span class="line"><span class="comment">//   console.log(a, b);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// var obj = &#123;a: &#x27;1608&#x27;, b: &#x27;西安&#x27;&#125;</span></span><br><span class="line"><span class="comment">// breakfast(&#x27;cake&#x27;, &#x27;tea&#x27;, obj);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 12.箭头函数</span></span><br><span class="line"><span class="comment">// var breakfast = (a) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   return a;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 13.对象表达式</span></span><br><span class="line"><span class="comment">// let d = &#x27;cake&#x27;;</span></span><br><span class="line"><span class="comment">// let c = &#x27;tea&#x27;;</span></span><br><span class="line"><span class="comment">// let food = &#123;d,c&#125;</span></span><br><span class="line"><span class="comment">// console.log(food);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 14. 对象的属性名</span></span><br><span class="line"><span class="comment">// var fruit = &#123;&#125;;</span></span><br><span class="line"><span class="comment">// var drink = &#x27;hot drink&#x27;;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// fruit[drink] = &#x27;cake&#x27;;</span></span><br><span class="line"><span class="comment">// console.log(fruit);   //  ret : &#123;&#x27;hot drink&#x27;: &quot;cake&quot;&#125;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    扩展事例：</span></span><br><span class="line"><span class="comment">    var a = 12.3;</span></span><br><span class="line"><span class="comment">    console.log(a.toFixed(3)); // 输出&quot;12.300&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    a.foo = &#x27;bar&#x27;;</span></span><br><span class="line"><span class="comment">    console.log(a.foo); // 输出undefined</span></span><br><span class="line"><span class="comment">解析：JavaScript引擎内部在处理对某个基本类型 a进行形如a.sth的操作时，会在内部临时创建一个对应的包装类型(对数字类型来说就是Number类型)的临时对象，并把对基本类型的操作代理到对这个临时对象身上，使得对基本类型的属性访问看起来像对象一样。但是在操作完成后，临时对象就扔掉了，下次再访问时，会重新建立临时对象，当然对之前的临时对象的修改都不会有效了</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// -0 === +0</span></span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="comment">// &#x27;0&#x27; == 0</span></span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="comment">// &#x27;0&#x27; === 0</span></span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"><span class="comment">// NaN == NaN(NaN与任何数值均不相等！！！)</span></span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"><span class="comment">// 判断NaN 的方法</span></span><br><span class="line"><span class="comment">// Object.is(NaN,NaN)</span></span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="comment">// Object.is(+0,-0)</span></span><br><span class="line"><span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 16. 把一个对象复制到另一个对象里</span></span><br><span class="line"><span class="comment">// var breakfast = &#123;dessert: &#x27;cake&#x27;&#125;;</span></span><br><span class="line"><span class="comment">// @ $.extend(target,[object1],[objectN])</span></span><br><span class="line"><span class="comment">// 用一个或多个其他对象来扩展一个对象，返回被扩展的对象 。</span></span><br><span class="line"><span class="comment">// 数组的合并：</span></span><br><span class="line"><span class="comment">// @ $.map(array,callback)</span></span><br><span class="line"><span class="comment">// arr:待转换的数组--&gt;将一个数组中的元素转换到另外一个数组中。</span></span><br><span class="line"><span class="comment">// @ concat():合并两个数组</span></span><br><span class="line"><span class="comment">// var arr=[],brr=[1,2,3];</span></span><br><span class="line"><span class="comment">// arr.concat(brr)</span></span><br><span class="line"><span class="comment">// @ var arr=[1,2,3];</span></span><br><span class="line"><span class="comment">// console.log(arr.slice(0,arr.length));</span></span><br><span class="line"><span class="comment">// Object.assign(target,source1,...);</span></span><br><span class="line"><span class="comment">// var obj = Object.assign(</span></span><br><span class="line"><span class="comment">//   &#123;dessert: &#x27;pizza&#x27;&#125;,</span></span><br><span class="line"><span class="comment">//    breakfast,</span></span><br><span class="line"><span class="comment">//   &#123;drink: &#x27;tea&#x27;&#125;</span></span><br><span class="line"><span class="comment">// )</span></span><br><span class="line"><span class="comment">// console.log(obj);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//17. 原型链</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    Javascript中创建对象的几种方式：</span></span><br><span class="line"><span class="comment">      对象：一切具有属性或方法的代码块</span></span><br><span class="line"><span class="comment">    1. json方式创建对象</span></span><br><span class="line"><span class="comment">     var obj = &#123;&#125;;</span></span><br><span class="line"><span class="comment">    2. new Object()方式创建对象</span></span><br><span class="line"><span class="comment">        var obj=new Object();</span></span><br><span class="line"><span class="comment">        obj.name=name;</span></span><br><span class="line"><span class="comment">        obj.showName=function()&#123;</span></span><br><span class="line"><span class="comment">            alert(&#x27;我是&#x27;+this.name);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    缺点：属性越多,代码重复性越高</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    3. 工厂方式创建对象</span></span><br><span class="line"><span class="comment">        function createPerson()&#123;</span></span><br><span class="line"><span class="comment">            var person=new Object()</span></span><br><span class="line"><span class="comment">            person.name=name;</span></span><br><span class="line"><span class="comment">            person.eat=function()&#123;</span></span><br><span class="line"><span class="comment">                alert(this.name+&#x27;吃&#x27;);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            return person</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        var p1=createPerson(&#x27;宝宝&#x27;,&#x27;男&#x27;,&#x27;20&#x27;);</span></span><br><span class="line"><span class="comment">        提高了代码的复用性</span></span><br><span class="line"><span class="comment">        缺点：不知道对象属于哪个类型</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    4. function Dog(name,sex)&#123;</span></span><br><span class="line"><span class="comment">            this.name=name;</span></span><br><span class="line"><span class="comment">            this.sex=sex;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        提高了代码的复用性</span></span><br><span class="line"><span class="comment">        优点：知道了对象属于哪个类型。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    5. 通过原型链创建的对象，所有对象公用一套方法</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    6. 构造函数加原型来创建对象</span></span><br><span class="line"><span class="comment">        function Person(name,sex)&#123;</span></span><br><span class="line"><span class="comment">            this.name=name;</span></span><br><span class="line"><span class="comment">            this.sex=sex;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        Person.prototype.showSex=function()&#123;</span></span><br><span class="line"><span class="comment">            alert(&#x27;I am a child !&#x27;);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    //优势：所有的对象公用一套方法,同时又减少了代码的重复性。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 18. super：可在实例对象的方法内部去调用构造原型(breakfast)的方法</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 19. class:专门定义&quot;原型对象&quot;</span></span><br><span class="line"><span class="comment">// 构造函数中this指向其创建的实例</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    prototype--&gt;                    constructor()--&gt;</span></span><br><span class="line"><span class="comment">    构造函数&lt;----------------------&gt;原型对象&lt;-------------------&gt;实例对象</span></span><br><span class="line"><span class="comment">                   &lt;--constructor                 &lt;-- __proto__</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    new FOO()--&gt;</span></span><br><span class="line"><span class="comment">    构造函数--------------------&gt;实例对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// Chef 定义原型对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Chef</span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">      <span class="keyword">this</span>.name=name;     <span class="comment">// 此处的this指向实例化对象</span></span><br><span class="line">  &#125;,</span><br><span class="line">  say()&#123;</span><br><span class="line">    console.log(<span class="keyword">this</span>.a); <span class="comment">// 原型对象中this指向构造函数    </span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//设置</span></span><br><span class="line">  <span class="keyword">set</span> menu(d)&#123;</span><br><span class="line">    <span class="keyword">this</span>.dish.push(d);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取</span></span><br><span class="line">  <span class="keyword">get</span> menu()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dish;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gp=new Chef();    <span class="comment">// 创建实例对象 </span></span><br><span class="line">gp.say();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动运行set方法</span></span><br><span class="line">gp.menu=<span class="string">&#x27;apple&#x27;</span>;</span><br><span class="line"><span class="comment">// 自动运行get方法</span></span><br><span class="line">console.log(gp.menu);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  实例对象调用某个方法，先在自己内部找，找不到再去原型中找，还找不到去构造函数中找、</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 20. 静态方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Chef</span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">      <span class="keyword">this</span>.name=name;</span><br><span class="line">  &#125;,</span><br><span class="line">  say()&#123;</span><br><span class="line">    console.log(<span class="keyword">this</span>.a);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span> menu(d)&#123;</span><br><span class="line">    <span class="keyword">this</span>.dish.push(d);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">get</span> menu()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dish;</span><br><span class="line">  &#125;,</span><br><span class="line">  static aaa(f)&#123;</span><br><span class="line">    console.log(f);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Chef = new Chef();  <span class="comment">//实例化 </span></span><br><span class="line">Chef.aaa(<span class="number">333</span>);   <span class="comment">// </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 21. 继承  extends</span></span><br><span class="line"><span class="comment">// 子类的原型指向父类的实例：因为父类的实例中有所有的属性和方法</span></span><br><span class="line">  <span class="comment">// 父类 class (**原型对象**)</span></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name,birthday)&#123;</span><br><span class="line">      <span class="keyword">this</span>.name=name;</span><br><span class="line">      <span class="keyword">this</span>.birthday=birthday;    <span class="comment">//constructor中定义的属性和方法 是实例对象自己的</span></span><br><span class="line">    &#125;,</span><br><span class="line">    into()&#123;</span><br><span class="line">      <span class="keyword">return</span> `$&#123;<span class="keyword">this</span>.name&#125;的生日是$&#123;<span class="keyword">this</span>.birthday&#125;`;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 子类--(通过父类原型对象来实现继承)--&gt;子类本身没有自己的this对象，必须在constructor中调用super()方法来获取父类的this对象(父类的实例).</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Chef</span> <span class="title">extends</span> <span class="title">Person</span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name,birthday)&#123;</span><br><span class="line">       <span class="keyword">super</span>():该函数用来拿取父类实例中的<span class="keyword">this</span>指针</span><br><span class="line">         <span class="keyword">super</span>(name,birthday);</span><br><span class="line">     <span class="comment">// console.log(super());      // 结果：Chef&#123;&#125;---&gt;父类的实例</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line">let gp= new Chef(<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;1900-12-12&#x27;</span>);</span><br><span class="line">console.log(gp.into());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 22. 模块化</span></span><br><span class="line">参考链接:</span><br><span class="line">http:<span class="comment">//www.shsxt.com/it/html5/904.html</span></span><br><span class="line"><span class="comment">// CommonJs暴露接口的方式:</span></span><br><span class="line">Require , eports</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// es6 暴露接口的方法：</span></span><br><span class="line">Export 可以导出 <span class="keyword">class</span> <span class="title class_">function</span> <span class="title">variabl</span>等等</span><br><span class="line"><span class="comment">// export default fruit;(只允许export 出现一次)</span></span><br><span class="line">Import fruit from <span class="string">&#x27;./categlory&#x27;</span></span><br><span class="line"><span class="comment">// export &#123;vegitables,fruit&#125;;</span></span><br><span class="line">Import &#123;fruit&#125; from <span class="string">&#x27;./categlory&#x27;</span></span><br><span class="line"></span><br><span class="line">区分：</span><br><span class="line">export function sum()&#123;&#125; </span><br><span class="line">exports.sum = function()&#123;&#125;</span><br><span class="line"></span><br><span class="line">export default sum </span><br><span class="line">exports.default = sum</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;sum&#125; from <span class="string">&#x27;math&#x27;</span> </span><br><span class="line"><span class="keyword">var</span> sum = require(<span class="string">&#x27;math&#x27;</span>).sum</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sum from <span class="string">&#x27;sum&#x27;</span> </span><br><span class="line"> <span class="keyword">var</span> sum = require(<span class="string">&#x27;sum&#x27;</span>).default</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> math from <span class="string">&#x27;math&#x27;</span> </span><br><span class="line"><span class="keyword">var</span> math = require(<span class="string">&#x27;math&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">数字判断和装换：</span><br><span class="line"></span><br><span class="line">标准JSON数组格式转换--&gt;数组：</span><br><span class="line">let  json = &#123;</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;jspang&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;技术胖&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;大胖逼逼叨&#x27;</span>,</span><br><span class="line">    length:<span class="number">3</span></span><br><span class="line">&#125; </span><br><span class="line">let arr=Array.from(json);</span><br><span class="line">console.log(arr)  <span class="comment">//  [&quot;jspang&quot;, &quot;技术胖&quot;, &quot;大胖逼逼叨&quot;]</span></span><br><span class="line"></span><br><span class="line">把一堆文本或者变量转换成数组：</span><br><span class="line">let arr =Array.of(<span class="string">&#x27;技术胖&#x27;</span>,<span class="string">&#x27;jspang&#x27;</span>,<span class="string">&#x27;大胖逼逼叨&#x27;</span>);</span><br><span class="line">console.log(arr);  <span class="comment">//  [&quot;jspang&quot;, &quot;技术胖&quot;, &quot;大胖逼逼叨&quot;]</span></span><br><span class="line"></span><br><span class="line">find():找到符合条件的数组元素就进行 <span class="keyword">return</span>--将找到的元素返回出来</span><br><span class="line">let arr=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line">console.log(arr.find((value,index,arr)&#123;</span><br><span class="line">    <span class="keyword">return</span> value &gt; <span class="number">5</span>;</span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">// ret : 6 </span></span><br><span class="line">console.log(arr.findIndex((value,index,arr)&#123;</span><br><span class="line">    <span class="keyword">return</span> value &gt; <span class="number">5</span>;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fill(): 用一个固定值填充一个数组中从起始索引到终止索引内的全部元素</span><br><span class="line">let arr=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line">arr.fill(<span class="string">&#x27;jspang&#x27;</span>,<span class="number">2</span>,<span class="number">5</span>);<span class="comment">// 包含起始不包含结束</span></span><br><span class="line">console.log(arr);  <span class="comment">// ret : [0, 1, &quot;jspang&quot;, &quot;jspang&quot;, &quot;jspang&quot;, 5, 6, 7, 8, 9]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">同时输出数组的元素和索引--&gt;结合entries()</span><br><span class="line">let arr=[<span class="string">&#x27;jspang&#x27;</span>,<span class="string">&#x27;技术胖&#x27;</span>,<span class="string">&#x27;大胖逼逼叨&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> (let [index,<span class="keyword">val</span>] of arr.entries())&#123;</span><br><span class="line">    console.log(index+<span class="string">&#x27;:&#x27;</span>+<span class="keyword">val</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*ret:</span></span><br><span class="line"><span class="comment">  0:jspang</span></span><br><span class="line"><span class="comment">  VM598:3 1:技术胖</span></span><br><span class="line"><span class="comment">  VM598:3 2:大胖逼逼叨</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">异步async-await</span><br><span class="line">function sleep(second) &#123;</span><br><span class="line">    <span class="keyword">return</span> new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            resolve(<span class="string">&#x27; enough sleep~&#x27;</span>);</span><br><span class="line">        &#125;, second);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">function normalFunc() &#123;</span><br><span class="line">    console.log(<span class="string">&#x27;normalFunc&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">async function awaitDemo() &#123;</span><br><span class="line">    await normalFunc();  <span class="comment">// 正常表达式直接执行</span></span><br><span class="line">    console.log(<span class="string">&#x27;something, ~~&#x27;</span>);</span><br><span class="line">    let result = await sleep(<span class="number">2000</span>); <span class="comment">// await 的是promise对象则异步函数停止执行并等待promise对象的状态被resolve</span></span><br><span class="line">    console.log(result);  <span class="comment">// 2s后打印</span></span><br><span class="line">&#125;</span><br><span class="line">awaitDemo();</span><br><span class="line">案例: 发送三个无关联的请求，结束后将界面的loading清除--注意不可将ajax的并发请求发成阻塞式同步的操作!!!</span><br><span class="line">function sleep(second) &#123;</span><br><span class="line">    <span class="keyword">return</span> new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            resolve(<span class="string">&#x27; enough sleep~&#x27;</span>);</span><br><span class="line">        &#125;, second);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">async function bugDemo()&#123;</span><br><span class="line">  let p1 = sleep(<span class="number">1000</span>);</span><br><span class="line">  let p1 = sleep(<span class="number">1000</span>);</span><br><span class="line">  let p1 = sleep(<span class="number">1000</span>);</span><br><span class="line">  await promise.all([p1,p2,p3]);   <span class="comment">// 避免了将ajax的并发请求发成阻塞式同步的操作!!!</span></span><br><span class="line">  console.log(<span class="string">&#x27;clear the loading&#x27;</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="如何实现准时的SetTimeout">如何实现准时的SetTimeout</h3><pre><code>- https://developer.51cto.com/art/202104/658534.htm</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html> <head>  <meta charset="utf-8">  <script src="http://lib.sinaapp.com/js/jquery/2.0.2/jquery-2.0.2.min.js"></script></head><style>  body {    min-width: 550px;    font-weight: bold;    font-size: 20px;  }  #header,  #footer {    background: rgba(29, 27, 27, 0.726);    text-align: center;    height: 60px;    line-height: 60px;  }  #container {    overflow: hidden;  }  .column {    text-align: center;    height: 300px;    line-height: 300px;  }  #left, #right, #center {    float: left;  }  #center {    width: 100%;    background: rgb(206, 201, 201);  }  #left {    width: 200px;    margin-left: -100%;    background: rgba(95, 179, 235, 0.972);  }  #right {    width: 150px;    margin-left: -150px;    background: rgb(231, 105, 2);  }  .content {    margin: 0 150px 0 200px;  }</style> <body>  <div id="header">#header</div>   <div id="container">    <div id="center" class="column">      <div class="content">#center</div>    </div>    <div id="left" class="column">#left</div>    <div id="right" class="column">#right</div>  </div>   <div id="footer">#footer</div></body> </html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Promise</span>&#123;</span><br><span class="line">  <span class="title function_">all</span>(<span class="params">promiseList</span>)&#123;</span><br><span class="line">    <span class="comment">// 判断入参是否为iterable类型</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> promiseList.<span class="property">forEach</span> === <span class="string">&quot;undefined&quot;</span>) &#123;                        </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;param is not iterable&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promiseList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = []</span><br><span class="line">      <span class="keyword">let</span> counter = <span class="number">0</span>                       </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promiseList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="comment">// 直接利用Promise.resolve处理结果，就不用自己判断类型。</span></span><br><span class="line">        <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promiseList[i]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          counter++                  </span><br><span class="line">          res[i] = res</span><br><span class="line">            <span class="comment">// 当所有都成功了之后执行resolve</span></span><br><span class="line">          <span class="keyword">if</span> (counter === promiseList.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res)</span><br><span class="line">          &#125;</span><br><span class="line">            <span class="comment">// 只要有一个抛错了，就执行reject。</span></span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">reject</span>(e))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="title function_">race</span>(<span class="params">promiseList</span>)&#123;</span><br><span class="line"><span class="comment">// 判断入参是否为iterable类型</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> promiseList.<span class="property">forEach</span> === <span class="string">&quot;undefined&quot;</span>) &#123;                        </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;param is not iterable&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> used = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promiseList.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="keyword">const</span> res = [];                    </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promiseList.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="comment">// 直接利用Promise.resolve处理结果，就不用自己判断类型。</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promiseList[i]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 只要有一个成功了，就执行resolve。</span></span><br><span class="line"><span class="keyword">if</span>(!used)&#123;</span><br><span class="line">used = <span class="literal">true</span>;</span><br><span class="line"><span class="title function_">resolve</span>(res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 只要有一个抛错了，就执行reject。</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(!used)&#123;</span><br><span class="line">used = <span class="literal">true</span>;</span><br><span class="line"><span class="title function_">reject</span>(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<ul><li><p>border-box 和 content-box (默认样式) 的区别</p><ul><li>content-box<br><img src="../images/content-box.webp" alt="content-box"></li><li>border-box<br><img src="../images/border-box.webp" alt="border-box"></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="attribute">content</span>-box 的 <span class="attribute">width</span> 不包括 <span class="attribute">padding</span> 和 <span class="attribute">border</span></span><br><span class="line">- <span class="attribute">border</span>-box 的 <span class="attribute">width</span> 包括 <span class="attribute">padding</span> 和 <span class="attribute">border</span></span><br></pre></td></tr></table></figure></li><li><p>flex: none | [ &lt;‘flex-grow’&gt; &lt;‘flex-shrink’&gt;? || &lt;‘flex-basis’&gt; ]</p><ul><li>flex-grow 增长系数 [0]<ul><li>定义项目的放大比例，默认为0，即如果存在剩余空间，也不放大</li></ul></li><li>flex-shrink 收缩系数 [1]<ul><li>定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小</li></ul></li><li>flex-basis 主轴方向上基础尺寸[auto]<ul><li>给上面两个属性分配多余空间之前, 计算项目是否有多余空间, 默认值为 auto, 按照自身内容大小等比例放大和缩小</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- flex: 1 =&gt; flex: 1 1 0; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div&quot;</span>&gt;</span>我是一个div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div&quot;</span>&gt;</span>我是一个很多字div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;div&quot;</span>&gt;</span>我是一个更多字而且第三个div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.container</span>&#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.div</span>&#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><a href="https://juejin.cn/post/6844903474774147086">flex布局</a></p></li></ul><p><img src="../../../images/flex.webp" alt="flex参数图"></p><ul><li><p>圣杯布局</p><ul><li>header和footer各自占领屏幕所有宽度，高度固定</li><li>中间的container是一个三栏布局</li><li>三栏布局两侧宽度固定不变，中间部分自动填充整个区域</li><li>中间部分的高度是三栏中最高的区域的高度</li></ul></li><li><p>双飞翼布局</p><ul><li>页面结构和圣杯布局相同，但是在中间盒子内部加了一个盒子</li><li>通过内部盒子的margin属性，将两侧盒子遮挡的位置空出来</li><li>右侧盒子的margin-left负值是px单位，百分比单位实现不了</li><li>左侧盒子的margin-left负值是百分比单位（实际的距离是中间盒子的宽度）</li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Promise</span>&#123;</span><br><span class="line">... </span><br><span class="line">  <span class="title function_">race</span>(<span class="params">promiseList</span>)&#123;</span><br><span class="line">     <span class="comment">// 判断入参是否为iterable类型</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> promiseList.<span class="property">forEach</span> === <span class="string">&quot;undefined&quot;</span>) &#123;                        </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;param is not iterable&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="keyword">let</span> used = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promiseList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = [];                    </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promiseList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="comment">// 直接利用Promise.resolve处理结果，就不用自己判断类型。</span></span><br><span class="line">        <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promiseList[i]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 只要有一个成功了，就执行resolve。</span></span><br><span class="line">            <span class="keyword">if</span>(!used)&#123;</span><br><span class="line">              used = <span class="literal">true</span>;</span><br><span class="line">              <span class="title function_">resolve</span>(res);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 只要有一个抛错了，就执行reject。</span></span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span>(!used)&#123;</span><br><span class="line">                            used = <span class="literal">true</span>;</span><br><span class="line">                            <span class="title function_">reject</span>(e);</span><br><span class="line">                        &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://juejin.cn/post/7049249948910485511">https://juejin.cn/post/7049249948910485511</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>简版Promise</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 定义状态</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">RESOLVE</span> = <span class="string">&#x27;resolve&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">REJECT</span>  = <span class="string">&#x27;reject&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MYPromise</span> &#123;</span><br><span class="line"></span><br><span class="line">  status = <span class="variable constant_">PENDING</span>;</span><br><span class="line">  result = <span class="literal">undefined</span>;</span><br><span class="line">  reason = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">  onResolvedArr = [];</span><br><span class="line">  onRejectedArr = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resolve</span> = result =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">result</span> = result;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">RESOLVE</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onResolvedArr</span>.<span class="title function_">map</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">reject</span> = reason =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">REJECT</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedArr</span>.<span class="title function_">map</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">executor</span>(resolve, reject)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">onResolved, onRejectd</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">RESOLVE</span>)&#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">onResolved</span>(<span class="variable language_">this</span>.<span class="property">result</span>), <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">REJECT</span>)&#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>), <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onResolvedArr</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> <span class="title function_">onResolved</span>(<span class="variable language_">this</span>.<span class="property">result</span>))</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onRejectedArr</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MYPromise</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>测试</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">MYPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// resolve(&#x27;Jahaw&#x27;) </span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&#x27;Jahaw&#x27;</span>), <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处 then 为同步执行代码块， 1s 前 status 为 pending</span></span><br><span class="line"><span class="comment">// 可利用发布订阅解决该问题</span></span><br><span class="line">test.<span class="title function_">then</span>(</span><br><span class="line">  <span class="function"><span class="params">res</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res),</span><br><span class="line">  <span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>终版Promise</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 定义状态</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">RESOLVE</span> = <span class="string">&#x27;resolve&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">REJECT</span>  = <span class="string">&#x27;reject&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MYPromise</span> &#123;</span><br><span class="line"></span><br><span class="line">  status = <span class="variable constant_">PENDING</span>;</span><br><span class="line">  result = <span class="literal">undefined</span>;</span><br><span class="line">  reason = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">  onResolvedArr = [];</span><br><span class="line">  onRejectedArr = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handlePromise</span> = (<span class="params">result, newPromise, resolve, reject</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(result === newPromise)&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;can not return oneself&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> resolve === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> result === <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> then = result.<span class="property">then</span>;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">        then.<span class="title function_">call</span>(</span><br><span class="line">          result,</span><br><span class="line">          <span class="function"><span class="params">r</span> =&gt;</span> <span class="title function_">handlePromise</span>(r, newPromise, resolve, reject),</span><br><span class="line">          <span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">reject</span>(e)</span><br><span class="line">        )</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(result)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="title function_">resolve</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resolve</span> = result =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">result</span> = result;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">RESOLVE</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onResolvedArr</span>.<span class="title function_">map</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">reject</span> = result =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">REJECT</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedArr</span>.<span class="title function_">map</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">executor</span>(resolve, reject)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">onResolved, onRejectd</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newPromise = <span class="keyword">new</span> <span class="title class_">MYPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">RESOLVE</span>)&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> result = <span class="title function_">onResolved</span>(<span class="variable language_">this</span>.<span class="property">result</span>)</span><br><span class="line">          <span class="title function_">handlePromise</span>(result, newPromise, resolve, reject);</span><br><span class="line">        &#125;, <span class="number">0</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">REJECT</span>)&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> reason = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">          <span class="title function_">handlePromise</span>(reason, newPromise, resolve, reject);</span><br><span class="line">        &#125;, <span class="number">0</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onResolvedArr</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> result = <span class="title function_">onResolved</span>(<span class="variable language_">this</span>.<span class="property">result</span>)</span><br><span class="line">          <span class="title function_">handlePromise</span>(result, newPromise, resolve, reject);</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedArr</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> reason = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>)</span><br><span class="line">          <span class="title function_">handlePromise</span>(reason, newPromise, resolve, reject);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newPromise;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MYPromise</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>测试</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">MYPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// resolve(&#x27;Jahaw&#x27;) </span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&#x27;Jahaw&#x27;</span>), <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可链式调用</span></span><br><span class="line">test</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function"><span class="params">res</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res),</span><br><span class="line">    <span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">  )</span><br><span class="line">  .<span class="title function_">then</span>(</span><br><span class="line">    <span class="function"><span class="params">res</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res),</span><br><span class="line">    <span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head>    <meta charset="utf-8" />    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <title>FileReader</title>    <meta name="viewport" content="width=device-width, initial-scale=1"></head><body>    <script type="text/javascript">          var result=document.getElementById("result");                  var file=document.getElementById("file");                  //判断浏览器是否支持FileReader接口                  if(typeof FileReader == 'undefined'){                      result.InnerHTML="<p>你的浏览器不支持FileReader接口！</p>";                      //使选择控件不可操作                      file.setAttribute("disabled","disabled");                  }                  function readAsDataURL(){                      //检验是否为图像文件                      var file = document.getElementById("file").files[0];                      if(!/image\/\w+/.test(file.type)){                          alert("看清楚，这个需要图片！");                          return false;                      }                      var reader = new FileReader();                      //将文件以Data URL形式读入页面                      reader.readAsDataURL(file);                      reader.onload=function(e){                          var result=document.getElementById("result");                          //显示文件                          result.innerHTML='<img src="' + this.result +'" alt="" />';                      }                  }                  function readAsBinaryString(){                      var file = document.getElementById("file").files[0];                      var reader = new FileReader();                      //将文件以二进制形式读入页面                      reader.readAsBinaryString(file);                      reader.onload=function(f){                          var result=document.getElementById("result");                          //显示文件                          result.innerHTML=this.result;                      }                  }                  function readAsText(){                      var file = document.getElementById("file").files[0];                      var reader = new FileReader();                      //将文件以文本形式读入页面                      reader.readAsText(file);                      reader.onload=function(f){                          var result=document.getElementById("result");                          //显示文件                          result.innerHTML=this.result;                      }                  }                  </script>                  <p>                      <label>请选择一个文件：</label>                      <input type="file" id="file" />                      <input type="button" value="读取图像" onclick="readAsDataURL()" />                      <input type="button" value="读取二进制数据" onclick="readAsBinaryString()" />                  <input type="button" value="读取文本文件" onclick="readAsText()" />                  </p>                  <p id="result" name="result"></p></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head><meta charset="UTF-8"><title></title><script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script></script><script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><style>table{border-collapse: collapse;border: black 1px solid;}th{text-align: center;padding: 20px 0;}td{padding: 5px 10px;border: black 1px solid;}input{border: none;                /* 浏览器自带的 input 标签样式并不好看 将 input 标签的边框去掉 */}</style></head><body><input type="file" onchange="importf(this)" /><table id="demo"></table><script>/*FileReader共有4种读取方法：1.readAsArrayBuffer(file)：将文件读取为ArrayBuffer。2.readAsBinaryString(file)：将文件读取为二进制字符串3.readAsDataURL(file)：将文件读取为Data URL4.readAsText(file, [encoding])：将文件读取为文本，encoding缺省值为'UTF-8'*/var wb;//读取完成的数据var rABS = false; //是否将文件读取为二进制字符串function importf(obj) {//导入if(!obj.files) {return;}var f = obj.files[0];var reader = new FileReader();reader.onload = function(e) {// console.log(e.target.result);if(rABS) {wb = XLSX.read(btoa(fixdata(e.target.result)), {//手动转化type: 'base64'});} else {wb = XLSX.read(e.target.result, {type: 'binary'});}//wb.SheetNames[0]是获取Sheets中第一个Sheet的名字//wb.Sheets[Sheet名]获取第一个Sheet的数据var data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);console.log(data);var keyAry = [];// 遍历json对象，获取每一列的键名for(var key in data[1]){keyAry.push(key);}// 清除上次渲染的表格$("#demo").empty();// 设置表格头$(`<thead><tr><th colspan=${keyAry.length}>${keyAry[0]}</th></tr></thead>`).appendTo($("#demo"));for(var d of data){// 通过循环,每有一条数据添加一行表格var tr = $("<tr></tr>");for(var n = 0;n< keyAry.length;n++){// 根据keyAry数组的长度,创建每一行表格中的td$("<td></td>").html("<input>").addClass(keyAry[n]).appendTo(tr);}// 遍历对象,根据键名找到是哪一列的数据,给对应的td添加内容for(k in d){// (tr[0].children[keyAry.indexOf(k)])$(tr[0].children[keyAry.indexOf(k)]).html(d[k]);}tr.appendTo($("#demo"));}}if(rABS) {reader.readAsArrayBuffer(f);} else {reader.readAsBinaryString(f);}}function fixdata(data) { //文件流转BinaryStringsvar o = "",l = 0,w = 10240;jsArry=[];for(; l < data.byteLength / w; ++l) jsArry.push(String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w))));return jsArry;}</script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html lang="en"><head>  <meta charset="UTF-8">  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <title>Document</title></head><body>  <!-- 边距重叠 -->  <!-- <style>    div {      width: 100px;      height: 100px;      border: 1px solid #e8e8e8;    }  </style>  <div style="margin-bottom: 10px"></div>  <div style="margin-top: 20px"></div> -->  <!-- 利用BFC 解决边距重叠问题 -->  <style>  .father {    width: 100px;    /* overflow: hidden; 父元素未设置高度时，子元素浮动，父元素高度塌陷 */  }  .children1 {    width: 100px;    height: 100px;    margin-bottom: 10px;    background-color: coral;  }  .children2 {    width: 100px;    height: 100px;    margin-top: 10px;    background-color: coral;  }  /* 给子元素包裹div并设置为BFC 区域，解决边距重叠 */  .box {    overflow: hidden;  }      </style>  <div class="father">    <div class="children1"></div>    <div class="box">      <div class="children2"></div>    </div>  </div></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>**W3C:**万维网联盟–制定结构标准和样式标准。<br>**ECMA:**欧洲计算机制造协会，制定了行为标准。<br>web标准：结构、样式、行为。<br>结构：xhtml 、xml<br>表现：css<br>行为：DOM ECMAscript  网页要实现的交互功能。如：登录，留言，轮播图，加入购物车、支付。<br>内容：网页要传递的信息,图片、视频、音频、文字。<br>HTML:超文本标记语言。<br>XHTML:扩展文本标记语言。<br>WHATWG网页超文本应用技术工作小组：<br>Opera、Mazilla、Safari （浏览器厂商）<br>###考虑客户需求###<br>网页建设流程：域名注册—租用空间—网站建设—推广（SEM）—维护（优化SEO）。<br>域名注册：GoDaddy，万网，新网。<br>GitHub上构建个人网站。<br>扩展知识：1 域名空间<br>2 网站源程序<br>HTML特点：<br>跨平台、结构化、简单易维护。<br>html语法：<br>单标签语法：&lt;标签名 属性=“属性值”/&gt;<br>双标签语法：&lt;标签名 属性=“属性值”&gt;&lt;/标签名&gt;<br>html将“网页内容结构”与“网页排版布局”分开原则：<br>1 用标签元素描述网页的内容结构<br>2 用css描述网页的排版布局<br>3 用JavaScript描述网页的事件处理，即鼠标或键盘在网页元素上的动作后的程序。<br>常见的转义字符：<br>  空格<br>&gt; &lt; 小于号<br>&lt; &gt;  大于号<br>©  版权<br>国际编码格式：utf-8<br>简体中文编码格式：gbk2312<br>国标：gbk<br>列表项：<br>无序列表:ul/li<br>有序列表:ol/li<br>自定义列表:</p><dl>      <dt>名称--图片</dt>      <dd>解释的内容</dd></dl>图片的语法：<img src="路径" alt=“图片替换文本” border=“ ” title=“标题”  width="200 " height=“ ”/>注释：title的属性值是当鼠标移到图片上的时候出现的内容。服务器上传方式：ftp；URL：统一资源定位符,是web页面的地址。链接到百度<a href="http://www.baidu.com" target="_blank" >链接到百度链接到邮箱</a>链接到邮箱<a href="mailto:15029218541@163.com"></a>下载安装包<a href="aa,zip">下载安装包</a><a href="#">链接到顶部</a>src与href的区别?<p>表格标记<br>作用：显示数据<br>align=&quot;表格水平对齐方式&quot;left、center、right<br>colspan：合并列<br>rowspan：合并行<br>cellspacing:单元格与单元格之间的间距<br>cellpadding:单元格与内容之间的间距</p><p>表单<br>作用：用来收集用户信息的<br>表单标记：</p><ol><li>表单框</li></ol><form name="表单名称" method=“post/get”  action="url"></form>url:指定表单向何处发送数据method：指定表单以何种方式发送到指定页面post:隐式请求get:显示请求（form表单里面所填的值，附加在action指定的url后面，作为url链接进行传递。）post：form表单里面的值，附加在HTML Headers上。get与post的区别：①数据的查询：比如浏览论坛时，URL一般包含了分类、页码数、每页记录数等信息。 get 方式，能一目了然的看到所要查询的信息(条件)。 post 因为隐藏掉了这些信息，不方便进行检验查询条。②敏感数据的提交(安全性)：对一项记录，进行更改、添加操作时，比如注册用户、更改用户资料等。get 方式附加在URL上，会泄露掉敏感的消息。 post方式，能隐藏掉敏感的信息③大数据文本传递：get 虽然方便查询，但由于是附加在URL上，各浏览器对URL也有个长度限制。IE ：2048字符。Chrome、FF 好像是 8182字符。post 好像没此限制action:提交的地址Index：网站主页面<p>2 表单控件<br>&lt;input type=“” name=“” value=“” size=“” / &gt;<br>input:标记可以创建按钮、文本输出框、选择框等各类型的输入字段。<br>name：属性表示表单域的名称。<br>type：属性标识表单域的类型。<br>value:属性定义表单域。<br>size：属性定义表单域的尺寸。<br>文本框：type=“text”<br>密码框：type=“password”<br>提交：type=“submit”<br>重置：type=“reset”<br>空按钮：type=“button”<br>单选按钮：radio<br>复选框:checkBox<br>label：绑定控件的作用。<br>单选按钮组：<br><input type="radio" name="ral"/>男<br><input type="radio" name="ral"/>女<br><strong>通过name属性来区分组和单个按钮</strong>。<br>*disabled=“disabled”（设置为禁用）</p><p>多行文本语法：</p><textarea name=" " cols=" 字符宽度" rows=" 行数" ></textarea><p>rows:属性设置文本输入窗口的高度<br>cols:属性用来设置文本输入窗口的宽度，单位是字符<br>扩展：阻止浏览器对窗口的拖动设置：textara{resize:none;}</p><p>电商类网站常见的一些问题处理:<br>1.img{display:block;border:0;}，用于对banner进行修正<br>插入图片后引起3px 的行高。或<div><img src="images/img1.png"/></div><br>2. 外围盒子{overflow：hidden;clear：both;}用于对盒子中第一个子元素设置margin-top时进行修正（BFC效应）<br>3. div{float：left;margin-left：xx;}浏览器会进行双倍间距解析 修正方法：display：inline-block;<br>4. 在ie6中设置div高度为3像素的方法：height：3px;font-size:0;overflow:hidden;<br>5. 如果相统一各浏览器中表单控件的行高，应给表单控件添加声明：float：left;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>一些比较好的自学网站:<br>麦子学院、翼虎网、朱峰社区、咪咕学院、51CTO、i春秋学院、网易云课堂、慕课网、极客学院、开课吧、传课网、腾讯课堂、起点学院、多贝网 。</p><p>搭建个人博客的流程：<br>1 买域名：godaddy、<a href="http://name.com">name.com</a>、万网、新网。<br>2 买空间：老薛主机（代理主机），不用备案。<br>3 域名解析：域名和空间的绑定。</p><p>从数据的加载方向：<br>id：先找到结构，再找到内容，再进行渲染！<br>class：先渲染，在找到具体结构，再找到具体内容。</p><p>选择器权重问题：<br>id选择器：0100（群组选择符权重为它本身）<br>标签选择器：0001（包含选择符的权重）<br>class选择器：0010（选择符的权重之和）<br>属性选择器：内联样式的权重为1000<br>伪类选择器：继承样式的权重为0000<br>伪对象选择器：0010<br>注：相同权重的选择符“优先选择后定义的”！<br>选择器的优先级：<br>！important&gt;行内css&gt;id选择器&gt;类选择器&gt;元素选择器<br>JPG、png、gif区分<br>1、JPG可以很好处理大面积色调的图像，如相片、网页一般的图片。<br>2、PNG格式图片体积小，而且无损压缩，能保证网页的打开速度。最重要的是PNG格式图片支持透明信息。PNG格式图片可以称为“网页设计专用格式”。<br>3、GIF格式图片图像效果很差，但是可以制作动画。<br>Dom是js操作网页的接口<br>##Dom将网页转为一个js对象##<br>类型nodeNamenodeType<br>ELEMENT_NODE大写的HTML元素名1<br>ATTRIBUTE_NODE<a href="http://xn--Attr-ut5fz40a8u5e.name">等同于Attr.name</a>2<br>TEXT_NODE#text3<br>COMMENT_NODE#comment8<br>DOCUMENT_NODE#document9<br>DOCUMENT_FRAGMENT_NODE#document-fragment11<br>DOCUMENT_TYPE_NODE<a href="http://xn--DocumentType-5b6s982d802l.name">等同于DocumentType.name</a>10<br>Node.nodeValue属性返回一个字符串，表示当前节点本身的文本值，该属性可读写<br>Node.textContent属性返回当前节点和它的所有后代节点的文本内容<br>Node.baseURI属性返回一个字符串，表示当前网页的绝对路径<br>节点相关的属性：<br>Node.ownerDocument属性返回当前节点所在的顶层文档对象，即document对象<br>Node.nextSibling属性返回紧跟在当前节点后面的第一个同级节点<br>PreviousSibling属性返回当前节点前面的、距离最近的一个同级节点<br>ParentNode属性返回当前节点的父节点<br>ParentElement属性返回当前节点的父Element节点<br>ChildNodes属性返回一个NodeList集合(所有子节点集合)<br>Node.firstChild<br>Node.lastChild<br>方法：<br>Node.appendChild<br>Node.hasChildNodes方法返回一个布尔值，表示当前节点是否有子节点<br>Node.cloneNode方法用于克隆一个节点。它接受一个布尔值作为参数，表示是否同时克隆子节点，默认是false，即不克隆子节点。<br>var cloneUL=document.querySelector(“ul”).cloneNode(true);<br>Node.insertBefore方法用于将某个节点插入当前节点的指定位置。它接受两个参数，第一个参数是所要插入的节点，第二个参数是当前节点的一个子节点，新的节点将插在这个节点的前面。<br>var text1 = document.createTextNode(‘1’);<br>var li = document.createElement(‘li’);<br>li.appendChild(text1);<br>var ul = document.querySelector(‘ul’);<br>ul.insertBefore(li, ul.firstChild);<br>Node.removeChild方法接受一个子节点作为参数，用于从当前节点移除该子节点<br>Node.replaceChild方法用于将一个新的节点，替换当前节点的某一个子节点。它接受两个参数，第一个参数是用来替换的新节点，第二个参数将要被替换走的子节点。它返回被替换走的那个节点<br>replacedNode = parentNode.replaceChild(newChild, oldChild);<br>Node.contains方法接受一个节点作为参数，返回一个布尔值，表示参数节点是否为当前节点的后代节点。<br>isEqualNode方法返回一个布尔值，用于检查两个节点是否相等。所谓相等的节点，指的是两个节点的类型相同、属性相同、子节点相同。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!doctype html><html lang="en"><head> <meta charset="UTF-8"> <title>Document</title> <style>  .container {   color: red;  } </style></head><body><div class="container" > Hello World!</div><canvas id="canvas" style="border:2px solid black;" width="200" height="200"></canvas><script> var canvas = document.getElementById('canvas'); var ctx = canvas.getContext('2d'); var data = '<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200">' +  '<foreignObject width="100%" height="100%">' +  '<div xmlns="http://www.w3.org/1999/xhtml" style="font-size:40px">' +  document.querySelector('.container').innerHTML +  '</div>' +  '</foreignObject>' +  '</svg>'; var DOMURL = window.URL || window.webkitURL || window; var img = new Image(); var svg = new Blob([data], {type: 'image/svg+xml'}); var url = DOMURL.createObjectURL(svg); img.onload = function() {  ctx.drawImage(img, 0, 0);  DOMURL.revokeObjectURL(url); } img.src = url;</script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html>  <head>    <meta charset="utf-8">    <title>案件管理系统</title>  </head>  <body>  <script>// js 解析 xmlvar xmldoc=document.implementation.createDocument('','',null); // 创建文档 xmldoc.async=false; //是否异步,true同步,false异步xmldoc.load('1.xml');  // xml文件  </script><script>// js 解析 xml 字符串var str = '<jobConfiguration xmlns="http://project.xajiusuo.com/JOBCONFIG/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://project.xajiusuo.com/JOBCONFIG/1.0.0 jobConfiguration-desc.xsd"><id value="HbaseUploadDfhm"></id><type>MANUAL</type><passageway>TEMPORARYANALYSIS</passageway><version>1.0</version><desc>将电维数据导入到对方号码索引表</desc><desc>多数据源路径，多个路径逗号拼接</desc><value></value></dataSource><dataSource type="assign" id="tablename"><desc>表名</desc><value>table1</value></dataSource><dataSource type="assign" id="splitnum"><desc>分区</desc><value>30</value></dataSource></dataSources><dataOutputs></dataOutputs></jobConfiguration>';var xmlStrDoc = null;if(window.DOMParser){var xmlStrDoc=new DOMParser();//创建文档对象console.log("创建文档对象",xmlStrDoc);var xmldoc=xmlStrDoc.parseFromString(str,'text/xml');console.log("xmldoc 字符串：",xmldoc);}else{  xmlStrDoc=new ActiveXObject("Microsoft.XMLDOM");  xmlStrDoc.async="false";  var xmldoc = xmlStrDoc.load(str);  console.log("xmldoc 字符串：",xmldoc);}</script>  </body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>web 性能优化</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head>    <title>canvas绘制五角星</title>    <style type="text/css">        .wrap{width: 500px;margin:0 auto;}        #starCanvas{border: 1px solid #ccc;width: 500px;height:500px;box-sizing:border-box;}        </style></head><body><div class="wrap">        <canvas id='starCanvas' width='500px' height="500px"></canvas></div><script type="text/javascript">    drawStar(250,250,100);    function drawStar(cx,cy,r){        var dotArray=starDotArray(cx,cy,r);        console.log(dotArray);        var canvas=document.getElementById('starCanvas');        var cx=canvas.getContext('2d');        cx.strokeStyle='red';        cx.lineJoin='round';        for(var i=0;i<dotArray.length;i++){            if(i==0){                cx.moveTo(dotArray[i].x,dotArray[i].y);            }else{                cx.lineTo(dotArray[i].x,dotArray[i].y);            }                    }        cx.closePath();        cx.stroke();        //cx.fillStyle='yellow'        //cx.fill();    }    function starDotArray(cx,cy,r){        //圆心坐标 以及圆半径        var dotArray=[];        var unitDeg=Math.PI * 4 / 5;        var rotateDeg=unitDeg/8;        for(var i=0;i<5;i++){            var tempDit=unitDeg*i-rotateDeg;            var y = Math.sin(tempDit) * r + cy;            var x = Math.cos(tempDit) * r + cx;            dotArray.push({x:x,y:y});        }        return dotArray;    }</script><div class="container">    <div class="div">我是一个div</div>    <div class="div">我是一个很多字div</div>    <div class="div">我是一个更多字而且第三个div</div>  </div>  <style>  .container{    display: flex;  }  .div{    border: 1px solid red;    /* flex: 1; */    flex: 1 1 0;  }  </style></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE HTML><html>   <head>      <meta charset="UTF-8">        <script type="text/javascript">        // 库名、版本、描述、大小   返回对象链接         var db = openDatabase('mydb', '1.0', 'Test DB', 2 * 1024 * 1024);         var msg;                 // 事务对象:执行提交、回滚操作           db.transaction(function (tx) {            tx.executeSql('CREATE TABLE IF NOT EXISTS LOGS (id unique, log)');            tx.executeSql('INSERT INTO LOGS (id, log) VALUES (1, "W3Cschool教程")');            tx.executeSql('INSERT INTO LOGS (id, log) VALUES (2, "www.w3cschool.cn")');            msg = '<p>数据表已创建，且插入了两条数据。</p>';            document.querySelector('#status').innerHTML =  msg;         });         db.transaction(function (tx) {              tx.executeSql('DELETE FROM LOGS  WHERE id=1');              msg = '<p>删除 id 为 1 的记录。</p>';              document.querySelector('#status').innerHTML =  msg;         });         db.transaction(function (tx) {             tx.executeSql('UPDATE LOGS SET log=\'www.w3cschool.cn\' WHERE id=2');              msg = '<p>更新 id 为 2 的记录。</p>';              document.querySelector('#status').innerHTML =  msg;         });         db.transaction(function (tx) {            tx.executeSql('SELECT * FROM LOGS', [], function (tx, results) {               var len = results.rows.length, i;               msg = "<p>查询记录条数: " + len + "</p>";               document.querySelector('#status').innerHTML +=  msg;                              for (i = 0; i < len; i++){                  msg = "<p><b>" + results.rows.item(i).log + "</b></p>";                  document.querySelector('#status').innerHTML +=  msg;               }            }, null);         });               </script>         </head>      <body>      <h2>WEB SQL 、localStorage ：存储机制</h2>      <p style="text-indent: 2em;">在本地创建sqllite数据库</p>      <div id="status" name="status">状态信息</div>   </body>   </html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<html> <head>  <title>QR-Code Clock</title>  <link rel="stylesheet" href="code128.css" type="text/css" media="screen" charset="utf-8">  <script src="code128.js" type="text/javascript" charset="utf-8"></script>  <!--  <script type="text/javascript">(function(divId) { var divElement ,oldOnLoad = window.onload ; function getTimeString() {  var pad = function(n) { return n < 10 ? '0' + n.toString(10) : n.toString(10); },dt = new Date();  return [pad(dt.getHours()), pad(dt.getMinutes()), pad(dt.getSeconds())].join(':'); } function UpdateClock() {  var timeText = getTimeString();  divElement.innerHTML = code128(timeText); } window.onload = function() {  divElement = document.getElementById(divId);  UpdateClock();  setInterval(UpdateClock, 1000);  if (typeof oldOnLoad == 'function') oldOnLoad.apply(this, arguments); }})('div1');  </script>  --> </head> <body>  <input type="button" value ="生成" onclick="createBarcode('div128','1234567812345','A');"/>   <div class="barcode2" id="div128"></div>   <!--<div class="barcode2" id="div1"></div>--> </body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[.barcode { float:left; clear:both; padding: 0 10px; /*quiet zone*/ overflow:auto; height:0.5in; /*size*/}.right { float:right; }.barcode + * { clear:both; }.barcode div { float:left; height: 0.35in; /*size*/}.barcode .bar1 { border-left:1px solid black; }.barcode .bar2 { border-left:2px solid black; }.barcode .bar3 { border-left:3px solid black; }.barcode .bar4 { border-left:4px solid black; }.barcode .space0 { margin-right:0 }.barcode .space1 { margin-right:1px }.barcode .space2 { margin-right:2px }.barcode .space3 { margin-right:3px }.barcode .space4 { margin-right:4px }.barcode label { clear:both; display:block; text-align:center; font: 0.125in/100% helvetica; /*size*/}/*** bigger ******************************************/.barcode2 { float:left; clear:both; padding: 0 10px; /*quiet zone*/ overflow:auto; height:1in; /*size*/}.barcode2 + * { clear:both; }.barcode2 div { float:left; height: 0.7in; /*size*/}.barcode2 .bar1 { border-left:2px solid black; }.barcode2 .bar2 { border-left:4px solid black; }.barcode2 .bar3 { border-left:6px solid black; }.barcode2 .bar4 { border-left:8px solid black; }.barcode2 .space0 { margin-right:0 }.barcode2 .space1 { margin-right:2px }.barcode2 .space2 { margin-right:4px }.barcode2 .space3 { margin-right:6px }.barcode2 .space4 { margin-right:8px }.barcode2 label { clear:both; display:block; text-align:center; font: 0.250in/100% helvetica; /*size*/}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[(function() { if (!exports) var exports = window; var BARS    = [212222,222122,222221,121223,121322,131222,122213,122312,132212,221213,221312,231212,112232,122132,122231,113222,123122,123221,223211,221132,221231,213212,223112,312131,311222,321122,321221,312212,322112,322211,212123,212321,232121,111323,131123,131321,112313,132113,132311,211313,231113,231311,112133,112331,132131,113123,113321,133121,313121,211331,231131,213113,213311,213131,311123,311321,331121,312113,312311,332111,314111,221411,431111,111224,111422,121124,121421,141122,141221,112214,112412,122114,122411,142112,142211,241211,221114,413111,241112,134111,111242,121142,121241,114212,124112,124211,411212,421112,421211,212141,214121,412121,111143,111341,131141,114113,114311,411113,411311,113141,114131,311141,411131,211412,211214,211232,23311120]  , START_BASE = 38  , STOP    = 106 ; function code128(code, barcodeType) {  if (arguments.length<2)     barcodeType = code128Detect(code);  if (barcodeType=='C' && code.length%2==1)    code = '0'+code;  var a = parseBarcode(code, barcodeType);  return bar2html(a.join('')) + '<label>' + code + '</label>'; } function bar2html(s) {  for(var pos=0, sb=[]; pos<s.length; pos+=2) {   sb.push('<div class="bar' + s.charAt(pos) + ' space' + s.charAt(pos+1) + '"></div>');  }  return sb.join(''); } function code128Detect(code) {  if (/^[0-9]+$/.test(code)) return 'C';  if (/[a-z]/.test(code)) return 'B';  return 'A'; } function parseBarcode(barcode, barcodeType) {  var bars = [];  bars.add = function(nr) {   var nrCode = BARS[nr];   this.check = this.length==0 ? nr : this.check + nr*this.length;   this.push( nrCode || ("UNDEFINED: "+nr+"->"+nrCode) );  };  bars.add(START_BASE + barcodeType.charCodeAt(0));  for(var i=0; i<barcode.length; i++) {   var code = barcodeType=='C' ? +barcode.substr(i++, 2) : barcode.charCodeAt(i);   converted = fromType[barcodeType](code);   if (isNaN(converted) || converted<0 || converted>106) throw new Error("Unrecognized character ("+code+") at position "+i+" in code '"+barcode+"'.");   bars.add( converted );  }  bars.push(BARS[bars.check % 103], BARS[STOP]);  return bars; } var fromType = {  A: function(charCode) {   if (charCode>=0 && charCode<32) return charCode+64;   if (charCode>=32 && charCode<96) return charCode-32;   return charCode;  },  B: function(charCode) {   if (charCode>=32 && charCode<128) return charCode-32;   return charCode;  },  C: function(charCode) {   return charCode;  } }; //--| Export exports.code128 = code128;})();/*  showDiv：代表需要显示的divID，  textVlaue ： 代表需要生成的值，  barcodeType：代表生成类型(A、B、C)三种类型*/function createBarcode(showDiv,textValue,barcodeType){  var divElement = document.getElementById(showDiv);    divElement.innerHTML = code128(textValue,barcodeType);}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[.barcode { float:left; clear:both; padding: 0 10px; /*quiet zone*/ overflow:auto; height:0.5in; /*size*/}.right { float:right; }.barcode + * { clear:both; }.barcode div { float:left; height: 0.35in; /*size*/}.barcode .bar1 { border-left:1px solid black; }.barcode .bar2 { border-left:2px solid black; }.barcode .bar3 { border-left:3px solid black; }.barcode .bar4 { border-left:4px solid black; }.barcode .space0 { margin-right:0 }.barcode .space1 { margin-right:1px }.barcode .space2 { margin-right:2px }.barcode .space3 { margin-right:3px }.barcode .space4 { margin-right:4px }.barcode label { clear:both; display:block; text-align:center; font: 0.125in/100% helvetica; /*size*/}/*** bigger ******************************************/.barcode2 { float:left; clear:both; padding: 0 10px; /*quiet zone*/ overflow:auto; height:1in; /*size*/}.barcode2 + * { clear:both; }.barcode2 div { float:left; height: 0.7in; /*size*/}.barcode2 .bar1 { border-left:2px solid black; }.barcode2 .bar2 { border-left:4px solid black; }.barcode2 .bar3 { border-left:6px solid black; }.barcode2 .bar4 { border-left:8px solid black; }.barcode2 .space0 { margin-right:0 }.barcode2 .space1 { margin-right:2px }.barcode2 .space2 { margin-right:4px }.barcode2 .space3 { margin-right:6px }.barcode2 .space4 { margin-right:8px }.barcode2 label { clear:both; display:block; text-align:center; font: 0.250in/100% helvetica; /*size*/}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<html> <head>  <title>QR-Code Clock</title>  <link rel="stylesheet" href="code128.css" type="text/css" media="screen" charset="utf-8">  <script src="code128.js" type="text/javascript" charset="utf-8"></script>  <!--  <script type="text/javascript">(function(divId) { var divElement ,oldOnLoad = window.onload ; function getTimeString() {  var pad = function(n) { return n < 10 ? '0' + n.toString(10) : n.toString(10); },dt = new Date();  return [pad(dt.getHours()), pad(dt.getMinutes()), pad(dt.getSeconds())].join(':'); } function UpdateClock() {  var timeText = getTimeString();  divElement.innerHTML = code128(timeText); } window.onload = function() {  divElement = document.getElementById(divId);  UpdateClock();  setInterval(UpdateClock, 1000);  if (typeof oldOnLoad == 'function') oldOnLoad.apply(this, arguments); }})('div1');  </script>  --> </head> <body>  <input type="button" value ="生成小条码" onclick="createBarcode('div128-s','4521896121335');"/>  <input type="button" value ="生成大条码" onclick="createBarcode('div128','4521896121335');"/>   <div class="barcode" id="div128-s"></div>   <div class="barcode2" id="div128"></div>   <!--<div class="barcode2" id="div1"></div>--> </body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html lang="en"><head>            <style>        .div1{width:600px;height:300px;background-color:#000;color:#fff;}        .div2{width:500px;height:300px;background-color:#111111;color:#fff;}        .div3{width:400px;height:300px;background-color:#222222;color:#fff;}        .div4{width:300px;height:300px;background-color:#333333;color:#fff;}        .div5{width:200px;height:300px;background-color:#666666;color:#fff;}    </style></head><body>    <h2>JS 导出 DOM(条形码) 为图片</h2>    <section style="text-indent:2em;">        <p>方法一：通过 html2Canvas 将DOM 转 base64</p>        <p>方法二：纯js 转 DOM 为svg ，再转为 base64</p>        <p>思考问题：<span style="color:red;">前端能否解码base64？？？</span></p>            </section>    <!--        条形码 && 二维码 参考链接：        https://blog.csdn.net/arrowzz/article/details/80656510    -->    <!-- 待转化为图片的DOM -->    <div id="div">        <div class="div1">            <div class="div2">                <div class="div3">                    <div class="div4">                        <div class="div5">                            这是图片5                        </div>                        这是图片4                    </div>                    这是图片3                </div>                这是图片2            </div>            这是图片1        </div>    </div>    <h2>Output Image:</h2>    <input type="button" value="生成图片" onClick="printMap()">    <input type="button" value="下载图片" onClick="saveMap()">    <div id="ssssssssssss" style="position: fixed;right:0px;top:0px;width:600px;background-color:#333333;"></div>    <script>        var imgObj;        //1.将div转成svg              function printMap() {                          var divContent = document.getElementById("div").innerHTML;                     var newData = "";                     for (var i = 0; i < divContent.length; i++) {                            if (divContent.substr(i, 1) == "#") {                                   newData += '%23';                            } else {                                   newData += divContent.substr(i, 1);                            }                     }                     var data = "data:image/svg+xml," +                "<svg id='abcdddd' xmlns='http://www.w3.org/2000/svg' width='600' height='300'>" +                "<foreignObject width='100%' height='100%'>" +                "<div xmlns='http://www.w3.org/1999/xhtml' style='font-size:16px;font-family:Helvetica'>" +                newData + "</div>" + "</foreignObject>" + "</svg>";            var img = new Image();                     img.src = data;// document.getElementsByTagName('body')[0].appendChild(img);                        document.getElementById("ssssssssssss").appendChild(img);            console.log("img dom",img);                     imgObj = img;              }                            function saveMap() {                     var img = imgObj; //document.getElementById("ssssssssssss").getElementsByTagName("img");            //2.svg转成canvas            var canvas = document.createElement('canvas'); //准备空画布            canvas.width = img.width;                     canvas.height = img.height;            var context = canvas.getContext('2d'); //取得画布的2d绘图上下文            context.drawImage(img, 0, 0);            var type = 'png';                     var imgData = canvas.toDataURL(type);            // 加工image data，替换mime type            imgData = imgData.replace(_fixType(type), 'image/octet-stream'); // 下载后的图片名                                 var filename = 'baidufe_' + (new Date()).getTime() + '.' + type;// download                                 saveFile(imgData, filename);              }                      var _fixType = function (type) {                     type = type.toLowerCase().replace(/jpg/i, 'jpeg');                     var r = type.match(/png|jpeg|bmp|gif/)[0];                     return 'image/' + r;              };                      var saveFile = function (data, filename) {                     var save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');                     save_link.href = data;                     save_link.download = filename;                     var event = document.createEvent('MouseEvents');                     event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);                     save_link.dispatchEvent(event);              };    </script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[(function() { if (!exports) var exports = window; var BARS    = [212222,222122,222221,121223,121322,131222,122213,122312,132212,221213,221312,231212,112232,122132,122231,113222,123122,123221,223211,221132,221231,213212,223112,312131,311222,321122,321221,312212,322112,322211,212123,212321,232121,111323,131123,131321,112313,132113,132311,211313,231113,231311,112133,112331,132131,113123,113321,133121,313121,211331,231131,213113,213311,213131,311123,311321,331121,312113,312311,332111,314111,221411,431111,111224,111422,121124,121421,141122,141221,112214,112412,122114,122411,142112,142211,241211,221114,413111,241112,134111,111242,121142,121241,114212,124112,124211,411212,421112,421211,212141,214121,412121,111143,111341,131141,114113,114311,411113,411311,113141,114131,311141,411131,211412,211214,211232,23311120]  , START_BASE = 38  , STOP    = 106 ; function code128(code, barcodeType) {if(!barcodeType)barcodeType = code128Detect(code);if (barcodeType=='C' && code.length%2==1)code = '0'+code;var a = parseBarcode(code, barcodeType);return bar2html(a.join('')) + '<label>' + code + '</label>'; } function bar2html(s) {  for(var pos=0, sb=[]; pos<s.length; pos+=2) {   sb.push('<div class="bar' + s.charAt(pos) + ' space' + s.charAt(pos+1) + '"></div>');  }  return sb.join(''); } function code128Detect(code) {  if (/^[0-9]+$/.test(code)) return 'C';  if (/[a-z]/.test(code)) return 'B';  return 'A'; } function parseBarcode(barcode, barcodeType) {  var bars = [];  bars.add = function(nr) {   var nrCode = BARS[nr];   this.check = this.length==0 ? nr : this.check + nr*this.length;   this.push( nrCode || ("UNDEFINED: "+nr+"->"+nrCode) );  };  bars.add(START_BASE + barcodeType.charCodeAt(0));  for(var i=0; i<barcode.length; i++) {   var code = barcodeType=='C' ? +barcode.substr(i++, 2) : barcode.charCodeAt(i);   converted = fromType[barcodeType](code);   if (isNaN(converted) || converted<0 || converted>106) throw new Error("Unrecognized character ("+code+") at position "+i+" in code '"+barcode+"'.");   bars.add( converted );  }  bars.push(BARS[bars.check % 103], BARS[STOP]);  return bars; } var fromType = {  A: function(charCode) {   if (charCode>=0 && charCode<32) return charCode+64;   if (charCode>=32 && charCode<96) return charCode-32;   return charCode;  },  B: function(charCode) {   if (charCode>=32 && charCode<128) return charCode-32;   return charCode;  },  C: function(charCode) {   return charCode;  } }; //--| Export exports.code128 = code128;})();/*  showDiv：代表需要显示的divID，  textVlaue ： 代表需要生成的值，  barcodeType：代表生成类型(A、B、C)三种类型*/function createBarcode(showDiv,textValue,barcodeType){  var divElement = document.getElementById(showDiv);    divElement.innerHTML = code128(textValue,barcodeType);}]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head>    <meta charset="utf-8" />    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <title>FileReader API</title>    <meta name="viewport" content="width=device-width, initial-scale=1">    <script src="./main.js"></script></head><body>    <div>        <img id="portrait" src="" width="70" height="75">     </div>    <div>        <form>            <fieldset>                <legend>分度读取文件：</legend>                <input type="file" id="File" onchange="showPreview(this)"/>                <input type="button" value="中断" id="Abort" />                <p>                    <label>读取进度：</label><progress id="Progress" value="0" max="100"></progress>                </p>                <p id="Status"></p>            </fieldset>        </form>                    </div>        <script>        h.init();     </script></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[var h = {    init: function() {        var me = this;                document.getElementById('File').onchange = me.fileHandler;        document.getElementById('Abort').onclick = me.abortHandler;                me.status = document.getElementById('Status');        me.progress = document.getElementById('Progress');        me.percent = document.getElementById('Percent');                me.loaded = 0;        //每次读取1M        me.step = 1024;        me.times = 0;    },    fileHandler: function(e) {        var me = h;                var file = me.file = this.files[0];                var reader = me.reader = new FileReader();                me.total = file.size;                reader.onloadstart = me.onLoadStart;        reader.onprogress = me.onProgress;        reader.onabort = me.onAbort;        reader.onerror = me.onerror;        reader.onload = me.onLoad;        reader.onloadend = me.onLoadEnd;        //读取第一块        me.readBlob(file, 0);    },    onLoadStart: function() {        var me = h;    },    onProgress: function(e) {        var me = h;                me.loaded += e.loaded;        //更新进度条        me.progress.value = (me.loaded / me.total) * 100;    },    onAbort: function() {        var me = h;    },    onError: function() {        var me = h;            },    onLoad: function() {        var me = h;        if(me.loaded < me.total) {            me.readBlob(me.loaded);        } else {            me.loaded = me.total;        }    },    onLoadEnd: function() {        var me = h;            },    readBlob: function(start) {        var me = h;                var blob,            file = me.file;                me.times += 1;                // if(file.webkitSlice){                    //     blob = file.webkitSlice(start, start + me.step + 1);        // } else if(file.mozSlice) {        //     blob = file.mozSlice(start, start + me.step + 1);        // }        // me.reader.readAsText(blob);        if(file.slice){            blob = file.slice(start, start + me.step + 1);                    }                                me.reader.readAsDataURL(blob);        // 设置图片        me.reader.onloadend = function(e) {                        document.getElementById("portrait").src = e.target.result;        };                    },    abortHandler: function() {        var me = h;                if(me.reader) {            me.reader.abort();        }    }};]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>沙牛说，自己在上大学之前，并不是一个学习能力很强的人，直到在上大学的时候，一位老前辈告诉我说，在学生的时候，我们要找到属于自己的学习方式，才是学习阶段重要的事情。</p><p>学习是学生的第一要务，也是成人和职场人士当中重要的事情，因为时代在变，我们不得不学习，如果不学习，那么我们即将面临淘汰的危险。</p><p>有本书叫做《如何高效学习》讲的就是一个人如何学习陌生领域的知识并且尽快的入门，同时还教你什么阅读，记笔记，以及整理笔记，真的是通俗易懂的一本书，没有专业的术语，听话照做就可以上手。</p><p><img src="https://img2.doubanio.com/view/thing_review/l/public/p4374082.webp" alt=""></p><p>本书共分为3个部分，第一部分认识系统的学习，第二部分学习的技术，第三部分是学习辅助的能力。</p><p>本书的作者是沙牛，专注研究个人成长体系，已有7年的时间管理，是番茄工作法效率平台Pomonote创始人。目前也是一位自由职业者，曾任互联网公司运营总监。出版的第一本书籍《如何高效学习》。</p><p>那么我们要如何成为一名会学习的人呢？将由以下三点：</p><h2 id="一：什么是高效学习者">一：什么是高效学习者</h2><p>每个人每天都是一个学习者，因为一个人每天要接触大量的东西，很多东西是我们所不知道的，我们不会的，因此当我们有时候刚刚接触新知的时候，很难理解，不懂，但是由于工作的种种原因我们不得不去学习这个东西，以便更好的开展工作。</p><p><img src="https://img2.doubanio.com/view/thing_review/l/public/p4374083.webp" alt=""></p><p>可是很奇怪的是，就算是2个人同时一起去学习，为什么别人就要比我们学的更快，甚至是更好呢？明明我们并不比别人笨，可是事实就是如此。</p><p>当我们出社会以后，我们会发现很多人很多学习，他们身上有多个标签，横跨多个领域，真是让人既羡慕又嫉妒呀。</p><p>这里哪些能够短时间并且横跨多个领域的人，都是高效学习者。</p><p>说到高效学习者，在得到课程当中有一个人就可以称为是高效的学习者，许岑说自己4岁到12岁学了小提琴，27岁弹吉他，而后成为一名雅思英语老师，同时也是幻灯片设计师，33岁时，是授课老师同时也兼网红。我觉得这样的人就可以称高效的学习者。</p><p>所谓的高效学习者就是能够在短时间内入门一个领域或者说精通状态，我觉得都可以称为高效学习者。</p><p>我们的目的是能够在短时间内跨越多个领域，并且能够掌握这个领域的的知识，能够为我们所用。</p><p><img src="https://img9.doubanio.com/view/thing_review/l/public/p4374084.webp" alt=""></p><h2 id="二、为什么要成为高效学习者">二、为什么要成为高效学习者</h2><p>时代在不断的进步，我们作为一个单一技能的人，是很容易被人淘汰的.</p><p>因此我们要学会做未来人，未来人才会有未来的职业，古典老师在得到课程说到未来职业有三种人：媒体人、运营人、产品人。</p><p>因此如果你本身就是媒体的话，那么可以更近一步的做一个运营人，如果你本身就是一个运营人，那么可以试试加一个技能做一个产品人。</p><p>那么有一个种人才叫做”T”型人才。什么是T型人才呢？根据百度的定义：T型人才是指知识结构区分的一种新型人才。</p><p>因此用字母“T”来表示结构，“T”的下面一竖表示对领域的深度，“T”的上面一横表示对领域的广度。两总相结合才会有深度和广度，是未来不可或缺的人才。</p><p><img src="https://img9.doubanio.com/view/thing_review/l/public/p4374085.webp" alt=""></p><p>因此我们要做一个T型人才，想要做一个T型人才，我们首先就要学会一个最重要的能力，就是学习能力，学习能力可以让我们的行业有深度，同时学习能力可以增加我们的广度，能够让我们涉猎多个领域的知识，让我们成为一个T型人才。</p><p>这几年有一个词叫做“斜杠青年”说的一个人可以跨越多个领域并挣到钱，那么就是一个斜杠青年。</p><p>而想要跨越多个领域其中最重要的一点就是要会学习，如果不会学习，那么如何能够在短时间内跨越多个领域呢？</p><p>秋叶大叔就是一个横跨多个领域的T型人才，以前是一个大学教授，然后通过做PPT成为网红，接着做社群，然后一年出了13本书，这可谓是学习力惊人，同时出的书籍都是很有深度的，典型的一个T型人才。</p><p><img src="https://img9.doubanio.com/view/thing_review/l/public/p4374086.webp" alt=""></p><p>采桐老师在得到回到了一个知识体系的问题，说要在自己的领域当中深耕，然后不断的从周围扩展开来。</p><p>这个建议就是给T型人才说的，我们每一个人要有一个深耕的领域，在一个领域久了，我们就要不断的向周围运动，不断的扩大，你只有不断的扩大，才能够成为一个不会被社会淘汰的人，你才会一路的攀升，因此想要成为一个未来职业的未来人，你首先要必备的就是要成为一个会学习的人。</p><p>沙牛说：评估一个人是否会学习，要看他的学习效率</p><h2 id="三：如何成为会学习的人">三：如何成为会学习的人</h2><p>学习是为了什么呢？无非就是让我们的领域涉足的更广阔一些，因此我们就要进入陌生的领域，进入陌生领域其实是一个未知数，同时也会很害怕，这是人常有的恐惧感，因为人们害怕没有掌控感的事情，所以想要快速的进入一个领域我们就要有方向的进入。</p><p>学习这个事情，也是要讲究系统性，的它绝对不是心血来潮的技能——沙牛</p><p>那么我们要如何进入一个陌生的领域呢？</p><p><img src="https://img1.doubanio.com/view/thing_review/l/public/p4374087.webp" alt=""></p><p>沙牛在书中给我们提到了进入一个陌生领域学习的5大步骤：</p><p>1：明确目标</p><p>2：通览这个领域</p><p>3：制定学习计划</p><p>4：开始学习</p><p>5：记录、回顾和反思</p><p>这是进入一个领域的5大步骤，我们将按照这5个步骤一一的解说一下：</p><p>1：明确目标</p><p>所谓的明确目标，是我们要有一个明确学习的方向，你想要学习什么呢？</p><p>你有什么技能要学习吗？你有什么新的领域要探索吗？你有什么新的爱好要培养嘛？</p><p>你在工作当中遇到什么不懂的事情需要跨越吗？等等</p><p>只要你想要学习什么都可以，如果你想要写作，演讲，或者说给自己煮个早餐，煎蛋也可以。</p><p>只要是涉足你不会的领域都是新的领域。</p><p>当你设定要了目标，我们就要通览这个领域。</p><p>2：通览这个领域</p><p>如何通览一个领域呢？</p><p>沙牛说自己会先到百度搜索这个领域相关的文章，前十页的都看一遍，然后记下笔记，还有知乎这样的平台，也要看一遍。</p><p>同时你还可以阅读书籍，可以把目录看一遍或者摘抄一遍，如果经济条件允许的情况下，你还可以去在行一点，预约导师，向专业人士请教。</p><p>为什么要通览呢？</p><p><img src="https://img1.doubanio.com/view/thing_review/l/public/p4374088.webp" alt=""></p><p>假设你你要盖一个房子，而你面前的一块空地，但是你不知道要把房子改成怎样的，你在大城市看到的都是高楼大厦，但是你不知道要改成那种房子比较好，于是你就找了一个设计师，帮你规划，而当设计师规划好了之后，你觉得这个设计很满意，此刻你手拿地图，心想，原来我未来盖好的房子是这样的。</p><p>这就是通览的作用，当你知道了未来的全景图之后，你就会想着什么去搭建地基，什么去动工。</p><p>3：制定学习计划</p><p>当我们通览这个领域之后，我们知道了，这个领域当中有哪些是核心的概念，以及哪些是核心的知识点，哪些是分支，哪些是需要留下的哪些是需要丢弃的。</p><p>当我们知道了结构构建的时候，我们就要知道我们先学什么后学什么，然后一层一层的学习下来，这样就构成了一个知识树的结构一样，我们每隔一段时间，就可以学习一个分支。</p><p>就以这本书为例子，这本书有三个部分共9个章节，如果我们没有大块而固定的时间去阅读，那么我们可以利用碎片化的时间去学习，可以每天看一个章节，这样9天就可以看完一本书了。</p><p><img src="https://img1.doubanio.com/view/thing_review/l/public/p4374089.webp" alt=""></p><p>所以我们制定计划的时候，我们就要知道多这个月学习哪一个分支，然后下一个月学习哪一个分支，然后一个领域有多少个分支，多久能够学习完成。这就是我们制定的学习计划。</p><p>4：开始学习</p><p>那么我们要什么开始呢？</p><p>我们要先知道有哪些是系统的学习方式：</p><p>1.导师，这个领域的专家。</p><p>有很多小孩子学习英文都是聘请家教，说明老师也是非常的专业。</p><p>2.学校或者是技能学校</p><p>有很多的技能学校，就如同是教师进修的那种学校。</p><p>3.线下课程</p><p>线下一般都是比较系统的课程，一般为企业培训以及是一些专业的培训课程</p><p>沙牛说在做运营之前公司给了一个机会，让他去参与一个线下培训课，费用3万块。</p><p>因此以上这几个往往费用都比较高，而且还很费时间，很多人时间都比较紧迫，所以挪不出大块的时间来，那么以下的学习方式可能很适合你。</p><p><img src="https://img2.doubanio.com/view/thing_review/l/public/p4374091.webp" alt=""></p><p>4.网课</p><p>现在知识付费时代，很多的网课，都有不少，而且老师讲的也很系统，还是比较专业的。</p><p>网课的好处在于可以回听，只要有空闲的时间段，不管人在哪里，都可以学习，非常的方便。</p><p>5.阅读</p><p>书籍是最好的系统学习，因为一整本书就是一个结构，而且书籍的知识点不会那么的乱，让你知道哪些知识点是系统的，同时你也可以利用碎片学习，也可以利用大块的时间学习，真的是一举二得，好处多多。</p><p>因此阅读是不二之选，成本也低，系统性选。</p><p>出一本书的时候，已经经过层层筛选，所以观点和案例都是再三推敲的。</p><p>沙牛说学习一项技能，就应该追求有深度的学习</p><p>而阅读学习是最有深度的学习，因为从初级到高级阅读都具备了。</p><p><img src="https://img2.doubanio.com/view/thing_review/l/public/p4374092.webp" alt=""></p><p>5：记录、回顾和反思</p><p>到了第5个步骤，页就是记录、回顾和反思</p><p>什么是记录呢？</p><p>记录就是记录自己的笔记和问题以及想法。</p><p>当我们开始学习的时候，我们上课要做笔记，阅读要做笔记，在学习的过程当中时常有灵感冒出来，所以我们要学会记录下来</p><p>笔记可以选用笔记本或者说电子记录。</p><p>回顾就是复习学习到的知识点。</p><p>人生健忘的，因为我们的大脑会在某一个时间段，忘记重要的事情。</p><p>德国心理学家<a href="https://baike.so.com/doc/5744974-5957728.html">艾宾浩斯</a>(H.Ebbinghaus)研究发现，人类对于新事物的遗忘规律因此提出了</p><p>艾宾浩斯遗忘曲线这个概念，证明了人类对于新事物的遗忘是有时间段的。</p><p><img src="https://img9.doubanio.com/view/thing_review/l/public/p4374094.webp" alt=""></p><p>此图来源于@百度</p><p>请看图，这就是艾宾浩斯遗忘曲线，当我们看到一篇文章以后，阅读完过了20分钟我们会记住58.2％然后一直往下推算，如果我们没有去加深印象，那么我们将很快的就会遗忘这个知识点。因此回顾知识点对我们记住这个知识点将起到很大的作用，只有记住才能运用。</p><p>反思就是思考我们这个知识点可以运用在哪里。</p><p>反思就是思考我们的知识可以运用在哪里，学习就是为了能够更好的运用，实践是最好的真知，不实践，这个知识点就不是你的。</p><p><img src="https://img9.doubanio.com/view/thing_review/l/public/p4374095.webp" alt=""></p><p>沙牛说，在反思的时候可以思考这几个问题，这个知识我以前知道吗？它和我以前的知识和经验有什么关联吗？我以后要如何使用它？使用的场景有哪些？</p><p>因此反思每一个知识点，是为了我们能够运用起来。</p><p>所以反思非常的重要。</p><p>成甲在好好学习里面说到过自己记录反思日记的时候，当他回头看的时候，原来发现很多事情是在重复的发生，原来这个事情以前发生过只是我忘记了。</p><p>所以当我们遇到挑战的时候，我们也许就会某一个知识点，就能够解决了。</p><p><img src="https://img1.doubanio.com/view/thing_review/l/public/p4374097.webp" alt=""></p><p>这就是我们说的进入一个领域的5大步骤，其实很简单，但是很系统，高效学习者就是要系统的学习。而这本《如何高效学习》讲的就是系统化的学习方式，只有学会了学习，我们才能走的更快，走的更远。</p><p>不管你想要做什么，或成为什么样的人，只有掌握了学习的能力，你才能参与竞争，才不会落伍出局——认知天性</p><p>最后引用一段沙牛在书中说的话：学习任何一个工具或方法，先按照老师说的实践一段时间，通过不断的总结思考和修正，然后在形成自己的方法论。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@commitlint</span>/cli</span><br><span class="line">commitlint命令行工具，用于在项目中快速引入 commit message 规范和 commitlint 相关配置规范</span><br><span class="line"></span><br><span class="line"><span class="variable">@commitlint</span>/config-conventional</span><br><span class="line">commitlint规则集(通常通过commitlint.config.js指定)</span><br><span class="line"></span><br><span class="line">commitizen</span><br><span class="line">对应package.json config commitizen, 格式化commmit message的工具(从commit生成Change log)</span><br><span class="line"></span><br><span class="line">cz-conventional-changelog</span><br><span class="line">日志变更标准</span><br><span class="line"></span><br><span class="line"><span class="variable">@vercel</span>/node</span><br><span class="line">Vercel 是一个开箱即用的网站托管平台，方便开发者快速部署自己的网站</span><br><span class="line">参考链接： <span class="attribute">https</span>:<span class="comment">//www.51cto.com/article/708495.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yorkie</span><br><span class="line">husky fork 版(用法与husky类似)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="应用隔离">应用隔离</h3><ul><li>JS 执行环境隔离[沙箱 SandBox]<ul><li>局部的 JavaScript 运行时，对外部对象的访问和修改处在可控的范围内</li></ul></li><li>CSS 样式隔离<ul><li>CSS Module: postcss</li><li>命名空间</li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="webpack历史">webpack历史</h3><p>构建工具的作用<br>主流浏览器 ES6 module 支持情况</p><p><img src="images/es-support.png" alt=""></p><ul><li>转换 ES6 语法</li><li>转换 JSX 、VUE</li><li>CSS 预处理器 / 前缀补全</li><li>压缩混淆</li><li>图片压缩</li></ul><h3 id="webpack-配置文件">webpack 配置文件</h3><p>webpack 默认配置文件 webpack.config.js<br>通过webpack --config 指定配置文件<br><img src="images/webpack.config.js.png" alt=""></p><p>环境搭建</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir my-webpack-project</span><br><span class="line">cd my-webpack-project</span><br><span class="line">npm -y</span><br><span class="line"></span><br><span class="line">npm i webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure><p>运行<br><img src="images/package.png" alt=""></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="webpack基础">webpack基础</h3><p><strong>entry</strong><br>entry 用来指定webpack打包入口</p><p>单入口：entry 是一个字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">moule.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>多入口：entry 是个对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">moule.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">app</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">admin</span>:<span class="string">&#x27;./src/admin.js&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>output</strong></p><p>output 用来告诉 webpack 将编译后的文件输出的地址</p><p>单出口配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>多出口配置<br>通过占位符确保文件名的唯一</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>loader</strong></p><p>webpack 开箱即用只支持 JS 和 JSON 两种文件类型，通过 Loaders 去支持其它文件类型并且把它们转化成有效的模块，并且可以添加到依赖图中。本身是一个函数，接受源文件作为参数，返回转换的结果。</p><p>常见的loader</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">babel-loader</span>转换 ES6、ES7 等 <span class="keyword">JS </span>新语法</span><br><span class="line">style-loader将 css 加到 style 标签内</span><br><span class="line">css-loader支持 .css 文件的加载和解析</span><br><span class="line">less-loader将 less 文件转换成 css</span><br><span class="line">ts-loader将 TS 转换成 <span class="keyword">JS</span></span><br><span class="line"><span class="keyword"></span>file-loader进行图片、字体的打包</span><br><span class="line">raw-loader将文件以字符串的形式导入</span><br><span class="line">thread-loader多进程打包 <span class="keyword">JS </span>和 CSS</span><br></pre></td></tr></table></figure><p>loader 用法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.tsx&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.(js|jsx)$/</span>, <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>, <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.(ts|tsx)$/</span>, <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span>, <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>exclude: /node_modules/  排除 node_modules 的文件</p></blockquote><p><strong>webpack asset module</strong></p><p>资源模块(asset module)是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外 loader。<br>在 webpack 5 之前，通常使用：<br>● raw-loader 将文件导入为字符串<br>● url-loader 将文件作为 data URI 内联到 bundle 中<br>● file-loader 将文件发送到输出目录<br>资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：<br>● asset/resource 发送一个单独的文件并导出 URL。之前通过使用 file-loader 实现。<br>● asset/inline 导出一个资源的 data URI。之前通过使用 url-loader 实现。<br>● asset/source 导出资源的源代码。之前通过使用 raw-loader 实现。<br>● asset 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 url-loader，并且配置资源体积限制实现。<br>当在 webpack 5 中使用旧的 assets loader（如 file-loader/url-loader/raw-loader 等）和 asset 模块时，你可能想停止当前 asset 模块的处理，并再次启动处理，这可能会导致 asset 重复，你可以通过将 asset 模块的类型设置为 ‘javascript/auto’ 来解决。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;asset/resource&#x27;</span></span><br><span class="line">&#125;,</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">   <span class="attr">type</span>:<span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">   <span class="attr">parser</span>: &#123;</span><br><span class="line">        <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">          <span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 100kb</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>plugins</strong></p><p>插件用于 bundle 文件的优化，资源管理和环境变量注入<br>作用于整个构建过程</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">HtmlWebpackPlugin</span>创建 html 标签 去承载输出的bundle</span><br><span class="line"><span class="title class_">CleanWebpackPlugin</span>清理构建目录</span><br><span class="line"><span class="title class_">CommonsChunkPlugin</span>将chunks相同的模块代码提取成公共js将块相同的模块代码提取成公共js</span><br><span class="line"><span class="title class_">ExtractTextWebpackPlugin</span>将css从 bunlde文件里提取成一个独立的css文件</span><br><span class="line">uglifyjsWebpackPlugin压缩<span class="variable constant_">JS</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用::</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">  <span class="attr">entry</span>:<span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>:&#123;</span><br><span class="line">    <span class="attr">filename</span>:<span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>mode</strong></p><p>Mode ⽤来指定当前的构建环境是：production、development 还是 none<br>设置 mode 可以使⽤ webpack 内置的函数，默认值为 production</p><p>mode 的内置函数功能</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">development会将 <span class="title class_">DefinePlugin</span> 中 process.<span class="property">env</span>.<span class="property">NODE_ENV</span> 的值设置为 development. 为模块和 chunk 启用有效的名。</span><br><span class="line">production会将 <span class="title class_">DefinePlugin</span> 中 process.<span class="property">env</span>.<span class="property">NODE_ENV</span> 的值设置为 production。为模块和 chunk 启用确定性的混淆名称，<span class="title class_">FlagDependencyUsagePlugin</span>，<span class="title class_">FlagIncludedChunksPlugin</span>，<span class="title class_">ModuleConcatenationPlugin</span>，<span class="title class_">NoEmitOnErrorsPlugin</span> 和 <span class="title class_">TerserPlugin</span> 。</span><br><span class="line">none不使用任何默认优化选项</span><br></pre></td></tr></table></figure><p>如果没有设置，webpack 会给 mode 的默认值设置为 production</p><p>解析ES6</p><p>使⽤ babel-loader babel的配置⽂件是：.babelrc</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  entry: <span class="string">&#x27;./src/index.tsx&#x27;</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.<span class="keyword">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;[name]__[chunkhash].js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123; test: <span class="regexp">/\.js$/</span>, loader: <span class="string">&#x27;babel-loader&#x27;</span>, <span class="keyword">exclude</span>: <span class="regexp">/node_modules/</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>增加ES6的babel preset配置</p><p>@babel/preset-env是一个智能预设，允许您使用最新的 JavaScript，而无需微观管理目标环境需要哪些语法转换（以及可选的浏览器 polyfill）。这既让你的工作更轻松，也让 JavaScript 包更小！<br>@babel/preset-env 利用一些很棒的开源项目，比如browserslist、compat-table和electron-to-chromium.</p><p>我们利用这些数据源来维护我们支持的目标环境的哪个版本获得了对 JavaScript 语法或浏览器功能的支持的映射，以及这些语法和功能到 Babel 转换插件和 core-js polyfills 的映射</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>解析React JSX</strong><br>新建 .babelrc</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>, <span class="string">&quot;@babel/preset-react&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>此预设（preset）始终包含以下插件：<br>● @babel/plugin-syntax-jsx<br>● @babel/plugin-transform-react-jsx<br>● @babel/plugin-transform-react-display-name<br>如果开启了 development 参数，还将包含以下插件：<br>Classic runtime adds:<br>● @babel/plugin-transform-react-jsx-self<br>● @babel/plugin-transform-react-jsx-source</p></blockquote><p><strong>解析 CSS</strong></p><blockquote><p>css-loader ⽤于加载 .css ⽂件，并且转换成 commonjs 对象 style-loader 将样式通过 <code>&lt;style&gt;</code>标签插入到 head 中, loader 是从后到前执行的。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.tsx&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>, <span class="comment">// 解析字体、图片等</span></span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">limit</span>: <span class="number">10240</span> <span class="comment">// 大小10K</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;                  </span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>处理小资源</strong><br>url-loader 可以处理图片 设置指定文件的最大大小 (以字节为单位) 自动转base64,作为 data url 内嵌<br>目的：小文件使用Data URL，减少请求次数</p><blockquote><p>url-loader 不可和 file-loader同时使用 url-loader具有 file-loader 的功能</p></blockquote><p><strong>asset module</strong><br>资源模块(asset module)是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外 loader。<br>在 webpack 5 之前，通常使用：</p><ul><li>raw-loader 将文件导入为字符串</li><li>url-loader 将文件作为 data URI 内联到 bundle 中</li><li>file-loader 将文件发送到输出目录资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</li><li>asset/resource 发送一个单独的文件并导出 URL。之前通过使用 file-loader 实现。</li><li>asset/inline 导出一个资源的 data URI。之前通过使用 url-loader 实现。</li><li>asset/source 导出资源的源代码。之前通过使用 raw-loader 实现。</li><li>asset 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 url-loader，并且配置资源体积限制实现。</li></ul><p>当在 webpack 5 中使用旧的 assets loader（如 file-loader/url-loader/raw-loader 等）和 asset 模块时，你可能想停止当前 asset 模块的处理，并再次启动处理，这可能会导致 asset 重复，你可以通过将 asset 模块的类型设置为 ‘javascript/auto’ 来解决。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">  type: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">  type: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">  parser: &#123;</span><br><span class="line">    dataUrlCondition: &#123;</span><br><span class="line">      maxSize: <span class="number">10</span> * <span class="number">1024</span>, <span class="regexp">//</span> <span class="number">100</span>kb</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>文件监听</strong><br>⽂件监听是在发现源码发⽣变化时，⾃动重新构建出新的输出⽂件。<br>webpack 开启监听模式，有两种⽅式：<br>● 启动 webpack 命令时，带上 --watch 参数<br>● 在配置 webpack.config.js 中设置 watch: true</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack <span class="comment">--watch</span></span><br></pre></td></tr></table></figure><blockquote><p>缺点：每次需要手动刷新浏览器</p></blockquote><p>原理分析<br>轮询判断⽂件的最后编辑时间是否变化 某个⽂件发⽣了变化，并不会⽴刻告诉监听者，⽽是先缓存起来，等 aggregateTimeout</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module.export = &#123;</span><br><span class="line">  <span class="regexp">//</span>默认 false，也就是不开启 </span><br><span class="line">  watch: true, </span><br><span class="line">  <span class="regexp">//</span>只有开启监听模式时，watchOptions才有意义 </span><br><span class="line">  wathcOptions: &#123; </span><br><span class="line">    <span class="regexp">//</span>默认为空，不监听的文件或者文件夹，支持正则匹配 </span><br><span class="line">    ignored: <span class="regexp">/node_modules/</span>, </span><br><span class="line">    <span class="regexp">//</span>监听到变化发生后会等<span class="number">300</span>ms再去执行，默认<span class="number">300</span>ms aggregateTimeout: <span class="number">300</span>,</span><br><span class="line">    <span class="regexp">//</span>判断文件是否发生变化是通过不停询问系统指定文件有没有变化实现的，默认每秒问<span class="number">1000</span>次 poll: <span class="number">1000</span> </span><br><span class="line">  &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><strong>HMR热更新</strong><br>webpack-dev-server 可用于快速开发应用程序 , wds 不用手动刷新浏览器，不输出文件，而是放在内存中</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-dev-<span class="keyword">server</span></span><br></pre></td></tr></table></figure><p>devServer.hot<br>‘only’ boolean = true<br>启用 webpack 的 热模块替换 特性：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --config webpack.dev.js&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 也可以使用通过 CLI 调用 webpack-dev-server</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack server --config webpack.dev.js&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>从 webpack-dev-server v4 开始，HMR 是默认启用的。它会自动应用 webpack.HotModuleReplacementPlugin，这是启用 HMR 所必需的。因此当 hot 设置为 true 或者通过 CLI 设置 --hot，你不需要在你的 webpack.config.js 添加该插件。查看 HMR concepts page 以获取更多信息。</p></blockquote><p><img src="images/HMR%E5%8E%9F%E7%90%86.png" alt=""></p><p>初次构建 1 -&gt; 2 -&gt; A -&gt; B<br>热更新 1 -&gt; 2 -&gt; 3 -&gt; 4</p><p>HMR Server 是服务端，用来将变化的 js 模块通过 websocket 的消息通知给浏览器端。</p><p>HMR Runtime是浏览器端，用于接受 HMR Server 传递的模块数据，浏览器端可以看到 .hot-update.json 的文件过来。<br>Runtime 可以理解为 js 运行环境</p><p>Webpack 的热更新又称热替换（Hot Module Replacement），缩写为 HMR。 这个机制可以做到不用刷新浏览器而将新变更的模块替换掉旧的模块。</p><p>HMR的核心就是客户端从服务端拉去更新后的文件，准确的说是 chunk diff (chunk 需要更新的部分)，实际上 WDS 与浏览器之间维护了一个 Websocket，当本地资源发生变化时，WDS 会向浏览器推送更新，并带上构建时的 hash，让客户端与上一次资源进行对比。客户端对比出差异后会向 WDS 发起 Ajax 请求来获取更改内容(文件列表、hash)，这样客户端就可以再借助这些信息继续向 WDS 发起 jsonp 请求获取该chunk的增量更新。<br>后续的部分(拿到增量更新之后如何处理？哪些状态该保留？哪些又需要更新？)由 HotModulePlugin 来完成，提供了相关 API 以供开发者针对自身场景进行处理，像react-hot-loader 和 vue-loader 都是借助这些 API 实现 HMR。</p><p><a href="https://zhuanlan.zhihu.com/p/30669007">HMR原理</a></p><p><strong>文件指纹</strong><br><img src="images/html-hash.png" alt=""></p><p>● Hash：和整个项目的构建相关，只要项目文件有修改，整个项目构建的 hash 值就会更改<br>● Chunkhash：和 Webpack 打包的 chunk 有关，不同的 entry 会生出不同的 chunkhash<br>● Contenthash：根据文件内容来定义 hash，文件内容不变，则 contenthash 不变</p><p>js的文件指纹设置<br>设置 output 的 filename，用 chunkhash。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">&#x27;./scr/app.js&#x27;</span>,</span><br><span class="line">    search: <span class="string">&#x27;./src/search.js&#x27;</span></span><br><span class="line">  &#125;,    </span><br><span class="line">  <span class="built_in">output</span>: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name][chunkhash:8].js&#x27;</span>,</span><br><span class="line">    <span class="built_in">path</span>:__dirname + <span class="string">&#x27;/dist&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>css的文件指纹设置<br>设置 MiniCssExtractPlugin 的 filename，使用 contenthash。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">&#x27;./scr/app.js&#x27;</span>,</span><br><span class="line">    <span class="keyword">search</span>: <span class="string">&#x27;./src/search.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name][chunkhash:8].js&#x27;</span>,</span><br><span class="line">    <span class="type">path</span>:__dirname + <span class="string">&#x27;/dist&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins:[</span><br><span class="line">    <span class="built_in">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename: `[<span class="type">name</span>][contenthash:<span class="number">8</span>].css`</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>图片的文件指纹设置<br>设置file-loader的name，使用hash。<br>占位符名称及含义<br>● ext 资源后缀名<br>● name 文件名称<br>● path 文件的相对路径<br>● folder 文件所在的文件夹<br>● contenthash 文件的内容hash，默认是md5生成<br>● hash 文件内容的hash，默认是md5生成<br>● emoji 一个随机的指代文件内容的emoj</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>:<span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>:path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>:&#123; </span><br><span class="line">    <span class="attr">rules</span>:[&#123; </span><br><span class="line">      <span class="attr">test</span>:<span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">      <span class="attr">use</span>:[&#123;</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>:&#123;</span><br><span class="line">          <span class="attr">name</span>:<span class="string">&#x27;img/[name][hash:8].[ext]&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;] </span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码压缩<br>● HTML 压缩<br>● CSS 压缩<br>● JS 压缩</p><p>HTML 压缩</p><p>使用 HtmlMinimizerWebpackPlugin</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Name</span>类型默认描述</span><br><span class="line">test<span class="title class_">String</span>|<span class="title class_">RegExp</span>|<span class="title class_">Array</span>&lt;<span class="title class_">String</span>|<span class="title class_">RegExp</span>&gt;<span class="regexp">/\.html(\?.*)?$/i</span>测试以匹配文件。</span><br><span class="line">include<span class="title class_">String</span>|<span class="title class_">RegExp</span>|<span class="title class_">Array</span>&lt;<span class="title class_">String</span>|<span class="title class_">RegExp</span>&gt;<span class="literal">undefined</span>要包括的文件。</span><br><span class="line">exclude<span class="title class_">String</span>|<span class="title class_">RegExp</span>|<span class="title class_">Array</span>&lt;<span class="title class_">String</span>|<span class="title class_">RegExp</span>&gt;<span class="literal">undefined</span>要排除的文件。</span><br><span class="line">parallel<span class="title class_">Boolean</span>|<span class="title class_">Number</span><span class="literal">true</span>使用多进程并行运行来提高构建速度。</span><br><span class="line">minify<span class="title class_">Function</span>|<span class="title class_">Array</span>&lt;<span class="title class_">Function</span>&gt;<span class="title class_">HtmlMinimizerPlugin</span>.<span class="property">htmlMinifierTerser</span>允许您覆盖默认的缩小功能。</span><br><span class="line">minimizerOptions<span class="title class_">Object</span>|<span class="title class_">Array</span>&lt;<span class="title class_">Object</span>&gt;&#123; <span class="attr">caseSensitive</span>: <span class="literal">true</span>, <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>, <span class="attr">conservativeCollapse</span>: <span class="literal">true</span>, <span class="attr">keepClosingSlash</span>: <span class="literal">true</span>, <span class="attr">minifyCSS</span>: <span class="literal">true</span>, <span class="attr">minifyJS</span>: <span class="literal">true</span>, <span class="attr">removeComments</span>: <span class="literal">true</span>, <span class="attr">removeScriptTypeAttributes</span>: <span class="literal">true</span>, <span class="attr">removeStyleLinkTypeAttributes</span>: <span class="literal">true</span>, &#125;<span class="title class_">Html</span>-minifier-terser选项</span><br><span class="line">优化。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=&#123;</span><br><span class="line">  <span class="attr">entry</span>:<span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>:&#123;</span><br><span class="line">    <span class="attr">filename</span>:<span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">HtmlMinimizerPlugin</span>(),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这将仅在生产环境开启 CSS 优化。<br>如果还想在开发环境下启用 CSS 优化，请将 optimization.minimize 设置为 true:</p><p>CSS 压缩<br>使用 css-minimizer-webpack-plugin and mini-css-extract-plugin</p><blockquote><p>这个插件使用 cssnano 优化和压缩 CSS。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// 在 webpack@5 中，你可以使用 `...` 语法来扩展现有的 minimizer（即 `terser-webpack-plugin`），将下一行取消注释</span></span><br><span class="line">      <span class="comment">// `...`,</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>JS压缩</p><p>V5内置了<br>terser-webpack-plugin，如果需要特殊配置 仍然需要安装</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [<span class="keyword">new</span> <span class="title class_">TerserPlugin</span>()],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="webpack进阶">webpack进阶</h3><p>自动清理构建目录</p><p><img src="images/webpack-clean.png" alt=""></p><p>自动补全前缀<br><img src="images/auto-complate.png" alt=""></p><p>PostCSS 插件 autoprefixer 自动补全 css3 前缀</p><blockquote><p>postcss-preset-env 包含 autoprefixer</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev postcss-loader postcss postcss-preset-env</span><br><span class="line"></span><br><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">importLoaders</span>: <span class="number">2</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">              <span class="attr">plugins</span>: [[<span class="string">&#x27;postcss-preset-env&#x27;</span>]],</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;less-loader&#x27;</span>,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>多设备同步</strong><br>px2rem-loader  和 lib-flexible 自动实现多设备同步</p><p>资源内联</p><p>代码层面：<br>● 页面框架的初始化脚本<br>● 上报相关打点<br>● css内联避免页面闪动<br>请求方面：减少http网络请求数<br>● 小图片或者字体内联</p><p>HTML 和 js 内联</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= require(&#x27;raw-loader!./meta.html&#x27;).default %&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">&lt;%= <span class="built_in">require</span>(<span class="string">&#x27;raw-loader!babel-loader!../node_modules/amfe-flexible/index.min.js&#x27;</span>).<span class="property">default</span> %&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CSS内联采用 style-loader</p><p>多页面打包<br>优化 SEO ，加快首屏渲染</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">&#x27;glob&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">setMPA</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> entry = &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> htmlWebpackPlugins = [];</span><br><span class="line">    <span class="keyword">const</span> entryFiles = glob.<span class="title function_">sync</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./src/*/index.js&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(entryFiles)</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> entryFile = entryFiles[index];</span><br><span class="line">            <span class="comment">// &#x27;/Users/alan/my-project/src/index/index.js&#x27;</span></span><br><span class="line">            <span class="keyword">const</span> match = entryFile.<span class="title function_">match</span>(<span class="regexp">/src\/(.*)\/index\.js/</span>);</span><br><span class="line">            <span class="keyword">const</span> pageName = match &amp;&amp; match[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            entry[pageName] = entryFile;</span><br><span class="line">            htmlWebpackPlugins.<span class="title function_">push</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">                    <span class="attr">template</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">`src/<span class="subst">$&#123;pageName&#125;</span>/index.html`</span>),</span><br><span class="line">                    <span class="attr">filename</span>: <span class="string">`<span class="subst">$&#123;pageName&#125;</span>.html`</span>,</span><br><span class="line">                    <span class="attr">chunks</span>: [pageName],</span><br><span class="line">                    <span class="attr">inject</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">minify</span>: &#123;</span><br><span class="line">                        <span class="attr">html5</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">preserveLineBreaks</span>: <span class="literal">false</span>,</span><br><span class="line">                        <span class="attr">minifyCSS</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">minifyJS</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">removeComments</span>: <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        entry,</span><br><span class="line">        htmlWebpackPlugins</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; entry, htmlWebpackPlugins &#125; = <span class="title function_">setMPA</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: entry,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;[name].js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">module</span>: ....</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        ....</span><br><span class="line">    ].<span class="title function_">concat</span>(htmlWebpackPlugins),</span><br><span class="line">    ....</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>source map<br>作用：通过 source map 定位到源代码</p><p>基础库分离<br>讲 react 、react-dom 基础包分出不打入bundle，可以单出打出文件，也可引入cdn，<br>对于 echars 等大型包也可 通过 test 检测单出打出，做更细致的优化</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">splitChunks</span>: &#123;</span><br><span class="line">  <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>, <span class="comment">// 匹配的块的类型：initial（初始块），async（按需加载的异步块），all（所有块）</span></span><br><span class="line">  <span class="attr">automaticNameDelimiter</span>: <span class="string">&#x27;-&#x27;</span>,</span><br><span class="line">  <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">    <span class="comment">// 项目第三方组件</span></span><br><span class="line">    <span class="attr">vendor</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">      <span class="attr">enforce</span>: <span class="literal">true</span>, <span class="comment">// ignore splitChunks.minSize, splitChunks.minChunks, splitChunks.maxAsyncRequests and splitChunks.maxInitialRequests</span></span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">      <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 项目公共组件</span></span><br><span class="line">    <span class="attr">default</span>: &#123;</span><br><span class="line">      <span class="attr">minSize</span>: <span class="number">0</span>, <span class="comment">// 分离后的最小块文件大小默认3000</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;common&#x27;</span>, <span class="comment">// 用以控制分离后代码块的命名</span></span><br><span class="line">      <span class="attr">minChunks</span>: <span class="number">3</span>, <span class="comment">// 最小共用次数</span></span><br><span class="line">      <span class="attr">priority</span>: <span class="number">10</span>, <span class="comment">// 优先级，多个分组冲突时决定把代码放在哪块</span></span><br><span class="line">      <span class="attr">reuseExistingChunk</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>tree shaking<br>production时默认开启<br>概念：<br>1 个模块可能有多个⽅法，只要其中的某个⽅法使⽤到了，则整个⽂件都会被打到 bundle ⾥⾯去，tree shaking 就是只把⽤到的⽅法打⼊ bundle ，没⽤到的⽅法会在 uglify 阶段被擦除掉</p><p>scope hoisting<br>webpack3以后production时默认开启<br>原理：将所有模块的代码按照引⽤顺序放在⼀个函数作⽤域⾥，然后适当的重命名⼀ 些变量以防⽌变量名冲突 对⽐: 通过 scope hoisting 可以减少函数声明代码和内存开销</p><p>动态import<br>需要安装babel插件@babel/plugin-syntax-dynamic-import</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;plugins&quot;</span>: [<span class="string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [text, useText] = <span class="title function_">useState</span>(<span class="string">&#x27;before&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">loadimport</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&#x27;./web.js&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">useText</span>(data.<span class="property">default</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;contain&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;loadimport&#125;</span>&gt;</span>hello react<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;text&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>SSR<br>优化SEO</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span> === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">  <span class="variable language_">global</span>.<span class="property">window</span> = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; renderToString &#125; = <span class="built_in">require</span>(<span class="string">&#x27;react-dom/server&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SSR</span> = <span class="built_in">require</span>(<span class="string">&#x27;../dist/search-server&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> template = fs.<span class="title function_">readFileSync</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../dist/search.html&#x27;</span>), <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> data = <span class="built_in">require</span>(<span class="string">&#x27;./data.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">server</span> = (<span class="params">port</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;dist&#x27;</span>));</span><br><span class="line">    app.<span class="title function_">get</span>(<span class="string">&#x27;/search&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> html = <span class="title function_">renderMarkup</span>(<span class="title function_">renderToString</span>(<span class="variable constant_">SSR</span>));</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(html);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server is running on port:&#x27;</span> + port);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">server</span>(process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderMarkup</span> = (<span class="params">str</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> dataStr = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data);</span><br><span class="line">    <span class="keyword">return</span> template.<span class="title function_">replace</span>(<span class="string">&#x27;&lt;!--HTML_PLACEHOLDER--&gt;&#x27;</span>, str)</span><br><span class="line">        .<span class="title function_">replace</span>(<span class="string">&#x27;&lt;!--INITIAL_DATA_PLACEHOLDER--&gt;&#x27;</span>, <span class="string">`&lt;script&gt;window.__initial_data=<span class="subst">$&#123;dataStr&#125;</span>&lt;/script&gt;`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="comment">&lt;!--HTML_PLACEHOLDER--&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--INITIAL_DATA_PLACEHOLDER--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>优化打包速度<br>webpack内置的stats</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;build:stats&quot;</span>: <span class="string">&quot;webpack --config webpack.prod.js --json &gt; stats.json&quot;</span></span><br></pre></td></tr></table></figure><p>loader plugin 速度分析<br>speed-measure-webpack-plugin</p><p>bundle 分析<br>webpack-bundle-analyzer：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。<br><img src="images/bundle-analysis.png" alt=""></p><p>多进程打包<br>thread-loader 、 HappyPack</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(tsx?|js|jsx)$/</span>,</span><br><span class="line">  <span class="attr">include</span>: [<span class="variable constant_">SRC_PATH</span>],</span><br><span class="line">  <span class="attr">exclude</span>: [<span class="regexp">/node_modules/</span>, <span class="regexp">/public/</span>, <span class="regexp">/(.|_)min\.js$/</span>],</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    <span class="string">&#x27;cache-loader&#x27;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;thread-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">workers</span>: <span class="number">3</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;babel-loader?cacheDirectory=true&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>并行压缩<br>webpack5默认开启</p><p>DLL<br>将基础库提前打包，加快build速度</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dll.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">vendor</span>: [<span class="string">&#x27;react&#x27;</span>, <span class="string">&#x27;react-dom&#x27;</span>],</span><br><span class="line">    <span class="comment">//other:[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;build&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;[name].dll.js&#x27;</span>,</span><br><span class="line">    <span class="attr">library</span>: <span class="string">&#x27;[name]_[hash]&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;build&#x27;</span>, <span class="string">&#x27;[name]_manifest.json&#x27;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;[name]_[hash]&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.pro.config.js</span></span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">  <span class="attr">context</span>: path.<span class="title function_">join</span>(__dirname),</span><br><span class="line">  <span class="attr">manifest</span>: <span class="built_in">require</span>(<span class="string">&#x27;./build/vendor_manifest.json&#x27;</span>),</span><br><span class="line">&#125;),</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">AddAssetHtmlPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">filepath</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./build/*.dll.js&#x27;</span>),</span><br><span class="line">  <span class="attr">includeSourcemap</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">//html导入目录</span></span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;./library/js&#x27;</span>,</span><br><span class="line">  <span class="comment">//输出目录</span></span><br><span class="line">  <span class="attr">outputPath</span>: <span class="string">&#x27;./library/js&#x27;</span>,</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>缓存<br>目的：提升二次构建速度</p><p>思路：<br>babel-loader<br>hard-source-webpack-plugin  或者 cache-loader</p><p>缩小构建目标<br>比如 babel-loader 不解析 node_modules</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    <span class="string">&#x27;cache-loader&#x27;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;thread-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">workers</span>: <span class="number">3</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;babel-loader?cacheDirectory=true&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>图片压缩<br>image-webpack-loader</p><p>PurifyCSS<br>purgecss-webpack-plugin remove unused css.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">&#x27;glob&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PurgeCSSPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;purgecss-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PATHS</span> = &#123;</span><br><span class="line">  <span class="attr">src</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">styles</span>: &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;styles&#x27;</span>,</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">          <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">          <span class="attr">enforce</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;[name].css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PurgeCSSPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">paths</span>: glob.<span class="title function_">sync</span>(<span class="string">`<span class="subst">$&#123;PATHS.src&#125;</span>/**/*`</span>,  &#123; <span class="attr">nodir</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>动态polyfill</p><p>babel-plugin-transform-runtime<br>缺点：不能polyfill原型上的方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&#x27;@babel/plugin-transform-runtime&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">corejs</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">regenerator</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>polyfill server<br>缺点：社区维护，部分国内浏览器魔改，导师UA无法识别（可以降级全部返回）<br>基于polyfill.io官网提供的服务<br>识别 User Agent，下发不同的 Polyfill</p><p>代码质量</p><p>● 抽离成npm包<br>● 测试<br>○ 冒烟测试<br>○ 单元测试<br>○ 测试覆盖率<br>● eslint<br>● ci<br>● git 规范<br>● changelog 文档<br>●  husky<br>○ lint-staged  -&gt; Prettier<br>○ commitlint<br>● 版本号<br>alpha：是内部测试版，一般不向外部发布，会有很多 Bug。一般只有测试人员使用。<br>beta：也是测试版，这个阶段的版本会一直加入新的功能。在 Alpha 版之后推出<br>rc：Release Candidate) 系统平台上就是发行候选版本。RC 版不会再加入新的功能了，主 要着重于除错</p><p>react脚手架<br>持续更新地址：react-webpack-template<br>本文持续更新栏目：前端工程化</p><p>● 监控<br>● 组件库<br>● gitlab or 自研平台<br>● 低代码平台<br>● 微前端<br>● 测试平台</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>基本实现原理大致这样的，构建 bundle 的时候，加入一段 HMR runtime 的 js 和一段和服务沟通的 js 。文件修改会触发 webpack 重新构建，服务器通过向浏览器发送更新消息，浏览器通过 jsonp 拉取更新的模块文件，jsonp 回调触发模块热替换逻辑</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="常见loaders">常见loaders</h3><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cache-loader：可以在一些性能开销较大的 Loader 之前添加，目的是将结果缓存到磁盘里。</span><br><span class="line">file-loader：把文件输出到一个文件夹中，在代码中通过相对 URL 去引用输出的文件（处理图片、字体、图标）。</span><br><span class="line">url-loader：与file-loader 类似，区别是用户可以设置一个阈值，大于阈值会交给 file-loader，小于阈值时返回文件 base64 形式编码（处理图片）。</span><br><span class="line">image-loader：加载并且压缩图片文件。</span><br><span class="line">babel-loader：把 ES6 转换成 ES5。</span><br><span class="line">ts-loader：将 typescript 转换成 JavaScript。</span><br><span class="line">svg-inline-loader：将压缩后的SVG内容注入代码中。</span><br><span class="line">raw-loader：加载文件原始内容（utf-8）。</span><br><span class="line">sass-loader：将 scss/sass 代码转换成 css。</span><br><span class="line">css-loader：加载 css，支持模块化、压缩、文件导入等特性。</span><br><span class="line">less-loader：将 less 代码转换成 css。</span><br><span class="line">style-loader：生成 style 标签，将 js 中的样式资源插入，并添加到 header 中生效。</span><br><span class="line">postcss-loader：扩展 css 语法，使用下一代 css，可以配合 autoprefixer 插件自动补齐 css3 前缀。</span><br><span class="line">eslint-loader：通过 eslint 检查 JavaScript 代码。</span><br><span class="line">tslint-loader：通过tslint 检查 typesc 代码。</span><br><span class="line">vue-loader：加载 vue.js 单文件组件。</span><br><span class="line">awesome-typescript-loader：将 typescript 转换成 JavaScript，性能优于 ts-loader</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>技术方案</strong></p><ol><li>对接微信SDK</li><li>高德https://lbs.amap.com/api/javascript-api/reference/location</li><li></li></ol><p>参考链接[<a href="https://juejin.cn/post/7078196346955497485">https://juejin.cn/post/7078196346955497485</a>]</p><pre><code>// &quot;@types/react&quot;: &quot;^17.0.0&quot;,// &quot;@types/react-dom&quot;: &quot;^17.0.0&quot;,// &quot;react&quot;: &quot;17.x&quot;,// &quot;react-dom&quot;: &quot;17.x&quot;,&quot;@types/react&quot;: &quot;^18.0.17&quot;,&quot;@types/react-dom&quot;: &quot;^18.0.6&quot;,  &quot;react&quot;: &quot;^18.2.0&quot;,&quot;react-dom&quot;: &quot;^18.2.0&quot;,         </code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>JS通过经纬度计算两个地方的距离</strong></p><ul><li>主要原理</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lat1 lng1 表示A点纬度和经度，Lat2 lng2 表示B点纬度和经度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a=Lat1 – Lat2 为两点纬度之差  b=lng1 - lng2 为两点经度之差</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6378.137 为地球半径，单位为公里；计算出来的结果单位为公里</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 进行经纬度转换为距离的计算</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Rad</span>(<span class="params">d</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> d * <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">180.0</span>; <span class="comment">//经纬度转换成三角函数中度分表形式。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算距离，参数分别为第一点的纬度，经度；第二点的纬度，经度</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">GetDistance</span>(<span class="params">lat1,lng1,lat2,lng2</span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> radLat1 = <span class="title class_">Rad</span>(lat1);</span><br><span class="line">  <span class="keyword">var</span> radLat2 = <span class="title class_">Rad</span>(lat2);</span><br><span class="line">  <span class="keyword">var</span> a = radLat1 - radLat2;</span><br><span class="line">  <span class="keyword">var</span>  b = <span class="title class_">Rad</span>(lng1) - <span class="title class_">Rad</span>(lng2);</span><br><span class="line">  <span class="keyword">var</span> s = <span class="number">2</span> * <span class="title class_">Math</span>.<span class="title function_">asin</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="title class_">Math</span>.<span class="title function_">sin</span>(a/<span class="number">2</span>),<span class="number">2</span>) +</span><br><span class="line">  <span class="title class_">Math</span>.<span class="title function_">cos</span>(radLat1)*<span class="title class_">Math</span>.<span class="title function_">cos</span>(radLat2)*<span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="title class_">Math</span>.<span class="title function_">sin</span>(b/<span class="number">2</span>),<span class="number">2</span>)));</span><br><span class="line">  </span><br><span class="line">  s = s * <span class="number">6378.137</span> ; <span class="comment">// EARTH_RADIUS;</span></span><br><span class="line">  s = <span class="title class_">Math</span>.<span class="title function_">round</span>(s * <span class="number">10000</span>) / <span class="number">10000</span>; <span class="comment">// 输出为公里</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//s=s.toFixed(4);</span></span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p><strong>WGS84坐标转换GCJ02坐标</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pi = <span class="number">3.14159265358979324</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">6378245.0</span>;</span><br><span class="line"><span class="keyword">var</span> ee = <span class="number">0.00669342162296594323</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* WGS84坐标转换GCJ02坐标</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> wgLat：wgs纬度</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> wgLon：wgs经度</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> Array[lat:gcj纬度,lon:gcj经度]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">load_map.<span class="property">wgs84togcj02</span> = <span class="keyword">function</span> (<span class="params">wgLat, wgLon</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> mgLat, mgLon;</span><br><span class="line">  <span class="keyword">if</span> (load_map.<span class="title function_">outOfChina</span>(wgLat, wgLon))&#123;</span><br><span class="line">    mgLat = wgLat;</span><br><span class="line">    mgLon = wgLon;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> dLat = load_map.<span class="title function_">transformLat</span>(wgLon - <span class="number">105.0</span>, wgLat - <span class="number">35.0</span>);</span><br><span class="line">  <span class="keyword">var</span> dLon = load_map.<span class="title function_">transformLon</span>(wgLon - <span class="number">105.0</span>, wgLat - <span class="number">35.0</span>);</span><br><span class="line">  <span class="keyword">var</span> radLat = wgLat / <span class="number">180.0</span> * pi;</span><br><span class="line">  <span class="keyword">var</span> magic = <span class="title class_">Math</span>.<span class="title function_">sin</span>(radLat);</span><br><span class="line">  magic = <span class="number">1</span> - ee * magic * magic;</span><br><span class="line">  <span class="keyword">var</span> sqrtMagic = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(magic);</span><br><span class="line">  dLat = (dLat * <span class="number">180.0</span>) / ((a * (<span class="number">1</span> - ee)) / (magic * sqrtMagic) * pi);</span><br><span class="line">  dLon = (dLon * <span class="number">180.0</span>) / (a / sqrtMagic * <span class="title class_">Math</span>.<span class="title function_">cos</span>(radLat) * pi);</span><br><span class="line">  mgLat = wgLat + dLat;</span><br><span class="line">  mgLon = wgLon + dLon;</span><br><span class="line">  <span class="keyword">var</span> arr = &#123;&#125;;</span><br><span class="line">  arr[<span class="string">&#x27;lat&#x27;</span>] = mgLat;</span><br><span class="line">  arr[<span class="string">&#x27;lon&#x27;</span>] = mgLon;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">load_map.<span class="property">outOfChina</span> = <span class="keyword">function</span>(<span class="params">lat,lon</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (lon &lt; <span class="number">72.004</span> || lon &gt; <span class="number">137.8347</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (lat &lt; <span class="number">0.8293</span> || lat &gt; <span class="number">55.8271</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">load_map.<span class="property">transformLat</span> = <span class="keyword">function</span>(<span class="params">x, y</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> ret = -<span class="number">100.0</span> + <span class="number">2.0</span> * x + <span class="number">3.0</span> * y + <span class="number">0.2</span> * y * y + <span class="number">0.1</span> * x * y + <span class="number">0.2</span> * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(x));</span><br><span class="line">  ret += (<span class="number">20.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="number">6.0</span> * x * pi) + <span class="number">20.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="number">2.0</span> * x * pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">  ret += (<span class="number">20.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(y * pi) + <span class="number">40.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(y / <span class="number">3.0</span> * pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">  ret += (<span class="number">160.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(y / <span class="number">12.0</span> * pi) + <span class="number">320</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(y * pi / <span class="number">30.0</span>)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">load_map.<span class="property">transformLon</span> = <span class="keyword">function</span>(<span class="params">x, y</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> ret = <span class="number">300.0</span> + x + <span class="number">2.0</span> * y + <span class="number">0.1</span> * x * x + <span class="number">0.1</span> * x * y + <span class="number">0.1</span> * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(x));</span><br><span class="line">  ret += (<span class="number">20.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="number">6.0</span> * x * pi) + <span class="number">20.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="number">2.0</span> * x * pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">  ret += (<span class="number">20.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(x * pi) + <span class="number">40.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(x / <span class="number">3.0</span> * pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">  ret += (<span class="number">150.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(x / <span class="number">12.0</span> * pi) + <span class="number">300.0</span> * <span class="title class_">Math</span>.<span class="title function_">sin</span>(x / <span class="number">30.0</span> * pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="echarts-3d-地球">echarts 3d 地球</h3><ul><li>3d 地球</li><li>设置 纹理地图</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[[{"id":"4w0sur9a9de000","editCanvasConfig":{"projectName":"4","width":1920,"height":1080,"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","background":null,"backgroundImage":null,"selectColor":true,"chartThemeColor":"dark","chartThemeSetting":{"title":{"show":true,"textStyle":{"color":"#BFBFBF","fontSize":18},"subtextStyle":{"color":"#A2A2A2","fontSize":14}},"xAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"bottom","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":false,"lineStyle":{"color":"#484753","width":1,"type":"solid"}}},"yAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"left","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":true,"lineStyle":{"color":"#484753","width":1,"type":"solid"}}},"legend":{"show":true,"top":"5%","textStyle":{"color":"#B9B8CE"}},"grid":{"show":false,"left":"10%","top":"60","right":"10%","bottom":"60"},"dataset":null},"previewScaleType":"fit"},"componentList":[{"id":"25foogybk3i800","isGroup":false,"attr":{"x":1,"y":100,"w":447,"h":300,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"BarCommon","chartConfig":{"key":"BarCommon","chartKey":"VBarCommon","conKey":"VCBarCommon","title":"柱状图","category":"Bars","categoryName":"柱状图","package":"Charts","chartFrame":"echarts","image":"bar_x.png"},"option":{"legend":{"show":true,"top":"5%","textStyle":{"color":"#B9B8CE"}},"xAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"bottom","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":false,"lineStyle":{"color":"#484753","width":1,"type":"solid"}},"type":"category"},"yAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"left","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":true,"lineStyle":{"color":"#484753","width":1,"type":"solid"}},"type":"value"},"grid":{"show":false,"left":"10%","top":"60","right":"10%","bottom":"60"},"tooltip":{"show":true,"trigger":"axis","axisPointer":{"show":true,"type":"shadow"}},"dataset":{"dimensions":["product","data1","data2"],"source":[{"product":"Mon","data1":120,"data2":130},{"product":"Tue","data1":200,"data2":130},{"product":"Wed","data1":150,"data2":312},{"product":"Thu","data1":80,"data2":268},{"product":"Fri","data1":70,"data2":155},{"product":"Sat","data1":110,"data2":117},{"product":"Sun","data1":130,"data2":160}]},"series":[{"type":"bar","barWidth":15,"label":{"show":true,"position":"top","color":"#fff","fontSize":12},"itemStyle":{"color":null,"borderRadius":2}},{"type":"bar","barWidth":15,"label":{"show":true,"position":"top","color":"#fff","fontSize":12},"itemStyle":{"color":null,"borderRadius":2}}],"backgroundColor":"rgba(0,0,0,0)"}},{"id":"1c5vqnwp7j1c00","isGroup":false,"attr":{"x":1,"y":387,"w":423,"h":338,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"LineCommon","chartConfig":{"key":"LineCommon","chartKey":"VLineCommon","conKey":"VCLineCommon","title":"折线图","category":"Lines","categoryName":"折线图","package":"Charts","chartFrame":"echarts","image":"line.png"},"option":{"legend":{"show":true,"top":"5%","textStyle":{"color":"#B9B8CE"}},"xAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"bottom","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":false,"lineStyle":{"color":"#484753","width":1,"type":"solid"}},"type":"category"},"yAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"left","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":true,"lineStyle":{"color":"#484753","width":1,"type":"solid"}},"type":"value"},"grid":{"show":false,"left":"10%","top":"60","right":"10%","bottom":"60"},"tooltip":{"show":true,"trigger":"axis","axisPointer":{"type":"line"}},"dataset":{"dimensions":["product","data1","data2"],"source":[{"product":"Mon","data1":120,"data2":130},{"product":"Tue","data1":200,"data2":130},{"product":"Wed","data1":150,"data2":312},{"product":"Thu","data1":80,"data2":268},{"product":"Fri","data1":70,"data2":155},{"product":"Sat","data1":110,"data2":117},{"product":"Sun","data1":130,"data2":160}]},"series":[{"type":"line","label":{"show":true,"position":"top","color":"#fff","fontSize":12},"symbolSize":5,"itemStyle":{"color":null,"borderRadius":0},"lineStyle":{"type":"solid","width":3,"color":null}},{"type":"line","label":{"show":true,"position":"top","color":"#fff","fontSize":12},"symbolSize":5,"itemStyle":{"color":null,"borderRadius":0},"lineStyle":{"type":"solid","width":3,"color":null}}],"backgroundColor":"rgba(0,0,0,0)"}},{"id":"5t2prpox2q8000","isGroup":false,"attr":{"x":1433,"y":103,"w":474,"h":299,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"CapsuleChart","chartConfig":{"key":"CapsuleChart","chartKey":"VCapsuleChart","conKey":"VCCapsuleChart","title":"胶囊柱图","category":"Bars","categoryName":"柱状图","package":"Charts","chartFrame":"common","image":"capsule.png"},"option":{"dataset":{"dimensions":["name","value"],"source":[{"name":"厦门","value":20},{"name":"南阳","value":40},{"name":"北京","value":60},{"name":"上海","value":80},{"name":"新疆","value":100}]},"colors":["#c4ebad","#6be6c1","#a0a7e6","#96dee8","#3fb1e3"],"unit":"","itemHeight":10,"valueFontSize":16,"paddingRight":50,"paddingLeft":50,"showValue":true}},{"id":"46m2rhdeax0000","isGroup":false,"attr":{"x":1435,"y":402,"w":472,"h":360,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"PieCommon","chartConfig":{"key":"PieCommon","chartKey":"VPieCommon","conKey":"VCPieCommon","title":"饼图","category":"Pies","categoryName":"饼图","package":"Charts","chartFrame":"echarts","image":"pie.png"},"option":{"legend":{"show":true,"top":"5%","textStyle":{"color":"#B9B8CE"}},"type":"ring","tooltip":{"show":true,"trigger":"item"},"dataset":{"dimensions":["product","data1"],"source":[{"product":"Mon","data1":120},{"product":"Tue","data1":200},{"product":"Wed","data1":150},{"product":"Thu","data1":80},{"product":"Fri","data1":70},{"product":"Sat","data1":110},{"product":"Sun","data1":130}]},"series":[{"type":"pie","radius":["40%","65%"],"center":["50%","60%"],"roseType":false,"avoidLabelOverlap":false,"itemStyle":{"show":true,"borderRadius":10,"borderColor":"#fff","borderWidth":2},"label":{"show":false,"position":"center","formatter":"{b}","fontSize":12},"emphasis":{"label":{"show":true,"fontSize":"40","fontWeight":"bold"}},"labelLine":{"show":false}}],"backgroundColor":"rgba(0,0,0,0)"}},{"id":"z5ez91el5xs00","isGroup":false,"attr":{"x":11,"y":728,"w":413,"h":345,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"PieCommon","chartConfig":{"key":"PieCommon","chartKey":"VPieCommon","conKey":"VCPieCommon","title":"饼图","category":"Pies","categoryName":"饼图","package":"Charts","chartFrame":"echarts","image":"pie.png"},"option":{"legend":{"show":true,"top":"5%","textStyle":{"color":"#B9B8CE"}},"type":"ring","tooltip":{"show":true,"trigger":"item"},"dataset":{"dimensions":["product","data1"],"source":[{"product":"Mon","data1":120},{"product":"Tue","data1":200},{"product":"Wed","data1":150},{"product":"Thu","data1":80},{"product":"Fri","data1":70},{"product":"Sat","data1":110},{"product":"Sun","data1":130}]},"series":[{"type":"pie","radius":["40%","65%"],"center":["50%","60%"],"roseType":false,"avoidLabelOverlap":false,"itemStyle":{"show":true,"borderRadius":10,"borderColor":"#fff","borderWidth":2},"label":{"show":false,"position":"center","formatter":"{b}","fontSize":12},"emphasis":{"label":{"show":true,"fontSize":"40","fontWeight":"bold"}},"labelLine":{"show":false}}],"backgroundColor":"rgba(0,0,0,0)"}},{"id":"1kvdghbx60n400","isGroup":false,"attr":{"x":1410,"y":764,"w":497,"h":300,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"LineGradients","chartConfig":{"key":"LineGradients","chartKey":"VLineGradients","conKey":"VCLineGradients","title":"双折线渐变面积图","category":"Lines","categoryName":"折线图","package":"Charts","chartFrame":"echarts","image":"line_gradient.png"},"option":{"legend":{"show":true,"top":"5%","textStyle":{"color":"#B9B8CE"}},"xAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"bottom","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":false,"lineStyle":{"color":"#484753","width":1,"type":"solid"}},"type":"category"},"yAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"left","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":true,"lineStyle":{"color":"#484753","width":1,"type":"solid"}},"type":"value"},"grid":{"show":false,"left":"10%","top":"60","right":"10%","bottom":"60"},"tooltip":{"show":true,"trigger":"axis","axisPointer":{"type":"line"}},"dataset":{"dimensions":["product","data1","data2"],"source":[{"product":"Mon","data1":120,"data2":130},{"product":"Tue","data1":200,"data2":130},{"product":"Wed","data1":150,"data2":312},{"product":"Thu","data1":80,"data2":268},{"product":"Fri","data1":70,"data2":155},{"product":"Sat","data1":110,"data2":117},{"product":"Sun","data1":130,"data2":160}]},"series":[{"type":"line","smooth":false,"symbolSize":5,"label":{"show":true,"position":"top","color":"#fff","fontSize":12},"lineStyle":{"width":3,"type":"solid"},"areaStyle":{"opacity":0.8,"color":{"colorStops":[{"offset":0,"color":"rgba(73, 146, 255, 0.5)"},{"offset":1,"color":"rgba(0,0,0, 0)"}],"x":0,"y":0,"x2":0,"y2":1,"type":"linear","global":false}}},{"type":"line","smooth":false,"label":{"show":true,"position":"top","color":"#fff","fontSize":12},"lineStyle":{"width":3,"type":"solid"},"areaStyle":{"opacity":0.8,"color":{"colorStops":[{"offset":0,"color":"rgba(124, 255, 178, 0.5)"},{"offset":1,"color":"rgba(0,0,0, 0)"}],"x":0,"y":0,"x2":0,"y2":1,"type":"linear","global":false}}}],"backgroundColor":"rgba(0,0,0,0)"}},{"id":"3x84o9nzuse000","isGroup":false,"attr":{"x":424,"y":756,"w":500,"h":313,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"ScatterLogarithmicRegression","chartConfig":{"key":"ScatterLogarithmicRegression","chartKey":"VScatterLogarithmicRegression","conKey":"VCScatterLogarithmicRegression","title":"对数回归散点图","category":"Scatters","categoryName":"散点图","package":"Charts","chartFrame":"echarts","image":"scatter-logarithmic-regression.png"},"option":{"legend":{"show":true,"top":"5%","textStyle":{"color":"#B9B8CE"},"data":["1990","2015"]},"xAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"bottom","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":false,"lineStyle":{"color":"#484753","width":1,"type":"dashed"}},"type":"value"},"yAxis":{"show":true,"name":"","nameGap":15,"nameTextStyle":{"color":"#B9B8CE","fontSize":12},"inverse":false,"axisLabel":{"show":true,"fontSize":12,"color":"#B9B8CE","rotate":0},"position":"left","axisLine":{"show":true,"lineStyle":{"color":"#B9B8CE","width":1},"onZero":true},"axisTick":{"show":true,"length":5},"splitLine":{"show":true,"lineStyle":{"color":"#484753","width":1,"type":"dashed"}},"type":"value"},"grid":{"show":false,"left":"10%","top":"60","right":"10%","bottom":"60"},"dataset":[{"source":[[28604,77,17096869,"Australia",1990],[31163,77.4,27662440,"Canada",1990],[1516,68,1154605773,"China",1990],[13670,74.7,10582082,"Cuba",1990],[28599,75,4986705,"Finland",1990],[29476,77.1,56943299,"France",1990],[31476,75.4,78958237,"Germany",1990],[28666,78.1,254830,"Iceland",1990],[1777,57.7,870601776,"India",1990],[29550,79.1,122249285,"Japan",1990],[2076,67.9,20194354,"North Korea",1990],[12087,72,42972254,"South Korea",1990],[24021,75.4,3397534,"New Zealand",1990],[43296,76.8,4240375,"Norway",1990],[10088,70.8,38195258,"Poland",1990],[19349,69.6,147568552,"Russia",1990],[10670,67.3,53994605,"Turkey",1990],[26424,75.7,57110117,"United Kingdom",1990],[37062,75.4,252847810,"United States",1990],[44056,81.8,23968973,"Australia",2015],[43294,81.7,35939927,"Canada",2015],[13334,76.9,1376048943,"China",2015],[21291,78.5,11389562,"Cuba",2015],[38923,80.8,5503457,"Finland",2015],[37599,81.9,64395345,"France",2015],[44053,81.1,80688545,"Germany",2015],[42182,82.8,329425,"Iceland",2015],[5903,66.8,1311050527,"India",2015],[36162,83.5,126573481,"Japan",2015],[1390,71.4,25155317,"North Korea",2015],[34644,80.7,50293439,"South Korea",2015],[34186,80.6,4528526,"New Zealand",2015],[64304,81.6,5210967,"Norway",2015],[24787,77.3,38611794,"Poland",2015],[23038,73.13,143456918,"Russia",2015],[19360,76.5,78665830,"Turkey",2015],[38225,81.4,64715810,"United Kingdom",2015],[53354,79.1,321773631,"United States",2015]]},{"transform":{"type":"filter","config":{"dimension":4,"eq":1990}}},{"transform":{"type":"filter","config":{"dimension":4,"eq":2015}}},{"transform":{"type":"ecStat:regression","config":{"method":"logarithmic"}}}],"tooltip":{"showDelay":0,"formatter":"(params) => {\n      return params.value.length > 1 ? `${params.seriesName}\\uFF1A<br />${params.value[0]} ${params.value[1]}` : `${params.seriesName}\\uFF1A<br />${params.name} ${params.value}`;\n    }","axisPointer":{"show":true,"type":"cross","lineStyle":{"type":"dashed","width":1}}},"visualMap":{"show":false,"dimension":2,"min":20000,"max":1500000000,"seriesIndex":[0,1],"inRange":{"symbolSize":[10,70]}},"series":[{"type":"scatter","datasetIndex":1},{"type":"scatter","datasetIndex":2},{"type":"line","smooth":true,"datasetIndex":3,"symbolSize":0.1,"symbol":"circle","label":{"show":true,"fontSize":16},"labelLayout":{"dx":-20},"encode":{"label":2,"tooltip":1}}],"backgroundColor":"rgba(0,0,0,0)"}},{"id":"4vxijp2vi04000","isGroup":false,"attr":{"x":935,"y":762,"w":472,"h":300,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"PieCircle","chartConfig":{"key":"PieCircle","chartKey":"VPieCircle","conKey":"VCPieCircle","title":"饼图-环形","category":"Pies","categoryName":"饼图","package":"Charts","chartFrame":"echarts","image":"pie-circle.png"},"option":{"tooltip":{"show":true,"trigger":"item"},"legend":{"show":true},"dataset":0.25,"title":{"text":"25.00%","x":"center","y":"center","textStyle":{"color":"#56B9F8","fontSize":30}},"series":[{"type":"pie","radius":["75%","80%"],"center":["50%","50%"],"hoverAnimation":true,"color":["#00bcd44a","transparent"],"label":{"show":false},"data":[{"value":[25],"itemStyle":{"color":"#03a9f4","shadowBlur":10,"shadowColor":"#97e2f5"}},{"value":[75],"itemStyle":{"color":"#00bcd44a","shadowBlur":0,"shadowColor":"#00bcd44a"}}]}],"backgroundColor":"rgba(0,0,0,0)"}},{"id":"3fmr089cg2m000","isGroup":false,"attr":{"x":458,"y":102,"w":977,"h":628,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"ThreeEarth01","chartConfig":{"key":"ThreeEarth01","chartKey":"VThreeEarth01","conKey":"VCThreeEarth01","title":"三维地球","category":"Three","categoryName":"三维","package":"Decorates","chartFrame":"static","image":"threeEarth01.png"},"option":{"dataset":[{"startArray":{"name":"杭州","N":30.246026,"E":120.210792},"endArray":[{"name":"曼谷","N":22,"E":100.49074172973633},{"name":"澳大利亚","N":-23.68477416688374,"E":133.857421875},{"name":"新疆维吾尔自治区","N":41.748,"E":84.9023},{"name":"德黑兰","N":35,"E":51},{"name":"德黑兰","N":35,"E":51},{"name":"美国","N":34.125447565116126,"E":241.7431640625},{"name":"英国","N":51.508742458803326,"E":359.82421875},{"name":"巴西","N":-9.96885060854611,"E":668.1445312499999}]},{"startArray":{"name":"北京","N":39.89491,"E":116.322056},"endArray":[{"name":"西藏","N":29.660361,"E":91.132212},{"name":"广西","N":22.830824,"E":108.30616},{"name":"江西","N":28.676493,"E":115.892151},{"name":"贵阳","N":26.647661,"E":106.630153}]}]}},{"id":"4fgppksl9ma000","isGroup":false,"attr":{"x":671,"y":15,"w":500,"h":81,"offsetX":0,"offsetY":0,"zIndex":-1},"styles":{"filterShow":false,"hueRotate":0,"saturate":1,"contrast":1,"brightness":1,"opacity":1,"rotateZ":0,"rotateX":0,"rotateY":0,"skewX":0,"skewY":0,"blendMode":"normal","animations":[]},"preview":{"overFlowHidden":false},"status":{"lock":false,"hide":false},"request":{"requestDataType":0,"requestHttpType":"get","requestUrl":"","requestInterval":null,"requestIntervalUnit":"second","requestContentType":0,"requestParamsBodyType":"none","requestSQLContent":{"sql":"select * from  where"},"requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}},"filter":null,"events":{"baseEvent":{"click":null,"dblclick":null,"mouseenter":null,"mouseleave":null},"advancedEvents":{"vnodeMounted":null,"vnodeBeforeMount":null}},"key":"TextCommon","chartConfig":{"key":"TextCommon","chartKey":"VTextCommon","conKey":"VCTextCommon","title":"文字","category":"Texts","categoryName":"文本","package":"Informations","image":"text_static.png"},"option":{"link":"","linkHead":"http://","dataset":"自定义大屏","fontSize":20,"fontColor":"#ffffff","paddingX":10,"paddingY":10,"textAlign":"center","fontWeight":"normal","borderWidth":0,"borderColor":"#ffffff","borderRadius":5,"letterSpacing":5,"writingMode":"horizontal-tb","backgroundColor":"#00000000"}}],"requestGlobalConfig":{"requestDataPond":[],"requestOriginUrl":"","requestInterval":30,"requestIntervalUnit":"second","requestParams":{"Body":{"form-data":{},"x-www-form-urlencoded":{},"json":"","xml":""},"Header":{},"Params":{}}}}]]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="React-版本表单设计器">React 版本表单设计器</h3><p><strong>alibaba</strong></p><ol><li><a href="https://xrender.fun/generator/playground">form-render</a></li><li><a href="https://designable.netlify.app/">desianable</a></li><li></li></ol><h3 id="Vue-版本表单设计器">Vue 版本表单设计器</h3><ul><li><p>vue-form-making</p><ul><li><a href="https://gitee.com/gavinzhulei/vue-form-making.git">https://gitee.com/gavinzhulei/vue-form-making.git</a></li><li></li></ul></li><li><p>form-generator</p><ul><li><a href="https://github.com/JakHuang/form-generator">https://github.com/JakHuang/form-generator</a></li><li>开源 MIT</li><li>整合笔记: <a href="https://note.youdao.com/ynoteshare/index.html?id=61db651a896c79081e9ec9a371e69e47&amp;type=note&amp;_time=1656573173320">https://note.youdao.com/ynoteshare/index.html?id=61db651a896c79081e9ec9a371e69e47&amp;type=note&amp;_time=1656573173320</a></li></ul></li><li><p>form-factory</p></li><li><p>f-render</p></li><li><p>form-create</p></li></ul><ol><li><a href="https://www.mingdao.com/worksheet/field/edit?sourceId=611622fc791572172d5e57e7&amp;fromURL=newPage">https://www.mingdao.com/worksheet/field/edit?sourceId=611622fc791572172d5e57e7&amp;fromURL=newPage</a></li></ol><ul><li>brick-design</li><li>界面设计</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="form-render">form-render</h3><p><strong>Interface</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> interface <span class="title class_">Transformer</span> &#123;</span><br><span class="line">  <span class="comment">/** 正向的转换函数 */</span></span><br><span class="line">  <span class="keyword">from</span>?: <span class="function">(<span class="params">schema: any</span>) =&gt;</span> any;</span><br><span class="line">  <span class="comment">/** 反向的转换函数 */</span></span><br><span class="line">  to?: <span class="function">(<span class="params">schema: any</span>) =&gt;</span> any;</span><br><span class="line">  <span class="comment">/** 反向的转换函数 */</span></span><br><span class="line">  fromSetting?: <span class="function">(<span class="params">schema: any</span>) =&gt;</span> any;</span><br><span class="line">  <span class="comment">/** 反向的转换函数 */</span></span><br><span class="line">  toSetting?: <span class="function">(<span class="params">schema: any</span>) =&gt;</span> any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ExtraButton</span> &#123;</span><br><span class="line">  <span class="comment">/** 按钮文案 */</span></span><br><span class="line">  <span class="attr">text</span>: string;</span><br><span class="line">  <span class="comment">/** 点击回调 */</span></span><br><span class="line">  onClick?: <span class="function">(<span class="params">event: any</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  [<span class="attr">key</span>: string]: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">ControlButton</span> &#123;</span><br><span class="line">  <span class="comment">/** 按钮文案 */</span></span><br><span class="line">  text?: string;</span><br><span class="line">  <span class="comment">/** 点击回调 */</span></span><br><span class="line">  onClick?: <span class="function">(<span class="params">event: any, schema: any</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">SettingWidget</span> &#123;</span><br><span class="line">  <span class="comment">/** 按钮生成的 schema 的 key 值 */</span></span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="comment">/** 在左侧栏按钮展示文案 */</span></span><br><span class="line">  <span class="attr">text</span>: string;</span><br><span class="line">  <span class="comment">/** 在左侧栏按钮展示图标 */</span></span><br><span class="line">  icon?: string | <span class="title class_">ReactNode</span>;</span><br><span class="line">  <span class="comment">/** 如果是基本组件，这个字段注明它对应的 widgets */</span></span><br><span class="line">  widget?: string;</span><br><span class="line">  <span class="comment">/** 组件对应的 schema 片段 */</span></span><br><span class="line">  schema?: any;</span><br><span class="line">  <span class="comment">/** 组件的配置信息，使用 form-render 的 schema 来描述 */</span></span><br><span class="line">  setting?: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">Setting</span> &#123;</span><br><span class="line">  <span class="comment">/** 最外层的分组名称 */</span></span><br><span class="line">  <span class="attr">title</span>: string;</span><br><span class="line">  <span class="comment">/** 每个组件的配置，在左侧栏是一个按钮 */</span></span><br><span class="line">  <span class="attr">widgets</span>: <span class="title class_">SettingWidget</span>[];</span><br><span class="line">  show?: boolean;</span><br><span class="line">  useCommon?: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">FRGeneratorProps</span> &#123;</span><br><span class="line">  getId?: <span class="function">(<span class="params">name: string</span>) =&gt;</span> string;</span><br><span class="line">  <span class="comment">/** 隐藏组件 ID */</span></span><br><span class="line">  hideId?: boolean;</span><br><span class="line">  <span class="comment">/** 固定 id */</span></span><br><span class="line">  fixedName?: boolean;</span><br><span class="line">  <span class="comment">/** 组件删除控制 */</span></span><br><span class="line">  canDelete?: boolean | <span class="title class_">Function</span>;</span><br><span class="line">  <span class="comment">/** 默认一进入编辑器展示的表单对应的 schema */</span></span><br><span class="line">  defaultValue?: any;</span><br><span class="line">  <span class="comment">/** 自定义 schema 到 form-render 的 schema 的双向转换函数 */</span></span><br><span class="line">  transformer?: <span class="title class_">Transformer</span>;</span><br><span class="line">  <span class="comment">/** 编辑区顶部的自定义按钮 */</span></span><br><span class="line">  extraButtons?: (<span class="title class_">ExtraButton</span> | boolean | string)[];</span><br><span class="line">  <span class="comment">/** 选中项操作按钮 */</span></span><br><span class="line">  controlButtons?: (<span class="title class_">ControlButton</span> | boolean | <span class="title class_">Function</span>)[];</span><br><span class="line">  <span class="comment">/** 预览态控制 */</span></span><br><span class="line">  preview?: boolean;</span><br><span class="line">  <span class="comment">/** 左右侧栏配置 */</span></span><br><span class="line">  settings?: <span class="title class_">Setting</span>[];</span><br><span class="line">  <span class="comment">/** 通用配置 */</span></span><br><span class="line">  commonSettings?: any;</span><br><span class="line">  <span class="comment">/** 全局配置 */</span></span><br><span class="line">  globalSettings?: any;</span><br><span class="line">  <span class="comment">/** 自定义组件 */</span></span><br><span class="line">  widgets?: any;</span><br><span class="line">  <span class="comment">/** 配置栏自定义组件 */</span></span><br><span class="line">  settingsWidgets?: any;</span><br><span class="line">  <span class="comment">/** 组件和 schema 的映射规则 */</span></span><br><span class="line">  mapping?: any;</span><br><span class="line">  <span class="comment">/** 配置表单校验 */</span></span><br><span class="line">  validation?: boolean;</span><br><span class="line">  <span class="comment">/** */</span></span><br><span class="line">  fieldRender?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    schema?: any,</span></span></span><br><span class="line"><span class="params"><span class="function">    widgetProps?: any,</span></span></span><br><span class="line"><span class="params"><span class="function">    children?: ReactNode,</span></span></span><br><span class="line"><span class="params"><span class="function">    originNode?: ReactNode</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="title class_">ReactNode</span>;</span><br><span class="line">  <span class="comment">/** */</span></span><br><span class="line">  fieldWrapperRender?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    schema?: any,</span></span></span><br><span class="line"><span class="params"><span class="function">    isSelected?: boolean,</span></span></span><br><span class="line"><span class="params"><span class="function">    children?: ReactNode,</span></span></span><br><span class="line"><span class="params"><span class="function">    originNode?: ReactNode</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="title class_">ReactNode</span>;</span><br><span class="line">  <span class="comment">/** */</span></span><br><span class="line">  elementRender?: <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    schema?: any,</span></span></span><br><span class="line"><span class="params"><span class="function">    widgetProps?: SettingWidget,</span></span></span><br><span class="line"><span class="params"><span class="function">    originNode?: ReactNode</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>) =&gt;</span> <span class="title class_">ReactNode</span>;</span><br><span class="line">  <span class="comment">/** 表单 data 变化回调 */</span></span><br><span class="line">  onChange?: <span class="function">(<span class="params">data: any</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">/** 表单 schema 变化回调 */</span></span><br><span class="line">  onSchemaChange?: <span class="function">(<span class="params">schema: any</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">/** 画布组件选择回调 */</span></span><br><span class="line">  onCanvasSelect?: <span class="function">(<span class="params">schema: any</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">SettingsProps</span> &#123;</span><br><span class="line">  <span class="comment">/** 自定义组件 */</span></span><br><span class="line">  widgets?: any;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">CanvasProps</span> &#123;</span><br><span class="line">  <span class="comment">/** 画布组件选择回调 */</span></span><br><span class="line">  onCanvasSelect?: <span class="function">(<span class="params">schema: any</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">SidebarProps</span> &#123;</span><br><span class="line">  <span class="comment">/** 固定 id */</span></span><br><span class="line">  fixedName?: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** */</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">Generator</span></span><br><span class="line">  <span class="keyword">extends</span> <span class="title class_">ForwardRefExoticComponent</span>&lt;</span><br><span class="line">    <span class="title class_">FRGeneratorProps</span> &amp; <span class="title class_">RefAttributes</span>&lt;<span class="title class_">HTMLElement</span>&gt;</span><br><span class="line">  &gt; &#123;</span><br><span class="line">  <span class="title class_">Provider</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">FRGeneratorProps</span>&gt;;</span><br><span class="line">  <span class="title class_">Settings</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">SettingsProps</span>&gt;;</span><br><span class="line">  <span class="title class_">Canvas</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">CanvasProps</span>&gt;;</span><br><span class="line">  <span class="title class_">Sidebar</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">SidebarProps</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">  &lt;col&gt;标签是给表格中一个或多个列定义属性值,共12列</span></span><br><span class="line"><span class="comment">  &lt;colgroup&gt;标签是对表格中的列进行组合，从而实现对表格的格式化。</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">colgroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;98&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;66&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;53&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;89&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;95&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;98&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;76&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;22&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;55&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;38&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">col</span> <span class="attr">width</span>=<span class="string">&quot;93&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">colgroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>申请单位<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>申请时间<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>年 <span class="symbol">&amp;nbsp;</span>月 <span class="symbol">&amp;nbsp;</span> 日<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>开票人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>施工单位<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>动火地点<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8056in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_D3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>动火部位<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>涉及的特殊作业<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4924in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table14&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>动火人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8056in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P11&quot;</span>&gt;</span>动火方式<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>涉及的特殊作业<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>许可证编号<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4924in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">rowspan</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span>采样检测<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>采样时间<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8056in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>月 <span class="symbol">&amp;nbsp;</span>日 <span class="symbol">&amp;nbsp;</span>时 <span class="symbol">&amp;nbsp;</span>分<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>月 <span class="symbol">&amp;nbsp;</span>日 <span class="symbol">&amp;nbsp;</span>时 <span class="symbol">&amp;nbsp;</span>分<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4924in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>月 <span class="symbol">&amp;nbsp;</span>日 <span class="symbol">&amp;nbsp;</span>时 <span class="symbol">&amp;nbsp;</span>分<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>采 样 点<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8056in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4924in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>气体名称<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8056in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4924in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>分析结果<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8056in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8514in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.6826in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4924in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8354in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span> 分 析 人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8056in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8514in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.6826in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4924in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8354in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>作业时间<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;11&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span></span><br><span class="line">          自 <span class="symbol">&amp;nbsp;</span> 年 <span class="symbol">&amp;nbsp;</span> 月 <span class="symbol">&amp;nbsp;</span> 日 <span class="symbol">&amp;nbsp;</span> 时 <span class="symbol">&amp;nbsp;</span> 分始，至 <span class="symbol">&amp;nbsp;</span></span><br><span class="line">          <span class="symbol">&amp;nbsp;</span>年 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>月 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>日 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>时 <span class="symbol">&amp;nbsp;</span></span><br><span class="line">          <span class="symbol">&amp;nbsp;</span>分止</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P19&quot;</span>&gt;</span>专业<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P19&quot;</span>&gt;</span>JSA安全风险识别<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P19&quot;</span>&gt;</span>主要安全风险防控措施（包括但不限于）<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P19&quot;</span>&gt;</span>责任人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table112&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">rowspan</span>=<span class="string">&quot;8&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P18&quot;</span>&gt;</span>建设单位<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>存在易燃易爆、有毒物质<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>动火设备内部构件清理干净，吹扫或水洗合<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>格，达到动火条件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table113&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>未有效隔离<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>断开与动火设备相连接的所有管线，加盲板<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>（ ）块<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table114&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>气体检测不达标<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>存放过可燃物料的设备（管线）动火应化验或<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>检测分析合格，达到动火条件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table115&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span>作业环境不具备条件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>动火点 30m 范围内不得排放可燃气体；15m 内<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>不得排放可燃液体；10m 范围内及动火点下方<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>不得同时进行可燃溶剂清洗或喷漆作业，10m<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>范围内不得有可燃性粉尘清扫作业，罐区内动<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>火点同一围堰内和防火间距内的油罐不得进行<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>脱水作业和取样作业<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>其他相应作业未办理许可<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>其他相关特殊作业已办理相应作业许可证<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>设备设施有缺陷<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>在动火部位附近对设备管线测厚，壁厚（）mm<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table118&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>未配备检测设备<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>用于连续监测的便携式或移动式可燃气体检测<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>仪已配备到位<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table119&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>隔离防护不到位<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>动火点周围（最小半径 15 米）的下水井、地<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>漏、地沟、电缆沟等已清除易燃物，并已采取<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>覆盖、铺沙、水封等手段进行隔离<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P15&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table11&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P19&quot;</span>&gt;</span>专业<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P19&quot;</span>&gt;</span>JSA安全风险识别<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P19&quot;</span>&gt;</span>主要安全风险防控措施（包括但不限于）<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P19&quot;</span>&gt;</span>责任人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">rowspan</span>=<span class="string">&quot;8&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>施工单位<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>机具使用不当<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>电焊机所处位置已考虑防火防爆要求，且已可靠接地<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>安全距离不够<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span></span><br><span class="line">          乙炔气瓶直立放置并有防倾倒措施，乙炔气瓶、氧气瓶与火源间的距离大于</span><br><span class="line">          10m, 两气瓶</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>相互间距大于 5m<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>防护用品、用具不符合要求<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>高处作业应采取防火花飞溅措施，人员佩戴必<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>要的个体防护装备<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>工具不符合防爆要求<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>使用符合要求的防爆工具<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>绝缘不良<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>电焊把线就近搭接在焊件上，把线及二次线绝<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>缘必须完好，不得穿过下水井或在运行设备<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>（管线）上搭接焊把线<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>监控不满足要求<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>视频监控已落实，且防爆级别满足安全要求<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>未配备相应安全物资<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>现场配备消防蒸汽带（ ）根，灭火器（ ）<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>台，铁锹（ ）把，防火布（ ）块<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>冒险进入危险场所<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>作业现场四周已设立警戒区<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span> <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>建设单位监护人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>现场作业条件是否满足<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>严格落实监护人安全职责<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">rowspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>JSA<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>补充分析<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table121&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.5944in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.0465in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.3444in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table133&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;12&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span></span><br><span class="line">          安全人员全面复核风险防控措施落实情况 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span></span><br><span class="line">          <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> 签字：</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table133&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>开票人对防控措施<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>落实、贴挂标识、<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>现场安全交底进行<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>确认后签字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4743in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>接受交底的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>作业人员签字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.1972in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table133&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>建设单位监护人签字<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.4743in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span>监护人证号<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.1972in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P10&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table133&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>基层单位上一级安全管理人员会签意见<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span></span><br><span class="line">          签字： <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>年</span><br><span class="line">          <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>月 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>日 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>时 <span class="symbol">&amp;nbsp;</span> 分</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>审批人意见<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P11&quot;</span>&gt;</span></span><br><span class="line">          签字： <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> 年 <span class="symbol">&amp;nbsp;</span> 月</span><br><span class="line">          <span class="symbol">&amp;nbsp;</span> 日 <span class="symbol">&amp;nbsp;</span> 时 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>分</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;Table133&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8785in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>施工单位完工验收确认<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span></span><br><span class="line">          签字： <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> 年 <span class="symbol">&amp;nbsp;</span></span><br><span class="line">          <span class="symbol">&amp;nbsp;</span> 月 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>日 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>时 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>分</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">        <span class="attr">colspan</span>=<span class="string">&quot;6&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;text-align:left;width:0.8799in; &quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;Table1_A1&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span>基层单位完工验收确认<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;P12&quot;</span>&gt;</span></span><br><span class="line">          签字： <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>年 <span class="symbol">&amp;nbsp;</span></span><br><span class="line">          <span class="symbol">&amp;nbsp;</span>月 <span class="symbol">&amp;nbsp;</span> 日 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>时 <span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;nbsp;</span>分</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">297</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">210</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paperHeader&quot;</span><span class="punctuation">:</span> <span class="number">49.5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paperFooter&quot;</span><span class="punctuation">:</span> <span class="number">780</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;printElements&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">175.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">10.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">27</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">259</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HiPrint自定义模块打印插件&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontSize&quot;</span><span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontWeight&quot;</span><span class="punctuation">:</span> <span class="string">&quot;600&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineHeight&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;coordinateSync&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;widthHeightSync&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;draggable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">27</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">52</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;页眉线&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">25.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">57</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">705</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fixed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;borderStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dotted&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vline&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">61.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">48</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">87</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;contain&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图片&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">64.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">39</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">276</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;二维码以及条形码均采用svg格式打印。不同打印机打印不会造成失真。图片打印：不同DPI打印可能会导致失真，&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineHeight&quot;</span><span class="punctuation">:</span> <span class="number">18</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">457.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">79.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">120</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;姓名&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;testData&quot;</span><span class="punctuation">:</span> <span class="string">&quot;古力娜扎&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#f00808&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textDecoration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;underline&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;姓名&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;性别&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gender&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;数量&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;count&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">483</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">124.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">43</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">51</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456789&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qrcode&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">285</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">130.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">34</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">175</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456789&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;barcode&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">132</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">213</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;所有打印元素都可已拖拽的方式来改变元素大小&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineHeight&quot;</span><span class="punctuation">:</span> <span class="number">18</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">189</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">238</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;单击元素，右侧可自定义元素属性&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">190.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">51</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;横线&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">415.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">190.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">164</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;可以配置各属性的默认值&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span> <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">214.5</span><span class="punctuation">,</span> <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">475.5</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;横线&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hline&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">235.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">220.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">342</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义表格：用户可左键选中表头，右键查看可操作项，操作类似Excel，双击表头单元格可进行编辑。内容：title#field&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineHeight&quot;</span><span class="punctuation">:</span> <span class="number">15</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">156</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">265.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">94</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;表头列大小可拖动&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">265.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">90</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;红色区域可拖动&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">285</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">56</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">511.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;table&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tableFooterRepeat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;id&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;姓名&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;性别&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gender&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="punctuation">&#123;</span> <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;数量&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;count&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;columns&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">102.30000000000001</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;checked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;fixed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;rowspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;colspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableColumnHeight&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableTextType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableBarcodeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CODE128A&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableQRCodeLevel&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">102.30000000000001</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;姓名&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;checked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;columnId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;fixed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;rowspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;colspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;align&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableColumnHeight&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableTextType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableBarcodeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CODE128A&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableQRCodeLevel&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableSummary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;count&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">102.30000000000001</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;数量&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;count&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;checked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;columnId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;count&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;fixed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;rowspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;colspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;align&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableColumnHeight&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableTextType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableBarcodeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CODE128A&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableQRCodeLevel&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableSummary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">102.30000000000001</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;checked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;fixed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;rowspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;colspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableColumnHeight&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableTextType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableBarcodeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CODE128A&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableQRCodeLevel&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">102.30000000000001</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;checked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;fixed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;rowspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;colspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableColumnHeight&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableTextType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableBarcodeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CODE128A&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableQRCodeLevel&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">85.25</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;性别&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gender&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;checked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;columnId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gender&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;fixed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;rowspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;colspan&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableColumnHeight&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableTextType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableBarcodeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CODE128A&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;tableQRCodeLevel&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;表格&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;table&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;editable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;columnDisplayEditable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;columnDisplayIndexEditable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;columnTitleEditable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;columnResizable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;columnAlignEditable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;isEnableEditField&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;isEnableContextMenu&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;isEnableInsertRow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;isEnableDeleteRow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;isEnableInsertColumn&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;isEnableDeleteColumn&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;isEnableMergeCell&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">346.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">61.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;装订线&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineHeight&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fixed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;contentPaddingTop&quot;</span><span class="punctuation">:</span> <span class="number">3.75</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffffff&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">225</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">355</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">346.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义模块：主要为开发人员设计，能够快速，简单，实现自己功能&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">370.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">79</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;配置项表格&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">225</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">385.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">38</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">346.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;配置模块：主要为客户使用，开发人员可以配置属性，字段，标题等，客户直接使用，配置模块请参考实例2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;微软雅黑&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;lineHeight&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#d93838&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">487.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">123</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;长文本会自动分页&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">507</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">511.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;longText&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;长文&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;longText&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">475.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">565.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;矩形&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rect&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">174</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">568.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">90</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;竖线&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span> <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">574.5</span><span class="punctuation">,</span> <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span> <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">10</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;竖线&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vline&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">210</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">604.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">120</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;横线&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">130.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">625.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">277</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;横线&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hline&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">364.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">649.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">101</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;矩形&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">525</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">784.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">63</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;页尾线&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span> <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">786</span><span class="punctuation">,</span> <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">49</span><span class="punctuation">,</span> <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">49</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;html&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;html&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">75</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">790.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">137</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;红色原型是自动定义的Html&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;left&quot;</span><span class="punctuation">:</span> <span class="number">334.5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;top&quot;</span><span class="punctuation">:</span> <span class="number">810</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">205</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;页眉线已上。页尾下以下每页都会重复打印&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;textAlign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;printElementType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自定义文本&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paperNumberLeft&quot;</span><span class="punctuation">:</span> <span class="number">565.5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paperNumberTop&quot;</span><span class="punctuation">:</span> <span class="number">819</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="BI">BI</h3><p><strong>BI产品</strong></p><ul><li>superset</li><li>smartchart</li><li>Go-View</li></ul><p>DataV:<br>vue: www.mtruning.club<br>react: <a href="https://github.com/Aaron52077/react-visual-data.git">https://github.com/Aaron52077/react-visual-data.git</a></p><ol><li><a href="https://sword.bladex.vip/#/user/login">https://sword.bladex.vip/#/user/login</a></li><li><a href="http://boot.jeecg.com/user/login">http://boot.jeecg.com/user/login</a></li><li><a href="https://power.7moor.com/login">https://power.7moor.com/login</a></li><li><a href="https://www.mingdao.com/">https://www.mingdao.com/</a></li><li><a href="https://demo-cn.nocobase.com">https://demo-cn.nocobase.com</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<p>qiankun<br>技术栈无关、聚合微应用<br>依赖协议接入：bootstrap/mount/unmount</p><p>样式隔离<br>css-module<br>沙箱机制<br>避免作用域冲突</p><p>两个系统鉴权</p><p>源代码规范 review<br>功能性：功能是否完整，有无bug<br>规范类：编码命名是否规范，未引用变量，是否有注释(Prettier、Eslint)</p><p>项目研发流程：需求对接，原型图设计，需求评审，排期计划(开发计划、测试计划、投产上线计划)</p><p>前端测试框架<br>jest</p><p>开发模式<br>瀑布：需求 → 设计 → 开发 → 测试，适用于需求比较明确、to B 端的项目。<br>敏捷：敏捷开发是一种以用户需求进化为核心、迭代、循序渐进的开发方法</p><p>软件架构：<br>底层存储 -&gt; 上层应用</p><p>核心功能点方案设计<br>系统权限<br>监控告警</p><p>sonarCube: 代码质量监测、监测代码 bug,漏洞，重复率</p><p>可视化低代码平台lowcode<br>通过拖拽方式完成可视化程序搭建<br>主流产品：<br>阿里宜搭、腾讯微搭、<br>后端：无远</p><p>v-html：造成xss 攻击<br><img onerror=alert(123) /></p><p>类型判断：<br>== 转为 number类型 再去判断是否相等<br>=== 判断类型是否严格相等(不可判断NaN===NaN、+0 === -0: <a href="http://Object.is">Object.is</a>)</p><p>三种判断数据类型的方法：<br>typeof<br>instanceof<br>Object.prototype.toString.call</p><p>Vue实例初始化时给data上的每个属性绑定一个 watcher 监听器，利用Object.defineproperty进行数据劫持、<br>当数据改变时，会触发setter，并且通过Dep.notify去通知所有订阅者Watcher，订阅者们就会调用patch方法，给真实DOM打补丁，更新对应的视图。</p><p>Vue和React都是在什么情况下更新渲染<br>Vue基于getter/setter实现的依赖收集/依赖更新的订阅式机制，决定视图需不需要更新</p><p>React则是通过函数调用来更新数据，比如setState，视图更新取决于 shouldComponentUpdate</p><p>Object.create:使用现有对象创建新的对象</p><p>VDom优点：<br>减少Dom操作</p><ol><li>减少Dom操作次数（添加1000个节点）</li><li>减少Dom操作范围（diff算法减少不必要的dom更新）<br>跨平台<br>本质是一个js对象</li></ol><p>Vue nextTick对Dom更新产生啥影响</p><ol><li>Vue异步执行DOM更新。只要观察到数据变化，Vue将开启一个队列，并缓冲在同一事件循环中发生的所有数据改变。如果同一个watcher被多次触发，只会被推入到队列中一次。</li><li>这种在缓冲时去除重复数据对于避免不必要的计算和DOM操作上非常重要。然后，在下一个的事件循环“tick”中，Vue刷新队列并执行实际 (已去重的) 工作。</li></ol><p>字面量和new关键字创建的对象是Object的实例，原型指向Object.prototype，继承内置对象Object</p><p>Object.create(arg, pro)创建的对象的原型取决于arg</p><ol><li>arg为null，新对象是空对象，没有原型，不继承任何对象；</li><li>arg为指定对象，新对象的原型指向指定对象，继承指定对象</li></ol><p>Esbuild 比 webpack 快的原因</p><ol><li>语言优势：采用go 编写，在编译阶段已转成机器码，js是先解释器解释为机器码再执行</li><li>设计优势：体现在算法和底层数据结构上</li></ol><p>jsPref: 比较函数执行耗时</p><p>sessionStorage数据共享问题：通过点击链接(或者用了 window.open)打开的新标签页之间是属于同一个 session的<br>新开一个标签页总是初始化一个新的 session，即使网站是一样的，它们也不属于同一个 session</p><p>CSRFTeser工具：<br>监测是否存在csrf漏洞</p><p>原理：拿着你的身份凭证 冒充你进行转账等操作<br>防御措施：验证HTTP Refer字段 保证客户端唯一性</p><p>Threejs</p><ol><li>渲染器 WebGLRenderer</li><li>场景scene</li><li>照相机 camera</li><li>物体 Objects<br>Mesh模型<br>Geometry 形状<br>Material 材质<br>Map 贴图<br>Texture纹理</li></ol><p>Symbol底层实现<br>Object.create(null)<br>Object.defineProperties(symbol, {<br>‘<strong>Description</strong>’: {<br>value: descString,<br>writable: false,<br>enumerable: false,<br>configurable: false<br>}<br>});</p><p>Vue和React对比：<br>相同点：</p><ol><li>组件化思想</li><li>数据驱动</li><li>基于虚拟dom/diff算法<ol><li>支持服务端渲染</li></ol></li><li>支持native方案：Vue的Weex、React的RN</li><li>都有自己的构建工具：vue-cli、create-react-app<br>不同点：</li><li>数据流：vue双向数据流、react单向数据流</li><li>数据变化实现原理不同。react使用不可变数据、vue使用可变数据</li><li>dom更新不同(vue状态更新视图自动更新，react需要调用setState来触发视图更新)</li></ol><p>immutable：不可变数据，对象的任何新增修改删除都会返回一个新的对象<br>优点：</p><ol><li>降低Mutable带来的复杂度</li><li>节省内存空间(修改哪个属性，就复制哪个属性到新的对象中，其他属性数据共享)</li><li>方便开发Undo/Redo,Copy/Paste</li><li>拥抱函数式编程<br>缺点：</li><li>容易与原生对象混</li></ol><p>promise和async 区别</p><p>优点：<br>有技术疑难点钻研记录习惯<br>领导交代的事</p><p>缺点：</p><p>发布订阅思路<br>css选择器权重</p><p>修改node_modules文件</p><ol><li>webpack alias进行文件覆盖</li><li>利用 patch-package</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h4 id="标准"><strong>标准</strong></h4><p><a href="https://tools.ietf.org/html/rfc6749">https://tools.ietf.org/html/rfc6749</a></p><h4 id="是什么"><strong>是什么</strong></h4><p>OAuth 2.0 授权框架使得第三方可以获取对用户资源的访问（有限访问或者完全访问）。</p><p>举个例子：通过你的允许，bilibili 可以去微信服务器获取你的头像，昵称，openid 等等。</p><h4 id="为什么"><strong>为什么</strong></h4><p>传统授权方式，用户和第三方共享密码。缺点如下：</p><ol><li>未来可能持续需要访问各种受限资源。所以第三方要存储用户密码，一般情况密码是明文，显然不安全。</li><li>第三方将可以访问所有的资源，而实际上它只应当有权限访问部分资源。</li><li>用户不能撤销单个第三方的访问权限。改密码，所有第三方都会失效。</li></ol><h4 id="术语"><strong>术语</strong></h4><p>案例：用户通过“微信登陆”登陆 bilibili 。</p><p>专业称呼</p><p>通俗叫法</p><p>资源所有者</p><p>用户</p><p>资源服务器</p><p>保存用户信息的服务器并且能够验证令牌是否合法（比如说，微信服务器，保存你的微信头像等）</p><p>客户端</p><p>第三方应用程序（比如说，bilibili）</p><p>授权服务器</p><p>发送令牌给第三方的服务器（可以和资源服务器是同一个）</p><h4 id="授权码模式（适用前后端分离）"><strong>授权码模式（适用前后端分离）</strong></h4><p>最常用的模式，微信、QQ、Github 登陆第三方网站就是这种模式。优点前后端分离，避免令牌泄露。</p><ol><li>哔哩哔哩提供一个“微信登陆”的链接，用户点击跳转到微信授权服务器。</li><li>用户根据微信授权服务器提示登陆微信并确认授权给哔哩哔哩。</li><li>微信授权服务器返回用户代理（浏览器）一个授权码。</li><li>用户代理（浏览器）把这个授权码传给哔哩哔哩。</li><li>哔哩哔哩凭借授权码向微信授权服务器请求令牌。</li><li>微信授权服务器发送令牌给哔哩哔哩。</li></ol><p>之后哔哩哔哩就可以带着令牌去微信资源服务器读取用户资料。</p><blockquote><p>三个问题：</p><ol><li>为什么要有授权码？</li><li>为什么要重定向？</li><li>授权码为什么不直接返回给 bilibili ？</li></ol></blockquote><h4 id="隐式模式（不推荐使用）（适合没有后台的第三方）"><strong>隐式模式（不推荐使用）（适合没有后台的第三方）</strong></h4><ol><li><p>哔哩哔哩提供一个“微信登陆”的链接，用户点击跳转到微信授权服务器。</p></li><li><p>用户根据微信授权服务器提示登陆微信并确认授权给哔哩哔哩。</p></li><li><p>微信授权服务器发送令牌给哔哩哔哩。</p><p><a href="https://weixin.com/oauth/authorize">https://weixin.com/oauth/authorize</a>?<br>response_type=token&amp;<br>client_id=123&amp;<br>redirect_uri=http://www.bilibili.com/callback&amp;<br>scope=read</p></li></ol><h4 id="密码模式（适合用户极其信任第三方）"><strong>密码模式（适合用户极其信任第三方）</strong></h4><ol><li><p>哔哩哔哩使用用户给的微信登陆账号和密码直接向微信授权服务器索要令牌。</p></li><li><p>微信授权服务器发送令牌给哔哩哔哩。</p><p><a href="https://weixin.com/token">https://weixin.com/token</a>?<br>grant_type=password&amp;<br>username=张三&amp;<br>password=123456&amp;<br>client_id=123</p></li></ol><h4 id="客户端模式（适合没有前端的第三方，整个过程没有用户参与）"><strong>客户端模式（适合没有前端的第三方，整个过程没有用户参与）</strong></h4><ol><li><p>哔哩哔哩向微信授权服务器请求令牌。</p></li><li><p>微信授权服务器发送令牌给哔哩哔哩。</p><p><a href="https://weixin.com/token">https://weixin.com/token</a>?<br>grant_type=client_credentials&amp;<br>client_id=123&amp;<br>client_secret=xxxxx</p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h1>Passport OAuth 2.0 Service</h1><blockquote><h4 id="通过网络CDN引用passport-js">通过网络CDN引用passport.js</h4></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;Passport服务地址&gt;/passport.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><h5 id="使用">使用</h5></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 初始化Passport系统</span></span><br><span class="line"><span class="title class_">Passport</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;/passport&#x27;</span>,</span><br><span class="line">  <span class="attr">client_id</span>: <span class="string">&#x27;webapp-dashboard&#x27;</span>,</span><br><span class="line">  <span class="attr">redirect_uri</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">  <span class="attr">authorize</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>配置项</strong></p><table><thead><tr><th>配置项</th><th>类型</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td>protocol</td><td>string</td><td>协议</td><td>默认为 http。</td></tr><tr><td>host</td><td>string</td><td>Passport服务地址</td><td><strong>必填</strong>，默认为 passport。</td></tr><tr><td>client_id</td><td>string</td><td>发起认证的应用名称</td><td><strong>必填</strong>，由系统发放的client_id。</td></tr><tr><td>redirect_uri</td><td>string</td><td>认证完成回跳地址</td><td><strong>必填</strong>，默认为 空。</td></tr><tr><td>authorize</td><td>boolean</td><td>是否立即跳转Passport认证授权</td><td>默认为 false</td></tr></tbody></table><p><strong>方法</strong></p><blockquote><p><strong>UID()   返回domain下当前登录的用户id</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Passport</span>.<span class="title function_">UID</span>() </span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>Authorize()   返回Passport动态生成的认证API地址</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Passport</span>.<span class="title class_">Authorize</span>()</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>GrantCode()   返回授权码 authorize_code</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Passport</span>.<span class="title class_">GrantCode</span>()</span><br></pre></td></tr></table></figure></blockquote><p><img src="./images/oAuth2.0-service.jpg" alt="service"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h3 id="BI-Business-Intelligence">BI(Business Intelligence)</h3><ul><li>为商业提供一切智能化操作，判断与管理的手段</li><li>应用案例<ul><li>推荐： “啤酒与尿布” 有意放置一起，提高两者销量</li></ul></li></ul><p><img src="./images/structure.jpeg" alt="架构"></p><blockquote><p>(整个图中所有负责技术实现的人，都可以叫做数据人(Data Engineer)；更精确的从 ETL 往右开始称为 BI 人；更细化些， 实现 ETL 的称为 ETL 工程师， Data Warehouse 的模型设计者称为数据模型工程师（Data Modeler ), 负责可视化设计的叫做 BI Reporter</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="technology-architecture">technology architecture</h2><p>终端(client)：<br>client 发出日志<br>日志采集服务：<br>log collect server<br>通道：<br>kafka(topic)<br>flume(source、channel、sink)<br>缓冲：<br>hdfs<br>数据分析统计：<br>hive<br>分析统计结果存储：<br>mysql<br>展现：<br>web Application</p><p>flume 将数据下沉至 hdfs</p><h2 id="hive-创建分区表">hive 创建分区表</h2><p>create external table ext_startup_logs(<br>createdAtMs bigInt,<br>appId string,<br>tenantId string,<br>deviceId string,<br>appVersion string,<br>appChannel string,<br>appPlatform string,<br>osType string,<br>deviceStyle string,<br>errorBrief string,<br>errorDetail string<br>)PARTITIONED BY(<br>ym string,<br>day string,<br>hm string<br>)ROW FROMAT SERDE ‘org.openx.data.jsonserde.JsonSerDe’ STORED AS TEXTFILE;</p><h2 id="hdfsToHive-sh-每分钟将-hdfs-中数据向-hive-导入一份"><a href="http://hdfsToHive.sh">hdfsToHive.sh</a> 每分钟将 hdfs 中数据向 hive 导入一份</h2><h2 id="crontab-调度-分、小时、天、月、星期">crontab 调度(分、小时、天、月、星期)</h2><ul><li><ul><li><ul><li><ul><li><ul><li>source /etc/profile;<br>/opt/module/shell/hdfsToHive.sh</li></ul></li></ul></li></ul></li></ul></li></ul><h2 id="hive-UDF-函数">hive UDF 函数</h2><pre><code>便于查询、分析</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="sc-textFile-与-sc-wholeTextFiles-区别">sc.textFile 与 sc.wholeTextFiles 区别</h2><blockquote><p>sc.textFile(path)<br>textFile.collect()<br>[‘’, ‘hello world’]</p></blockquote><blockquote><p>textFiles = sc.wholeTextFiles(dirPath)<br>sorted(textFiles.collect())<br>[<br>(‘…/1.txt’,‘1’),<br>(‘…/2.txt’,‘2’)<br>]<br>[(key, val)]<br>key: 文件路径<br>val: 文件内容<br>注意：Each file is read as a single record</p></blockquote><p>eg:<br>from cp_analysis.clean.DataClean import printData, printDataPartition<br>dataRdd = sc.wholeTextFiles(‘hdfs://192.168.1.12:9000/clean/TD_FIRSTPAGE/part-r-*’)</p><p>dataRdd.foreach(printData)<br>dataRdd.foreachPartition(printDataPartitiion)</p><p>def printData(x):<br>print x[0]<br>for line in x[1].split(‘\n’):<br>print line</p><p>def printDataPartition(data):<br>for x in data:<br>print x[0]<br>print ‘--------------’<br>print x[1]</p><h2 id="区别：">区别：</h2><p>textFile设计初衷读大文件，它能读多个文件是因为map输出会输出多个文件<br>wholeTextFiles 设计读多级多目录的小文件，所以读文件不划分行，直接读成文本字符串</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="hadoop-yarn">hadoop yarn</h2><p>client    <br>1个 resourceManager(RN)n 个 NodeManager(NM)<br>1个 ApplicationMastern 个 Container(资源申请单元和任务运行的容器)</p><p>launching spark on yarn<br>$./bin/spark-submit<br>–class org.apache.spark.examples.SparkPi<br>–master yarn-cluster<br>–num-executors 3<br>–driver-memory 4g<br>–executor-cores 1<br>–queue thequeue<br>lib/spark-examples*.jar</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="变量定义">变量定义</h2><p>var、val</p><h2 id="数据类型-不区分基本类型、都是class-可直接调用相应方法">数据类型(不区分基本类型、都是class,可直接调用相应方法)</h2><p>Byte、Short、Int、Long、Float、Double、Boolean、Char<br>(BigInt)</p><h2 id="操作符重载-Apply-包导入">操作符重载 &amp; Apply &amp; 包导入</h2><p>1.+(3)  =&gt;   4    # + 是方法名称(把操作符重载为方法名)<br>1 to 10 =&gt; Range  # to<br>无 <code>++</code> 该操作符<br>“hello”(4)  =&gt; “hello”.apply(4)  =&gt; o<br>import scala.math._<br>sqrt(2), min(12, 32)</p><h2 id="scala-流程控制结构与函数">scala 流程控制结构与函数</h2><p>var a = if(true) 1 else ()  # class Unit,写作()  不换行写法</p><h2 id="shell-下粘贴代码">shell 下粘贴代码</h2><p>:paste / ctrl + k<br>eg:<br>var r = {<br>val x = 10<br>val b = 20<br>val c = “Hello World”<br>c;<br>};<br>r = “Hello World”</p><p>从命令行读取输入<br>val name = readLine(“your name”)</p><h2 id="循环-Loop">循环(Loop)</h2><ol><li>无 for(;;) 语句</li><li>无 break、continue 语句</li></ol><h2 id="var-n-Int-0-while-n-10-println-“hello”-n-1-to-闭区间-until-左闭右开区间-for-n-1-to-10-println-n-for-ch-“hello”-println-ch-高级循环">var n:Int = 0;<br>while(n &lt; 10) {<br>println(“hello”);<br>n+=1;<br>}<br>to: 闭区间 / until(左闭右开区间[ )<br>for(n &lt;- 1 to 10){<br>println(n);<br>}<br>for(ch &lt;- “hello”) println(ch)<br>高级循环</h2><p>for(i &lt;- 1 to 3; j &lt;- 1 to 3;if(i != j)) println(i * j)<br>for(i &lt;- 1 to 3; j &lt;- i to 3) println(i * j)</p><h2 id="函数-名称-参数-函数体-必须指定参数名称">函数(名称 &amp; 参数 &amp; 函数体 * 必须指定参数名称)</h2><h2 id="与方法区别：方法是在对象上备注：-最后的表达式是函数返回值def-fac-n-Int-var-r-1for-i-1-to-10-r-r-ir-递归函数必须指定返回值类型def-fac-n-Int-Int-if-n-0-1-else-n-fac-n-1-默认参数和命名参数">与方法区别：方法是在对象上<br>备注： 最后的表达式是函数返回值<br>def fac(n:Int) = {<br>var r = 1<br>for(i &lt;- 1 to 10) r = r * i<br>r<br>}<br>递归函数必须指定返回值类型<br>def fac(n:Int):Int = {<br>if(n &lt;= 0) 1 else n*fac(n -1)<br>}<br>默认参数和命名参数</h2><p>def prefixStr(str:String, left:String=“【”, right:String=“】”):String = left + str + right<br>prefixStr(“Hello World”)<br>prefixStr(left=“Hi”, str=“Hello World”, right=“!”)</p><h2 id="变长参数">变长参数</h2><p>def sum(args:Int*) = {<br>var r = 0;<br>for(arg &lt;- args) r +=arg<br>r<br>}<br>val s1 = sum(1,2,3,4,5)=&gt; 15<br>val s2 = sum(1 to 5:_*)=&gt; 15</p><hr><p>var str = MessageFormat.format(“the a to {0} is {1}”, “xxx”, 42.asInstanceOf[AnyRef])<br>备注: 调用变长参数的对象方法时，需要手动转换类型</p><h2 id="过程-Procedures">过程(Procedures)</h2><p>特点：无返回值<br>def box(s:String){<br>val border = “-”*s.length<br>println(border + “【” + s + “】” + border)<br>}<br>box(“Hello World”)</p><hr><h2 id="Lazy-Values">Lazy Values</h2><p>定义： 延迟初始化变量值直到首次被访问<br>lazy val i = 100<br>lazy val words = scala.io.Source.formFile(“x”).mkString</p><hr><h2 id="Exception">Exception</h2><p>try{<br>2/0<br>}catch{<br>case _:MalformedURLException =&gt; println(MalformedURLException) // 不对该异常做出处理<br>case ex:IOException =&gt; ex.printStackTrace()<br>}finally{<br>prilnt(“Error !”)<br>}</p><h2 id="数组">数组</h2><p>val nums = new Array<a href="2">String</a> // 元素为 null<br>println(nums.length)<br>val s = Array(“Hello”, “World”)<br>for(k &lt;- s) prilnt(k)</p><h2 id="ArrayBuffer-变长数组-数组缓冲区">ArrayBuffer 变长数组(数组缓冲区)</h2><p>import scala.collection.mutable.ArrayBuffer<br>val b = ArrayBuffer<a href="">Int</a><br>b+=1// 添加一个元素<br>b+=(1,2,3)// 追加多个元素<br>b++=Array(6,5,4)// ++= 追加任何集合<br>println(b)=&gt; ArrayBuffer(1, 1, 2, 3, 6, 5, 4)</p><p>// : 是前导操作，否则是后导操作<br>val buf = ArrayBuffer<a href="">Int</a><br>buf += 1 // (1)<br>buf.+=(3)// 1,3<br>buf.+=:(4)// 4,1,3<br>buf++=Array(5,6,7) // ArrayBuffer(4, 1, 3, 5, 6, 7)<br>for(k &lt;- buf) println(k)<br>buf.trimEnd(3)// 移除后3位<br>buf.insert(2,8,9) // 在索引为2元素前追加元素<br>buf.remove(2) // 移除索引为2元素</p><p>var arr = buf.toArray  =&gt; Array[Int] = Array(4, 1, 9, 3) // 将数组缓冲区变作数组<br>var buf = arr.toBuffer</p><p>for(i &lt;- 0 until buf.length) println(buf(i))<br>for(i &lt;- (0 until buf.length).reverse) println(buf(i))  // 3, 9, 1, 4</p><p>var a = Array<a href="2,3,4">Int</a><br>产生新的数组<br>for(i &lt;- a) yield i<em>2<br>for(i &lt;- a if i%2 ==0) yield 2</em>i</p><h2 id="数组变换">数组变换</h2><p>a.filter(<em>%2 ==0).map(</em>*2)<br>常见算法<br>Array(1,2,3).sum<br>ArrayBuffer(“a”,“b”).max=&gt; “b”<br>val b = Array(1,2,3,4).toBuffer.sorted(<em>&lt;</em>)  =&gt; 升序 shell 下有问题(待解决)</p><h2 id="数组快排序var-c-Array-8-4-5-scala-util-Sorting-quickSort©c-mkString-“and”-“4and5and8”多维数组var-cc-Array-ofDimInt-Array-Array-Int-cc-2-0-for-r-cc-for-c-r-println©-数组缓冲区-ArrayBuffer">数组快排序<br>var c = Array(8,4,5)<br>scala.util.Sorting.quickSort©<br>c.mkString(“and”)=&gt; “4and5and8”<br>多维数组<br>var cc = Array.ofDim<a href="3,4">Int</a>=&gt; Array[Array[Int]]<br>cc(2)(0)<br>for(r &lt;- cc){<br>for(c &lt;- r){<br>println©<br>}<br>}<br>数组缓冲区 ArrayBuffer</h2><p>var buf = new Array<a href="10">Int</a>.toBuffer<br>buf.append(1,2,3)</p><p>import scala.collection.mutable.ArrayBuffer<br>var buf = new ArrayBuffer<a href="">AnyVal</a> // 不能实例化原因：<br>buf.appendAll(“abc”)<br>val arr = new Array<a href="5">Int</a><br>buf.appendAll(arr)=&gt; scala.collection.mutable.ArrayBuffer[AnyVal] = ArrayBuffer(a, b, c, 0, 0, 0, 0, 0)</p><p>buf.count(_ == 0) // 5<br>buf.count(_ == 1) // 1<br>buf+=6 //<br>buf-=6</p><p>var arr = new Array<a href="5">Any</a><br>var buf =</p><h2 id="var-buf-ArrayBufferIntbuf-1-操作符重载buf-2-后置增加buf-3-前置添加buf-Array-1-2-3-该操作符下可添加集合数组缓冲区操作符重载全解析">var buf = ArrayBuffer<a href="">Int</a><br>buf+=1       // 操作符重载<br>buf.+=(2)    // 后置增加<br>buf.+=:(3)   // 前置添加<br>buf.++=:(Array(1,2,3)) // 该操作符下可添加集合<br>数组缓冲区操作符重载全解析</h2><ul><li></li></ul><h2 id="：">++<br>++：<br>++=<br>++=:<br>+:<br>+=<br>+=:</h2><h2 id="––-规律总结：">–<br>–=<br>-=<br>/:<br>:+<br>:<br>规律总结：</h2><ul><li><pre><code>  // 操作一个值</code></pre></li></ul><p>++// 集合，数组(产生新的buf,源buf保持不变)<br>=// 修改源缓冲区，否则源缓冲区不变，生成新的buf<br>:// 以:结尾通常前导操作，否则末尾添加</p><ul><li><pre><code>  // 除去一个</code></pre></li></ul><p>++=// 集合，数组(产生新的buf,源buf发生变化)<br>–// 移除某个集合，源buf保持不变<br>–=// 移除某个集合，数组(产生新的buf,源buf发生变化)<br>+：// 产生新的buf，不对源缓冲区修改<br>-：// 产生新的buf，不对源缓冲区修改<br>::: // 合并两个 List</p><h2 id="Map">Map</h2><ol><li>java.util.Map<br>java.util.HashMap<br>java.util.TreeMap</li><li>var map = Map(“001”-&gt;“tom”,“002”-&gt;“tomas”,“003”-&gt;“tomasLeee”)// scala 不可变</li><li>var map = Map((“001”,“tom”),(“002”,“tomas”),(“003”,“tomasLeee”))// scala 不可变</li><li>var map = collection.mutable.Map(“001”-&gt;“tom”,“002”-&gt;“tomas”,“003”-&gt;“tomasLeee”)// scala 可变</li><li>map(“001”)//get</li><li>map.contais(“001”)// 判断是否存在</li><li>map.getOrElse(“001”,“nobody”)// 组合</li><li>map(“001”) = “xxx”// 赋值</li><li>map2 - “001”// 支持 -</li></ol><p>// 迭代<br>for((k,v) &lt;- map) println(k + “–” + v)</p><p>// java<br>map.keySet()// key 集合<br>map.values()// value 集合</p><p>// 排序<br>import scala.collection.immutable.SortedMap</p><hr><h2 id="Tuple-最多支持22个元素">Tuple(最多支持22个元素)</h2><p>val t: Tuple3[Int, String, Double] = (1, “tom”, 89.5)<br>t._1   // 访问内部元素</p><p>“New York”.partition(_.isUpper)=&gt; (“NY”, “ew ork”)</p><h2 id="zip">zip</h2><p>通过两个 Array 耦合 Tuple<br>val a = Array(“&lt;”,“-”,“&gt;”)<br>val b = Array(2,10,4)<br>val pair = a.zip(b)<br>for((s,n) &lt;- pair) Console.print(s*n)=&gt;  Array[(String, Int)] = Array((&lt;,2), (-,10), (&gt;,4))</p><h2 id="java-scala-互操作">java  &amp; scala 互操作</h2><ol><li><p>import scala.collection.JavaConversions.bufferAsJavaList</p></li><li><p>var cmd = ArrayBuffer(“ls”, “-al”, “/home/ubuntu”)</p></li><li><p>var pb = new ProcessBuilder(cmd)=&gt; pb.command: java.util.List[String] = [ls, -al, /home/ubuntu]</p></li><li><p>import scala.collection.JavaConversions.asScalaBuffer</p></li><li><p>import scala.collection.mutable.Buffer</p></li><li><p>var rr:Buffer[String] = pb.command=&gt; rr: scala.collection.mutable.Buffer[String] = ArrayBuffer(ls, -al, /home/ubuntu)</p></li><li><p>import scala.collection.JavaConversions.mapAsScalaMap</p></li><li><p>var m = scala.collection.mutable.Map[String,String] = new TreeMap[String,String]</p></li></ol><h2 id="class">class</h2><ol><li><p>class Counter {<br>private var value = 0<br>def setValue(newValue:Int) = value += 1<br>def getValue():Int = value<br>}</p><p>var c = new Counter<br>c.setValue(3)// 3<br>c.getValue// 0<br>备注：</p><ol><li>字段必须初始化(自动生成公有 setter/getter 方法，val 只生成 getter 方法，设置private 则setter/getter 也为私有的，设置 private[this]无 setter/getter)</li><li>setter【value_=()/value_$eq()】、getter【value】</li></ol></li><li><p>shell 下加载并编译某个class<br>:load /home/ubuntu/Cat.scala</p></li><li><p>class Dog{<br>private[this] var age = 0// 不需要getter/setter 则设置 private[this]<br>def addOne() = (age += 1)<br>def compare(b:Dog) = (age &lt; b.getAge)<br>def getAge() = age<br>}</p><p>var d1 = new Dog<br>d1.addOne()<br>var d2 = new Dog<br>d2.addOne()<br>d2.addOne()<br>d1.compare(d2)<br>备注: 不需要 getter/setter 则将 用 private[this] 修饰 value</p></li><li><p>BeanProperties<br>作用： 自动为修饰的字段生成 setter/getter<br>import scala.beans.BeanProperty</p></li><li><p>构造器<br>class Person{  // (…) 为`主构造器<br>private var name = “”<br>private var age = 0</p><pre><code> def this(name: String) &#123;  // 辅助构造器 this()// 调用主构造器 this.name = name &#125;  def this(name: String, age: Int) &#123;  // 辅助构造器 this.name = name this.age = age &#125;  def description = name + &quot;is&quot; + age + &quot;岁&quot;</code></pre><p>}<br>主构造器<br>class Person(val name: String = “a”, val age: Int = 0) {  // (…) 为`主构造器<br>def description = name + “is” + age + “岁”<br>}<br>备注：</p><ol><li>构造器参数被编译为字段 - 构造器 - setter/getter(参数未被 var/val 声明则被忽略)</li></ol></li><li><p>嵌套类(内部类)<br>class Car{<br>class Engine{<br>def fire = println(“fire!!”)<br>}<br>def run() = {<br>var engine = new Engine<br>engine.fire<br>println(“run…”)<br>}<br>}<br>var car = new Car<br>car.run()</p></li></ol><h2 id="对象-Object">对象(Object)</h2><p>作用： 补充scala 中无静态方法(属性)的缺陷<br>1.<br>object Box{<br>var color = “black”<br>def getColor = “yellow”<br>}<br>编译后:<br>public final class Box {<br>public static void color_$eq(java.lang.String);<br>public static java.lang.String getColor();<br>public static java.lang.String color();<br>}</p><h2 id="伴生对象">伴生对象</h2><p>作用: 使用包含实例方法、静态方法的类<br>class + object(与class同名)</p><pre><code>import scala.beans.BeanPropertyclass BenzCar&#123;@BeanProperty var color = &quot;yellow&quot;def getBrand = BenzCar.brand&#125;object BenzCar&#123;var brand = &quot;Benz&quot;&#125;var bz = new BenzCarbz.getBrand</code></pre><h2 id="scala-应用程序">scala 应用程序</h2><p>object Box {<br>def main(args:Array[String]){ // main 函数为静态方法<br>println(“Hello World”)<br>}<br>}</p><h2 id="枚举">枚举</h2><h2 id="包-package-作用域">包(package) &amp; 作用域</h2><pre><code>package com &#123;package test1&#123;object Utils&#123;def hello(name:String) = println(name)&#125;package impatient &#123;class Employee&#123;def getHelloWorld() = Utils.hello(&quot;Hello World&quot;)   // 作用域共享&#125;&#125;&#125;&#125;产生包类package com.jiahao &#123;package object myScala &#123;val name = &quot;Hello World&quot;def main(args:Array[String])&#123;println(name)&#125;&#125;package myScala&#123;class Dog&#123;&#125;&#125;&#125;包可见性: 没有被声明为 public、private或protected 的类成员在包含该类的包中可见引入: </code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="endpoint-接口设计规范">endpoint 接口设计规范</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="GraphQL">GraphQL</h2><p>特点：<br>a. 请求需要的数据，不多不少<br>b. 获取多个资源，只用一个请求<br>c. 描述所有可能类型的系统，便于维护，根据需求平滑演进，添加或隐藏字段【用类型区分资源】</p><h2 id="基本数据类型">基本数据类型</h2><p>a. String, Int, Float, Boolean, ID ,可以在定义 schema 时直接使用<br>b. [类型]代表数组， 例如： [Int] 代表整型数组</p><h2 id="参数传递">参数传递</h2><p>a. 和 js参数传递一样， 小括号内定义形参，但是注意：参数需要定义类型<br>b. !(叹号)代表参数不能为空<br>type Query {<br>rollDice(numDice: Int, numSides: Int): [Int]<br>}</p><ol><li>允许用户自定义参数，用来描述要获取的资源的属性</li><li>查询使用 query， 修改数据使用 Mutation</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/posts/0.html"/>
      <url>/posts/0.html</url>
      
        <content type="html"><![CDATA[<h2 id="restful-接口设计规范">restful 接口设计规范</h2><ul><li>每一个网址都是一个资源【由名词组成】</li><li>每个请求仅能获取一种资源</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">eg:</span><br><span class="line">学校 - 老师 - 班级 - 学生</span><br><span class="line">https:<span class="regexp">//</span>api.example.com<span class="regexp">/v1/</span>school/teachers</span><br><span class="line"></span><br><span class="line">GET         <span class="regexp">/school/</span>teachers：列出所有老师</span><br><span class="line">POST        <span class="regexp">/school/</span>teachers：新增一名老师</span><br><span class="line">GET         <span class="regexp">/school/</span>teachers/ID：获取某个老师的信息</span><br><span class="line">PUT         <span class="regexp">/school/</span>teachers/ID：更新某个老师的信息（提供该老师的全部信息）</span><br><span class="line">PATCH       <span class="regexp">/school/</span>teachers/ID：更新某个老师的信息（提供该老师的部分信息）</span><br><span class="line">DELETE      <span class="regexp">/school/</span>teachers/ID：删除某个老师</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>打印设计器</title>
      <link href="/posts/c6b436bf.html"/>
      <url>/posts/c6b436bf.html</url>
      
        <content type="html"><![CDATA[<h3 id="js动态合并table指定表格列、行">js动态合并table指定表格列、行</h3><p>1.合并指定表格列</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @ function：合并指定表格列（表格id为table_id）指定列（列数为table_colnum）的相同文本的相邻单元格</span></span><br><span class="line"><span class="comment">* @ param：table_id 为需要进行合并单元格的表格的id。如在HTMl中指定表格 id=&quot;data&quot; ，此参数应为 #data </span></span><br><span class="line"><span class="comment">* @ param：table_colnum 为需要合并单元格的所在列。为数字，从最左边第一列为1开始算起。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">table_rowspan</span>(<span class="params">table_id, table_colnum</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> table_firsttd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> table_currenttd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> table_SpanNum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> table_Obj = $(table_id + <span class="string">&quot; tr td:nth-child(&quot;</span> + table_colnum + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">    table_Obj.<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">i</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">            table_firsttd = $(<span class="variable language_">this</span>);</span><br><span class="line">            table_SpanNum = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            table_currenttd = $(<span class="variable language_">this</span>);</span><br><span class="line">            <span class="keyword">if</span> (table_firsttd.<span class="title function_">text</span>() == table_currenttd.<span class="title function_">text</span>()) &#123; <span class="comment">//这边注意不是val（）属性，而是text（）属性</span></span><br><span class="line">                <span class="comment">//td内容为空的不合并</span></span><br><span class="line">                <span class="keyword">if</span>(table_firsttd.<span class="title function_">text</span>() !=<span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                    table_SpanNum++;</span><br><span class="line">                    table_currenttd.<span class="title function_">hide</span>(); <span class="comment">//remove();</span></span><br><span class="line">                    table_firsttd.<span class="title function_">attr</span>(<span class="string">&quot;rowSpan&quot;</span>, table_SpanNum);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                table_firsttd = $(<span class="variable language_">this</span>);</span><br><span class="line">                table_SpanNum = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>合并指定表格行</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @ function：合并指定表格行（表格id为table_id）指定行（行数为table_rownum）的相同文本的相邻单元格</span></span><br><span class="line"><span class="comment">* @ param：table_id 为需要进行合并单元格的表格id。如在HTMl中指定表格 id=&quot;data&quot; ，此参数应为 #data </span></span><br><span class="line"><span class="comment">* @ param：table_rownum 为需要合并单元格的所在行。其参数形式请参考jquery中nth-child的参数。</span></span><br><span class="line"><span class="comment">          如果为数字，则从最左边第一行为1开始算起。</span></span><br><span class="line"><span class="comment">          &quot;even&quot; 表示偶数行</span></span><br><span class="line"><span class="comment">          &quot;odd&quot; 表示奇数行</span></span><br><span class="line"><span class="comment">          &quot;3n+1&quot; 表示的行数为1、4、7、10.......</span></span><br><span class="line"><span class="comment">* @ param：table_maxcolnum 为指定行中单元格对应的最大列数，列数大于这个数值的单元格将不进行比较合并。</span></span><br><span class="line"><span class="comment">          此参数可以为空，为空则指定行的所有单元格要进行比较合并。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">table_colspan</span>(<span class="params">table_id, table_rownum, table_maxcolnum</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (table_maxcolnum == <span class="keyword">void</span> <span class="number">0</span>) &#123; table_maxcolnum = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">var</span> table_firsttd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> table_currenttd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> table_SpanNum = <span class="number">0</span>;</span><br><span class="line">    $(table_id + <span class="string">&quot; tr:nth-child(&quot;</span> + table_rownum + <span class="string">&quot;)&quot;</span>).<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">i</span>) &#123;</span><br><span class="line">        table_Obj = $(<span class="variable language_">this</span>).<span class="title function_">children</span>();</span><br><span class="line">        table_Obj.<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">i</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                table_firsttd = $(<span class="variable language_">this</span>);</span><br><span class="line">                table_SpanNum = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((table_maxcolnum &gt; <span class="number">0</span>) &amp;&amp; (i &gt; table_maxcolnum)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                table_currenttd = $(<span class="variable language_">this</span>);</span><br><span class="line">                <span class="keyword">if</span> (table_firsttd.<span class="title function_">text</span>() == table_currenttd.<span class="title function_">text</span>()) &#123;</span><br><span class="line">                    <span class="comment">//td内容为空的不合并</span></span><br><span class="line">                    <span class="keyword">if</span> (table_firsttd.<span class="title function_">text</span>() !=<span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                    table_SpanNum++;</span><br><span class="line">                    table_currenttd.<span class="title function_">hide</span>(); <span class="comment">//remove();</span></span><br><span class="line">                    table_firsttd.<span class="title function_">attr</span>(<span class="string">&quot;colSpan&quot;</span>, table_SpanNum);</span><br><span class="line">                    table_firsttd.<span class="title function_">attr</span>(<span class="string">&quot;style&quot;</span>, <span class="string">&quot;text-align:center&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    table_firsttd = $(<span class="variable language_">this</span>);</span><br><span class="line">                    table_SpanNum = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 报表设计器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DSL 概念</title>
      <link href="/posts/81de5707.html"/>
      <url>/posts/81de5707.html</url>
      
        <content type="html"><![CDATA[<h3 id="DSL">DSL</h3><p>DSL 全称为 Domain Specific Language，译为领域特定语言，即一种为特定领域所设计的编程语言。可以简单的理解为设计 DSL 就是设计一套语法来描述一系列的相关行为。抽象到比较低级的层面，C++、JavaScript 就是机器指令集的 DSL；在比较高级的层面举例的话，markdown 就是文档编写的 DSL，sql 语句就是数据库查询的 DSL。为什么不直接用机器指令编写代码，而要使用高级语言如 C++ 等，就是因为高级语言对于开发者的门槛更低，更容易上手，更有迹可循。究其原因，DSL 是为人类设计的，而指令是为机器设计的。此外 DSL 需要在特定的环境下运行。</p><p>内部 DSL 和外部 DSL<br>下面通过一个简单的例子来说明内部 DSL 和外部 DSL 的区别。我们要怎么描述两个星期前这一个时间呢。很容易想到以下三种解法：</p><p>解法一：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span> * <span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>解法二：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 weeks ago</span><br></pre></td></tr></table></figure><p>解法三：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(2).weeks().ago();</span><br></pre></td></tr></table></figure><p>第一种是标准的 js 代码，可以直接在浏览器就能跑出结果<br>第二种像是一种自然语言 [外部DSL]<br>第三种类似一种伪代码[内部DSL]<br>DSL 需要在特定的环境下运行。</p><p>DSL 比编程语言更加直观，而外部 DSL 又比内部 DSL 更加直观。</p><p>为什么有外部 DSL 和内部 DSL 的区别呢？外部 DSL 可以理解为是一门独立的语言，比如解法二，你为了让它能够正常运行，就必须编写一套编译器来支持它运行。而对于内部 DSL（解法三），你可以利用拓展现有的语言环境来支持这种语法，比如说我只要在 js 注入这段逻辑就可以让解法三运行出结果了。受限于语言环境，内部 DSL 的语法也看起来比较别扭，需要遵循宿主语言的语法规则。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">weeks</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span> * <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">ago</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>什么场景用 DSL</strong><br>DSL 的设计与开发也是有一定的成本的，那么什么时候需要用 DSL 呢？概括性的总结就是，</p><p>当用户不是系统的开发者，但又需要定制逻辑的时候，就需要一门 DSL。</p><p>比如问卷的定制，再比如数据库的自定义查询。展开来说，如果一件事情有大量的重复，需要频繁的进行多方的沟通，需要很多的 GUI 操作，那么你就有可能需要一门 DSL。</p><p>e.g. 一份问卷 DSL</p><p>这是一份用研提出的问卷需求</p><blockquote><p>这份问卷是这样的，首先会在第一题询问有没有发烧，如果选择了没有发烧，就直接跳转到结束页；然后如果选择了有， 显示第二题。第二题询问体温多少度，如果体温低于 37 度也 跳转到结束页…</p></blockquote><p>然后我们提取出逻辑相关的内容</p><blockquote><p>第一题：选择了没有发烧，跳转到结束页<br>选择了有，显示第二题<br>如果体温低于 37 度，跳转到结束页</p></blockquote><p>转成伪代码表述</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> Q1A1 <span class="keyword">then</span> branch <span class="keyword">to</span> <span class="keyword">END</span></span><br><span class="line"><span class="keyword">if</span> Q1A2 <span class="keyword">then</span> <span class="keyword">show</span> Q2</span><br><span class="line"><span class="keyword">if</span> Q2A &lt; <span class="number">37</span> <span class="keyword">then</span> branch <span class="keyword">to</span> <span class="keyword">END</span></span><br></pre></td></tr></table></figure><p>稍微整理一下，你就可以设计出一套问卷 DSL 语法了</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> Q1A2 then <span class="keyword">show</span> Q2</span><br><span class="line"><span class="keyword">if</span> Q2A <span class="keyword">gt</span> <span class="number">37</span> then <span class="keyword">show</span> Q3</span><br></pre></td></tr></table></figure><p><strong>设计你的 DSL</strong><br>高级语言转机器指令需要经过一系列过程：</p><blockquote><p>词法分析 -&gt; 语法分析 -&gt; 语义分析 -&gt; 生成抽象语法树 -&gt; 中间代码 -&gt; 优化 -&gt; 目标代码</p></blockquote><p><img src="/assets/images/dsl/transformer.png" alt="transformer.png"></p><p>生成 DSL 解析器的解析器生成器，利用它们，我们可以快速地设计实现自己的 DSL 而不需要熟读编译原理。比较流行的有 PEG.js 和 jison。</p><p><strong>采用pegjs实现上述问卷</strong><br>1、安装引入 npm 包 npm i pegjs</p><p>2、遵循 pegjs 规则设计语法</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const grammar = `</span><br><span class="line">/* 定义输入的语法格式，这里为 <span class="built_in">if</span> xxx then xxx */</span><br><span class="line">Start</span><br><span class="line">= &#x27;<span class="built_in">if</span>&#x27; _ e<span class="symbol">xp:Ex</span>pression _ &#x27;then&#x27; _ <span class="symbol">op:Op</span>eration &#123;</span><br><span class="line">  /* 返回一个 输入为所有题目，输出为过滤后的题目 的函数 */</span><br><span class="line">  return new Function(&#x27;questions&#x27;, &#x27;const result = [questions[<span class="number">0</span>]];&#x27; +</span><br><span class="line">  &#x27;<span class="built_in">if</span>(&#x27; + <span class="built_in">exp</span> + &#x27;)&#x27; + op + &#x27;return result;&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 定义Expression类型如何翻译 */</span><br><span class="line">Expression <span class="string">&quot;expression&quot;</span></span><br><span class="line">= &#x27;Q&#x27;<span class="symbol">q:</span>[<span class="number">0</span>-<span class="number">9</span>]&#x27;A&#x27;<span class="symbol">a:</span>[<span class="number">0</span>-<span class="number">9</span>] &#123;</span><br><span class="line">  return &#x27;questions[&#x27; + q + &#x27;-<span class="number">1</span>].answer === &#x27; + a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 定义Operation类型如何翻译 */</span><br><span class="line">Operation <span class="string">&quot;operation&quot;</span></span><br><span class="line">= &#x27;show Q&#x27;<span class="symbol">q:</span>[<span class="number">0</span>-<span class="number">9</span>] &#123;</span><br><span class="line">  return &#x27;&#123;result.push(questions[&#x27;+ q + &#x27;-<span class="number">1</span>]);&#125;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 定义 _ 如何翻译 */</span><br><span class="line">_ <span class="string">&quot;whitespace&quot;</span></span><br><span class="line">= &#x27; &#x27;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure><p>3、parser = pegjs.generate(grammar) 生成 DSL 编译器</p><p>4、然后就可以使用 parser.parse 来对输入 DSL 进行解析生成对应的逻辑处理函数啦</p>]]></content>
      
      
      <categories>
          
          <category> DSL </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Form-Generator</title>
      <link href="/posts/6876ba2.html"/>
      <url>/posts/6876ba2.html</url>
      
        <content type="html"><![CDATA[<p><strong>fr-generator表单设计器</strong></p><ul><li><p>右侧面板表单配置项 [defaultGlobalSetting]</p></li><li><p>右侧面板组件公共配置项 [defaultCommonSettings]</p></li><li><p>左侧 widgets 定义 [defaultSetting]</p><ul><li>渲染左侧面板 widget</li><li>widget setting 进行合并</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&#x27;下拉框&#x27;</span>,    <span class="comment">// widget 标题</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;select&#x27;</span>,   <span class="comment">// widget key</span></span><br><span class="line">  <span class="attr">schema</span>: &#123;         <span class="comment">// 确定画布组件渲染</span></span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;单选&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">    <span class="attr">enum</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>],</span><br><span class="line">    <span class="attr">enumNames</span>: [<span class="string">&#x27;早&#x27;</span>, <span class="string">&#x27;中&#x27;</span>, <span class="string">&#x27;晚&#x27;</span>],</span><br><span class="line">    <span class="attr">widget</span>: <span class="string">&#x27;select&#x27;</span>,      </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">setting</span>: &#123;           <span class="comment">// 组件属性、业务功能配置</span></span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;选项&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">      labelWidth,</span><br><span class="line">      <span class="attr">properties</span>: &#123;</span><br><span class="line">        allowClear,</span><br><span class="line">        addonBefore,</span><br><span class="line">        addonAfter,</span><br><span class="line">        prefix,</span><br><span class="line">        suffix,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    minLength,</span><br><span class="line">    <span class="attr">pattern</span>: &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;校验正则表达式&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;array&#x27;</span>,</span><br><span class="line">      <span class="attr">widget</span>: <span class="title class_">CustomWidgetsTypes</span>.<span class="property">mdRegexpSelect</span> <span class="comment">// 上层 props 自动注入</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>fr-generator</strong></p><ol><li><p>右侧配置项 怎么渲染？</p><ul><li><p>展开 defaultSetting 并取出所有 widget</p></li><li><p>根据选中项从 widgets 中 过滤 对应 setting 配置项</p></li><li><p>再组合 commonSetting 形成新的 schema</p></li><li><p>右侧表单 schema 由commonSetting + defaultSetting[选中组件的setting] 组成</p></li><li><p>右侧表单 widgets 由fr-generator默认widget及用户传入的settingsWidgets 组成</p></li></ul></li><li><p>右侧配置项变更<br>- 影响兄弟表单项 值回填或 UI变化【onItemChange： 用于本组件修改其他组件的值】<br>- props?.addons?.formData -&gt; 所有表单项的值<br>- table：<br>- select: 右侧新增 options 配置按钮</p><ul><li><p>如何影响其它组件 schema 及 value [以CustomInput为例]<br>- 在 被联动组件 schema 中通过 dependencies 声明依赖关系<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const &#123; dependValues, setSchemaByPath &#125; = props?.addons;</span><br><span class="line">use<span class="constructor">Effect(()</span> =&gt; &#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span>: 拉取数据 更新 enums</span></span><br><span class="line">set<span class="constructor">ValueByPath(<span class="params">key</span>, <span class="params">value</span>)</span>    <span class="comment">// 等同于 onItemChange</span></span><br><span class="line">set<span class="constructor">SchemaByPath()</span></span><br><span class="line">&#125;, <span class="literal">[<span class="identifier">dependValues</span>]</span>)</span><br></pre></td></tr></table></figure></p><pre><code>  - 在联动组件 onChange   <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setSchemaByPath</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>  - 通过 setValueByPath 来设置联动组件的值  - 通过 setSchemaByPath 更新联动组件 schema【如 enums】  <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- props.addons.on<span class="constructor">ItemChange(&#x27;<span class="params">rules</span>&#x27;, [<span class="params">regObj</span>])</span>;</span><br><span class="line">- props.addons.on<span class="constructor">ItemChange(&#x27;<span class="params">pattern</span>&#x27;, <span class="params">regObj</span>)</span>;</span><br></pre></td></tr></table></figure></code></pre><ul><li>如何影响画布 formData<ul><li>props.onChange(name, value)</li></ul>  <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span>: 对应 <span class="keyword">default</span> 字段</span><br><span class="line">description：对应 description</span><br><span class="line">displayType：值为 <span class="keyword">row</span> 和 <span class="keyword">column</span>，用于处理在横竖模式下组件显示不同的情况</span><br><span class="line">disabled：对应 ui:<span class="keyword">disable</span></span><br><span class="line">hidden：对应 ui:hidden</span><br><span class="line"><span class="type">name</span>：对应 title 字段</span><br><span class="line">onChange：函数，接收 <span class="type">name</span>/<span class="keyword">value</span> 两个入参，调用可修改 formData 里对应名字字段的值（见下例）</span><br><span class="line"><span class="keyword">options</span>：对应 ui:<span class="keyword">options</span> 字段，所有的其他字段没有 cover 到的参数都建议放在 <span class="keyword">options</span> 里</span><br><span class="line">readOnly：对应 ui:readonly 字段</span><br><span class="line">required：组件是否是必填的</span><br><span class="line">rootValue：组件对应键值对所在的 data 树从父级开始的所有值</span><br><span class="line"><span class="keyword">schema</span>：组件对应的子 <span class="keyword">schema</span></span><br><span class="line"><span class="keyword">value</span>：组件的值</span><br><span class="line">addons: &#123;</span><br><span class="line">onItemChange: 用于在本组件内修改其他组件的值 onItemChange(<span class="type">path</span>, <span class="keyword">value</span>)</span><br><span class="line">getValue: 获取表单当前的数据 formData</span><br><span class="line">setValue: 用于在本组件内修改其他组件的值 setValue(<span class="keyword">value</span>, <span class="type">path</span>)</span><br><span class="line">setErrorFields: form 方法透传给自定义组件使用，自定义 error</span><br><span class="line">removeErrorField: form 方法透传给自定义组件使用，删除所有 error</span><br><span class="line">setSchema: form 方法透传给自定义组件使用，修改 <span class="keyword">schema</span></span><br><span class="line">resetFields: form 方法透传给自定义组件使用，重置清空整个表单</span><br><span class="line">dataPath: 目前数据所在的 <span class="type">path</span>，例如&quot;a.b[2].c[0].d&quot;，string 类型</span><br><span class="line">dataIndex: 如果 dataPath 不包含数组，则为 [], 如果 dataPath 包含数组，例如&quot;a.b[2].c[0].d&quot;，则为 [<span class="number">2</span>,<span class="number">0</span>]。是自上到下所有经过的数组的 <span class="keyword">index</span> 按顺序存放的一个数组类型</span><br><span class="line">&#125;</span><br><span class="line">typePorps: <span class="keyword">select</span>等绑定<span class="keyword">options</span>时自定义组件对应的类型，对应内置组件四个，暂时保留，后续如果四组件有特殊要求基于该字段扩展补充</span><br><span class="line">comType: <span class="keyword">select</span>等相关组件，需要区分单选和多选</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>Asyncoptions</p></li></ol><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 通过schema中 selectType 标识拉取接口</span><br><span class="line">eg: SimpleSelect</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 通过<span class="keyword">dependencies</span> 依赖项获取新的<span class="keyword">options</span></span><br></pre></td></tr></table></figure><ol start="4"><li><p>为啥 mrTable 中未获取到 addons ?</p></li><li><p>runtime 时获取表单项绑定的数据</p></li></ol><ul><li>根据schema中字段的数据绑定 组装API查询参数</li></ul><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">dataBind</span> （字段的数据绑定）</span><br><span class="line"><span class="title">formDataBind</span> (表单的数据绑定)</span><br><span class="line"><span class="title">enumDataBind</span> (下拉、选项的数据绑定)</span><br><span class="line"></span><br><span class="line">拼装的数据结构如下：</span><br><span class="line">&#123;</span><br><span class="line">id, <span class="class"><span class="keyword">type</span>, <span class="keyword">data</span>, field, isTable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>获取远程接口数据、依次给对应表单项赋值</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">设置表单项值</span><br><span class="line"><span class="selector-tag">form</span><span class="selector-class">.setValues</span>()</span><br><span class="line">设置表单项 <span class="built_in">schema</span>(enum/enumName)</span><br><span class="line"><span class="selector-tag">form</span><span class="selector-class">.setSchemaByPath</span>()</span><br></pre></td></tr></table></figure><ol start="6"><li>组装表单联动项</li></ol><ul><li>根据 schema中 dataLink字段组合要联动的字段</li><li>根据 condition及action 动态设置schema及formData</li></ul><pre><code>被关联字段的 显示隐藏、options 重新赋值</code></pre>]]></content>
      
      
      <categories>
          
          <category> 表单设计器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>x-render</title>
      <link href="/posts/916335d9.html"/>
      <url>/posts/916335d9.html</url>
      
        <content type="html"><![CDATA[<h3 id="Form-Render">Form-Render</h3><p><strong>内置组件</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">＃输入类</span><br><span class="line">输入框 <span class="selector-tag">input</span></span><br><span class="line">多行输入框 <span class="selector-tag">textarea</span></span><br><span class="line">数字输入框 number </span><br><span class="line">链接输入框 url </span><br><span class="line">图片输入框 imagelnput </span><br><span class="line"></span><br><span class="line">＃日期类</span><br><span class="line">日期组件 date</span><br><span class="line">时间组件 <span class="selector-tag">time</span> </span><br><span class="line">日期范围 doteRange </span><br><span class="line">时间范围 timeRange </span><br><span class="line"></span><br><span class="line">＃选择类</span><br><span class="line">是否选择 checkbox </span><br><span class="line">下拉单选 select </span><br><span class="line">点击单选 rodio </span><br><span class="line">下拉多选框 mu1t1Select</span><br><span class="line">点击多选框 checkboxes </span><br><span class="line">树形选择 treeselect </span><br><span class="line"></span><br><span class="line">＃其他</span><br><span class="line">颜色选择 <span class="attribute">color</span> </span><br><span class="line">上传组件 upload </span><br><span class="line">文本（只读展示）<span class="selector-tag">html</span> </span><br><span class="line">滑动输入条 slider </span><br><span class="line">五星评分 rate </span><br><span class="line"></span><br><span class="line">＃结构类</span><br><span class="line">对象 map </span><br><span class="line">列表 cardList / simpleList / tableList / drawerList / visualList</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>高级用法</strong></p><ol><li>表单联动 (比如勾选某个表单项触发显示或隐藏出另一个)</li></ol><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">expression表达式 </span></span><br><span class="line"><span class="language-xml">  - 控制 UI显示隐藏</span></span><br><span class="line"><span class="language-xml">    - &#x27;ui:hidden&#x27;: &#x27;</span><span class="template-variable">&#123;&#123;<span class="name">formData.select</span> === <span class="string">&quot;b&quot;</span>&#125;&#125;</span><span class="language-xml">&#x27;</span></span><br><span class="line"><span class="language-xml">    - &#x27;ui:disabled&#x27;: &#x27;</span><span class="template-variable">&#123;&#123;<span class="name">rootValue.input1.length</span> &gt; <span class="number">5</span>&#125;&#125;</span><span class="language-xml">&#x27;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">watch</span></span><br><span class="line"><span class="language-xml">  - 类似 vue watch</span></span><br><span class="line"><span class="language-xml">  </span></span><br><span class="line"><span class="language-xml">dependencies</span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure><ol start="2"><li>自定义组件（widget）</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">要有 value/onChange props</span><br><span class="line">schema 中通过 widget/ui:widget 指定 自定义组件</span><br><span class="line">form 中 通过 widget进行组件注入</span><br></pre></td></tr></table></figure><ol start="3"><li><p>覆盖默认组件（mapping）</p></li><li><p>表单方法（form）跟antd from方法一样获取值，校验值，设置值</p></li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><ol start="5"><li>表单监听（watch）</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><ol start="6"><li>生命周期 (加载 - 提交)</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><ol start="7"><li>列表的展示</li></ol><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">cardList:</span> 卡片类型，用于展示数量不太多但结构复杂的 list</span><br><span class="line"><span class="symbol">simpleList:</span> 用于展示每行只有 <span class="number">1</span>-<span class="number">3</span> 个简单元素的情况</span><br><span class="line"><span class="symbol">tableList:</span> 用于展示每行只有 <span class="number">3</span> - n 个简单元素的情况，特别是数据量很大需要分页的</span><br><span class="line"><span class="symbol">tabList:</span> 用于展示可新增/关闭页签的 Tabs 标签页</span><br><span class="line"><span class="symbol">virtualList:</span> 在展示上与 <span class="comment">&#x27;tableList&#x27; 基本相同，但以虚拟滚动替代了传统的分页</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="8"><li><p>展示的最佳实践 设置标签宽度/位置</p></li><li><p>Rules 定制化校验</p></li></ol><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 支持 async-validator 所有的 api</span><br><span class="line"><span class="number">2.</span> <span class="keyword">Form</span>-render 为常用规则提供了语法糖，如：<span class="keyword">type</span>，<span class="keyword">format</span>，<span class="built_in">min</span>，<span class="built_in">max</span>，required等。可通过 validateMessages 定制校验文案</span><br></pre></td></tr></table></figure><p><strong>渲染态疑问</strong></p><ol><li>远程数据如何获取<ul><li>全局数据</li><li>组件数据</li></ul></li></ol>  <figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataBind</span><br><span class="line">enumDataBind</span><br><span class="line">formDataBind</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span></span><br><span class="line">enumNames</span><br><span class="line"></span><br><span class="line">通过 <span class="keyword">schema</span> 组装表单项 远程查询条件 进行数据查询</span><br><span class="line">设置表单项 enumNames、<span class="keyword">enum</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><p>schema 渲染时异步数据如何获取</p></li><li><p>schema 渲染后 表单如何进行联动</p> <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">watch </span><br><span class="line">- <span class="selector-tag">form</span><span class="selector-class">.setValueByPath</span></span><br><span class="line">- <span class="selector-tag">form</span><span class="selector-class">.setSchemaByPath</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><p><strong>form-render 实现思路</strong></p><ol><li><p>自定义组件、重写映射关系[mapping]</p></li><li><p>setting中针对每个组件自定义配置项(解决组件联动)</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span>. settingsWidgets</span><br></pre></td></tr></table></figure></li><li><p>Schema 数据解析，获取需要远程数据拉取接口传参、动态组装 watch 监听组件联动</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span>. 如何确定调用的接口名称</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 表单设计器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Formily</title>
      <link href="/posts/aedca35f.html"/>
      <url>/posts/aedca35f.html</url>
      
        <content type="html"><![CDATA[<h3 id="Formily">Formily</h3><p><strong>核心概念</strong></p><ul><li>@formily/core</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">内核库: 管理表单的状态，表单校验，联动等等</span></span><br></pre></td></tr></table></figure><ul><li>@formily/react</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">UI桥接库: 来接入内核数据，用来实现最终的表单交互效果</span></span><br></pre></td></tr></table></figure><ul><li>@formily/antd</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">组件库: </span></span><br></pre></td></tr></table></figure><p>yarn workspace @designable/formily-antd start</p><p><strong>联动</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> dataSourceType: &#123;</span><br><span class="line">  &quot;type&quot;: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;数据源&quot;</span>,</span><br><span class="line">  <span class="string">&quot;x-decorator&quot;</span>: <span class="string">&quot;FormItem&quot;</span>,</span><br><span class="line">  <span class="string">&quot;x-component&quot;</span>: <span class="string">&quot;Select&quot;</span>,</span><br><span class="line">  <span class="string">&quot;enum&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">          &quot;<span class="selector-tag">label</span>&quot;: <span class="string">&quot;api接口&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;apiUrl&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">          &quot;<span class="selector-tag">label</span>&quot;: <span class="string">&quot;json数据&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;jsonData&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;x-component-props&quot;: &#123;</span><br><span class="line">      defaultValue: <span class="string">&#x27;apiUrls&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line">apiUrl: &#123;</span><br><span class="line">  type: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">  title: <span class="string">&quot;api接口地址&quot;</span>,</span><br><span class="line">  <span class="string">&quot;x-decorator&quot;</span>: <span class="string">&quot;FormItem&quot;</span>,</span><br><span class="line">  <span class="string">&quot;x-component&quot;</span>: <span class="string">&quot;Input&quot;</span>,</span><br><span class="line">  <span class="string">&quot;x-reactions&quot;</span>: &#123;</span><br><span class="line">    &quot;fulfill&quot;: &#123;</span><br><span class="line">      &quot;state&quot;: &#123;</span><br><span class="line">        &quot;visible&quot;: <span class="string">&quot;&#123;&#123;$form.values[&#x27;x-component-props&#x27;][&#x27;dataSourceType&#x27;] == &#x27;apiUrl&#x27; &#125;&#125;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>基于schema 实现formily组件</strong></p><blockquote><p>参考 validatorSetter [@formily/setters]</p></blockquote><ol><li>实现 value/onChange 接口</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IValidatorSetterProps</span> &#123;</span><br><span class="line">  value?: <span class="built_in">any</span></span><br><span class="line">  onChange?: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>操作后，自定组件给所属 key 赋值</li></ol><p><strong>在弹窗给自定义组件回填数据</strong></p><p>表单设计器：</p><ol><li>通过(按钮+弹窗)配置表单项，具体数据来源（将x-render功能模块迁移过来）</li><li>弹窗中仅需实现 value/onChange 即可给对应字段赋值</li><li>自定义formily组件、再合成为designable工程左侧物料</li><li>根据react-setting-form中自定义formily组件及effect 最佳实践</li><li>如何根据字段绑定参数获取 datasource ？？？</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">form</span><span class="selector-class">.addEffect</span>(<span class="string">&#x27;id&#x27;</span>, <span class="selector-tag">form</span> =&gt; void)</span><br><span class="line"><span class="selector-tag">form</span><span class="selector-class">.removeEffects</span>(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 effects 中修改 Field 的 dataSource，也可以在 reactions 中修改 dataSource 属性</span></span><br></pre></td></tr></table></figure><p>Address 永远是代表节点的绝对路径，Path 是会跳过 VoidField 的节点路径<br>Field.query(path)</p><p>Field.setValue()</p><p>state.dataSource = ?<br>Field.setDataSource()</p><ul><li>扩展自定义组件 AsyncOptions，组件的属性配置中可以移除“响应器”，增加“api 传参配置”</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;enumDataBind&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;dataSourceMethod&quot;</span>: <span class="string">&quot;thirdDataBase&quot;</span>,</span><br><span class="line">  <span class="string">&quot;appId&quot;</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="string">&quot;appInterId&quot;</span>: <span class="number">122</span>,</span><br><span class="line">  <span class="string">&quot;label&quot;</span>: <span class="string">&quot;categoryName&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: <span class="string">&quot;categoryId&quot;</span>,</span><br><span class="line">  <span class="string">&quot;queryConditions&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>自定义按钮</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">渲染态</span><br><span class="line">遍历字段列表、渲染表单元素</span><br><span class="line"><span class="selector-tag">Form</span><span class="selector-class">.setValues</span> 设置表单项值</span><br><span class="line"></span><br><span class="line">根据按钮类型执行预设的业务逻辑</span><br></pre></td></tr></table></figure><ul><li>如何根据 api传参 拉取数据?</li></ul><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据组件ID + 组件绑定参数 + 组件类型 -&gt; 统一接口 查询dataSource</span><br></pre></td></tr></table></figure><ul><li>如何根据 linked传参 设置组件联动逻辑？</li></ul><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 获取条件字段</span><br><span class="line"><span class="number">2.</span> 获取联动效果(每个联动项在满足指定条件时，设置被联动字段状态：显示隐藏、是否必填、是否启用、数据状态等)</span><br><span class="line"><span class="number">3.</span> 更新数据联动到<span class="built_in">schema</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义组件往form注入副作用</span></span><br><span class="line">useFormEffects(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  onFieldReact(<span class="string">&#x27;*&#x27;</span>, field =&gt; <span class="keyword">void</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="2"><li>运行态表单项实现联动</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">左侧实现自定义业务组件</span><br><span class="line">右侧面板新增字段依赖项，给自定义组件配置 dependencies</span><br><span class="line"><span class="bullet">1.</span> 控制兄弟表单项显示隐藏</span><br><span class="line"><span class="bullet">2.</span> 设置其他表单项value 或 datasource</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>表单视图配置：</p><ol><li>条件</li><li>操作按钮（标识与逻辑 Mapping）</li></ol><p><strong>疑问点</strong></p><ol><li>formily 组件 preview-text 是干啥的？</li><li>渲染态 组装 effect</li></ol>]]></content>
      
      
      <categories>
          
          <category> 表单设计器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Designable 工程结构</title>
      <link href="/posts/fcfae6e9.html"/>
      <url>/posts/fcfae6e9.html</url>
      
        <content type="html"><![CDATA[<h4 id="Designable-工程结构">Designable 工程结构</h4><blockquote><p>设计器引擎：基础表单的搭建和配置能力</p></blockquote><p><strong>目录结构</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── CHANGELOG.md<span class="regexp">//</span> 更新日志</span><br><span class="line">├── README.md<span class="regexp">//</span> 工程文档</span><br><span class="line">├── examples                          <span class="regexp">//</span> 演示工程文件夹</span><br><span class="line">│   ├── basic<span class="regexp">//</span> designable基础工程，没有组件和属性可以配置。</span><br><span class="line">│   ├── multi-workspace<span class="regexp">//</span> 多个展示区的designable</span><br><span class="line">│   ├── sandbox<span class="regexp">//</span> 对应basic的沙箱工程</span><br><span class="line">│   └── sandbox-multi-workspace<span class="regexp">//</span> 对应multi-workspace的沙箱工程</span><br><span class="line">├── formily                           <span class="regexp">//</span> 基于formily生态完成designable工程的必备模块</span><br><span class="line">│   ├── antd<span class="regexp">//</span> 适配了designable的antd组件库，相当于designable的物料，即左侧“组件区”。</span><br><span class="line">│   ├── <span class="keyword">next</span><span class="regexp">//</span> 适配了designable的Fusion组件库，相当于designable的物料，即左侧“组件区”。</span><br><span class="line">│   ├── setters<span class="regexp">//</span> 右侧“属性设置”自定义组件[对应npm包@designable/formily-setters]</span><br><span class="line">│   └── transformer<span class="regexp">//</span> 做“TreeNode与Schema格式互转”的模块[对应npm包@designable/formily-transformer]</span><br><span class="line">├── jest.config.js</span><br><span class="line">├── lerna.json<span class="regexp">//</span> 多包管理lerna的配置文件</span><br><span class="line">├── package.json<span class="regexp">//</span> 工程描述</span><br><span class="line">├── packages<span class="regexp">//</span> 被lerna做多包管理的npm包</span><br><span class="line">│   ├── core                          <span class="regexp">//</span> 类似@formily/core，包含拖拽能力、扩展事件等</span><br><span class="line">│   ├── react                         <span class="regexp">//</span> 设计器Studio组件库</span><br><span class="line">│   ├── react-sandbox                 <span class="regexp">//</span> 负责 iframe拖拽类型</span><br><span class="line">│   ├── react-settings-form           <span class="regexp">//</span> 渲染右侧配置面板及自定义formily组件包</span><br><span class="line">│   └── shared                        <span class="regexp">//</span> </span><br><span class="line">├── scripts<span class="regexp">//</span> 工程级别的通用js</span><br><span class="line">│   ├── build-style<span class="regexp">//</span> 发布样式，从src目录下copy到esm和lib目录下。</span><br><span class="line">│   ├── global.ts<span class="regexp">//</span> 全局变量的配置（目前看来只有下面的jest.base.js在用）</span><br><span class="line">│   ├── jest.base.js<span class="regexp">//</span> 单元测试工具jest的配置（目前看来工程没有完善单元测试）</span><br><span class="line">│   ├── release<span class="regexp">//</span> 根据git提交记录，生成工程的修改日志，也就是工程根目录下的CHANGELOG.md文件</span><br><span class="line">│   ├── rollup.base.js<span class="regexp">//</span> 工程使用rollup做构建，类似webpack</span><br><span class="line">│   └── validate-commit-msg.js<span class="regexp">//</span> git提交时会执行此js做日志规范检查</span><br><span class="line">├── tsconfig.build.json<span class="regexp">//</span> 在build时使用的typescript配置</span><br><span class="line">├── tsconfig.jest.json<span class="regexp">//</span> 用jest时使用的typescript配置</span><br><span class="line">└── tsconfig.json<span class="regexp">//</span> 开发时使用的typescript配置</span><br></pre></td></tr></table></figure><h3 id="package-json">package.json</h3><blockquote><p>通过 package.json 文件可以看到工程依赖、yarn的workspaces配置、npm脚本等信息</p></blockquote><p><strong>script</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bootstrap&quot;</span>: <span class="string">&quot;lerna bootstrap&quot;</span>,</span><br><span class="line">    <span class="string">&quot;clean&quot;</span>: <span class="string">&quot;lerna clean&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;rimraf -rf packages/*/&#123;lib,esm&#125; &amp;&amp; lerna run build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build:docs&quot;</span>: <span class="string">&quot;dumi build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;dumi dev&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start:playground&quot;</span>: <span class="string">&quot;npm run start:basic&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start:basic&quot;</span>: <span class="string">&quot;yarn workspace @designable/basic-example start&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start:sandbox&quot;</span>: <span class="string">&quot;yarn workspace @designable/sandbox-example start&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start:multi-workspace&quot;</span>: <span class="string">&quot;yarn workspace @designable/multi-workspace-example start&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start:sandbox-multi-workspace&quot;</span>: <span class="string">&quot;yarn workspace @designable/sandbox-multi-workspace-example start&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;jest --coverage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test:watch&quot;</span>: <span class="string">&quot;jest --watch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test:prod&quot;</span>: <span class="string">&quot;jest --coverage --silent&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preversion&quot;</span>: <span class="string">&quot;npm run build &amp;&amp; npm run lint&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;ts-node scripts/release changelog &amp;&amp; git add -A&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version:alpha&quot;</span>: <span class="string">&quot;lerna version prerelease --preid alpha&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version:beta&quot;</span>: <span class="string">&quot;lerna version prerelease --preid beta&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version:rc&quot;</span>: <span class="string">&quot;lerna version prerelease --preid rc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version:patch&quot;</span>: <span class="string">&quot;lerna version patch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version:minor&quot;</span>: <span class="string">&quot;lerna version minor&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version:preminor&quot;</span>: <span class="string">&quot;lerna version preminor --preid beta&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version:major&quot;</span>: <span class="string">&quot;lerna version major&quot;</span>,</span><br><span class="line">    <span class="string">&quot;release:github&quot;</span>: <span class="string">&quot;ts-node scripts/release release&quot;</span>,</span><br><span class="line">    <span class="string">&quot;release:force&quot;</span>: <span class="string">&quot;lerna publish from-package --yes&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prelease:force&quot;</span>: <span class="string">&quot;lerna publish from-package --yes --dist-tag next&quot;</span>,</span><br><span class="line">    <span class="string">&quot;release&quot;</span>: <span class="string">&quot;lerna publish&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prelease&quot;</span>: <span class="string">&quot;lerna publish --dist-tag next&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;eslint --ext .ts,.tsx,.js  --fix&quot;</span>,</span><br><span class="line">    <span class="string">&quot;postinstall&quot;</span>: <span class="string">&quot;opencollective-postinstall&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本解释</span></span><br><span class="line">* bootstrap给被lerna管理的npm包，也就是packages目录里几个工程，一次性安装各自的依赖。</span><br><span class="line">* clean与bootstrap相反，清理各工程的node_modules。</span><br><span class="line">* buildbuild出被lerna管理的npm包的结果，放在各自的lib和esm目录下，分别是对应cjs和esm两种格式。</span><br><span class="line">* build:docs生成工程主页，构建结果在工程根目录的dist文件夹里。（建议对照下面的<span class="literal">start</span>阅读）</span><br><span class="line">* <span class="literal">start</span>运行工程本身，也就是工程主页。它是基于dumi制作的，内容就是README.md的内容。</span><br><span class="line">* <span class="literal">start</span>:*这里的*对应examples文件夹下的<span class="number">4</span>个工程，使用这个命令可以快速运行这<span class="number">4</span>个演示工程。</span><br><span class="line">* test*目前的test脚本似乎并没有相关的代码，仅体现了可以用jest做单元测试</span><br><span class="line">* preversion发版前运行一下这个脚本可以触发各依赖包的build和eslint检查。因为是pre开头，所以它会在执行下面的npm run <span class="keyword">version</span>前先触发。</span><br><span class="line">* <span class="keyword">version</span>根据git提交记录，生成工程的修改日志，也就是工程根目录下的CHANGELOG.md文件</span><br><span class="line">* <span class="keyword">version</span>:*对各个模块进行版本迭代。具体来说是，标识出在上一个 <span class="keyword">tag</span> <span class="title">版本以来更新的 monorepo</span> package，然后为这些包 prompt 出版本，在用户完成选择之后修改相关包的版本信息并且将相关的变动 commit 然后打上 <span class="keyword">tag</span> <span class="title">推送到 git</span> remote。本质上是为一些发生变动的包进行了一个 bump <span class="keyword">version</span> 的操作。</span><br><span class="line">* release*还有prelease都是发版相关脚本</span><br><span class="line">* linteslint代码检查以及fix。</span><br><span class="line">* opencollective-postinstall运行本脚本会看到工程的众筹信息，但是package.json中并没有配置collective字段，因此暂无内容。</span><br></pre></td></tr></table></figure><p><strong>workspace</strong></p><blockquote><p>Yarn进行包管理，管理了如下三个workspaces</p></blockquote><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;workspaces&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;packages/*&quot;</span>,</span><br><span class="line">  <span class="string">&quot;formily/*&quot;</span>,</span><br><span class="line">  <span class="string">&quot;examples/*&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>lint-staged</strong></p><blockquote><p>因为安装了lint-staged模块，因此可以配合ghooks，在git commit时触发lint-staged字段里的配置。</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;*.&#123;ts,tsx,js&#125;&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;eslint --ext .ts,.tsx,.js --fix&quot;</span>,  <span class="regexp">//</span> eslint格式校验与修复</span><br><span class="line">    <span class="string">&quot;pretty-quick --staged&quot;</span>,            <span class="regexp">//</span> 代码风格调整</span><br><span class="line">    <span class="string">&quot;git add&quot;</span>                           <span class="regexp">//</span> 代码预提交</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;*.md&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;pretty-quick --staged&quot;</span>,</span><br><span class="line">    <span class="string">&quot;git add&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>config</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;ghooks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pre-commit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lint-staged&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commit-msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node ./scripts/validate-commit-msg.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;commitizen&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./node_modules/cz-conventional-changelog&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li>ghooks开启了git hook，使用git的commit命令时会触发前面lint-staged字段配置的规则，以及通过scripts/validate-commit-msg.js对提交日志规范做检查。</li><li>cz-conventional-changelog配合使用npm install -g commitizen全局安装的commitizen可以很方便的创建符合提交规范的日志（如下图）。</li></ul><p><img src="/assets/images/formily/commitizen.png" alt="commitizen.png"></p><p><strong>启动方式</strong></p><ul><li>yarn install</li><li>yarn build</li><li>yarn workspace @formily/designable-antd start</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  Designer, <span class="regexp">//</span>设计器根组件，主要用于下发上下文</span><br><span class="line">  DesignerToolsWidget, <span class="regexp">//</span>画板工具挂件</span><br><span class="line">  ViewToolsWidget, <span class="regexp">//</span>视图切换工具挂件</span><br><span class="line">  Workspace, <span class="regexp">//</span>工作区组件，核心组件，用于管理工作区内的拖拽行为，树节点数据等等...</span><br><span class="line">  OutlineTreeWidget, <span class="regexp">//</span>大纲树组件，它会自动识别当前工作区，展示出工作区内树节点</span><br><span class="line">  ResourceWidget, <span class="regexp">//</span>拖拽源挂件</span><br><span class="line">  HistoryWidget, <span class="regexp">//</span>历史记录挂件</span><br><span class="line">  StudioPanel, <span class="regexp">//</span>主布局面板</span><br><span class="line">  CompositePanel, <span class="regexp">//</span>左侧组合布局面板</span><br><span class="line">  WorkspacePanel, <span class="regexp">//</span>工作区布局面板</span><br><span class="line">  ToolbarPanel, <span class="regexp">//</span>工具栏布局面板</span><br><span class="line">  ViewportPanel, <span class="regexp">//</span>视口布局面板</span><br><span class="line">  ViewPanel, <span class="regexp">//</span>视图布局面板</span><br><span class="line">  SettingsPanel, <span class="regexp">//</span>右侧配置表单布局面板</span><br><span class="line">  ComponentTreeWidget, <span class="regexp">//</span>组件树渲染器</span><br><span class="line">&#125; from <span class="string">&#x27;@designable/react&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>疑问</strong></p><ol><li>右侧面板-自定义组件 异步数据源如何定义</li></ol>]]></content>
      
      
      <categories>
          
          <category> 表单设计器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>代码提交规范</title>
      <link href="/posts/daf1ccf3.html"/>
      <url>/posts/daf1ccf3.html</url>
      
        <content type="html"><![CDATA[<h3 id="designable代码提交规范">designable代码提交规范</h3><blockquote><p>designable工程使用cz-conventional-changelog模块和scripts/validate-commit-msg.js文件做了代码提交日志的规范</p></blockquote><p><strong>cz-conventional-changelog</strong></p><ul><li><p>要使用cz-conventional-changelog，需使用npm install -g commitizen全局安装 <a href="https://zj-git-guide.readthedocs.io/zh_CN/latest/message/%5BCommitizen%5D%E4%BF%A1%E6%81%AF%E4%BA%A4%E4%BA%92%E5%B7%A5%E5%85%B7/">commitizen</a></p></li><li><p>package.json 进行配置</p></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;commitizen&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./node_modules/cz-conventional-changelog&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>就可以实现git cz代替git commit的效果。</p><p>这么做的好处是，执行命令后，会依次询问：</p><ul><li>这次提交的类型，比如fix、new feature、improvement还是其它。（单选，如下图）</li><li>这次修改的影响范围有多大：是全局的、还是只是针对个别组件。（字符串类型，可以随意输入）</li><li>简要描述修改了什么，最好是一句话，相当于修改标题。（字符串类型，可以随意输入）</li><li>详细描述修改了什么，最好分段描述，相当于内容区（字符串类型，可以随意输入）</li><li>是否有突破性变化（布尔类型，输入y或者n）</li><li>这个改变是否会造成不良影响（布尔类型，输入y或者n），如果是则还会再询问你具体的影响是什么，通常填写禅道或其它bug管理平台的bugId。</li></ul><p>最终提交的日志是符合<a href="https://docs.google.com/document/d/1rk04jEuGfk9kYzfqCuOlPTSJw3hEDZJTBN5E5f1SALo/edit">谷歌日志提交规范</a></p><p><img src="../images/commitizen.png" alt="commitizen"></p><p><strong>validate-commit-msg.js</strong></p><p>由于工程引入<a href="https://www.npmjs.com/package/ghooks">ghooks</a>模块，开启了git hook，因此在git提交时总会触发eslint以及scripts/validate-commit-msg.js的代码提交日志规范的校验。</p><p>之所以在有cz-conventional-changelog的情况下，还做日志规范校验是因为总有人会有意或无意地使用git commit做代码提交。</p>]]></content>
      
      
      <categories>
          
          <category> 表单设计器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>qunit</title>
      <link href="/posts/ff6fed2d.html"/>
      <url>/posts/ff6fed2d.html</url>
      
        <content type="html"><![CDATA[<h3 id="软件测试">软件测试</h3><ul><li>广义：每次启动即可看成一次 <code>软件测试</code></li><li>狭义：定义软件的规格，定义软件的边界条件，书写测试用例，编写自动化测试代码或者以文档形式写出软件操作步骤，并交于专人验证开发人员提交的程序是否符合规格定义</li><li>验证软件行为是否符合需求的行为</li></ul><p>敏捷开发<br>• QUnit框架简单方便，测试界面直观详细，建议优先选择QUnit框架，当然Jasmine也是个不错的选择<br>• 如果需要进行自动化测试，JsTestDriver和Jasmine都很好的支持自动化测试<br>QUnit框架<br>环境配置：<br>下载QUnit—&gt;引入qunit.css/qunit.js</p><p>QUnit使用方法<br>QUnit的用法比较简单，API不是很多，所有的API也就16个左右。所有的API可以分为三类：Setup，Assertions，Asynchronous Testing，下面就分别对这些API做些介绍，约定：凡是用[]包起来的参数表示可选参数。<br>Setup:<br>• test( name, [expected], test )，代表QUnit中的一个测试，就是没添加一个测试就调用一次test()，name参数是要测试的名称，比如”加法函数”或”add”等，expected参数是可选参数，用来表示该测试函数的断言的数量，是个正整数，test参数是一个函数对象，所有的测试代码都应该包括在该函数里，通常这是一个匿名函数。例如：test(“add function”, 1, function() {equal(add(1, 2), 3);});<br>• asyncTest( name, [expected], test ),代表QUnit中的一个异步测试，这个会在异步测试中，参数同上一个test( name, expected, test )<br>• expect( amount ),用在测试函数中，用于声明测试断言的数量，这个函数和test( name, expected, test )的expected参数的作用是一样的，两个用一个即可，当然都不用也没有关系。主要作用就是检查你声明的个数和你写的断言的实际个数是否一致。<br>• module( name, [lifecycle] )，这个函数主要用于测试函数的分组，你可以理解一个module函数是一个模块的意思，比如module(“validate”)表示后面的测试用例都是alidate相关的代码，或者module(“common.js”)，表明后面的测试用例都是common.js里面的代码，如何划分看个人理解啦，一个测试文件是可以写多个module的。name参数是分组或者模块的名称，lifecycle是可选参数，它是一个对象类型，可以设置setup和teardown回调函数，例如module(“common.js”, {setup:function(){},teardown: function() {} })，setup回调函数将会在module开始之前执行，比如可以为该module下面的测试代码做一些准备工作，teardown回调函数将会在该module的所有测试代码执行后执行，比如做一些清理还原工作等。<br>• QUnit.init( )，用于初始化QUnit测试框架，通常这个函数是不需要我们手工调用的。<br>• QUnit.reset( )，重设函数，通常是在每个test函数执行后由QUnit自己调用来重设整个QUnit测试环境，当然必要时我们自己也可以调用它来复原，不过目前我还没有调用过它。<br>Assertions:<br>所有断言函数的message都是可选参数，可以是一段话来描述整个断言，这样在测试结果页面可以很清楚看出这个断言是干什么的，比如equal(add(1, 2), 3, “1加2应该等于3″)<br>• ok( state, [message] )，布尔断言，参数state的值为true时表示通过，否则失败。<br>• equal( actual, expected, [message] )，比较参数actual和expected是否相等，转化为JavaScript代码为if (actual == expected)，是不比较类型的。<br>• notEqual( actual, expected, [message] )，比较两个参数不相等，转化为JavaScript代码为if (actual != expected)，是不比较类型的，不相等则通过，否则失败。<br>• deepEqual( actual, expected, [message] )，主要用于数组和对象等类型的值是否相等，会递归遍历它们所包含的值是否相等。<br>• notDeepEqual( actual, expected, [message] )，主要用于数组和对象等类型的值是否不相等，会递归遍历它们所包含的值是否不相等。<br>• strictEqual( actual, expected, [message] )，比较参数actual和expected的值和类型是否相等，转化为JavaScript代码为if (actual === expected)，是需要比较类型的。<br>• notStrictEqual( actual, expected, [message] )，比较参数actual和expected的值和类型是否不相等，转化为JavaScript代码为if (actual !== expected)，是需要比较类型的。<br>• raises( block, expected, [message] )，测试block函数是否抛出一个异常，抛出则通过，不抛则失败。block参数是我们要测试的函数，expected参数是一个函数，是一个可选参数，用来验证第一个函数抛出的异常是否是我们想要的。<br>Asynchronous Testing:<br>• stop( [increment] )，停止测试的运行，因为在异步环境中，不停止的话就运行结束了，异步的回调都不会被处理，所以在异步测试时一般先把QUnit的test runner停下来。increment参数是增加停止的时间。<br>• start( [decrement] )，当异步调用成功后就应该把停止的test runner启动起来让它接着往前跑了，decrement参数用来减少停止的时间。<br>异步测试的代码需要写在asyncTest( name, [expected], test )中，一个Ajax异步测试的例子：<br>//Ajax调用函数<br>function ajax(successCallback) {<br>$.ajax({<br>url: ‘ajxjserver.php’,<br>success: successCallback<br>});<br>}</p><p>test(‘异步测试’, function() {<br>// 暂停测试<br>stop();<br>ajax(function() {<br>// 异步调用测试代码<br>})</p><p>setTimeout(function() {<br>//异步测试完成后，恢复test runner，接着处理其他测试代码<br>start();<br>}, 3000);<br>})<br>与浏览器自动化测试工具集成的接口<br>QUnit额外提供了一些与浏览器自动化测试工具集成的接口，这些接口实现后会被QUnit自动调用，注意，这些接口是留着我们开发人员自己来实现的。这里简单做些介绍：<br>• QUnit.log({ result, actual, expected, message })，这个接口会在每个断言执行后调用，result值是断言是否通过，message是断言里的message参数。<br>• QUnit.testStart({ name })，在每个测试函数执行前调用，name参数是测试函数中的name参数值，这里的测试函数是指test()或者asyncTest()。<br>• QUnit.testDone({ name, failed, passed, total })，在每个测试函数结束后执行，name参数同上，failed参数是指失败断言的个数，passed参数是指成功断言的个数，total是指所有断言的个数。<br>• QUnit.moduleStart({ name })，在每个module后面所有的测试代码执行前调用，name参数是module(name)中name的值。<br>• QUnit.moduleDone({ name, failed, passed, total })，在module下面所有的测试代码执行完之后执行，failed参数是指失败断言的个数，passed参数是指成功断言的个数，total是指所有断言的个数。<br>• QUnit.begin()，在所有的测试代码调用之前运行。<br>• QUnit.done({ failed, passed, total, runtime })，在所有的测试代码调用之后运行，failed参数是指失败断言的个数，passed参数是指成功断言的个数，total是指所有断言的个数，runtime代码所有代码的执行时间。</p><p>vue-cli 内置的单元测试工具<br>测试管理工具:karma<br>测试框架:mocha、jasmine</p>]]></content>
      
      
      <categories>
          
          <category> 单元测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>安装</title>
      <link href="/posts/1704ea49.html"/>
      <url>/posts/1704ea49.html</url>
      
        <content type="html"><![CDATA[<h2 id="Jest">Jest</h2><h3 id="目的">目的</h3><p>使用 TypeScript 开发的 React 项目运行 Jest 单元测试用例</p><h3 id="Jest-安装配置与解释">Jest 安装配置与解释</h3><p>1).  安装依赖</p><p>第一步，安装依赖</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i jest @types/jest ts-jest typescript -D</span><br></pre></td></tr></table></figure><ul><li>安装 jest 测试框架 (jest)</li><li>安装 jest 类型包(@types/jest)</li><li>安装 jest 支持的 TypeScript 预处理器(ts-jest)</li><li>安装 ts-jest 的依赖 TypeScript 编译器 (typescript)</li></ul><p>2). Jest 配置文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="string">&quot;verbose&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;roots&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;&lt;rootDir&gt;/src&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;testMatch&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;**/__tests__/**/*.+(ts|tsx|js)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;**/?(*.)+(spec|test).+(ts|tsx|js)&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;testPathIgnorePatterns&quot;</span>: [<span class="string">&#x27;/node_modules/&#x27;</span>, <span class="string">&#x27;/lib/&#x27;</span>, <span class="string">&#x27;/esm/&#x27;</span>, <span class="string">&#x27;/dist/&#x27;</span>],</span><br><span class="line">  <span class="string">&quot;moduleNameMapper&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;\\.(css|less|scss)$&#x27;</span>: <span class="string">&#x27;identity-obj-proxy&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;^src$&#x27;</span>: <span class="string">&#x27;&lt;rootDir&gt;/src/index.tsx&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;^src(.*)$&#x27;</span>: <span class="string">&#x27;&lt;rootDir&gt;/src/$1&#x27;</span>,</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">&quot;moduleFileExtensions&quot;</span>: [<span class="string">&#x27;ts&#x27;</span>, <span class="string">&#x27;tsx&#x27;</span>, <span class="string">&#x27;js&#x27;</span>, <span class="string">&#x27;jsx&#x27;</span>],</span><br><span class="line">  <span class="string">&quot;preset&quot;</span>: <span class="string">&quot;ts-jest&quot;</span>,</span><br><span class="line">  <span class="string">&quot;testEnvironment&quot;</span>: <span class="string">&quot;jsdom&quot;</span>,  </span><br><span class="line">  <span class="string">&quot;transform&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;^.+\\.(ts|tsx)$&quot;</span>: <span class="string">&quot;ts-jest&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在 roots 选项中指定测试文件位置；</li><li>通过 testMatch 配置匹配全局要处理的文件类型；</li><li>通过 transform 配置告诉 jest 使用 ts-jest 来处理以 ts/tsx 结尾的文件；</li><li>moduleFileExtensions 从左到右 查找对应的 extension</li><li>moduleNameMapper 把匹配到的内容映射为你指定的内容,让处理的资源或无关的资源更少</li></ul><p>3). 添加启动脚本<br>在你的 package.json 文件中添加一个 npm scripts：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>如果不是从新项目开始直接集成 Jest，在配置过程中可能会遇到问题，我将自己遇到的一些问题罗列如下，供参考：</p><ul><li><p>Invalid Hook Call Warning -&gt; react dom 版本不匹配</p></li><li><p>Hooks can only be called inside of the body of a function component -&gt; 这是因为你的 React 渲染环境需要修改，将 Jest 的配置中 “testEnvironment” 设置为 “jsdom” 即可</p></li><li><p>无法识别 import/export 等模块引入关键字 -&gt; Jest 默认为 CommonJS 标准，不支持 ES Modules 标准，需要为指定文件范围设定 “extensionsToTreatAsEsm” 配置，Jest 才会进行处理</p></li></ul><h3 id="Jest-常用语法">Jest 常用语法</h3><ul><li>describe：一个将多个相关的测试组合在一起的块</li><li>test：将运行测试的方法，别名是it</li><li>expect：断言，判断一个值是否满足条件，你会使用到expect函数。 但你很少会单独调用expect函数， 因为你通常会结合expect和匹配器函数来断言某个值</li><li>skip：跳过指定的describe以及test，用法describe.skip、test.skip</li><li>cleanup：在每一个测试用例结束之后，确保所有的状态能回归到最初状态，比如在 UI 组件测试中，我们建议在 afterEach 中调用 cleanup 函数</li></ul><h3 id="模拟函数介绍与-Hooks-单元测试实现">模拟函数介绍与 Hooks 单元测试实现</h3><p>1). 坚持原则</p><ul><li>仅测试代码库内自身逻辑，对于三方依赖进行 mock</li><li>一次只测一个逻辑</li><li>单元测试应该覆盖自定义 component、service 与 hook</li></ul><h3 id="testing-library">@testing-library</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultProps = &#123;</span><br><span class="line">  <span class="attr">onClick</span>:jest.<span class="title function_">fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">testProps</span>:<span class="title class_">ButtonProps</span> = &#123;</span><br><span class="line">  <span class="attr">btnType</span>:<span class="title class_">ButtonType</span>.<span class="property">Primary</span>,</span><br><span class="line">  <span class="attr">size</span>:<span class="title class_">ButtonSize</span>.<span class="property">Small</span>,</span><br><span class="line">  <span class="attr">className</span>:<span class="string">&#x27;test&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Button</span> = <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> &#123;<span class="attr">...defaultProps</span>&#125;&gt;</span>Hello<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// describe 描述一组测试用例</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Button Test&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeAll</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 预处理操作</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">  &#125;)  </span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;默认测试&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> /&gt;</span></span>)</span><br><span class="line">    <span class="keyword">const</span> el = wrapper.<span class="title function_">getByText</span>(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">    <span class="title function_">expect</span>(el).<span class="title function_">toBeInTheDocument</span>()</span><br><span class="line">    <span class="title function_">expect</span>(el.<span class="property">tagName</span>).<span class="title function_">toEqual</span>(<span class="string">&#x27;BUTTON&#x27;</span>)</span><br><span class="line">    <span class="title function_">expect</span>(el).<span class="title function_">toHaveClass</span>(<span class="string">&#x27;btn btn-default&#x27;</span>)</span><br><span class="line">    <span class="comment">// fireEvent: Test React Component event handles</span></span><br><span class="line">    fireEvent.<span class="title function_">click</span>(el)</span><br><span class="line">    <span class="title function_">expect</span>(defaultProps.<span class="property">onClick</span>).<span class="title function_">toHaveBeenCalled</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;不同props测试&#x27;</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = <span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> &#123;<span class="attr">...qqq</span>&#125;&gt;</span>Hello<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span>)</span><br><span class="line">    <span class="keyword">const</span> el = wrapper.<span class="title function_">getByText</span>(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">    <span class="title function_">expect</span>(el).<span class="title function_">toBeInTheDocument</span>()</span><br><span class="line">    <span class="title function_">expect</span>(el).<span class="title function_">toHaveClass</span>(<span class="string">&#x27;btn-primary btn-small test&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">afterAll</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 后处理操作</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单元测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>常用函数</title>
      <link href="/posts/923c3c89.html"/>
      <url>/posts/923c3c89.html</url>
      
        <content type="html"><![CDATA[<h3 id="Jest">Jest</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.test.js</span></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;test common&#x27;</span>, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="number">2</span>+<span class="number">2</span>).<span class="title function_">toBe</span>(<span class="number">4</span>)</span><br><span class="line">  <span class="title function_">expect</span>(<span class="number">2</span>+<span class="number">2</span>).<span class="property">not</span>.<span class="title function_">toBe</span>(<span class="number">5</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;true&#x27;</span>, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="number">1</span>).<span class="title function_">toBeTruthy</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;number&#x27;</span>, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="number">2</span>).<span class="title function_">toBeGreaterThan</span>(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;obj&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">expect</span>(&#123;<span class="attr">a</span>:<span class="number">2</span>&#125;).<span class="title function_">toEqual</span>(&#123;<span class="attr">a</span>:<span class="number">2</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;FetchFourData 测试&#x27;</span>, <span class="title function_">async</span>()=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> response  = <span class="keyword">await</span> <span class="title function_">fetchFourData</span>()</span><br><span class="line">  <span class="title function_">expect</span>(response.<span class="property">data</span>).<span class="title function_">toEqual</span>(&#123;</span><br><span class="line">    success : <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 脚本</span></span><br><span class="line">$ npx jest index.<span class="property">test</span>.<span class="property">js</span> --watch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line"><span class="title class_">Watch</span> <span class="title class_">Usage</span>: <span class="title class_">Press</span> w to show more.</span><br><span class="line"><span class="variable constant_">PASS</span>  ./index.<span class="property">test</span>.<span class="property">js</span></span><br><span class="line">√ test common (4ms)</span><br><span class="line">√ <span class="literal">true</span> (1ms)</span><br><span class="line">√ number</span><br><span class="line">√ obj (1ms)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Test</span> <span class="title class_">Suites</span>: <span class="number">1</span> passed, <span class="number">1</span> total</span><br><span class="line"><span class="title class_">Tests</span>:       <span class="number">4</span> passed, <span class="number">4</span> total</span><br><span class="line"><span class="title class_">Snapshots</span>:   <span class="number">0</span> total</span><br><span class="line"><span class="title class_">Time</span>:        <span class="number">2.</span>914s, estimated 3s</span><br><span class="line"><span class="title class_">Ran</span> all test suites matching /index.<span class="property">test</span>.<span class="property">js</span>/i.</span><br><span class="line"></span><br><span class="line"><span class="title class_">Watch</span> <span class="title class_">Usage</span>: <span class="title class_">Press</span> w to show more.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 单元测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>配置项说明</title>
      <link href="/posts/93151624.html"/>
      <url>/posts/93151624.html</url>
      
        <content type="html"><![CDATA[<p>文档地址：<a href="https://jestjs.io/docs/27.x/api">Configuring Jest · Jest</a></p><h2 id="Jest配置">Jest配置</h2><h2 id="automock">automock</h2><blockquote><p>Boolean(默认值：false)</p></blockquote><pre><code>这个配置项用来配置是否将测试文件中所有引入的模块自动变成模拟的模块如果开启的话，就测试文件中的模块的实现都会被重新实现，但会保留 Api 接口</code></pre><p>比如我们要测试某个模块中的某个函数功能：</p><pre><code>// mod.tsmodule.exports = () =&gt; 1// index.test.tsxconst aotoMockFn = require('./mod')it(&quot;test1&quot;, () =&gt; &#123;  expect(aotoMockFn()).toBe(1);&#125;)</code></pre><p>此时如果我们想测试 aotoMockFn 返回2 的情况，实际情况下就我们需要去改动内部的逻辑和代码，就不太合理</p><p>jest提供了mock 模块的功能，我们将mock一下 mod模块，就可以使用mock 的一些api，比如模拟返回值 <strong>mockReturnValue</strong>：</p><pre><code>// index.test.tsxjest.mock('./mod')const aotoMockFn = require('./mod')mockFn.mockReturnValue(2)it(&quot;test1&quot;, () =&gt; &#123;  expect(mockFn()).toBe(2);&#125;)</code></pre><p>这样就可以很愉快的进行mock 模块了</p><p>这个配置项提供的就是这个功能的全局开关配置，开启之后引入的模块就自动是mock之后的了，无须再在每个测试文件的顶部再执行 jest.mock 之类的mock方法</p><h2 id="bail">bail</h2><blockquote><p>Number | Boolean (默认值：0)</p></blockquote><pre><code>默认情况下，Jest会跑所有的用例并且在结束的时候会把所有的错误信息打印到控制台上这个选项可以设置当n个test失败之后停止执行。true 等同于 1</code></pre><p>文档中所说的**n个tests，**是指文件维度而不是一个case的维度，相关的issue：</p><p><a href="https://link.zhihu.com/?target=https%3A//github.com/facebook/jest/issues/2626">https://github.com/facebook/jest/issues/2626</a></p><h2 id="cacheDirectory-draft">cacheDirectory - draft</h2><blockquote><p>String (默认值：/tmp/<path>)</p></blockquote><pre><code>Jest会先扫描测试用例的依赖树关系生成一些信息并缓存，用来减少用例执行时对文件系统的变动造成的影响这个配置可以自定义Jest缓存依赖信息的目录</code></pre><p>配置了之后就是生成一些临时文件，这些依赖信息缓存下来之后带来的性能提升具体也还没测过，后面可以测试下</p><h2 id="clearMocks">clearMocks</h2><blockquote><p>Boolean (默认值：false)</p></blockquote><pre><code>每个case执行前会自动清空Jest mock生成函数的 calls、instances、contexts相当于在每个case执行前执行一边 jest.clearAllMocks</code></pre><p>以calls为例：</p><pre><code>const fn = jest.fn((x) =&gt; &#123;  return x&#125;)it('1', () =&gt; &#123;  expect(fn(1)).toBe(1)  expect(fn(1)).toBe(1)  expect(fn(1)).toBe(1)  expect(fn.mock.calls.length).toBe(3)&#125;)it('2', () =&gt; &#123;  expect(fn(2)).toBe(2)  expect(fn.mock.calls.length).toBe(1)&#125;)</code></pre><p>calls.length 表示调用次数，如果开启clearMock，那么case1执行完成之后，fn被执行的次数就会清空，case2就是对的，反之不会清空，case2中fn的执行次数为4</p><h2 id="collectCoverage">collectCoverage</h2><blockquote><p>Boolean (默认值: false)</p></blockquote><pre><code>控制是否要生成代码覆盖率报告，以及控制台是否打印覆盖率的日志</code></pre><p>这个就是开启了之后会生成代码覆盖率的日志和报告，因为每个文件执行的时候会给每个测试文件生成覆盖率收集的文件，所以会显著降低测试速度</p><h2 id="collectCoverageFrom">collectCoverageFrom</h2><blockquote><p>undefined | Array<string> (默认值: undefined)</p></blockquote><pre><code>设置要生成代码覆盖率报告的目录和文件格式为遵循 glob pattern 格式的字符串数组</code></pre><p>这里面的路径填写的是被测试文件的路径，而不是测试用例的文件的路径</p><h2 id="coverageDirectory">coverageDirectory</h2><blockquote><p>String 默认值（undefined）</p></blockquote><pre><code>覆盖率报告生成的目录(基于项目根路径)</code></pre><h2 id="coveragePathIgnorePatterns">coveragePathIgnorePatterns</h2><blockquote><p>Array<string>（默认值：[‘/node_modules/’]）</p></blockquote><pre><code>设置生成代码覆盖率报告要排除的目录和文件遵循正则表达式，不支持绝对路径匹配，使用 &lt;rootDir&gt; 来作为项目的根目录字符串，防止因为不同的环境造成不同的根路径，导致意外地忽略了所有的文件</code></pre><h2 id="coverageReporters">coverageReporters</h2><blockquote><p>Array&lt;string ｜ [string, options]&gt;（默认值：[“clover”, “json”, “lcov”, “text”]）</p></blockquote><pre><code>生成的代码覆盖率报告的文件格式列表支持的格式：https://github.com/istanbuljs/istanbuljs/tree/master/packages/istanbul-reports/lib</code></pre><h2 id="coverageThreshold">coverageThreshold</h2><blockquote><p>Object （默认值：undefined）</p></blockquote><pre><code>配置代码覆盖率的四个指标阈值：- branches：分支覆盖率- functions：函数覆盖率- lines：行覆盖率- statements：声明覆盖率</code></pre><p>如果是想全局配置，就配置在global的key下，如果想单独配置某个文件的指标，key值写在符合glob pattern模式的路径key下：</p><p><img src="https://pic2.zhimg.com/v2-370021749baa4d15d80b4d61928794b5_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='791' height='444'></svg>)</p><h2 id="displayName">displayName</h2><blockquote><p>String | Object （默认值：undefined）</p></blockquote><pre><code>用于自定义当前项目执行用例时打印的标记和颜色因为如果一个仓库中有多个项目，可能会有多份配置文件，这样可以更容易区分</code></pre><p><img src="https://pic3.zhimg.com/v2-102ca4ac1bb23896f2a24aa70fe94e4e_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1396' height='1342'></svg>)</p><h2 id="dependencyExtractor-draft">dependencyExtractor - draft</h2><blockquote><p>String（默认值：undefined）</p></blockquote><pre><code>这个选项可以用来自定义依赖提取这个依赖提取的文件必须是一个导出了一个包涵 extract 函数的对象的node模块</code></pre><p>看描述是抽取依赖用的，但是我试了没效果，然后不管是debug还是log都没任何反应，也没看到任何解决办法，有个2020的issue一直挂着无人问津：</p><p><a href="https://link.zhihu.com/?target=https%3A//github.com/facebook/jest/issues/10452">How to debug the “extract” method in “dependencyExtractor.js” · Issue #10452 · facebook/jest</a></p><h2 id="errorOnDeprecated-draft">errorOnDeprecated - draft</h2><blockquote><p>Boolean （默认值：false）</p></blockquote><pre><code>配置调用废弃的APIS的时候，是否抛出错误信息对后续升级的过程比较有用</code></pre><p>这个配置貌似没啥用啊，我试了下下面的demo：</p><p><img src="https://pic3.zhimg.com/v2-2234688112813911b8c0b4f9535bb7ce_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='874' height='420'></svg>)</p><p>开启了这个配置项，控制台还是干干净净，也没见到什么错误信息…等大佬们指点下</p><h2 id="fakeTimers">fakeTimers</h2><blockquote><p>String（默认值：real）</p></blockquote><pre><code>是否使用Jest内置的定时器针对定时器，在单元测试的环境中不可能和真实的代码环境一样，所以需要使用内置的定时器来帮助我们更灵活的书写单元测试这个配置项就是模拟一些定时器的行为，比如跑单测碰到一个定时器，不可能真的等定时器执行的时候再继续执行单测</code></pre><p>先用个最简单的例子：</p><pre><code>const fn = jest.fn()function testTimer () &#123;  setTimeout(() =&gt; &#123;    fn()  &#125;, 3000)&#125;test('test timer', () =&gt; &#123;  testTimer();  expect(fn).toBeCalled();&#125;);</code></pre><p>上述例子会返回失败，控制台会给一警告：</p><p><img src="https://pic2.zhimg.com/v2-13df51bed911e420d59b012409602b71_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1808' height='144'></svg>)</p><p>使用Jest内置的定时器：</p><pre><code>const fn = jest.fn()jest.useFakeTimers()function testTimer () &#123;  setTimeout(() =&gt; &#123;    fn()  &#125;, 3000)&#125;test('test timer', () =&gt; &#123;  testTimer();  jest.advanceTimersByTime(3000)  expect(fn).toBeCalled();&#125;);</code></pre><p>useFakeTimers 就是生命在当前用例内使用Jest内置的定时器，advanceTimersByTime 是一个配置项，将控制器提前运行一段时间，简而言之，就是Jest的定时器可以让我们受控了，我们可以更加灵活的进行控制</p><p><strong>fakeTimer</strong>这个配置项就是全局的一些配置</p><pre><code>// jest.config.jsmodule.exports = &#123;  fakeTimer: &#123;    // 是否要使用全局的定时器配置(同上面的 useFakeTimers)    enableGlobally?: boolean,    // 定时器超前执行的时间（同上面的 advanceTimersByTime）    advanceTimers?: boolean | number,    // 哪些定时器的Api是不需要使用Jest内置的，具体见官网    doNotFake?: Array&lt;FakeableAPI&gt;    // 是否要用老的实现（和我们没啥关系，不用管这个配置项）    legacyFakeTimers?: boolean,    // 设置一个基准的系统时间戳，给内置的计时器用的，默认是Date.now()    now?: number,    // 暂时没看懂啥意思（先不管吧。。。。）    tiemrLimit?: numner  &#125;&#125;</code></pre><p>这里需要注意一小点就是，advanceTimers 这个配置项需要搭配 runAllTimers 才会生效，以上述例子：</p><pre><code>// jest.config.jsmodule.exports = &#123;  fakeTimer: &#123;    enableGlobally: true    advanceTimers: 3000  &#125;&#125;// demo.test.tsconst fn = jest.fn()function testTimer () &#123;  setTimeout(() =&gt; &#123;    fn()  &#125;, 3000)&#125;test('test timer', () =&gt; &#123;  testTimer();  jest.runAllTimers()  expect(fn).toBeCalled();&#125;);</code></pre><p>更详细的用法和Api可以去官网详细了解</p><h2 id="forceCoverageMatch">forceCoverageMatch</h2><blockquote><p>Array<string>（默认值：[‘’]）</p></blockquote><pre><code>设置需要强制生成代码覆盖率报告的文件收集代码覆盖率通常会忽略测试的文件，可以通过这个配置项覆盖这种默认行为，并在代码覆盖范围内包含其他被忽略的文件</code></pre><p>比如，coveragePathIgnorePatterns 这个配置项配置了exclude的目录和文件，但如果想在这些排除的目录中收集某些文件的覆盖率报告，就可以利用这个配置项进行覆盖</p><h2 id="globals">globals</h2><blockquote><p>Object （默认值：{}）</p></blockquote><pre><code>可以定义一些全局变量，可以通过访问global对象拿到自定义的全局对象</code></pre><p>如果我们定义的是引用类型的变量（对象、数组）这些，然后测试过程中改变了引用地址，新的引用是不会在其他测试文件中生效的，也就是每个测试文件中的全局变量都是引用的global的原始值</p><p>另外，配置的变量必须是可序列化的JSON格式，所以，函数就不能声明了，可以使用 setupFIles</p><h2 id="globalSetup">globalSetup</h2><blockquote><p>String （默认值：undefined）</p></blockquote><pre><code>全局注入器，这个选项可以让我们自定义注入全局模块可以设置一个setup文件的路径，然后该文件必须导出一个函数（同步异步都行）这个函数会在执行用例前触发，收到Jest的两个参数：globalConfig 和 projectConfig</code></pre><p>就是更加灵活的注入一些全局变量或者进行一些操作</p><p>比如一些函数，比如一些变量是需要异步注入的等等</p><pre><code>// jest.config.jsmodule.exports = &#123;  globalSetup: '&lt;rootDir&gt;/setup.js'&#125;// setup.jsconst fun = () =&gt; &#123;  return 1&#125;module.exports = async function (globalConfig, projectConfig) &#123;  // console.log(globalConfig);  // console.log(projectConfig);  globalThis.fun = fun&#125;;</code></pre><p>然后在用例中就能获取注入的全局模块了</p><p><img src="https://pic2.zhimg.com/v2-8dbdb22c0b80db495323822a6b828fcd_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1076' height='268'></svg>)</p><h2 id="globalTeardown">globalTeardown</h2><blockquote><p>String （默认值：undefined）</p></blockquote><pre><code>全局拆卸器，这个选项可以让我们可以设置一个teardown文件的路径，然后该文件必须导出一个函数（同步异步都行）这个函数会在执行用例完成触发，收到Jest的两个参数：globalConfig 和 projectConfig</code></pre><p>其实 globalTeardown 和 globalSetup 这两个配置项个人理解就是 Jest 给使用者提供的两个注入全局模块的hooks，我们可以更方便的操控一些全局模块</p><p>比如如果单测涉及到数据库，那么开始的时候我们需要注入数据库的全局变量，然后测试结束之后肯定得关闭数据库的连接，那么注入的过程就可以在setup中操作，断开连接就可以在teardown中操作</p><h2 id="haste">haste</h2><blockquote><p>Object（默认值：undefined）</p></blockquote><pre><code>Jest内置 jest-haste-map 作为文件 爬取/缓存 系统这个配置项就是将一些参数透传给这个模块</code></pre><p>说实话，刚开始看了半天不知道啥意思，官网文档仅仅就只有一个config表，真的难顶</p><p>后来直接去 <a href="https://link.zhihu.com/?target=https%3A//github.com/facebook/jest/blob/main/packages/jest-haste-map/src/index.ts">jest-haste-map github地址</a> 看了下注释的说明，才算大概理解这个配置项的意思</p><p><img src="https://pic4.zhimg.com/v2-ebded48962816a092d45c183ec831b8b_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1248' height='373'></svg>)</p><p><img src="https://pic4.zhimg.com/v2-1d9c7f473d9241e453a27bd0ce01d5f3_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1107' height='432'></svg>)</p><p>第一张图说明了 jest-haste-map 的作用：</p><p>当我们执行用例的时候，如果项目的文件数量非常巨大，热更新模式下，每次执行用例都去扫描文件的话是非常损耗性能的，利用 <strong>Haste Map</strong>（加速图？不知道怎么翻译，就按照英文好了）来提升性能就非常重要了</p><p>当启动jest的时候，大多数任务都被 I/O 阻塞</p><p>如果要在热更新时修改文件，脚手架都要遍历一次项目文件，非常损耗性能。特别在一些文件特别多的巨石应用中，电脑分分钟就卡得动不了</p><h2 id="injectGlobals">injectGlobals</h2><blockquote><p>Boolean（默认值：true）</p></blockquote><pre><code>是否将Jest的全局变量（例如：it test expect...）注入到 global 环境中如果关闭，这些变量需要我们手动引入</code></pre><p>如果关闭：</p><p><img src="https://pic2.zhimg.com/v2-6ed3b9f2cd6222720ad12d5735fbf2f1_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1762' height='378'></svg>)</p><p>所以需要手动引入，官网示例代码是用esm的方式引入的，在没有进行一些配置之前，是有问题的，可以改成CommonJS的方式引入来验证：</p><pre><code>const &#123; it, expect &#125; = require('@jest/globals');it('1', () =&gt; &#123;  expect(3).toBe(3)&#125;)</code></pre><h2 id="maxConcurrency">maxConcurrency</h2><blockquote><p>Number（默认值：5）</p></blockquote><pre><code>用来限制 test.concurrent 模式下的测试并发数超过该限制的用例都会排队，并在有用例完成释放之后继续执行</code></pre><p>前提需要大概了解下 test.concurrent 的作用，简单的来说就是可以并发进行一些异步函数的测试，举个例子：</p><pre><code>it.concurrent(&quot;test&quot;, () =&gt; &#123;  return new Promise((resolve) =&gt; &#123;    setTimeout(() =&gt; &#123;      expect(1 + 2).toBe(3)      resolve(true)    &#125;, 1 * 1000)  &#125;)&#125;, 5000)</code></pre><p>concurrent模式下接受三个参数，第一个同样是用例名称，第二个是一个异步函数，第三个则是超时时间，当异步函数执行的时间超过超时时间时，会报错并取消，默认是5秒：</p><p><img src="https://pic3.zhimg.com/v2-68b46ad965b8e9ad8242923a1660abfa_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1576' height='476'></svg>)</p><p>可以进行一个测试，上述用例拷贝5份，然后配置 maxConcurrency 先为2，执行用例：</p><p><img src="https://pic2.zhimg.com/v2-7c1580baeb92e4e945b6c141472959b1_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1534' height='320'></svg>)</p><p>可以看到 2、4两个用例是并发执行的，并没有消耗时间，总的时常也是3s而不是5s</p><p>再把 maxConcurrency 设置为5：</p><p><img src="https://pic1.zhimg.com/v2-d7e1b83d4118d8b9804d244a06e164e0_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1832' height='330'></svg>)</p><p>结果显而易见了</p><h2 id="moduleDirectories">moduleDirectories</h2><blockquote><p>Array<string>（默认值：[“node_modules”]）</p></blockquote><p>定义优先加载的依赖的目录路径，比如，同时在 node_modules 和 自定义一个目录 my_modules 中，同时创建一个mod的模块：</p><pre><code>// node_modules/mod/index.jsmodule.exports = 1;// node_modules/mod/package.json&#123;  &quot;name&quot;: &quot;mod&quot;,  &quot;files&quot;: [    &quot;index.js&quot;  ]&#125;// my_modules/mod/index.jsmodule.exports = 2;// my_modules/mod/package.json&#123;  &quot;name&quot;: &quot;mod&quot;,  &quot;files&quot;: [    &quot;index.js&quot;  ]&#125;</code></pre><p>然后创建一个简单的用例，看看不同顺序的配置引用的模块的区别：</p><pre><code>const a = require('mod')it(&quot;test1&quot;, () =&gt; &#123;  expect(a + 1).toBe(3)&#125;)</code></pre><p>node_modules配置在前，由于优先使用node_modules中的mod模块，所以值为2，用例不通过：</p><p><img src="https://pic4.zhimg.com/v2-9b8373f7a5f76660a63d307dbabaf7ff_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1138' height='140'></svg>)</p><p><img src="https://pic2.zhimg.com/v2-2289c19c1fd1037ce0a3c68e966a41e9_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1878' height='430'></svg>)</p><p>my_modules配置在前，则优先使用my_modules中的mod模块，所以值为3，用例通过</p><h2 id="moduleFileExtensions">moduleFileExtensions</h2><blockquote><p>Array<string>（默认值: [“js”, “mjs”, “cjs”, “jsx”, “ts”, “tsx”, “json”, “node”]）</p></blockquote><p>作用类似于webpack的extensions配置，当 import / require 没有指定文件后缀时，Jest将从上述配置的数组中从左到右查找扩展名</p><pre><code>// 1.test.tsxconst add = require('./add')it('test', () =&gt; &#123;  expect(add(1, 2)).toBe(3);&#125;);// add.tsxmodule.exports = function(x, y) &#123;  return x + y;&#125;// jest.config.jsmodule.exports = &#123;  moduleFileExtensions: [&quot;js&quot;]&#125;;</code></pre><p>执行用例，会提示找不到找不到用例：</p><p><img src="https://pic1.zhimg.com/v2-948bf589f497a7e94fd611f5c3445b4c_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1552' height='222'></svg>)</p><pre><code>// jest.config.jsmodule.exports = &#123;  moduleFileExtensions: [&quot;js&quot;, &quot;tsx&quot;]&#125;;</code></pre><p>则运行正常：</p><p><img src="https://pic4.zhimg.com/v2-78cea0c02640fdd263751b9e9767712b_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1456' height='254'></svg>)</p><h2 id="moduleNameMapper">moduleNameMapper</h2><blockquote><p>Object（默认值：null）</p></blockquote><pre><code>一个 从正则表达式到允许存根资源的模块名称或模块名称数组 的映射，比如单独的图片或者样式模块</code></pre><p>简而言之就是对一些模块的代理处理</p><p>以下面的例子来说，我们先定义一个模块，为了好区分正则，以cjs后缀结尾：</p><pre><code>// origin.cjsmodule.exports = &#123;  a: 1&#125;;</code></pre><p>然后写一个简单的用例测试下：</p><pre><code>const obj = require('./origin.cjs');it(&quot;test1&quot;, () =&gt; &#123;  expect(obj.a).toBe(1);&#125;)</code></pre><p>这个时候我们再写一个处理函数，作用也很简单，就是当我们获取对象某个key的值的时候，返回的就是这个key：</p><pre><code>// idObj.jsvar idObj = new Proxy(&#123;&#125;, &#123;  get: function getter(target, key) &#123;    return key;  &#125;&#125;);module.exports = idObj;</code></pre><p>再配置一下moduleNameMapper:</p><pre><code>// jest.config.jsmodule.exports = &#123;  moduleNameMapper: &#123;    '\\.(cjs)$': '&lt;rootDir&gt;/moduleNameMapper/idObj.js',  &#125;&#125;;</code></pre><p>当使用cjs后缀的模块时，都使用idObj代理处理一下。这个时候再执行原来的用例就会报错了，实际上被处理了之后，断言的值应该是key值，也就是a，可以自行验证一下</p><p>By the way，上述那个idObj.js，实际上就是 <a href="https://link.zhihu.com/?target=https%3A//www.npmjs.com/package/identity-obj-proxy">identity-obj-proxy</a> 的源码简易版</p><p>这个配置项作用的话就是加快用例的执行速度，一些模块比如图片、样式啥的在执行用例的时候并不需要真正去加载，代理一下即可</p><h2 id="modulePathIgnorePatterns">modulePathIgnorePatterns</h2><blockquote><p>Arrary<string> （默认值： []）</p></blockquote><pre><code>在这些路径之前所有与模块路径匹配的正则字符串数组对模块加载器被认为是 “可见的”。如果给定的模块路径与任何模式匹配，则它在测试环境中将不支持被 require()</code></pre><p>功能上来说就是可以忽略一些目录下的测试文件，同样举个例子：</p><pre><code>// index.test.tsxit(&quot;test1&quot;, () =&gt; &#123;  expect(1).toBe(1);&#125;)// index1.test.tsxit(&quot;test2&quot;, () =&gt; &#123;  expect(2).toBe(2);&#125;)// jest.config.jsmodule.exports = &#123;  modulePathIgnorePatterns: [    '&lt;rootDir&gt;/modulePathIgnorePatterns/index.test.tsx'  ]&#125;;</code></pre><p>执行用例，就只会执行index1这个用例。</p><p>但是后面还有一个配置项 testPathIgnorePatterns 也是相同的功能，目前不是很清楚两者的主要区别是啥。</p><p>看了一下主要的描述区别是，testPathIgnorePatterns是skip，而 modulePathIgnorePatterns 的描述是：</p><p><img src="https://pic1.zhimg.com/v2-c60516b4d6320f16caf2db8c19ab590c_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='485' height='38'></svg>)</p><p>期待评论区能给我解释一波。。。</p><h2 id="modulePaths">modulePaths</h2><blockquote><p>Array<string>（默认值：[]）</p></blockquote><pre><code>一个可选的用来设置 NODE_PATH 环境变量的配置值为一个用来表示需要模块额外去查找的路径的绝对路径的数组</code></pre><p>node默认引入模块是去查找node_modules下的模块，这个配置项可以配置一些别的查找路径。简单举个例子：</p><pre><code>// 根路径下建立目录 customModule/index.tsmodule.exports = 1;// index.test.tsconst customModule = require('customModule');it(&quot;test1&quot;, () =&gt; &#123;  expect(customModule).toBe(1);&#125;)</code></pre><p>node_modules中并没有customModule这个模块，这个时候require肯定是报错的。加上配置：</p><pre><code>// jest.config.jsmodulePaths: [   '&lt;rootDir&gt;/']</code></pre><p>告诉Jest还可以从根路径下找找，再跑一遍用例，正常pass</p><h2 id="notify">notify</h2><blockquote><p>Boolean （默认值：false）</p></blockquote><pre><code>是否激活系统的提示，需要额外安装依赖 node-notifier</code></pre><p>要注意的就是需要去开启通知权限，以mac系统为例，要开启terminal-notifier的通知权限</p><p><img src="https://pic2.zhimg.com/v2-ad529e4dee88500eb0c171ecd5e58f19_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='726' height='132'></svg>)</p><h2 id="notifyMode">notifyMode</h2><blockquote><p>String （默认值：failure-change）</p></blockquote><pre><code>如果 nofity 配置项开启，可以通过这个依赖项配置什么情况下会进行系统通知默认有如下模式：- always：总是会发- failure: 用例测试失败时候发- success: 用例成功的时候发- change: 用例状态改变的时候发- success-change: 用例通过或者失败的时候发- failure-change: 用例失败或者通过的时候发</code></pre><p>有个很坑的地方就是，在jest.config.json里配置这个不生效，命令行里配置 --notifyMode 就是正常的，看了下，原因是这个issue：<br><a href="https://link.zhihu.com/?target=https%3A//github.com/facebook/jest/issues/8826">https://github.com/facebook/jest/issues/8826</a></p><p>解决是这个issue：<br><a href="https://link.zhihu.com/?target=https%3A//github.com/facebook/jest/pull/9924">Move all default values into `jest-config` by ghostd · Pull Request #9924 · facebook/jest</a></p><h2 id="preset">preset</h2><blockquote><p>String （默认值：undefined）</p></blockquote><pre><code>配置预设文件的路径可以通过配置一些基本的配置，集成到jest.config.js中预设文件的命名必须是：jest-preset.json | jest-preset.js | jest-preset.cjs | jest-preset.mjs预设文件的路径可以是文件的绝对路径，也可以是根目录包含该文件的目录路径</code></pre><p>这个配置项就是可以用来集成一些共用的配置项</p><pre><code>// jest.config.jsmodule.exports = &#123;  preset: '&lt;rootDir&gt;/preset' // 如果根目录包含了预设的文件，只需要写到根目录即可&#125;// &lt;rootDir&gt;/preset/jest-preset.jsmodule.exports = &#123;  displayName: '哈哈'&#125;</code></pre><p>上面的例子就继承了preset中的 diaplayName，所以执行用例的时候会有”哈哈“标识</p><p><img src="https://pic3.zhimg.com/v2-4e1ff701232c9c04c7b7b9edff7cd97e_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1734' height='108'></svg>)</p><h2 id="prettierPath">prettierPath</h2><blockquote><p>String（默认值：undefined）</p></blockquote><pre><code>设置 prettier配置文件 的路径</code></pre><p>当使用 toMatchInlineSnapshot 的时候，可以配置一些prettier的规范，比如缩进啥的。我理解下来应该就是这个意思。</p><p>但是使用的时候直接就报错了：</p><p><img src="https://pic1.zhimg.com/v2-3aadd73a74e4597f0909495521ec6008_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1330' height='316'></svg>)</p><p>搜了好久也没找到答案，期待大佬们指点一波</p><h2 id="resetMocks">resetMocks</h2><blockquote><p>Boolean（默认值：false）</p></blockquote><pre><code>每个case执行前自动重置mock的数据这将导致任何 mocks 的fake实现被删除，而且不会保留它们的初始实现</code></pre><p>同样用一个简单的例子来说明：</p><pre><code>const resetMocksFn = jest.fn(() =&gt; 1)it(&quot;test1&quot;, () =&gt; &#123;  expect(resetMocksFn()).toBe(1);&#125;)it(&quot;test2&quot;, () =&gt; &#123;  resetMocksFn.mockReturnValue(2)  expect(resetMocksFn()).toBe(2);&#125;)</code></pre><p>如果不开启 resetMocks 的话，那么一切正常，然后我们开启这个配置：</p><pre><code>// jest.config.jsmodule.exports = &#123;  resetMocks: true&#125;;</code></pre><p>再跑一次用例发现第一个case挂了：</p><p><img src="https://pic3.zhimg.com/v2-e329ac276792424066389f0005e7136e_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1730' height='482'></svg>)</p><p>结果期望的是1，但收到的却是undefined，所以报错了</p><p>这个配置项就是能重置所有的 mock（包括原始的实现），比之前介绍过的clearMock更彻底，作用类似于在beforeEach这个hook里，执行了一遍 <strong>jest.resetAllMocks</strong> 这个函数</p><h2 id="restoreMocks">restoreMocks</h2><blockquote><p>Boolean（默认值：false）</p></blockquote><p>就不翻译了，作用上来说也是清除mock的fake实现，但是不像resetMock那么彻底，顾名思义就是会保留原始的实现，而且只有在通过 <strong>jest.spyOn</strong> mock的时候才会生效</p><p>同样用个简单的例子：</p><pre><code>const restoreMocksObj = &#123;  hello: () =&gt; 'hello'&#125;;const spy = jest.spyOn(restoreMocksObj, 'hello')it(&quot;test1&quot;, () =&gt; &#123;  expect(restoreMocksObj.hello()).toBe('hello');&#125;)it('test2', () =&gt; &#123;  spy.mockReturnValue('bye')  expect(restoreMocksObj.hello()).toBe('bye');&#125;)it('test3', () =&gt; &#123;  expect(restoreMocksObj.hello()).toBe('bye');&#125;)</code></pre><p>上述例子运行一下一切正常，开启 restoreMocks 配置，再执行一次：</p><p><img src="https://pic4.zhimg.com/v2-e34333d6280612cbf74be7d17ab8f10b_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1782' height='416'></svg>)</p><p>hello方法的mock的返回值被恢复回了hello，所以最后一个case没有通过</p><h2 id="resetModules">resetModules</h2><blockquote><p>Boolean（默认值：false）</p></blockquote><pre><code>默认情况下，每个测试文件都有自己独立的模块注册表启用 resetModules 可以更进一步在执行每个用例之前重置模块注册表这对于为每个测试隔离模块很有用，这样本地模块状态就不会在测试之间发生冲突</code></pre><p>这个配置还是挺实用的，一般来说相同的一个测试文件内部的不同用例之间，依赖的模块并不是独立的而是公共的，这就会导致可能在前一次执行用例的时候，更改了某个模块，而后续的一下用例是依赖初始的模块，这个更改就影响了后续的用例的正常执行了</p><pre><code>// mod.tsmodule.exports = &#123;  a: 1&#125;;// index.test.tsxlet mod1, mod2it(&quot;test1&quot;, () =&gt; &#123;  mod1 = require('./mod');  expect(mod1.a).toBe(1);  mod1.a = 2&#125;)it(&quot;test2&quot;, () =&gt; &#123;  mod2 = require('./mod');  console.log(mod1 === mod2)  expect(mod2.a).toBe(2);&#125;)</code></pre><p>test2中打印为true，且用例通过，说明默认情况下，每个case是用的同一个模块。此时开启 resetModules，重新执行用例：</p><p><img src="https://pic1.zhimg.com/v2-75588a6ff097290da710123e8ffa3534_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='2236' height='794'></svg>)</p><p>如图所示，每个case内的模块也是独立不干扰了</p><h2 id="resolver">resolver</h2><blockquote><p>String（默认值：undefined）</p></blockquote><pre><code>这个配置项允许我们自定义一个模块解析器，满足以下两个条件中任何一个即可：1、一个函数，接受两个参数，第一个参数为字符串（需要处理的路径），第二个参数为一个配置对象。函数需要返回模块的路径，如果模块没有找到则需要抛出错误2、一个对象，包含 async / sync 中的至少一个属性。sync 属性值为第一点中描述的函数async 属性值同理，只不过最终的结果需要resolve，异常需要reject</code></pre><p>我们可以按照第一点来写一个简单的模块解析器，先进行准备工作：</p><pre><code>// mods/mod.tsmodule.exports = 1// index.test.tsxconst mod = require('mod')it(&quot;test1&quot;, () =&gt; &#123;  expect(mod).toBe(1);&#125;)</code></pre><p>我们就这样执行用例肯定是会报错的，因为node_modules中并没有mod模块，我们的mod模块在同级的mods目录下，所以此时我们自定义一个resolver：</p><pre><code>// resolver.jsconst path = require('path')module.exports = function(_path, options) &#123;  // 当加载到mod时使用处理后的路径  if (_path === 'mod') &#123;    return path.join(__dirname, 'mods/mod.ts')  &#125;    // 其他情况使用默认的解析器处理  return options.defaultResolver(_path, options)&#125;// jest.config.jsmodule.exports = &#123;  resolver: '&lt;rootDir&gt;/resolver.js'&#125;;</code></pre><p>重新执行一次，mod模块就被正常加载了，算是最最基础版的一个模块解析器了</p><p>另外options配置对象中，除了defaultResolver 这个默认解析器的配置外，还有一些其他的数据，需要详细了解的话可以参考下哈</p><pre><code>type ResolverOptions = &#123;  /** Directory to begin resolving from. */  basedir: string;  /** List of export conditions. */  conditions?: Array&lt;string&gt;;  /** Instance of default resolver. */  defaultResolver: (path: string, options: ResolverOptions) =&gt; string;  /** List of file extensions to search in order. */  extensions?: Array&lt;string&gt;;  /** List of directory names to be looked up for modules recursively. */  moduleDirectory?: Array&lt;string&gt;;  /** List of `require.paths` to use if nothing is found in `node_modules`. */  paths?: Array&lt;string&gt;;  /** Allows transforming parsed `package.json` contents. */  packageFilter?: (pkg: PackageJSON, file: string, dir: string) =&gt; PackageJSON;  /** Allows transforms a path within a package. */  pathFilter?: (pkg: PackageJSON, path: string, relativePath: string) =&gt; string;  /** Current root directory. */  rootDir?: string;&#125;;</code></pre><h2 id="rootDir">rootDir</h2><blockquote><p>String</p></blockquote><p>就是配置<rootDir>根路径的值，默认是jest配置文件所在的目录或者 package.json 文件所在的目录。</p><p>如果前两个文件都没有，那就是取 <strong>pwd</strong> 所获取的工作目录路径的值</p><h2 id="roots">roots</h2><blockquote><p>Array<string>（默认值：[“<rootDir>”]）</p></blockquote><p>类似于webpack的alias配置，可以自行定义多个路径别名：</p><pre><code>roots: [&quot;&lt;rootDir&gt;/src/&quot;, &quot;&lt;rootDir&gt;/tests/&quot;]</code></pre><h2 id="runner">runner</h2><blockquote><p>String（默认值：‘jest-runner’）</p></blockquote><p>可以自定义jest配置的运行器，暂时接触不到。。</p><p>有兴趣的旁友们可以自行了解下如何写一个runner</p><h2 id="setupFiles">setupFiles</h2><blockquote><p>Array（默认值：[]）</p></blockquote><p>这个配置之前有提过，可以在进行测试前运行一些代码或者往全局环境中注入一些我们想要的东西，会在每个测试文件执行前执行一次这些配置文件，而且支持异步执行。</p><pre><code>// setUp.jsglobal.a = 1;// index.test.tsxit(&quot;test1&quot;, () =&gt; &#123;  expect(global['a']).toBe(1);&#125;)// jest.config.jsmodule.exports = &#123;  setupFiles: [    '&lt;rootDir&gt;/setupFiles/setUp.js'  ]&#125;;</code></pre><h2 id="setupFilesAfterEnv">setupFilesAfterEnv</h2><blockquote><p>Array（默认值：[]）</p></blockquote><p>作用类似setupFiles就不再细说了，区别就是执行阶段的不同</p><p>setupFiles执行是在测试框架还没准备好前就开始执行，而setupFilesAfterEnv则是在测试框架准备好但还没执行测试文件的阶段开始执行</p><p>这意味着如果我们要跑一些和Jest环境相关的配置代码啥的，那就要在这个配置项中执行了</p><h2 id="sandboxInjectedGlobals-draft">sandboxInjectedGlobals - draft</h2><blockquote><p>Array<String> （默认值：undefined）</p></blockquote><pre><code>测试文件是运行在一个node虚拟机内的，当调用一些global上下文的属性时变慢用这个配置项可以定义那些经常需要调用的属性，来加快查找速度</code></pre><p>没用到这个配置，尝试了加了下，好像也没有很特殊的感受，可以基本忽略这个配置项 另外，官网note：<strong>如果使用ESM的话，这个配置项无效</strong></p><h2 id="slowTestThreshold">slowTestThreshold</h2><blockquote><p>Number（默认值：5）</p></blockquote><pre><code>配置用例执行较慢的时间阈值，单位为秒并会在控制台执行用例的结果中标红展示</code></pre><p>个人觉得这个配置的作用是方便我们有针对性地对一些耗时较长的用例进行一些优化。</p><p>构造一个简单的用例，并将 slowTestThreshold 设置为 1：</p><pre><code>// 1.test.tsit.concurrent(&quot;test1&quot;, () =&gt; &#123;  return new Promise((resolve) =&gt; &#123;    setTimeout(() =&gt; &#123;      expect(1 + 1).toBe(2)      resolve(true)    &#125;, 3000)  &#125;)&#125;)// jest.config.jsmodule.exports = &#123;  slowTestThreshold: 1&#125;;</code></pre><p>展示结果如下：</p><p><img src="https://pic3.zhimg.com/v2-2ddbd1612bb8930685ea4f6641898bb6_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1582' height='308'></svg>)</p><h2 id="snapshotResolver">snapshotResolver</h2><blockquote><p>String（默认值：undefined）</p></blockquote><pre><code>可以解析测试&lt;-&gt;快照路径的模块的路径此配置选项允许您自定义 Jest 在磁盘上存储快照文件的位置</code></pre><p>这个配置项我们得先大概了解一下快照测试，简单来说就是：</p><p>当我们对一个组件进行快照测试的时候，第一个版本运行完单测，会在本地生成一份这个组件的快照文件。当我们对这个组件改动重新运行单测后，jest就会和上一份的快照对比，如果本次改动导致了快照发生了变化，jest就会报错并提示</p><p>**快照测试个人理解其实是更注重对比提醒而不是逻辑纠错的作用，**它能让我们可以知道某次改动是否对组件的渲染结果造成了影响</p><p>看一个例子：</p><pre><code>// Link.tsximport React, &#123;useState&#125; from 'react';export default function Link() &#123;  const [status, setStatus] = useState(1);  const href = status === 1 ? 'Href1' : 'Href2'  const text = status === 1 ? 'Link1' : &quot;Link2&quot;  return (    &lt;a href=&#123;href&#125;&gt;&#123;text&#125;&lt;/a&gt;  );&#125;// 1.test.tsximport React from 'react';import renderer from 'react-test-renderer';import Link from './Link';it('renders correctly', () =&gt; &#123;  const tree = renderer    .create(&lt;Link /&gt;)    .toJSON();  expect(tree).toMatchSnapshot();&#125;);</code></pre><p>运行，由于第一遍没有快照，所以会在同目录下生成一份 __snapshots__/1.test.tsx.snap 的一份快照：</p><pre><code>// Jest Snapshot v1, https://goo.gl/fbAQLPexports[`renders correctly 1`] = `&lt;a  href=&quot;Href1&quot;&gt;  Link1&lt;/a&gt;`;</code></pre><p>此时如果我们需要对组件进行改动，但不小心改动了status初始的值：</p><pre><code>// Link.tsximport React, &#123;useState&#125; from 'react';export default function Link() &#123;  const [status] = useState(2);  const href = status === 1 ? 'Href1' : 'Href2'  const text = status === 1 ? 'Link1' : &quot;Link2&quot;  return (    &lt;a href=&#123;href&#125;&gt;&#123;text&#125;&lt;/a&gt;  );&#125;</code></pre><p>这个时候实际上是对组件造成了破坏性的改动，但我们本身并不知道，再执行一遍用例，jest就会和本地的快照进行比对：</p><p>添加图片注释，不超过 140 字（可选）</p><p>通过这个diff过程，就能很清楚知道这次的改动造成的影响。而如果改成2确实是需要的，那就说明上次的快照需要更新，执行一下 <strong>yarn test - u</strong> 即可更新快照</p><p>上述就是对快照测试的一个简单的介绍，然后这个snapshotResolver配置项就是可以配置快照文件的生成路径，例如在上述例子中，默认生成快照文件的路径是 /tests/__snapshots__/1.test.tsx.snap</p><p>如果我们要将快照生成在 /tests/snapshots 目录下，就可以进行如下配置：</p><pre><code>// jest.config.jsmodule.exports = &#123;  snapshotResolver: '&lt;rootDir&gt;/resolver.js'&#125;;// resolver.jsmodule.exports = &#123;  /**   * 处理快照文件路径   * @param testPath - 测试文件路径   * @param snapshotExtension - 快照文件后缀（一般为.snap）   * @returns 快照文件路径   */  resolveSnapshotPath: (testPath, snapshotExtension) =&gt; &#123;    return testPath.slice(0, testPath.lastIndexOf('/')) + '/snapshots' + testPath.slice(testPath.lastIndexOf('/')) + snapshotExtension  &#125;,  /**   * 处理测试文件路径   * @param snapshotFilePath - 快照文件路径   * @param snapshotExtension - 快照文件后缀（一般为.snap）   * @returns 测试文件路径   */  resolveTestPath: (snapshotFilePath, snapshotExtension) =&gt; &#123;    return snapshotFilePath.replace('/snapshots', '').slice(0, -snapshotExtension.length)  &#125;,  // 一个用来预检resolver功能的路径例子（方便log来测试自己的路径对不对，会被resolveSnapshotPath调用）  testPathForConsistencyCheck: 'tests/example.test.js',&#125;;</code></pre><p>具体的描述已在代码中标注，应该是很详细了，顺带一提这三个属性都是必填，缺失会报错</p><h2 id="snapshotFormat">snapshotFormat</h2><blockquote><p>Object（默认值）</p></blockquote><pre><code>覆盖 pretty-format 的配置除了 compareKeys 和 plugins 这两个配置项</code></pre><p>首先 <a href="https://link.zhihu.com/?target=https%3A//www.npmjs.com/package/pretty-format">pretty-format</a> 这个库的作用是可以序列化js的类型，我们可以简单跑一个例子：</p><p><img src="https://pic2.zhimg.com/v2-ae24dee10693392b5e1d32c3400be6c1_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1820' height='696'></svg>)</p><p>这个模块本身有配置来控制序列化的结果，而jest的这个配置项就是用来覆盖pretty-format这个模块的默认配置的。因为jest的快照测试的时候需要序列化js类型，所以这个参数可以让我们针对一些简单的场景进行配置</p><h2 id="snapshotSerializers">snapshotSerializers</h2><blockquote><p>Array<string>（默认值: []）</p></blockquote><p>序列化器可以是一个非常强大的工具，通过自定义快照输出，您可以专注于对您的测试很重要的细节。它消除了所有不必要的噪音并简化了差异扫描，以查看每次测试运行中的变化</p><p><a href="https://link.zhihu.com/?target=https%3A//medium.com/trabe/snapshot-serializers-in-jest-7b38eca72201">https://medium.com/trabe/snapshot-serializers-in-jest-7b38eca72201</a></p><h2 id="testEnvironment">testEnvironment</h2><blockquote><p>String（默认值：‘node’）</p></blockquote><pre><code>测试的环境：node | jsdom默认是node环境，如果需要类似浏览器的环境的话，可以设置为 jsdom</code></pre><p>举个简单的例子：</p><pre><code>it(&quot;test env&quot;, () =&gt; &#123;  window[&quot;a&quot;] = 1;  expect(window[&quot;a&quot;]).toBe(1);&#125;)</code></pre><p>node环境下没有window变量这样会报错，设置为 jsdom 之后即可正常执行。不过有一注意点是，版本 28之后，jest不再内置 **jest-environment-jsdom，**所以需要自行安装</p><p><img src="https://pic1.zhimg.com/v2-ade9a519a4329746e40d1de450863924_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='2054' height='286'></svg>)</p><p>然后，我们还可以自己定义一个模块用于我们的测试环境，这块就后面有机会再详细说明了</p><h2 id="testEnvironmentOptions">testEnvironmentOptions</h2><blockquote><p>Object（默认值：{}）</p></blockquote><pre><code>透传给测试环境的参数</code></pre><p>以 jsdom 环境为例，由于 jest-environment-jsdom 是基于 <a href="https://link.zhihu.com/?target=https%3A//github.com/jsdom/jsdom">jsdom</a> 封装的，所以如果想要更改这个环境的一些参数，可以利用这个配置项来修改</p><p>比如我们想修改当前window的url：</p><pre><code>// jest.config.jsmodule.exports = &#123;  testEnvironment: 'jsdom',  testEnvironmentOptions: &#123;    url: 'https://www.google.com/'  &#125;&#125;// 1.test.tsit(&quot;test env&quot;, () =&gt; &#123;  console.log(window.location.href)  expect(window.location.href).toBe('https://www.google.com/');&#125;)</code></pre><p>结果如下：</p><p><img src="https://pic3.zhimg.com/v2-30f781440d65bac2e2c2b675b1416ed6_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1904' height='308'></svg>)</p><h2 id="testFailureExitCode">testFailureExitCode</h2><blockquote><p>Number（默认值：1）</p></blockquote><p>自定义当jest执行用例出错时退出的返回码，比如配置为2:</p><p><img src="https://pic2.zhimg.com/v2-15c1e03ce17b1282839be9a3f2990231_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1518' height='462'></svg>)</p><p>需要注意的是，如果Jest本身报错（比如配置出错了），并不会更改这个码</p><h2 id="testPathIgnorePatterns">testPathIgnorePatterns</h2><blockquote><p>Array<string>（默认值：[‘node_modules’]）</p></blockquote><p>这个配置项就是配置一些需要跳过的测试文件的路径，作用和上文提到过的 modulePathIgnorePatterns 配置项作用有点类似，而且值也差不多，此处不再赘述</p><h2 id="transform">transform</h2><blockquote><p>Object&lt;string, pathToTransformer | [pathToTransformer, object]&gt;（默认值：{“\.[jt]sx?$”: “babel-jest”}）</p></blockquote><pre><code>transform配置是一个对象，用于定义在运行测试时，如何转换测试文件。&quot;\\.[jt]sx?$&quot;：键名表示要转换的文件的文件名的匹配模式。&quot;babel-jest&quot;：键值表示使用的转换器的名称如果你在Jest的配置文件中使用了transform配置，那么Jest在运行测试时会使用babel-jest转换器来转换所有符合&quot;^.+\.jsx?$&quot;这个匹配模式的文件。使用transform配置可以帮助你在运行测试时转换你的代码，从而可以使用最新的JavaScript语法进行测试</code></pre><p>我们可以利用后面的一个配置项 - transformIgnorePatterns 来进行简单的测试</p><p>transformIgnorePatterns这个配置项配置的是将一些文件忽略，不使用transform的转换器进行转换</p><pre><code>// transform/mod.jsexport default 1// transform/index.test.tsximport mod from './mod';it(&quot;test1&quot;, () =&gt; &#123;  expect(mod).toBe(1);&#125;)// jest.config.jsmodule.exports = &#123;  transform: &#123;    '^.+\.(js|jsx|ts|tsx)$': 'babel-jest',  &#125;,  transformIgnorePatterns: [    '&lt;rootDir&gt;/transform/'  ]&#125;;</code></pre><p>我们将transform下的模块不使用babel-jest，执行用例，会报错：</p><p><img src="https://pic3.zhimg.com/v2-ba9ff88d311c668a3c064d15621cf436_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='2162' height='964'></svg>)</p><p>因为mod模块是使用es模块导出的，而jest默认支持的是commonJS的规范，所以报错告诉我们不支持es的语法（当把mod换成commonJS规范导出之后，是没问题的）</p><p>然后我们把 transformIgnorePatterns 中的配置删除，mod.js 也走babel-jest进行转换，重新执行一遍用例，就正常了</p><p>Jest默认使用babel-jest作为转换器，当然也可以参考这一章来实现一个自定义的 transformer：<a href="https://link.zhihu.com/?target=https%3A//jestjs.io/docs/28.x/code-transformation">Code Transformation · Jest</a></p><h2 id="transformIgnorePatterns">transformIgnorePatterns</h2><blockquote><p>Array<string>（默认值：[“/node_modules/”, “\.pnp\.[^\\/]+$”]）</p></blockquote><p>具体功能在transform小节已经介绍过了，此处不再赘述</p><h2 id="testResultsProcessor">testResultsProcessor</h2><blockquote><p>String（默认值：undefined）</p></blockquote><pre><code>此选项允许使用自定义结果处理器这个处理器必须是一个node模块，它导出一个函数测试结果的数据参数会作为第一个参数传递给这个函数，需要将这个参数返回</code></pre><p>自定义一个结果处理器：</p><pre><code>// resultsProcessor.jsmodule.exports = function(config) &#123;  console.log(config)  const cfg = &#123;    ...config  &#125;  return cfg;&#125;// jest.config.jsmodule.exports = &#123;  testResultsProcessor: '&lt;rootDir&gt;/resultsProcessor.js'&#125;;</code></pre><p>config就是用例执行完成之后的数据，我们可以在这个函数中，对这些数据进行自定义的处理，比如生成一份自定义的测试报告，或者把这些数据上传到别的系统中进行分析等等</p><p>这个配置的作用有点类似于前面提到过的reporters，但这个处理函数只会在所有用例执行完成之后才会去执行，而reporters不一样，每个独立的测试文件执行完毕之后都会得到一份测试结果</p><h2 id="testRunner">testRunner</h2><blockquote><p>String（默认值：‘jest-circus/runner’）</p></blockquote><pre><code>这个配置项可以支持自定义一个运行器</code></pre><p>自定义的运行器需要满足下面的函数结构：</p><pre><code>function testRunner(  globalConfig: GlobalConfig,  config: ProjectConfig,  environment: Environment,  runtime: Runtime,  testPath: string,): Promise&lt;TestResult&gt;;</code></pre><p>作用也非常明显，比如可以使用它来执行特定的测试、控制测试的顺序或者执行其他自定义的操作</p><p>具体的实现可以参考下面官方放的一个自定义的运行器（目前暂时还不需要自定义，等需要的时候再去好好研究吧。。。）</p><p><a href="https://link.zhihu.com/?target=https%3A//github.com/facebook/jest/blob/main/packages/jest-jasmine2/src/index.ts">https://github.com/facebook/jest/blob/main/packages/jest-jasmine2/src/index.ts</a></p><h2 id="testSequencer">testSequencer</h2><p>总定义一个排序器，简单的说就是可以控制用例的执行部分和执行顺序</p><p>进行一些简单的准备工作，三个测试文件的名称长度我们都不一样，用于方便给自定义的排序器控制：</p><pre><code>// index.test.tsxit(&quot;test1&quot;, () =&gt; &#123;  expect(1).toBe(1);&#125;)// index1.test.tsxit(&quot;test1&quot;, () =&gt; &#123;  expect(1).toBe(1);&#125;)// index22.test.tsxit(&quot;test1&quot;, () =&gt; &#123;  expect(1).toBe(1);&#125;)</code></pre><p>配置一下路径：</p><pre><code>// jest.config.jsmodule.exports = &#123;  testSequencer: '&lt;rootDir&gt;/sequencer.js'&#125;;</code></pre><p>定义一个简单的sequencer：</p><pre><code>// sequencer.jsconst Sequencer = require('@jest/test-sequencer').default;class CustomSequencer extends Sequencer &#123;  /**   * 通过命令行 --shard=shardIndex/shardCount 来决定执行哪部分的测试文件   * 比如 --shard=2/3，意思就是将用例分成3份，执行第二份   * shard函数在sort函数前执行   */  shard(tests, &#123;shardIndex, shardCount&#125;) &#123;    const shardSize = Math.ceil(tests.length / shardCount);    const shardStart = shardSize * (shardIndex - 1);    const shardEnd = shardSize * shardIndex;    return [...tests].slice(shardStart, shardEnd);  &#125;  /**   * 对shard执行后的测试文件进行排序，以确定执行顺序   * sort函数在shard函数后执行   */  sort(tests) &#123;    const copyTests = Array.from(tests);    const resultTests = copyTests.sort((testA, testB) =&gt; (testA.path.length &gt; testB.path.length ? -1 : 1));    return resultTests;  &#125;&#125;module.exports = CustomSequencer;</code></pre><p>具体的说明在注释中已经写的比较详细了，此时shard函数的作用如注释，就是执行命令行中指定部分的用例，sort函数就是按测试文件的名称长度进行执行</p><p>执行命令：yarn test --shard=1/1，即执行全部的测试文件，执行顺序如下图所示：</p><p><img src="https://pic1.zhimg.com/v2-e76100be6255f0a80c63c4012e511778_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='2028' height='120'></svg>)</p><p>执行命令：yarn test --shard=2/3，即执行第二份测试文件，如下图所示：</p><p><img src="https://pic1.zhimg.com/v2-38245074613e1c19b2275e6059403ac8_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1474' height='206'></svg>)</p><h2 id="testMatch">testMatch</h2><pre><code>Jest用来检测测试文件的全局匹配表达式。默认情况下是获取 __tests__ 目录下的 js/ts/jsx/tsx 文件，以及任何后缀中带有 .test/.spec 的文件也会获取 test.js/spec.js</code></pre><p>配置哪些文件你是想进行测试的</p><h2 id="testRegex">testRegex</h2><p>作用同testMatch，不过两个配置不要同时定义，否则会报错</p><h2 id="testTimeout">testTimeout</h2><blockquote><p>Number（默认值：5000）</p></blockquote><p><a href="https://link.zhihu.com/?target=https%3A//github.com/facebook/jest/issues/9696">https://github.com/facebook/jest/issues/9696</a></p><h2 id="unmockedModulePathPatterns">unmockedModulePathPatterns</h2><blockquote><p>Array<string>（默认值）</p></blockquote><pre><code>一组用来匹配那些 被引入但是不需要被自动mock的模块的路径的 正则表达式如果某个模块匹配了其中的一个规则，那么就不会被自动mock</code></pre><p>这个配置项其实场景比较少，因为一般来说我们很少会开启 automock，如果有需要mock的模块，一般也会是在各个测试文件的内部去mock。</p><pre><code>// mod.tsmodule.exports = () =&gt; 1// mod1.tsmodule.exports = () =&gt; 2// index.test.tsxconst mockFn = require('./mod')const mockFn1 = require('./mod1')mockFn.mockReturnValue(3)mockFn1.mockReturnValue(4)it(&quot;test1&quot;, () =&gt; &#123;  expect(mockFn()).toBe(3);  expect(mockFn1()).toBe(4);&#125;)// jest.config.jsmodule.exports = &#123;  automock: true&#125;;</code></pre><p>由于开启了automock，所以此时执行用例是完全正常的。然后我们配置一下unmockedModulePathPatterns，将mod1排除：</p><pre><code>// jest.config.jsmodule.exports = &#123;  automock: true,  unmockedModulePathPatterns: [    '&lt;rootDir&gt;/unmockedModulePathPatterns/mod1.ts'  ]&#125;;</code></pre><p>再次执行，则会报错：</p><p><img src="https://pic3.zhimg.com/v2-1f1dfe4ea426e605aff2703d14472ade_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='2226' height='468'></svg>)</p><p>而mod还是automock，所以mod没有问题</p><h2 id="verbose">verbose</h2><blockquote><p>Boolean （默认值：false）</p></blockquote><p>就是执行的过程要不要把每个测试文件中的测试用例的状态给打印到控制台上：</p><p><img src="https://pic2.zhimg.com/v2-e66987176239a21b136d99d2255be7b5_b.jpg" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1794' height='400'></svg>)</p><p>开启</p><p><img src="https://pic2.zhimg.com/v2-0bc5b5029b5c2c2732af31825bf9f429_b.png" alt=""></p><p>![](data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1764' height='268'></svg>)</p><p>关闭</p><p>只有一个测试文件的话，默认为true</p><h2 id="watchPathIgnorePatterns">watchPathIgnorePatterns</h2><blockquote><p>Array<string> （默认值：[]）</p></blockquote><pre><code>一个正则表达式的路径数组，用来匹配那些不需要在 watch 模式下被重复执行的测试文件如果文件路径符合该数组中的某个规则，当这些文件更新的时候不会触发热重载这些规则是匹配绝对路径的，可以使用 &lt;rootDir&gt;用来表示根路径</code></pre><p>当然这个配置项只在 --watch 的模式下才会生效</p><h2 id="watchPlugins">watchPlugins</h2><blockquote><p>Array&lt;String ｜ [String, Object]&gt; （默认值：[]）</p></blockquote><pre><code>自定义使用的监听文件变化的插件数组</code></pre><p>用默认的就好了，具体有哪些插件可以去官网中查看</p><h2 id="watchMan">watchMan</h2><blockquote><p>Boolean（默认值：true）</p></blockquote><p>是否使用watchman对文件的更改进行监听</p><h2 id="总结">总结</h2><p>这篇文章写的对自己使用配置的时候的疑惑点都写了比较详细的补充，有些会用例子来说明下（貌似都喜欢看简洁的文章哈哈）</p><p>单测说实话确实是吃力不讨好的事情，一没什么技术难度，二也不会对产出有很大的显性帮助，更难的是个人感觉写单测有个前提条件就是<strong>需要团队稳定</strong>，因为单测也是需要去维护的。很多时候当业务逻辑更改的时候，单测也要同时去修改。变动比较频繁的话，单测就会被遗忘，逐渐没人维护，导致和业务代码偏移越来越大，最后就成鸡肋</p><p>但这玩意儿在后面代码重构或者涉及到大面积改动的时候，太有用了。而且一开始不写，后面再补是非常麻烦的，有时候甚至得先重写下代码才行。<strong>所以如果条件允许，还是建议写了</strong></p>]]></content>
      
      
      <categories>
          
          <category> 单元测试 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Express</title>
      <link href="/posts/d7c881ac.html"/>
      <url>/posts/d7c881ac.html</url>
      
        <content type="html"><![CDATA[<h3 id="Express">Express</h3><ul><li>由路由和中间件构成一个的 web 开发框架</li><li>中间件（Middleware） 是一个函数，它可以访问请求对象（request object）, 响应对象（response object）, 和 web 应用中处于请求-响应循环流程中的中间件，一般被命名为 next 的变量。</li></ul><p>通过<code>express生成器</code>快速创建一个应用骨架</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npx <span class="built_in">express</span>-generator</span><br><span class="line"><span class="built_in">express</span> -h</span><br><span class="line">&gt; 创建了一个名称为 myapp 的 Express 应用,并且设置为使用 Pug 模板引擎</span><br><span class="line"><span class="built_in">express</span> --<span class="built_in">view</span>=pug myapp</span><br><span class="line">cd myapp &amp;&amp; npm install</span><br><span class="line">在package.json里面</span><br><span class="line">“scripts”&#123;</span><br><span class="line"><span class="string">&quot;start&quot;</span>: <span class="string">&quot;supervisor ./bin/www&quot;</span>,</span><br><span class="line">  <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;node ./bin/www&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">启动项目：supervisor ./bin/www 或者 npm run serve</span><br></pre></td></tr></table></figure><h3 id="路由">路由</h3><ul><li>由一个 URI（或者叫路径）和一个特定的 HTTP 方法（GET、POST 等）组成的，涉及到应用如何响应客户端对某个网站节点的访问。<br>路由决定了由谁(指定脚本)去响应客户端请求</li></ul><h3 id="Middleware">Middleware</h3><ul><li>一系列的组件连接到一起，然后让http的请求依次流过这些组件。这些被connect串联起来的组件被称为中间件</li><li>应用级中间件</li><li>路由级中间件</li><li>错误处理中间件</li><li>内置中间件</li><li>第三方中间件</li></ul><blockquote><p>Express依赖于connect，connect是一个偏向基础设施的框架，提供了大量的中间件，可以通过app.use启用</p></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">basicAuth</span>():基本的认证中间件</span><br><span class="line">app.<span class="built_in">use</span>(express.<span class="built_in">basicAuth</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">bodyParser</span>():支持 JSON, urlencoded和multipart requests的请求体解析中间件。 这个中间件是<span class="built_in">json</span>(), <span class="built_in">urlencoded</span>(),和<span class="built_in">multipart</span>() 这几个中间件的简单封装.</span><br><span class="line">注意：不需要文件上传，最好关闭它。</span><br><span class="line">app.<span class="built_in">use</span>(express.<span class="built_in">bodyParser</span>());</span><br><span class="line"><span class="built_in">compress</span>():</span><br><span class="line">通过gzip / deflate压缩响应数据. 这个中间件应该放置在所有的中间件最前面以保证所有的返回都是被压缩的</span><br><span class="line"><span class="built_in">cookieParser</span>():</span><br><span class="line">解析请求头里的Cookie, 并用cookie名字的键值对形式放在 req.cookies 你也可以通过传递一个secret 字符串激活签名了的cookie</span><br><span class="line"><span class="built_in">cookitSession</span>():</span><br><span class="line">提供一个以cookie为基础的sessions, 设置在req.session里</span><br><span class="line">app.<span class="built_in">use</span>(express.<span class="built_in">cookieSession</span>());</span><br><span class="line">清掉一个cookie, 只需要在响应前把null赋值给session:</span><br><span class="line">req.session = null</span><br><span class="line"></span><br><span class="line">morgan 是nodejs的一个日志模块</span><br><span class="line">serve-favicon:请求网页的logo</span><br><span class="line">cookieParser中间件用于获取web浏览器发送的cookie中的内容</span><br><span class="line">body-parser：post参数的解析</span><br><span class="line">express-session：在request/response 中读写cookie</span><br><span class="line">app.<span class="built_in">use</span>(<span class="built_in">session</span>(&#123;</span><br><span class="line">  name: process.env.SESSION_NAME,    // session 名称</span><br><span class="line">  secret: process.env.SESSION_SECRET, </span><br><span class="line">  resave: false, </span><br><span class="line">  saveUninitialized: false, // 强制将未初始化的会话，保存到存储中， false 有助于解决客户机在没有会话情况下发出多个并行请求的竞争条件</span><br><span class="line">  // store: sessionStore, </span><br><span class="line">  cookie: &#123;                         <span class="comment">// 会话ID cookie的设置对象</span></span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    maxAge: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>,</span><br><span class="line">  &#125; </span><br><span class="line">&#125;));</span><br><span class="line">sequelize：操作数据库时，同样支持读写分离</span><br><span class="line">node-schedule：定时任务模块</span><br></pre></td></tr></table></figure><p><a href="http://cnodejs.org/topic/4fb79b0e06f43b56112b292c">connect 详解</a></p><h3 id="Application">Application</h3><ul><li>app.set是Express的参数设置工具，接受一个键(key)和一个值(value)，可以用的参数如下：</li></ul><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">basepath：基础机制，通常用于res.<span class="keyword">redirect</span>()跳转</span><br><span class="line">views：视图文件的目录，存放模版文件</span><br><span class="line">port：指定的端口</span><br><span class="line"><span class="keyword">view</span> engine:视图模块引擎(推荐使用ejs)</span><br><span class="line"><span class="keyword">view</span> <span class="keyword">options</span>：全局视图参数对象</span><br><span class="line"><span class="keyword">view</span> cache：启用视图缓存</span><br><span class="line">case sensitive routes：路径区分大小写</span><br><span class="line">strict routing：严格路径，启用后不会忽略路径末尾的<span class="string">&quot;/&quot;</span></span><br><span class="line">jsonp callback：开启透明的jsonp支持</span><br></pre></td></tr></table></figure><ul><li>app.configure中启用了五个中间件：</li></ul><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bodyParser：解析客户端请求。</span><br><span class="line">router：项目的路由支持</span><br><span class="line"><span class="keyword">static</span>:提供静态文件支持。</span><br><span class="line">methodOverride：函数重写</span><br><span class="line">errorHandler：错误控制器</span><br></pre></td></tr></table></figure><ul><li>app.locals:应用程序的本地变量对象</li></ul><p><strong>Express中路由会自动实现继承</strong> ???</p><h3 id="Request">Request</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">req.<span class="property">query</span>:解析get请求中的参数</span><br><span class="line">req.<span class="property">body</span>:解析post请求中的参数</span><br><span class="line">req.<span class="property">files</span>:上传文件的对象</span><br><span class="line">req.<span class="property">route</span>:当前匹配的route里包含的属性</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user/:id?&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">route</span>);</span><br><span class="line">&#125;);</span><br><span class="line">req.<span class="property">cookie</span>:用户代理传过来的cookies。</span><br><span class="line">req.<span class="title function_">get</span>(field):获取请求头里field的值。</span><br><span class="line">req.<span class="title function_">accepts</span>(types):检查给定的types是不是可以接受的类型，不能接收返回<span class="literal">undefined</span></span><br><span class="line">req.<span class="title function_">accepts</span>(<span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;text/html&quot;</span></span><br><span class="line">req.<span class="title function_">accepts</span>(<span class="string">&#x27;json, text&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;json&quot;</span></span><br><span class="line">req.<span class="title function_">accepts</span>(<span class="string">&#x27;application/json&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; &quot;application/json&quot;</span></span><br><span class="line"><span class="comment">// Accept: text/*, application/json</span></span><br><span class="line">req.<span class="title function_">accepts</span>(<span class="string">&#x27;image/png&#x27;</span>);  <span class="comment">// =&gt; undefined</span></span><br><span class="line">req.<span class="title function_">accepts</span>(<span class="string">&#x27;png&#x27;</span>);</span><br><span class="line"><span class="comment">// =&gt; undefined</span></span><br><span class="line">req.<span class="title function_">is</span>(type):检查请求的文件头是不是包含<span class="string">&quot;Content-Type&quot;</span> 字段, 它匹配给定的type</span><br><span class="line"><span class="comment">// With Content-Type: text/html; charset=utf-8</span></span><br><span class="line">req.<span class="title function_">is</span>(<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line">req.<span class="title function_">is</span>(<span class="string">&#x27;text/html&#x27;</span>);       <span class="comment">// =&gt; true</span></span><br><span class="line">req.<span class="title function_">is</span>(<span class="string">&#x27;text/*&#x27;</span>);</span><br><span class="line"></span><br><span class="line">req.<span class="property">ip</span>:返回远程地址</span><br><span class="line">req.<span class="property">ips</span>:当设置<span class="string">&quot;trust proxy&quot;</span> 为 <span class="string">`true`</span>时, 解析<span class="string">&quot;X-Forwarded-For&quot;</span> 里的ip地址列表，并返回一个数组 否则返回一个空数组</span><br><span class="line">req.<span class="property">path</span>:返回请求的<span class="variable constant_">URL</span>的路径名</span><br><span class="line"><span class="comment">// example.com:3000/users?sort=desc</span></span><br><span class="line">req.<span class="property">path</span></span><br><span class="line"><span class="comment">// =&gt; &quot;/users&quot;</span></span><br><span class="line">req.<span class="property">host</span> <span class="comment">//  =&gt; example.com</span></span><br><span class="line">  </span><br><span class="line">req.<span class="property">stale</span>:判断请求是不是旧的-如果<span class="title class_">Last</span>-<span class="title class_">Modified</span> 或者 <span class="title class_">ETag</span> 不匹配, 标明这个资源是<span class="string">&quot;旧的&quot;</span></span><br><span class="line">req.<span class="property">fresh</span>:判断请求是不是新的-通过对<span class="title class_">Last</span>-<span class="title class_">Modified</span> 或者 <span class="title class_">ETag</span> 进行匹配, 来标明这个资源是不是<span class="string">&quot;新的&quot;</span>.</span><br><span class="line">req.<span class="property">xhr</span>:判断请求头里是否有<span class="string">&quot;X-Requested-With&quot;</span>这样的字段并且值为<span class="string">&quot;XMLHttpRequest&quot;</span>, jQuery等库发请求时会设置这个头</span><br><span class="line">req.<span class="property">xhr</span> =&gt;<span class="literal">true</span></span><br><span class="line">req.<span class="property">protecol</span>:返回标识请求协议的字符串，一般是<span class="string">&quot;http&quot;</span>，当用<span class="variable constant_">TLS</span>请求的时候是<span class="string">&quot;https&quot;</span>。</span><br><span class="line">req.<span class="property">secure</span>:检查<span class="variable constant_">TLS</span> 连接是否已经建立 <span class="comment">// &#x27;https&#x27; == req.protocol;</span></span><br><span class="line">req.<span class="property">subdomains</span>:把子域当作一个数组返回</span><br><span class="line"><span class="comment">// Host: &quot;tobi.ferrets.example.com&quot;</span></span><br><span class="line">req.<span class="property">subdomains</span>  </span><br><span class="line"><span class="comment">// =&gt; [&quot;ferrets&quot;, &quot;tobi&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Req</span>.<span class="property">query</span>  req.<span class="property">body</span> req.<span class="property">params</span> 区别：</span><br><span class="line"><span class="title class_">Req</span>.<span class="property">params</span>是对前两者的封装---注意:</span><br><span class="line"><span class="string">``</span>/user/signup/:userId 在此路由路径下</span><br><span class="line"><span class="string">``</span>/user/signup/<span class="number">1111</span>?userId=<span class="number">1112</span> + &#123;userId：<span class="number">1113</span>&#125;</span><br><span class="line">通过req.<span class="property">params</span>取值的优先级:</span><br><span class="line">先拿<span class="number">1111</span> 没有拿<span class="number">1113</span> 最后拿 <span class="number">1112</span> </span><br></pre></td></tr></table></figure><h3 id="Response">Response</h3><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">res：响应对象向客户端返回响应</span><br><span class="line">res.<span class="keyword">set</span>(field,[value]):设置响应头字段field 值为 value, 也可以一次传入一个对象设置多个值</span><br><span class="line">res.<span class="keyword">set</span>(&#123;</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Content-Length&#x27;</span>: <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;ETag&#x27;</span>: <span class="string">&#x27;12345&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">res.get(field):返回一个大小写不敏感的响应头里的 field的值</span><br><span class="line">res.get(<span class="string">&#x27;Content-Type&#x27;</span>);</span><br><span class="line">// =&gt; <span class="string">&quot;text/plain&quot;</span></span><br><span class="line">设置COOKIE:</span><br><span class="line">res.cookie(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;tobi&#x27;</span>, &#123; domain: <span class="string">&#x27;.example.com&#x27;</span>, path: <span class="string">&#x27;/admin&#x27;</span>, secure: true &#125;);</span><br><span class="line">res.cookie(<span class="string">&#x27;rememberme&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, &#123; expires: new <span class="meta">Date</span>(Date.now() + 900000), httpOnly: true &#125;);</span><br><span class="line">把name的cookie清除. path参数默认为 <span class="string">&quot;/&quot;</span>.</span><br><span class="line">res.clearCookie(<span class="string">&#x27;name&#x27;</span>, &#123; path: <span class="string">&#x27;/admin&#x27;</span> &#125;);</span><br><span class="line">res.<span class="keyword">redirect</span>([status],url):</span><br><span class="line">使用可选的状态码跳转到url 状态码status默认为302 <span class="string">&quot;Found&quot;</span></span><br><span class="line">res.<span class="keyword">redirect</span>(<span class="string">&#x27;http://example.com&#x27;</span>);  //完整url</span><br><span class="line"></span><br><span class="line">res.<span class="keyword">redirect</span>(301, <span class="string">&#x27;http://example.com&#x27;</span>);</span><br><span class="line">res.<span class="keyword">redirect</span>(<span class="string">&#x27;/foo/bar&#x27;</span>);  //相对根域路径跳转</span><br><span class="line">res.location:程序根地址是blog，把location请求头设置为/blog/admin</span><br><span class="line">res.locatio<span class="meta">n</span>(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">res.charset:设置字符集，默认为<span class="string">&quot;utf-8&quot;</span></span><br><span class="line">res.charset=<span class="string">&quot;value&quot;</span></span><br><span class="line">res.type(type):设置Content-Type</span><br><span class="line">res.type(<span class="string">&#x27;application/json&#x27;</span>);</span><br><span class="line">res.attachment([<span class="keyword">filename</span>]):设置响应头的Content-Disposition 字段值为 <span class="string">&quot;attachment&quot;</span>.</span><br><span class="line">res.attachment();</span><br><span class="line">// Content-Disposition: attachment</span><br><span class="line">res.attachment(<span class="string">&#x27;path/to/logo.png&#x27;</span>);</span><br><span class="line">// Content-Disposition: attachment; <span class="keyword">filename</span>=<span class="string">&quot;logo.png&quot;</span></span><br><span class="line">// Content-Type: image/png</span><br><span class="line">res.sendfile(path,[<span class="keyword">options</span>],[fn]):</span><br><span class="line">它会根据文件的扩展名自动设置响应头里的Content-Type字段。 回调函数f<span class="meta">n</span>(err)在传输完成或者发生错误时会被调用执行。</span><br><span class="line">res.download(path,[<span class="keyword">filename</span>],[fn]):path所需传输附件的路径， 通常情况下浏览器会弹出一个下载文件的窗口。</span><br><span class="line">res.links(links):合并给定的links，并且设置给响应头里的<span class="keyword">link</span>字段</span><br><span class="line"></span><br><span class="line">res.locals:在某一次请求范围下的响应体的本地变量，只对此次请求期间的views可见</span><br><span class="line">  如：放置请求的路径名，验证过的用户，用户设置等等 </span><br><span class="line">app.use(functio<span class="meta">n</span>(req, res, next)&#123;</span><br><span class="line">  res.locals.user = req.user;</span><br><span class="line">  res.locals.authenticated = ! req.user.anonymous;</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">res.download()提示下载文件。</span><br><span class="line">res.<span class="keyword">end</span>()终结响应处理流程。</span><br><span class="line">res.jso<span class="meta">n</span>()发送一个 JSON 格式的响应。</span><br><span class="line">res.jsonp()发送一个支持 JSONP 的 JSON 格式的响应。</span><br><span class="line">res.<span class="keyword">redirect</span>()重定向请求。</span><br><span class="line">res.render()渲染视图模板。</span><br><span class="line">res.send()发送各种类型的响应。</span><br><span class="line">res.sendFile以八位字节流的形式发送文件。</span><br><span class="line">res.sendStatus()设置响应状态代码，并将其以字符串形式作为响应体的一部分发送。</span><br><span class="line">res.<span class="keyword">set</span>(<span class="string">&#x27;view&#x27;</span>, path.joi<span class="meta">n</span>(__dirname,<span class="string">&#x27;view&#x27;</span>));</span><br><span class="line">res.<span class="keyword">set</span>(<span class="string">&#x27;views engine&#x27;</span>,<span class="string">&#x27;html&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="HTML5-webSocket">HTML5 webSocket</h3><blockquote><p>在浏览器和服务器之间建立一个不受限的双向通信的通道</p></blockquote><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">首先，浏览器用wss:<span class="comment">//xxx创建WebSocket连接时，会先通过HTTPS创建安全的连接，然后，该HTTPS连接升级为WebSocket连接，底层通信走的仍然是安全的SSL/TLS协议</span></span><br><span class="line">解释：为了建立WebSocket 连接，客户端浏览器向服务器发起一个 HTTP 请求(新增附加头信息)，其中附加头信息<span class="string">&quot;Upgrade: WebSocket&quot;</span>表明这是一个申请协议升级的 HTTP 请求，服务器端解析附加的头信息然后产生应答信息返回给客户端，WebSocket 连接建立成功，双方就可以通过这个连接通道自由的传递信息,(连接持续，除非某一方主动关闭连接)。</span><br><span class="line"></span><br><span class="line">客户端：(通过制定url来与服务端建立连接)</span><br><span class="line"><span class="keyword">const</span> ws = new WebSocket(&#x27;ws:<span class="comment">//10.35.165.59:9000&#x27;); </span></span><br><span class="line">ws拥有的属性：</span><br><span class="line"><span class="comment">* ws.readyState:连接状态</span></span><br><span class="line"><span class="comment">* ws.bufferedAmount:还没被send():发出的utf-8文本</span></span><br><span class="line"><span class="comment">* ws.onopen: 用于指定连接成功后的回调函数</span></span><br><span class="line"><span class="comment">* ws.onmessage:客户端接收服务端数据时触发的回调函数</span></span><br><span class="line"><span class="comment">* ws.onclose:指定连接关闭后的触发的回调函数</span></span><br><span class="line"><span class="comment">* ws.onerror:报错时执行的回调函数</span></span><br><span class="line"><span class="comment">* ws.send():向服务器发送数据</span></span><br><span class="line"><span class="comment">* ws.close();关闭连接</span></span><br><span class="line"><span class="comment">* binaryType:在接收到服务器发来数据前，显示声明传来的数据类型</span></span><br><span class="line"><span class="comment">* bufferedAmount:表示还有多少个二进制字节没有发送出去,（用来判断发送是否结束）</span></span><br><span class="line">ReadyState 常量：</span><br><span class="line">Connecting 0 连接还没开启</span><br><span class="line"><span class="keyword">Open</span>:      1 连接已开启并准备好进行通信</span><br><span class="line">Closing:   2 连接正在关闭</span><br><span class="line">Closed:    3 连接已将关闭</span><br><span class="line"></span><br><span class="line">服务端：</span><br><span class="line">创建webSocket Server</span><br><span class="line"><span class="keyword">const</span> WebSocketServer = require(&#x27;ws&#x27;).Server;</span><br><span class="line"><span class="keyword">var</span> wss = new WebSocketServer(&#123;port: 9000&#125;);</span><br><span class="line">接入：</span><br><span class="line">wss.<span class="keyword">on</span>(&#x27;connection&#x27;,function(ws)&#123;</span><br><span class="line">    ws.<span class="keyword">on</span>(&#x27;message&#x27;,callback)</span><br><span class="line">    ws.<span class="keyword">on</span>(&#x27;<span class="keyword">close</span>&#x27;,callback)</span><br><span class="line">    ws.<span class="keyword">on</span>(&#x27;<span class="keyword">error</span>&#x27;,callback)    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Socket-IO-由两方面组成"><a href="http://Socket.IO">Socket.IO</a> 由两方面组成</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">一个服务器，集成了（或者挂载了）<span class="title class_">Node</span>.<span class="property">JS</span> <span class="variable constant_">HTTP</span> <span class="title class_">Server</span></span><br><span class="line">&gt; server端</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">&quot;socket.io&quot;</span>).<span class="title function_">listen</span>(<span class="number">80</span>);</span><br><span class="line">io.<span class="property">socket</span>.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>,<span class="keyword">function</span>(<span class="params">socket</span>)&#123;</span><br><span class="line">  socket.<span class="title function_">emit</span>(<span class="string">&quot;news&quot;</span>,&#123;hello,<span class="string">&#x27;world&#x27;</span>&#125;);</span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&quot;my other event&quot;</span>,<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">&gt; client端</span><br><span class="line"></span><br><span class="line"><span class="comment">// 浏览器端加载客户端库: socket.io-client</span></span><br><span class="line">&lt;script src=<span class="string">&quot;/socket.io/socket.io.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> socket = io.<span class="title function_">connect</span>(<span class="string">&quot;http://localhost&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  socket.<span class="title function_">on</span>(<span class="string">&quot;news&quot;</span>,<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    socket.<span class="title function_">emit</span>(<span class="string">&#x27;my other event&#x27;</span>,&#123;<span class="attr">my</span>:<span class="string">&quot;data&quot;</span>&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="others">others</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP协议：无状态协议</span><br><span class="line">第一次：客户端发送请求(cookie)<span class="comment">---&gt;服务器端创建sessionID给客户端(具有唯一性)--存储在cookie中</span></span><br><span class="line">第二次：客户端发送sessionID<span class="comment">----&gt;服务器端识别该用户</span></span><br><span class="line">客户端禁用cookie</span><br><span class="line"><span class="built_in">URL</span>重写技术：来进行会话跟踪</span><br><span class="line">客户端发送<span class="keyword">http</span>请求，url后面附加sid=xxxx，服务器端识别该用户。</span><br><span class="line">总结：</span><br><span class="line">Session是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中；</span><br><span class="line">Cookie是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现Session的一种方式，保存在浏览器中。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> NodeJS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>基础</title>
      <link href="/posts/20dbfd00.html"/>
      <url>/posts/20dbfd00.html</url>
      
        <content type="html"><![CDATA[<h3 id="Node-js-基础介绍">Node.js 基础介绍</h3><ul><li>一个基于Chrome JavaScript 运行时建立的一个平台（JS的解析器）</li><li>一个事件驱动 <code>IO</code> 服务端JavaScript环境，基于Google的V8引擎<ul><li>操作磁盘文件</li><li>HTTP服务器</li><li>事件机制和异步<code>IO</code>模型</li><li>…</li></ul></li><li>自带 交互解释器 repl</li></ul><h3 id="Node-js能做什么">Node.js能做什么?</h3><ol><li>JavaScript由客户端而产生，Node.js为网络而生</li><li>基于社交网络的web应用</li><li>web Socket服务器</li><li>TCP/UDP套接应用程序</li><li>命令行工具</li><li>交互式终端程序</li></ol><h3 id="NodeJs历史版本下载">NodeJs历史版本下载</h3><ul><li><a href="https://nodejs.org/dist/">https://nodejs.org/dist/</a></li><li>偶数版为稳定版</li></ul><h3 id="进程">进程</h3><ul><li>计算机核心是CPU 单个CPU 一次只能运行一个进程(其他进程处于非运行状态)</li><li>一个进程可以包括多个线程<ul><li>一个进程中的内存空间是共享的，每个线程都可以共享内存</li><li>特殊：共享内存中有些内存一次只能一个线程享用!!!,其他线程必须等它结束后，才能使用这块内存</li><li>互斥锁：防止多个线程同时读写某一块内存区域</li><li>有些内存只能供固定数目的线程使用(进去的人每人领一把钥匙—信号量)—保证多个线程互相不会冲突</li></ul></li></ul><h3 id="线程">线程</h3><ul><li>操作系统能够进行运算调度的最小单位</li><li>一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并行多个线程，每个线程并行执行不同的任务</li></ul><h3 id="操作系统的设计">操作系统的设计</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">（1）以多进程形式，允许多个任务同时运行</span><br><span class="line">（2）以多线程形式，允许单个任务分成不同的部分运行</span><br><span class="line">（3）提供协调机制，一方面防止进程之间和线程之间产生冲突，另一方面允许进程之间和线程之间共享资源</span><br></pre></td></tr></table></figure><h3 id="异步式I-O与事件驱动">异步式I/O与事件驱动</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">例如：我们可以一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。</span><br><span class="line">     这样在执行代码时就没有阻塞或等待文件 I/O 操作。这就大大提高了 <span class="title class_">Node</span>.<span class="property">js</span> 的性能，可以处理大量的并发请求。</span><br><span class="line">     <span class="title class_">Node</span>.<span class="property">js</span>最大的特性就是采用异步式I/O与事件驱动的架构设计:</span><br><span class="line">     对于高并发的解决方案，传统的架构是多线程模型，也就是为每个业务逻辑提供一个系统线程，通过系统线程切换来弥补同步式I/O调用时的时间开销。</span><br><span class="line">     <span class="title class_">Node</span>.<span class="property">js</span>使用的是单线程模型，在执行的过程中会维护一个事件对列</span><br><span class="line">&gt; <span class="title class_">Node</span>.<span class="property">js</span> 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通</span></span><br><span class="line">res=db.<span class="title function_">query</span>(<span class="string">&quot;select * from user&quot;</span>);</span><br><span class="line">res.<span class="title function_">output</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node.js   </span></span><br><span class="line">res=db.<span class="title function_">query</span>(<span class="string">&quot;select * from user&quot;</span>,<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">output</span>());</span><br></pre></td></tr></table></figure><h3 id="Node-Js-vs-php-150个线程">Node.Js  vs  php(150个线程)</h3><!-- 六、特点：快，消耗内存。 --><ul><li>优点<ul><li>性能高(机制问题)</li><li>开发效率高(省了不少优化的事)</li><li>应用范围广(可以开发桌面系统-electron框架)</li></ul></li><li>缺点：<ul><li>新，人少(可替代性低)</li><li>中间件少，IDE不完善</li></ul></li></ul><blockquote><p>Node.js最大的特性就是异步式I/O与事件紧密结合的编程模式。这种模式与传统的同步式IO线性的编程思路有很大的不同，因为控制流很大程度上要靠事件和回调函数来组织，一个逻辑要拆分为若干个单元格。</p></blockquote><h3 id="阻塞和线程">阻塞和线程</h3><ul><li>同步式I/O或阻塞式I/O</li></ul><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">线程在执行中如果遇到磁盘读写或网络通信，通常要耗费较长时间。这时操作系统会剥夺这个线程的<span class="variable">CPU</span>控制权，使其暂停执行，同时将资源让给其它的工作线程，这种线程调度方式成为阻塞，当<span class="built_in">I</span><span class="operator">/</span><span class="built_in">O</span>操作完毕时，操作系统将这个线程的阻塞状态解除，恢复其对<span class="variable">CPU</span>的控制权、令其继续执行</span><br></pre></td></tr></table></figure><ul><li>异步式I/O或非阻塞式I/O</li></ul><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">针对所有<span class="built_in">I</span><span class="operator">/</span><span class="built_in">O</span>操作不采用阻塞策略，当线程遇到<span class="built_in">I</span><span class="operator">/</span><span class="built_in">O</span>操作时，不会以阻塞的方式等待<span class="built_in">I</span><span class="operator">/</span><span class="built_in">O</span>操作的完成或数据的返回，而只是讲<span class="variable">IO</span>请求发送给操作系统，继续执行下一条语句，当操作系统完成<span class="variable">IO</span>操作时，以事件的形式通知执行<span class="variable">IO</span>操作的线程，线程会在特定时候处理这个事件，为了 处理异步<span class="variable">IO</span>，线程必须有事件循环，不断的检查有没有未处理的事件，依次予以处理</span><br></pre></td></tr></table></figure><ul><li>非阻塞与阻塞模式区别</li></ul><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">非阻塞模式下，一个线程永远在执行计算操作，这个线程所使用的<span class="meta">CPU</span>核心利用率永远是<span class="number">100</span>%，IO以事件的方式通知</span><br><span class="line">阻塞模式下，多线程往往能提高系统吞吐量，因为一个线程阻塞还有其他线程在工作，多线程可以让<span class="meta">CPU</span>资源不被阻塞中的线程浪费</span><br></pre></td></tr></table></figure><ul><li>调度：当前一个工作,在5分钟之后执行</li><li>同步式IO与异步式IO区别<table><thead><tr><th>同步式IO(阻塞式)</th><th>异步式IO(非阻塞)</th></tr></thead><tbody><tr><td>利用多线程提供吞吐量</td><td>单线程即可实现高吞吐量</td></tr><tr><td>通过事件片分割和线程调度利用多核CPU</td><td>通过功能划分利用多核</td></tr><tr><td>需要由操作系统调度多线程使用多核CPU</td><td>可以将单线程绑定到单核CPU</td></tr><tr><td>难以充分利用CPU资源</td><td>可以充分利用CPU资源</td></tr><tr><td>内存轨迹大，数据局部性弱</td><td>内存轨迹小，数据局部性强</td></tr><tr><td>符合线性的编程思维</td><td>不符合传统编程思维</td></tr></tbody></table></li></ul><h3 id="模块化">模块化</h3><ul><li>exports<ul><li>模块公开的接口</li></ul></li><li>require<ul><li>用于从外部获取一个模块的接口(所获取模块的 exports 对象)</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>方法接受以下几种参数的传递：</span><br><span class="line">  http、fs、path等，原生模块</span><br><span class="line">  ./mod或../mod，相对路径的文件模块</span><br><span class="line">  /pathtomodule/mod，绝对路径的文件模块</span><br><span class="line">  **mod，非原生模块的文件模块**</span><br><span class="line"><span class="comment">// 原生模块的优先级仅次于文件模块的优先级</span></span><br><span class="line"><span class="comment">// Node会依次在内置模块、全局模块和当前模块下查找</span></span><br></pre></td></tr></table></figure></li></ul><p>经典事例：<br>1. 利用node.js创建一个http服务<br>2. Buffer对象使得JavaScript可以在诸如TCP流和文件操作系统的上下文中与二进制数据流进行交互</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建HTTP服务端服务</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">request,response</span>)&#123;</span><br><span class="line">  response.<span class="title function_">writeHead</span>(<span class="number">200</span>,&#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>&#125;);</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">url</span>);  <span class="comment">//返回 ‘/’后的路径</span></span><br><span class="line">    <span class="comment">//解决进入首页图片显示问题</span></span><br><span class="line">  <span class="keyword">if</span>(request.<span class="property">url</span> !== <span class="string">&#x27;/favicon.ico&#x27;</span>)&#123;   <span class="comment">//后台打印只打印一次</span></span><br><span class="line">    response.<span class="title function_">write</span>(<span class="string">&#x27;首页&#x27;</span>); </span><br><span class="line">    <span class="keyword">var</span> path = request.<span class="property">url</span>.<span class="title function_">split</span>(<span class="string">&#x27;?&#x27;</span>)[<span class="number">0</span>].<span class="title function_">replace</span>(<span class="regexp">/\//</span>, <span class="string">&#x27;&#x27;</span>);  <span class="comment">// 返回list.php</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      router[path](response,request);  <span class="comment">//发请求请求数据</span></span><br><span class="line">    &#125; <span class="keyword">catch</span>(err)&#123;</span><br><span class="line">      router[<span class="string">&#x27;home&#x27;</span>](response);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP客户端</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于请求的选项</span></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="string">&#x27;8081&#x27;</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/index.html&#x27;</span>  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理响应的回调函数</span></span><br><span class="line"><span class="keyword">var</span> callback = <span class="keyword">function</span>(<span class="params">response</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> body = <span class="string">&#x27;&#x27;</span>;    <span class="comment">// 不断更新数据</span></span><br><span class="line">  response.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">chunks</span>) &#123;</span><br><span class="line">  body += chunks;</span><br><span class="line">  &#125;);   </span><br><span class="line">  response.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(body);   <span class="comment">// 数据接收完成</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回 http.ClientRequest 类对象</span></span><br><span class="line"><span class="keyword">var</span> req = http.<span class="title function_">request</span>(options, callback);</span><br><span class="line">req.<span class="title function_">end</span>();</span><br></pre></td></tr></table></figure><h3 id="Node中的常用模块解析">Node中的常用模块解析</h3><ul><li><p>__filename 表示当前正在执行的脚本所在的目录(包含文件名）</p></li><li><p>__dirname 表示当前执行脚本所在的目录</p></li><li><p>Path</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Path</span>.sep:返回操作系统返回路径的分隔符</span><br><span class="line"><span class="keyword">Path</span>.extname():获取文件扩展名</span><br></pre></td></tr></table></figure></li><li><p>url</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">URL</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> myURL = <span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;http://www.imooc.com:8080/list.php?courseid=8&amp;chapterId=86#mediaid118&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动将Unicode字符通过punycode算法转化为ASCII编码</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myURL.<span class="property">host</span>);  <span class="comment">//  www.imooc.com:8080</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myURL.<span class="property">hostname</span>);  <span class="comment">//  www.imooc.com</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myURL.<span class="property">hash</span>);  <span class="comment">//  #mediaid118</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myURL.<span class="property">href</span>);  <span class="comment">//  获取及设置序列化的url --&gt;输出原url</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myURL.<span class="property">origin</span>);  <span class="comment">//  http://www.imooc.com:8080</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myURL.<span class="property">pathname</span>);  <span class="comment">//  list.php</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myURL.<span class="property">searchParams</span>.<span class="title function_">get</span>(<span class="string">&#x27;courseid&#x27;</span>));  <span class="comment">//  8</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myURL.<span class="property">search</span>); <span class="comment">// `?courseid=8&amp;chapterId=86#mediaid118`</span></span><br><span class="line"><span class="comment">// searchParams该模块提供了对查询部分功能的分装</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">const myURL = new URL(&#x27;https://abc:xyz@www.imooc.com:8080&#x27;);</span></span><br><span class="line"><span class="comment">console.log(myURL.username); // abc </span></span><br><span class="line"><span class="comment">console.log(myURL.password); // xyz</span></span><br><span class="line"><span class="comment">console.log(myURL.port); // 8080   范围在0-65535范围内</span></span><br><span class="line"><span class="comment">console.log(myURL.protocol); // https</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">url.<span class="title function_">parse</span>(urlString)  <span class="comment">// 返回一个url对象</span></span><br><span class="line"><span class="title class_">Url</span>.<span class="title function_">format</span>(urlString) <span class="comment">// 将url对象格式化为url字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 案例：</span></span><br><span class="line"><span class="keyword">var</span> url=<span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> a=url.<span class="title function_">parse</span>(<span class="string">&#x27;http://www.imooc.com:8080/list.php?courseid=8&amp;chapterId=86#mediaid118&#x27;</span>, <span class="literal">false</span>).<span class="property">query</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"><span class="comment">// Url &#123;</span></span><br><span class="line"><span class="comment">//   protocol: &#x27;http:&#x27;,</span></span><br><span class="line"><span class="comment">//   slashes: true,</span></span><br><span class="line"><span class="comment">//   auth: null,</span></span><br><span class="line"><span class="comment">//   host: &#x27;www.imooc.com:8080&#x27;,</span></span><br><span class="line"><span class="comment">//   port: &#x27;8080&#x27;,</span></span><br><span class="line"><span class="comment">//   hostname: &#x27;www.imooc.com&#x27;,</span></span><br><span class="line"><span class="comment">//   hash: &#x27;#mediaid118&#x27;,</span></span><br><span class="line"><span class="comment">//   search: &#x27;?courseid=8&amp;chapterId=86&#x27;,</span></span><br><span class="line"><span class="comment">//   query: &#x27;courseid=8&amp;chapterId=86&#x27;,   //设置true即可装换为对象</span></span><br><span class="line"><span class="comment">//   pathname: &#x27;/list.php&#x27;,</span></span><br><span class="line"><span class="comment">//   path: &#x27;/list.php?courseid=8&amp;chapterId=86&#x27;,</span></span><br><span class="line"><span class="comment">//   href: &#x27;http://www.imooc.com:8080/list.php?courseid=8&amp;chapterId=86#mediaid118&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// URL.format():将对象转化为url地址</span></span><br><span class="line">url.<span class="property">resolve</span>:替换 域名后面第一个“/”后的内容；</span><br><span class="line">ulr.<span class="title function_">resolve</span>(<span class="string">&quot;http://www.imooc.com&quot;</span>,<span class="string">&quot;/course/list&quot;</span>) <span class="comment">// http://www.imooc.com/course/list</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h3 id="querystring">querystring</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; 反序列化：</span><br><span class="line"><span class="keyword">var</span> a=querystring.<span class="title function_">parse</span>(<span class="string">&#x27;courseid=8&amp;chapterId=86&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"><span class="comment">// &#123; &#x27;courseid&#x27;: &#x27;8&#x27;,chapterId: &#x27;86&#x27; &#125;</span></span><br><span class="line">&gt; 序列化：</span><br><span class="line">querystring.<span class="title function_">stringify</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;scott&#x27;</span>,<span class="attr">course</span>:[<span class="string">&#x27;jade&#x27;</span>,<span class="string">&#x27;node&#x27;</span>],<span class="attr">from</span>:<span class="string">&#x27;&#x27;</span>&#125;);</span><br><span class="line"><span class="comment">// &#x27;name=scott&amp;course=jade&amp;course=node&amp;from=&#x27;</span></span><br><span class="line">querystring.<span class="title function_">stringify</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;scott&#x27;</span>,<span class="attr">course</span>:[<span class="string">&#x27;jade&#x27;</span>,<span class="string">&#x27;node&#x27;</span>],<span class="attr">from</span>:<span class="string">&#x27;&#x27;</span>&#125;,<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"><span class="comment">// &#x27;name=scott,course=jade,course=node,from=&#x27;</span></span><br><span class="line">querystring.<span class="title function_">stringify</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;scott&#x27;</span>,<span class="attr">course</span>:[<span class="string">&#x27;jade&#x27;</span>,<span class="string">&#x27;node&#x27;</span>],<span class="attr">from</span>:<span class="string">&#x27;&#x27;</span>&#125;,<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line"><span class="comment">// &#x27;name:scott,course:jade,course:node,from:&#x27;</span></span><br><span class="line">&gt; 转义：</span><br><span class="line">querystring.<span class="built_in">escape</span>(<span class="string">&#x27;&lt;哈哈&gt;&#x27;</span>);</span><br><span class="line"><span class="comment">// &#x27;%3C%E5%93%88%E5%93%88%3E&#x27;</span></span><br><span class="line">querystring.<span class="built_in">unescape</span>(<span class="string">&#x27;%3C%E5%93%88%E5%93%88%3E&#x27;</span>);</span><br><span class="line"><span class="comment">// 哈哈</span></span><br></pre></td></tr></table></figure><h3 id="fs">fs</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">readFileSync</span>:<span class="keyword">function</span>(<span class="params">response</span>)&#123;   <span class="comment">// 同步文件读取  注意引入路径</span></span><br><span class="line">    <span class="keyword">var</span> data=fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./tpls/index.html&#x27;</span>);</span><br><span class="line">    response.<span class="title function_">write</span>(data);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">readFile</span>:<span class="keyword">function</span>(<span class="params">response,file</span>)&#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(file,<span class="string">&#x27;utf-8&#x27;</span>,<span class="keyword">function</span>(<span class="params">err,data</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      response.<span class="title function_">write</span>(data);</span><br><span class="line">      response.<span class="title function_">end</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">writeFile</span>:<span class="keyword">function</span> (<span class="params">response,file</span>) &#123;  <span class="comment">//异步文件写入/创建</span></span><br><span class="line">    fs.<span class="title function_">writeFile</span>(file,<span class="string">&#x27;abc&#x27;</span>,<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">      response.<span class="title function_">write</span>(<span class="string">&#x27;写入成功&#x27;</span>);</span><br><span class="line">      response.<span class="title function_">end</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">stat</span>:<span class="keyword">function</span> (<span class="params">response,file</span>) &#123;   <span class="comment">//地址栏输入错误，跳转首页</span></span><br><span class="line">    fs.<span class="title function_">stat</span>(file,<span class="keyword">function</span>(<span class="params">err,stats</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(stats);</span><br><span class="line">        response.<span class="title function_">end</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 执行 file.readFile(response,&#x27;./tpls/index.html&#x27;);</span></span><br></pre></td></tr></table></figure><h3 id="stream流">stream流</h3><blockquote><p>案例：  在input.txt中写入内容 <code>hello world</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">// 创建可读流</span></span><br><span class="line"><span class="keyword">var</span> readerStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line">readerStream.<span class="title function_">setEncoding</span>(<span class="string">&#x27;UTF8&#x27;</span>);  <span class="comment">// 设置编码格式</span></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">chunk</span>) &#123;</span><br><span class="line">  data += chunk;</span><br><span class="line">&#125;);</span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br><span class="line"> </span><br><span class="line">&gt; 写入数据流</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line"><span class="comment">// 创建一个可以写入的流，写入到文件 output.txt 中</span></span><br><span class="line"><span class="keyword">var</span> writerStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line">writerStream.<span class="title function_">write</span>(data,<span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line">writerStream.<span class="title function_">end</span>();  <span class="comment">// 标记文件末尾</span></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></span><br><span class="line">writerStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入完成。&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">writerStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br><span class="line"> </span><br><span class="line">&gt; 管道流：提供一个输出流到输入流动的机制</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> readerStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> writerStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;output.txt&#x27;</span>);</span><br><span class="line"><span class="comment">// 管道读写操作</span></span><br><span class="line"><span class="comment">// 读取 input.txt 文件内容，并将内容写入到 output.txt 文件中</span></span><br><span class="line">readerStream.<span class="title function_">pipe</span>(writerStream);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; 链式流：通过连接输出流到另外一个流并创建多个对个流操作链的机制，用管道和链式来压缩和解压文件</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"><span class="comment">// 压缩 input.txt 文件为 input.txt.gz</span></span><br><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>)</span><br><span class="line">  .<span class="title function_">pipe</span>(zlib.<span class="title function_">createGzip</span>())</span><br><span class="line">  .<span class="title function_">pipe</span>(fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件压缩完成&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="exec">exec</h3><ul><li>child_process:创建子进程</li></ul><h3 id="调试模块：util">调试模块：util</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line">util.<span class="title function_">inspect</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;lijiahao&#x27;</span>&#125;, <span class="literal">true</span>)：将任意对象转换为字符串</span><br><span class="line">util.<span class="title function_">isArray</span>(object)  <span class="comment">// true或false</span></span><br><span class="line">util.<span class="title function_">isRegExp</span>(object) <span class="comment">// 是否为正则对象</span></span><br></pre></td></tr></table></figure><h3 id="Inspector">Inspector</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">child_process模块中提供了spawn 和 exec 这两个方法，用来开启子进程执行指定程序。</span><br><span class="line"><span class="title class_">Process</span>:描述<span class="title class_">Node</span>.<span class="property">js</span>进程状态,提供了一个与操作系统的简单接口</span><br><span class="line">process.<span class="property">stdin</span>.<span class="title function_">resume</span>();    <span class="comment">//恢复标准输入流</span></span><br><span class="line">process.<span class="property">stdin</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">&#x27;read from console: &#x27;</span> + data.<span class="title function_">toString</span>());  <span class="comment">//标准输出流</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="net-网络-模块">net(网络)模块</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">客户端：</span><br><span class="line">client=new <span class="keyword">net</span>.Socket();  <span class="comment">//创建一个客户端</span></span><br><span class="line">client.setEncoding(&#x27;binary&#x27;);</span><br><span class="line">client.connect(port,host,cb); <span class="comment">//创建连接</span></span><br><span class="line">client可监听三个事件：</span><br><span class="line"><span class="comment">* data:</span></span><br><span class="line"><span class="comment">* error:</span></span><br><span class="line"><span class="comment">* close:</span></span><br><span class="line">服务端：</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">net</span> = require(&#x27;<span class="keyword">net</span>&#x27;);</span><br><span class="line"><span class="keyword">var</span> Server = <span class="keyword">net</span>.createServer(client); <span class="comment">//创建服务端</span></span><br><span class="line">server可监听四个事件：</span><br><span class="line"><span class="comment">* connection:</span></span><br><span class="line"><span class="comment">* data:</span></span><br><span class="line"><span class="comment">* error:</span></span><br><span class="line"><span class="comment">* close:</span></span><br><span class="line">broadcast():广播事件</span><br></pre></td></tr></table></figure><h3 id="events">events</h3><ul><li>Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列</li><li>events.EventEmitter:事件触发和事件监听</li><li><strong>socket即是基于此对象进行通讯的</strong></li></ul><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> events=require(<span class="string">&quot;events&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> emitter = <span class="keyword">new</span> events.EventEmitter(); </span><br><span class="line">emitter.on(<span class="string">&#x27;someEvent&#x27;</span>, <span class="keyword">function</span>(<span class="params">arg1, arg2</span>) &#123; </span><br><span class="line"><span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&#x27;listener1&#x27;</span>, arg1, arg2); </span><br><span class="line">&#125;);</span><br><span class="line">emitter.emit(<span class="string">&#x27;someEvent&#x27;</span>, <span class="string">&#x27;arg1 参数&#x27;</span>, <span class="string">&#x27;arg2 参数&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="Buffer">Buffer</h3><ul><li>用来创建存储二进制数据的缓存区，使得Node.js可以处理二进制数据</li><li><strong>一个 Buffer 类似于一个整数数组</strong></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">buf = <span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="number">256</span>);   <span class="comment">//创建长度为256字节的buffer实例</span></span><br><span class="line">len = buf.<span class="title function_">write</span>(<span class="string">&quot;www.w3cschool.cn&quot;</span>);<span class="comment">//写入node缓冲区</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解码缓冲区数据并使用指定的编码返回字符串</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( buf.<span class="title function_">toString</span>(<span class="string">&#x27;ascii&#x27;</span>));       <span class="comment">// 输出: www.w3cschool.com</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( buf.<span class="title function_">toString</span>(<span class="string">&#x27;ascii&#x27;</span>,<span class="number">0</span>,<span class="number">5</span>));   <span class="comment">// 输出: www.w 【左闭右开】</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( buf.<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>,<span class="number">0</span>,<span class="number">5</span>));    <span class="comment">// 输出: www.w 【左闭右开】</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( buf.<span class="title function_">toString</span>(<span class="literal">undefined</span>,<span class="number">0</span>,<span class="number">5</span>)); <span class="comment">// 使用 &#x27;utf8&#x27; 编码, 并输出: abcde</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将Buffer转为JSON对象：</span></span><br><span class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="string">&#x27;www.w3cschool.cn&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> json = buf.<span class="title function_">toJSON</span>(buf);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123; type: &#x27;Buffer&#x27;,</span></span><br><span class="line"><span class="comment">  data: [ 119, 119, 119, 46, 119, 51, 99, 115, 99, 104, 111, 111, 108, 46, 99, 110 ]</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> buffer1 = <span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="string">&#x27;W3Cschool教程 &#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> buffer2 = <span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="string">&#x27;www.w3cschool.cn&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> buffer3 = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([buffer1,buffer2]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;buffer3 内容: &quot;</span> + buffer3.<span class="title function_">toString</span>());</span><br><span class="line"><span class="comment">// buffer3 内容: W3Cschool教程 www.w3cschool.cn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ret = buf.<span class="title function_">compare</span>(otherBuffer);   ret代表了谁在谁之前。</span><br></pre></td></tr></table></figure><h3 id="process">process</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">process.<span class="property">stdout</span>:标准信息输出</span><br><span class="line"><span class="comment">// Process.stdout.write(&#x27;this is stdout&#x27;)</span></span><br><span class="line">process.<span class="property">stderr</span>:标准错误输出</span><br><span class="line">process.<span class="property">stdin</span>:读取用户键盘输入</span><br><span class="line"><span class="comment">// 读取文本信息只需设定utf-8即可</span></span><br><span class="line">process.<span class="property">stdin</span>.<span class="title function_">setEncoding</span>(<span class="string">&#x27;uft-8&#x27;</span>)</span><br><span class="line"><span class="comment">// 注册一个 &#x27;data&#x27; 监听事件</span></span><br><span class="line">process.<span class="property">stdin</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>,<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> _data = data.<span class="title function_">toString</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(_data);</span><br><span class="line">&#125;)</span><br><span class="line">process.<span class="property">stdin</span>.<span class="title function_">off</span>(<span class="string">&#x27;data&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;write end&#x27;</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="string">``</span>常用的两个事件<span class="string">``</span></span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;exit&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 程序的正常退出</span></span><br><span class="line">&#125;)</span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;sigint&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">//程序不会进行退出</span></span><br><span class="line">  process.<span class="title function_">exit</span>()  <span class="comment">//程序正常退出</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&gt; 常用的变量</span><br><span class="line"><span class="title class_">Eg</span>: 用node 执行 <span class="attr">E</span>:<span class="regexp">/node/</span>process/process.<span class="property">js</span></span><br><span class="line">[ <span class="string">&#x27;C:\\Program Files\\nodejs\\node.exe&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;E:\\node\\process\\process.js&#x27;</span> ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="一个完整的-href-链接解析">一个完整的** href **链接解析</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      |<span class="string">        主机       </span>|</span><br><span class="line">协议   |<span class="string">                  </span>|<span class="string">pathname</span>|<span class="string">      search          </span>|<span class="string">  hash值</span></span><br><span class="line"><span class="string">http://www.imooc.com:8080/list.php?courseid=8&amp;chapterId=86#mediaid118</span></span><br><span class="line"><span class="string">      </span>|<span class="string">   主机名    </span>|</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Chrome:  window<br>Node.js: global</p>]]></content>
      
      
      <categories>
          
          <category> NodeJS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>framework</title>
      <link href="/posts/9d766e19.html"/>
      <url>/posts/9d766e19.html</url>
      
        <content type="html"><![CDATA[<h3 id="Spring-Framework-分层">Spring Framework 分层</h3><blockquote><p>MVC: model、view、controller</p></blockquote><ul><li><p>模型（Model）代表数据控制器。数据的读取，插入，更新都是由模型来负责</p><ul><li><p>Service:业务逻辑模型</p><ul><li>对controller 层传来的数据进行业务处理及封装[ServiceImplement]</li></ul></li><li><p>DAO:数据访问对象</p><ul><li>对 Service 层数据写入数据库</li></ul></li><li><p>Entity: 实体类映射模型</p><ul><li>[好处]独立业务逻辑及数据库访问</li></ul></li></ul></li><li><p>视图（View）是展示给用户的最终页面。视图负责将数据以用户友好的形式展现出来</p></li><li><p>控制器（Controller）是模型，视图以及其他任何处理 HTTP 请求的转发器</p><ul><li>控制解析(将servlet截获然后转向指定处理方法)</li></ul></li></ul><h3 id="典型的页面浏览行为在程序端的流程">典型的页面浏览行为在程序端的流程</h3><ul><li>控制器最先被调用，并被赋予外部输入</li><li>控制器根据外部输入向模型请求数据</li><li>模型从数据库获取数据并发送数据到控制器</li><li>控制器处理该数据并发送封装好的数据到视图</li><li>视图根据接到的数据最终展示页面给用户浏览</li></ul><p>常见注解：<br>@Repository，标志DAO层<br>@Service，标志业务层，在实现类前标志要跟bean同名<br>@Controller，标志控制层，请求转发器<br>@Component，不确定是哪一层的时候标志<br>@RequestMapping<br>@<br>…</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>项目实战</title>
      <link href="/posts/a3304ead.html"/>
      <url>/posts/a3304ead.html</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-Boot-介绍">Spring Boot 介绍</h2><h3 id="特点">特点</h3><ul><li>创建独立的Spring容器应用</li><li>内嵌容器 tomcat/jetty/undertow 无须war部署</li><li>自动配置spring配置</li><li>简化maven配置</li><li>开箱即用、无须配置 xml</li></ul><h3 id="快速创建应用-quick-start">快速创建应用 quick start</h3><ul><li><a href="https://start.spring.io/">https://start.spring.io/</a></li></ul><h3 id="docs">docs</h3><ul><li><a href="https://docs.spring.io/spring-boot/docs">https://docs.spring.io/spring-boot/docs</a></li></ul><h3 id="项目框架">项目框架</h3><ul><li>Controller 请求处理函数</li><li>Service</li><li>Dao 查数据库，并组装 List</li></ul><h3 id="数据库访问">数据库访问</h3><blockquote><p>Java App -&gt; JDBC Interface(JDK 提供) -&gt; JDBC Driver -&gt; Database</p></blockquote><ul><li>JDBC Java程序访问数据库的标准接口</li><li>JDK 提供了JDBC接口、数据库厂商提供了JDBC 驱动</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>常用注解</title>
      <link href="/posts/449ecf69.html"/>
      <url>/posts/449ecf69.html</url>
      
        <content type="html"><![CDATA[<h2 id="Spring常用注解">Spring常用注解</h2><blockquote><p>spring就是想尽办法将new做的更简单，更完美，更可配置</p></blockquote><p>Spring的一个核心功能是IOC，就是将Bean初始化加载到容器中(使用Spring注解方式或者Spring XML配置方式)</p><h3 id="1、xml和注解的最佳实践：">1、xml和注解的最佳实践：</h3><ul><li>xml用来管理bean</li><li>注解只负责完成属性的注入</li></ul><h3 id="2、使用注解唯一需要注意的就是，必须开启注解的支持：">2、使用注解唯一需要注意的就是，必须开启注解的支持：</h3><pre><code>​&lt;context:component-scan base-package=&quot;com.guo&quot;&gt;&lt;/context:component-scan&gt;&lt;context:annotation-config/&gt;</code></pre><h2 id="二、Spring的常用注解">二、Spring的常用注解</h2><h3 id="1、给容器中注入组件">1、给容器中注入组件</h3><p>（1）包扫描+组件标注注解</p><p>@Component：泛指各种组件</p><p>@Controller、@Service、@Repository都可以称为@Component。</p><p>@Controller：控制层</p><p>@Service：业务层</p><p>@Repository：数据访问层</p><p>（2）@Bean</p><p>导入第三方包里面的注解</p><p>（3）@Import</p><p>@Import(要导入到容器中的组件)；</p><pre><code>@Import(&#123;Color.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class&#125;)public class MainConfig2 &#123;@Scope(&quot;prototype&quot;)@Bean(&quot;person&quot;)public Person person() &#123;System.out.println(&quot;我是Person&quot;);return new Person(&quot;素小暖&quot;,25);&#125;&#125;</code></pre><p>@ImportSelector：返回需要导入的组件的全类名数组；</p><pre><code>public class MyImportSelector implements ImportSelector &#123;    //返回值就是导入容器的组件全类目    // AnnotationMetadata 当前标注@Import注解的类的所有注解信息    public String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;        //importingClassMetadata.get        return new String[]&#123;&quot;com.atguigu.bean.Blue&quot;,&quot;com.atguigu.bean.Red&quot;&#125;;    &#125;&#125;</code></pre><p>@ImportBeanDefinitionRegistrar：手动注册bean到容器中；</p><pre><code>public class MyImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar &#123;    /*    * AnnotationMetadata：当前类的注解信息    * BeanDefinitionRegistry：BeanDefinition注册类    * 把所有需要添加到容器中的bean，调用BeanDefinitionRegistry.registerBeanDefinition手动注入    *    * */    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) &#123;        boolean definition = registry.containsBeanDefinition(&quot;com.atguigu.bean.Red&quot;);        boolean definition2 = registry.containsBeanDefinition(&quot;com.atguigu.bean.Blue&quot;);        if(definition &amp;&amp; definition2)&#123;            //指定bean定义信息（bean的类型，bean的scope）            RootBeanDefinition rootBeanDefinition = new RootBeanDefinition(RainBow.class);            //注册一个bean，指定bean名            registry.registerBeanDefinition(&quot;rainBow&quot;,rootBeanDefinition);        &#125;    &#125;&#125;</code></pre><p>（4）使用spring提供的FactoryBean（工厂Bean）</p><ul><li><p>默认获取到的是工厂Bean调用getObject创建的对象</p></li><li><p>要获取工厂Bean本身，需要在id前面加一个&amp;</p><p>@Bean<br>public ColorFactoryBean colorFactoryBean(){<br>return new ColorFactoryBean();<br>}</p><p>//创建一个spring定义的FactoryBean<br>public class ColorFactoryBean implements FactoryBean<Color> {<br>//返回一个Color对象，并将Color添加到容器中<br>public Color getObject() throws Exception {<br>System.out.println(“ColorFactoryBean,getObject()”);<br>return new Color();<br>}</p><pre><code>public Class&lt;?&gt; getObjectType() &#123;    return Color.class;&#125;public boolean isSingleton() &#123;    return false;&#125;</code></pre><p>}</p></li></ul><h3 id="2、注入bean的注解">2、注入bean的注解</h3><p>@Autowired：由bean提供</p><ul><li>@Autowired可以作用在变量、setter方法、构造函数上；</li><li>有个属性为required，可以配置为false；</li></ul><p>@Inject：由JSR-330提供</p><ul><li>@Inject用法和@Autowired一样。</li></ul><p>@Resource：由JSR-250提供</p><p>@Autowired、@Inject是默认按照类型匹配的，@Resource是按照名称匹配的，@Autowired如果需要按照名称匹配需要和@Qualifier一起使用，@Inject和@Name一起使用。</p><p>@Primary</p><p>让spring进行自动装配的时候，默认使用首选的bean，和@Qualifier一个效果。</p><h3 id="3、-JsonIgnore">3、@JsonIgnore</h3><p>（1）作用</p><p>在json序列化时将java bean中的一些属性忽略掉，序列化和反序列化都受影响。</p><p>（2）使用方法</p><p>一般标记在属性或者方法上，返回的json数据即不包含该属性。</p><p>（3）注解失效</p><p>如果注解失效，可能是因为你使用的是fastJson，尝试使用对应的注解来忽略字段，注解为：@JSONField(serialize = false)，使用方法一样。</p><h3 id="4、初始化和销毁方法">4、初始化和销毁方法</h3><p>（1）通过@Bean(initMethod=“init”,destoryMethod=“destory”)方法</p><p>（2）通过bean实现InitializingBean来定义初始化逻辑，DisposableBean定义销毁逻辑</p><p>（3）可以使用JSR250：@PostConstruct：初始化方法；@PreDestory：销毁方法。</p><p>（4）BeanPostProcessor：bean的后置处理器，在bean初始化前后进行一些处理工作</p><p>postProcessBeforeInitialization：在初始化之前工作；</p><p>postProcessAfterInitialization：在初始化工作之后工作；</p><h3 id="5、Java配置类相关注解">5、Java配置类相关注解</h3><p>@Configuration</p><p>声明当前类为配置类；</p><p>@Bean</p><p>注解在方法上，声明当前方法的返回值为一个bean，替代xml中的方式；</p><p>@ComponentScan</p><p>用于对Component进行扫描；</p><h3 id="6、切面（AOP）相关注解">6、切面（AOP）相关注解</h3><p><a href="https://blog.csdn.net/JinXYan/article/details/89302126">Spring AOP详细介绍</a></p><p>Spring支持AspectJ的注解式切面编程。</p><p>@Aspect 声明一个切面</p><p>@After 在方法执行之后执行（方法上）</p><p>@Before 在方法执行之前执行（方法上）</p><p>@Around 在方法执行之前与之后执行（方法上）</p><p>@PointCut 声明切点</p><p>在java配置类中使用@EnableAspectJAutoProxy注解开启Spring对AspectJ代理的支持</p><h3 id="7、-Bean的属性支持">7、@Bean的属性支持</h3><p>@Scope设置类型包括：</p><p>设置Spring容器如何新建Bean实例（方法上，得有@Bean）</p><p>① Singleton</p><p>（单例,一个Spring容器中只有一个bean实例，默认模式）,</p><p>② Protetype</p><p>（每次调用新建一个bean）,</p><p>③ Request</p><p>（web项目中，给每个http request新建一个bean）,</p><p>④ Session</p><p>（web项目中，给每个http session新建一个bean）,</p><p>⑤ GlobalSession</p><p>（给每一个 global http session新建一个Bean实例）</p><h3 id="8、-Value注解">8、@Value注解</h3><p>（1）支持如下方式的注入：</p><ul><li>注入普通字符</li><li>注入操作系统属性</li><li>注入表达式结果</li><li>注入其它bean属性</li><li>注入文件资源</li><li>注入网站资源</li><li>注入配置文件</li></ul><p>（2）@Value三种情况的用法。</p><ol><li>${}是去找外部配置的参数，将值赋过来</li><li>#{}是SpEL表达式，去寻找对应变量的内容</li><li>#{}直接写字符串就是将字符串的值注入进去</li></ol><h3 id="9、环境切换">9、环境切换</h3><p>@Profile</p><p>指定组件在哪个环境的情况下才能被注册到容器中，不指定，任何环境下都能注册这个组件。</p><p>@Conditional</p><p>通过实现Condition接口，并重写matches方法，从而决定该bean是否被实例化。</p><h3 id="10、异步相关">10、异步相关</h3><p>@EnableAsync</p><p>配置类中通过此注解开启对异步任务的支持；</p><p>@Async</p><p>在实际执行的bean方法使用该注解来声明其是一个异步任务（方法上或类上所有的方法都将异步，需要@EnableAsync开启异步任务）</p><h3 id="11、定时任务相关">11、定时任务相关</h3><p>@EnableScheduling</p><p>在配置类上使用，开启计划任务的支持（类上）</p><p>@Scheduled</p><p>来申明这是一个任务，包括cron,fixDelay,fixRate等类型（方法上，需先开启计划任务的支持）</p><h3 id="12、Enable-注解说明">12、Enable***注解说明</h3><p>这些注解主要是用来开启对xxx的支持：</p><ul><li>@EnableAspectAutoProxy：开启对AspectJ自动代理的支持；</li><li>@EnableAsync：开启异步方法的支持；</li><li>@EnableScheduling：开启计划任务的支持；</li><li>@EnableWebMvc：开启web MVC的配置支持；</li><li>@EnableConfigurationProperties：开启对@ConfigurationProperties注解配置Bean的支持；</li><li>@EnableJpaRepositories：开启对SpringData JPA Repository的支持；</li><li>@EnableTransactionManagement：开启注解式事务的支持；</li><li>@EnableCaching：开启注解式的缓存支持；</li></ul><h3 id="13、测试相关注解">13、测试相关注解</h3><p>@RunWith</p><p>运行器，Spring中通常用于对JUnit的支持</p><p>@ContextConfiguration</p><p>用来加载配置配置文件，其中classes属性用来加载配置类。</p><pre><code>@RunWith(SpringJUnit4ClassRunner.class)@ContextConfiguration(locations = &#123;&quot;classpath*:/*.xml&quot;&#125;)public class CDPlayerTest &#123;&#125;</code></pre><p>@ContextConfiguration这个注解通常与@RunWith(SpringJUnit4ClassRunner.class)联合使用用来测试。</p><p>@ContextConfiguration括号里的locations = {“classpath*:/*.xml”}就表示将classpath路径里所有的xml文件都包括进来，自动扫描的bean就可以拿到，此时就可以在测试类中使用@Autowired注解来获取之前自动扫描包下的所有bean。</p><h3 id="14、-EqualsAndHashCode">14、@EqualsAndHashCode</h3><p>任意类的定义都可以添加<code>@EqualsAndHashCode</code>注解，让lombok帮你生成<code>equals(Object other)</code>和<code>hashCode()</code>方法的实现。默认情况下会使用非静态和非transient型字段来生成，但是你也通过在字段上添加 @EqualsAndHashCode.Include 或者@EqualsAndHashCode.Exclude 修改你使用的字段（甚至指定各种方法的输出）。或者你也可以通过在类上使用 @EqualsAndHashCode(onlyExplicitlyIncluded = true) ，且在特定字段或特定方法上添加 @EqualsAndHashCode.Include 来指定他们。</p><p>如果将<code>@EqualsAndHashCode</code>添加到继承于另一个类的类上，这个功能会有点棘手。一般情况下，为这样的类自动生成<code>equals</code>和<code>hashCode</code>方法是一个坏思路，因为超类也有定义了一些字段，他们也需要equals/hashCode方法但是不会自动生成。通过设置callSuper=true，可以在生成的<code>equals</code>和<code>hashCode</code>方法里包含超类的方法。对于<code>hashCode</code>，·super.hashCode()·会被包含在hash算法内，而对于<code>equals</code>，如果超类实现认为它与传入的对象不一致则会返回false。注意：并非所有的<code>equals</code>都能正确的处理这样的情况。然而刚好lombok可以，若超类也使用lombok来生成equals方法，那么你可以安全的使用它的equals方法。如果你有一个明确的超类, 你得在callSuper上提供一些值来表示你已经斟酌过，要不然的话就会产生一条警告信息。</p><p>当你的类没有继承至任何类（非<code>java.lang.Object</code>, 当然任何类都是继承于Object类的），而你却将callSuer置为true, 这会产生编译错误（译者注： java: Generating equals/hashCode with a supercall to java.lang.Object is pointless. ）。因为这会使得生成的<code>equals</code>和<code>hashCode</code>方法实现只是简单的继承至Object类的方法，只有相同的对象并且相同的hashCode才会判定他们相等。若你的类继承至另一个类又没有设置callSuper, 则会产品一个告警，因为除非超类没有（或者没有跟相等相关的）字段，否则lombok无法为你生成考虑超类声明字段的实现。</p><h3 id="15、XmlAccessorType">15、XmlAccessorType</h3><p>类级别的注解</p><p>定义这个类中何种类型需要映射到XML。</p><ol><li>XmlAccessType.FIELD：映射这个类中的所有字段到XML</li><li>XmlAccessType.PROPERTY：映射这个类中的属性（get/set方法）到XML</li><li>XmlAccessType.PUBLIC_MEMBER：将这个类中的所有public的field或property同时映射到XML（默认）</li><li>XmlAccessType.NONE：不映射</li></ol><h3 id="16、-SuppressWarnings">16、@SuppressWarnings</h3><p>Suppress 抑制；镇压；废止 Warnings警告</p><p>@SuppressWarnings(“resource”)是J2SE 提供的一个批注。该批注的作用是给编译器一条指令，告诉它对被批注的代码元素内部的某些警告保持静默。</p><p>@SuppressWarnings 批注允许您选择性地取消特定代码段（即，类或方法）中的警告。其中的想法是当您看到警告时，您将调查它，如果您确定它不是问题，您就可以添加一个 @SuppressWarnings 批注，以使您不会再看到警告。<br>虽然它听起来似乎会屏蔽潜在的错误，但实际上它将提高代码安全性，因为它将防止您对警告无动于衷 — 您看到的每一个警告都将值得注意。</p><h2 id="三、SpringMVC常用注解">三、SpringMVC常用注解</h2><h3 id="1、-EnableWebMvc">1、@EnableWebMvc</h3><p>在配置类中开启Web MVC的配置支持。</p><h3 id="2、-Controller">2、@Controller</h3><h3 id="3、-RequestMapping">3、@RequestMapping</h3><p>用于映射web请求，包括访问路径和参数。</p><h3 id="4、-ResponseBody">4、@ResponseBody</h3><p>支持将返回值放到response内，而不是一个页面，通常用户返回json数据。</p><h3 id="5、-RequestBody">5、@RequestBody</h3><p>允许request的参数在request体中，而不是在直接连接的地址后面。（放在参数前）</p><h3 id="6、-PathVariable">6、@PathVariable</h3><p>用于接收路径参数，比如@RequestMapping(“/hello/{name}”)声明的路径，将注解放在参数前，即可获取该值，通常作为Restful的接口实现方法。</p><h3 id="7、-RestController">7、@RestController</h3><p>该注解为一个组合注解，相当于@Controller和@ResponseBody的组合，注解在类上，意味着，该Controller的所有方法都默认加上了@ResponseBody。</p><h3 id="8、-ControllerAdvice">8、@ControllerAdvice</h3><ul><li>全局异常处理</li><li>全局数据绑定</li><li>全局数据预处理</li></ul><p><a href="https://blog.csdn.net/guorui_java/article/details/106883939">ControllerAdvice的常用场景</a></p><h3 id="9、-ExceptionHandler">9、@ExceptionHandler</h3><p>用于全局处理控制器里的异常。</p><h3 id="10、-InitBinder">10、@InitBinder</h3><p>用来设置WebDataBinder，WebDataBinder用来自动绑定前台请求参数到Model中。</p><h3 id="11、-ModelAttribute">11、@ModelAttribute</h3><p>（1）@ModelAttribute注释方法</p><p>如果把@ModelAttribute放在方法的注解上时，代表的是：该Controller的所有方法在调用前，先执行此@ModelAttribute方法。可以把这个@ModelAttribute特性，应用在BaseController当中，所有的Controller继承BaseController，即可实现在调用Controller时，先执行@ModelAttribute方法。比如权限的验证（也可以使用Interceptor）等。</p><p>（2）@ModelAttribute注释一个方法的参数</p><p>当作为方法的参数使用，指示的参数应该从模型中检索。如果不存在，它应该首先实例化，然后添加到模型中，一旦出现在模型中，参数字段应该从具有匹配名称的所有请求参数中填充。</p><p><img src="https://img-blog.csdnimg.cn/20210106195653897.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2d1b3J1aV9qYXZh,size_16,color_FFFFFF,t_70" alt=""></p><p><img src="https://img-blog.csdnimg.cn/20210106195702208.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2d1b3J1aV9qYXZh,size_16,color_FFFFFF,t_70" alt=""></p><p>hellorWord方法的userLogin参数的值来源于getUserLogin()方法中的model属性。</p><h3 id="12、-Transactional">12、@Transactional</h3><p>@Transactional 注解放在类级别时，表示所有该类的公共方法都配置相同的事务属性信息。EmployeeService 的所有方法都支持事务并且是只读。当类级别配置了@Transactional，方法级别也配置了@Transactional，应用程序会以方法级别的事务属性信息来管理事务，换言之，方法级别的事务属性信息会覆盖类级别的相关配置信息。</p><pre><code>@Transactional(propagation= Propagation.SUPPORTS,readOnly=true)@Service(value =&quot;employeeService&quot;)public class EmployeeService</code></pre><p>@Transactional 注解的属性信息</p><p>属性名</p><p>说明</p><p>name</p><p>当在配置文件中有多个 TransactionManager , 可以用该属性指定选择哪个事务管理器。</p><p>propagation</p><p>事务的传播行为，默认值为 REQUIRED。</p><p>isolation</p><p>事务的隔离度，默认值采用 DEFAULT。</p><p>timeout</p><p>事务的超时时间，默认值为-1。如果超过该时间限制但事务还没有完成，则自动回滚事务。</p><p>read-only</p><p>指定事务是否为只读事务，默认值为 false；为了忽略那些不需要事务的方法，比如读取数据，可以设置 read-only 为 true。</p><p>rollback-for</p><p>用于指定能够触发事务回滚的异常类型，如果有多个异常类型需要指定，各类型之间可以通过逗号分隔。</p><p>no-rollback- for</p><p>抛出 no-rollback-for 指定的异常类型，不回滚事务。</p><h2 id="四、其它注解">四、其它注解</h2><h3 id="1、-JsonIgnore">1、@JsonIgnore</h3><p>（1）作用</p><p>在json序列化时将java bean中的一些属性忽略掉，序列化和反序列化都受影响。</p><p>（2）使用方法</p><p>一般标记在属性或者方法上，返回的json数据即不包含该属性。</p><p>（3）注解失效</p><p>如果注解失效，可能是因为你使用的是fastJson，尝试使用对应的注解来忽略字段，注解为：@JSONField(serialize = false)，使用方法一样。</p><h3 id="2、-Schema">2、@Schema</h3><p>@schema注解标注在class上，表示此类对应的数据库表对应的schema。</p><p>可以用如下语句判断某个实体类上是否带有@schema注解，从而得到schema。</p><blockquote><p>bean.getClass().isAnnotationPresent(Schema.class)</p></blockquote><h2 id="五、json常用注解">五、json常用注解</h2><h3 id="1、-JsonIgnoreProperties">1、@JsonIgnoreProperties</h3><p>此注解是类注解，作用是json序列化时将java bean中的一些属性忽略掉，序列化和反序列化都受影响。</p><p>写法将此标签加在user类的类名上 ，可以多个属性也可以单个属性。</p><pre><code>//生成json时将name和age属性过滤@JsonIgnoreProperties(&#123;&quot;name&quot;&#125;,&#123;&quot;age&quot;&#125;)public class  user &#123;    private  String name;    private int age;&#125;</code></pre><h3 id="2、-JsonIgnore">2、@JsonIgnore</h3><p>此注解用于属性或者方法上（最好是属性上），作用和上面的@JsonIgnoreProperties一样。</p><pre><code>//生成json 时不生成age 属性public class user &#123;    private String name;    @JsonIgnore    private int age;&#125;</code></pre><h3 id="3、-JsonFormat">3、@JsonFormat</h3><p>此注解用于属性或者方法上（最好是属性上），可以方便的把Date类型直接转化为我们想要的模式，比如：</p><pre><code>public class User&#123;    @JsonFormat(pattern = “yyyy-MM-dd HH-mm-ss”)    private Date date;&#125;</code></pre><h3 id="4、-JsonSerialize">4、@JsonSerialize</h3><p>此注解用于属性或者getter方法上，用于在序列化时嵌入我们自定义的代码，比如序列化一个double时在其后面限制两位小数点。</p><h3 id="5、-JsonDeserialize">5、@JsonDeserialize</h3><p>此注解用于属性或者setter方法上，用于在反序列化时可以嵌入我们自定义的代码，类似于上面的@JsonSerialize</p><h3 id="6、-Transient">6、@Transient</h3><p>如果一个属性并非数据库表的字段映射，就务必将其标示为@Transient，否则ORM框架默认其注解为@Basic；</p><h3 id="7、-JsonIgnoreType">7、@JsonIgnoreType</h3><p>标注在类上，当其他类有该类作为属性时，该属性将被忽略。</p><h3 id="8、-JsonProperty">8、@JsonProperty</h3><p>@JsonProperty 可以指定某个属性和json映射的名称。例如我们有个json字符串为{“user_name”:”aaa”}，<br>而java中命名要遵循驼峰规则，则为userName，这时通过@JsonProperty 注解来指定两者的映射规则即可。这个注解也比较常用。</p><pre><code>public class SomeEntity &#123;    @JsonProperty(&quot;user_name&quot;)    private String userName;&#125;</code></pre><h3 id="9、只在序列化情况下生效的注解">9、只在序列化情况下生效的注解</h3><p>@JsonPropertyOrder</p><p>在将 java pojo 对象序列化成为 json 字符串时，使用 @JsonPropertyOrder 可以指定属性在 json 字符串中的顺序。</p><p>@JsonInclude</p><p>在将 java pojo 对象序列化成为 json 字符串时，使用 @JsonInclude 注解可以控制在哪些情况下才将被注解的属性转换成 json，例如只有属性不为 null 时。</p><p>@JsonInclude(JsonInclude.Include.NON_NULL)</p><p>这个注解放在类头上，返给前端的json里就没有null类型的字段，即实体类与json互转的时候 属性值为null的不参与序列化。<br>另外还有很多其它的范围，例如 NON_EMPTY、NON_DEFAULT等</p><h3 id="10、在反序列化情况下生效的注解">10、在反序列化情况下生效的注解</h3><p>@JsonSetter</p><p>@JsonSetter 标注于 setter 方法上，类似 @JsonProperty ，也可以解决 json 键名称和 java pojo 字段名称不匹配的问题。</p><p>附Spring5完整思维导图</p><p><img src="https://img-blog.csdnimg.cn/20200925083751819.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2d1b3J1aV9qYXZh,size_16,color_FFFFFF,t_70" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>临时</title>
      <link href="/posts/3fddc459.html"/>
      <url>/posts/3fddc459.html</url>
      
        <content type="html"><![CDATA[<h3 id="字节码">字节码</h3><ul><li>一种中间状态（中间码）的二进制代码（文件），需要直译器转译才能成为机器码</li></ul><h3 id="java-instrumentation">java instrumentation</h3><ul><li><a href="https://github.com/hawkingfoo/demo-agent">https://github.com/hawkingfoo/demo-agent</a></li></ul><h3 id="Javaassist">Javaassist</h3><ul><li>Java 字节码以二进制的形式存储在 .class 文件中，每一个 .class 文件包含一个 Java 类或接口。Javaassist 就是一个用来 处理 Java 字节码的类库。它可以在一个已经编译好的类中添加新的方法，或者是修改已有的方法，并且不需要对字节码方面有深入的了解。同时也可以去生成一个新的类对象，通过完全手动的方式。</li></ul><h4 id="1-使用-Javassist-创建一个-class-文件">1. 使用 Javassist 创建一个 class 文件</h4><p>首先需要引入jar包：</p><pre><code>&lt;dependency&gt;  &lt;groupId&gt;org.javassist&lt;/groupId&gt;  &lt;artifactId&gt;javassist&lt;/artifactId&gt;  &lt;version&gt;3.25.0-GA&lt;/version&gt;&lt;/dependency&gt;</code></pre><p>编写创建对象的类：</p><pre><code>package com.rickiyang.learn.javassist;import javassist.*;/** * @author rickiyang * @date 2019-08-06 * @Desc */public class CreatePerson &#123;    /**     * 创建一个Person 对象     *     * @throws Exception     */    public static void createPseson() throws Exception &#123;        ClassPool pool = ClassPool.getDefault();        // 1. 创建一个空类        CtClass cc = pool.makeClass(&quot;com.rickiyang.learn.javassist.Person&quot;);        // 2. 新增一个字段 private String name;        // 字段名为name        CtField param = new CtField(pool.get(&quot;java.lang.String&quot;), &quot;name&quot;, cc);        // 访问级别是 private        param.setModifiers(Modifier.PRIVATE);        // 初始值是 &quot;xiaoming&quot;        cc.addField(param, CtField.Initializer.constant(&quot;xiaoming&quot;));        // 3. 生成 getter、setter 方法        cc.addMethod(CtNewMethod.setter(&quot;setName&quot;, param));        cc.addMethod(CtNewMethod.getter(&quot;getName&quot;, param));        // 4. 添加无参的构造函数        CtConstructor cons = new CtConstructor(new CtClass[]&#123;&#125;, cc);        cons.setBody(&quot;&#123;name = \&quot;xiaohong\&quot;;&#125;&quot;);        cc.addConstructor(cons);        // 5. 添加有参的构造函数        cons = new CtConstructor(new CtClass[]&#123;pool.get(&quot;java.lang.String&quot;)&#125;, cc);        // $0=this / $1,$2,$3... 代表方法参数        cons.setBody(&quot;&#123;$0.name = $1;&#125;&quot;);        cc.addConstructor(cons);        // 6. 创建一个名为printName方法，无参数，无返回值，输出name值        CtMethod ctMethod = new CtMethod(CtClass.voidType, &quot;printName&quot;, new CtClass[]&#123;&#125;, cc);        ctMethod.setModifiers(Modifier.PUBLIC);        ctMethod.setBody(&quot;&#123;System.out.println(name);&#125;&quot;);        cc.addMethod(ctMethod);        //这里会将这个创建的类对象编译为.class文件        cc.writeFile(&quot;/Users/yangyue/workspace/springboot-learn/java-agent/src/main/java/&quot;);    &#125;    public static void main(String[] args) &#123;        try &#123;            createPseson();        &#125; catch (Exception e) &#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre><p>执行上面的 main 函数之后，会在指定的目录内生成 Person.class 文件：</p><pre><code>//// Source code recreated from a .class file by IntelliJ IDEA// (powered by Fernflower decompiler)//package com.rickiyang.learn.javassist;public class Person &#123;    private String name = &quot;xiaoming&quot;;    public void setName(String var1) &#123;        this.name = var1;    &#125;    public String getName() &#123;        return this.name;    &#125;    public Person() &#123;        this.name = &quot;xiaohong&quot;;    &#125;    public Person(String var1) &#123;        this.name = var1;    &#125;    public void printName() &#123;        System.out.println(this.name);    &#125;&#125;</code></pre><p>跟咱们预想的一样。</p><p>在 Javassist 中，类 <code>Javaassit.CtClass</code> 表示 class 文件。一个 GtClass (编译时类）对象可以处理一个 class 文件，<code>ClassPool</code>是 <code>CtClass</code> 对象的容器。它按需读取类文件来构造 <code>CtClass</code> 对象，并且保存 <code>CtClass</code> 对象以便以后使用。</p><p>需要注意的是 ClassPool 会在内存中维护所有被它创建过的 CtClass，当 CtClass 数量过多时，会占用大量的内存，API中给出的解决方案是 <strong>有意识的调用<code>CtClass</code>的<code>detach()</code>方法以释放内存</strong>。</p><p><code>ClassPool</code>需要关注的方法：</p><ol><li>getDefault : 返回默认的<code>ClassPool</code> 是单例模式的，一般通过该方法创建我们的ClassPool；</li><li>appendClassPath, insertClassPath : 将一个<code>ClassPath</code>加到类搜索路径的末尾位置 或 插入到起始位置。通常通过该方法写入额外的类搜索路径，以解决多个类加载器环境中找不到类的尴尬；</li><li>toClass : 将修改后的CtClass加载至当前线程的上下文类加载器中，CtClass的<code>toClass</code>方法是通过调用本方法实现。<strong>需要注意的是一旦调用该方法，则无法继续修改已经被加载的class</strong>；</li><li>get , getCtClass : 根据类路径名获取该类的CtClass对象，用于后续的编辑。</li></ol><p><code>CtClass</code>需要关注的方法：</p><ol><li>freeze : 冻结一个类，使其不可修改；</li><li>isFrozen : 判断一个类是否已被冻结；</li><li>prune : 删除类不必要的属性，以减少内存占用。调用该方法后，许多方法无法将无法正常使用，慎用；</li><li>defrost : 解冻一个类，使其可以被修改。如果事先知道一个类会被defrost， 则禁止调用 prune 方法；</li><li>detach : 将该class从ClassPool中删除；</li><li>writeFile : 根据CtClass生成 <code>.class</code> 文件；</li><li>toClass : 通过类加载器加载该CtClass。</li></ol><p>上面我们创建一个新的方法使用了<code>CtMethod</code>类。CtMthod代表类中的某个方法，可以通过CtClass提供的API获取或者CtNewMethod新建，通过CtMethod对象可以实现对方法的修改。</p><p><code>CtMethod</code>中的一些重要方法：</p><ol><li>insertBefore : 在方法的起始位置插入代码；</li><li>insterAfter : 在方法的所有 return 语句前插入代码以确保语句能够被执行，除非遇到exception；</li><li>insertAt : 在指定的位置插入代码；</li><li>setBody : 将方法的内容设置为要写入的代码，当方法被 abstract修饰时，该修饰符被移除；</li><li>make : 创建一个新的方法。</li></ol><p>注意到在上面代码中的：setBody()的时候我们使用了一些符号：</p><pre><code>// $0=this / $1,$2,$3... 代表方法参数cons.setBody(&quot;&#123;$0.name = $1;&#125;&quot;);</code></pre><p>具体还有很多的符号可以使用，但是不同符号在不同的场景下会有不同的含义，所以在这里就不在赘述，可以看javassist 的说明文档。<a href="http://www.javassist.org/tutorial/tutorial2.html">http://www.javassist.org/tutorial/tutorial2.html</a></p><h4 id="2-调用生成的类对象">2. 调用生成的类对象</h4><h5 id="1-通过反射的方式调用">1. 通过反射的方式调用</h5><p>上面的案例是创建一个类对象然后输出该对象编译完之后的 .class 文件。那如果我们想调用生成的类对象中的属性或者方法应该怎么去做呢？javassist也提供了相应的api，生成类对象的代码还是和第一段一样，将最后写入文件的代码替换为如下：</p><pre><code>// 这里不写入文件，直接实例化Object person = cc.toClass().newInstance();// 设置值Method setName = person.getClass().getMethod(&quot;setName&quot;, String.class);setName.invoke(person, &quot;cunhua&quot;);// 输出值Method execute = person.getClass().getMethod(&quot;printName&quot;);execute.invoke(person);</code></pre><p>然后执行main方法就可以看到调用了 <code>printName</code>方法。</p><h5 id="2-通过读取-class-文件的方式调用">2. 通过读取 .class 文件的方式调用</h5><pre><code>ClassPool pool = ClassPool.getDefault();// 设置类路径pool.appendClassPath(&quot;/Users/yangyue/workspace/springboot-learn/java-agent/src/main/java/&quot;);CtClass ctClass = pool.get(&quot;com.rickiyang.learn.javassist.Person&quot;);Object person = ctClass.toClass().newInstance();//  ...... 下面和通过反射的方式一样去使用</code></pre><h5 id="3-通过接口的方式">3. 通过接口的方式</h5><p>上面两种其实都是通过反射的方式去调用，问题在于我们的工程中其实并没有这个类对象，所以反射的方式比较麻烦，并且开销也很大。那么如果你的类对象可以抽象为一些方法得合集，就可以考虑为该类生成一个接口类。这样在<code>newInstance()</code>的时候我们就可以强转为接口，可以将反射的那一套省略掉了。</p><p>还拿上面的<code>Person</code>类来说，新建一个<code>PersonI</code>接口类：</p><pre><code>package com.rickiyang.learn.javassist;/** * @author rickiyang * @date 2019-08-07 * @Desc */public interface PersonI &#123;    void setName(String name);    String getName();    void printName();&#125;</code></pre><p>实现部分的代码如下：</p><pre><code>ClassPool pool = ClassPool.getDefault();pool.appendClassPath(&quot;/Users/yangyue/workspace/springboot-learn/java-agent/src/main/java/&quot;);// 获取接口CtClass codeClassI = pool.get(&quot;com.rickiyang.learn.javassist.PersonI&quot;);// 获取上面生成的类CtClass ctClass = pool.get(&quot;com.rickiyang.learn.javassist.Person&quot;);// 使代码生成的类，实现 PersonI 接口ctClass.setInterfaces(new CtClass[]&#123;codeClassI&#125;);// 以下通过接口直接调用 强转PersonI person = (PersonI)ctClass.toClass().newInstance();System.out.println(person.getName());person.setName(&quot;xiaolv&quot;);person.printName();</code></pre><p>使用起来很轻松。</p><h4 id="2-修改现有的类对象">2. 修改现有的类对象</h4><p>前面说到新增一个类对象。这个使用场景目前还没有遇到过，一般会遇到的使用场景应该是修改已有的类。比如常见的日志切面，权限切面。我们利用javassist来实现这个功能。</p><p>有如下类对象：</p><pre><code>package com.rickiyang.learn.javassist;/** * @author rickiyang * @date 2019-08-07 * @Desc */public class PersonService &#123;    public void getPerson()&#123;        System.out.println(&quot;get Person&quot;);    &#125;    public void personFly()&#123;        System.out.println(&quot;oh my god,I can fly&quot;);    &#125;&#125;</code></pre><p>然后对他进行修改：</p><pre><code>package com.rickiyang.learn.javassist;import javassist.ClassPool;import javassist.CtClass;import javassist.CtMethod;import javassist.Modifier;import java.lang.reflect.Method;/** * @author rickiyang * @date 2019-08-07 * @Desc */public class UpdatePerson &#123;    public static void update() throws Exception &#123;        ClassPool pool = ClassPool.getDefault();        CtClass cc = pool.get(&quot;com.rickiyang.learn.javassist.PersonService&quot;);        CtMethod personFly = cc.getDeclaredMethod(&quot;personFly&quot;);        personFly.insertBefore(&quot;System.out.println(\&quot;起飞之前准备降落伞\&quot;);&quot;);        personFly.insertAfter(&quot;System.out.println(\&quot;成功落地。。。。\&quot;);&quot;);        //新增一个方法        CtMethod ctMethod = new CtMethod(CtClass.voidType, &quot;joinFriend&quot;, new CtClass[]&#123;&#125;, cc);        ctMethod.setModifiers(Modifier.PUBLIC);        ctMethod.setBody(&quot;&#123;System.out.println(\&quot;i want to be your friend\&quot;);&#125;&quot;);        cc.addMethod(ctMethod);        Object person = cc.toClass().newInstance();        // 调用 personFly 方法        Method personFlyMethod = person.getClass().getMethod(&quot;personFly&quot;);        personFlyMethod.invoke(person);        //调用 joinFriend 方法        Method execute = person.getClass().getMethod(&quot;joinFriend&quot;);        execute.invoke(person);    &#125;    public static void main(String[] args) &#123;        try &#123;            update();        &#125; catch (Exception e) &#123;            e.printStackTrace();        &#125;    &#125;&#125;</code></pre><p>在<code>personFly</code>方法前后加上了打印日志。然后新增了一个方法<code>joinFriend</code>。执行main函数可以发现已经添加上了。</p><p><strong>另外需要注意的是：上面的<code>insertBefore()</code> 和 <code>setBody()</code>中的语句，如果你是单行语句可以直接用双引号，但是有多行语句的情况下，你需要将多行语句用<code>&#123;&#125;</code>括起来。javassist只接受单个语句或用大括号括起来的语句块。</strong></p><p><a href="https://www.cnblogs.com/rickiyang/p/11336268.html">javassist使用全解析</a></p><p><a href="https://blog.csdn.net/chenpuzhen/article/details/80368405">https://blog.csdn.net/chenpuzhen/article/details/80368405</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>instrument</title>
      <link href="/posts/3cbf69dd.html"/>
      <url>/posts/3cbf69dd.html</url>
      
        <content type="html"><![CDATA[<h1>基于Java Instrument的Agent实现</h1><h1>0 介绍</h1><p>使用 Instrumentation，<strong>使得开发者可以构建一个独立于应用程序的代理程序（Agent），用来监测和协助运行在 JVM 上的程序，甚至能够替换和修改某些类的定义</strong>。有了这样的功能，开发者就可以实现更为灵活的运行时虚拟机监控和 Java 类操作了，这样的特性实际上提供了 <strong>一种虚拟机级别支持的 AOP 实现方式</strong>，使得开发者无需对 JDK 做任何升级和改动，就可以实现某些 AOP 的功能了。</p><p>利用 java.lang.instrument 做静态 Instrumentation 是 Java SE 5 的新特性，<strong>它把 Java 的 instrument 功能从本地代码中解放出来，使之可以用 Java 代码的方式解决问题</strong>。</p><p>在 Java SE 6 里面，instrumentation 包被赋予了更强大的功能：<strong>启动后的 instrument、本地代码（native code）instrument，以及动态改变 classpath</strong> 等等。这些改变，意味着 <strong>Java 具有了更强的动态控制、解释能力，它使得 Java 语言变得更加灵活多变</strong>。</p><blockquote><ol><li><p><strong>在 Java SE6 里面，最大的改变使运行时的 Instrumentation 成为可能</strong>。在 Java SE 5 中，<strong>Instrument 要求在运行前利用命令行参数或者系统参数来设置代理类</strong>，在实际的运行之中，<strong>虚拟机在初始化之时（在绝大多数的 Java 类库被载入之前），instrumentation 的设置已经启动，并在虚拟机中设置了回调函数，检测特定类的加载情况，并完成实际工作。但是在实际的很多的情况下，我们没有办法在虚拟机启动之时就为其设定代理，这样实际上限制了 instrument 的应用</strong>。而 Java SE 6 的新特性改变了这种情况，<strong>通过 Java Tool API 中的 attach 方式</strong>，我们可以很方便地 <strong>在运行过程中动态地设置加载代理类，以达到 instrumentation 的目的</strong>。</p></li><li><p>另外，对 native 的 Instrumentation 也是 Java SE 6 的一个崭新的功能，这使以前无法完成的功能 —— <strong>对 native 接口的 instrumentation 可以在 Java SE 6 中，通过一个或者一系列的 prefix 添加而得以完成</strong>。</p></li><li><p>最后，<strong>Java SE 6 里的 Instrumentation 也增加了动态添加 class path的功能</strong>。所有这些新的功能，都使得 instrument 包的功能更加丰富，从而使 Java 语言本身更加强大。</p></li></ol></blockquote><h1>1 基本功能和用法</h1><p>事实上，java.lang.instrument 包的实现，是基于JVMTI机制的：<strong>在 Instrumentation 的实现当中，存在一个 JVMTI 的代理程序，通过调用 JVMTI 当中 Java 类相关的函数来完成Java 类的动态操作</strong>。除开 Instrumentation 功能外，<strong>JVMTI 还在虚拟机内存管理，线程控制，方法和变量操作等方面提供了大量有价值的函数</strong>。</p><blockquote><p>JVMTI（Java Virtual Machine Tool Interface）是一套由 Java 虚拟机提供的，为 JVM 相关的工具提供的本地编程接口集合。JVMTI 是从 Java SE 5 开始引入，整合和取代了以前使用的 Java Virtual Machine Profiler Interface (JVMPI) 和 the Java Virtual Machine Debug Interface (JVMDI)，而在 Java SE 6 中，JVMPI 和 JVMDI 已经消失了。<strong>JVMTI 提供了一套”代理”程序机制，可以支持第三方工具程序以代理的方式连接和访问 JVM，并利用 JVMTI 提供的丰富的编程接口，完成很多跟 JVM 相关的功能</strong>。</p></blockquote><h2 id="1-1-JVM启动前静态Instrument">1.1 JVM启动前静态Instrument</h2><p><strong>Instrumentation 的最大作用，就是类定义动态改变和操作</strong>。在 Java SE 5 及其后续版本当中，开发者可以在一个普通 Java 程序（带有 main 函数的 Java 类）运行时，<strong>通过 -javaagent参数指定一个特定的 jar 文件（包含 Instrumentation 代理）来启动 Instrumentation 的代理程序</strong>。</p><ol><li><p><strong>编写 premain 函数</strong></p><p><strong>编写一个 Java 类，包含如下两个方法当中的任何一个</strong>：</p><pre><code>public static void premain(String agentArgs, Instrumentation inst);  [1]public static void premain(String agentArgs); [2]</code></pre><p>其中，<strong>[1] 的优先级比 [2] 高，将会被优先执行（[1] 和 [2] 同时存在时，[2] 被忽略）</strong>。在这个 premain 函数中，开发者可以进行对类的各种操作。</p><blockquote><ol><li><strong>agentArgs 是 premain 函数得到的程序参数</strong>，随同 “-javaagent”一起传入。与 main 函数不同的是，<strong>这个参数是一个字符串而不是一个字符串数组</strong>，如果程序参数有多个，程序将自行解析这个字符串。</li><li><strong>Inst 是一个 java.lang.instrument.Instrumentation 的实例，由 JVM 自动传入</strong>。java.lang.instrument.Instrumentation 是 instrument 包中定义的一个接口，也是这个包的核心部分，<strong>集中了其中几乎所有的功能方法</strong>，例如类定义的转换和操作等等。</li></ol></blockquote></li><li><p><strong>jar 文件打包</strong></p><p>将这个 Java 类打包成一个 jar 文件，<strong>并在其中的META-INF/MAINIFEST.MF属性当中加入” Premain-Class”来指定步骤 1 当中编写的那个带有 premain 的 Java 类</strong>。（可能还需要指定其他属性以开启更多功能）</p></li><li><p><strong>运行</strong></p><p>用如下方式运行带有 Instrumentation 的 Java 程序：</p><pre><code>java -javaagent:jar文件的位置 [= 传入 premain 的参数 ]</code></pre></li></ol><p><strong>举个替换Java类文件栗子：采用简单的类文件替换的方式来演示 Instrumentation 的使用</strong></p><p>对 Java 类文件的操作，可以理解为对一个 byte 数组的操作（将类文件的二进制字节流读入一个 byte 数组）。<strong>开发者可以在“ClassFileTransformer”的 transform 方法当中得到，操作并最终返回一个类的定义（一个 byte 数组）</strong>。</p><ol><li><p><strong>首先，我们有一个简单的类，TransClass， 可以通过一个静态方法返回一个整数 1</strong></p><pre><code>public class TransClass &#123;     public int getNumber() &#123;        return 1;     &#125; &#125;</code></pre><p>我们运行如下类，可以得到输出 “1”：</p><pre><code>public class TestMainInJar &#123;   public static void main(String[] args) &#123;      System.out.println(new TransClass().getNumber());   &#125; &#125;</code></pre></li><li><p><strong>然后，我们将 TransClass 的 getNumber 方法改成如下：</strong></p><pre><code>public int getNumber() &#123;     return 2; &#125;</code></pre><p>再将这个返回 2 的 Java 文件编译成类文件，为了区别开原有的返回 1 的类，<strong>我们将返回 2 的这个类文件命名为 TransClass2.class.2</strong>。</p></li><li><p><strong>接下来，我们建立一个 Transformer 类：这个类实现了 ClassFileTransformer 接口</strong></p><pre><code>import java.io.File; import java.io.FileInputStream; import java.io.IOException; import java.io.InputStream; import java.lang.instrument.ClassFileTransformer; import java.lang.instrument.IllegalClassFormatException; import java.security.ProtectionDomain; public class Transformer implements ClassFileTransformer &#123;     public static final String classNumberReturns2 = &quot;TransClass.class.2&quot;;     public static byte[] getBytesFromFile(String fileName) &#123;         try &#123;             // precondition             File file = new File(fileName);             InputStream is = new FileInputStream(file);             long length = file.length();             byte[] bytes = new byte[(int) length];             // Read in the bytes             int offset = 0;             int numRead = 0;             while (offset &lt;bytes.length                  &amp;&amp; (numRead = is.read(bytes, offset, bytes.length - offset)) &gt;= 0) &#123;                 offset += numRead;             &#125;             if (offset &lt; bytes.length) &#123;                 throw new IOException(&quot;Could not completely read file &quot;                     + file.getName());             &#125;             is.close();             return bytes;         &#125; catch (Exception e) &#123;             System.out.println(&quot;error occurs in _ClassTransformer!&quot;                 + e.getClass().getName());             return null;         &#125;     &#125;    /**    * 参数：     * loader - 定义要转换的类加载器；如果是引导加载器，则为 null     * className - 完全限定类内部形式的类名称和 The Java Virtual Machine Specification 中定义的接口名称。例如，&quot;java/util/List&quot;。     * classBeingRedefined - 如果是被重定义或重转换触发，则为重定义或重转换的类；如果是类加载，则为 null     * protectionDomain - 要定义或重定义的类的保护域     * classfileBuffer - 类文件格式的输入字节缓冲区（不得修改）     * 返回：     * 一个格式良好的类文件缓冲区（转换的结果），如果未执行转换,则返回 null。     * 抛出：     * IllegalClassFormatException - 如果输入不表示一个格式良好的类文件     */    public byte[] transform(ClassLoader l, String className, Class&lt;?&gt; c,          ProtectionDomain pd, byte[] b) throws IllegalClassFormatException &#123;         if (!className.equals(&quot;TransClass&quot;)) &#123;             return null;         &#125;         return getBytesFromFile(classNumberReturns2);     &#125; &#125;</code></pre><p><strong>其中，getBytesFromFile 方法根据文件名读入二进制字符流，而 ClassFileTransformer 当中规定的 transform 方法则完成了类定义的替换转换</strong>。</p></li><li><p><strong>最后，我们建立一个 Premain 类，写入 Instrumentation 的代理方法 premain：</strong></p><pre><code>public class Premain &#123;     public static void premain(String agentArgs， Instrumentation inst)  throws ClassNotFoundException， UnmodifiableClassException &#123;         inst.addTransformer(new Transformer());     &#125; &#125;</code></pre><p>可以看出，addTransformer 方法并没有指明要转换哪个类。<strong>转换发生在 premain 函数执行之后，main 函数执行之前，这时每装载一个类，transform 方法就会执行一次，看看是否需要转换</strong>，所以，在 transform（Transformer 类中）方法中，程序用 className.equals(“TransClass”) 来判断当前的类是否需要转换。</p></li><li><p><strong>代码完成后，我们将他们打包为 TestInstrument1.jar。返回 1 的那个 TransClass 的类文件保留在 jar 包中，而返回 2 的那个 TransClass.class.2 则放到 jar 的外面。在 manifest 里面加入如下属性来指定 premain 所在的类：</strong></p><pre><code>Manifest-Version: 1.0 Premain-Class: Premain</code></pre></li><li><p><strong>在运行这个程序的时候，如果我们用普通方式运行这个 jar 中的 main 函数，可以得到输出“1”。如果用下列方式运行：</strong></p><pre><code>java -javaagent:TestInstrument1.jar -cp TestInstrument1.jar TestMainInJar</code></pre><p>则会得到输出“2”。</p><p>当然，<strong>程序运行的 main 函数不一定要放在 premain 所在的这个 jar 文件里面</strong>，这里只是为了例子程序打包的方便而放在一起的。 <strong>除开用 addTransformer 的方式，Instrumentation 当中还有另外一个方法“redefineClasses”来实现 premain 当中指定的转换</strong>。用法类似，如下：</p><pre><code>public class Premain &#123;     public static void premain(String agentArgs， Instrumentation inst)  throws ClassNotFoundException， UnmodifiableClassException &#123;         ClassDefinition def = new ClassDefinition(TransClass.class， Transformer.getBytesFromFile(Transformer.classNumberReturns2));         inst.redefineClasses(new ClassDefinition[] &#123; def &#125;);         System.out.println(&quot;success&quot;);     &#125; &#125;</code></pre><p><strong>redefineClasses 的功能比较强大，可以批量转换很多类。</strong></p></li></ol><p>多个代理可以同时执行，按照代理指定的顺序被依次调用</p><h2 id="1-2-JVM启动后动态Instrument">1.2 JVM启动后动态Instrument</h2><p>在 Java SE 5 当中，开发者只能在 premain 当中施展想象力，<strong>所作的 Instrumentation 也仅限与 main 函数执行前，这样的方式存在一定的局限性</strong>。</p><p>在 Java SE 5 的基础上，Java SE 6 针对这种状况做出了改进，<strong>开发者可以在 main 函数开始执行以后，再启动自己的 Instrumentation 程序</strong>。</p><p>在 Java SE 6 的 Instrumentation 当中，<strong>有一个跟 premain“并驾齐驱”的“agentmain”方法，可以在 main 函数开始运行之后再运行</strong>。跟 premain 函数一样， 开发者可以编写一个含有“agentmain”函数的 Java 类：</p><pre><code>public static void agentmain (String agentArgs, Instrumentation inst); [1] public static void agentmain (String agentArgs);[2]</code></pre><p>同样，<strong>[1] 的优先级比 [2] 高，将会被优先执行（[1] 和 [2] 同时存在时，[2] 被忽略）</strong>。跟 premain 函数一样，开发者可以在 agentmain 中进行对类的各种操作。其中的 agentArgs 和 Inst 的用法跟 premain 相同。</p><blockquote><p>与“Premain-Class”类似，开发者必须在 manifest 文件里面设置“Agent-Class”来指定包含 agentmain 函数的类。</p></blockquote><p>可是，跟 premain 不同的是，agentmain 需要在 main 函数开始运行后才启动，<strong>这样的时机应该如何确定呢，这样的功能又如何实现呢？</strong></p><p>在 Java SE 6 文档当中，开发者也许无法在 java.lang.instrument 包相关的文档部分看到明确的介绍，更加无法看到具体的应用 agnetmain 的例子。不过，在 Java SE 6 的新特性里面，有一个不太起眼的地方，揭示了 agentmain 的用法。<strong>这就是 Java SE 6 当中提供的 Attach API</strong>。</p><p>Attach API 不是 Java 的标准 API，而是 Sun 公司提供的一套扩展 API，<strong>用来向目标 JVM ”附着”（Attach）代理工具程序的</strong>。有了它，<strong>开发者可以方便的监控一个 JVM，运行一个外加的代理程序</strong>。</p><p>Attach API 很简单，只有 2 个主要的类，都在 com.sun.tools.attach 包里面：</p><blockquote><ol><li><p><strong>VirtualMachine 代表一个 Java 虚拟机</strong>，也就是程序需要监控的目标虚拟机，提供了 JVM 枚举，<strong>Attach 动作和 Detach 动作（Attach 动作的相反行为，从 JVM 上面解除一个代理）等等</strong> ;</p><p>VirtualMachine类，该类允许我们 <strong>通过给attach方法传入一个jvm的pid（进程id），远程连接到jvm上</strong> 。然后我们可以 <strong>通过loadAgent方法向jvm注册一个代理程序agent，在该agent的代理程序中会得到一个Instrumentation实例</strong>，该实例可以 <strong>在class加载前改变class的字节码，也可以在class加载后重新加载</strong>。在调用Instrumentation实例的方法时，这些方法会使用ClassFileTransformer接口中提供的方法进行处理。</p></li><li><p><strong>VirtualMachineDescriptor 则是一个描述虚拟机的容器类</strong>，配合 VirtualMachine 类完成各种功能。</p></li></ol></blockquote><p><strong>为了简单起见，我们举例简化如下</strong>：依然用类文件替换的方式</p><blockquote><ol><li>将一个返回 1 的函数替换成返回 2 的函数，Attach API 写在一个线程里面，用睡眠等待的方式，<strong>每隔半秒时间检查一次所有的 Java 虚拟机</strong>，当发现有新的虚拟机出现的时候，<strong>就调用 attach 函数，随后再按照 Attach API 文档里面所说的方式装载 Jar 文件</strong>。等到 5 秒钟的时候，attach 程序自动结束。</li><li>在 main 函数里面，程序每隔半秒钟输出一次返回值（显示出返回值从 1 变成 2）。</li></ol></blockquote><p><strong>TransClass 类和 Transformer 类的代码不变，参看上一节介绍。 含有 main 函数的 TestMainInJar 代码为：</strong></p><pre><code>// 程序每隔半秒钟输出一次返回值（显示出返回值从 1 变成 2）public class TestMainInJar &#123;     public static void main(String[] args) throws InterruptedException &#123;         System.out.println(new TransClass().getNumber());         int count = 0;         while (true) &#123;             Thread.sleep(500);             count++;             int number = new TransClass().getNumber();             System.out.println(number);             if (3 == number || count &gt;= 10) &#123;                 break;             &#125;         &#125;     &#125; &#125;</code></pre><p><strong>含有 agentmain 的 AgentMain 类的代码为：</strong></p><pre><code>import java.lang.instrument.ClassDefinition; import java.lang.instrument.Instrumentation; import java.lang.instrument.UnmodifiableClassException; public class AgentMain &#123;     public static void agentmain(String agentArgs, Instrumentation inst)  throws ClassNotFoundException, UnmodifiableClassException, InterruptedException &#123;         inst.addTransformer(new Transformer (), true);         inst.retransformClasses(TransClass.class);         System.out.println(&quot;Agent Main Done&quot;);     &#125; &#125;</code></pre><p>其中，<strong>retransformClasses 是 Java SE 6 里面的新方法，它跟 redefineClasses 一样，可以批量转换类定义，多用于 agentmain 场合</strong>。</p><p>Jar 文件跟 Premain 那个例子里面的 Jar 文件差不多，也是把 main 和 agentmain 的类，TransClass，Transformer 等类放在一起，打包为“TestInstrument1.jar”，而 Jar 文件当中的 Manifest 文件为 :</p><pre><code>Manifest-Version: 1.0 Agent-Class: AgentMain</code></pre><p>另外，为了运行 Attach API，我们可以再写一个控制程序来模拟监控过程：</p><pre><code>import com.sun.tools.attach.VirtualMachine; import com.sun.tools.attach.VirtualMachineDescriptor; ……// 一个运行 Attach API 的线程子类// 每隔半秒时间检查一次所有的 Java 虚拟机static class AttachThread extends Thread &#123;                 private final List&lt;VirtualMachineDescriptor&gt; listBefore;         private final String jar;         AttachThread(String attachJar, List&lt;VirtualMachineDescriptor&gt; vms) &#123;             listBefore = vms;  // 记录程序启动时的 VM 集合            jar = attachJar;         &#125;         public void run() &#123;             VirtualMachine vm = null;             List&lt;VirtualMachineDescriptor&gt; listAfter = null;             try &#123;                 int count = 0;                 while (true) &#123;                     listAfter = VirtualMachine.list();                     for (VirtualMachineDescriptor vmd : listAfter) &#123;                         if (!listBefore.contains(vmd)) &#123;                             // 如果 VM 有增加，我们就认为是被监控的 VM 启动了                            // 这时，我们开始监控这个 VM                             vm = VirtualMachine.attach(vmd);                             break;                         &#125;                     &#125;                     Thread.sleep(500);                     count++;                     if (null != vm || count &gt;= 10) &#123;                         break;                     &#125;                 &#125;                 vm.loadAgent(jar);                 vm.detach();             &#125; catch (Exception e) &#123;                  ignore             &#125;         &#125;     &#125; ……public static void main(String[] args) throws InterruptedException &#123;          new AttachThread(&quot;TestInstrument1.jar&quot;, VirtualMachine.list()).start(); &#125;</code></pre><p>运行时，<strong>首先运行上面这个启动新线程的 main 函数</strong>，然后，在 5 秒钟内（仅仅简单模拟 JVM 的监控过程）运行如下命令启动测试 Jar 文件 :</p><pre><code>java –cp TestInstrument1.jar TestMainInJar</code></pre><p>如果时间掌握得不太差的话，程序首先会在屏幕上打出 1，这是改动前的类的输出，然后会打出一些 2，<strong>这个表示 agentmain 已经被 Attach API 成功附着到 JVM 上，代理程序生效了</strong>，当然，还可以看到“Agent Main Done”字样的输出。</p><h2 id="1-3-本地方法Instrument">1.3 本地方法Instrument</h2><p>在 JDK 1.5 版本的 instumentation 里，并没有对Java本地方法（Native Method）的处理方式，而且在 Java 标准的 JVMTI 之下，并没有办法改变 method signature， 这就使替换本地方法非常地困难。<strong>一个比较直接而简单的想法是，在启动时替换本地代码所在的动态链接库</strong>—— 但是这样，<strong>本质上是一种静态的替换，而不是动态的 Instrumentation</strong>。</p><p>而且，这样可能需要编译较大数量的动态链接库 —— 比如，我们有三个本地函数，假设每一个都需要一个替换，而在不同的应用之下，可能需要不同的组合，那么如果我们把三个函数都编译在同一个动态链接库之中，最多我们需要 8 个不同的动态链接库来满足需要。当然，我们也可以独立地编译之，那样也需要 6 个动态链接库——无论如何，这种繁琐的方式是不可接受的。</p><p>在 Java SE 6 中，新的 Native Instrumentation 提出了一个新的 native code 的解析方式，作为原有的 native method 的解析方式的一个补充，来很好地解决了一些问。这就是在新版本的 java.lang.instrument 包里，<strong>我们拥有了对 native 代码的 instrument 方式 —— 设置 prefix</strong>。</p><p>假设我们有了一个 native 函数，名字叫 nativeMethod，<strong>在运行过程中，我们需要将它指向另外一个函数（需要注意的是，在当前标准的 JVMTI 之下，除了 native 函数名，其他的 signature 需要一致）</strong>。比如我们的 Java 代码是：</p><pre><code>package nativeTester; class nativePrefixTester&#123;     …     native int nativeMethod(int input);     …&#125;</code></pre><p>那么我们已经实现的本地代码是 :</p><pre><code>jint Java_nativeTester_nativeMethod(jclass thiz, jobject thisObj, jint input);</code></pre><p>现在我们需要在调用这个函数时，使之指向另外一个函数。那么按照 J2SE 的做法，<strong>我们可以按他的命名方式，加上一个 prefix 作为新的函数名。比如，我们以 “another_” 作为 prefix</strong>，那么我们新的函数是 :</p><pre><code>jint Java_nativeTester_another_nativePrefixTester(jclass thiz, jobject thisObj, jint input);</code></pre><p>然后将之编入动态链接库之中。 <strong>现在我们已经有了新的本地函数，接下来就是做 instrument 的设置</strong>。正如以上所说的，<strong>我们可以使用 premain 方式，在虚拟机启动之时就载入 premain 完成 instrument 代理设置。也可以使用 agentmain 方式，去 attach 虚拟机来启动代理</strong>。而设置 native 函数的也是相当简单的 :</p><pre><code>premain()&#123;  // 或者也可以在 agentmain 里    …    if (!isNativeMethodPrefixSupported())&#123;         return; // 如果无法设置，则返回    &#125;     setNativeMethodPrefix(transformer,&quot;another_&quot;); // 设置 native 函数的 prefix，注意这个下划线必须由用户自己规定    …&#125;</code></pre><p>在这里要注意两个问题：</p><ol><li><p><strong>不是在任何的情况下都是可以设置 native 函数的 prefix 的；首先，我们要注意到 agent 包之中的 Manifest 所设定的特性 :</strong></p><pre><code>Can-Set-Native-Method-Prefix</code></pre><p>要注意，<strong>这一个参数都可以影响是否可以设置 native prefix</strong>，而且，在默认的设置之中，这个参数是 false 的，我们需要将之设置成 true（顺便说一句，对 Manifest 之中的属性来说都是大小写无关的，当然，如果给一个不是“true”的值，就会被当作 false 值处理）。</p><p>当然，我们还需要<strong>确认虚拟机本身是否支持 setNativePrefix</strong>。在 Java API 里，<strong>Instrumentation 类提供了一个函数 isNativePrefix，通过这个函数我们可以知道该功能是否可以实行</strong>。</p></li><li><p><strong>我们可以为每一个 ClassTransformer 加上它自己的 nativeprefix：</strong></p><p><strong>每一个 ClassTransformer 都可以为同一个 class 做 transform</strong>，因此对于一个 Class 来说，一个 native 函数可能有不同的 prefix，因此对这个函数来说，它可能也有好几种解析方式。 在 Java SE 6 当中，Native prefix 的解释方式如下：<strong>对于某一个 package 内的一个 class 当中的一个 native method 来说，首先，假设我们对这个函数的 transformer 设置了 native 的 prefix“another”，它将这个函数接口解释成</strong> :</p><p>由 Java 的函数接口：</p><pre><code>native void method()</code></pre><p>和上述 prefix&quot;another&quot;，去寻找本地代码中的函数：</p><pre><code>// 请注意 prefix 在函数名中出现的位置！void Java_package_class_another_method(jclass theClass, jobject thiz); </code></pre><p>一旦可以找到，那么调用这个函数，整个解析过程就结束了；<strong>如果没有找到，那么虚拟机将会做进一步的解析工作。我们将利用 Java native 接口最基本的解析方式 , 去找本地代码中的函数</strong> :</p><pre><code>void Java_package_class_method(jclass theClass, jobject thiz);</code></pre><p>如果找到，则执行之。否则，因为没有任何一个合适的解析方式，于是宣告这个过程失败。 那么如果有多个 transformer，同时每一个都有自己的 prefix，又该如何解析呢？<strong>事实上，虚拟机是按 transformer 被加入到的 Instrumentation 之中的次序去解析的（还记得我们最基本的 addTransformer 方法吗？）</strong>。 假设我们有三个 transformer 要被加入进来，他们的次序和相对应的 prefix 分别为：transformer1 和“prefix1_”，transformer2 和 “prefix2_”，transformer3 和 “prefix3_”。那么，虚拟机会首先做的就是将接口解析为 :</p><pre><code>native void prefix1_prefix2_prefix3_native_method()</code></pre><p>然后去找它相对应的 native 代码。 但是如果第二个 transformer（transformer2）没有设定 prefix，那么很简单，我们得到的解析是：</p><pre><code>native void prefix1_prefix3_native_method()</code></pre><p>这个方式简单而自然。 当然，对于多个 prefix 的情况，我们还要注意一些复杂的情况。比如，假设我们有一个 native 函数接口是：</p><pre><code>native void native_method()</code></pre><p>然后我们为它设置了两个 prefix，比如 “wrapped_” 和 “wrapped2_”，那么，我们得到的是什么呢？</p><pre><code>// 这个函数名正确吗？void Java_package_class_wrapped_wrapped2_method(jclass theClass, jobject thiz); </code></pre><p>答案是否定的，<strong>因为事实上，对 Java 中 native 函数的接口到 native 中的映射，有一系列的规定，因此可能有一些特殊的字符要被代入</strong>。而实际中，这个函数的正确的函数名是：</p><pre><code>// 只有这个函数名会被找到void Java_package_class_wrapped_1wrapped2_1method(jclass theClass, jobject thiz);</code></pre><p>很有趣不是吗？因此如果我们要做类似的工作，<strong>一个很好的建议是首先在 Java 中写一个带 prefix 的 native 接口，用 javah 工具生成一个 c 的 header-file，看看它实际解析得到的函数名是什么，这样我们就可以避免一些不必要的麻烦</strong>。</p><p>另外一个事实是，与我们的想像不同，<strong>对于两个或者两个以上的 prefix，虚拟机并不做更多的解析；它不会试图去掉某一个 prefix，再来组装函数接口。它做且仅作两次解析</strong>。</p><p>总之，<strong>新的 native 的 prefix-instrumentation 的方式，改变了以前 Java 中 native 代码无法动态改变的缺点</strong>。在当前，<strong>利用 JNI 来写 native 代码也是 Java 应用中非常重要的一个环节</strong>，因此它的动态化意味着整个 Java 都可以动态改变了 —— <strong>现在我们的代码可以利用加上 prefix 来动态改变 native 函数的指向</strong>。</p><p>正如上面所说的，如果找不到，虚拟机还会去尝试做标准的解析，这让我们拥有了动态地替换 native 代码的方式，我们可以将许多带不同 prefix 的函数编译在一个动态链接库之中，<strong>而通过 instrument 包的功能，让 native 函数和 Java 函数一样动态改变、动态替换</strong>。 当然，现在的 native 的 instrumentation 还有一些限制条件，比如，不同的 transformer 会有自己的 native prefix，就是说，<strong>每一个 transformer 会负责他所替换的所有类而不是特定类的 prefix</strong> —— 因此这个粒度可能不够精确。</p></li></ol><h2 id="1-4-BootClassPath-SystemClassPath-的动态增补">1.4 BootClassPath / SystemClassPath 的动态增补</h2><p>我们知道，通过设置系统参数或者通过虚拟机启动参数，我们可以<strong>设置一个虚拟机运行时的 boot class 加载路径（-Xbootclasspath）和 system class（-cp）加载路径</strong>。当然，我们在运行之后无法替换它。然而，我们也许有时候要需要把某些 jar 加载到 bootclasspath 之中，而我们无法应用上述两个方法；<strong>或者我们需要在虚拟机启动之后来加载某些 jar 进入 bootclasspath</strong>。在 Java SE 6 之中，我们可以做到这一点了。</p><p>实现这几点很简单，首先，我们依然需要 <strong>确认虚拟机已经支持这个功能</strong>，然后在 premain/agantmain 之中加上需要的 classpath。<strong>我们可以在premain/agentmain方法中 Instrumentation inst 里使用 appendToBootstrapClassLoaderSearch/appendToSystemClassLoaderSearch来完成这个任务</strong>。</p><p>同时我们可以注意到，<strong>在 agent 的 mainfest 里加入 Boot-Class-Path 其实一样可以在动态地载入agent自己的 boot class 路径</strong>，当然，在 Java code 中它可以更加动态方便和智能地完成 —— 我们可以很方便地加入判断和选择成分。</p><p><strong>在这里我们也需要注意几点：</strong></p><ol><li><p>首先，<strong>我们加入到 classpath 的 jar 文件中不应当带有任何和系统的 instrumentation 有关的系统同名类</strong>，不然，一切都陷入不可预料之中 —— 这不是一个工程师想要得到的结果，不是吗？</p></li><li><p>其次，<strong>我们要注意到虚拟机的 ClassLoader 的工作方式，它会记录解析结果</strong>。比如，我们曾经要求读入某个类 someclass，但是失败了，ClassLoader 会记得这一点。即使我们在后面动态地加入了某一个 jar，含有这个类，ClassLoader 依然会认为我们无法解析这个类，与上次出错的相同的错误会被报告。</p></li><li><p>再次我们知道在 Java 语言中有一个系统参数“java.class.path”，这个 property 里面记录了我们当前的 classpath，但是，我们使用这两个函数，<strong>虽然真正地改变了实际的 classpath，却不会对这个 property 本身产生任何影响</strong>。</p></li></ol><blockquote><p>在公开的 JavaDoc 中我们可以发现一个很有意思的事情，Sun 的设计师们告诉我们，<strong>这个功能事实上依赖于 ClassLoader 的 appendtoClassPathForInstrumentation 方法 —— 这是一个非公开的函数，因此我们不建议直接（使用反射等方式）使用它，事实上，instrument 包里的这两个函数已经可以很好的解决我们的问题了</strong>。</p></blockquote><h2 id="1-5-META-INF-MAINIFEST-MF清单">1.5 META-INF/MAINIFEST.MF清单</h2><p><strong>以下是agent jar文件的Manifest Attributes清单：</strong></p><blockquote><ol><li><strong>Premain-Class</strong> 如果 JVM 启动时指定了代理，那么此属性指定代理类，<strong>即包含 premain 方法的类</strong>。如果 JVM 启动时指定了代理，那么此属性是必需的。如果该属性不存在，那么 JVM 将中止。<strong>注：此属性是类名，不是文件名或路径</strong>。</li><li><strong>Agent-Class</strong> 如果实现支持 VM 启动之后某一时刻启动代理的机制，那么此属性指定代理类，<strong>即包含 agentmain 方法的类</strong>。 此属性是必需的，如果不存在，代理将无法启动。<strong>注：这是类名，而不是文件名或路径</strong>。</li><li><strong>Boot-Class-Path</strong> 设置引导类加载器搜索的路径列表。路径表示目录或库（在许多平台上通常作为 JAR 或 zip 库被引用）。<strong>查找类的特定于平台的机制失败后，引导类加载器会搜索这些路径</strong>。按列出的顺序搜索路径。列表中的路径由一个或多个空格分开。路径使用分层 URI 的路径组件语法。如果该路径以斜杠字符（“/”）开头，则为绝对路径，否则为相对路径。相对路径根据代理 JAR 文件的绝对路径解析。忽略格式不正确的路径和不存在的路径。如果代理是在 VM 启动之后某一时刻启动的，则忽略不表示 JAR 文件的路径。此属性是可选的。</li><li><strong>Can-Redefine-Classes</strong> 布尔值（true 或 false，与大小写无关）。<strong>是否能重定义此代理所需的类</strong>。true 以外的值均被视为 false。此属性是可选的，默认值为 false。</li><li><strong>Can-Retransform-Classes</strong> 布尔值（true 或 false，与大小写无关）。<strong>是否能重转换此代理所需的类</strong>。true 以外的值均被视为 false。此属性是可选的，默认值为 false。</li><li><strong>Can-Set-Native-Method-Prefix</strong> 布尔值（true 或 false，与大小写无关）。<strong>是否能设置此代理所需的本机方法前缀</strong>。true 以外的值均被视为 false。此属性是可选的，默认值为 false。</li></ol></blockquote><h1>2 Instrument两个核心API</h1><ol><li><p><strong>ClassFileTransformer</strong>：<strong>定义了类加载前的预处理类</strong>，可以在这个类中对要加载的类的字节码做一些处理，譬如进行字节码增强；</p></li><li><p><strong>Instrumentation</strong>：增强器，由JVM在入口参数中传递给我们，提供了如下的功能：</p><blockquote><ol><li><strong>addTransformer/removeTransformer</strong>：注册/删除ClassFileTransformer；</li><li><strong>retransformClasses</strong>：<strong>对于已经加载的类重新进行转换处理，即会触发重新加载类定义</strong>，需要注意的是，新加载的类不能修改旧有的类声明，譬如不能增加属性、不能修改方法声明；</li><li><strong>redefineClasses</strong>：与如上类似，<strong>但不是重新进行转换处理</strong>，而是直接把处理结果(bytecode)直接给JVM；</li><li><strong>getAllLoadedClasses</strong>：<strong>获得当前已经加载的Class</strong>，可配合retransformClasses使用；</li><li><strong>getInitiatedClasses</strong>：<strong>获得由某个特定的ClassLoader加载的类定义</strong>；</li><li><strong>getObjectSize</strong>：<strong>获得一个对象占用的空间</strong>，包括其引用的对象；</li><li><strong>appendToBootstrapClassLoaderSearch/appendToSystemClassLoaderSearch</strong>：增加BootstrapClassLoader/SystemClassLoader的搜索路径；</li><li><strong>isNativeMethodPrefixSupported/setNativeMethodPrefix</strong>：<strong>判断JVM是否支持拦截Native Method</strong>；</li></ol></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>面向对象</title>
      <link href="/posts/28239a8d.html"/>
      <url>/posts/28239a8d.html</url>
      
        <content type="html"><![CDATA[<p><strong>面向对象概念</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">面向对象 --&gt; A(封装)</span><br><span class="line">A --&gt; 对象</span><br><span class="line">对象 --&gt; 对象ID</span><br><span class="line">对象 --&gt; 属性</span><br><span class="line">对象 --&gt; 行为</span><br><span class="line">A --&gt; 封装</span><br><span class="line"></span><br><span class="line">面向对象 --&gt; B(继承)</span><br><span class="line">B --&gt; 继承与泛化</span><br><span class="line">B --&gt; 类</span><br><span class="line">类 --&gt; 实体类</span><br><span class="line">类 --&gt; 接口类</span><br><span class="line">类 --&gt; 控制类</span><br><span class="line">B --&gt; 重写与重载</span><br><span class="line"></span><br><span class="line">面向对象--&gt; C(多态)</span><br><span class="line">C--&gt;动态绑定</span><br><span class="line">C--&gt;多态</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>继承</strong></p><ul><li>extends 基本类和抽象类的继承</li><li>implements 接口类的实现</li><li>祖先类 java.Lang.Object</li><li>子类是父类的特殊化，父类是子类的泛化</li></ul><p><strong>多态</strong></p><blockquote><p>同一个行为(<code>方法</code>)具有多个不同表现形式</p></blockquote><ul><li>重载: 一个类中方法名相同，参数不同(发生在类内部)</li><li>重写: 子类对父类允许访问的方法的实现过程进行重写(<code>运行时调用</code>)(发生在类之间)<ul><li>返回值、形参不变</li><li>子类中调用父类被重写的方法时使用 <code>super</code></li></ul></li><li>重写和重载是多态具体的表现形式</li></ul><p><strong>人扫码购买商品案例</strong></p><ul><li>实体类：现实世界中真实存在的实体(人)</li><li>接口类：为用户提供系统合作交互的方式(二维码)</li><li>控制类：描述业务逻辑，充当实体类与接口类的协调者</li></ul><p><strong>临时记录</strong></p><ul><li>动态绑定： 运行时<ul><li>要有继承关系</li><li>要发生重写</li><li>要有(<code>父类引用</code>)指向(<code>子类对象</code>)</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> 编码</span><br><span class="line">Animal a = new Cat();</span><br><span class="line">Animal b = new Dog();</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 运行</span><br><span class="line">a.call(); <span class="regexp">//</span> 输出为 <span class="string">&#x27;喵&#x27;</span></span><br><span class="line">b.call(); <span class="regexp">//</span> 输出为 <span class="string">&#x27;汪&#x27;</span></span><br></pre></td></tr></table></figure></li><li>静态绑定： 编译时</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>进制转换</title>
      <link href="/posts/7dc91154.html"/>
      <url>/posts/7dc91154.html</url>
      
        <content type="html"><![CDATA[<p><strong>进制转换</strong></p><blockquote><p>电信号的两种状态</p></blockquote><ul><li><p>单位</p><ul><li>bit 二进制位</li><li>byte 字节</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">8bit</span> = <span class="number">1</span>byte</span><br><span class="line"><span class="attr">1KB</span> = <span class="number">1024</span>B</span><br><span class="line"><span class="attr">1M</span> = <span class="number">1024</span>KB</span><br><span class="line"><span class="attr">1G</span> = <span class="number">1024</span>M</span><br><span class="line"><span class="attr">1T</span> = <span class="number">1024</span>G</span><br></pre></td></tr></table></figure></li><li><p>八进制 每三位表示一位(111 -&gt; 7)</p></li><li><p>十六进制 每四位表示一位(1111 -&gt; 15)</p></li><li><p>十转二</p><ul><li>正整数: 除2取余、反向读余</li><li>负整数: 整数部分除2取余、反向读余，取反加1</li></ul></li><li><p>二转十</p><ul><li>按权展开、相加求和</li></ul></li><li><p>二转八</p><ul><li>三位二进制数展开相加(从右往左)</li></ul></li><li><p>二转十六</p><ul><li>取四合一(从右到左)</li></ul></li><li><p>十六抓二</p><ul><li>除二取余、反向读余</li></ul></li></ul><p><strong>强制类型转换</strong><br>byte m = 127；<br>byte f = (byte)(m + 10); // 向下转型</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10001001</span> (<span class="name">高位</span> <span class="symbol">&#x27;1</span>&#x27; -&gt; 负数，取反加1)</span><br><span class="line"><span class="number">01110111</span></span><br><span class="line"><span class="number">-119</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>概念</title>
      <link href="/posts/be97aa85.html"/>
      <url>/posts/be97aa85.html</url>
      
        <content type="html"><![CDATA[<h3 id="Java">Java</h3><p><strong>对象</strong></p><ul><li>类的一个实例，有状态、行为(<code>属性、方法</code>)</li></ul><p><strong>类</strong></p><ul><li>一个模板、描述一类对象的状态和行为</li><li>实例变量：对象的状态由这些实例变量的值决定</li></ul><p><strong>标识符</strong></p><ul><li>类名、变量名、方法名</li></ul><p><strong>修饰符</strong></p><ul><li>使用修复符修复类中的方法和属性</li><li>可访问修饰符<ul><li>default<ul><li>同一包内可见</li></ul></li><li>public<ul><li>对所有类可见(外部类访问该类成员变量和方法的入口)</li></ul></li><li>protected<ul><li>对同一包内的类和所有子类可见</li></ul></li><li>private<ul><li>同一类可见、只能被所属类访问、并且类和接口不能声明为private且不能被继承</li></ul></li></ul></li><li>不可访问修饰符<ul><li>final<ul><li>修饰的类不能被继承、方法不能被继承类重写，修饰的变量为常量</li></ul></li><li>abstract<ul><li>创建抽象类和抽象方法(不能用了实例化对象)</li></ul></li><li><h2 id="strictfp">strictfp</h2></li><li>static<ul><li>用来修饰类方法和类变量</li><li>静态方法不能使用非静态变量</li><li>静态属性、静态方法存储在方法区中的暂存区，无论一个类实例化多少对象，它的静态变量/方法 只有一份拷贝</li></ul></li></ul></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span>:</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="type">String</span> bread; <span class="comment">// 成员变量-在创建对象的时候实例化</span></span><br><span class="line">  int age;</span><br><span class="line">  static color; <span class="comment">// 类变量</span></span><br><span class="line"></span><br><span class="line">  <span class="type">String</span> barking() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#x27;旺&#x27;; <span class="comment">// 局部变量: 变量声明和初始化都是在方法中，方法结束，自动销毁</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">构造方法用来初始化对象</span><br></pre></td></tr></table></figure><p><strong>方法</strong></p><ul><li><p>概念</p><ul><li>返回 void:  过程</li><li>返回 !void: 函数</li></ul></li><li><p>定义</p></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">修饰符 返回值类型 方法名(参数类型 参数) &#123;</span><br><span class="line">  <span class="comment">// 方法体</span></span><br><span class="line">  <span class="keyword">return</span> 返回值</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>数据类型</strong></p><blockquote><p>JVM 根据数据类型为变量分配内存空间</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">数据类型 --&gt; A(基本数据类型)</span><br><span class="line">A --&gt; 数值型</span><br><span class="line">数值型 --&gt; 整数</span><br><span class="line">整数 --&gt; byte</span><br><span class="line">整数 --&gt; short</span><br><span class="line">整数 --&gt; int</span><br><span class="line">整数 --&gt; long</span><br><span class="line">数值型 --&gt; 浮点</span><br><span class="line">浮点 --&gt; float</span><br><span class="line">浮点 --&gt; double</span><br><span class="line">A --&gt; 字符型</span><br><span class="line">字符型 --&gt; char</span><br><span class="line">A --&gt; 布尔型</span><br><span class="line">布尔型 --&gt; boolean</span><br><span class="line"></span><br><span class="line">数据类型 --&gt; B(引用数据类型)</span><br><span class="line">B --&gt; 类(class)</span><br><span class="line">B --&gt; 接口(interface)</span><br><span class="line">B --&gt; 数组</span><br></pre></td></tr></table></figure><p><strong>8种基本数据类型级别</strong></p><ul><li>short、byte、char -&gt; int -&gt; long -&gt; float -&gt; double</li></ul><p>低到高自动进行数据类型转换</p><p><strong>Java 接口</strong></p><ul><li>抽象方法的集合</li><li>接口类无法被实例化，但允许多重继承</li></ul><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[可见度] <span class="class"><span class="keyword">interface</span> 接口名称 [<span class="keyword"><span class="keyword">extends</span> </span>其他的类名] </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 声明变量</span></span><br><span class="line">  <span class="comment">// 声明方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>类使用implements 关键字实现接口(<code>类要实现接口中所有方法</code>)</li></ul><p><strong>标记接口</strong></p><ul><li>建立一个公共的父接口</li><li>向一个类添加数据类型</li></ul><p><strong>Package 包</strong></p><ul><li>更好的组织类、区别类名的命名空间(<code>分离不同的java程序</code>)</li></ul><p><strong>Java 程序执行过程</strong></p><blockquote><p>Java程序执行，JVM把内存分为5块区域</p></blockquote><ul><li>栈<ul><li>局部变量</li></ul></li><li>堆<ul><li>队列优先、先进先出</li><li>实体（数组、对象)可存放多个数据，有默认值</li></ul></li><li>方法区<ul><li>字节码文件存储区</li></ul></li><li>本地方法区</li><li>寄存器</li></ul><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">函数在栈中执行（调用开辟空间，执行 - 先进后出)</span><br><span class="line"><span class="string">|</span></span><br><span class="line"><span class="string">| 执行完，出栈、局部变量销毁 -&gt; 出栈 -&gt; 释放内存</span></span><br><span class="line"></span><br><span class="line">堆: 队列优先、先进先出</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>JVM 首先调用 <code>main 函数</code></p><ol><li>方法区: 加载字节码文件，如 Animal.class</li></ol><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Animal</span>()</span> &#123;&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>静态暂存区: 存放字节码中的类变量(<code>静态属性</code>)</li><li>main 函数入栈</li><li>根据字节码文件实例化对象、堆内存开辟空间，并分配内存首地址</li></ol><p>class 中 finalize 方法被垃圾收集器回收之前调用</p><p><strong>泛型</strong></p><ul><li>通过<code>&lt;数据类型&gt;</code>接收一种引用数据类型，在编译时会使用该类型检查集合中存储的对象是否是该数据类型</li><li>使用泛型不需要强制类型转换</li></ul><p><strong>临时记录</strong></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">RAM:</span> 随机存储器(可读写 -&gt; 内存)</span><br><span class="line"><span class="symbol">ROM:</span> 只读存储器(存放手机固件代码)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>基础</title>
      <link href="/posts/20dbfd00.html"/>
      <url>/posts/20dbfd00.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>模块化</title>
      <link href="/posts/59aa8bdc.html"/>
      <url>/posts/59aa8bdc.html</url>
      
        <content type="html"><![CDATA[<h3 id="AMD">AMD</h3><ul><li>浏览器第一发展原则</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">&#x27;./a&#x27;</span>, <span class="string">&#x27;./b&#x27;</span>], <span class="keyword">function</span>(a, b) &#123;</span><br><span class="line">  <span class="regexp">//</span> 依赖必须一开始就写好</span><br><span class="line">  a.doSomething();</span><br><span class="line">  <span class="regexp">//</span> 此处略去 <span class="number">100</span> 行</span><br><span class="line">  b.doSomething();</span><br><span class="line">  <span class="regexp">//</span>.....</span><br><span class="line">  return &#123;</span><br><span class="line">    save: a,</span><br><span class="line">    change: b</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="regexp">//</span> amdjs API https:<span class="regexp">//gi</span>thub.com<span class="regexp">/amdjs/</span>amdjs-api/wiki</span><br><span class="line"><span class="regexp">//</span> ReauireJs  API http:<span class="regexp">//</span>www.requirejs.org<span class="regexp">/docs/</span>api.html</span><br><span class="line"><span class="regexp">//</span> RequireJs 是一个前端的模块化管理的工具库</span><br></pre></td></tr></table></figure><h3 id="CMD">CMD</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="keyword">function</span>(require, exports, module) &#123;</span><br><span class="line">  var a = require(<span class="string">&#x27;./a&#x27;</span>)</span><br><span class="line">  a.doSomething();</span><br><span class="line">  <span class="regexp">//</span> 此处略去 <span class="number">100</span> 行</span><br><span class="line">  var b = require(<span class="string">&#x27;./b&#x27;</span>)</span><br><span class="line">  <span class="regexp">//</span> 依赖可以就近书写</span><br><span class="line">  b.doSomething();</span><br><span class="line">  <span class="regexp">//</span>.....</span><br><span class="line">&#125;)</span><br><span class="line"><span class="regexp">//</span> seaJs: http:<span class="regexp">//</span>seajs.org<span class="regexp">/docs/</span></span><br><span class="line"><span class="regexp">//</span> API 快速参考 https:<span class="regexp">//gi</span>thub.com<span class="regexp">/seajs/</span>seajs<span class="regexp">/issues/</span><span class="number">266</span></span><br></pre></td></tr></table></figure><h3 id="amd-和-cmd-规范的区别">amd 和 cmd 规范的区别</h3><ul><li>对于依赖的模块<ul><li>cmd：延迟执行，</li><li>amd：提前执行</li><li>AMD | CMD 共同点 ----&gt; 浏览器第一发展原则</li></ul></li><li>CMD 依赖就近(懒加载)，AMD 推崇依赖前置</li></ul><p><a href="http://blog.chinaunix.net/uid-26672038-id-4112229.html">区别</a></p><h3 id="CommonJS-规范">CommonJS 规范</h3><ul><li>CommonJS 是以在浏览器环境之外构建 JavaScript 生态系统为目标而产生的项目，比如在服务器和桌面环境中(nodejs),*同步         加载模块–&gt;该模块以服务器第一原则发展</li><li>服务器端文件已经存在本地硬盘中，加载速读很快，所以不用考虑异步加载的方式</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&gt; student.<span class="property">js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">student</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Add Student:&quot;</span>+student);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt; teacher.<span class="property">js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">student</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Add Student:&quot;</span>+student);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">add</span>=add;</span><br><span class="line"></span><br><span class="line">&gt; <span class="keyword">class</span>.<span class="property">js</span></span><br><span class="line"><span class="keyword">var</span> student = <span class="built_in">require</span>(<span class="string">&quot;./student&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> teacher = <span class="built_in">require</span>(<span class="string">&quot;./teacher&quot;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">teacherName,students</span>)&#123;</span><br><span class="line">  teacher.<span class="title function_">add</span>(teacherName)  </span><br><span class="line">  students.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item,index</span>)&#123;</span><br><span class="line">    student.<span class="title function_">add</span>(item)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">add</span>=add;</span><br><span class="line"></span><br><span class="line">&gt; index.<span class="property">js</span></span><br><span class="line"><span class="keyword">var</span> _class=<span class="built_in">require</span>(<span class="string">&quot;./class&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">add</span>=<span class="keyword">function</span>(<span class="params">_class</span>)&#123;</span><br><span class="line">  _class.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _class_=item;</span><br><span class="line">    <span class="keyword">var</span> teacherName=item.<span class="property">teacherName</span>;</span><br><span class="line">    <span class="keyword">var</span> students=item.<span class="property">students</span> </span><br><span class="line">    _class_.<span class="title function_">add</span>(teacherName,students)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="UMD">UMD</h3><ul><li>是AMD和CommonJS的柔合。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Mock</span>数据：</span><br><span class="line">npm install json-server –g</span><br><span class="line">案例：</span><br><span class="line">##comment.<span class="property">js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">data</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;author&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">      <span class="string">&quot;date&quot;</span>: <span class="string">&quot;5分钟前&quot;</span>,</span><br><span class="line">      <span class="string">&quot;content&quot;</span>: <span class="string">&quot;今天天气很好啊&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">****commonjs规范********</span><br><span class="line"><span class="keyword">const</span> comment = <span class="built_in">require</span>(<span class="string">&#x27;./comment.js&#x27;</span>);</span><br><span class="line"><span class="comment">// mock.js   </span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="string">&quot;list&quot;</span>: comment</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@@@@访问方法@@@@@</span><br><span class="line">json-server mock.<span class="property">js</span> --watch –port <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#############################################################################</span><br><span class="line">所有npm包都遵循的是<span class="title class_">CommonJs</span>规范：</span><br><span class="line">同步的</span><br><span class="line">浏览器访问服务器上的文件，拿回的文件有延迟，而服务器端读取自己硬盘的上的文件没有延迟现象</span><br><span class="line">暴露接口：<span class="variable language_">module</span> <span class="built_in">exports</span>  rquire <span class="variable language_">global</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">参数说明:</span></span><br><span class="line"><span class="comment">require——模块加载函数，用于记载依赖模块。</span></span><br><span class="line"><span class="comment">exports——接口点，将数据或方法定义在其上则将其暴露给外部调用。</span></span><br><span class="line"><span class="comment">module——模块的元数据</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">module.id——模块的ID。</span></span><br><span class="line"><span class="comment">module.dependencies——一个数组，存储了此模块依赖的所有模块的ID列表</span></span><br><span class="line"><span class="comment">module.exports——与exports指向同一个对象。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">```一个node.js文件即一个模块</span></span><br><span class="line"><span class="comment">module.exports 与exports的区别：</span></span><br><span class="line"><span class="comment">``module.exports初始值是一个空对象</span></span><br><span class="line"><span class="comment">``exports是指向module.exports的引用</span></span><br><span class="line"><span class="comment">``exports 定位上是给modules.exports添加属性和方法</span></span><br><span class="line"><span class="comment">``require返回的是module.exports</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="attr">http</span>:<span class="comment">//blog.chinaunix.net/uid-26672038-id-4112229.html</span></span><br><span class="line"><span class="comment">// amd 和 cmd 规范的区别：</span></span><br><span class="line"><span class="comment">// 1对于依赖的模块：</span></span><br><span class="line"><span class="comment">// cmd：延迟执行，</span></span><br><span class="line"><span class="comment">// amd：提前执行</span></span><br><span class="line"><span class="comment">// AMD | CMD 共同点----&gt;浏览器第一发展原则。</span></span><br><span class="line"><span class="comment">// 2. CMD 依赖就近(懒加载)，AMD 推崇依赖前置。看代码：</span></span><br><span class="line"><span class="comment">// CMD</span></span><br><span class="line"><span class="comment">//  如：app.js</span></span><br><span class="line"><span class="comment">// define(function(require, exports, module) &#123;</span></span><br><span class="line"><span class="comment">//    var a = require(&#x27;./a&#x27;),</span></span><br><span class="line"><span class="comment">//        a.doSomething();</span></span><br><span class="line"><span class="comment">//      // 此处略去 100 行</span></span><br><span class="line"><span class="comment">//       var b = require(&#x27;./b&#x27;)</span></span><br><span class="line"><span class="comment">//       // 依赖可以就近书写</span></span><br><span class="line"><span class="comment">//       b.doSomething();</span></span><br><span class="line"><span class="comment">//       //.....</span></span><br><span class="line"><span class="comment">//      export.c=function()&#123;</span></span><br><span class="line"><span class="comment">//         console.log(&quot;模块被暴露，并打印&quot;);</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"><span class="comment">//      *****exports和return选一个即可</span></span><br><span class="line"><span class="comment">//      return &#123;</span></span><br><span class="line"><span class="attr">C</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;模块被暴露，并打印&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">//     &#125; </span></span><br><span class="line"><span class="comment">//   &#125;)</span></span><br><span class="line"><span class="comment">//   页面加载:  </span></span><br><span class="line">  &lt;script src=<span class="string">&quot;sea.js&quot;</span> charset=<span class="string">&quot;utf-8&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="number">1.</span>     <span class="title class_">Seajs</span>.<span class="title function_">config</span>(&#123;    <span class="comment">// 设置全局配置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     <span class="attr">base</span>: <span class="string">&#x27;path/to/jslib/&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">alias</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     <span class="string">&#x27;app&#x27;</span>: <span class="string">&#x27;path/to/app/&#x27;</span>   <span class="comment">//对较长路径进行缩写</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">charset</span>: <span class="string">&#x27;utf-8&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">timeout</span>: <span class="number">20000</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">debug</span>: <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    seajs.<span class="title function_">use</span>(<span class="string">&#x27;app.js&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">思想解答:<span class="title class_">SeaJS</span>本来集成了一个打包部署工具spm ，将所有模块压缩合并后并入主入口模块。</span><br><span class="line"><span class="comment">//   seaJs</span></span><br><span class="line"><span class="comment">//     官网 http://seajs.org/docs/</span></span><br><span class="line"><span class="comment">//   API 快速参考 https://github.com/seajs/seajs/issues/266</span></span><br><span class="line"><span class="comment">//  Seajs 组件库:http://panxuepeng.github.io/seajslib</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// // AMD 默认推荐的是：浏览器第一发展原则。</span></span><br><span class="line"><span class="comment">//   main.js---页面主入口文件</span></span><br><span class="line"><span class="built_in">require</span>.<span class="title function_">config</span>(&#123;</span><br><span class="line">　　　　<span class="attr">baseUrl</span>: <span class="string">&quot;js/lib&quot;</span>,</span><br><span class="line">　　　　<span class="attr">paths</span>: &#123;</span><br><span class="line">　　　　　　<span class="string">&quot;jquery&quot;</span>: <span class="string">&quot;jquery.min&quot;</span>,</span><br><span class="line">　　　　　　<span class="string">&quot;underscore&quot;</span>: <span class="string">&quot;underscore.min&quot;</span></span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;);</span><br><span class="line">路径解析为:---js/lib/jquery.<span class="property">min</span>.<span class="property">js</span>---</span><br><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;jquery&#x27;</span>, <span class="string">&#x27;underscore&#x27;</span>], <span class="keyword">function</span>(<span class="params">a, b</span>) &#123;  <span class="comment">// 依赖必须一开始就写好       </span></span><br><span class="line">         a.<span class="title function_">doSomething</span>();</span><br><span class="line">         b.<span class="title function_">doSomething</span>();</span><br><span class="line">         <span class="keyword">return</span> &#123;</span><br><span class="line">              <span class="attr">save</span>:a,</span><br><span class="line">              <span class="attr">change</span>:b</span><br><span class="line">         &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"><span class="comment">//  页面引入:</span></span><br><span class="line">&lt;script src=<span class="string">&quot;./libs/require.js&quot;</span> data-main=<span class="string">&quot;main.js&quot;</span> charset=<span class="string">&quot;utf-8&quot;</span> defer <span class="keyword">async</span>=<span class="string">&quot;true&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">或者将给文件放置在&lt;body&gt;标签底部</span><br><span class="line"><span class="string">``</span><span class="string">`data-main:指定网页程序的主模块</span></span><br><span class="line"><span class="string">`</span><span class="string">`baseUrl + paths 来加载相应的模块</span></span><br><span class="line"><span class="string">//    amdjs API https://github.com/amdjs/amdjs-api/wiki</span></span><br><span class="line"><span class="string">//    ReauireJs  API http://www.requirejs.org/docs/api.html</span></span><br><span class="line"><span class="string">//    RequireJs 是一个前端的模块化管理的工具库^_^</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//CommonJS 是以在浏览器环境之外构建 JavaScript 生态系统为目标而产生的项目，比如在服务器和桌面环境中(nodejs),*同步         加载模块--&gt;该模块以服务器第一原则发展</span></span><br><span class="line"><span class="string">原因：服务器端文件已经存在本地硬盘中，加载速读很快，所以不用考虑异步加载的方式。</span></span><br><span class="line"><span class="string">//  UMD:是AMD和CommonJS的柔合。</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程规范 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pnpm workspace</title>
      <link href="/posts/540b51c0.html"/>
      <url>/posts/540b51c0.html</url>
      
        <content type="html"><![CDATA[<h1>Quick Start：用 pnpm 管理 Monorepo 项目</h1><h2 id="1、什么是-pnpm">1、什么是 pnpm</h2><p>非常推荐先阅读这两篇文章了解 pnpm 的优势：</p><ul><li><a href="https://zhuanlan.zhihu.com/p/404784010">zoomdong：Pnpm: 最先进的包管理工具</a></li><li><a href="https://zhuanlan.zhihu.com/p/422003598">熊猫 MrPanda：【译】pnpm vs Yarn: monorepo node_modules</a></li></ul><p>在开始之前，可以带着下面几个问题阅读：</p><ol><li>什么是”幻影依赖“和”NPM 分身“？</li><li>什么是”硬链接“和”软链接“？</li><li>pnpm 是如何进行包的缓存？</li><li>monorepo 的场景下，pnpm 如何将依赖提升？</li></ol><h2 id="2、快速开始">2、快速开始</h2><p>先全局安装一个 pnpm，然后通过：</p><pre><code>pnpm init</code></pre><p>创建一个项目——在本例中，我们实现一个前后端分离、共同管理的 demo。</p><p>首先，我们需要理解 pnpm 中的工作区，在 pnpm 中可以通过创建并配置 pnpm-workspace.yaml 设置 workspace：</p><pre><code>packages:  - 'packages/**'</code></pre><p>上面这段配置的意思就是通过 glob 语法将<code>packages</code>下的所有文件夹都当做一个 package，添加到 monorepo 中进行管理。</p><p>接下来，我们就按照配置，创建<code>packages</code>文件夹，并在其目录中创建三个子项目，分别是：web 端、node 端和工具类。</p><pre><code>├── packages│   ├── server│   ├── tools│   └── web</code></pre><p><strong>2.1、全局依赖</strong></p><p>我们知道不管是一个 web 项目还是一个 node 项目，它都是基于同一种语言编写，所以我们可以只安装一次 TypeScript，供三个项目使用，这就体现出了 monorepo 的优势。</p><p>类似于<code>TypeScript</code>或<code>lodash</code>这样通用的依赖，我们通常可以把他们安装到根目录，即使用下面这条命令：</p><pre><code>pnpm install typescript -D -w</code></pre><p>这里的<code>-D</code>指令大家都很熟悉，就是把依赖作为<code>devDependencies</code>安装；而<code>-w</code>就是把依赖安装到根目录的<code>node_modules</code>当中，目录结构大致如下：</p><pre><code>├── node_modules│   ├── @types│   └── typescript -&gt; .pnpm/typescript@4.4.4/node_modules/typescript├── package.json├── packages│   ├── server│   ├── tools│   └── web├── pnpm-lock.yaml└── pnpm-workspace.yaml</code></pre><p>虽然 packages 下的项目都没有安装 ts，但是倘若在项目中使用到，就会通过依赖递归查找的原则逐级往上寻找，自然会找到 monorepo 中根目录的依赖。</p><p><strong>2.2、局部依赖</strong></p><p>对于某些依赖，可能仅存在于某几个 package 中，我们就可以单独为他们安装，当然，可以通过<code>cd packges/xxx</code>后，执行<code>pnpm install xxx</code>，但这样重复操作多次未免有些麻烦，pnpm 提供了一个快捷指令——filter。</p><p>比如我们只在 web 应用中用到<code>vue</code>，那就可以为它单独安装。首先要拿到它的 package name，这个是我们在子项目中自定义的，通常是”@命名空间+包名@“的方式，比如<code>@vite/xx</code>或<code>@babel/xx</code>，在本例中，我们都以@panda 开头。那么命令如下：</p><pre><code>pnpm install vue -r --filter @panda/web</code></pre><p>在<code>packages/web/package.json</code>中，我们可以看到：</p><pre><code>&quot;dependencies&quot;: &#123;    &quot;vue&quot;: &quot;^3.0.4&quot;  &#125;</code></pre><p>同时，该子项目的<code>node_modules</code>中也可以看到<code>vue</code>被添加了进来。</p><p><strong>2.3、link 机制</strong></p><p>在 monorepo 中，我们往往需要 package 间的引用，比如本例中的<code>@panda/tools</code>就会被<code>@panda/server</code>和<code>@panda/web</code>依赖。</p><p>我们可以使用类似于 3.2 中的方法安装：</p><pre><code>pnpm i @panda/tools -r --filter @panda/server @panda/web</code></pre><p>在执行前，我们可以添加一个函数，比如：</p><pre><code>export const getNow = () =&gt; (new Date().getTime());</code></pre><p>导出一个函数后，我们执行刚才的安装指令，这时在项目中会以<code>workspace</code>的版本体现。我们查看 web 项目中的 package.json：</p><pre><code>  &quot;dependencies&quot;: &#123;    &quot;@panda/tools&quot;: &quot;workspace:^1.0.0&quot;, // 通过 workspace 为本地引用    &quot;vue&quot;: &quot;^3.0.4&quot;  &#125;,</code></pre><p>我们再进一步查看 web 项目下的 node_modules，可以发现：</p><p><img src="./images/package-dependency.jpeg" alt=""></p><p>通过软链接引用了我们的 tools package，我们就可以使用了正常的引入和调用了！</p><pre><code>import &#123; getNow &#125; from '@panda/tools';getNow();</code></pre><p>使用 VSCode 自带的快速跳转，我们可以直接跳转到 tools 源代码定义文件中，这样就巧妙地运用了 monorepo 的优势。</p><p>这时你会有一个疑问：当这样的工具包被发布到平台后，如何识别其中的<code>workspace</code>呢？</p><p>实际上，当执行了<code>pnpm publish</code>后，会把基于的 workspace 的依赖变成外部依赖，如：</p><pre><code>// before&quot;dependencies&quot;: &#123;    &quot;@panda/tools&quot;: &quot;workspace:^1.0.0&quot;  &#125;,// after&quot;dependencies&quot;: &#123;    &quot;@panda/tools&quot;: &quot;^1.0.0&quot;  &#125;,</code></pre><p>解决了开发环境和生产环境对依赖的问题。</p><p><strong>2.4、启动与开发</strong></p><p>一个 monorepo 往往是一个整体的项目，所以我们需要同时执行多个指令，在 pnpm 中，可以通过<code>-C</code>进行配置：</p><pre><code>&quot;scripts&quot;: &#123;    &quot;start&quot;: &quot;pnpm -C ./packages/server start:server &amp; pnpm -C ./packages/web dev&quot;,  &#125;</code></pre><p>这条命令的含义就是同时运行服务端和前端代码。</p><p>而<code>start:server</code>和<code>dev</code>都是我们在子项目的<code>scripts</code>中自己配置的。</p><p>如果经过了 git 合码后，项目的依赖变化比较大，可以配置一条 clean 指令：</p><pre><code>  &quot;scripts&quot;: &#123;    &quot;clean&quot;: &quot;rm -rf node_modules **/*/node_modules&quot;,  &#125;</code></pre><p>这样根目录和子应用下的<code>node_modules</code>都会被删除。再次执行<code>pnpm install</code>也会同时为根目录和所有 package 安装需要的依赖。</p><p>在实际开发中，我们往往会纠结什么样的代码应该放在业务项目中，什么样的代码要单独抽离为一个 package。举几个很简单的例子：</p><ul><li>对于一个大型的应用我们通常需要定制一套组件库，那么我们就可以把组件库最基础的部分抽离成 package，在业务代码中进行二次业务封装，这样在其他的项目也能复用。</li><li>如果一个项目包含 PC 和 H5，我们不妨把这两类项目拆分成不同的 package。</li><li>如果你在打造一个工具，而它具备了 parser、render 等能力，那也可以将不同的能力解耦到不同的 package 当中。</li></ul><h2 id="3、总结">3、总结</h2><p>总的来说，pnpm 管理 monorepo 已经是当下非常热门且推荐的做法，已经有很多项目为我们亲身实践过：</p><p><img src="./images/usage-case.jpeg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Monorepo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Monorepo</title>
      <link href="/posts/fec0de0c.html"/>
      <url>/posts/fec0de0c.html</url>
      
        <content type="html"><![CDATA[<h2 id="1、什么是-Monorepo">1、什么是 Monorepo ?</h2><p><code>Monorepo</code>是管理项目代码的方式之一，指在一个大的项目仓库（repo）中 管理多个模块/包（package），这种类型的项目大都在项目根目录下有一个 packages 文件夹，分多个项目管理。大概结构如下：</p><pre><code>├── packages|   ├── pkg1|   |   ├── package.json|   ├── pkg2|   |   ├── package.json├── package.json</code></pre><p>目前很很多大型项目采用这样的结构，比如：<code>Babel</code>、<code>vue3</code>和<code>vite</code>等。</p><p>Monorepo 的好处在哪里嘞？</p><ul><li><strong>统一管理</strong>。比如微前端项目，多个子应用可以放在同一个<code>monorepo</code>中方便管理；后端用<code>node.js</code>的项目放在<code>monorepo</code>中也可以使用同一套技术栈管理。在 CI/CD 等流水线过程中，方便统一迭代或升级版本，也方便做通用化的配置，适用到多个子项目当中。</li><li><strong>依赖提升</strong>。如果多个项目都依赖了诸如<code>react</code>、<code>vue</code>或<code>TypeScript</code>等常用库，那可以通过<code>lerna</code>或者<code>yarn workspace</code>将依赖提升到最外层，多个子模块/包复用同一个依赖，减小项目体积。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Monorepo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>58集团前端监控体系</title>
      <link href="/posts/b8563d9c.html"/>
      <url>/posts/b8563d9c.html</url>
      
        <content type="html"><![CDATA[<h3 id="58集团前端监控体系">58集团前端监控体系</h3><p>自研前端监控场景</p><ul><li>了解线上异常和性能监控</li><li>学习大型系统的设计方案</li><li>搭建内部监控系统</li></ul><p>业内监控系统</p><ul><li>sentry</li><li>阿里云</li><li>岳鹰</li><li>58已有监控系统</li></ul><h4 id="一、快速接入-自研前端监控的快速推广方法">一、快速接入: 自研前端监控的快速推广方法</h4><p>一个最简单的监控SDK</p><ul><li>普通错误: onerror</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onerror</span> = <span class="function">(<span class="params">msg, source, line, column, error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">errorReport</span>(&#123; msg, source, line, column, error &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Promise 错误： unhandledRejection</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;unhandledrejection&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">errorReport</span>(&#123; <span class="attr">msg</span>: event.<span class="property">reason</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>最常用的接入方式： 推广成本高</p><ol><li>在平台新建项目、获取项目ID</li><li>通过 script 或 npm 引入</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Sentry</span> <span class="keyword">from</span> <span class="string">&#x27;@sentry/browser&#x27;</span>;</span><br><span class="line"><span class="comment">// examplePublicKey: 项目的唯一标识</span></span><br><span class="line"><span class="title class_">Sentry</span>.<span class="title function_">init</span>(&#123;</span><br><span class="line">  <span class="attr">dsn</span>: <span class="string">&#x27;https://examplePublicKey@o0.ingest.sentry.io/0&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>怎么区分不同的Hybrid？</p><ul><li>常用方式：通过项目ID区分上报数据来源</li><li>注入方式：通过页面URL区分上报数据来源</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">errorReport</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="comment">// 用url 作为项目统计标识</span></span><br><span class="line">  <span class="keyword">const</span> report = &#123; ...event, <span class="attr">url</span>: location.<span class="property">href</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;domain/monitor/js&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(report)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思路: Native 向 Hybrid 自动注入【SDK -&gt; 页面加载完成时， Native 注入 -&gt; Hybrid】</p><ul><li>监听页面加载完成事件: didFinish(iOS)、onPageFinished(Android)</li><li>Native 通过 evaluateJavaScript 将监控的SDK 注入JS上下文中</li><li>Hybrid 页面自动收集报错</li><li>直接使用监控平台、查看报错</li></ul><p>以 URL 为统计维度、引发的三个问题</p><ol><li><p>以URL为维度和以项目ID为维度，如何兼容？</p></li><li><p>一个项目有多个URL 怎么统计？</p></li><li><p>URL动态变化的项目如何统计？</p></li></ol><ul><li>比如：文章详情页</li></ul><p>其它接入手段</p><ol><li>开发节点：通过内部脚手架方式注入【NPM、Script】</li><li>上线阶段：JS注入、HTML注入</li><li>上线之后：Native注入、公用JS注入</li></ol><h4 id="二、日志收集：全面收集线上监控数据">二、日志收集：全面收集线上监控数据</h4><h4 id="三、整体架构：整体功能架构和技术架构">三、整体架构：整体功能架构和技术架构</h4><h4 id="四、告警实现：实时告警的功能设计和实现方案">四、告警实现：实时告警的功能设计和实现方案</h4><p>Apache Druid: 列式读取</p><p>ES 搜索 可查看 日志详情<br>某个用户的浏览记录、包括：性能、正常、异常日志的记录。敏感信息需要用户授权才能上报<br>ES 将多类数据按时间排序，即可显示出某次用户真正的浏览轨迹</p><p>看板: 一个项目有多种聚合指标。如js异常、接口异常、白屏时间等信息汇总为一个看板，方便业务同学查看<br>分析: 关联异常、性能的具体分布情况<br>告警: 某个指标超出阈值时，需要发出告警通知开发者</p>]]></content>
      
      
      <categories>
          
          <category> 埋点与监控 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Docker入门</title>
      <link href="/posts/f5f9fa9b.html"/>
      <url>/posts/f5f9fa9b.html</url>
      
        <content type="html"><![CDATA[<h3 id="Docker">Docker</h3><blockquote><p>微服务（microservices）的思想：软件把任务外包出去，让各种外部服务完成这些任务，软件本身只是底层服务的调度中心和组装层</p></blockquote><ul><li>演示项目结构</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hello-world</span><br><span class="line">│   <span class="selector-class">.git</span></span><br><span class="line">│<span class="selector-class">.dockerignore</span></span><br><span class="line">│   node_modules    </span><br><span class="line">│index<span class="selector-class">.js</span></span><br><span class="line">│package<span class="selector-class">.json</span></span><br><span class="line">└───README.md</span><br></pre></td></tr></table></figure><ul><li>Dockerfile</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">8.4</span>         <span class="comment"># 该 image 文件继承官方的 node image，冒号表示标签，这里标签是8.4，即8.4版本的 node。</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /app           <span class="comment"># 将当前目录下的所有文件（除了.dockerignore排除的路径），都拷贝进入 image 文件的/app目录。</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app          <span class="comment"># 相当于 `cd` [后续的RUN、CMD、ENTRYPOINT等指令指定工作目录]</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install       <span class="comment"># 在/app目录下，运行npm install命令安装依赖。注意，安装后所有的依赖，都将打包进入 image 文件。[在 image 文件的构建阶段执行，执行结果都会打包进入 image 文件、可有多个 RUN 命令]</span></span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span>           <span class="comment"># 将容器 3000 端口暴露出来， 允许外部连接这个端口。</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&#x27;npm&#x27;</span>, <span class="string">&#x27;start&#x27;</span>]  <span class="comment"># 启动应用[在容器启动后执行、CMD 命令唯一、声明该命令后，docker run 不可附加额外命令， 如： /bin/bashs]</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ENTRYPOINT: 将 CMD 的内容作为参数传递给 ENTRYPOINT 指令 即 &lt;ENTRYPOINT&gt; &quot;CMD&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>构建镜像</li></ul><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t hello-world .</span><br></pre></td></tr></table></figure><ul><li>启动镜像</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> container run --rm -p <span class="number">8000</span>:<span class="number">3000</span> -itd hello-world:latest</span><br></pre></td></tr></table></figure><ul><li>额外常用命令</li></ul><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>查看本机<span class="keyword">image</span>:</span><br><span class="line">docker <span class="keyword">image</span> <span class="keyword">ls</span></span><br><span class="line">docker <span class="keyword">image</span> rm [imageName]</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>查看本机<span class="keyword">container</span>:</span><br><span class="line">docker ps</span><br><span class="line">docker <span class="keyword">container</span> <span class="keyword">ls</span></span><br><span class="line">docker <span class="keyword">container</span> <span class="keyword">ls</span> --all</span><br><span class="line">docker <span class="keyword">container</span> kill containerID</span><br><span class="line">docker <span class="keyword">container</span> rm containerID</span><br><span class="line">docker <span class="keyword">container</span> start containerID</span><br><span class="line">docker <span class="keyword">container</span> stop containerID</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>从dockerhub 上pull镜像</span><br><span class="line">docker pull 镜像名称</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>查看docker容器的输出</span><br><span class="line">docker <span class="keyword">container</span> logs</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>进入一个正在运行的docker容器</span><br><span class="line">docker <span class="keyword">container</span> <span class="keyword">exec</span> -it containerID /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>宿主机与docker容器文件互传</span><br><span class="line">docker cp admin/ containerID:/home/static</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span> 查看镜像详细信息</span><br><span class="line">docker inspect <span class="string">`$&#123;镜像名称&#125;:$&#123;镜像版本&#125;`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Docker Compose 工具使用<ul><li>管理多个 Docker 容器组成一个应用</li><li>命令<ul><li>启动 docker-compose up</li><li>关闭 docker-compose stop</li><li>删除 docker-compose rm</li></ul></li></ul></li></ul><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">// docker-compose.yaml</span></span><br><span class="line"><span class="attribute">mysql</span><span class="punctuation">:</span></span><br><span class="line"><span class="attribute">image</span><span class="punctuation">:</span> <span class="string">mysql:5.7</span></span><br><span class="line"><span class="attribute">environment</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=123456</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">MYSQL_DATABASE=wordpress</span></span><br><span class="line"><span class="attribute">web</span><span class="punctuation">:</span></span><br><span class="line"><span class="attribute">image</span><span class="punctuation">:</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attribute">links</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line"><span class="attribute">environment</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">WORDPRESS_DB_PASSWORD=123456</span></span><br><span class="line"><span class="attribute">ports</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">&quot;127.0.0.3:8080:80&quot;</span></span><br><span class="line"><span class="attribute">working_dir</span><span class="punctuation">:</span> <span class="string">/var/www/html</span></span><br><span class="line"><span class="attribute">volumes</span><span class="punctuation">:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">wordpress:/var/www/html</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="镜像优化">镜像优化</h3><ul><li>多阶段构建将多个层压缩为一个</li><li>使用distroless 存储库<ul><li>“distroless”镜像只包含应用程序及其运行时依赖项，不包含程序包管理器、shell以及在标准Linux发行版中可以找到的任何其他程序</li><li>无 shell、安全、生产环境下 推荐</li></ul></li><li>使用Alpine基础镜像替换distroless基础镜像<ul><li>兼容性较差</li></ul></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">8</span> as build</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package.json index.js ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br><span class="line"><span class="comment"># FROM gcr.io/distroless/nodejs</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">8</span>-alpine</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build /app /</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;start&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包        docker build -t hello-world .</span></span><br><span class="line"><span class="comment"># 查看镜像大小 docker images | grep hello-world</span></span><br><span class="line"><span class="comment"># 启动  docker run -p 3000:3000 -itd --init hello-world</span></span><br><span class="line"><span class="comment"># 进入容器     docker exec -it containerID sh / #</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产环境下 推荐 </span></span><br></pre></td></tr></table></figure><p><a href="https://www.docker.org.cn/docker/176.html">参考链接</a></p><blockquote><p>传输快、部署体积小</p></blockquote><p>COPY、ADD和RUN语句会向镜像中添加新层</p><h3 id="镜像导入导出">镜像导入导出</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">导出镜像</span><br><span class="line">sudo docker commit <span class="attr">--author</span> lijiahao <span class="attr">--message</span> <span class="string">&quot;backup mysql container&quot;</span> mysql mysql:<span class="number">5.6</span></span><br><span class="line">sudo docker save mysql:<span class="number">5.6</span> &gt; mysql<span class="selector-class">.tar</span></span><br><span class="line"></span><br><span class="line">导入镜像</span><br><span class="line">sudo docker load -<span class="selector-tag">i</span> &lt; mysql.tar</span><br></pre></td></tr></table></figure><h3 id="gitlab容器-数据备份">gitlab容器 数据备份</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">备份：</span><br><span class="line">docker exec -t gitlab gitlab-rake gitlab:backup:create</span><br><span class="line">[gitlab 为容器名称、备份文件在 <span class="regexp">/data/</span>backups 目录下]</span><br><span class="line"></span><br><span class="line">恢复：</span><br><span class="line">docker exec -t gitlab gitlab-rake gitlab:backup:restore</span><br><span class="line">[将备份文件放置回 新应用的 <span class="regexp">/data/</span>backups 目录下]</span><br><span class="line"></span><br><span class="line">备注：记得手动将 gitlab.rb  gitlab-secrets.json 放置回新的 config 目录下</span><br></pre></td></tr></table></figure><h3 id="docker-compose">docker-compose</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose up -d</span></span><br></pre></td></tr></table></figure><h3 id="image-优化">image 优化</h3><hr><ol><li>COPY,ADD,RUN 会向镜像中添加新层</li></ol>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>前端埋点与监控</title>
      <link href="/posts/432abbac.html"/>
      <url>/posts/432abbac.html</url>
      
        <content type="html"><![CDATA[<h3 id="概览">概览</h3><blockquote><ul><li>为什么要做前端监控</li><li>前端监控目标</li><li>前端监控流程</li><li>编写采集脚本<ul><li>日志系统监控</li><li>错误监控</li><li>接口异常</li><li>白屏监控</li><li>加载时间</li><li>性能指标</li><li>卡顿</li><li>pv</li></ul></li><li><a href="#qa">扩展问题</a><ol><li>性能监控指标</li><li>前端怎么做性能监控</li><li>线上错误监控怎么做</li><li>导致内存泄漏的方法，怎么监控内存泄漏</li><li>Node 怎么做性能监控</li></ol></li></ul></blockquote><h2 id="1-为什么要做前端监控">1. 为什么要做前端监控</h2><ul><li>更快的发现问题和解决问题</li><li>做产品的决策依据</li><li>为业务扩展提供了更多可能性</li><li>提升前端工程师的技术深度和广度，打造简历亮点</li></ul><h2 id="2-前端监控目标">2. 前端监控目标</h2><h3 id="2-1-稳定性-stability">2.1 稳定性 stability</h3><ul><li>js错误：js执行错误、promise异常</li><li>资源错误：js、css资源加载异常</li><li>接口错误：ajax、fetch请求接口异常</li><li>白屏：页面空白</li></ul><h3 id="2-2-用户体验-experience">2.2 用户体验 experience</h3><h3 id="2-3-业务-business">2.3 业务 business</h3><ul><li>pv：页面浏览量和点击量</li><li>uv：访问某个站点的不同ip的人数</li><li>用户在每一个页面的停留时间</li></ul><h2 id="3-前端监控流程">3. 前端监控流程</h2><ol><li>前端埋点</li><li>数据上报</li><li>加工汇总</li><li>可视化展示</li><li>监控报警</li></ol><p><img src="./public/static/images/maidian.png" alt="image.png"></p><h3 id="3-1-常见的埋点方案">3.1 常见的埋点方案</h3><h4 id="3-1-1-代码埋点">3.1.1 代码埋点</h4><ul><li>嵌入代码的形式</li><li>优点：精确（任意时刻，数据量全面）</li><li>缺点：代码工作量大，版本更新成本高，影响线上系统文档性</li><li>友盟、百度统计等第三方数据统计服务商大都采用这种方式</li></ul><h4 id="3-1-2-可视化埋点">3.1.2 可视化埋点</h4><ul><li>通过可视化交互的手段，代替代码埋点</li><li>将业务代码和埋点代码分离，提供一个可视化交互的页面，输入为业务代码，通过这个系统，可以在业务代码中自定义的增加埋点事件等等，最后输出的代码耦合了业务代码和埋点代码</li><li>用系统来代替手工插入埋点代码</li><li>TalkingData、诸葛 IO、腾讯 MTA等</li></ul><h4 id="3-1-3-无痕埋点">3.1.3 无痕埋点</h4><ul><li>前端的任意一个事件被绑定一个标识，所有的事件都被记录下来</li><li>通过定期上传记录文件，配合文件解析，解析出来我们想要的数据，并生成可视化报告供专业人员分析</li><li>无痕埋点的优点是采集全量数据，不会出现漏埋和误埋等现象</li><li>缺点是给数据传输和服务器增加压力，也无法灵活定制数据结构</li></ul><h2 id="4-编写采集脚本">4. 编写采集脚本</h2><h3 id="4-1-接入日志系统">4.1 接入日志系统</h3><ul><li>各公司一般都有自己的日志系统，接收数据上报，例如：阿里云</li></ul><h3 id="4-2-监控错误">4.2 监控错误</h3><h4 id="4-2-1-错误分类">4.2.1 错误分类</h4><ul><li>js错误（js执行错误，promise异常）</li><li>资源加载异常：监听error</li></ul><h4 id="4-2-2-数据结构分析">4.2.2 数据结构分析</h4><h5 id="1-jsError">1. jsError</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端监控系统&quot;</span><span class="punctuation">,</span> <span class="comment">// 页面标题</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span> <span class="comment">// 页面URL</span></span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1590815288710&quot;</span><span class="punctuation">,</span> <span class="comment">// 访问时间戳</span></span><br><span class="line">    <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Chrome&quot;</span><span class="punctuation">,</span> <span class="comment">// 用户浏览器类型</span></span><br><span class="line">    <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stability&quot;</span><span class="punctuation">,</span> <span class="comment">// 大类</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error&quot;</span><span class="punctuation">,</span> <span class="comment">// 小类</span></span><br><span class="line">    <span class="attr">&quot;errorType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jsError&quot;</span><span class="punctuation">,</span> <span class="comment">// 错误类型</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Uncaught TypeError: Cannot set property &#x27;error&#x27; of undefined&quot;</span><span class="punctuation">,</span> <span class="comment">// 类型详情</span></span><br><span class="line">    <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span> <span class="comment">// 访问的文件名</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0:0&quot;</span><span class="punctuation">,</span> <span class="comment">// 行列信息</span></span><br><span class="line">    <span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;btnClick (http://localhost:8080/:20:39)^HTMLInputElement.onclick (http://localhost:8080/:14:72)&quot;</span><span class="punctuation">,</span> <span class="comment">// 堆栈信息</span></span><br><span class="line">    <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HTML BODY #container .content INPUT&quot;</span> <span class="comment">// 选择器</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="2-promiseError">2. promiseError</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">&quot;errorType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;promiseError&quot;</span><span class="punctuation">,</span><span class="comment">//错误类型 </span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;someVar is not defined&quot;</span><span class="punctuation">,</span><span class="comment">//类型详情</span></span><br><span class="line">    <span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/:24:29^new Promise (&lt;anonymous&gt;)^btnPromiseClick (http://localhost:8080/:23:13)^HTMLInputElement.onclick (http://localhost:8080/:15:86)&quot;</span><span class="punctuation">,</span><span class="comment">//堆栈信息 </span></span><br><span class="line">    <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HTML BODY #container .content INPUT&quot;</span><span class="comment">//选择器</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="3-resourceError">3. resourceError</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="attr">&quot;errorType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;resourceError&quot;</span><span class="punctuation">,</span><span class="comment">//错误类型</span></span><br><span class="line"><span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/error.js&quot;</span><span class="punctuation">,</span><span class="comment">//访问的文件名</span></span><br><span class="line"><span class="attr">&quot;tagName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SCRIPT&quot;</span><span class="punctuation">,</span><span class="comment">//标签名</span></span><br><span class="line"><span class="attr">&quot;timeStamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;76&quot;</span><span class="punctuation">,</span><span class="comment">//时间 </span></span><br></pre></td></tr></table></figure><h4 id="4-2-3-实现">4.2.3 实现</h4><h5 id="1-资源加载错误-js执行错误">1. 资源加载错误 + js执行错误</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一般JS运行时错误，使用window.onerror捕获处理</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;error&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> lastEvent = <span class="title function_">getLastEvent</span>();</span><br><span class="line">    <span class="comment">// 有 e.target.src(href) 的认定为资源加载错误</span></span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">target</span> &amp;&amp; (event.<span class="property">target</span>.<span class="property">src</span> || event.<span class="property">target</span>.<span class="property">href</span>)) &#123;</span><br><span class="line">      tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="comment">//资源加载错误</span></span><br><span class="line">        <span class="attr">kind</span>: <span class="string">&quot;stability&quot;</span>, <span class="comment">//稳定性指标</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>, <span class="comment">//resource</span></span><br><span class="line">        <span class="attr">errorType</span>: <span class="string">&quot;resourceError&quot;</span>,</span><br><span class="line">        <span class="attr">filename</span>: event.<span class="property">target</span>.<span class="property">src</span> || event.<span class="property">target</span>.<span class="property">href</span>, <span class="comment">//加载失败的资源</span></span><br><span class="line">        <span class="attr">tagName</span>: event.<span class="property">target</span>.<span class="property">tagName</span>, <span class="comment">//标签名</span></span><br><span class="line">        <span class="attr">timeStamp</span>: <span class="title function_">formatTime</span>(event.<span class="property">timeStamp</span>), <span class="comment">//时间</span></span><br><span class="line">        <span class="attr">selector</span>: <span class="title function_">getSelector</span>(event.<span class="property">path</span> || event.<span class="property">target</span>), <span class="comment">//选择器</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">kind</span>: <span class="string">&quot;stability&quot;</span>, <span class="comment">//稳定性指标</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>, <span class="comment">//error</span></span><br><span class="line">        <span class="attr">errorType</span>: <span class="string">&quot;jsError&quot;</span>, <span class="comment">//jsError</span></span><br><span class="line">        <span class="attr">message</span>: event.<span class="property">message</span>, <span class="comment">//报错信息</span></span><br><span class="line">        <span class="attr">filename</span>: event.<span class="property">filename</span>, <span class="comment">//报错链接</span></span><br><span class="line">        <span class="attr">position</span>: (event.<span class="property">lineNo</span> || <span class="number">0</span>) + <span class="string">&quot;:&quot;</span> + (event.<span class="property">columnNo</span> || <span class="number">0</span>), <span class="comment">//行列号</span></span><br><span class="line">        <span class="attr">stack</span>: <span class="title function_">getLines</span>(event.<span class="property">error</span>.<span class="property">stack</span>), <span class="comment">//错误堆栈</span></span><br><span class="line">        <span class="attr">selector</span>: lastEvent</span><br><span class="line">          ? <span class="title function_">getSelector</span>(lastEvent.<span class="property">path</span> || lastEvent.<span class="property">target</span>)</span><br><span class="line">          : <span class="string">&quot;&quot;</span>, <span class="comment">//CSS选择器</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">); <span class="comment">// true代表在捕获阶段调用,false代表在冒泡阶段捕获,使用true或false都可以</span></span><br></pre></td></tr></table></figure><h5 id="2-promise异常">2. promise异常</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当Promise 被 reject 且没有 reject 处理器的时候，会触发 unhandledrejection 事件</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;unhandledrejection&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> lastEvent = <span class="title function_">getLastEvent</span>();</span><br><span class="line">    <span class="keyword">let</span> message = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> line = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> column = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> file = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> stack = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> event.<span class="property">reason</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      message = event.<span class="property">reason</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> event.<span class="property">reason</span> === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      message = event.<span class="property">reason</span>.<span class="property">message</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> reason = event.<span class="property">reason</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reason === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (reason.<span class="property">stack</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> matchResult = reason.<span class="property">stack</span>.<span class="title function_">match</span>(<span class="regexp">/at\s+(.+):(\d+):(\d+)/</span>);</span><br><span class="line">        <span class="keyword">if</span> (matchResult) &#123;</span><br><span class="line">          file = matchResult[<span class="number">1</span>];</span><br><span class="line">          line = matchResult[<span class="number">2</span>];</span><br><span class="line">          column = matchResult[<span class="number">3</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        stack = <span class="title function_">getLines</span>(reason.<span class="property">stack</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="comment">//未捕获的promise错误</span></span><br><span class="line">      <span class="attr">kind</span>: <span class="string">&quot;stability&quot;</span>, <span class="comment">//稳定性指标</span></span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>, <span class="comment">//jsError</span></span><br><span class="line">      <span class="attr">errorType</span>: <span class="string">&quot;promiseError&quot;</span>, <span class="comment">//unhandledrejection</span></span><br><span class="line">      <span class="attr">message</span>: message, <span class="comment">//标签名</span></span><br><span class="line">      <span class="attr">filename</span>: file,</span><br><span class="line">      <span class="attr">position</span>: line + <span class="string">&quot;:&quot;</span> + column, <span class="comment">//行列</span></span><br><span class="line">      stack,</span><br><span class="line">      <span class="attr">selector</span>: lastEvent</span><br><span class="line">        ? <span class="title function_">getSelector</span>(lastEvent.<span class="property">path</span> || lastEvent.<span class="property">target</span>)</span><br><span class="line">        : <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">); <span class="comment">// true代表在捕获阶段调用,false代表在冒泡阶段捕获,使用true或false都可以</span></span><br></pre></td></tr></table></figure><h3 id="4-3-接口异常采集脚本">4.3 接口异常采集脚本</h3><h4 id="4-3-1-数据设计">4.3.1 数据设计</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端监控系统&quot;</span><span class="punctuation">,</span> <span class="comment">//标题</span></span><br><span class="line">  <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span> <span class="comment">//url</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1590817024490&quot;</span><span class="punctuation">,</span> <span class="comment">//timestamp</span></span><br><span class="line">  <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Chrome&quot;</span><span class="punctuation">,</span> <span class="comment">//浏览器版本</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stability&quot;</span><span class="punctuation">,</span> <span class="comment">//大类</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xhr&quot;</span><span class="punctuation">,</span> <span class="comment">//小类</span></span><br><span class="line">  <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;load&quot;</span><span class="punctuation">,</span> <span class="comment">//事件类型</span></span><br><span class="line">  <span class="attr">&quot;pathname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/success&quot;</span><span class="punctuation">,</span> <span class="comment">//路径</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;200-OK&quot;</span><span class="punctuation">,</span> <span class="comment">//状态码</span></span><br><span class="line">  <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7&quot;</span><span class="punctuation">,</span> <span class="comment">//持续时间</span></span><br><span class="line">  <span class="attr">&quot;response&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;\&quot;id\&quot;:1&#125;&quot;</span><span class="punctuation">,</span> <span class="comment">//响应内容</span></span><br><span class="line">  <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span> <span class="comment">//参数</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端监控系统&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1590817025617&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Chrome&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stability&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xhr&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;load&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pathname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/error&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;500-Internal Server Error&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;response&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name=zhufeng&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="4-3-2-实现">4.3.2 实现</h4><p>使用webpack devServer模拟请求</p><ul><li>重写xhr的open、send方法</li><li>监听load、error、abort事件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tracker <span class="keyword">from</span> <span class="string">&quot;../util/tracker&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">injectXHR</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="title class_">XMLHttpRequest</span> = <span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>;</span><br><span class="line">  <span class="keyword">let</span> oldOpen = <span class="title class_">XMLHttpRequest</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">open</span>;</span><br><span class="line">  <span class="title class_">XMLHttpRequest</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">open</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">    method,</span></span><br><span class="line"><span class="params">    url,</span></span><br><span class="line"><span class="params">    <span class="keyword">async</span>,</span></span><br><span class="line"><span class="params">    username,</span></span><br><span class="line"><span class="params">    password</span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="comment">// 上报的接口不用处理</span></span><br><span class="line">    <span class="keyword">if</span> (!url.<span class="title function_">match</span>(<span class="regexp">/logstores/</span>) &amp;&amp; !url.<span class="title function_">match</span>(<span class="regexp">/sockjs/</span>)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">logData</span> = &#123;</span><br><span class="line">        method,</span><br><span class="line">        url,</span><br><span class="line">        <span class="keyword">async</span>,</span><br><span class="line">        username,</span><br><span class="line">        password,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oldOpen.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> oldSend = <span class="title class_">XMLHttpRequest</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">send</span>;</span><br><span class="line">  <span class="keyword">let</span> start;</span><br><span class="line">  <span class="title class_">XMLHttpRequest</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">send</span> = <span class="keyword">function</span> (<span class="params">body</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">logData</span>) &#123;</span><br><span class="line">      start = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">      <span class="keyword">let</span> <span class="title function_">handler</span> = (<span class="params">type</span>) =&gt; <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> duration = <span class="title class_">Date</span>.<span class="title function_">now</span>() - start;</span><br><span class="line">        <span class="keyword">let</span> status = <span class="variable language_">this</span>.<span class="property">status</span>;</span><br><span class="line">        <span class="keyword">let</span> statusText = <span class="variable language_">this</span>.<span class="property">statusText</span>;</span><br><span class="line">        tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">          <span class="comment">//未捕获的promise错误</span></span><br><span class="line">          <span class="attr">kind</span>: <span class="string">&quot;stability&quot;</span>, <span class="comment">//稳定性指标</span></span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;xhr&quot;</span>, <span class="comment">//xhr</span></span><br><span class="line">          <span class="attr">eventType</span>: type, <span class="comment">//load error abort</span></span><br><span class="line">          <span class="attr">pathname</span>: <span class="variable language_">this</span>.<span class="property">logData</span>.<span class="property">url</span>, <span class="comment">//接口的url地址</span></span><br><span class="line">          <span class="attr">status</span>: status + <span class="string">&quot;-&quot;</span> + statusText,</span><br><span class="line">          <span class="attr">duration</span>: <span class="string">&quot;&quot;</span> + duration, <span class="comment">//接口耗时</span></span><br><span class="line">          <span class="attr">response</span>: <span class="variable language_">this</span>.<span class="property">response</span> ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">response</span>) : <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">params</span>: body || <span class="string">&quot;&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="title function_">handler</span>(<span class="string">&quot;load&quot;</span>), <span class="literal">false</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;error&quot;</span>, <span class="title function_">handler</span>(<span class="string">&quot;error&quot;</span>), <span class="literal">false</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;abort&quot;</span>, <span class="title function_">handler</span>(<span class="string">&quot;abort&quot;</span>), <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    oldSend.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-白屏">4.4 白屏</h3><ul><li>白屏就是页面上什么都没有</li></ul><h4 id="4-4-1-数据设计">4.4.1 数据设计</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;前端监控系统&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://localhost:8080/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;1590822618759&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userAgent&quot;</span>: <span class="string">&quot;chrome&quot;</span>,</span><br><span class="line">  <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;stability&quot;</span>, <span class="comment">//大类</span></span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;blank&quot;</span>, <span class="comment">//小类</span></span><br><span class="line">  <span class="string">&quot;emptyPoints&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="comment">//空白点</span></span><br><span class="line">  <span class="string">&quot;screen&quot;</span>: <span class="string">&quot;2049x1152&quot;</span>, <span class="comment">//分辨率</span></span><br><span class="line">  <span class="string">&quot;viewPoint&quot;</span>: <span class="string">&quot;2048x994&quot;</span>, <span class="comment">//视口</span></span><br><span class="line">  <span class="string">&quot;selector&quot;</span>: <span class="string">&quot;HTML BODY #container&quot;</span> <span class="comment">//选择器</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-4-2-实现">4.4.2 实现</h4><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementsFromPoint">elementsFromPoint</a>方法可以获取到当前视口内指定坐标处，由里到外排列的所有元素</li><li>根据 elementsFromPoint api，获取屏幕水平中线和竖直中线所在的元素</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tracker <span class="keyword">from</span> <span class="string">&quot;../util/tracker&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> onload <span class="keyword">from</span> <span class="string">&quot;../util/onload&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSelector</span>(<span class="params">element</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> selector;</span><br><span class="line">  <span class="keyword">if</span> (element.<span class="property">id</span>) &#123;</span><br><span class="line">    selector = <span class="string">`#<span class="subst">$&#123;element.id&#125;</span>`</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.<span class="property">className</span> &amp;&amp; <span class="keyword">typeof</span> element.<span class="property">className</span> === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    selector =</span><br><span class="line">      <span class="string">&quot;.&quot;</span> +</span><br><span class="line">      element.<span class="property">className</span></span><br><span class="line">        .<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        .<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> !!item;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">join</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    selector = element.<span class="property">nodeName</span>.<span class="title function_">toLowerCase</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> selector;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">blankScreen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapperSelectors = [<span class="string">&quot;body&quot;</span>, <span class="string">&quot;html&quot;</span>, <span class="string">&quot;#container&quot;</span>, <span class="string">&quot;.content&quot;</span>];</span><br><span class="line">  <span class="keyword">let</span> emptyPoints = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isWrapper</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> selector = <span class="title function_">getSelector</span>(element);</span><br><span class="line">    <span class="keyword">if</span> (wrapperSelectors.<span class="title function_">indexOf</span>(selector) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      emptyPoints++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">onload</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> xElements, yElements;</span><br><span class="line">    <span class="keyword">debugger</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++) &#123;</span><br><span class="line">      xElements = <span class="variable language_">document</span>.<span class="title function_">elementsFromPoint</span>(</span><br><span class="line">        (<span class="variable language_">window</span>.<span class="property">innerWidth</span> * i) / <span class="number">10</span>,</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">innerHeight</span> / <span class="number">2</span></span><br><span class="line">      );</span><br><span class="line">      yElements = <span class="variable language_">document</span>.<span class="title function_">elementsFromPoint</span>(</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="number">2</span>,</span><br><span class="line">        (<span class="variable language_">window</span>.<span class="property">innerHeight</span> * i) / <span class="number">10</span></span><br><span class="line">      );</span><br><span class="line">      <span class="title function_">isWrapper</span>(xElements[<span class="number">0</span>]);</span><br><span class="line">      <span class="title function_">isWrapper</span>(yElements[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (emptyPoints &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> centerElements = <span class="variable language_">document</span>.<span class="title function_">elementsFromPoint</span>(</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="number">2</span>,</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">innerHeight</span> / <span class="number">2</span></span><br><span class="line">      );</span><br><span class="line">      tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">kind</span>: <span class="string">&quot;stability&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;blank&quot;</span>,</span><br><span class="line">        <span class="attr">emptyPoints</span>: <span class="string">&quot;&quot;</span> + emptyPoints,</span><br><span class="line">        <span class="attr">screen</span>: <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">width</span> + <span class="string">&quot;x&quot;</span> + <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">height</span>,</span><br><span class="line">        <span class="attr">viewPoint</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span> + <span class="string">&quot;x&quot;</span> + <span class="variable language_">window</span>.<span class="property">innerHeight</span>,</span><br><span class="line">        <span class="attr">selector</span>: <span class="title function_">getSelector</span>(centerElements[<span class="number">0</span>]),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//screen.width  屏幕的宽度   screen.height 屏幕的高度</span></span><br><span class="line"><span class="comment">//window.innerWidth 去除工具条与滚动条的窗口宽度 window.innerHeight 去除工具条与滚动条的窗口高度</span></span><br></pre></td></tr></table></figure><h3 id="4-5-加载时间">4.5 加载时间</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceTiming">PerformanceTiming</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Events/DOMContentLoaded">DOMContentLoaded</a></li><li><a href="https://docs.google.com/document/d/1BR94tJdZLsin5poeet0XoTW60M0SjvOJQttKT-JK8HI/view#">FMP</a></li></ul><h4 id="4-5-1-阶段含义">4.5.1 阶段含义</h4><p><img src="./public//static/images/phase.png" alt="image.png"></p><table><thead><tr><th>字段</th><th>含义</th></tr></thead><tbody><tr><td>navigationStart</td><td>初始化页面，在同一个浏览器上下文中前一个页面unload的时间戳，如果没有前一个页面的unload,则与fetchStart值相等</td></tr><tr><td>redirectStart</td><td>第一个HTTP重定向发生的时间,有跳转且是同域的重定向,否则为0</td></tr><tr><td>redirectEnd</td><td>最后一个重定向完成时的时间,否则为0</td></tr><tr><td>fetchStart</td><td>浏览器准备好使用http请求获取文档的时间,这发生在检查缓存之前</td></tr><tr><td>domainLookupStart</td><td>DNS域名开始查询的时间,如果有本地的缓存或keep-alive则时间为0</td></tr><tr><td>domainLookupEnd</td><td>DNS域名结束查询的时间</td></tr><tr><td>connectStart</td><td>TCP开始建立连接的时间,如果是持久连接,则与<code>fetchStart</code>值相等</td></tr><tr><td>secureConnectionStart</td><td>https 连接开始的时间,如果不是安全连接则为0</td></tr><tr><td>connectEnd</td><td>TCP完成握手的时间，如果是持久连接则与<code>fetchStart</code>值相等</td></tr><tr><td>requestStart</td><td>HTTP请求读取真实文档开始的时间,包括从本地缓存读取</td></tr><tr><td>requestEnd</td><td>HTTP请求读取真实文档结束的时间,包括从本地缓存读取</td></tr><tr><td>responseStart</td><td>返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳</td></tr><tr><td>responseEnd</td><td>返回浏览器从服务器收到（或从本地缓存读取，或从本地资源读取）最后一个字节时的Unix毫秒时间戳</td></tr><tr><td>unloadEventStart</td><td>前一个页面的unload的时间戳 如果没有则为0</td></tr><tr><td>unloadEventEnd</td><td>与<code>unloadEventStart</code>相对应，返回的是<code>unload</code>函数执行完成的时间戳</td></tr><tr><td>domLoading</td><td>返回当前网页DOM结构开始解析时的时间戳,此时<code>document.readyState</code>变成loading,并将抛出<code>readyStateChange</code>事件</td></tr><tr><td>domInteractive</td><td>返回当前网页DOM结构结束解析、开始加载内嵌资源时时间戳,<code>document.readyState</code> 变成<code>interactive</code>，并将抛出<code>readyStateChange</code>事件(注意只是DOM树解析完成,这时候并没有开始加载网页内的资源)</td></tr><tr><td>domContentLoadedEventStart</td><td>网页domContentLoaded事件发生的时间</td></tr><tr><td>domContentLoadedEventEnd</td><td>网页domContentLoaded事件脚本执行完毕的时间,domReady的时间</td></tr><tr><td>domComplete</td><td>DOM树解析完成,且资源也准备就绪的时间,<code>document.readyState</code>变成<code>complete</code>.并将抛出<code>readystatechange</code>事件</td></tr><tr><td>loadEventStart</td><td>load 事件发送给文档，也即load回调函数开始执行的时间</td></tr><tr><td>loadEventEnd</td><td>load回调函数执行完成的时间</td></tr></tbody></table><h4 id="4-5-2-阶段计算">4.5.2 阶段计算</h4><table><thead><tr><th>字段</th><th>描述</th><th>计算方式</th><th>意义</th></tr></thead><tbody><tr><td>unload</td><td>前一个页面卸载耗时</td><td>unloadEventEnd – unloadEventStart</td><td>-</td></tr><tr><td>redirect</td><td>重定向耗时</td><td>redirectEnd – redirectStart</td><td>重定向的时间</td></tr><tr><td>appCache</td><td>缓存耗时</td><td>domainLookupStart – fetchStart</td><td>读取缓存的时间</td></tr><tr><td>dns</td><td>DNS 解析耗时</td><td>domainLookupEnd – domainLookupStart</td><td>可观察域名解析服务是否正常</td></tr><tr><td>tcp</td><td>TCP 连接耗时</td><td>connectEnd – connectStart</td><td>建立连接的耗时</td></tr><tr><td>ssl</td><td>SSL 安全连接耗时</td><td>connectEnd – secureConnectionStart</td><td>反映数据安全连接建立耗时</td></tr><tr><td>ttfb</td><td>Time to First Byte(TTFB)网络请求耗时</td><td>responseStart – requestStart</td><td>TTFB是发出页面请求到接收到应答数据第一个字节所花费的毫秒数</td></tr><tr><td>response</td><td>响应数据传输耗时</td><td>responseEnd – responseStart</td><td>观察网络是否正常</td></tr><tr><td>dom</td><td>DOM解析耗时</td><td>domInteractive – responseEnd</td><td>观察DOM结构是否合理，是否有JS阻塞页面解析</td></tr><tr><td>dcl</td><td>DOMContentLoaded 事件耗时</td><td>domContentLoadedEventEnd – domContentLoadedEventStart</td><td>当 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，无需等待样式表、图像和子框架的完成加载</td></tr><tr><td>resources</td><td>资源加载耗时</td><td>domComplete – domContentLoadedEventEnd</td><td>可观察文档流是否过大</td></tr><tr><td>domReady</td><td>DOM阶段渲染耗时</td><td>domContentLoadedEventEnd – fetchStart</td><td>DOM树和页面资源加载完成时间，会触发<code>domContentLoaded</code>事件</td></tr><tr><td>首次渲染耗时</td><td>首次渲染耗时</td><td>responseEnd-fetchStart</td><td>加载文档到看到第一帧非空图像的时间，也叫白屏时间</td></tr><tr><td>首次可交互时间</td><td>首次可交互时间</td><td>domInteractive-fetchStart</td><td>DOM树解析完成时间，此时document.readyState为interactive</td></tr><tr><td>首包时间耗时</td><td>首包时间</td><td>responseStart-domainLookupStart</td><td>DNS解析到响应返回给浏览器第一个字节的时间</td></tr><tr><td>页面完全加载时间</td><td>页面完全加载时间</td><td>loadEventStart - fetchStart</td><td>-</td></tr><tr><td>onLoad</td><td>onLoad事件耗时</td><td>loadEventEnd – loadEventStart</td><td></td></tr></tbody></table><p><img src="./public//static/images/browser-render.png" alt="image.png"></p><h4 id="4-5-3-数据结构">4.5.3 数据结构</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端监控系统&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1590828364183&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chrome&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;experience&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timing&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;connectTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ttfbTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;responseTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;parseDOMTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;80&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;domContentLoadedTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timeToInteractive&quot;</span><span class="punctuation">:</span> <span class="string">&quot;88&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;loadTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;89&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="4-5-4-实现">4.5.4 实现</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onload <span class="keyword">from</span> <span class="string">&quot;../util/onload&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> tracker <span class="keyword">from</span> <span class="string">&quot;../util/tracker&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> formatTime <span class="keyword">from</span> <span class="string">&quot;../util/formatTime&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> getLastEvent <span class="keyword">from</span> <span class="string">&quot;../util/getLastEvent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> getSelector <span class="keyword">from</span> <span class="string">&quot;../util/getSelector&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">timing</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">onload</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        fetchStart,</span><br><span class="line">        connectStart,</span><br><span class="line">        connectEnd,</span><br><span class="line">        requestStart,</span><br><span class="line">        responseStart,</span><br><span class="line">        responseEnd,</span><br><span class="line">        domLoading,</span><br><span class="line">        domInteractive,</span><br><span class="line">        domContentLoadedEventStart,</span><br><span class="line">        domContentLoadedEventEnd,</span><br><span class="line">        loadEventStart,</span><br><span class="line">      &#125; = performance.<span class="property">timing</span>;</span><br><span class="line">      tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">kind</span>: <span class="string">&quot;experience&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;timing&quot;</span>,</span><br><span class="line">        <span class="attr">connectTime</span>: connectEnd - connectStart, <span class="comment">//TCP连接耗时</span></span><br><span class="line">        <span class="attr">ttfbTime</span>: responseStart - requestStart, <span class="comment">//ttfb</span></span><br><span class="line">        <span class="attr">responseTime</span>: responseEnd - responseStart, <span class="comment">//Response响应耗时</span></span><br><span class="line">        <span class="attr">parseDOMTime</span>: loadEventStart - domLoading, <span class="comment">//DOM解析渲染耗时</span></span><br><span class="line">        <span class="attr">domContentLoadedTime</span>:</span><br><span class="line">          domContentLoadedEventEnd - domContentLoadedEventStart, <span class="comment">//DOMContentLoaded事件回调耗时</span></span><br><span class="line">        <span class="attr">timeToInteractive</span>: domInteractive - fetchStart, <span class="comment">//首次可交互时间</span></span><br><span class="line">        <span class="attr">loadTime</span>: loadEventStart - fetchStart, <span class="comment">//完整的加载时间</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-6-性能指标">4.6 性能指标</h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceObserver/observe">PerformanceObserver.observe</a>方法用于观察传入的参数中指定的性能条目类型的集合。当记录一个指定类型的性能条目时，性能监测对象的回调函数将会被调用</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceEntry/entryType">entryType</a></li><li><a href="https://w3c.github.io/paint-timing/">paint-timing</a></li><li><a href="https://wicg.github.io/event-timing/">event-timing</a></li><li><a href="https://wicg.github.io/largest-contentful-paint/">LCP</a></li><li><a href="https://docs.google.com/document/d/1BR94tJdZLsin5poeet0XoTW60M0SjvOJQttKT-JK8HI/view">FMP</a></li><li><a href="https://github.com/WICG/time-to-interactive">time-to-interactive</a></li></ul><table><thead><tr><th>字段</th><th>描述</th><th>备注</th><th>计算方式</th></tr></thead><tbody><tr><td>FP</td><td>First Paint(首次绘制)</td><td>包括了任何用户自定义的背景绘制，它是首先将像素绘制到屏幕的时刻</td><td></td></tr><tr><td>FCP</td><td>First Content Paint(首次内容绘制)</td><td>是浏览器将第一个 DOM 渲染到屏幕的时间,可能是文本、图像、SVG等,这其实就是白屏时间</td><td></td></tr><tr><td>FMP</td><td>First Meaningful Paint(首次有意义绘制)</td><td>页面有意义的内容渲染的时间</td><td></td></tr><tr><td>LCP</td><td>(Largest Contentful Paint)(最大内容渲染)</td><td>代表在viewport中最大的页面元素加载的时间</td><td></td></tr><tr><td>DCL</td><td>(DomContentLoaded)(DOM加载完成)</td><td>当 HTML 文档被完全加载和解析完成之后, DOMContentLoaded 事件被触发，无需等待样式表、图像和子框架的完成加载</td><td></td></tr><tr><td>L</td><td>(onLoad)</td><td>当依赖的资源全部加载完毕之后才会触发</td><td></td></tr><tr><td>TTI</td><td>(Time to Interactive) 可交互时间</td><td>用于标记应用已进行视觉渲染并能可靠响应用户输入的时间点</td><td></td></tr><tr><td>FID</td><td>First Input Delay(首次输入延迟)</td><td>用户首次和页面交互(单击链接，点击按钮等)到页面响应交互的时间</td><td></td></tr></tbody></table><p><img src="./public/static/images/timings.png" alt="image.png"></p><p><img src="./public/static/images/FCP.png" alt="image.png"></p><h4 id="4-6-1-数据结构设计">4.6.1 数据结构设计</h4><h5 id="1-paint">1. paint</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端监控系统&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1590828364186&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chrome&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;experience&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;paint&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;firstPaint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;102&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;firstContentPaint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2130&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;firstMeaningfulPaint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2130&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;largestContentfulPaint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2130&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="2-firstInputDelay">2. firstInputDelay</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端监控系统&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1590828477284&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chrome&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;experience&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;firstInputDelay&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;inputDelay&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4812.344999983907&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HTML BODY #container .content H1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="4-6-2-实现">4.6.2 实现</h4><p>关键时间节点通过window.performance.timing获取</p><p><img src="./public/static/images/performance-timing.png" alt="image.png"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tracker <span class="keyword">from</span> <span class="string">&quot;../utils/tracker&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> onload <span class="keyword">from</span> <span class="string">&quot;../utils/onload&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> getLastEvent <span class="keyword">from</span> <span class="string">&quot;../utils/getLastEvent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> getSelector <span class="keyword">from</span> <span class="string">&quot;../utils/getSelector&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">timing</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable constant_">FMP</span>, <span class="variable constant_">LCP</span>;</span><br><span class="line">  <span class="comment">// 增加一个性能条目的观察者</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">entryList, observer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> perfEntries = entryList.<span class="title function_">getEntries</span>();</span><br><span class="line">    <span class="variable constant_">FMP</span> = perfEntries[<span class="number">0</span>];</span><br><span class="line">    observer.<span class="title function_">disconnect</span>(); <span class="comment">// 不再观察了</span></span><br><span class="line">  &#125;).<span class="title function_">observe</span>(&#123; <span class="attr">entryTypes</span>: [<span class="string">&quot;element&quot;</span>] &#125;); <span class="comment">// 观察页面中有意义的元素</span></span><br><span class="line">  <span class="comment">// 增加一个性能条目的观察者</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">entryList, observer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> perfEntries = entryList.<span class="title function_">getEntries</span>();</span><br><span class="line">    <span class="keyword">const</span> lastEntry = perfEntries[perfEntries.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">    <span class="variable constant_">LCP</span> = lastEntry;</span><br><span class="line">    observer.<span class="title function_">disconnect</span>(); <span class="comment">// 不再观察了</span></span><br><span class="line">  &#125;).<span class="title function_">observe</span>(&#123; <span class="attr">entryTypes</span>: [<span class="string">&quot;largest-contentful-paint&quot;</span>] &#125;); <span class="comment">// 观察页面中最大的元素</span></span><br><span class="line">  <span class="comment">// 增加一个性能条目的观察者</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">entryList, observer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> lastEvent = <span class="title function_">getLastEvent</span>();</span><br><span class="line">    <span class="keyword">const</span> firstInput = entryList.<span class="title function_">getEntries</span>()[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (firstInput) &#123;</span><br><span class="line">      <span class="comment">// 开始处理的时间 - 开始点击的时间，差值就是处理的延迟</span></span><br><span class="line">      <span class="keyword">let</span> inputDelay = firstInput.<span class="property">processingStart</span> - firstInput.<span class="property">startTime</span>;</span><br><span class="line">      <span class="keyword">let</span> duration = firstInput.<span class="property">duration</span>; <span class="comment">// 处理的耗时</span></span><br><span class="line">      <span class="keyword">if</span> (inputDelay &gt; <span class="number">0</span> || duration &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">          <span class="attr">kind</span>: <span class="string">&quot;experience&quot;</span>, <span class="comment">// 用户体验指标</span></span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;firstInputDelay&quot;</span>, <span class="comment">// 首次输入延迟</span></span><br><span class="line">          <span class="attr">inputDelay</span>: inputDelay ? <span class="title function_">formatTime</span>(inputDelay) : <span class="number">0</span>, <span class="comment">// 延迟的时间</span></span><br><span class="line">          <span class="attr">duration</span>: duration ? <span class="title function_">formatTime</span>(duration) : <span class="number">0</span>,</span><br><span class="line">          <span class="attr">startTime</span>: firstInput.<span class="property">startTime</span>, <span class="comment">// 开始处理的时间</span></span><br><span class="line">          <span class="attr">selector</span>: lastEvent</span><br><span class="line">            ? <span class="title function_">getSelector</span>(lastEvent.<span class="property">path</span> || lastEvent.<span class="property">target</span>)</span><br><span class="line">            : <span class="string">&quot;&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    observer.<span class="title function_">disconnect</span>(); <span class="comment">// 不再观察了</span></span><br><span class="line">  &#125;).<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;first-input&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;); <span class="comment">// 第一次交互</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 刚开始页面内容为空，等页面渲染完成，再去做判断</span></span><br><span class="line">  <span class="title function_">onload</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        fetchStart,</span><br><span class="line">        connectStart,</span><br><span class="line">        connectEnd,</span><br><span class="line">        requestStart,</span><br><span class="line">        responseStart,</span><br><span class="line">        responseEnd,</span><br><span class="line">        domLoading,</span><br><span class="line">        domInteractive,</span><br><span class="line">        domContentLoadedEventStart,</span><br><span class="line">        domContentLoadedEventEnd,</span><br><span class="line">        loadEventStart,</span><br><span class="line">      &#125; = <span class="variable language_">window</span>.<span class="property">performance</span>.<span class="property">timing</span>;</span><br><span class="line">      <span class="comment">// 发送时间指标</span></span><br><span class="line">      tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">kind</span>: <span class="string">&quot;experience&quot;</span>, <span class="comment">// 用户体验指标</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;timing&quot;</span>, <span class="comment">// 统计每个阶段的时间</span></span><br><span class="line">        <span class="attr">connectTime</span>: connectEnd - connectStart, <span class="comment">// TCP连接耗时</span></span><br><span class="line">        <span class="attr">ttfbTime</span>: responseStart - requestStart, <span class="comment">// 首字节到达时间</span></span><br><span class="line">        <span class="attr">responseTime</span>: responseEnd - responseStart, <span class="comment">// response响应耗时</span></span><br><span class="line">        <span class="attr">parseDOMTime</span>: loadEventStart - domLoading, <span class="comment">// DOM解析渲染的时间</span></span><br><span class="line">        <span class="attr">domContentLoadedTime</span>:</span><br><span class="line">          domContentLoadedEventEnd - domContentLoadedEventStart, <span class="comment">// DOMContentLoaded事件回调耗时</span></span><br><span class="line">        <span class="attr">timeToInteractive</span>: domInteractive - fetchStart, <span class="comment">// 首次可交互时间</span></span><br><span class="line">        <span class="attr">loadTime</span>: loadEventStart - fetchStart, <span class="comment">// 完整的加载时间</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 发送性能指标</span></span><br><span class="line">      <span class="keyword">let</span> <span class="variable constant_">FP</span> = performance.<span class="title function_">getEntriesByName</span>(<span class="string">&quot;first-paint&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">let</span> <span class="variable constant_">FCP</span> = performance.<span class="title function_">getEntriesByName</span>(<span class="string">&quot;first-contentful-paint&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FP&quot;</span>, <span class="variable constant_">FP</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FCP&quot;</span>, <span class="variable constant_">FCP</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FMP&quot;</span>, <span class="variable constant_">FMP</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;LCP&quot;</span>, <span class="variable constant_">LCP</span>);</span><br><span class="line">      tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">kind</span>: <span class="string">&quot;experience&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;paint&quot;</span>,</span><br><span class="line">        <span class="attr">firstPaint</span>: <span class="variable constant_">FP</span> ? <span class="title function_">formatTime</span>(<span class="variable constant_">FP</span>.<span class="property">startTime</span>) : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">firstContentPaint</span>: <span class="variable constant_">FCP</span> ? <span class="title function_">formatTime</span>(<span class="variable constant_">FCP</span>.<span class="property">startTime</span>) : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">firstMeaningfulPaint</span>: <span class="variable constant_">FMP</span> ? <span class="title function_">formatTime</span>(<span class="variable constant_">FMP</span>.<span class="property">startTime</span>) : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">largestContentfulPaint</span>: <span class="variable constant_">LCP</span></span><br><span class="line">          ? <span class="title function_">formatTime</span>(<span class="variable constant_">LCP</span>.<span class="property">renderTime</span> || <span class="variable constant_">LCP</span>.<span class="property">loadTime</span>)</span><br><span class="line">          : <span class="number">0</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id=""></h4><h3 id="4-7-卡顿">4.7 卡顿</h3><ul><li>响应用户交互的响应时间如果大于100ms,用户就会感觉卡顿</li></ul><h4 id="4-7-1-数据设计-longTask">4.7.1 数据设计 longTask</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端监控系统&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1590828656781&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chrome&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;experience&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;longTask&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mouseover&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;9331&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;200&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;selector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HTML BODY #container .content&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="4-7-2-实现">4.7.2 实现</h4><ul><li>new PerformanceObserver</li><li>entry.duration &gt; 100 判断大于100ms，即可认定为长任务</li><li>使用 requestIdleCallback上报数据</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tracker <span class="keyword">from</span> <span class="string">&quot;../util/tracker&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> formatTime <span class="keyword">from</span> <span class="string">&quot;../util/formatTime&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> getLastEvent <span class="keyword">from</span> <span class="string">&quot;../util/getLastEvent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> getSelector <span class="keyword">from</span> <span class="string">&quot;../util/getSelector&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">longTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">    list.<span class="title function_">getEntries</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">entry</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (entry.<span class="property">duration</span> &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> lastEvent = <span class="title function_">getLastEvent</span>();</span><br><span class="line">        <span class="title function_">requestIdleCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">            <span class="attr">kind</span>: <span class="string">&quot;experience&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;longTask&quot;</span>,</span><br><span class="line">            <span class="attr">eventType</span>: lastEvent.<span class="property">type</span>,</span><br><span class="line">            <span class="attr">startTime</span>: <span class="title function_">formatTime</span>(entry.<span class="property">startTime</span>), <span class="comment">// 开始时间</span></span><br><span class="line">            <span class="attr">duration</span>: <span class="title function_">formatTime</span>(entry.<span class="property">duration</span>), <span class="comment">// 持续时间</span></span><br><span class="line">            <span class="attr">selector</span>: lastEvent</span><br><span class="line">              ? <span class="title function_">getSelector</span>(lastEvent.<span class="property">path</span> || lastEvent.<span class="property">target</span>)</span><br><span class="line">              : <span class="string">&quot;&quot;</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).<span class="title function_">observe</span>(&#123; <span class="attr">entryTypes</span>: [<span class="string">&quot;longtask&quot;</span>] &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-8-PV、UV、用户停留时间">4.8 PV、UV、用户停留时间</h3><h4 id="4-8-1-数据设计-business">4.8.1 数据设计 business</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端监控系统&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1590829304423&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chrome&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;business&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pv&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;effectiveType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4g&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;rtt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;50&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;screen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2049x1152&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="4-8-2-PV、UV、用户停留时间">4.8.2 PV、UV、用户停留时间</h4><p>PV(page view) 是页面浏览量，UV(Unique visitor)用户访问量。PV 只要访问一次页面就算一次，UV 同一天内多次访问只算一次。</p><p>对于前端来说，只要每次进入页面上报一次 PV 就行，UV 的统计放在服务端来做，主要是分析上报的数据来统计得出 UV。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tracker <span class="keyword">from</span> <span class="string">&quot;../util/tracker&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">pv</span>(<span class="params"></span>) &#123;</span><br><span class="line">  tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">kind</span>: <span class="string">&quot;business&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;pv&quot;</span>,</span><br><span class="line">    <span class="attr">startTime</span>: performance.<span class="title function_">now</span>(),</span><br><span class="line">    <span class="attr">pageURL</span>: <span class="title function_">getPageURL</span>(),</span><br><span class="line">    <span class="attr">referrer</span>: <span class="variable language_">document</span>.<span class="property">referrer</span>,</span><br><span class="line">    <span class="attr">uuid</span>: <span class="title function_">getUUID</span>(),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">  <span class="comment">// beforeunload 事件在即将离开当前页面（刷新或关闭）时触发。  </span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">    <span class="string">&quot;beforeunload&quot;</span>,</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> stayTime = <span class="title class_">Date</span>.<span class="title function_">now</span>() - startTime;</span><br><span class="line">      tracker.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">kind</span>: <span class="string">&quot;business&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;stayTime&quot;</span>,</span><br><span class="line">        stayTime,</span><br><span class="line">        <span class="attr">pageURL</span>: <span class="title function_">getPageURL</span>(),</span><br><span class="line">        <span class="attr">uuid</span>: <span class="title function_">getUUID</span>(),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">false</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span>: unload 事件中 执行 beforeunload 点击确认后的处理代码 </span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;unload&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onunload！！！！！&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;/test&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">    xhr.<span class="title function_">send</span>()</span><br><span class="line">    <span class="comment">// 加一段同步代码阻塞一下，不然刷新会发不出去异步请求</span></span><br><span class="line">    <span class="keyword">let</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">new</span> <span class="title class_">Date</span>() - now &lt; <span class="number">100</span>) &#123; &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line"><span class="comment">// 定义一个获取用户的函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">countTime</span> = (<span class="params">to: any, <span class="keyword">from</span>: any</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 获取当前时间</span></span><br><span class="line">  <span class="keyword">const</span> currentTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    <span class="string">&#x27;用户由&#x27;</span>,</span><br><span class="line">    <span class="keyword">from</span>.<span class="property">path</span>,</span><br><span class="line">    <span class="string">&#x27;页面 跳转到&#x27;</span>,</span><br><span class="line">    to.<span class="property">path</span>,</span><br><span class="line">    <span class="string">&#x27; 页面停留了&#x27;</span>,</span><br><span class="line">    currentTime - startTime,</span><br><span class="line">    <span class="string">&#x27;毫秒。转换为秒数约为:&#x27;</span>,</span><br><span class="line">    (currentTime - startTime) / <span class="number">1000</span></span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// 初始化开始时间</span></span><br><span class="line">  startTime = <span class="title class_">Data</span>.<span class="title function_">now</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-9-按钮事件上报">4.9 按钮事件上报</h3><h4 id="4-9-1-数据设计-reportData">4.9.1 数据设计 reportData</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;首页&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;currentUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;actionType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;用户操作&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;behavior&quot;</span><span class="punctuation">:</span> <span class="string">&quot;点击了按钮&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;frontTriggerType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;click&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="4-9-2-实现">4.9.2 实现</h4><ul><li>Vue 应用 按钮绑定自定义指令</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;track&#x27;</span>, &#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">钩子函数，只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置</span></span><br><span class="line"><span class="comment">el：指令所绑定的元素，可以用来直接操作 DOM</span></span><br><span class="line"><span class="comment">binding：一个对象，包含以下 property</span></span><br><span class="line"><span class="comment">  name：指令名，不包括 v— 前缀</span></span><br><span class="line"><span class="comment">  value：指令的绑定值，例如：v-my-directive＝＂1＋1＂ 中，绑定值为2</span></span><br><span class="line"><span class="comment">  expression：字符串形式的指令表达式。例如 v-my-directive＝＂1＋1＂ 中，表达式为 ＂1 + 1＂。 arg：传给指令的参数，可选。例如 v-my-directive：foo 中，参数为＂foo＂</span></span><br><span class="line"><span class="comment">  modifiers：一个包含修饰符的对象。例如：v-my-directive.foo.bar 中，修饰符对象为｛ foo: true &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mounted</span>: <span class="function">(<span class="params">el: any, binding: any</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (binding.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="comment">// 这里参数是根据自己业务可以自己定义</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      title, </span><br><span class="line">      currentUrl,</span><br><span class="line">      actionType,</span><br><span class="line">      triggerType,</span><br><span class="line">      behavior</span><br><span class="line">    &#125; = binding.<span class="property">value</span> || &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;</span><br><span class="line">      title,</span><br><span class="line">      behavior,</span><br><span class="line">      currentUrl, </span><br><span class="line">      actionType, </span><br><span class="line">      frontTriggerType,</span><br><span class="line">      <span class="comment">// preUrl,</span></span><br><span class="line">      <span class="comment">// businessCode, </span></span><br><span class="line">      <span class="comment">// service: &quot;xxx&quot;, </span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 浏览类型，直接保存</span></span><br><span class="line">    <span class="keyword">if</span> (triggerType == <span class="string">&#x27;browse&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;browse&#x27;</span>, params);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (triggerType == <span class="string">&#x27;click&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果是click类型，监听click事件</span></span><br><span class="line">      el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;click&#x27;</span>, params);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 调用后台接口保存数据</span></span><br><span class="line">    <span class="comment">// api.eventTrack.saveEventTrack(params);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;button key=<span class="string">&#x27;/info/table&#x27;</span></span><br><span class="line">  @click=<span class="string">&quot;handleClick&quot;</span></span><br><span class="line">  v-track=<span class="string">&quot;&#123;</span></span><br><span class="line"><span class="string">    triggerType: &#x27;click&#x27;,</span></span><br><span class="line"><span class="string">    actionType: &#x27;用户操作&#x27;,</span></span><br><span class="line"><span class="string">    title: &#x27;首页&#x27;,</span></span><br><span class="line"><span class="string">    currentUrl: $route.path,</span></span><br><span class="line"><span class="string">    behavior: &#x27;提交数据&#x27;</span></span><br><span class="line"><span class="string">  &#125;&quot;</span></span><br><span class="line">&gt;提交&lt;/button&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>React 应用使用 Hoc 重写 Button</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建高阶组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">withOutputOnClick</span> = (<span class="params">Component</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 定义响应点击事件的方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;    </span><br><span class="line">      <span class="comment">// 数据上报...</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;props.reportData&#125;</span>`</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用高阶组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">EnhancedButton</span> = <span class="title function_">withOutputOnClick</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> /&gt;</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">EnhancedButton</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr/><h3 id="a-id-qa-扩展问题-a"><a id="qa">扩展问题</a></h3><ol><li>性能监控指标</li><li>前端怎么做性能监控</li><li>线上错误监控怎么做</li><li>导致内存泄漏的方法，怎么监控内存泄漏</li><li>Node 怎么做性能监控</li></ol><h4 id="1-性能监控指标">1. 性能监控指标</h4><table><thead><tr><th>指标</th><th>名称</th><th>解释</th></tr></thead><tbody><tr><td>FP</td><td>First-Paint 首次渲染</td><td>表示浏览器从开始请求网站到屏幕渲染第一个像素点的时间</td></tr><tr><td>FCP</td><td>First-Contentful-Paint 首次内容渲染</td><td>表示浏览器渲染出第一个内容的时间，这个内容可以是文本、图片或SVG元素等等，不包括iframe和白色背景的canvas元素</td></tr><tr><td>SI</td><td>Speed Index 速度指数</td><td>表明了网页内容的可见填充速度</td></tr><tr><td>LCP</td><td>Largest Contentful Paint 最大内容绘制</td><td>标记了渲染出最大文本或图片的时间</td></tr><tr><td>TTI</td><td>Time to Interactive 可交互时间</td><td>页面从开始加载到主要子资源完成渲染，并能够快速、可靠的响应用户输入所需的时间</td></tr><tr><td>TBT</td><td>Total Blocking Time 总阻塞时间</td><td>测量 FCP 与 TTI 之间的总时间，这期间，主线程被阻塞的时间过长，无法作出输入响应</td></tr><tr><td>FID</td><td>First Input Delay 首次输入延迟</td><td>测量加载响应度的一个以用户为中心的重要指标</td></tr><tr><td>CLS</td><td>Cumulative Layout Shift 累积布局偏移</td><td>测量的是整个页面生命周期内发生的所有意外布局偏移中最大一连串的布局偏移分数</td></tr><tr><td>DCL</td><td>DOMContentLoaded</td><td>当初始的 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，而无需等待样式表、图像和子框架的完成加载</td></tr><tr><td>L</td><td>Load</td><td>检测一个完全加载的页面，页面的html、css、js、图片等资源都已经加载完之后才会触发 load 事件</td></tr></tbody></table><h4 id="2-前端怎么做性能监控">2. 前端怎么做性能监控</h4><ul><li>FP、FCP、LCP、CLS、FID、FMP 可通过 PerformanceObserver获取</li><li>TCP连接耗时、首字节到达时间、response响应耗时、DOM解析渲染的时间、TTI、DCL、L等可通过performance.timing获取</li><li>长任务监听，PerformanceObserver 监听 longTask</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    fetchStart,</span><br><span class="line">    connectStart,</span><br><span class="line">    connectEnd,</span><br><span class="line">    requestStart,</span><br><span class="line">    responseStart,</span><br><span class="line">    responseEnd,</span><br><span class="line">    domLoading,</span><br><span class="line">    domInteractive,</span><br><span class="line">    domContentLoadedEventStart,</span><br><span class="line">    domContentLoadedEventEnd,</span><br><span class="line">    loadEventStart,</span><br><span class="line">&#125; = <span class="variable language_">window</span>.<span class="property">performance</span>.<span class="property">timing</span>;</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">kind</span>: <span class="string">&quot;experience&quot;</span>, <span class="comment">// 用户体验指标</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;timing&quot;</span>, <span class="comment">// 统计每个阶段的时间</span></span><br><span class="line">    <span class="attr">dnsTime</span>: domainLookupEnd - domainLookupStart, <span class="comment">// DNS查询时间</span></span><br><span class="line">    <span class="attr">connectTime</span>: connectEnd - connectStart, <span class="comment">// TCP连接耗时</span></span><br><span class="line">    <span class="attr">ttfbTime</span>: responseStart - requestStart, <span class="comment">// 首字节到达时间</span></span><br><span class="line">    <span class="attr">responseTime</span>: responseEnd - responseStart, <span class="comment">// response响应耗时</span></span><br><span class="line">    <span class="attr">parseDOMTime</span>: loadEventStart - domLoading, <span class="comment">// DOM解析渲染的时间</span></span><br><span class="line">    <span class="attr">domContentLoadedTime</span>:</span><br><span class="line">      domContentLoadedEventEnd - domContentLoadedEventStart, <span class="comment">// DOMContentLoaded事件回调耗时</span></span><br><span class="line">    <span class="attr">timeToInteractive</span>: domInteractive - fetchStart, <span class="comment">// 首次可交互时间</span></span><br><span class="line">    <span class="attr">loadTime</span>: loadEventStart - fetchStart, <span class="comment">// 完整的加载时间</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="./public/static/images/resource-load.png" alt="image.png"></p><h4 id="3-线上错误监控怎么做">3. 线上错误监控怎么做</h4><ul><li>资源加载错误 window.addEventListener(‘error’) 判断e.target.src || href</li><li>js运行时错误 window.addEventListener(‘error’)</li><li>promise异常 window.addEventListener(‘unhandledrejection’)</li><li>接口异常 重写xhr 的 open send方法，监控 load、error、abort，进行上报</li></ul><h4 id="4-导致内存泄漏的方法，怎么监控内存泄漏">4. 导致内存泄漏的方法，怎么监控内存泄漏</h4><ul><li>全局变量</li><li>被遗忘的定时器</li><li>脱离Dom的引用</li><li>闭包</li></ul><p>监控内存泄漏</p><ul><li>window.performance.memory</li><li>开发阶段<ul><li>浏览器的 Performance</li><li>移动端可使用 PerformanceDog</li></ul></li></ul><p><img src="./public/static/images/memory.png" alt="image.png"></p><h4 id="5-Node-怎么做性能监控">5. Node 怎么做性能监控</h4><ol><li><strong>日志监控</strong> 可以通过监控异常日志的变动，将新增的异常类型和数量反映出来 监控日志可以实现pv和uv的监控，通过pv/uv的监控，可以知道使用者们的使用习惯，预知访问高峰</li><li><strong>响应时间</strong> 响应时间也是一个需要监控的点。一旦系统的某个子系统出现异常或者性能瓶颈将会导致系统的响应时间变长。响应时间可以在nginx一类的反向代理上监控，也可以通过应用自己产生访问日志来监控</li><li><strong>进程监控</strong> 监控日志和响应时间都能较好地监控到系统的状态，但是它们的前提是系统是运行状态的，所以监控进程是比前两者更为紧要的任务。监控进程一般是检查操作系统中运行的应用进程数，比如对于采用多进程架构的web应用，就需要检查工作进程的数，如果低于低估值，就应当发出警报</li><li><strong>磁盘监控</strong> 磁盘监控主要是监控磁盘的用量。由于写日志频繁的缘故，磁盘空间渐渐被用光。一旦磁盘不够用将会引发系统的各种问题，给磁盘的使用量设置一个上限，一旦磁盘用量超过警戒值，服务器的管理者应该整理日志或者清理磁盘</li><li><strong>内存监控</strong> 对于node而言，一旦出现内存泄漏，不是那么容易排查的。监控服务器的内存使用情况。如果内存只升不降，那么铁定存在内存泄漏问题。符合正常的内存使用应该是有升有降，在访问量大的时候上升，在访问量回落的时候，占用量也随之回落。监控内存异常时间也是防止系统出现异常的好方法。如果突然出现内存异常，也能够追踪到近期的哪些代码改动导致的问题</li><li><strong>cpu占用监控</strong> 服务器的cpu占用监控也是必不可少的项，cpu的使用分为用户态、内核态、IOWait等。如果用户态cpu使用率较高，说明服务器上的应用需要大量的cpu开销；如果内核态cpu使用率较高，说明服务器需要花费大量时间进行进程调度或者系统调用；IOWait使用率反映的是cpu等待磁盘I/O操作；cpu的使用率中，用户态小于70%，内核态小于35%且整体小于70%，处于正常范围。监控cpu占用情况，可以帮助分析应用程序在实际业务中的状况。合理设置监控阈值能够很好地预警</li><li><strong>cpu load监控</strong> cpu load又称cpu平均负载。它用来描述操作系统当前的繁忙程度，又简单地理解为cpu在单位时间内正在使用和等待使用cpu的平均任务数。它有3个指标，即1分钟的平均负载、5分钟的平均负载，15分钟的平均负载。cpu load过高说明进程数量过多，这在node中可能体现在用于进程模块反复启动新的进程。监控该值可以防止意外发生</li><li><strong>I/O负载</strong> I/O负载指的主要是磁盘I/O。反应的是磁盘上的读写情况，对于node编写的应用，主要是面向网络业务，是不太可能出现I/O负载过高的情况，大多数的I/O压力来自于数据库。不管node进程是否与数据库或其他I/O密集的应用共同处理相同的服务器，我们都应该监控该值防止意外情况</li><li><strong>网络监控</strong> 虽然网络流量监控的优先级没有上述项目那么高，但还是需要对流量进行监控并设置流量上限值。即便应用突然受到用户的青睐，流量暴涨的时候也可以通过数值感知到网站的宣传是否有效。一旦流量超过警戒值，开发者就应当找出流量增长的原因。对于正常增长，应当评估是否该增加硬件设备来为更多用户提供服务。网络流量监控的两个主要指标是流入流量和流出流量<ul><li>应用状态监控 除了这些硬性需要检测的指标之外，应用还应该提供一种机制来反馈其自身的状态信息，外部监控将会持续性地调用应用地反馈接口来检查它地健康状态。</li><li>dns监控 dns是网络应用的基础，在实际的对外服务产品中，多数都对域名有依赖。dns故障导致产品出现大面积影响的事件并不少见。由于dns服务通常是稳定的，容易让人忽略，但是一旦出现故障，就可能是史无前例的故障。对于产品的稳定性，域名dns状态也需要加入监控。</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 埋点与监控 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>常用脚本</title>
      <link href="/posts/91242506.html"/>
      <url>/posts/91242506.html</url>
      
        <content type="html"><![CDATA[<h3 id="常用脚本">常用脚本</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 gitlab</span></span><br><span class="line">sudo docker run -itd \</span><br><span class="line">  --hostname gitlab.<span class="number">9</span>sdata.com \</span><br><span class="line">  --publish <span class="number">443</span>:<span class="number">443</span> --publish <span class="number">80</span>:<span class="number">80</span> --publish <span class="number">222</span>:<span class="number">22</span> \</span><br><span class="line">  --name gitlab \</span><br><span class="line">  --restart always \</span><br><span class="line">  --volume <span class="regexp">/home/</span>hadoop<span class="regexp">/docker_space/gi</span>tlab<span class="regexp">/config:/</span>etc/gitlab \</span><br><span class="line">  --volume <span class="regexp">/home/</span>hadoop<span class="regexp">/docker_space/gi</span>tlab<span class="regexp">/logs:/</span>var<span class="regexp">/log/gi</span>tlab \</span><br><span class="line">  --volume <span class="regexp">/home/</span>hadoop<span class="regexp">/docker_space/gi</span>tlab<span class="regexp">/data:/</span>var<span class="regexp">/opt/gi</span>tlab \</span><br><span class="line">  gitlab/gitlab-ce:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 mysql</span></span><br><span class="line">docker run -itd \</span><br><span class="line">-p <span class="number">3306</span>:<span class="number">3306</span> \</span><br><span class="line">--name mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="number">123456</span> \</span><br><span class="line">-v <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data:<span class="regexp">/var/</span>lib/mysql \</span><br><span class="line">-v <span class="regexp">/usr/</span>local<span class="regexp">/mysql/my</span>.cnf:<span class="regexp">/etc/my</span>sql/my.cnf \</span><br><span class="line">-v <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>conf.d:<span class="regexp">/etc/my</span>sql/conf.d \</span><br><span class="line">-v <span class="regexp">/usr/</span>local<span class="regexp">/mysql/my</span>sql.conf.d:<span class="regexp">/etc/my</span>sql/mysql.conf.d \</span><br><span class="line">mysql:<span class="number">5.6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -p <span class="number">3306</span>:<span class="number">3306</span> --name JH_mysql -e MYSQL_ROOT_PASSWORD=root -d mysql(默认)</span><br><span class="line">show variables like <span class="string">&#x27;char%&#x27;</span>;</span><br><span class="line">SET character_set_client=<span class="string">&#x27;utf8&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">create database koa2mysql CHARACTER SET utf8 COLLATE utf8_general_ci;</span><br><span class="line">...</span><br><span class="line">开启数据库远程连接：</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> WITH GRANT OPTION;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">docker配置mysql参考链接：</span><br><span class="line">https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/sinat_30397435/</span>article<span class="regexp">/details/</span><span class="number">79534785</span></span><br><span class="line">https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/jiangyu1013/</span>article<span class="regexp">/details/</span><span class="number">79958410</span></span><br><span class="line">  https:<span class="regexp">//</span>jingyan.baidu.com<span class="regexp">/article/</span><span class="number">046</span>a7b3e9cecfaf9c37fa96b.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 nginx</span></span><br><span class="line">sudo docker run --name nginx -itd \</span><br><span class="line">--publish <span class="number">8088</span>:<span class="number">80</span> \</span><br><span class="line">--publish <span class="number">18099</span>:<span class="number">18099</span> \</span><br><span class="line">--publish <span class="number">8099</span>:<span class="number">8099</span> \</span><br><span class="line">--publish <span class="number">18100</span>:<span class="number">18100</span> \</span><br><span class="line">--restart always \</span><br><span class="line">-v <span class="regexp">/home/</span>hadoop<span class="regexp">/docker_space/</span>nginx<span class="regexp">/html:/u</span>sr<span class="regexp">/share/</span>nginx/html \</span><br><span class="line">-v <span class="regexp">/home/</span>hadoop<span class="regexp">/docker_space/</span>nginx<span class="regexp">/logs:/</span>var<span class="regexp">/log/</span>nginx \</span><br><span class="line">-v <span class="regexp">/home/</span>hadoop<span class="regexp">/docker_space/</span>nginx<span class="regexp">/conf.d:/</span>etc<span class="regexp">/nginx/</span>conf.d \</span><br><span class="line">-v <span class="regexp">/home/</span>hadoop<span class="regexp">/docker_space/</span>nginx<span class="regexp">/nginx.conf:/</span>etc<span class="regexp">/nginx/</span>nginx.conf:ro \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 portainer</span></span><br><span class="line">sudo docker run -itd -p <span class="number">9000</span>:<span class="number">9000</span> \</span><br><span class="line">--name portainer \</span><br><span class="line">--restart always \</span><br><span class="line">-v <span class="regexp">/var/</span>run<span class="regexp">/docker.sock:/</span>var<span class="regexp">/run/</span>docker.sock \</span><br><span class="line">-v <span class="regexp">/home/</span>hadoop<span class="regexp">/docker_space/</span>portainer<span class="regexp">/data:/</span>data portainer/portainer</span><br></pre></td></tr></table></figure><p>docker run --name nginx-arm -itd <br>-v ${PWD}/nginx/conf.d:/etc/nginx/conf.d <br>-v ${PWD}/nginx/nginx.conf:/etc/nginx/nginx.conf <br>nginx</p><p>docker commit -m “nginx” -a “Jahaw” 66dbda6b2ea5 “nginx-arm”</p>]]></content>
      
      
      <categories>
          
          <category> 容器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>临时问题</title>
      <link href="/posts/46d08420.html"/>
      <url>/posts/46d08420.html</url>
      
        <content type="html"><![CDATA[<p>介质文件<br>import sourceMap from ‘source-map’;</p><p>sourceMap.SourceMapConsumer.initialize({<br>‘lib/mappings.wasm’: ‘<a href="https://unpkg.com/source-map@0.7.3/lib/mappings.wasm">https://unpkg.com/source-map@0.7.3/lib/mappings.wasm</a>’<br>});</p><p>中小型公司可通过搭建 Prometheus 和 Grafana、DataBase 就可以了</p><p>业内自建前端监控 一般采用 image 上报、而不是 http 上报</p><ul><li>因为图片速度快，无跨域问题</li></ul><p>navigator.sendBeacon() 方法用于通过http</p><p>// at开头、\s+: 任意长度空格、(.+): 任意字符、<br>/at\s+(.+):(\d+):(\d+)/</p><p>error 发生后 如何获取到用户最后一次交互事件？</p><p>参考产品</p><ul><li><p>商业产品</p><ul><li>神策数据</li><li>GrowingIO</li></ul></li><li><p>开源产品</p><ul><li>fundebug</li><li>BetterJS</li><li>Sentry</li><li>@sentry/browser</li></ul></li></ul><p>defer 和 async</p><p><a href="https://juejin.cn/post/7176206226903007292">https://juejin.cn/post/7176206226903007292</a></p><p><a href="https://github.com/xy-sea/web-see">web-see</a> 前端监控方案，提供了 采样对比+白屏修正机制 的检测方案，兼容有骨架屏、无骨架屏这两种情况，来解决开发者的白屏之忧</p><p>判断页面白屏</p><ul><li>performanceObserve</li></ul><p>渲染 Rendering<br>绘制 Paint</p><p>浏览器渲染引擎 通过 双缓冲 在绘制和渲染间进行切换<br>16.6 ms绘制一帧</p><p>Vue 项目集成 Sentry</p><ul><li><p>git clone <a href="https://github.com/getsentry/onpremise.git">https://github.com/getsentry/onpremise.git</a></p></li><li><p>./install.sh</p><ul><li>创建账户</li><li>docker-compose up -d // 启动容器集群<ul><li>localhost:9000/auth/login/sentry<ul><li>admin</li><li>123123123</li></ul></li><li>修改 organize 名称</li><li>创建监控项目<ul><li>浏览器端 React 项目</li><li>hello-world</li></ul></li></ul></li></ul></li><li><p>创建React项目</p><ul><li>yarn add @sentry/browser      // 浏览器端SDK、用于数据上报</li><li>yarn add @sentry/integrations // 添加 React 集成， 上报发生错误的组件名称、状态</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Sentry</span> <span class="keyword">from</span> <span class="string">&#x27;@sentry/browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">React</span> <span class="keyword">as</span> <span class="title class_">ReactIntetration</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@sentry/integrations&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Sentry</span>.<span class="title function_">init</span>(&#123;</span><br><span class="line">  <span class="attr">dsn</span>: <span class="string">&#x27;http://xxxx@localhost:9000/3&#x27;</span>,</span><br><span class="line">  <span class="attr">integrations</span>: [<span class="keyword">new</span> <span class="title class_">ReactIntetration</span>(&#123; <span class="title class_">React</span>, <span class="attr">attachProps</span>: <span class="literal">true</span> &#125;)],</span><br><span class="line">  <span class="attr">logErrors</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">release</span>: <span class="string">&#x27;pro@1.0.0&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>React 生产环境配置</p><ul><li>定义<code>.sentryclientrc</code> 文件</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[defaults]</span></span><br><span class="line"><span class="attr">url</span>=http://localhost:<span class="number">9000</span> <span class="comment"># 上报地址</span></span><br><span class="line"><span class="attr">org</span>=Jahw                  <span class="comment"># 组织名</span></span><br><span class="line"><span class="attr">project</span>=hello-world       <span class="comment"># 项目名</span></span><br><span class="line"></span><br><span class="line"><span class="section">[auth]</span></span><br><span class="line"><span class="attr">token</span>=<span class="number">123123</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="2-3-CSS-埋点">2.3 CSS 埋点</h4><p>CSS 埋点只能处理一些简单的事件埋点，得益于无法被禁用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.link</span><span class="selector-pseudo">:active</span><span class="selector-pseudo">::after</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">content</span>: <span class="built_in">url</span>(<span class="string">&quot;http://192.168.1.110:3000/someapi?params=someInfo&quot;</span>);</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;link btn&quot;</span>&gt;</span>点击访问<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 埋点与监控 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>常用问题</title>
      <link href="/posts/695cdcf2.html"/>
      <url>/posts/695cdcf2.html</url>
      
        <content type="html"><![CDATA[<ul><li><p>docker x86 平台拉取 arm 版镜像</p><ul><li>方案一<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">修改docker配置</span><br><span class="line">vi  <span class="regexp">/root/</span>.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">&quot;auth&quot;</span> : &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;experimental&quot;</span>: <span class="string">&quot;enabled&quot;</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">开启实验特性</span><br><span class="line">vi <span class="regexp">/etc/</span>docker/daemon.json</span><br><span class="line">&#123;  </span><br><span class="line">  <span class="string">&quot;experimental&quot;</span>: true</span><br><span class="line">&#125;</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker pull --platform=arm64 nginx <span class="comment"># 手动指定平台镜像</span></span><br></pre></td></tr></table></figure></li><li>传统办法</li></ul><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:stable<span class="title">@sha256</span>:<span class="number">4257441</span>ff<span class="number">3288</span>a<span class="number">6e25</span>b<span class="number">4</span>ae<span class="number">3e5</span>be<span class="number">176</span>d<span class="number">1</span>fc<span class="number">05</span>abc<span class="number">13</span><span class="keyword">c</span><span class="number">6230</span>a<span class="number">44</span>d<span class="number">2</span>b<span class="number">698364</span>af<span class="number">8523</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>make</p></li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx-arm -itd \</span><br><span class="line">-v <span class="variable">$&#123;PWD&#125;</span><span class="regexp">/nginx/</span>conf.d:<span class="regexp">/etc/</span>nginx/conf.d \</span><br><span class="line">-v <span class="variable">$&#123;PWD&#125;</span><span class="regexp">/nginx/</span>nginx.conf:<span class="regexp">/etc/</span>nginx/nginx.conf \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line">docker commit -m <span class="string">&quot;nginx&quot;</span> -a <span class="string">&quot;Jahaw&quot;</span> <span class="number">66</span>dbda6b2ea5 <span class="string">&quot;nginx-arm&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 容器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>微前端</title>
      <link href="/posts/3b97e6.html"/>
      <url>/posts/3b97e6.html</url>
      
        <content type="html"><![CDATA[<p><strong>前端面临问题</strong></p><ul><li>项目功能不断增多、体积不断增大（<code>巨石应用</code>），导致打包时间成正比例增长，是否能保证更好的 <code>项目扩展</code></li><li>前端技术更新太快，一个项目历经一两年也许就需要进行项目升级，甚至是切换技术栈，但仍需要老项目的代码，是否能进行 <code>新老版本的兼容</code></li><li>团队技术栈不一，又需要保证同一项目的开发，是否能保证不同团队的 <code>独立开发</code></li><li>SPA 项目的任何变动都需执行完整的打包、部署，是否能保证不同内容 <code>独立部署</code></li></ul><p><strong>核心功能</strong></p><ul><li>技术栈无关<ul><li>主框架不限制接入子应用的技术栈，微应用具备完全自主权</li></ul></li><li>独立开发、独立部署<ul><li>微应用仓库独立，前后端可独立开发，部署完成后主框架自动完成同步更新</li></ul></li><li>增量升级<ul><li>在面对各种复杂场景时，通常很难对一个已经存在的系统做全量的技术栈升级或重构，而微前端是一种非常好的实施渐进式重构的手段和策略</li></ul></li><li>独立运行时<ul><li>每个微应用之间状态隔离，运行时状态不共享</li></ul></li></ul><h1>Micro-FrontEnd</h1><ul><li><p>由来</p><ul><li>传统的SPA已经没办法很好的应对快速业务发展给技术底层的考验</li><li>单个子应用技术栈不一致、迭代空间匮乏</li></ul></li><li><p>定义</p><ul><li>微前端是一种类似于微内核的架构，它将微服务的理念应用于浏览器端，即将 Web 应用由单体应用转变为多个小型前端应用聚合为一的应用。多个前端应用还可以独立运行、独立开发、独立部署</li><li>将不同功能按照不同纬度拆分成多个子应用，通过主应用加载这些子应用</li></ul></li></ul><h2 id="框架">框架</h2><p>-iframe</p><ul><li><p>iframe 中子应用切换路由时用户刷新页面状态丢失</p></li><li><p>应用通信</p><ul><li>基于URL来进行数据传递，但是传递消息能力弱</li><li>基于CustomEvent 实现通信<ul><li>postMessage</li></ul></li><li>基于props 主子应用间通信</li><li>使用 全局变量、redux 进行通信</li></ul></li><li><p>公共依赖</p><ul><li>CDN、externals</li><li>webpack 联邦模块</li></ul></li><li><p>css 隔离方案</p><ul><li>子应用之间样式隔离<ul><li><h2 id="Dynamic-Stylesheet-动态样式表，当应用切换时移除老应用样式，添加新应用样式">Dynamic Stylesheet 动态样式表，当应用切换时移除老应用样式，添加新应用样式</h2></li></ul></li><li>主应用和子应用之间的样式隔离<ul><li>BEM（Block Element Modifier）约定项目前缀</li><li>CSS-Modules打包时生成不冲突的选择器名</li><li>Shadow DOM 真正意义上的隔离<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&#x27;shadow&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shadowDOM = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;shadow&#x27;</span>).<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;closed&#x27;</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> pElm = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">pElm.<span class="property">innerHTML</span> = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> styleElm = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;style&#x27;</span>);</span><br><span class="line">styleElm.<span class="property">textContent</span> = <span class="string">`</span></span><br><span class="line"><span class="string">  p &#123; color: red &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">shadowDOM.<span class="title function_">appendChild</span>(styleElm);</span><br><span class="line">shadowDOM.<span class="title function_">appendChild</span>(pElm);</span><br></pre></td></tr></table></figure></li><li>css-in-js</li></ul></li></ul></li></ul><h2 id="是否采用微前端">是否采用微前端</h2><ul><li>微前端最佳的使用场景是一些B端的管理系统，既能兼容集成历史系统，也可以将新的系统集成进来，并且不影响原先的交互体验。</li><li>整体的微前端不仅仅是只将系统集成进来，而是整个微前端体系的完善，这其中就包括：<ul><li>基座应用和微应用的自动部署能力。</li><li>微应用的配置管理能力。</li><li>本地开发调试能力。</li><li>线上监控和统计能力等等。</li></ul></li><li>只有将整个能力体系搭建完善，才能说是整个微前端体系流程的完善</li></ul><h3 id="Demo">Demo</h3><p><a href="https://cnodejs.org/topic/6088304f4d20cb737768f1bd">https://cnodejs.org/topic/6088304f4d20cb737768f1bd</a><br><a href="https://gitee.com/lizhijie429/qiankun-vue2.0">https://gitee.com/lizhijie429/qiankun-vue2.0</a></p>]]></content>
      
      
      <categories>
          
          <category> 微前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>沙箱 sandbox</title>
      <link href="/posts/749e8393.html"/>
      <url>/posts/749e8393.html</url>
      
        <content type="html"><![CDATA[<h3 id="沙箱">沙箱</h3><ul><li><p>快照沙箱</p><ul><li>1年前拍一张 再拍一张（将区别保存起来）再回到一年前</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SnapshotSandbox</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">proxy</span> = <span class="variable language_">window</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">modifyPropsMap</span> = &#123;&#125;; <span class="comment">// 记录在window 上的修改</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">active</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">active</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">windowSnapshot</span> = &#123;&#125;; <span class="comment">// 拍照</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> prop <span class="keyword">in</span> <span class="variable language_">window</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">hasOwnProperty</span>[prop])&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">windowSnapshot</span>[prop] = <span class="variable language_">window</span>[prop];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 或者 this.windowSnapshot = &#123; ...window &#125;;</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">modifyPropsMap</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>[p] = <span class="variable language_">this</span>.<span class="property">modifyPropsMap</span>[p];</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">inactive</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> prop <span class="keyword">in</span> <span class="variable language_">window</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">hasOwnProperty</span>[prop])&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">window</span>[prop] !== <span class="variable language_">this</span>.<span class="property">windowSnapshot</span>[prop])&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">modifyPropsMap</span>[prop] = <span class="variable language_">window</span>[prop];</span><br><span class="line">          <span class="variable language_">window</span>[prop] = <span class="variable language_">this</span>.<span class="property">modifyPropsMap</span>[prop];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sandbox = <span class="keyword">new</span> <span class="title class_">SnapshotSandbox</span>();</span><br><span class="line"></span><br><span class="line">(<span class="function">(<span class="params"><span class="variable language_">window</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">b</span> = <span class="number">2</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">a</span>, <span class="variable language_">window</span>.<span class="property">b</span>)</span><br><span class="line"></span><br><span class="line">  sandbox.<span class="title function_">inactive</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">a</span>, <span class="variable language_">window</span>.<span class="property">b</span>)</span><br><span class="line"></span><br><span class="line">  sandbox.<span class="title function_">active</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">a</span>, <span class="variable language_">window</span>.<span class="property">b</span>)</span><br><span class="line">&#125;)(sandbox.<span class="property">proxy</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意：如果是多个子应用就不能使用这种方式了, 可以采用 es6的proxy</span></span><br></pre></td></tr></table></figure></li><li><p>代理沙箱</p><ul><li>可以实现多应用沙箱，把不同的应用用不同的代理来处理</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO-1</span></span><br><span class="line"><span class="comment">// 创建子应用 window 的副本</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createFakeWindow</span>(<span class="params"><span class="variable language_">global</span>: Window</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里qiankun给我们了一个知识点：在has和check的场景下，map有着更好的性能 :)</span></span><br><span class="line">  <span class="keyword">const</span> propertiesWithGetter = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="title class_">PropertyKey</span>, boolean&gt;();</span><br><span class="line">  <span class="keyword">const</span> fakeWindow = &#123;&#125; <span class="keyword">as</span> <span class="title class_">FakeWindow</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从window对象拷贝不可配置的属性</span></span><br><span class="line">  <span class="comment">// 举个例子：window、document、location这些都是挂在Window上的属性，他们都是不可配置的</span></span><br><span class="line">  <span class="comment">// 拷贝出来到fakeWindow上，就间接避免了子应用直接操作全局对象上的这些属性方法</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(<span class="variable language_">global</span>)</span><br><span class="line">    .<span class="title function_">filter</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> descriptor = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(<span class="variable language_">global</span>, p);</span><br><span class="line">      <span class="comment">// 如果属性不存在或者属性描述符的configurable的话</span></span><br><span class="line">      <span class="keyword">return</span> !descriptor?.<span class="property">configurable</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">forEach</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> descriptor = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(<span class="variable language_">global</span>, p);</span><br><span class="line">      <span class="keyword">if</span> (descriptor) &#123;</span><br><span class="line">        <span class="comment">// 判断当前的属性是否有getter</span></span><br><span class="line">        <span class="keyword">const</span> hasGetter = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(</span><br><span class="line">          descriptor,</span><br><span class="line">          <span class="string">&quot;get&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 为有getter的属性设置查询索引</span></span><br><span class="line">        <span class="keyword">if</span> (hasGetter) propertiesWithGetter.<span class="title function_">set</span>(p, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// freeze the descriptor to avoid being modified by zone.js</span></span><br><span class="line">        <span class="comment">// zone.js will overwrite Object.defineProperty</span></span><br><span class="line">        <span class="comment">// const rawObjectDefineProperty = Object.defineProperty;</span></span><br><span class="line">        <span class="comment">// 拷贝属性到fakeWindow对象上</span></span><br><span class="line">        <span class="title function_">rawObjectDefineProperty</span>(fakeWindow, p, <span class="title class_">Object</span>.<span class="title function_">freeze</span>(descriptor));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    fakeWindow,</span><br><span class="line">    propertiesWithGetter,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO-2</span></span><br><span class="line"><span class="comment">// proxySandBox 的 getter/setter</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rawWindow = <span class="variable language_">window</span>;</span><br><span class="line"><span class="comment">// window副本和上面说的有getter的属性的索引</span></span><br><span class="line"><span class="keyword">const</span> &#123; fakeWindow, propertiesWithGetter &#125; = <span class="title function_">createFakeWindow</span>(rawWindow);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> descriptorTargetMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="title class_">PropertyKey</span>, <span class="title class_">SymbolTarget</span>&gt;();</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hasOwnProperty</span> = (<span class="params">key: PropertyKey</span>) =&gt;</span><br><span class="line">  fakeWindow.<span class="title function_">hasOwnProperty</span>(key) || rawWindow.<span class="title function_">hasOwnProperty</span>(key);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(fakeWindow, &#123;</span><br><span class="line">  <span class="title function_">set</span>(<span class="attr">target</span>: <span class="title class_">FakeWindow</span>, <span class="attr">p</span>: <span class="title class_">PropertyKey</span>, <span class="attr">value</span>: any): boolean &#123;</span><br><span class="line">    <span class="keyword">if</span> (sandboxRunning) &#123;</span><br><span class="line">      <span class="comment">// 在fakeWindow上设置属性值</span></span><br><span class="line">      target[p] = value;</span><br><span class="line">      <span class="comment">// 记录属性值的变更</span></span><br><span class="line">      updatedValueSet.<span class="title function_">add</span>(p);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// SystemJS属性拦截器</span></span><br><span class="line">      <span class="title function_">interceptSystemJsProps</span>(p, value);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在 strict-mode 下，Proxy 的 handler.set 返回 false 会抛出 TypeError，在沙箱卸载的情况下应该忽略错误</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">get</span>(<span class="attr">target</span>: <span class="title class_">FakeWindow</span>, <span class="attr">p</span>: <span class="title class_">PropertyKey</span>): any &#123;</span><br><span class="line">    <span class="keyword">if</span> (p === <span class="title class_">Symbol</span>.<span class="property">unscopables</span>) <span class="keyword">return</span> unscopables;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 避免window.window 或 window.self 或window.top 穿透sandbox</span></span><br><span class="line">    <span class="keyword">if</span> (p === <span class="string">&quot;top&quot;</span> || p === <span class="string">&quot;window&quot;</span> || p === <span class="string">&quot;self&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p === <span class="string">&quot;hasOwnProperty&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> hasOwnProperty;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 批处理场景下会有场景使用，这里就不多赘述了</span></span><br><span class="line">    <span class="keyword">const</span> proxyPropertyGetter = <span class="title function_">getProxyPropertyGetter</span>(proxy, p);</span><br><span class="line">    <span class="keyword">if</span> (proxyPropertyGetter) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">getProxyPropertyValue</span>(proxyPropertyGetter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取值</span></span><br><span class="line">    <span class="keyword">const</span> value = propertiesWithGetter.<span class="title function_">has</span>(p)</span><br><span class="line">      ? (rawWindow <span class="keyword">as</span> any)[p]</span><br><span class="line">      : (target <span class="keyword">as</span> any)[p] || (rawWindow <span class="keyword">as</span> any)[p];</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getTargetValue</span>(rawWindow, value);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 还有一些对属性做操作的代码我就不一一列举了，可以自行查阅源码</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO-3</span></span><br><span class="line"><span class="comment">// 激活 / 卸载</span></span><br><span class="line"><span class="title function_">active</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sandboxRunning</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// 当前激活的子应用沙箱实例数量</span></span><br><span class="line">  activeSandboxCount++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">inactive</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">clearSystemJsProps</span>(<span class="variable language_">this</span>.<span class="property">proxy</span>, --activeSandboxCount === <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sandboxRunning</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 微前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>方案比较</title>
      <link href="/posts/a24016fa.html"/>
      <url>/posts/a24016fa.html</url>
      
        <content type="html"><![CDATA[<h1>微前端 wujie、qiankun、micro-app、EMP 方案比较</h1><h2 id="一、背景：为什么需要微前端？">一、背景：为什么需要微前端？</h2><p>前端代码已经变得越来越重：</p><ul><li>几个 G 的前端代码库</li><li>数百号前端开发人员</li><li>几 MB 的 Bundle Size</li></ul><p>也越来越复杂：</p><ul><li>层出不穷的框架、类库</li><li>各式各样的工程化体系</li><li>别具特色的跨端实践</li></ul><p>因而<em>需要一种分解复杂度、提升协作效率、支持灵活扩展的架构模式</em>，于是，微前端登上了舞台</p><h3 id="qiankun-方案">qiankun 方案</h3><p>qiankun 方案是基于 single-spa 的微前端方案。</p><p>特点</p><p>html entry 的方式引入子应用，相比 js entry 极大的降低了应用改造的成本；<br>完备的沙箱方案，js 沙箱做了 SnapshotSandbox、LegacySandbox、ProxySandbox 三套渐进增强方案，css 沙箱做了 strictStyleIsolation、experimentalStyleIsolation 两套适用不同场景的方案；<br>做了静态资源预加载能力；</p><p>不足</p><p>适配成本比较高，工程化、生命周期、静态资源路径、路由等都要做一系列的适配工作；<br>css 沙箱采用严格隔离会有各种问题，js 沙箱在某些场景下执行性能下降严重；<br>无法同时激活多个子应用，也不支持子应用保活；<br>无法支持 vite 等 esmodule 脚本运行；</p><h3 id="micro-app-方案">micro-app 方案</h3><p>micro-app 是基于 webcomponent + qiankun sandbox 的微前端方案。</p><p>特点</p><p>使用 webcomponet 加载子应用相比 single-spa 这种注册监听方案更加优雅；<br>复用经过大量项目验证过 qiankun 的沙箱机制也使得框架更加可靠；<br>组件式的 api 更加符合使用习惯，支持子应用保活；<br>降低子应用改造的成本，提供静态资源预加载能力；</p><p>不足</p><p>接入成本较 qiankun 有所降低，但是路由依然存在依赖；<br>多应用激活后无法保持各子应用的路由状态，刷新后全部丢失；<br>css 沙箱依然无法绝对的隔离，js 沙箱做全局变量查找缓存，性能有所优化；<br>支持 vite 运行，但必须使用 plugin 改造子应用，且 js 代码没办法做沙箱隔离；<br>对于不支持 webcompnent 的浏览器没有做降级处理；</p><h3 id="EMP-方案">EMP 方案</h3><p>EMP 方案是基于 webpack 5 module federation 的微前端方案。</p><p>特点</p><p>webpack 联邦编译可以保证所有子应用依赖解耦；<br>应用间去中心化的调用、共享模块；<br>模块远程 ts 支持；</p><p>不足</p><p>对 webpack 强依赖，老旧项目不友好；<br>没有有效的 css 沙箱和 js 沙箱，需要靠用户自觉；<br>子应用保活、多应用激活无法实现；<br>主、子应用的路由可能发生冲突；</p><h4 id="无界方案">无界方案</h4><p>无界微前端方案基于 webcomponent 容器 + iframe 沙箱，能够完善的解决适配成本、样式隔离、运行性能、页面白屏、子应用通信、子应用保活、多应用激活、vite 框架支持、应用共享等用户的核心诉求。</p><p>下面就成本、速度、隔离、功能等多个方面进行阐述。</p><h4 id="成本低">成本低</h4><p>无界微前端的成本非常低，主要体现在主应用的使用成本、子应用的适配成本两个方面。</p><h5 id="主应用使用成本">主应用使用成本</h5><p>主应用使用无界不需要学习额外的知识，无界提供基于 vue 封装的 wujie-vue 和基于 react 封装的 wujie-react，用户可以当初普通组件一样加载子应用，以 wujie-vue 举例：</p><pre><code> &lt;WujieVue   width=&quot;100%&quot;   height=&quot;100%&quot;   name=&quot;xxx&quot;   url=&quot;xxx&quot;   :sync=&quot;true&quot;   :fiber=&quot;true&quot;   :degrade=&quot;false&quot;   :fetch=&quot;fetch&quot;   :props=&quot;props&quot;   :plugins=&quot;plugins&quot;   :beforeLoad=&quot;beforeLoad&quot;   :beforeMount=&quot;beforeMount&quot;   :afterMount=&quot;afterMount&quot;   :beforeUnmount=&quot;beforeUnmount&quot;   :afterUnmount=&quot;afterUnmount&quot; &gt;&lt;/WujieVue&gt;</code></pre><p>子应用加载和普通 vue 组件加载并无二致，所有配置都收敛到组件的属性上。</p><h5 id="子应用适配成本">子应用适配成本</h5><p>子应用首先需要做支持跨域请求改造，这个是所有微前端框架运行的前提，除此之外子应用可以不做任何改造就可以在无界框架中运行，不过此时运行的方式是重建模式。</p><p>子应用在无界中会根据是否保活、是否做了生命周期适配进入不同的运行模式：</p><p><img src="images/wujie.webp" alt="无界"></p><p>其中保活模式、单例模式、重建模式适用于不同的业务场景，就算复杂点的单例模式用户也只是需要做一点简单的生命周期改造工作，可以说子应用适配成本极低。</p><h4 id="速度快">速度快</h4><p>无界微前端非常快，主要体现在首屏打开快、运行速度快两个方面。</p><h5 id="首屏打开快">首屏打开快</h5><p>目前大部分微前端只能做到静态资源预加载，但是就算子应用所有资源都预加载完毕，等到子应用打开时页面仍然有不短的白屏时间，这部分白屏时间主要是子应用 js 的解析和执行。</p><p>无界微前端不仅能够做到静态资源的预加载，还可以做到子应用的预执行。</p><p>预执行会阻塞主应用的执行线程，所以无界提供 fiber 执行模式，采取类似 react fiber 的方式间断执行 js，每个 js 文件的执行都包裹在 requestidlecallback 中，每执行一个 js 可以返回响应外部的输入，但是这个颗粒度是 js 文件，如果子应用单个 js 文件过大，可以通过拆包的方式降低体积达到 fiber 执行模式效益最大化。</p><h5 id="运行速度快">运行速度快</h5><p>子应用的 js 在 iframe 内运行，由于 iframe 是一个天然的 js 运行沙箱，所以无需采用 with (fakewindow) 这种方式来指定子应用的执行上下文，从而避免由于采用 with 语句执行子应用代码而导致的性能下降，整体的运行性能和原生性能差别不大。</p><h4 id="原生隔离">原生隔离</h4><p>无界微前端实现了 css 沙箱和 js 沙箱的原生隔离，子应用不用担心污染问题。</p><h5 id="css-沙箱隔离">css 沙箱隔离</h5><p>无界将子应用的 dom 放置在 webcomponent + shadowdom 的容器中，除了可继承的 css 属性外实现了应用之间 css 的原生隔离。</p><h5 id="js-沙箱隔离">js 沙箱隔离</h5><p>无界将子应用的 js 放置在 iframe（js-iframe）中运行，实现了应用之间 window、document、location、history 的完全解耦和隔离。</p><h5 id="js-沙箱和-css-沙箱连接">js 沙箱和 css 沙箱连接</h5><p>无界在底层采用 proxy + Object.defineproperty 的方式将 js-iframe 中对 dom 操作劫持代理到 webcomponent shadowRoot 容器中，开发者无感知也无需关心。</p><h4 id="功能强大">功能强大</h4><p>无界微前端的功能非常强大，支持子应用保活、子应用内嵌、多应用激活、去中心化通信、生命周期、插件系统、vite 框架支持、兼容 IE9、应用共享。</p><h5 id="子应用保活">子应用保活</h5><p>当子应用设置为保活模式，切换子应用后仍然可以保持子应用的状态和路由不会丢失。</p><h5 id="子应用嵌套">子应用嵌套</h5><p>无界支持子应用多层嵌套，嵌套的应用和正常应用一致，支持预加载、保活、同步、通信等能力，需要注意的是内嵌的子应用 name 也需要保持唯一性，否则将复用之前渲染出来的应用</p><h5 id="多应用激活">多应用激活</h5><p>无界支持一个页面同时激活多个子应用并且保持这些子应用路由同步的能力。</p><h5 id="去中心化通信">去中心化通信</h5><p>无界提供多种通信方式：window.parent 直接通信、props 数据注入、去中心化 EventBus 通信机制：</p><ul><li>子应用 js 在和主应用同域的 iframe 内运行，所以 window.parent 可以直接拿到主应用的 window 对象来进行通信</li><li>主应用可以向子应用注入 props 对象，里面可以注入数据和方法供子应用调用</li><li>内置的 EventBus 去中心化通信方案可以让应用之间方便的直接通信</li></ul><h5 id="生命周期">生命周期</h5><p>无界提供完善的生命周期钩子供主应用调用：</p><ul><li>beforeLoad：子应用开始加载静态资源前触发</li><li>beforeMount：子应用渲染前触发 （生命周期改造专用）</li><li>afterMount：子应用渲染后触发（生命周期改造专用）</li><li>beforeUnmount：子应用卸载前触发（生命周期改造专用）</li><li>afterUnmount：子应用卸载后触发（生命周期改造专用）</li><li>activated：子应用进入后触发（保活模式专用）</li><li>deactivated：子应用离开后触发（保活模式专用）</li></ul><h5 id="插件系统">插件系统</h5><p>无界提供强大的插件系统，方便用户在运行时去修改子应用代码从而避免将适配代码硬编码到仓库中。</p><p>无界插件主要能力如下：</p><ul><li>html-loader 可以对子应用 template 进行处理</li><li>js-excludes 和 css-excludes 可以排除子应用特定的 js 和 css 加载</li><li>js-before-loaders、js-loader、js-after-loaders 可以方便的对子应用 js 进行自定义</li><li>css-before-loaders、css-loader、css-after-loaders 可以方便的对子应用 css 进行自定义</li></ul><h5 id="vite-框架支持">vite 框架支持</h5><p>无界子应用运行在 iframe 中原生支持 esm 的脚本，而且不用担心子应用运行的上下文问题，因为子应用读取的就是 iframe 的 window 上下文，所以无界微前端原生支持 vite 框架。</p><h5 id="兼容-IE9">兼容 IE9</h5><p>由于无界采用了 webcomponent + shadowdom + proxy 的方案，在某些低版本浏览器上无法运行时，无界微前端会自动降级。</p><p>降级方案采用：</p><ul><li>webcomponent + shadowdom ⇒ iframe（dom-iframe）</li><li>proxy + Object.defineproperty ⇒ Object.defineproperty</li><li>子应用运行的方式是 dom-iframe + js-iframe + Object.defineproperty，IE9+ 都可以兼容（无界没有 polyfill es6，需用户手动 babel 处理）。</li></ul><p>自动降级后无界依然可以保证子应用的 css 和 js 原生隔离，但是由于 dom-iframe 的限制，弹窗将只能在子应用内部打开</p><h5 id="应用共享">应用共享</h5><p>一个微前端系统可能同时运行多个子应用，不同子应用之间可能存在相同的包依赖，那么这个依赖就会在不同子应用中重复打包、重复执行造成性能和内存的浪费。</p><p>无界提供一种工程上的策略结合无界的插件能力，可以有效的解决这个问题（其他微前端框架也可以做到），这里以一个场景举例：主应用使用到了 ant-design-vue，子应用 A 也使用到了相同版本的 ant-design-vue。</p><p>主应用：</p><p>1、修改主应用的 index.js，将共享包挂载到主应用的 window 对象上</p><pre><code> // index.js import Antdv from &quot;ant-design-vue&quot;; // 将需要共享的包挂载到主应用全局 window.Antdv = Antdv;</code></pre><p>2、加载子应用时注入插件，将主应用的 Antdv 赋值到子应用的 window 对象上</p><pre><code> &lt;WujieVue name=&quot;A&quot; url=&quot;xxxxx&quot; :plugins=&quot;[&#123; jsBeforeLoaders: [&#123; content: 'window.Antdv = window.parent.Antdv' &#125;] &#125;]&quot;&gt; &lt;/WujieVue&gt;</code></pre><p>子应用: webpack 设置 externals</p><pre><code> module.exports = &#123;   externals: &#123;     &quot;ant-design-vue&quot;: &#123;       root: &quot;Antdv&quot;,       commonjs: &quot;Antdv&quot;,       commonjs2: &quot;Antdv&quot;,       amd: &quot;Antdv&quot;,     &#125;,   &#125;, &#125;;</code></pre><p>如果子应用需要单独运行可以参考文档</p><h4 id="总结">总结</h4><p>无界微前端采用 webcomponent + iframe 的来加载子应用，具有成本低、速度快、原生隔离、功能强大等一系列优点，在满足用户核心诉求的同时让使用微前端的体验就像使用普通组件一样简单，极大的降低了使用门槛。</p>]]></content>
      
      
      <categories>
          
          <category> 微前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>编码</title>
      <link href="/posts/6f8a188e.html"/>
      <url>/posts/6f8a188e.html</url>
      
        <content type="html"><![CDATA[<h3 id="常见字符编码">常见字符编码</h3><ul><li><p>ASCII编码表由一个字节表示，128个字符，实际上一个字节可以表示256个字符，但是老外的英文只有那么24个字母，用不了那么多的字符。但是随着计算机的普及，全球都在使用计算机，原本的编码不能够满足全球各国语言，所以出现了Unicode。<br><img src="/assets/images/encoded/ASCII.png" alt="ASCII编码表"></p></li><li><p>Unicode编码表是固定大小的编码，使用两个字节来表示字符，字母和汉字统一都是占用两个字节，容易造成空间浪费。</p></li><li><p>utf-8大小可变的编码，字母使用一个字节，汉字使用3个字节。</p></li><li><p>utf-16大小可变的编码，字母使用一个字节，汉字使用2个字节。</p></li><li></li><li><p>gbk编码可以表示汉字，而且范围广，字母使用一个字节，汉字2个字节。</p></li><li><p>gb2312 可以表示汉字，gb2312 &lt; gbk</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Lerna</title>
      <link href="/posts/c167eebd.html"/>
      <url>/posts/c167eebd.html</url>
      
        <content type="html"><![CDATA[<h2 id="Lerna">Lerna</h2><h3 id="Tmp">Tmp</h3><ul><li><a href="https://juejin.cn/book/6844733781945876488?utm_campaign=sembaidu&amp;utm_medium=sem_baidu_jj_pc_dc01&amp;utm_source=bdpcjjqd02616">https://juejin.cn/book/6844733781945876488?utm_campaign=sembaidu&amp;utm_medium=sem_baidu_jj_pc_dc01&amp;utm_source=bdpcjjqd02616</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Monorepo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Win10 安装 Docker</title>
      <link href="/posts/fa5adda8.html"/>
      <url>/posts/fa5adda8.html</url>
      
        <content type="html"><![CDATA[<h3 id="开启Hyper-V">开启Hyper-V</h3><ul><li>执行 hyper-v.cmd</li></ul><h3 id="伪装成专业版绕过安装检测-修改注册表">伪装成专业版绕过安装检测(修改注册表)</h3><ul><li>方法一<ul><li>定位到HKEY_LOCAL_MACHINE\software\Microsoft\Windows NT\CurrentVersion</li><li>点击current version，在右侧找到EditionId，右键点击EditionId 选择&quot;修改&quot;</li><li>在弹出的对话框中将第二项”数值数据“的内容改为Professional，然后点击确定<br><img src="./images/reg-table.webp" alt="win-reg-table.webp"></li></ul></li><li>方法二<ul><li>也可以用管理员权限运行如下cmd命令</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD <span class="string">&quot;HKEY_LOCAL_MACHINE\software\Microsoft\Windows NT\CurrentVersion&quot;</span> <span class="regexp">/v EditionId /</span>T REG_EXPAND_SZ <span class="regexp">/d Professional /</span>F</span><br></pre></td></tr></table></figure></li><li>注意事项</li><li>修改前先备份注册表</li><li>重启后此项注册表值会自动还原，但不影响docker运行</li><li><a href="https://hub.docker.com/editions/community/docker-ce-desktop-windows">官网下载</a> docker-ce-desktop-windows<ul><li>取消勾选window容器！</li></ul></li></ul><p><a href="https://www.jianshu.com/p/1329954aa329">参考链接</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hyper-v.cmd</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">pushd</span> <span class="string">&quot;%~dp0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> /b %SystemRoot%\servicing\Packages\*Hyper-V*.mum &gt;hyper-v.txt</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f %%i <span class="keyword">in</span> (<span class="string">&#x27;findstr /i . hyper-v.txt 2^&gt;nul&#x27;</span>) <span class="keyword">do</span> dism /online /norestart /add-package:<span class="string">&quot;%SystemRoot%\servicing\Packages\%%i&quot;</span></span><br><span class="line"></span><br><span class="line">del hyper-v.txt</span><br><span class="line"></span><br><span class="line">Dism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 容器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Win7 安装 Docker</title>
      <link href="/posts/c4d5ad4d.html"/>
      <url>/posts/c4d5ad4d.html</url>
      
        <content type="html"><![CDATA[<p>win 7 开启虚拟化：<br>1. <a href="http://www.xitongcheng.com/jiaocheng/win7_article_39535.html">http://www.xitongcheng.com/jiaocheng/win7_article_39535.html</a></p><p>Docker for windows安装参考链接：<br><a href="https://blog.csdn.net/Jwast/article/details/79115268">https://blog.csdn.net/Jwast/article/details/79115268</a></p><h2 id="映射方式：">映射方式：</h2><p>window-oracle VM VirtualBox-Docker</p><p>win7 下载地址： <a href="https://get.daocloud.io/toolbox/">https://get.daocloud.io/toolbox/</a></p><p>docker配置mysql参考链接：<br><a href="https://blog.csdn.net/sinat_30397435/article/details/79534785">https://blog.csdn.net/sinat_30397435/article/details/79534785</a><br><a href="https://blog.csdn.net/jiangyu1013/article/details/79958410">https://blog.csdn.net/jiangyu1013/article/details/79958410</a></p><p>Docker Toolbox 常见问题解决方案：</p><ol><li><p><a href="https://blog.csdn.net/gezhonglei2007/article/details/51541580">https://blog.csdn.net/gezhonglei2007/article/details/51541580</a></p></li><li><p>Unable to verify the Docker daemon is listening: Maximum number of retries (10) exceeded<br>docker-machine rm -f default<br>docker-machine create -d virtualbox default</p></li></ol><p>备注：windows 下仅支持 c 盘下映射</p><p>docker toolbox 文件共享<br>临时：<br>sudo mount -t vboxsf &lt;vbox中设置的共享文件夹名称&gt; &lt;Ubuntu中挂载目标文件夹路径&gt;<br>永久：<br>sudo vim /etc/fstab<br>share /mnt/shared vboxsf rw,gid=100,uid=1000,auto 0 0</p><p>重新生成证书：<br>docker-machine regenerate-certs default<br>docker-machine restart default</p><h3 id="启动">启动</h3><ol><li><p><a href="http://start.sh">start.sh</a></p></li><li><p>账号<br>docker/tcuser<br>root进入方式：<br>sudo -i</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 容器 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Qiankun</title>
      <link href="/posts/f45e580f.html"/>
      <url>/posts/f45e580f.html</url>
      
        <content type="html"><![CDATA[<h2 id="Qiankun">Qiankun</h2><blockquote><p>基于Single-Spa，阿里系开源微前端框架</p></blockquote><ul><li>子应用可独立构建、运行时动态加载子应用完全解耦</li><li>技术栈无关</li><li>依赖协议接入<ul><li>子应用必须导出 bootstrap、mount、unmount 方法</li></ul></li></ul><h4 id="案例">案例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">└── qiankun-demo</span><br><span class="line">    ├── react-child <span class="comment"># react18子应用(作为嵌套应用的主应用)</span></span><br><span class="line">    ├── vite-child  <span class="comment"># react18-vite子应用</span></span><br><span class="line">    ├── vue2-child  <span class="comment"># vue2子应用</span></span><br><span class="line">    └── vue3-main   <span class="comment"># vue3主应用</span></span><br></pre></td></tr></table></figure><h4 id="vue3-main-基座应用">vue3-main 基座应用</h4><ul><li>声明子应用集合</li></ul><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name       <span class="meta"># 子应用名称</span></span><br><span class="line">entry      <span class="meta"># 子应用访问地址</span></span><br><span class="line"><span class="built_in">container</span>  <span class="meta"># 挂载dom节点ID</span></span><br><span class="line">activeRule <span class="meta"># 路由激活规则</span></span><br></pre></td></tr></table></figure><ul><li>路由切换时挂载<code>mount</code>/卸载<code>unmount</code>子应用</li></ul><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 挂载</span></span><br><span class="line"><span class="title">const</span> <span class="keyword">instance</span> = loadMicroApp(&#123; name, entry, container, activeRule &#125;);</span><br><span class="line"><span class="meta"># 卸载</span></span><br><span class="line"><span class="class"><span class="keyword">instance</span>.unmount()</span></span><br><span class="line"><span class="class"></span></span><br></pre></td></tr></table></figure><ul><li>通信<ul><li>监听子应用推送的消息、派发用户信息给子应用</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;receiveMessage&#x27;</span>, <span class="function">() =&gt;</span> <span class="keyword">void</span>)</span><br><span class="line"><span class="comment">// 派发  </span></span><br></pre></td></tr></table></figure><ul><li>子应用派发自定义事件、监听主应用推送的用户信息</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> event = <span class="keyword">new</span> <span class="title class_">CustomEvent</span>(<span class="string">&#x27;customEvent&#x27;</span>, &#123; <span class="attr">payload</span>: &#123; name, detail &#125; &#125;)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">dispatchEvent</span>(event)</span><br><span class="line"><span class="comment">// 监听用户信息</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;changeUser&#x27;</span>, <span class="function">() =&gt;</span> <span class="keyword">void</span>)</span><br></pre></td></tr></table></figure></li></ul><p>三种路由方式<br>BrowserRouter 以路径的形式来展现页面（只有 H5 认，所以注定了它只能在高级的浏览器端起作用）<br>HashRouter 是以 hash 的形式展现页面（所有版本的浏览器都认的一个东西，所以它的兼容性更强一些）<br>MemoryRouter 它只存在于内存里面，它不会对地址栏有任何影响（页面刷新回到初始状态）</p>]]></content>
      
      
      <categories>
          
          <category> 微前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Single-Spa</title>
      <link href="/posts/cdd55a0e.html"/>
      <url>/posts/cdd55a0e.html</url>
      
        <content type="html"><![CDATA[<h2 id="Single-Spa">Single-Spa</h2><blockquote><p>将多个单页应用聚合为一个整体应用的微前端框架</p></blockquote><p><strong>核心原理</strong><br>在 <code>基座 (主) 应用</code> 中注册所有 <code>App</code> 的路由，<strong>single-spa</strong> 保存各子应用的路由映射关系，充当微前端控制器 <code>Controler</code>，当对应的 URL 变换时，除了匹配 <code>基座应用</code> 本身的路由外，还会匹配 <code>子应用</code> 路由并加载渲染子应用。</p><p><strong>子应用会经过如下过程：</strong></p><ul><li>下载 (loaded)</li><li>初始化 (initialized)</li><li>挂载 (mounted)</li><li>卸载 (unmounted)</li></ul><p>single-spa 还会通过 生命周期 为这些过程提供对应的 钩子函数。</p><p><strong>调研结论</strong></p><ul><li>优点：实现路由劫持和应用加载</li><li>缺点：未处理css隔离、js 隔离、不能动态加载js 文件(无 js 沙箱机制)</li></ul>]]></content>
      
      
      <categories>
          
          <category> 微前端 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>数组</title>
      <link href="/posts/340249a9.html"/>
      <url>/posts/340249a9.html</url>
      
        <content type="html"><![CDATA[<p>数组(Array)</p><blockquote><p>数组是一种聚合数据类型，它是将具有相同类型的若干变量有序地组织在一起的集合。数组可以说是最基本的数据结构，在各种编程语言中都有对应。一个数组可以分解为多个数组元素，按照数据元素的类型，数组可以分为整型数组、字符型数组、浮点型数组、指针数组和结构数组等。数组还可以有一维、二维以及多维等表现形式。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>栈</title>
      <link href="/posts/1f4ac2fb.html"/>
      <url>/posts/1f4ac2fb.html</url>
      
        <content type="html"><![CDATA[<p>栈(Stack)</p><blockquote><p>栈是一种特殊的线性表，它只能在一个表的一个固定端进行数据结点的插入和删除操作。栈按照后进先出的原则来存储数据，也就是说，先插入的数据将被压入栈底，最后插入的数据在栈顶，读出数据时，从栈顶开始逐个读出。栈在汇编语言程序中，经常用于重要数据的现场保护。栈中没有数据时，称为空栈。</p></blockquote><ul><li>先进后出</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>AST</title>
      <link href="/posts/7389a59f.html"/>
      <url>/posts/7389a59f.html</url>
      
        <content type="html"><![CDATA[<h2 id="Abstract-Syntax-Tree">Abstract Syntax Tree</h2><p><strong>定义</strong></p><ul><li>源代码语法结构的一种抽象表示。它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构</li></ul><p><strong>作用</strong></p><ul><li>编辑器的错误提示、代码格式化、代码高亮、代码自动补全</li><li>elint、pretiier 对代码错误或风格的检查</li><li>webpack 通过 babel 转译 javascript 语法</li></ul><p><strong>如何生成</strong></p><p>js 执行的第一步是读取 js 文件中的字符流，然后通过词法分析生成 token，之后再通过语法分析( Parser )生成 AST，最后生成机器码执行。</p><p>整个解析过程主要分为以下两个步骤：</p><ul><li>分词：将整个代码字符串分割成最小语法单元数组</li><li>语法分析：在分词基础上建立分析语法单元之间的关系</li></ul><p>JS Parser 是 js 语法解析器，它可以将 js 源码转成 AST，常见的 Parser 有 esprima、traceur、acorn、shift 等。</p><p><strong>词法分析</strong></p><p>词法分析，也称之为扫描（scanner），简单来说就是调用 next() 方法，一个一个字母的来读取字符，然后与定义好的 JavaScript 关键字符做比较，生成对应的Token。Token 是一个不可分割的最小单元:</p><blockquote><p>例如 var 这三个字符，它只能作为一个整体，语义上不能再被分解，因此它是一个 Token。</p></blockquote><p>词法分析器里，每个关键字是一个 Token ，每个标识符是一个 Token，每个操作符是一个 Token，每个标点符号也都是一个 Token。除此之外，还会过滤掉源程序中的注释和空白字符(换行符、空格、制表符等)。<br>最终，整个代码将被分割进一个tokens列表（或者说一维数组）。</p><p><strong>语法分析</strong></p><p>语法分析会将词法分析出来的 Token 转化成有语法含义的抽象语法树结构。同时，验证语法，语法如果有错的话，抛出语法错误。</p><ul><li><p>案例1<br><img src="../images/word-fx1.webp" alt="AST图例"></p></li><li><p>案例2<br><img src="../images/word-fx2.webp" alt="AST图例"></p></li><li><p>案例3<br><img src="../images/word-fx3.webp" alt="AST图例"></p></li></ul><p>截图使用<strong>Acorn</strong>解析，Parser 解析器中公认速度最快</p><p>上述截图的属性是 AST 的一部分</p><ul><li>VariableDeclaration 变量声明</li><li>VariableDeclarator 变量声明的描述</li><li>Expression 表达式节点</li><li>…</li></ul><p>更多属性展示：</p><ul><li><a href="https://astexplorer.net/">AST explorer</a> 在线看到不同的 parser 解析 js 代码后得到的 AST</li><li><a href="https://github.com/estree/estree">ESTree ESTree</a></li><li>关于属性介绍的文档 <a href="http://www.goyth.com/2018/12/23/AST/#Expressions">抽象语法树AST介绍</a></li></ul><h2 id="实战-AST-的运用">实战 AST 的运用</h2><p><strong>题目</strong></p><p>通过上面介绍的 console.log AST，下面我们就来完成一个在调用 console.log(xx) 时候给前面加一个函数名，这样用户在打印时候能改方便看到是哪个函数调用的。</p><ul><li>举例</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 源代码</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;data&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 转化后代码</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getData&quot;</span>, <span class="string">&quot;data&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>介绍</li></ul><p>首先介绍下我们需要使用的工具 Babel</p><ul><li><p>@babel/parser : 将 js 代码解析为AST抽象语法树</p></li><li><p>@babel/traverse 对 AST 节点进行递归遍历</p></li><li><p>@babel/types 对具体的 AST 节点进行进行修改</p></li><li><p>@babel/generator :  AST 抽象语法树转换为新的 js 代码</p></li><li><p>实践</p><ul><li>新建文件打开控制台安装需要的包</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i @babel/parser @babel/traverse @babel/types @babel/generator -D</span><br></pre></td></tr></table></figure><ul><li>创建 index.js 文件, 编写大致布局如下 使用 AST</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generator = <span class="built_in">require</span>(<span class="string">&quot;@babel/generator&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&quot;@babel/parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&quot;@babel/traverse&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> types = <span class="built_in">require</span>(<span class="string">&quot;@babel/types&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compile</span>(<span class="params">code</span>) &#123;</span><br><span class="line">  <span class="comment">// 1.parse</span></span><br><span class="line">  <span class="keyword">const</span> ast = parser.<span class="title function_">parse</span>(code);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2,traverse</span></span><br><span class="line">  <span class="keyword">const</span> visitor = &#123;</span><br><span class="line">    <span class="title class_">CallExpression</span>(path) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; callee &#125; = path.<span class="property">node</span>;</span><br><span class="line">      <span class="keyword">const</span> isConsoleLog =</span><br><span class="line">        types.<span class="title function_">isMemberExpression</span>(callee) &amp;&amp;</span><br><span class="line">        callee.<span class="property">object</span>.<span class="property">name</span> === <span class="string">&quot;console&quot;</span> &amp;&amp;</span><br><span class="line">        callee.<span class="property">property</span>.<span class="property">name</span> === <span class="string">&quot;log&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> (isConsoleLog) &#123;</span><br><span class="line">        <span class="keyword">const</span> funcPath = path.<span class="title function_">findParent</span>(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> p.<span class="title function_">isFunctionDeclaration</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> funcName = funcPath.<span class="property">node</span>.<span class="property">id</span>.<span class="property">name</span>;</span><br><span class="line">        fs.<span class="title function_">writeFileSync</span>(<span class="string">&quot;./funcPath.json&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(funcPath.<span class="property">node</span>), <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入成功&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        path.<span class="property">node</span>.<span class="property">arguments</span>.<span class="title function_">unshift</span>(types.<span class="title function_">stringLiteral</span>(funcName));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  traverse.<span class="title function_">default</span>(ast, visitor);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. generator</span></span><br><span class="line">  <span class="keyword">return</span> generator.<span class="title function_">default</span>(ast, &#123;&#125;, code);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">function getData() &#123;</span></span><br><span class="line"><span class="string">  console.log(&#x27;data&#x27;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">compile</span>(code).<span class="property">code</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 终端执行 node index.js</span></span><br><span class="line"><span class="comment">// path.node 结构</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;CallExpression&quot;</span>,</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="number">24</span>,</span><br><span class="line">  <span class="string">&quot;end&quot;</span>: <span class="number">43</span>,</span><br><span class="line">  <span class="string">&quot;loc&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">2</span> &#125;,</span><br><span class="line">    <span class="string">&quot;end&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">21</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;callee&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;MemberExpression&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="number">24</span>,</span><br><span class="line">    <span class="string">&quot;end&quot;</span>: <span class="number">35</span>,</span><br><span class="line">    <span class="string">&quot;loc&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;start&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">2</span> &#125;,</span><br><span class="line">      <span class="string">&quot;end&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">13</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;object&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start&quot;</span>: <span class="number">24</span>,</span><br><span class="line">      <span class="string">&quot;end&quot;</span>: <span class="number">31</span>,</span><br><span class="line">      <span class="string">&quot;loc&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;start&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">2</span> &#125;,</span><br><span class="line">        <span class="string">&quot;end&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">9</span> &#125;,</span><br><span class="line">        <span class="string">&quot;identifierName&quot;</span>: <span class="string">&quot;console&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;console&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;property&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;Identifier&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start&quot;</span>: <span class="number">32</span>,</span><br><span class="line">      <span class="string">&quot;end&quot;</span>: <span class="number">35</span>,</span><br><span class="line">      <span class="string">&quot;loc&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;start&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">10</span> &#125;,</span><br><span class="line">        <span class="string">&quot;end&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">13</span> &#125;,</span><br><span class="line">        <span class="string">&quot;identifierName&quot;</span>: <span class="string">&quot;log&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;log&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;computed&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;arguments&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;StringLiteral&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start&quot;</span>: <span class="number">36</span>,</span><br><span class="line">      <span class="string">&quot;end&quot;</span>: <span class="number">42</span>,</span><br><span class="line">      <span class="string">&quot;loc&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;start&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">14</span> &#125;,</span><br><span class="line">        <span class="string">&quot;end&quot;</span>: &#123; <span class="string">&quot;line&quot;</span>: <span class="number">3</span>, <span class="string">&quot;column&quot;</span>: <span class="number">20</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;extra&quot;</span>: &#123; <span class="string">&quot;rawValue&quot;</span>: <span class="string">&quot;data&quot;</span>, <span class="string">&quot;raw&quot;</span>: <span class="string">&quot;&#x27;data&#x27;&quot;</span> &#125;,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;data&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../images/parser-eg.webp" alt="parser解释"></p></li></ul><p><strong>总结</strong></p><p>为了兼容低版本浏览器 我们也通常会使用 webpack 打包编译我们的代码将 ES6 语法降低版本，比如箭头函数变成普通函数。将 const、let 声明改成 var 等等，他都是通过 AST 来完成的，只不过实现的过程比较复杂，精致。不过也都是这</p><p>三板斧：</p><ul><li>js 语法解析成 AST</li><li>修改 AST</li><li>AST 转成 js 语法</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>队列</title>
      <link href="/posts/b6c47025.html"/>
      <url>/posts/b6c47025.html</url>
      
        <content type="html"><![CDATA[<p>队列(Queue)</p><blockquote><p>队列和栈类似，也是一种特殊的线性表。和栈不同的是，队列<strong>只允许</strong>在表的一端进行插入操作，而在另一端进行删除操作。一般来说，进行插入操作的一端称为队尾，进行删除操作的一端称为队头。队列中没有元素时，称为空队列</p></blockquote><ul><li>先进先出</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>概念</title>
      <link href="/posts/b6c47025.html"/>
      <url>/posts/b6c47025.html</url>
      
        <content type="html"><![CDATA[<p>链表( Linked List)</p><blockquote><p>链表是一种数据元素按照链式存储结构进行存储的数据结构，这种存储结构具有在物理上存在非连续的特点。链表由一系列数据结点构成，每个数据结点包括数据域和指针域两部分。其中，指针域保存了数据结构中下一个元素存放的地址。链表结构中数据元素的逻辑顺序是通过链表中的指针链接次序来实现的。</p></blockquote><p>树( Tree)</p><blockquote><p>树是典型的非线性结构，它是包括，2个结点的有穷集合K。在树结构中，有且仅有一个根结点，该结点没有前驱结点。在树结构中的其他结点都有且仅有一个前驱结点，而且可以有两个后继结点，m≥0</p></blockquote><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 时间复杂度</span><br><span class="line"><span class="bullet">  -</span> 定义：估算程序运行时间</span><br><span class="line"><span class="bullet">  -</span> 估计算法的操作单元数量，来代表程序消耗的时间【默认CPU的每个单元运行消耗的时间都是相同的】</span><br><span class="line"><span class="bullet">  -</span> T(n) = O(f(n))</span><br></pre></td></tr></table></figure><p>图(Graph)</p><blockquote><p>图是另一种非线性数据结构。在图结构中，数据结点一般称为顶点，而边是顶点的有序偶对。如果两个顶点之间存在一条边，那么就表示这两个顶点具有相邻关系</p></blockquote><p>堆(Heap)</p><blockquote><p>堆是一种特殊的树形数据结构，一般讨论的堆都是二叉堆。堆的特点是根结点的值是所有结点中最小的或者最大的，并且根结点的两个子树也是一个堆结构</p></blockquote><p>散列表(Hash)</p><blockquote><p>散列表源自于散列函数(Hash function)，其思想是如果在结构中存在关键字和T相等的记录，那么必定在F(T)的存储位置可以找到该记录，这样就可以不用进行比较操作而直接取得所查记录</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Nginx 基础</title>
      <link href="/posts/432abbac.html"/>
      <url>/posts/432abbac.html</url>
      
        <content type="html"><![CDATA[<h3 id="Nginx">Nginx</h3><ul><li>静态服务器<ul><li>反向代理<br><img src="./images/reverse.png" alt="Reverse Proxy"></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方案一: 解决html文件缓存</span></span><br><span class="line">http &#123;</span><br><span class="line">  etag: on; # 注意不要同时开启强缓存，否则会覆盖协商缓存配置。</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen       80;</span><br><span class="line">  server_name  192.168.1.94;</span><br><span class="line">  root /home/ftp/jar/web;       # 配置静态资源地址</span><br><span class="line">  access_log   /logs main       # 日志输出目录</span><br><span class="line"></span><br><span class="line">  location @fallback &#123;</span><br><span class="line">    Rewrite ^.*$ /index.html break;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  location / &#123;      </span><br><span class="line">    index index.html;</span><br><span class="line">    try_files $uri $uri/ @fallback; # 跳转首页</span><br><span class="line">    # 方案二: 解决html文件缓存</span><br><span class="line">    if ($request_filename ~* .*\.html$) &#123;</span><br><span class="line">      add_header Cache-Control &quot;no-cache, no-store&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">静态文件缓存，启用Cache-Control: max-age、Expires</span></span><br><span class="line">  location ~ ^/(css|js|media)/ &#123; # 停止往下查找</span><br><span class="line">    expires 30d;</span><br><span class="line">    access_log off;</span><br><span class="line">    add_header Cache-Control &quot;public&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">nginx 防盗链 设置</span></span><br><span class="line">  location ~* \.(gif|jpg|png|jpeg|swf|flv)$ &#123;</span><br><span class="line">    expires 30d;</span><br><span class="line">    valid_referers &quot;http://192.168.1.94:*/*&quot;;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">      return 403;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   # </span><span class="language-bash">代理ajax请求</span></span><br><span class="line">  location ^~/api &#123;</span><br><span class="line">     # rewrite ^/api/(.*)$ /$1 break;   # 如果后端接口不是统一以api开头，去掉api前缀（$1 为正则引用部分）</span><br><span class="line">     proxy_set_header Host  $http_host; # 包含客户端真实的域名和端口号</span><br><span class="line">     proxy_set_header Connection close;</span><br><span class="line">     proxy_set_header X-Forwarded-Proto $scheme;    # 客户端请求协议 </span><br><span class="line">     proxy_set_header X-Real-IP $remote_addr;   # 表示客户端真实的IP</span><br><span class="line">     proxy_set_header X-Forwarded-Server $host; # X-Forwarded-For:多层代理时会包含真实客户端及中间每个代理服务器的IP</span><br><span class="line">     proxy_pass http://api_service/;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line">- 负载均衡</span><br><span class="line">![load-balance](./images/load-balance.jpg)</span><br></pre></td></tr></table></figure>upstream mysqlTest {<br>server 192.168.20.1:8080; # 应用服务器1<br>server 192.168.20.2:8080; # 应用服务器2<br>}<pre><code></code></pre></li></ul><h3 id="Mac-下-Nginx-启动停止">Mac 下 Nginx 启动停止</h3><ul><li>brew services start nginx</li><li>brew services stop nginx</li></ul>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>疑问汇总</title>
      <link href="/posts/ab3cdf47.html"/>
      <url>/posts/ab3cdf47.html</url>
      
        <content type="html"><![CDATA[<h3 id="root、alias、-rewrite-指令用法">root、alias、 rewrite 指令用法</h3><ul><li><p>root</p><ul><li>root path</li><li>默认值 root html</li><li>配置段 http server location if</li></ul></li><li><p>alias</p><ul><li>alias path</li><li>配置段 location</li></ul></li><li><p>rewrite</p><ul><li>syntax  rewrite regex replacement [flag]</li><li>default -</li><li>server location ifnginx</li></ul></li></ul><h3 id="root、alias-区别">root、alias 区别</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root与<span class="keyword">alias</span>主要区别在于nginx如何解释<span class="keyword">location</span>后面的uri，这会使两者分别以不同的方式将请求映射到服务器文件上。</span><br><span class="line">root的处理结果是：root路径＋<span class="keyword">location</span>路径</span><br><span class="line"><span class="keyword">alias</span>的处理结果是：使用<span class="keyword">alias</span>路径替换<span class="keyword">location</span>路径</span><br><span class="line"><span class="keyword">alias</span>是一个目录别名的定义，root则是最上层目录的定义</span><br><span class="line">还有一个重要的区别是<span class="keyword">alias</span>后面必须要用“/”结束，否则会找不到文件的。。。而root则可有可无~~</span><br></pre></td></tr></table></figure><ul><li>root 实例</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location ^~ <span class="regexp">/t/</span> &#123;</span><br><span class="line">     root <span class="regexp">/www/</span>root<span class="regexp">/html/</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 如果一个请求的URI是<span class="regexp">/t/</span>a.html时，web服务器将会返回服务器上的<span class="regexp">/www/</span>root<span class="regexp">/html/</span>t/a.html的文件</span><br></pre></td></tr></table></figure><ul><li>alias 实例</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location ^~ <span class="regexp">/t/</span> &#123;</span><br><span class="line"> alias <span class="regexp">/www/</span>root<span class="regexp">/html/</span>new_t/;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 如果一个请求的URI是<span class="regexp">/t/</span>a.html时，web服务器将会返回服务器上的<span class="regexp">/www/</span>root<span class="regexp">/html/</span>new_t/a.html的文件。注意这里是new_t，因为**alias会把location后面配置的路径丢弃掉，把当前匹配到的目录指向到指定的目录**</span><br></pre></td></tr></table></figure><h3 id="Nginx-URL-拆头处理-根据-publicPath-转不同-API-server">Nginx URL 拆头处理[根据 publicPath 转不同 API server]</h3><ul><li>proxy_pass 后面加根路径 /</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">  location ^~<span class="regexp">/user/</span> &#123;</span><br><span class="line"></span><br><span class="line">    proxy_pass http:<span class="comment">//user/;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ^~<span class="regexp">/user/</span> 表示匹配前缀是 user 的请求， proxy_pass的结尾有 <span class="regexp">/ ，则会把 /u</span>ser<span class="comment">/* 后面的路径直接拼到后面 即移除 user.</span></span><br></pre></td></tr></table></figure><ul><li>rewrite</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">  location ^~<span class="regexp">/user/</span> &#123;</span><br><span class="line"></span><br><span class="line">    rewrite    ^<span class="regexp">/user/</span>(.*)$ /<span class="variable">$1</span> <span class="keyword">break</span>;  <span class="comment"># rewrite 重写 url</span></span><br><span class="line">    proxy_pass http:<span class="regexp">//u</span>ser;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Nginx 内置变量</title>
      <link href="/posts/5fb06f85.html"/>
      <url>/posts/5fb06f85.html</url>
      
        <content type="html"><![CDATA[<h1>nginx内置变量</h1><p>内置变量存放在  ngx_http_core_module 模块中，变量的命名方式和apache 服务器变量是一致的。总而言之，这些变量 <strong>代表着客户端请求头的内容</strong></p><p>$arg_name<br>请求中的的参数名，即“?”后面的arg_name=arg_value形式的arg_name</p><p>$args<br>请求中的参数值</p><p>$binary_remote_addr<br>客户端地址的二进制形式, 固定长度为4个字节</p><p>$body_bytes_sent<br>传输给客户端的字节数，响应头不计算在内；这个变量和Apache的mod_log_config模块中的“%B”参数保持兼容</p><p>$bytes_sent<br>传输给客户端的字节数 (1.3.8, 1.2.5)</p><p>$connection<br>TCP连接的序列号 (1.3.8, 1.2.5)</p><p>$connection_requests<br>TCP连接当前的请求数量 (1.3.8, 1.2.5)</p><p>$content_length<br>“Content-Length” 请求头字段</p><p>$content_type<br>“Content-Type” 请求头字段</p><p>$cookie_name<br>cookie名称</p><p>$document_root<br>当前请求的文档根目录或别名</p><p>$document_uri<br>同 $uri</p><p>$host<br>优先级如下：HTTP请求行的主机名&gt;”HOST”请求头字段&gt;符合请求的服务器名</p><p>$hostname<br>主机名</p><p>$http_name<br>匹配任意请求头字段； 变量名中的后半部分“name”可以替换成任意请求头字段，如在配置文件中需要获取http请求头：“Accept-Language”，那么将“－”替换为下划线，大写字母替换为小写，形如：$http_accept_language即可。</p><p>$https<br>如果开启了SSL安全模式，值为“on”，否则为空字符串。</p><p>$is_args<br>如果请求中有参数，值为“?”，否则为空字符串。</p><p>$limit_rate<br>用于设置响应的速度限制，详见 limit_rate。</p><p>$msec<br>当前的Unix时间戳 (1.3.9, 1.2.6)</p><p>$nginx_version<br>nginx版本</p><p>$pid<br>工作进程的PID</p><p>$pipe<br>如果请求来自管道通信，值为“p”，否则为“.” (1.3.12, 1.2.7)</p><p>$proxy_protocol_addr<br>获取代理访问服务器的客户端地址，如果是直接访问，该值为空字符串。(1.5.12)</p><p>$query_string<br>同 $args</p><p>$realpath_root<br>当前请求的文档根目录或别名的真实路径，会将所有符号连接转换为真实路径。</p><p>$remote_addr<br>客户端地址</p><p>$remote_port<br>客户端端口</p><p>$remote_user<br>用于HTTP基础认证服务的用户名</p><p>$request<br>代表客户端的请求地址</p><p>$request_body<br>客户端的请求主体<br>此变量可在location中使用，将请求主体通过proxy_pass, fastcgi_pass, uwsgi_pass, 和 scgi_pass传递给下一级的代理服务器。</p><p>$request_body_file<br>将客户端请求主体保存在临时文件中。文件处理结束后，此文件需删除。如果需要之一开启此功能，需要设置client_body_in_file_only。如果将次文件传递给后端的代理服务器，需要禁用request body，即设置proxy_pass_request_body off，fastcgi_pass_request_body off, uwsgi_pass_request_body off, or scgi_pass_request_body off 。</p><p>$request_completion<br>如果请求成功，值为”OK”，如果请求未完成或者请求不是一个范围请求的最后一部分，则为空。</p><p>$request_filename<br>当前连接请求的文件路径，由root或alias指令与URI请求生成。</p><p>$request_length<br>请求的长度 (包括请求的地址, http请求头和请求主体) (1.3.12, 1.2.7)</p><p>$request_method<br>HTTP请求方法，通常为“GET”或“POST”</p><p>$request_time<br>处理客户端请求使用的时间 (1.3.9, 1.2.6); 从读取客户端的第一个字节开始计时。</p><p>$request_uri<br>这个变量等于包含一些客户端请求参数的原始URI，它无法修改，请查看$uri更改或重写URI，不包含主机名，例如：”/cnphp/test.php?arg=freemouse”。</p><p>$scheme<br>请求使用的Web协议, “http” 或 “https”</p><p>$sent_http_name<br>可以设置任意http响应头字段； 变量名中的后半部分“name”可以替换成任意响应头字段，如需要设置响应头Content-length，那么将“－”替换为下划线，大写字母替换为小写，形如：$sent_http_content_length 4096即可。</p><p>$server_addr<br>服务器端地址，需要注意的是：为了避免访问linux系统内核，应将ip地址提前设置在配置文件中。</p><p>$server_name<br>服务器名，<a href="http://www.cnphp.info">www.cnphp.info</a></p><p>$server_port<br>服务器端口</p><p>$server_protocol<br>服务器的HTTP版本, 通常为 “HTTP/1.0” 或 “HTTP/1.1”</p><p>$status<br>HTTP响应代码 (1.3.2, 1.2.2)</p><p>$tcpinfo_rtt, $tcpinfo_rttvar, $tcpinfo_snd_cwnd, $tcpinfo_rcv_space<br>客户端TCP连接的具体信息</p><p>$time_iso8601<br>服务器时间的ISO 8610格式 (1.3.12, 1.2.7)</p><p>$time_local<br>服务器时间（LOG Format 格式） (1.3.12, 1.2.7)</p><p>$uri<br>请求中的当前URI(不带请求参数，参数位于$args)，可以不同于浏览器传递的$request_uri的值，它可以通过内部重定向，或者使用index指令进行修改，$uri不包含主机名，如”/foo/bar.html”。</p><h1>常见问题汇总</h1><h1>关于文件上传</h1><p>lient_max_body_size     50m; //文件大小限制，默认1m<br>client_header_timeout    1m;<br>client_body_timeout      1m;<br>proxy_connect_timeout     60s;<br>proxy_read_timeout      1m;<br>proxy_send_timeout      1m;<br>解释:<br>client_max_body_size<br>限制请求体的大小，若超过所设定的大小，返回413错误。<br>client_header_timeout<br>读取请求头的超时时间，若超过所设定的大小，返回408错误。<br>client_body_timeout<br>读取请求实体的超时时间，若超过所设定的大小，返回413错误。<br>proxy_connect_timeout<br>http请求无法立即被容器(tomcat, netty等)处理，被放在nginx的待处理池中等待被处理。此参数为等待的最长时间，默认为60秒，官方推荐最长不要超过75秒。<br>proxy_read_timeout<br>http请求被容器(tomcat, netty等)处理后，nginx会等待处理结果，也就是容器返回的response。此参数即为服务器响应时间，默认60秒。<br>proxy_send_timeout<br>http请求被服务器处理完后，把数据传返回给Nginx的用时，默认60秒</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>rewrite 与 proxy_pass 区别</title>
      <link href="/posts/acae599e.html"/>
      <url>/posts/acae599e.html</url>
      
        <content type="html"><![CDATA[<h3 id="一、rewrite">一、rewrite</h3><p>1、rewrite 特点</p><p>（1）重写url，可以重写path，也可以重写整个url（存在协议，默认返回302，代表临时跳转，此时 last 和 break 无效）。</p><p>（2）4 个 flag：last、break、redirect（302）、permanent（301）。存在 flag 时，在当前 location 中，不再执行之后的 rewrite 指令集（包括 rewrite、return）中的指令；break 和 last 正好相反，break 中止对其它 location 的规则匹配，last 继续向其它 location 进行规则匹配；</p><p>（3）存在 rewrite 时，proxy_pass 需要和 break 一起使用，否则将被跳过。</p><p>（4）rewrite 重写整个 url （302）时，会暴露链接（浏览器执行重定向链接）；重写 path 时，break 和 last 可以隐藏链接（代理执行），redirect、permanent 会暴露链接（浏览器执行）；</p><p>（5）rewrite 和 proxy_pass 都可以重写整个url，区别是：</p><ul><li><p>rewrite 重写整个 url 后，重定向的请求由浏览器发送，不常用，一般适用于访问公网其他服务器，如用于解决跨域问题；proxy_pass 重写整个 url 后，由代理服务器发起重定向请求，浏览器是无感知的，以便于访问内网和隐藏调用链；</p></li><li><p>rewrite 常用于重写 path，此时使用 break 和 last 也可以隐藏重定向的调用链，使用 redirect 和 permanent 则会暴露调用链;</p></li></ul><p>总结：</p><p>（1）仅重写 path，使用 rewrite；</p><p>（2）仅重写主机，最好使用 proxy_pass；</p><p>（3）重写整个 url，结合使用 proxy_pass 和 rewrite。</p><p>2、使用举例</p><p>（1）break</p><pre><code>server &#123;        listen 9000;        server_name localhost;        location /info &#123;                rewrite ^/.* https://www.baidu.com permanent;        &#125;        location /break &#123;                rewrite /.* /info break;                proxy_pass http://127.0.0.1:9000;                # 该 return 不执行                return 200 &quot;ok&quot;;        &#125;&#125;</code></pre><p>输入：<a href="http://localhost:9000">http://localhost:9000</a></p><p>执行过程：首先，匹配到 /break 的 location 块，执行了 rewrite 和 proxy_pass，跳过 return（因为有 break），重定向到 <a href="http://127.0.0.1:9000/info%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%86%8D%E6%AC%A1%E8%BF%9B%E8%A1%8C">http://127.0.0.1:9000/info；然后，再次进行</a> server 块，匹配到 /info 的 location 块，最后重定向到了baidu。</p><p>总结：两次进入 server</p><p>（2）break</p><p>输入：<a href="http://localhost:9000">http://localhost:9000</a></p><p>执行过程：首先，匹配到 /break 的 location 块，执行了 rewrite 和 proxy_pass，跳过 return（因为有 break），重定向到 <a href="http://127.0.0.1:9000/info%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%86%8D%E6%AC%A1%E8%BF%9B%E8%A1%8C">http://127.0.0.1:9000/info；然后，再次进行</a> server 块，匹配到 /info 的 location 块，最后重定向到了baidu。</p><p>总结：两次进入 server</p><p>注意：proxy_pass 最后不要写成<br><a href="http://127.0.0.1:9000/%EF%BC%8C%E5%BA%94%E5%8E%BB%E6%8E%89%E6%9C%80%E5%90%8E%E7%9A%84%E6%96%9C%E6%9D%A0%EF%BC%8C%E8%80%8C%EF%BC%881%EF%BC%89%E7%9A%84%E5%86%99%E6%B3%95%E5%8F%AF%E5%8A%A0%E6%96%9C%E6%9D%A0%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%B8%8D%E5%8A%A0%E6%96%9C%E6%9D%A0%E3%80%82">http://127.0.0.1:9000/，应去掉最后的斜杠，而（1）的写法可加斜杠，也可不加斜杠。</a></p><pre><code>server &#123;        listen 9000;        server_name localhost;        location /info &#123;                rewrite ^/.* https://www.baidu.com permanent;        &#125;        location /break &#123;                rewrite /.* /info;                break;                proxy_pass http://127.0.0.1:9000;                # 该 return 不执行                return 200 &quot;ok&quot;;        &#125;&#125;</code></pre><p>（3）last</p><p>输入：<a href="http://localhost:9000">http://localhost:9000</a></p><p>执行过程：首先，匹配到 /break 的 location 块，执行了 rewrite，跳过 return 和 proxy_pass（因为有 last，proxy_pass 需要和 break 一起用）；然后继续匹配，匹配到 /info 的 location 块，最后重定向到了baidu。</p><p>总结：一次进入 server，两次 location 匹配</p><pre><code>server &#123;        listen 9000;        server_name localhost;        location /info &#123;                rewrite ^/.* https://www.baidu.com permanent;        &#125;        location /break &#123;                rewrite /.* /info last;                # 该 proxy_pass 不执行                proxy_pass http://127.0.0.1:9000;                # 该 return 不执行                return 200 &quot;ok&quot;;        &#125;&#125;</code></pre><h3 id="二、proxy-pass">二、proxy_pass</h3><p>1、proxy_pass 的特点</p><p>（1）代理作用，由代理服务器发起重定向请求；</p><p>（2）proxy_pass 重写的 url 中包含 path 时，会替换 location 块的匹配规则。</p><ul><li><p><a href="http://example.com/api/data">http://example.com/api/data</a> 会被代理到 <a href="http://127.0.0.1/proxy/data">http://127.0.0.1/proxy/data</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location <span class="regexp">/api/</span> &#123;</span><br><span class="line">    proxy_pass http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/proxy/</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><a href="http://example.com/api/data">http://example.com/api/data</a> 会被代理到 <a href="http://127.0.0.1/proxydata">http://127.0.0.1/proxydata</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location <span class="regexp">/api/</span> &#123;</span><br><span class="line">    proxy_pass http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>/proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><a href="http://example.com/api/data">http://example.com/api/data</a> 会被代理到 <a href="http://127.0.0.1/data">http://127.0.0.1/data</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location <span class="regexp">/api/</span> &#123;</span><br><span class="line">    proxy_pass http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>（3）proxy_pass 中不含path时，则不会发生替换</p><ul><li><p><a href="http://example.com/api/data">http://example.com/api/data</a> 会被代理到 <a href="http://127.0.0.1/api/data">http://127.0.0.1/api/data</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    location <span class="regexp">/api/</span> &#123;</span><br><span class="line">        proxy_pass http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ````</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">（<span class="number">4</span>）与 rewrite 同时存在时，proxy_pass 中的 path 不会替换，相当于不起作用</span><br><span class="line"></span><br><span class="line">*   http:<span class="regexp">//</span>example.com<span class="regexp">/api/</span>data 会被代理到 http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="regexp">/info/</span>data</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>location /api/ {<br>rewrite /api/(.*) /info/$1 break;<br>proxy_pass <a href="http://127.0.0.1/proxy/">http://127.0.0.1/proxy/</a>;<br>}</p><pre><code></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>location</title>
      <link href="/posts/5e9e89cb.html"/>
      <url>/posts/5e9e89cb.html</url>
      
        <content type="html"><![CDATA[<h3 id="文章目录">文章目录</h3><ul><li><ul><li><a href="#location_4">一、location 规则</a></li><li><ul><li><a href="#1location_5">1、什么是 location？</a></li><li><a href="#2location_8">2、location 语法规则</a></li><li><a href="#3_20">3、匹配顺序问题</a></li><li><a href="#4location_32">4、location 实例</a></li></ul></li><li><a href="#_103">二、地址重写</a></li><li><ul><li><a href="#1_104">1、什么是地址重写？</a></li><li><a href="#2_107">2、应用场景</a></li><li><a href="#3_114">3、如何使用？</a></li><li><a href="#4rewrite_201">4、rewrite 实例</a></li></ul></li></ul></li></ul><hr><h2 id="一、location-规则">一、location 规则</h2><h3 id="1、什么是-location？">1、什么是 location？</h3><p>nginx 就是通过拦截到的请求去对配置好的 location 块（location block）进行请求代理的。被代理的 URL 去对 location 后边的字符串（或正则）进行匹配，根据一定的规则选择走哪个 location。</p><h3 id="2、location-语法规则">2、location 语法规则</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：location \[=|<span class="string">^~</span>|<span class="string">~</span>|<span class="string">~\*</span>|<span class="string">@\] /uri/ &#123; … &#125;</span></span><br></pre></td></tr></table></figure><p>其中，红色字段为前缀符号，各个前缀符号表达不同的含义。而对于这些前缀符号，分为两类：<strong>普通 location</strong>和<strong>正则 location</strong>。<code>\~</code>和 <code>~*</code>前缀表示正则 location ，其他前缀（比如：<code>=、^~ 和 @</code>）和无任何前缀的都属于普通 location 。</p><p>符号含义</p><p>location = /uri</p><p>= 表示精确匹配，只有完全匹配上才能生效，优先级最高</p><p>location ^~ /uri</p><p>^~ 表示最大前缀匹配，不做正则匹配检查</p><p>location ~ pattern</p><p>~ 表示区分大小写的正则匹配</p><p>location ~* pattern</p><p>~* 表示不区分大小写的正则匹配</p><p>location /</p><p>/ 表示通用匹配，任何未匹配到其它 location 的请求都会匹配到</p><h3 id="3、匹配顺序问题">3、匹配顺序问题</h3><p>匹配之间存在<strong>优先级</strong>：<code>= &gt; ^~ &gt; ~|~* &gt; /</code></p><p><strong>①</strong> 在 nginx 配置文件中一般会定义多个 location，对于一个特定的 HTTP 请求，到底应该匹配哪一个 location 呢（<strong>匹配先后顺序</strong>）？答案是：<strong>先匹配普通 location，再匹配正则 location</strong>。</p><p><strong>②</strong> 那么问题又来了，在<strong>多个普通 location 之间是如何匹配的呢</strong>？答案是：<strong>最大前缀匹配</strong>。什么意思呢？举个例子：对一个 HTTP 请求/www.a.com/nginx/static/test.html进行前缀匹配，&quot; location /nginx/ {} &quot; 和 &quot; location /nginx/static/ {} &quot; 两个都满足，根据我们所说的最大前缀匹配，所以选择&quot; location /nginx/static/ {} &quot;。</p><p><strong>③</strong> 同样，<strong>多个正则 location 之前如何匹配的呢</strong>？答案是：<strong>按照正则 location 在配置文件中的顺序，如果匹配到一条正则 location，那么就不再考虑后面的规则</strong>。</p><p><strong>④</strong> 在普通 location 进行了最大前缀匹配后，如果匹配到了一条 location，并不意味着结束，这只是作为<strong>临时的结果</strong>，nginx 还要继续检查后面的正则 location，如果正则 location 也有匹配上的，那么正则 location 会<strong>覆盖</strong>普通 location。</p><p><strong>⑤</strong> 但是你想在<strong>匹配到普通 location 后，不再需要继续匹配</strong>也是可以的。你只需要在普通 location 前加上 &quot; ^~ &quot;（^表示非，~表示正则）或 &quot; = &quot;（严格匹配），都可以终止后面的匹配。</p><h3 id="4、location-实例">4、location 实例</h3><p>配置文件中<strong>location 块</strong>的解释：</p><pre><code>########### 每个指令必须有分号结束。#################location  [=|^~|\~|\~*|@] &#123;           #root path;  #根目录           #index test.html;  #设置默认页           #proxy_pass  http://mysvr;  #转发动态请求到后端应用服务器        &#125;</code></pre><p>这里我们修改虚拟主机 a 的配置进行演示。</p><pre><code>[root@nginx-server ~]# vim /etc/nginx/conf.d/a.confserver &#123;    listen 192.168.140.142:80;    server_name www.a.com;    access_log /data/a/log/access.log combined;    location / &#123;        echo &quot;A_rule /&quot;;    &#125;    location =/ &#123;        echo &quot;B_rule = /&quot;;    &#125;    location /1/ &#123;        echo &quot;C_rule /1/&quot;;    &#125;    location /1/2/ &#123;        echo &quot;D_rule /1/2/&quot;;    &#125;    location /1/2/test.html &#123;        echo &quot;E_rule /1/2/test.html&quot;;    &#125;    location ~ \.html$ &#123;        echo &quot;G_rule .html&quot;;    &#125;    location ~* \.png$ &#123;        echo &quot;I_rule all:png&quot;;    &#125;    location ~ \.(gif|jpg|png|js|css)$ &#123;        echo &quot;H_rule gif|jpg|png|js|css&quot;;    &#125;&#125;</code></pre><p>匹配结果是这样的：</p><p><strong>①</strong> 访问 <a href="http://www.a.com/">http://www.a.com/</a> 将精确匹配到 B_rule。</p><p><img src="./images/B_rule.png" alt="在这里插入图片描述"></p><p><strong>②</strong> 访问 <a href="http://www.a.com/1/">http://www.a.com/1/</a> 将精确匹配 C_rule。</p><p><img src="./images/C_rule.png" alt="在这里插入图片描述"><br>  <strong>③</strong> 访问 <a href="http://www.a.com/1/2/">http://www.a.com/1/2/</a> 将最大前缀匹配 D_rule。</p><p><img src="./images/D_rule.png" alt="在这里插入图片描述"></p><p><strong>④</strong> 访问 <a href="http://www.a.com/1/2/index.html">http://www.a.com/1/2/index.html</a> 将首先最大前缀匹配到 D_rule，但是会被后面的正则匹配 G_rule 覆盖。</p><p><img src="./images/G_rule.png" alt="在这里插入图片描述"><br>  <strong>⑤</strong> 访问 <a href="http://www.a.com/test.html">http://www.a.com/test.html</a> 匹配到 E_rule 后，就不再继续匹配。</p><p><img src="./images/E_rule.png" alt="在这里插入图片描述"></p><p><strong>⑥</strong> 访问 <a href="http://www.a.com/test.png">http://www.a.com/test.png</a> 将根据正则 location 顺序匹配到 I_rule。</p><p><img src="./images/I_rule.png" alt="在这里插入图片描述"><br>  <strong>⑦</strong> 访问 <a href="http://www.a.com/3">http://www.a.com/3</a> 都将匹配不上，所以走 A_rule 的默认规则。</p><p><img src="./images/A_rule.png" alt="在这里插入图片描述"></p><h2 id="二、地址重写">二、地址重写</h2><h3 id="1、什么是地址重写？">1、什么是地址重写？</h3><p>Rewrite 又称 URL Rewrite，即 URL 重写，就是把传入 Web 的请求重定向到其他 URL 的过程。</p><h3 id="2、应用场景">2、应用场景</h3><p><strong>① 伪静态化</strong>，是将动态页面显示为静态页面方式的一种技术。理论上，搜索引擎更喜欢静态页面形式的网页，搜索引擎对静态页面的评分一般要高于动态页面。所以，URL Rewrite 可以让我们网站的网页更容易被搜索引擎所收录。<br>  <strong>② 提高安全性</strong>，如果在 URL 中暴露太多的参数，无疑会造成一定量的信息泄漏，可能会被一些黑客利用，对你的系统造成一定的破坏，所以静态化的 URL 地址可以给我们带来更高的安全性。<br>  <strong>③ 美化 URL</strong>，去除一些后缀名或参数串，让网页的地址看起来尽可能简洁明快，有利于反映访问模块内容。<br>  <strong>④ 实现地址跳转、协议跳转、端口跳转。</strong></p><h3 id="3、如何使用？">3、如何使用？</h3><p>Nginx Rewrite 相关指令有<strong>if、rewrite、set、return</strong>等。我们先来认识这些指令以及几个常用的全局变量，再通过实例来深入学习。</p><p>① rewrite 指令</p><p><strong>应用环境：server、location、if；</strong></p><p>**语法：rewrite regex replacement</p><p><strong>flag</strong></p><ul><li>regex：表示使用正则或字符串来匹配相应的地址</li><li>replacement：表示重定向的地址</li><li>flag：标志位，用于控制当匹配到对应的 rewrite 规则后是否继续检查后续的 rewrite 规则，flag 的值可以是：</li></ul><p>flag描述</p><p>last</p><p>本条规则匹配完成后，停止匹配，将重写后的地址重新发起请求进行匹配，浏览器地址栏 URL 地址不变</p><p>break</p><p>本条规则匹配完成后，停止匹配，不再匹配后面的规则</p><p>redirect</p><p>返回 302 临时重定向，地址栏会显示跳转后的地址</p><p>permanent</p><p>返回 301 永久重定向，地址栏会显示跳转后的地址</p><p><strong>redirect 与 permanent 区别：</strong> 对于客户端来说一般状态下是没有区别的。而对于搜索引擎，相对来说 301 的重定向更加友好，如果我们把一个地址采用 301 跳转方式跳转的话，搜索引擎会把老地址的相关信息带到新地址，同时在搜索引擎索引库中彻底废弃掉原先的老地址。使用 302 重定向时，搜索引擎(特别是 google)有时会查看跳转前后哪个网址更直观，然后决定显示哪个，如果它觉的跳转前的 URL 更好的话，也许地址栏不会更改，那么很有可能出现 URL 劫持的现像。在做 URI 重写时，有时会发现 URI 中含有相关参数，如果需要将这些参数保存下来，并且在重写过程中重新引用，可以使用 <strong>() 和 $N</strong> 的方式来解决。</p><p>② if 指令（判断语句）</p><p><strong>应用环境：server、location；</strong></p><p><strong>语法：if (condition) { … }</strong></p><p>其中 condition 就是条件，如果为 true，则执行大括号中的内容。if 支持的条件判断匹配符号如下：</p><p>条件判断匹配符</p><p><strong>=</strong>   <strong>!=</strong></p><p>比较变量和字符串是否相等/相同</p><p><strong>~</strong></p><p>匹配正则表达式（区分大小写）</p><p><strong>~*</strong></p><p>匹配正则表达式（不区分大小写）</p><p><strong>!~</strong>   <strong>!~*</strong></p><p>可以理解为&quot;与正则表达式不匹配时返回真&quot;，与上面同理，一个区分大小写，一个不区分大小写；</p><p><strong>-f</strong>   <strong>!-f</strong></p><p>判断文件是否存在</p><p><strong>-d</strong>  <strong>!-d</strong></p><p>判断目录是否存在</p><p><strong>-e</strong>   <strong>!-e</strong></p><p>判断文件或目录是否存在</p><p><strong>-x</strong>   <strong>!-x</strong></p><p>判断文件是否可执行</p><blockquote><p>tip：当表达式只是一个变量时，如果值为空或任何以 0 开头的字符串都会当做 false。</p></blockquote><p>③ set 指令（定义一个新的变量）</p><p><strong>应用环境：server、location、if；</strong></p><p><strong>语法：set variable_name value</strong></p><ul><li>variable_name：变量名称</li><li>value：变量值</li></ul><p>④ return 指令（结束执行配置语句并为客户端返回状态码）</p><p><strong>语法：return code</strong></p><ul><li>code：状态码，可以是 204，400，402-406，408，410，411，413，416，500-504，默认返回 None。</li></ul><p>⑤ 常用全局变量</p><p>全局变量解释</p><p>$host</p><p>请求信息中的&quot;Host&quot;，如果请求中没有 Host 行，则等于设置的服务器名</p><p>$request_filename</p><p>当前请求的文件路径，由 root 指令所指定的根目录和请求的 uri 组成</p><p>$request_uri</p><p>当前请求的文件路径，请求的 uri</p><p>你肯定看不懂，我们来测试一下，你就会明白！</p><pre><code>[root@nginx-server ~]# vim /etc/nginx/conf.d/a.confserver &#123;    listen 192.168.140.142:80;    server_name www.a.com;    access_log /data/a/log/access.log combined;    location / &#123;        root /data/a/basic;    #根目录        echo $host;        echo $request_filename;        echo $request_uri;    &#125;&#125;</code></pre><p><img src="./images/aaa.png" alt="在这里插入图片描述"></p><h3 id="4、rewrite-实例">4、rewrite 实例</h3><p>之前在配置虚拟主机时，已经配置过域名解析，所以可以直接用 windows 上的浏览器进行测试。</p><p><strong>①</strong> 访问：<a href="http://www.a.com/111/1.html">http://www.a.com/111/1.html</a><br>    跳转：<a href="http://www.a.com/222/2.html">http://www.a.com/222/2.html</a></p><pre><code> location /111/ &#123;        rewrite .* /222/2.html permanent;    &#125;</code></pre><p><strong>②</strong> 访问：<a href="http://www.a.com/2015/aaa/bbb/1.html">http://www.a.com/2015/aaa/bbb/1.html</a><br>    跳转：<a href="http://www.a.com/2014/aaa/bbb/1.html">http://www.a.com/2014/aaa/bbb/1.html</a></p><pre><code>location /2015/ &#123;        rewrite ^/2015/(.*)$ /2014/$1 permanent;    &#125;</code></pre><p><strong>③</strong> 访问：<a href="http://www.a.com/">http://www.a.com/</a><br>    跳转：<a href="http://www.b.com/">http://www.b.com/</a></p><pre><code>if ($host ~* www.a.com) &#123;        rewrite .* http://b.com permanent;    &#125;</code></pre><p><strong>④</strong> 访问：<a href="http://www.a.com/aaa/1.html">http://www.a.com/aaa/1.html</a><br>    跳转：<a href="http://www.b.com/aaa/1.html">http://www.b.com/aaa/1.html</a></p><pre><code>    if ($host ~* www.a.com) &#123;        rewrite .* http://b.com$request_uri permanent;    &#125;</code></pre><p><strong>⑤</strong> 在访问目录后添加/ (如果目录后已有/，则不加/)<br>    访问：<a href="http://www.a.com/aaa">http://www.a.com/aaa</a><br>    跳转：<a href="http://www.a.com/aaa/">http://www.a.com/aaa/</a></p><pre><code>if (-d $request_filename) &#123;        rewrite ^(.*)([^/])$ http://$host$1$2/ permanent;    &#125;</code></pre><p><strong>⑥</strong> 访问：<a href="http://www.a.com/login/1.html">http://www.a.com/login/1.html</a><br>    跳转：<a href="http://www.a.com/reg/login.php?user=1">http://www.a.com/reg/login.php?user=1</a></p><pre><code>location /login/ &#123;        rewrite ^/login/(.*).html$ /reg/login.php?user=$1 permanent;    &#125;</code></pre><p><strong>⑦</strong> 访问：<a href="http://www.a.com/uplook/11-22-33.html">http://www.a.com/uplook/11-22-33.html</a><br>    跳转：<a href="http://www.a.com/uplook/11/22/33.html">http://www.a.com/uplook/11/22/33.html</a></p><pre><code>location /uplook/ &#123;        rewrite ^/uplook/([0-9]+)-([0-9]+)-([0-9]+)\.html$ /uplook/$1/$2/$3.html permanent;    &#125;</code></pre><p><strong>⑧</strong> 访问：<a href="http://jack.a.com">http://jack.a.com</a><br>    跳转：<a href="http://www.a.com/jack">http://www.a.com/jack</a></p><p>这里需要配置域名解析。<br>   记事本打开&quot;C:\Windows\System32\drivers\etc\hosts&quot;文件，在末尾添加&quot;192.168.140.142 <a href="http://jack.a.com">jack.a.com</a>&quot; 。</p><pre><code>if ($host ~* &quot;^www.a.com$&quot; ) &#123;    #如果没有这一条配置，http://jack.a.com重写为http://www.a.com/jack会继续来匹配，导致跳转为http://www.a.com/www。    break;    &#125;if ($host ~* ^(.*)\.a\.com$) &#123;        set $user $1;        rewrite .* http://www.a.com/$user permanent;    &#125;</code></pre><p><strong>⑨</strong> 实现端口跳转<br>    访问：80<br>    跳转：443</p><pre><code>server &#123;    listen 80;    server_name www.a.com;    return 301 https://www.a.com$request_uri;&#125;server &#123;    listen 443 ssl;    server_name www.a.com;    ssl on;    #nginx 1.15及以后的版本，不需要再写 ssl on;    ssl_certificate /usr/local/nginx/conf/cert.pem;    ssl_certificate_key /usr/local/nginx/conf/cert.key;:&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021下半年上午题</title>
      <link href="/posts/3d1cd463.html"/>
      <url>/posts/3d1cd463.html</url>
      
        <content type="html"><![CDATA[<p><strong>寻址</strong></p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">寻址方式就是处理器根据指令中给出的地址信息来寻找有效地址</span><br><span class="line">的方式，是确定本条指令的数据地址的方法。包括：</span><br><span class="line"> 立即寻址：指令的地址字段指出的不是操作数的地址，而是操</span><br><span class="line">作数本身，这种寻址方式称为立即寻址。</span><br><span class="line"> 直接寻址：指令的地址字段直接指出操作数在内存的地址。由</span><br><span class="line">于操作数的地址直接给出而不需要经过某种变换，所以称这种</span><br><span class="line">寻址方式为直接寻址方式。</span><br><span class="line"> 寄存器寻址：指令中给出的操作数地址不是内存的地址单元，</span><br><span class="line">而是<span class="meta">CPU</span>的通用寄存器的编号。</span><br></pre></td></tr></table></figure><p><strong>.PCI总线是并行内总线，SCSI总线是串行内总线</strong><br><img src="images/RISC-CISC.png" alt="PCI-SCSI.png"></p><p><strong>中断</strong></p><ul><li>程序中断IO</li><li>直接存储器访问DMA<br><img src="images/zhongduan.png" alt="zhongduan.png"></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">中断向量提供中断服务程序入口地址</span><br></pre></td></tr></table></figure><p><strong>浮点数表示</strong><br>N=基数^阶码 * 尾数</p><p><strong>AES是一种分组加密算法</strong><br><img src="images/AES.png" alt="AES.png"></p><p><strong>用于远程登陆或控制</strong><br>SSH<br>Telnet<br>RFB</p><p><strong>包过滤防火墙对网络层的数据报文进行检查</strong></p><p><strong>防火墙</strong></p><ul><li>内网、外网和DMZ三个区域</li><li>受保护程度从低到高: 外网、DMZ和内网</li></ul><p><strong>分层数据流图（DFD）</strong></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">构造分层DFD时需要注意的问题：</span><br><span class="line"><span class="comment">(1)</span>适当命名。DFD中的每个数据流、加工、数据存储、外部实体</span><br><span class="line">都应被适当地命名。</span><br><span class="line"><span class="comment">(2)</span>画数据流而不是控制流。数据流图强调的是数据流而不是控制流。</span><br><span class="line"><span class="comment">(3)</span>避免一个加工有过多的数据流。</span><br><span class="line"><span class="comment">(4)</span>分解尽可能均匀。</span><br><span class="line"><span class="comment">(5)</span>先考虑确定状态，忽略琐碎的细节。</span><br><span class="line"><span class="comment">(6)</span>随时准备重画。</span><br></pre></td></tr></table></figure><p><img src="images/%E9%A3%8E%E9%99%A9%E7%9B%91%E6%B5%8B.png" alt="风险监测.png"></p><p><strong>软件项目的活动图</strong><br><img src="images/%E8%BD%AF%E4%BB%B6%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%B4%BB%E5%8A%A8%E5%9B%BE.png" alt="软件项目的活动图.png"><br>关键路径是项目计划中最长的一套路径，通俗点说因为关键路径最长，所以只有保证它做完了，才能保证项目做完了，所以说它最“关键”。</p><p>关键节点: 活动的时差为0<br>算“最早时间”时，从左到右算，两数取大<br>算“最晚时间”时，用最近的节点减去边。例如F=J-5=14-5=9<br>最早时间=最晚时间，的全部点去找关键路径<br>冗余时间等于最早最晚两者的差<br>最少时间 = 最长序列(一个项目时间最长的活动序列，决定项目最短工期)</p><p>以下几种情况解答:</p><ol><li>同一开发人完成,则把相应边的时常改为 两边之和，再根据关键路径求完成项目最少时间</li><li>计算活动松弛时间？</li></ol><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">松弛时间 <span class="operator">=</span> 最少时间 - 包含该任务的关键路径花的时间</span><br></pre></td></tr></table></figure><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">公式</span><br><span class="line">ES 持续时间 EF</span><br><span class="line"></span><br><span class="line">LS 总时差   <span class="keyword">LF</span></span><br></pre></td></tr></table></figure><p><strong>二叉树表示的算术表达式</strong></p><ul><li>对二叉树的中根排序(左根右)</li></ul><p><strong>符号表管理</strong><br><img src="images/fuhaobiao.png" alt="fuhaobiao.png"></p><p><strong>非确定有限自动机(NFA)</strong></p><p><strong>调度算法</strong></p><p><strong>前驱图</strong></p><blockquote><p>前驱图是一种用来描述程序（或进程）之间先后执行顺序的有向无环图(简称DAG, Directed Acyclic Graph)。前趋图由结点和有向边两部分组成，每个结点表示一个程序、进程、程序段或者一条语句，结点间的有向边表示结点之间的前驱关系。从结点Si到结点Sj的有向边表示它们的前趋关系，记为Si→Sj,即Si和Sj应顺序执行,Sj仅在Si执行完成后才能开始执行。</p></blockquote><ul><li>根据前趋图有向边设信号量S</li><li>定义信号量并赋初始值为0(起始不插入P、结束不插入V)</li><li>将信号量从小到大依次排列在图中<br><img src="images/qianqutu.png" alt="qianqutu.png"></li></ul><p><strong>磁盘数据存储</strong></p><ul><li>画磁道</li><li>标记扇区</li></ul><p><strong>增量模型优点</strong></p><ul><li>缺点：系统管理成本低、效率高、配置简单</li></ul><p><strong>敏捷统一过程(AUP)</strong><br>敏捷统一过程(AUP)采用&quot;在大型上连续&quot;以及在&quot;小型上迭代&quot;<br>的原理来构建软件系统。采用经典的UP阶段性活动(初始、精化、<br>构建和转换) ，提供了一系列活动，能够使团队为软件项目构想出<br>一个全面的过程流</p><p><strong>ISO/IEC软件质量模型</strong><br><img src="images/ISO_IEC.png" alt="ISO_IEC.png"></p><p><strong>语句覆盖</strong></p><ul><li>程序环路复杂性</li><li>McCabe度量法计<br><img src="images/%E7%8E%AF%E8%B7%AF%E5%A4%8D%E6%9D%82%E5%BA%A6.png" alt="环路复杂度.png"></li></ul><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">```</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="strong">**系统可维护性**</span></span><br><span class="line">可理解性</span><br><span class="line">可测试性</span><br><span class="line">可修改性</span><br><span class="line"></span><br><span class="line"><span class="strong">**面向对象设计时包含的主要活动**</span></span><br><span class="line">认定对象，组织对象，描述对象间的相互作用，确定对象的操作</span><br><span class="line"></span><br><span class="line">![面向对象设计原则.png](images/面向对象设计原则.png)</span><br><span class="line"></span><br><span class="line">![组合-聚合.png](images/组合-依赖.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**UML状态图**</span></span><br><span class="line"><span class="bullet">- </span>[] 中代表监护条件</span><br><span class="line"><span class="bullet">- </span>非[] 中内容代表状态转变</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">例如：拉群进行沟通</span><br><span class="line">![中介者模式.png](images/中介者模式.png)</span><br><span class="line">行为型对象</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**关系模式**</span></span><br><span class="line"><span class="bullet">- </span>候选码：关系中的一个属性或属性组的值能唯一标识一个原子、但其真子集不能唯一标识一个原子</span><br><span class="line"><span class="bullet">- </span>真子：元素本身</span><br><span class="line">求选项闭包、看是否包括所有属性、并且真子集不能包括所有属性</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**顺序栈**</span></span><br><span class="line">栈满条件 <span class="code">`top[1] - top[2] === 1`</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**循环队列**</span></span><br><span class="line">&gt; 一端插入、一端删除的线性表</span><br><span class="line">入队和出队操作都不需要移动队列中的其他元素</span><br><span class="line">避免出现队列满的情况</span><br><span class="line">避免出现队列空的情况</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**二叉树**</span></span><br><span class="line">![erchashu.png](images/erchashu.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**序列-堆**</span></span><br><span class="line">&gt; 某一个节点的值总是不大于或不小于 其父节点的值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**有向图DAG进行拓扑排序得到的拓扑序列中**</span></span><br><span class="line">有向图中所有的边都要体现在拓扑排序中</span><br><span class="line">所有有向边均要从前边元素指向后边元素</span><br><span class="line"></span><br><span class="line"><span class="strong">**归并排序算法**</span></span><br><span class="line">![归并排序算法.png](images/归并排序算法.png)</span><br><span class="line"><span class="bullet">- </span>采用了分治算法策略</span><br><span class="line"><span class="bullet">- </span>logaN=b == a的b次幂</span><br><span class="line"><span class="bullet">- </span>最好、最坏均为 nlog2N</span><br><span class="line"></span><br><span class="line"><span class="strong">**Huffman编码**</span></span><br><span class="line"><span class="bullet">- </span>首先找出频率最小的两个, <span class="code">`小左大右和为根`</span> 构建二叉树</span><br><span class="line"><span class="bullet">- </span>左子树边为0，右子树边为1</span><br><span class="line"><span class="bullet">- </span>计算字符位置(从根到它的位置)，码长即字符的二进制位数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**ARP**</span></span><br><span class="line"><span class="bullet">- </span>将IP地址解析为mac地址</span><br><span class="line"><span class="bullet">- </span>ARP Request 广播</span><br><span class="line"><span class="bullet">- </span>ARP Response 单播</span><br><span class="line"></span><br><span class="line"><span class="strong">**路由协议**</span></span><br><span class="line">&gt; 路由选择协议，不进行数据包的传输</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>-&gt; 代表决定</p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**浮点数**</span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">N = 基数^阶码*尾数</span></span><br></pre></td></tr></table></figure><p>-306.4 = -0.3065 * 10^3</p><ul><li>是符号<br>阶码即指数/幂<br>基数取决于 浮点数用何种进制表示<br>小数部分也称为尾数, 尾数表示浮点数的精度<br>(因为他可以表示为-3.065102 也可以表示为-0.03065104 等，小数部分可以左右“浮动” 但不管小数部分怎么移动，他的有效值是不变的，都是3065 （不过尾数是变化的）)</li></ul><pre><code>![浮点数.png](images/浮点数.png)源码反码补码**待讲解问题**6(浮点数)</code></pre>]]></content>
      
      
      <categories>
          
          <category> 软考 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022上半年上午真题</title>
      <link href="/posts/85a0b306.html"/>
      <url>/posts/85a0b306.html</url>
      
        <content type="html"><![CDATA[<p><strong>存储器SRAM\DRAM</strong><br>DRAM集成率高，功率大、需要动态刷新<br><img src="images/%E5%AD%98%E5%82%A8%E5%99%A8.png" alt="存储器.png"></p><p><strong>RISC和CISC</strong><br><img src="images/RISC-CISC.png" alt="RISC-CISC.png"></p><p><strong>系统的可靠性</strong></p><p>串行：R= R1 × R2 …. ×Rn<br>并行： R= 1-(1-R1)×(1-R2)×…×(1-Rn)</p><p><strong>信息交换</strong><br>CPU与l/O接口异步交换信息</p><p><strong>文件安全传输</strong><br>SFTP (SSH File Transfer Protocol,安全文件传送协议)，是一种基于<br>SSH(安全外壳)的安全的文件传输协议，在文件传输过程中提供一<br>种安全的加密算法，从而保证数据的安全传输。</p><p><strong>计算机病毒</strong><br>A.永恒之蓝<br>B.蠕虫<br>C.特洛伊木马</p><p>*通过在出口防火墙上配置<code>ACL</code>功能，可以阻止外部未授权用户访<br>问内部网络</p><p>*部署入侵检测系统阻断攻击不能够有效防御SQL注入</p><p><strong>商标权的保护期限是可以延长</strong><br>A.著作权<br>B.专利权<br>C.商标权<br>D.商业秘密权</p><p><strong>边界值分析 测试法</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">动态绑定：程序运行过程中，把函数（或过程）调用与响应调用所需要的代码相结合的过程称为动态绑定。</span><br><span class="line">静态绑定是指在程序编译过程中，把函数（方法或者过程）调用与响应调用所需的代码结合的过程称为静态绑定。</span><br></pre></td></tr></table></figure><p><strong>面向对象系统设计原则</strong></p><blockquote><p>面向对象程序设计语言为面向对象实现<br>单一职责原则：设计目的单一的类。<br>无环依赖原则：在包的依赖关系图中不允许存在环，即包之间的结构必须是一个直接的无环图形。<br>依赖倒置原则：要依赖于抽象，而不是具体实现；针对接口编程，不要针对实现编程。<br>里氏替换原则：子类可以替换父类。</p></blockquote><p><img src="images/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%88%86%E6%9E%90.png" alt="面向对象分析.png"></p><p><strong>Python概念</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">不可变数据(<span class="number">3</span>个)：<span class="built_in">Number</span>(数字)、<span class="built_in">String</span>(字符串)、<span class="built_in">Tuple</span>(元组)。</span><br><span class="line">可变数据(<span class="number">3</span>个)：<span class="built_in">List</span>(列表)、<span class="built_in">Dictionary</span>(字典)、<span class="built_in">Set</span>(集合)。</span><br><span class="line">⚫ <span class="built_in">tuple</span>(元组)，类似于List列表，元组用 () 标识。内部元素用逗号隔开。但</span><br><span class="line">是元组不能二次赋值，相当于只读列表。</span><br><span class="line">⚫ <span class="built_in">list</span>(列表)，可以完成大多数集合类的数据结构实现。它支持字符，数字，</span><br><span class="line">字符串甚至可以包含列表（即嵌套或叫多维列表，用来表示多维数组）。</span><br><span class="line">列表用 <span class="selector-attr">[]</span> 标识，是 Python 最通用的复合数据类型。</span><br><span class="line">⚫ <span class="built_in">dict</span>(字典)，是除列表以外python之中最灵活的内置数据结构类型；列表</span><br><span class="line">是有序的对象集合，字典是无序的对象集合；字典用&#123; &#125;标识；字典由索</span><br><span class="line">引(key)和它对应的值value组成。</span><br><span class="line">⚫ <span class="built_in">set</span>(集合)，集合中的元素是无序和唯一的，它主要用于进行关系测试和</span><br><span class="line">消除重复元素。可以使用大括号 &#123; &#125; 或者 <span class="built_in">set</span>() 函数创建集合。</span><br></pre></td></tr></table></figure><p>user1视图对应user1 视图定义</p><p><strong>自然连接</strong><br><img src="images/%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5.png" alt="自然连接.png"></p><ul><li>右相同属性组才能做自然连接</li><li>结果中去除重复的属性列</li><li>等价条件<ul><li>列数相同</li><li>关系一致</li></ul></li></ul><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">案例：</span><br><span class="line">关系<span class="variable">R</span><span class="punctuation">(</span><span class="variable">A</span><span class="operator">,</span> <span class="variable">B</span><span class="operator">,</span> <span class="built_in">C</span><span class="operator">,</span> <span class="built_in">D</span><span class="punctuation">)</span>和关系<span class="variable">S</span><span class="punctuation">(</span><span class="variable">A</span><span class="operator">,</span> <span class="built_in">D</span><span class="operator">,</span> <span class="built_in">E</span><span class="operator">,</span> <span class="variable">F</span><span class="punctuation">)</span></span><br><span class="line">自然连接运算<span class="variable">R</span> <span class="operator">`&gt;&lt;</span> <span class="operator">`</span><span class="variable">S</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="variable">A</span><span class="operator">,</span> <span class="variable">B</span><span class="operator">,</span> <span class="built_in">C</span><span class="operator">,</span> <span class="built_in">D</span><span class="operator">,</span> <span class="built_in">E</span><span class="operator">,</span> <span class="variable">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">*</span>σ<span class="number">2</span><span class="operator">&gt;</span><span class="number">8</span><span class="punctuation">(</span><span class="variable">R</span>×<span class="variable">S</span><span class="punctuation">)</span>笛卡尔集不去除重复列<span class="operator">*</span></span><br><span class="line">Π<span class="punctuation">[</span><span class="number">1</span><span class="operator">,</span><span class="number">2</span><span class="operator">,</span><span class="number">3</span><span class="operator">,</span><span class="number">4</span><span class="operator">,</span><span class="number">7</span><span class="operator">,</span><span class="number">8</span><span class="punctuation">]</span><span class="punctuation">(</span>σ <span class="number">1</span><span class="operator">=</span><span class="number">5</span>∩<span class="number">2</span>＞<span class="number">8</span>∩<span class="number">4</span><span class="operator">=</span><span class="number">6</span><span class="punctuation">(</span><span class="variable">R</span>×<span class="variable">S</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>排序算法</strong><br><img src="images/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95.png" alt="排序算法.png"></p><p><strong>OSI参考模型</strong><br><img src="images/OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B.png" alt="OSI参考模型.png"></p><p><strong>线性Hash表</strong><br><img src="images/%E7%BA%BF%E6%80%A7Hash%E8%A1%A8.png" alt="线性Hash表.png"></p><blockquote><p>用线性探测法解决冲突容易产生聚集问题</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">注意事项:</span><br><span class="line"><span class="bullet">1.</span> 关键码 对 哈希表表长取余 确定其在Hash表中的位置</span><br><span class="line"><span class="bullet">2.</span> 线性探测法的话还需注意：</span><br><span class="line">  a. 位置被占时需依次查找后续位置</span><br><span class="line">  b. 同义词：通过hash函数计算后，结果相同的关键码</span><br><span class="line"><span class="bullet">3.</span> 装填因子：表中装入的关键字除以哈希表长</span><br><span class="line"></span><br><span class="line">特殊：用链地址法解决冲突可确保平均查找长度为大于1</span><br></pre></td></tr></table></figure><p><strong>折半查找(即二分查找)</strong></p><ul><li>平衡二叉树: 左右两颗子树的高度差绝对值不超过1</li><li>哈夫曼树：</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例如： 1, 5, 7, 9, 11</span><br><span class="line"><span class="bullet">1.</span> 确定中间点，确定查询内容与中间节点的大小，比中间节点小查左半边，比中间节点大查右半边</span><br></pre></td></tr></table></figure><p><strong>树度T</strong></p><ul><li>树中子节点个数称为节点的度</li><li>结点的度中的最大值称为树的度</li><li>叶子节点：表示没子节点，度为0<br><img src="images/%E6%A0%91%E5%BA%A6.png" alt="树度.png"></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">7</span>+<span class="number">5</span>+<span class="number">8</span>+<span class="number">10</span>+n-<span class="number">1</span> = <span class="number">4</span>*<span class="number">7</span>+<span class="number">3</span>*<span class="number">5</span>+<span class="number">2</span>*<span class="number">8</span>+<span class="number">10</span>+<span class="number">0</span>*n</span><br><span class="line"><span class="attribute">n</span> -&gt; <span class="number">40</span></span><br></pre></td></tr></table></figure><p><strong>在TCP/IP协议栈中，远程登录采用的协议 TELNET</strong></p><p><strong>邻接表</strong></p><ul><li>顶点表节点</li><li>边表节点</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据边表节点个数推断顶点表节点个数</span><br></pre></td></tr></table></figure><p><img src="images/%E9%82%BB%E6%8E%A5%E8%A1%A8.png" alt="邻接表.png"></p><p><strong>待讲题目</strong></p>]]></content>
      
      
      <categories>
          
          <category> 软考 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021下半年下午真题</title>
      <link href="/posts/49a2ecac.html"/>
      <url>/posts/49a2ecac.html</url>
      
        <content type="html"><![CDATA[<p><strong>1</strong><br>问题一、二答题技巧[0层数据流图]</p><ol><li>根据P加工 推测实体E的名称</li><li>根据D节点输入推测 表D的名称</li></ol><p>问题三 答题技巧<br>数据流缺失从以下3方面查找</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 父子图平衡</span><br><span class="line"><span class="bullet">  -</span> 数量一致(eg: 边上描述信息要匹配)</span><br><span class="line"><span class="bullet">  -</span> 流向一致(eg: 父图中从系统流出则子图也应从系统流出,父图中指向系统、子图也指向系统) </span><br><span class="line"><span class="bullet">  -</span> 注意:: 确认上下文数据流图、0层数据流图 交界处内容是否一致!!!</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> 加工(P)要有输入、输出</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> 数据守恒</span><br><span class="line"><span class="bullet">  -</span> 输入</span><br><span class="line"><span class="bullet">  -</span> 加工输出(上个加工输出作为下个加工的输入)</span><br><span class="line"><span class="bullet">  -</span> 注意:: 结合描述文字确认!!!</span><br><span class="line"></span><br><span class="line">上下文数据流图</span><br><span class="line"><span class="bullet">  -</span> 圈里是系统、圈外是实体(E1 - E4)</span><br><span class="line">0层数据流图</span><br><span class="line"><span class="bullet">  -</span> E1 - E4放圈外、圈内为加工</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>问题四答题技巧<br>描述中 <code>数据处理</code> 分解为哪些子加工？</p><ol><li>对实时监测信息进行处理</li><li>对历史实时监测信息进行处理</li><li>可视化存储</li></ol><p>进一步分解需要注意啥？</p><ol><li>给的输入不一定能支撑输出(如：分析结果 + 规则 = 控制指令)</li></ol><p><strong>2</strong><br>设计数据库表 - 汽车管理系统</p><p>完成实体联系图-答题技巧</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 根据描述确定实体属性及(关联关系)</span><br><span class="line"><span class="bullet">2.</span> 关联关系: 主键、外建、组合外键(多个外键)</span><br><span class="line"><span class="bullet">3.</span> 关联关系转换</span><br><span class="line">eg:</span><br><span class="line">维修工和维修单之间的联系类型发生变化 (1:n -&gt; n:n)</span><br></pre></td></tr></table></figure><p><strong>3</strong><br>用例图</p><blockquote><p>描述系统功能的、根据用户需求绘制用例图、处在需求分析阶段[用例是对系统行为的动态描述]</p></blockquote><p>类图</p><ul><li>虚线: 代表依赖关系</li><li>实心菱形箭头: 代表组合关系</li><li>空心菱形箭头: 聚合关系(整体和部分的关系、有不同生命周期)</li><li>空心三角箭头: 代表泛化关系</li></ul><p><strong>4</strong><br>编辑距离：将一个字符串变换为另一个字符所需的最小操作次数</p>]]></content>
      
      
      <categories>
          
          <category> 软考 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022上半年下午真题</title>
      <link href="/posts/a738c1b4.html"/>
      <url>/posts/a738c1b4.html</url>
      
        <content type="html"><![CDATA[<p><strong>1</strong><br>数据流缺失从以下3方面查找</p><ol><li>父子图 平衡</li><li>加工要有输入、输出</li><li>数据守恒</li></ol><p>上下文数据流图</p><ul><li>圈里是系统、圈外是实体(E1 - E4)<br>0层数据流图</li><li>E1 - E4放 圈外</li></ul><p><strong>2</strong><br>设计数据库表</p><p><strong>3</strong><br>空心箭头 代表 泛化</p><p>U1: 员工姓氏<br>U2: 员工邮编地址</p><p>U4 extend 扩展 U5<br>一个用例混合了两种或两种以上不同的场景、就要分为 主用例和辅助用例<br>箭头指向主用例<br>场景：<br>会员打8折<br>非会员全价<br>主用例: 付费<br>子用例: 打折</p><p>include 包含</p><p>菱形实心箭头</p><ul><li>组合关系</li></ul><p><strong>4</strong><br>矩阵相乘 - C语言算法<br>const[i][j]: 最优计算的计算代价</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">动态规划算法</span><br><span class="line">适用矩阵链乘(从k处断开)</span><br><span class="line"></span><br><span class="line">时间复杂度： 取决于<span class="keyword">for</span>循环嵌套层数</span><br><span class="line">O(n^n)</span><br><span class="line"></span><br><span class="line">A1: 15<span class="number">*5</span>、A2：5<span class="number">*10</span>、A3: 10<span class="number">*20</span>、A4：20<span class="number">*25</span></span><br><span class="line">笨办法求 最优计算顺序</span><br><span class="line">(A1<span class="number">*A2</span>)<span class="number">*A3</span><span class="number">*A4</span></span><br><span class="line">15<span class="number">*5</span><span class="number">*10</span> + 15<span class="number">*10</span><span class="number">*20</span> + 15<span class="number">*20</span><span class="number">*25</span></span><br></pre></td></tr></table></figure><p><strong>5</strong><br>备忘录</p><p>Originator: 创建备忘录并在 memento 中存储状态</p><p>Memento: 备忘录(包含被恢复的状态)</p><p>Caretaker:  负责从 memento 中恢复状态</p><ul><li>找属性</li><li>找方法</li></ul><p>vector: 容器、存放</p><p><strong>题目6</strong><br>在软件系统中，通常都会给用户提供取消、不确定或者错误的操作，允许将系统恢复到原先的状态。现使用备忘录（Memento）模式实现该要求，得到如图6-1所示的类图。</p><p>memento包含了要被恢复的状态。originator创建并在Memento中存储状态。CareTaker负责从Memento中恢复状态。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Memento</span><span class="params">(String state)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.state = state;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.state = state;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Memento <span class="title function_">saveStateToMemento</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1</span>) ;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getStateFromMemento</span><span class="params">(Memento Memento)</span> &#123;</span><br><span class="line">    state = (<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CareTaker</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Memento&gt; mementoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Memento&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> (<span class="number">3</span>) &#123;</span><br><span class="line">    mementoList.add(state);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> (<span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> mementoList.get(index);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MementoPaneDemos</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Originator</span> <span class="variable">originator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Originator</span>();</span><br><span class="line">    <span class="type">CareTaker</span> <span class="variable">careTaker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CareTaker</span>();</span><br><span class="line">    originator.setState(<span class="string">&quot;State #1&quot;</span>);</span><br><span class="line">    originator.setState(<span class="string">&quot;State #2&quot;</span>);</span><br><span class="line">    careTaker.add(（<span class="number">5</span>）);</span><br><span class="line">    originator.setState(<span class="string">&quot;State #3&quot;</span>);</span><br><span class="line">    careTaker.add(（<span class="number">6</span>）);</span><br><span class="line">    originator.setState(<span class="string">&quot;State #4&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;Current State：&quot;</span> + originator.getState());</span><br><span class="line">    originator.getStateFromMemento(careTaker.get(<span class="number">0</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;First saved State：&quot;</span> + originator.getState());</span><br><span class="line">    originator.getStateFromMemento(careTaker.get(<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;Second saved State：&quot;</span> + originator.getState());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(1)：new Memento(state) 或 new Memento(this.state)或 new Memento(getState())<br>(2)：Memento.getState()<br>(3)：void add(Memento state)<br>(4)：Memento get(int index)<br>(5)：originator.saveStateToMemento()<br>(6)：originator.saveStateToMemento()</p>]]></content>
      
      
      <categories>
          
          <category> 软考 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSS Libs</title>
      <link href="/posts/93d58299.html"/>
      <url>/posts/93d58299.html</url>
      
        <content type="html"><![CDATA[<h3 id="Tailwind-CSS">Tailwind CSS</h3><blockquote><p>一个功能类优先的 CSS 框架，它集成了诸如 flex, pt-4, text-center 和 rotate-90 这样的的类，它们能直接在脚本标记语言中组合起来，构建出任何设计</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSS2.0</title>
      <link href="/posts/9434c448.html"/>
      <url>/posts/9434c448.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">CSS Bug：css样式在各个浏览器中解析不一致的情况。</span><br><span class="line">CSS Hack：兼容css在不同浏览器中正确现实的技巧。</span><br><span class="line">Filter：一种用来过滤不同浏览器的Hack类型。???等待研究</span><br><span class="line">设计CSS Hack 和 Filter常用的两种方法：</span><br><span class="line">1. 利用浏览器自身的Bug，来隐藏或显示样式或声明</span><br><span class="line">2. 利用浏览器对css支持不完善，如对某些规则或语法还没有形成支持，来隐藏或显示样式</span><br><span class="line"></span><br><span class="line">IE6 及以下常见的CSS解析BUG及hack</span><br><span class="line">1. div中的图片间隙(该bug出现在IE6及更低版本中)</span><br><span class="line">   在div中插入图片时，图片将div下方撑大3px</span><br><span class="line">Hack1：将<span class="tag">&lt;/<span class="name">div</span>&gt;</span>与<span class="tag">&lt;<span class="name">img</span>&gt;</span>写在一行</span><br><span class="line">Hack2：给<span class="tag">&lt;<span class="name">img</span>&gt;</span>添加display:block;</span><br><span class="line">2. 双倍margin边距</span><br><span class="line">当IE6及更低版本的浏览器在解析浮动元素时，会错误的把浮向边边界加倍显示</span><br><span class="line">Hack1：给浮动元素添加声明display：inline;</span><br><span class="line">Hack2:用padding-left来解决</span><br><span class="line">3. 默认高度</span><br><span class="line">在IE6及以下版本中，部分块元素拥有默认高度(设置低于16px高度时，都会按照16px显示)</span><br><span class="line">Hack1：给元素声明：font-size:0px;</span><br><span class="line">Hack2:给元素声明：overflow：hidden;</span><br><span class="line">Hack3:</span><br><span class="line">4. 表单元素行高不一致</span><br><span class="line">Hack：float：left;</span><br><span class="line">5. 按钮元素默认大小不一</span><br><span class="line">Hack1：统一大小/(用a标记模拟)</span><br><span class="line">Hack2：input外边套一个标签，在这个标签里写按钮的样式，把input的边框去掉</span><br><span class="line">Hack3：如果这个按钮是一个图片，直接把图片作为按钮的背景图即可</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">src</span>=<span class="string">&quot;images/new.gif&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image&quot;</span>&gt;</span>---给input去掉样式，固定高度</span><br><span class="line">6. 百分比 bug</span><br><span class="line">在IE6及以下版本中在解析百分比时，会按照四舍五入方式计算从而导致50%加50%大于100%的情况</span><br><span class="line">Hack:两元素同方向浮动并列显示,给后面的元素+清除反方向的浮动 clear：right;</span><br><span class="line">7. li里a加display：block;出现行高不一致</span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;###&quot;</span>&gt;</span>文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>2016-12-26<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">Hack1：给a加display：inline-block; / display:inline;</span><br><span class="line">8. 透明属性</span><br><span class="line">IE浏览器写法：</span><br><span class="line">Filter:alpha(opacity=value) 取值范围 1-100</span><br><span class="line">兼容其他浏览器写法:opacity:.value;(取值范围 0-1)</span><br><span class="line">9. 鼠标指针bug</span><br><span class="line">Cursor属性的hand属性值只有在IE9以下浏览器识别，cursor属性的pointer属性值IE6以上版本及其他浏览器都识别该声明</span><br><span class="line">Hack：cursor:pointer;</span><br><span class="line">10. 过滤器(filter)</span><br><span class="line">语法：选择符&#123;_属性：属性值;&#125;---IE6及更低版本浏览器会解析该属性---用来区分IE6浏览器及其他浏览器</span><br><span class="line">语法：选择符&#123;*属性:属性值;&#125;---该属性能被IE7及以下浏览器识别，其他浏览器忽略该属性的作用.</span><br><span class="line">语法:选择符&#123;属性：属性值!important;&#125;---IE6,IE7不识别此写法</span><br><span class="line">区分IE6和IE7:* _!important *</span><br><span class="line">11. \9 IE版本识别，其他浏览器不识别--IE10 ? IE11 不识别</span><br><span class="line">语法:选择符&#123;属性:属性值\9;&#125;</span><br><span class="line">12. \0 只有IE8版本识别，其他浏览器都不识别</span><br><span class="line">语法:选择符&#123;属性:属性值\0;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">css：cascading  tyle sheets(层叠样式表)，控制网页样式。</span><br><span class="line">**div+css的优点**：</span><br><span class="line">弥补html语言的不足</span><br><span class="line">缩减页面代码，提高页面访问速度</span><br><span class="line">--代码减少，页面文件就少，占用网络宽带就少，客户端打开速度就快，用户体验就会更好。</span><br><span class="line">结构清晰，有利于seo</span><br><span class="line">--有利于搜索引擎优化</span><br><span class="line">--缩短改版时间</span><br><span class="line">--对网站的重构有很好的支持。</span><br><span class="line">css语法：选择器 和声名</span><br><span class="line">选择器&#123;属性：属性值；&#125;</span><br><span class="line">选择器作用：表示要定义样式的对象，可以是元素本身，也可以是一类元素。</span><br><span class="line">引用外部样式表的写法：</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;目标文件路径&quot;</span> <span class="attr">rel</span>=<span class="string">“stylesheet”</span> <span class="attr">type</span>=<span class="string">“text/css”/</span>&gt;</span></span><br><span class="line">rel:</span><br><span class="line">网页划分：</span><br><span class="line">头部：LOGO(公司标志图)</span><br><span class="line">NAV（导航）</span><br><span class="line">banner（广告图）</span><br><span class="line">内容：页面内容栏目</span><br><span class="line">结尾：版权信息。</span><br><span class="line">内部样式表：</span><br><span class="line">语法：<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">css样式表的优先级：</span><br><span class="line">1 内联样式表的优先级最高</span><br><span class="line">2 内部样式表与外部样式表的优先级顺序和书写的顺序有关，后书写的优先级别高。</span><br><span class="line">常用选择器：</span><br><span class="line">标签选择器、类选择器、ID选择器、伪类选择器、群组选择器（集合选择器）、通配符（*）、包含选择器（后代选择器）、伪元素选择器、属性选择器。</span><br><span class="line">伪类选择器：</span><br><span class="line">font：12px/2em</span><br><span class="line">**字体：**12/2倍</span><br><span class="line">font:style weight size family;</span><br><span class="line">简写：font：12px/2em &quot;宋体&quot;;</span><br><span class="line">用于首行缩进</span><br><span class="line">text-indent：数值;</span><br><span class="line">text-transform：控制文本大小</span><br><span class="line">说明：</span><br><span class="line">none（默认）</span><br><span class="line">capitalize：每个单词手写字母大写</span><br><span class="line">uppercase：都为大写</span><br><span class="line">lowercase：都为大写</span><br><span class="line">控制文本流：&#123;layout-flow：horizontal /vertical-ideographic：&#125;</span><br><span class="line">自左向右</span><br><span class="line">自上而下</span><br><span class="line">list-style-type:outside;(定义列表符号位置)</span><br><span class="line">inside:里边</span><br><span class="line">outside：里边</span><br><span class="line">浮动（float）：可以使元素脱离文档流,不占据空间，空间可被其他元素使用空间。</span><br><span class="line">clear：both;</span><br><span class="line">both：清楚元素两边元素</span><br><span class="line">none：允许两边都可以有浮动对象</span><br><span class="line">left：清除元素左边浮动。</span><br><span class="line">right：清除元素右边浮动。</span><br><span class="line">背景图片的位置</span><br><span class="line">background-image：url()left center no-repeat;</span><br><span class="line">background-position：水平位置 垂直位置;</span><br><span class="line">水平位置：left、center、right</span><br><span class="line">垂直位置:top、center、bottom*</span><br><span class="line">**bacground-attachment：scroll(滚动)、fixed(固定)；</span><br><span class="line">固定：不随容器一块滚动</span><br><span class="line">scroll：随容器一块滚动**</span><br><span class="line">background-position：left/center/right  top/center/bottom;</span><br><span class="line">背景简写</span><br><span class="line">background：#00ff00 url(images/mayun.jpg) no-repeat 300px 200px;</span><br><span class="line">**文本溢出</span><br><span class="line">&#123;text-overflow:clip/ellipsis;&#125;</span><br><span class="line">clip：不显示省略号(...)认识加单的裁切.</span><br><span class="line">Ellipsis：当对象溢出文本，显示省略号。</span><br><span class="line">步骤:</span><br><span class="line">1 定义容器宽度：width:value;</span><br><span class="line">2 强制文本在一行显示white-space:nowrap;</span><br><span class="line">3 溢出内容为隐藏：overflow：hidden;</span><br><span class="line">4 溢出问本显示省略号：ellipsis;</span><br><span class="line">容器溢出：</span><br><span class="line">overflow:visible / hidden / scroll / auto;</span><br><span class="line">scroll：当前内容以滚动条显示。</span><br><span class="line">visible:显示  inherit：继承父级样式。</span><br><span class="line">overflow:hidden;正确显示容器区域。</span><br><span class="line"></span><br><span class="line">text-align:left/center/right;（用于文本）</span><br><span class="line">line-height：容器的高度。（垂直居中）**</span><br><span class="line"></span><br><span class="line">盒模型思想：</span><br><span class="line">划分网页为不同的模块</span><br><span class="line"></span><br><span class="line">置换元素与非置换元素</span><br><span class="line">1 置换元素：浏览器根据元素的标签和属性，来决定元素的具体显示内容</span><br><span class="line"> 例如：<span class="tag">&lt;<span class="name">img</span>&gt;</span>根据src属性的值来读取信息并显示出来</span><br><span class="line"> 常见的置换元素：<span class="tag">&lt;<span class="name">img</span>&gt;</span>、<span class="tag">&lt;<span class="name">input</span>&gt;</span>、<span class="tag">&lt;<span class="name">textarea</span>&gt;</span>、<span class="tag">&lt;<span class="name">select</span>&gt;</span>、<span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line"> 这些元素无实际内容，在显示中生成了框，这也是有的内联元素能够设置宽高的原因。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">元素定位方式：position</span><br><span class="line">Static：默认值，始终处于文档流给予的位置</span><br><span class="line">Relative：相对定位，</span><br><span class="line">Absolute：</span><br><span class="line">Fixed:相对浏览器的绝对定位</span><br><span class="line">案例：</span><br><span class="line">绝对定位：父级相对，子级绝对</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">透明对的设置：</span><br><span class="line">IE10以下浏览器的写法：</span><br><span class="line">filter：alpha(opacity=value); 取值范围 1-100</span><br><span class="line">IE9两种都支持，但是优先显示上面的方法</span><br><span class="line">opacity：.value  （范围 0-1 ）</span><br><span class="line"></span><br><span class="line">区别:</span><br><span class="line">visibility:隐藏对应的元素但不挤占该元素原来的空间。</span><br><span class="line">display:隐藏对应的元素并且挤占该元素原来的空间。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">插入flash--语法：</span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">width</span>=<span class="string">&quot;value&quot;</span> <span class="attr">height</span>=<span class="string">&quot;value&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;wmode&quot;</span> <span class="attr">value</span>=<span class="string">&quot;transparent&quot;</span> /&gt;</span><span class="comment">&lt;!--设置flash背景透明--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;movie&quot;</span> <span class="attr">value</span>=<span class="string">&quot;flash路径及全称&quot;</span>&gt;</span><span class="comment">&lt;!--其他浏览器识别--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">embed</span> <span class="attr">width</span>=<span class="string">&quot;value&quot;</span> <span class="attr">height</span>=<span class="string">&quot;value&quot;</span> <span class="attr">src</span>=<span class="string">&quot;flash路径及全称&quot;</span> <span class="attr">vmode</span>=<span class="string">&quot;transparent&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">embed</span>&gt;</span> <span class="comment">&lt;!--ie浏览器识别--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--flash 源文件格式 .fla 导出影片为 .swf ,创建播放器格式 .exe --&gt;</span></span><br><span class="line"></span><br><span class="line">背景图片：做修饰点缀用的，不需要定期修改。</span><br><span class="line">图片：需要定期更换的图片。</span><br><span class="line">背景图的整合：</span><br><span class="line">CSS sprites的原理(图片整合技术)</span><br><span class="line">操作:将导航背景的图片，按钮背景图片等有规则的合并成一张背景图，然后用background-position 来实现背景图片的定位技术</span><br><span class="line">优势：减少对服务器的请求次数、提高页面的加载速度、减小图片的体积</span><br><span class="line">利用缓存来加载浏览器的加载速度</span><br><span class="line">常见技术：</span><br><span class="line">精灵图技术</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSS 3.0</title>
      <link href="/posts/9434c448.html"/>
      <url>/posts/9434c448.html</url>
      
        <content type="html"><![CDATA[<h2 id="CSS3">CSS3</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">transform</span></span><br><span class="line">向元素应用<span class="number">2</span>D/<span class="number">3</span>D转换<span class="selector-attr">[旋转、缩放、移动、倾斜]</span></span><br><span class="line"><span class="attribute">transform</span>: none|transform-functions;</span><br><span class="line"></span><br><span class="line">translate</span><br><span class="line">元素从一种样式逐渐改变为另一种的效果</span><br><span class="line"><span class="attribute">transition</span>: width <span class="number">2s</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> 定义动画</span><br><span class="line"></span><br><span class="line">伪对象选择符：</span><br><span class="line">如：在文本前面添加内容</span><br><span class="line">&lt;p&gt;Hello World&lt;/p&gt;</span><br><span class="line"><span class="attribute">p</span>:before&#123;<span class="attribute">content</span>:<span class="built_in">url</span>(<span class="string">images/img1.jpg</span>) <span class="string">&quot;我是在Hello World 前面新增的文本内容&quot;</span>&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:after</span>&#123;<span class="attribute">content</span>:<span class="built_in">url</span>(<span class="string">images/img1.jpg</span>) <span class="string">&quot;我是在Hello World 后面新增的文本内容&quot;</span>&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:first</span>-letter&#123;<span class="attribute">color</span>:<span class="number">#F00</span>;&#125;  定义对象内第一个字符的样式。</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:first</span>-line&#123;<span class="attribute">color</span>:<span class="number">#F00</span>;&#125;  定义对象内第一行的样式</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:selection</span>&#123;<span class="attribute">color</span>:<span class="number">#F00</span>;<span class="attribute">background</span>:green;&#125;  定义对象选中后高亮效果</span><br><span class="line"></span><br><span class="line">布局参考网站:</span><br><span class="line">门户型网站、企业型网站、电商型网站</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>导出Excel</title>
      <link href="/posts/deb18b14.html"/>
      <url>/posts/deb18b14.html</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head><title></title><meta charset="utf-8"></head><body><p>    <button onclick="exportExcel()">导出Excel</button></p></body></html><script src="./js/exceljs.js"></script><script type="text/javascript">function exportExcel() {// 要导出的数据let dataList = [    { name: '獐伞', age: 18, gender: '男' },    { name: '里斯', age: 18, gender: '女' },    { name: '汪芜', age: 18, gender: '男' }];// 创建工作簿var workbook = new ExcelJS.Workbook();// 创建工作表const sheet = workbook.addWorksheet('Sheet1');// 创建表头/** * header: 显示的内容 * key: 设置一个唯一的key作为属性名，添加行数据时与之对应 * width: 设置单元格的宽 */sheet.columns = [{ header: '姓名', key: 'name', width: 10 },      { header: '年龄', key: 'age', width: 10 },      { header: '性别', key: 'gender', width: 10 }];// 添加行数据dataList.forEach((item, index) => {sheet.addRow({ name: item.name, age: item.age, gender: item.gender });});// 下载 excelworkbook.xlsx.writeBuffer().then(buf => {        const blob = new Blob([buf], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8' });        const downloadElement = document.createElement('a')    const href = window.URL.createObjectURL(blob)    downloadElement.href = href    downloadElement.download = "人员信息表.xlsx"; // 文件名字    document.body.appendChild(downloadElement)    downloadElement.click()    document.body.removeChild(downloadElement) // 下载完成移除元素    window.URL.revokeObjectURL(href) // 释放掉blob对象});}</script>]]></content>
      
      
      <categories>
          
          <category> Demo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>csv 导出</title>
      <link href="/posts/a6f3bc9f.html"/>
      <url>/posts/a6f3bc9f.html</url>
      
        <content type="html"><![CDATA[<p><strong>GET请求长度限制</strong></p><ul><li>限制是特定的浏览器及服务器对它的限制</li><li>IE对URL长度的限制 是2083字节(2K+35字节)</li><li></li></ul><p><strong>POST长度限制</strong></p><ul><li>取决于服务器的设置和内存大小</li></ul><p><strong>导出csv</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isMSbrowser</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span>  userAgent = <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">userAgent</span></span><br><span class="line">  <span class="keyword">return</span> userAgent.<span class="title function_">indexOf</span>(<span class="string">&#x27;Edge&#x27;</span>) !== -<span class="number">1</span> || userAgent.<span class="title function_">indexOf</span>(<span class="string">&#x27;Trident&#x27;</span>) !== -<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">format</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">String</span>(data).<span class="title function_">replace</span>(<span class="regexp">/&quot;/g</span>, <span class="string">&#x27;&quot;&quot;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/(^[\s\S]*$)/</span>, <span class="string">&#x27;&quot;$1&quot;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">saveCSV</span>(<span class="params">title, head, data</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> wordSeparator = <span class="string">&#x27;,&#x27;</span></span><br><span class="line">  <span class="keyword">let</span> lineSeparator = <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> reTitle = title + <span class="string">&#x27;.csv&#x27;</span></span><br><span class="line">  <span class="keyword">let</span> headBOM = <span class="string">&#x27;\ufeff&#x27;</span></span><br><span class="line">  <span class="keyword">let</span> headStr = head ? head.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title function_">format</span>(item)).<span class="title function_">join</span>(wordSeparator) + lineSeparator : <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">let</span> dataStr = data ? data.<span class="title function_">map</span>(<span class="function"><span class="params">row</span> =&gt;</span> row.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="title function_">format</span>(item)).<span class="title function_">join</span>(wordSeparator)).<span class="title function_">join</span>(lineSeparator) : <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">isMSbrowser</span>()</span><br><span class="line">  ? <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123; <span class="comment">// Edge、IE11</span></span><br><span class="line">      <span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([headBOM + headStr + dataStr], &#123; <span class="attr">type</span>: <span class="string">&#x27;text/plain;charset=utf-8&#x27;</span> &#125;)</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="title function_">msSaveBlob</span>(blob, reTitle)</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  : <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123; <span class="comment">// Chrome、Firefox</span></span><br><span class="line">      <span class="keyword">let</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">      a.<span class="property">href</span> = <span class="string">&#x27;data:text/csv;charset=utf-8,&#x27;</span> + headBOM + <span class="built_in">encodeURIComponent</span>(headStr + dataStr)</span><br><span class="line">      a.<span class="property">download</span> = reTitle</span><br><span class="line">      a.<span class="title function_">click</span>()</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>导出JSON</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isMSbrowser</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span>  userAgent = <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">userAgent</span></span><br><span class="line">  <span class="keyword">return</span> userAgent.<span class="title function_">indexOf</span>(<span class="string">&#x27;Edge&#x27;</span>) !== -<span class="number">1</span> || userAgent.<span class="title function_">indexOf</span>(<span class="string">&#x27;Trident&#x27;</span>) !== -<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">saveJSON</span>(<span class="params">title, data</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> reTitle = title + <span class="string">&#x27;.json&#x27;</span></span><br><span class="line">  <span class="keyword">let</span> dataStr = data ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data) : <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">isMSbrowser</span>()</span><br><span class="line">  ? <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123; <span class="comment">// Edge、IE11</span></span><br><span class="line">      <span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([dataStr], &#123; <span class="attr">type</span>: <span class="string">&#x27;text/plain;charset=utf-8&#x27;</span> &#125;)</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="title function_">msSaveBlob</span>(blob, reTitle)</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  : <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123; <span class="comment">// Chrome、Firefox</span></span><br><span class="line">      <span class="keyword">let</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">      a.<span class="property">href</span> = <span class="string">&#x27;data:text/json;charset=utf-8,&#x27;</span> + dataStr</span><br><span class="line">      a.<span class="property">download</span> = reTitle</span><br><span class="line">      a.<span class="title function_">click</span>()</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Demo </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>代码审查</title>
      <link href="/posts/55bbe403.html"/>
      <url>/posts/55bbe403.html</url>
      
        <content type="html"><![CDATA[<h2 id="Code-Review">Code Review</h2><h3 id="好处">好处</h3><ul><li><p>团队知识共享角度</p><ul><li>通过代码审查可以有效练习沟通能力、发现问题的能力、帮助其他人成长的能力</li></ul></li><li><p>代码质量角度</p><ul><li>保证代码的可读性、可维护性</li><li>提高整体代码质量，及时发现代码中可能存在的问题</li></ul></li><li><p>团队规范角度</p><ul><li>合理进行项目框架设计、形成标准</li></ul></li></ul><h3 id="措施">措施</h3><ul><li>拿到需求，先设计再编码</li><li>保证 PR 内容较少</li><li>提交前，至少一个人 Code Review 通过</li><li>对 Review 作出分级评论，进行 Tag 标记<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">[blocker]</span>: 在评论前面加上一个<span class="comment">[blocker]</span>标记，表示这个代码行的问题必须要修改</span><br><span class="line"><span class="comment">[optional]</span>：在评论前面加上一个<span class="comment">[optional]</span>标记，表示这个代码行的问题可改可不改</span><br><span class="line"><span class="comment">[question]</span>：在评论前面加上一个<span class="comment">[question]</span>标记，表示对这个代码行不理解，有问题需要问，被审查者需要针对问题进行回复澄清</span><br></pre></td></tr></table></figure></li><li>选辅助工具做 Code Review</li><li>写自动化测试用例</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程规范 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>代码规范</title>
      <link href="/posts/caa523c5.html"/>
      <url>/posts/caa523c5.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>本文从<code>为什么需要规范</code>以及<code>建立规范的重要性</code>出发，逐步引申出如何去建立适合自己团队的规范，详细讨论了前端具体涉及到的规范都有哪些，部分小节有具体的配置步骤和操作链接。</p><h2 id="为什么需要规范">为什么需要规范</h2><p>规范能给我们带来什么好处，如果没有规范会造成什么后果？这里主要拿代码规范来说。</p><p>统一代码规范的好处：</p><ol><li>提高代码整体的<code>可读性、可维护性、可复用性、可移植性和可靠性</code>，这会从根本上<code>降低开发成本</code>，也是最重要的一点。</li><li>保证代码的一致性：软件系统中最重要的因素之一就是编码的一致性。如果编码风格一致，也<code>更加易于维护</code>，因为团队内任何人都可以快速理解并修改。</li><li>提升团队整体效率：开发人员通常需要花费大量的时间来解决代码质量问题，如果都按照规范编写，也有助于团队<code>尽早发现问题，甚至完全预防问题</code>，这将提高整个交付过程的效率。</li><li>减少 code review 期间一系列的争议，因为缺乏标准，在争议过程中双方很难妥协。</li></ol><p>若不统一代码规范，可能会造成的后果：</p><ol><li>由于缺乏规范，导致<code>代码风格不一，增加团队成员间的心理负担</code>，极端情况下，某段代码只有某个人能修改。</li><li>团队间协作更加困难：因为开发人员得<code>适应不同的风格，会导致效率低下</code>（阅读代码是我们花费时间最多的地方）。</li><li>在 code review 期间可能经常为类似的事情做过多的讨论。</li><li>影响团队的生产力和质量，严重的甚至会影响团队和谐。</li></ol><h2 id="开发者需要建立和遵守的规范">开发者需要建立和遵守的规范</h2><p>大致可以划分成这几个方向：</p><ul><li>开发流程规范</li><li>代码规范</li><li>git commit 规范</li><li>项目文件结构规范</li><li>UI 设计规范</li></ul><h3 id="1-开发流程规范">1. 开发流程规范</h3><p>不管是传统开发的模式还是敏捷开发的模式，对于开发者来说<code>核心依旧是高质高效的完成用户提出的需求</code>。</p><p>不少开发者在拿到产品经理的需求后就开始急匆匆的写代码，以此来体现他们的<code>高效</code>，但往往却因为需求理解不到位和前期代码欠缺设计导致 bug 率高和返工。</p><p>如何找到适合自己的开发流程是需要依靠经验来支撑的，需要反复总结和思考，最终达到<code>高质高效完成</code>的目的。</p><p>推荐的开发流程：</p><p><img src="/assets/images/coding-standard/%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B.png" alt="开发流程"></p><p>在接收到需求后应第一时间去了解<code>这个需求的背景是什么？</code>这么做到底有没有解决用户的痛点？或者说用户更深层次的需求是什么？<code>如果团队的产品经理经验不丰富，往往可以在这个阶段砍掉很多不合理的需求（这一点真的很重要）</code>。</p><p>对于复杂大功能往往还需要进行<code>技术方案调研</code>和<code>技术方案设计</code>，并输出详细的设计文档。涉及到细节上，则需要将数据流走向、组件设计等通过脑图的形式呈现出来。</p><h3 id="2-代码规范之格式化规范">2. 代码规范之格式化规范</h3><p>由于每个开发者的 IDE 不同，即使 IDE 相同也会因为每个人的配置不一样导致格式化的结果不一样。如何确保团队内开发人员采用统一的格式化配置呢？</p><p>这里给推荐大家使用 <a href="https://prettier.io/">prettier</a>，它内置了一套格式化的规则，具体配置：</p><p>1). 安装依赖：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev --save-exact prettier </span><br><span class="line"><span class="comment">// or </span></span><br><span class="line">yarn add --dev --exact prettier</span><br></pre></td></tr></table></figure><p>2). 创建一个空配置文件，让编辑器和其他工具知道你正在使用 Prettier：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#123;&#125; &gt; .<span class="property">prettierrc</span>.<span class="property">json</span></span><br></pre></td></tr></table></figure><p>3). 创建一个<a href="https://prettier.io/docs/en/ignore.html">.prettierignore</a>文件，让 Prettier CLI 和编辑器知道哪些文件不能格式化，example：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ignore artifacts:</span></span><br><span class="line"><span class="keyword">dist</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">build</span></span><br><span class="line"><span class="keyword"></span>coverage</span><br></pre></td></tr></table></figure><p>4). 配置编辑器（VScode 为例）</p><p>IDE 中安装 <a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode">Prettier-Code Formater</a> 插件：</p><p><img src="/assets/images/coding-standard/prettier-code-formatter.webp" alt="prettier-code-formatter"></p><p>找到 IDE 中设置模块，搜索 format On Save，勾上这个就可以了。</p><p><img src="/assets/images/coding-standard/IDE-setting.webp" alt="IDE-setting.webp"></p><p>现在当我们 Ctrl + S 保存代码时，插件就会帮助我们自动格式化了。</p><p>这时候就需要在 git commit 的阶段自动将提交的代码进行格式化，这里我们借助工具 <a href="https://github.com/typicode/husky">husky</a>，它主要可以帮助我们在 git 阶段检查<code>提交消息、运行测试、检查代码</code>等。</p><p>配置如下：</p><ul><li>安装 <a href="https://github.com/typicode/husky">husky</a> 和 <a href="https://github.com/okonet/lint-staged">lint-staged</a>：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev husky lint-staged</span><br><span class="line">npx husky install</span><br><span class="line">npm set-script prepare <span class="string">&quot;husky install&quot;</span></span><br><span class="line">npx husky add .<span class="property">husky</span>/pre-commit <span class="string">&quot;npx lint-staged&quot;</span></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">yarn add --dev husky lint-staged</span><br><span class="line">npx husky install</span><br><span class="line">npm set-script prepare <span class="string">&quot;husky install&quot;</span></span><br><span class="line">npx husky add .<span class="property">husky</span>/pre-commit <span class="string">&quot;npx lint-staged&quot;</span></span><br></pre></td></tr></table></figure><ul><li>然后将以下内容添加到<code>package.json</code>中:</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;**/*&quot;</span>: <span class="string">&quot;prettier --write --ignore-unknown&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段配置的意思是：当执行 git commit 阶段前，先执行<code>lint-staged</code>，<code>lint-staged</code>中的内容就是对<code>暂存区的文件</code>执行格式化的命令。</p><p>其他：若使用的是脚手架工具搭建的项目，会自带 eslint 配置（<code>eslintConfig</code>）。<code>prettier 和 eslint 会有一些配置上的冲突</code>，这个时候需要安装 <a href="https://github.com/prettier/eslint-config-prettier#installation">eslint-config-prettier</a> 以使 ESLint 和 Prettier 相互配合，安装完后在<code>.eslintrc</code>中配置（以 Create-React-App 为例）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;eslintConfig&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;extends&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;react-app&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-app/jest&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prettier&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>这样就可以用<code>&quot;prettier&quot;</code>的部分规则覆盖前面的规则，让它们都能正常工作。</p><p>更多详情见：<a href="https://prettier.io/docs/en/install.html">Prettier</a>。</p><h3 id="3-代码规范之-JS-TS-规范">3. 代码规范之 JS/TS 规范</h3><p>JS/TS 主流的大致有这几种：</p><ul><li><a href="https://www.npmjs.com/package/eslint-config-airbnb">Airbnb JavaScript Style Guide</a></li><li><a href="https://google.github.io/styleguide/jsguide.html">Google JavaScript Style Guide</a></li><li><a href="https://github.com/rwaldron/idiomatic.js">Idiomatic JavaScript Style Guide</a></li><li><a href="https://www.npmjs.com/package/eslint-config-airbnb">JavaScript Standard Style Guide</a></li><li><a href="https://contribute.jquery.org/style-guide/js/">jQuery JavaScript Style Guide</a></li></ul><p>比较推荐使用 Airbnb JavaScript Style Guide，它在 Github 上足有 12 万 star，几乎覆盖了 JavaScript 的每一项特性。</p><p>具体配置：</p><p>1). 安装依赖</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint --save-dev </span><br><span class="line"><span class="comment">// or </span></span><br><span class="line">yarn add eslint --dev</span><br></pre></td></tr></table></figure><p>2). 生成配置文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init @eslint/config </span><br><span class="line"><span class="comment">// or </span></span><br><span class="line">yarn create @eslint/config</span><br></pre></td></tr></table></figure><p>跟着终端中的提示，按照自身需求一步步选择即可。</p><p>有了具体的规范后，我们同样需要使用工具去约束：还是通过在<code>git commit</code>阶段校验，若不通过则取消提交。</p><p>配置（还是在 <code>package.json</code> 中的 <code>lint-staged</code> ）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;**/*&quot;</span>: <span class="string">&quot;prettier --write --ignore-unknown&quot;</span>, <span class="comment">//格式化</span></span><br><span class="line">  <span class="string">&quot;src/*&quot;</span>: <span class="string">&quot;eslint --ext .js,.ts,.tsx&quot;</span>  <span class="comment">//进行eslint校验</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote><p>注意：这里如果选用的 Typescript，则会默认使用<code>@typescript-eslint/parser</code>解析器，官方为了追求更快的解析速度，并不会对.ts 文件中的类型进行检查，只会做语法检测。</p><p>如果需要对类型也进行检测，需要在 extends 中加上 <a href="https://typescript-eslint.io/docs/linting/type-linting/">plugin:\@typescript-eslint/recommended-requiring-type-checking</a>。</p><p>但是在笔者的使用中发现效果并不好，一些基本的类型依然检测不出来，索性这里换了另一种方式：在<code>pre commit</code> 中执行<code>yarn run tsc</code>，这里的意思是对项目中 ts 文件进行类型检测，默认会读取根目录中的<code>tsconfig.json</code>配置。</p><p>这种方式并不完美，它的弊端就在于<code>全量检测</code>，如果项目不大还好，若是项目代码量够多，检测 10-20s 也是常有的事。</p></blockquote><p>更多详情查看 eslint 官网：<a href="https://eslint.org/docs/latest/user-guide/getting-started">eslint.org/docs/user-g…</a></p><h3 id="4-代码规范之-CSS-规范">4. 代码规范之 CSS 规范</h3><p>CSS 检查代码规范使用  <code>stylelint</code>  插件，规范则推荐使用 <a href="https://github.com/stylelint/stylelint-config-standard">stylelint-config-standard</a>：</p><p>1). 安装</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev stylelint stylelint-config-standard</span><br></pre></td></tr></table></figure><p>2).  在项目的根目录中创建一个配置文件<code>.stylelintrc.json</code>，内容如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;  <span class="string">&quot;extends&quot;</span>: <span class="string">&quot;stylelint-config-standard&quot;</span> &#125;</span><br></pre></td></tr></table></figure><p>3). 解决与<code>prettier</code>配置的冲突：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev stylelint-config-prettier</span><br></pre></td></tr></table></figure><p>4). 将下面配置复制到<code>.stylelintrc.json</code>中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;extends&quot;</span>: [<span class="string">&quot;stylelint-config-standard&quot;</span>, <span class="string">&quot;stylelint-config-prettier&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5). 在 git commitv 阶段进行检测：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">&quot;lint-staged&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;**/*&quot;</span>: <span class="string">&quot;prettier --write --ignore-unknown&quot;</span>, <span class="comment">// 格式化</span></span><br><span class="line">    <span class="string">&quot;src/**.&#123;js,jsx,ts,tsx&#125;&quot;</span>: <span class="string">&quot;eslint --ext .js,.jsx,.ts,.tsx&quot;</span>, <span class="comment">// 对js文件检测</span></span><br><span class="line">    <span class="string">&quot;**/*.&#123;less,css&#125;&quot;</span>: <span class="string">&quot;stylelint --fix&quot;</span> <span class="comment">// 对css文件进行检测</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-代码规范之自定义其他规范">5. 代码规范之自定义其他规范</h3><p>下面列一些团队内定的其他规范：</p><p>1). 命名规范</p><p>变量的命名中应尽量减少缩写的情况发生，做到见名知意。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 👎 自我感觉良好的缩写:</span></span><br><span class="line"><span class="keyword">let</span> rContent = <span class="string">&#x27;willen&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 无需对每个变量都写注释，从名字上就看懂</span></span><br><span class="line"><span class="keyword">let</span> firstName = <span class="string">&#x27;jackie&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 👎 从命名无法知道返回值类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showFriendsList</span>(<span class="params"></span>) &#123;....&#125; <span class="comment">// // 无法辨别函数意图,返回的是一个数组，还是一个对象，还是true or false?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 明确函数意图，对于返回true or false的函数，最好以should/is/can/has开头</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">shouldShowFriendsList</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isEmpty</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">canCreateDocuments</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hasLicense</span>(<span class="params"></span>) &#123;...&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sendEmailToUser</span>(<span class="params">user</span>) &#123;.... &#125; <span class="comment">//动词开头，函数意图就很明显</span></span><br></pre></td></tr></table></figure><p>2). 写注释</p><p>在每个文件的顶部明确说明该组件做什么，有没有业务理解难点等等，对业务特殊函数/变量也需要写注释</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 导航页面-右边区域</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Content</span> =&gt; <span class="function">() =&gt;</span> xxx</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">MAX_INPUT_LENGTH</span> = <span class="number">8</span>; <span class="comment">//用于限制密码输入框</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 如果用户没有订阅则不展示广告 */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;user.subscribed ? null : <span class="tag">&lt;<span class="name">SubscriptionPlans</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>3). 变量兜底</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 👎 对于求值获取的变量，没有兜底</span></span><br><span class="line"><span class="keyword">const</span> &#123; data &#125; = <span class="title function_">getApiRequest</span>();</span><br><span class="line">data.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> s.<span class="property">id</span>); <span class="comment">// 没有考虑data异常的情况，代码一跑就爆炸</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 对于求值变量，做好兜底</span></span><br><span class="line"><span class="keyword">const</span> &#123; data = [] &#125; = <span class="title function_">getApiRequest</span>();</span><br><span class="line">data.<span class="title function_">map</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> s?.<span class="property">id</span>);</span><br></pre></td></tr></table></figure><p>4). 辅助函数必须是纯函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 👎 不要让功能函数的输出变化无常</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">plusAbc</span>(<span class="params">a, b, c</span>) &#123;  <span class="comment">// 这个函数的输出将变化无常，因为api返回的值一旦改变，同样输入函数的a，b,c的值，但函数返回的结果却不一定相同。</span></span><br><span class="line">  <span class="keyword">var</span> c = <span class="title function_">fetch</span>(<span class="string">&#x27;../api&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> a+b+c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 功能函数使用纯函数，输入一致，输出结果永远唯一</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">plusAbc</span>(<span class="params">a, b, c</span>) &#123;  <span class="comment">// 同样输入函数的a，b,c的值，但函数返回的结果永远相同。</span></span><br><span class="line">  <span class="keyword">return</span> a+b+c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5). 优先使用函数式编程</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 👎 使用for循环编程</span></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">   a[i] = a[i] +<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 使用函数式编程</span></span><br><span class="line"><span class="keyword">let</span> b = a.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> ++item)</span><br></pre></td></tr></table></figure><p>6). 优先使用函数式组件</p><p>除非需要用到错误边界，否则函数式组件应该是首选方法。</p><p>7). 组件复杂度</p><p>如果一个组件做的事情太多，应适当提取一些逻辑，将其拆分为更小的组件，遵循<code>高内聚、低耦合</code></p><p>如果提取的组件很复杂，则需要依照一定的规则和条件一一提取它。</p><ul><li>代码行数</li><li>视图页面结构</li><li>单一功能<br>…</li></ul><p>8). 用错误边界</p><p>当需要对大量数据进行渲染处理时，需要通过错误边界组件对其进行降级处理。</p><p>更多详情见之前写的专题文章：<a href="https://juejin.cn/post/6979564690787532814">浅析前端异常及降级处理</a>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">CardWidget</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">FiltersWidget</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ProductList</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>9). props 参数传递</p><p>props 一层层传递一直是我们很头疼的一个问题，最核心的问题是不清楚 props 是从哪个初始组件传来的，以及 props 中到底有哪些东西，上下文是什么？</p><p>因此对于传递较深的场景我推荐直接使用 context，对于 props 中的内容和上下文通过 TS 来解决。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A.tsx</span></span><br><span class="line">interface <span class="title class_">AProps</span> &#123;</span><br><span class="line">  <span class="attr">param</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">A</span> = (<span class="params">&#123; param &#125;: AProps</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">B</span> <span class="attr">param</span> = <span class="string">&#123;param&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 上下文清晰</span></span><br><span class="line"><span class="comment">// B.tsx</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">B</span> = (<span class="params">&#123; param &#125;: &#123; param: AProps[<span class="string">&#x27;param&#x27;</span>] &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>10). props 传参数量</p><p>如果超过 5 个 props，就该考虑是否拆分该组件。在某些情况下，这是需要对组件进行重构的标志。</p><p><code>注意：组件使用的props越多，更容易造成子组件重新渲染。</code></p><p>11). 避免嵌套三元运算符</p><p>三元运算符在第一级之后变得难以阅读，虽然看起来节省了代码空间，但最好在代码中明确意图，保持良好的阅读性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 👎 不够清晰，要是再嵌套一层两层呢</span></span><br><span class="line">isSubscribed ? (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ArticleRecommendations</span> /&gt;</span></span></span><br><span class="line">) : isRegistered ? (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">SubscribeCallToAction</span> /&gt;</span></span></span><br><span class="line">) : (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">RegisterCallToAction</span> /&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 将判断逻辑进行拆分</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CallToActionWidget</span>(<span class="params">&#123; subscribed, registered &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (subscribed) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ArticleRecommendations</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (registered) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SubscribeCallToAction</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">RegisterCallToAction</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">CallToActionWidget</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">subscribed</span>=<span class="string">&#123;subscribed&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">registered</span>=<span class="string">&#123;registered&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>12). 将列表组件封装成独立组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 👎 列表渲染和其他逻辑杂糅在一起</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; topic, page, articles, onNextPage &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;topic&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;articles.map(article =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;article.title&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;article.teaser&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;article.image&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>You are on page &#123;page&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onNextPage&#125;</span>&gt;</span>Next<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 将列表组件提取出来，一目了然</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params">&#123; topic, page, articles, onNextPage &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;topic&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ArticlesList</span> <span class="attr">articles</span>=<span class="string">&#123;articles&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>You are on page &#123;page&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onNextPage&#125;</span>&gt;</span>Next<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>13). 避免嵌套渲染函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 👎 不要将其定义在渲染函数组件中</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">renderHeader</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">header</span>&gt;</span>...<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;renderHeader()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 将其抽离到独立的组件中去</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Header</span> <span class="keyword">from</span> <span class="string">&#x27;@modules/common/components/Header&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Component</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Header</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>15). 组件/函数导入导出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 👍 在文件头部导入，顺序依次为: 第三方库 &gt; 公共组件/方法 &gt; 非公共部分组件/方法</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;loadsh&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Header</span> <span class="keyword">from</span> <span class="string">&#x27;@components/header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Content</span> <span class="keyword">from</span> <span class="string">&#x27;./Content&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 👍 在底部导出</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Content</span>, <span class="title class_">Header</span> &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Component</span></span><br></pre></td></tr></table></figure><p>…</p><h3 id="6-项目文件结构规范">6. 项目文件结构规范</h3><p>文件夹名称全部采用小写 + “-” 来隔开，index.ts 更多是用来做导出作用，要不然最后编辑器中满屏的 index.tsx，很难区分。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- src 开发目录</span><br><span class="line">   - pages 视图</span><br><span class="line">       - <span class="variable language_">module</span>-a 模块A</span><br><span class="line">         - components 私有组件</span><br><span class="line">           - <span class="title class_">ComA</span>.<span class="property">tsx</span></span><br><span class="line">           - <span class="title class_">ComB</span>.<span class="property">tsx</span></span><br><span class="line">         - index.<span class="property">module</span>.<span class="property">less</span></span><br><span class="line">         - index.<span class="property">tsx</span></span><br><span class="line">         - <span class="title class_">Content</span>.<span class="property">tsx</span></span><br><span class="line">       - <span class="variable language_">module</span>-b 模块B</span><br><span class="line">   - components 公共组件</span><br><span class="line">     - index.<span class="property">ts</span> 导出所有组件</span><br><span class="line">     - header</span><br><span class="line">       - index.<span class="property">tsx</span></span><br><span class="line">       - index.<span class="property">module</span>.<span class="property">less</span></span><br><span class="line">       - <span class="title class_">User</span>.<span class="property">tsx</span></span><br><span class="line">       - useGetBaseInfo.<span class="property">hooks</span>.<span class="property">ts</span></span><br><span class="line">   - routers 路由文件</span><br><span class="line">   - store redux 中的数据</span><br><span class="line">   - utils 工具函数库【以utils为后缀】</span><br><span class="line">     - index.<span class="property">ts</span></span><br><span class="line">     - a.<span class="property">utils</span>.<span class="property">ts</span></span><br><span class="line">     - b.<span class="property">utils</span>.<span class="property">ts</span></span><br><span class="line">   - hooks 全局hooks【以hooks为后缀】</span><br><span class="line">     - index.<span class="property">ts</span></span><br><span class="line">     - a.<span class="property">hooks</span>.<span class="property">ts</span></span><br><span class="line">     - b.<span class="property">hooks</span>.<span class="property">ts</span></span><br><span class="line">   - styles 静态资源文件</span><br><span class="line">   - service api请求【这里是以api为后缀】</span><br><span class="line">     - a.<span class="property">api</span>.<span class="property">ts</span> 按照后端微服务进行划分</span><br><span class="line">     - b.<span class="property">api</span>.<span class="property">ts</span></span><br><span class="line">   - constans 常量</span><br></pre></td></tr></table></figure><p>通过对工具函数、hooks、api 等加上后缀，更加容易区分引入的文件。</p><h3 id="7-Git-commit-规范">7. Git commit 规范</h3><p>git commit 规范主要可以帮助开发人员在 code review 期间更容易理解提交的内容，现在大部分主流 commit 规范都是基于 <a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines">Angular 团队的规范</a>而衍生出来的，它的 message 格式如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>(<span class="tag">&lt;<span class="name">scope</span>&gt;</span>): <span class="tag">&lt;<span class="name">subject</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">BLANK</span> <span class="attr">LINE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">BLANK</span> <span class="attr">LINE</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure><p>每个提交消息都包含一个<strong>subject</strong>、一个<strong>body</strong>和一个<strong>footer</strong> (中间使用空行分割)，提交信息的任何一行不能超过 100 个字符。</p><p>👉 type 主要有以下几种类型：</p><ul><li><strong>feat</strong>: 一个新特性</li><li><strong>fix</strong>: 修复 bug</li><li><strong>docs</strong>: 文档修改</li><li><strong>style</strong>: 不影响代码含义的更改（空格、格式、缺少分号等）</li><li><strong>refactor</strong>: 代码重构</li><li><strong>perf</strong>: 优化性能</li><li><strong>test</strong>: 测试用例修改</li><li><strong>chore</strong>: 对构建过程或辅助工具和库的更改，例如文档生成</li></ul><p>👉 scope：可以是影响范围的任何内容。</p><p>👉 subject：包含对更改的简洁描述，规则：</p><ul><li>使用陈述语句</li><li>第一个字母不要大写</li><li>末尾没有点 (.)</li></ul><p>👉 body：commit 具体修改内容, 可以分为多行，应该包括改变的动机，并与以前的行为进行对比。</p><p>👉 footer: 一些备注, 通常是修复的 bug 的链接。</p><p>有了规范后，我们需要通过工具去约束：<a href="https://github.com/conventional-changelog/commitlint">commitlint</a>。它要做的就是在我们每次提交 <code>git commit</code> 的时候，都会帮我们检查 <code>commit message</code> 是否符合一定的规范，如果不符合，就让这次提交失败。</p><p>具体配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装 commitlint cli 和 conventional config</span></span><br><span class="line">npm install --save-dev @commitlint/&#123;config-conventional,cli&#125;</span><br><span class="line"><span class="comment">// Windows:</span></span><br><span class="line">npm install --save-dev @commitlint/config-conventional @commitlint/cli</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置要使用的 commitlint 规则</span></span><br><span class="line">echo <span class="string">&quot;module.exports = &#123;extends: [&#x27;@commitlint/config-conventional&#x27;]&#125;&quot;</span> &gt; commitlint.<span class="property">config</span>.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加入到husky中：</span></span><br><span class="line">npx husky add .<span class="property">husky</span>/commit-msg <span class="string">&#x27;npx --no -- commitlint --edit &quot;$1&quot;&#x27;</span></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">yarn husky add .<span class="property">husky</span>/commit-msg <span class="string">&#x27;yarn commitlint --edit $1&#x27;</span></span><br></pre></td></tr></table></figure><p>更多详情见官网：<a href="https://github.com/conventional-changelog/commitlint">github.com/conventiona…</a></p><h3 id="8-UI-设计规范">8. UI 设计规范</h3><p>优秀的开发者应该反向推动 UI 的规范，并且能够支撑 UI 规范的落地。</p><p>UI 规范的最大好处就是能够提质提效：</p><ul><li>在开发者的角度，与设计规范同步形成研发资产，避免重复造轮子；</li><li>在测试的角度，能够避免重复的无意义走查；</li><li>在 UI 设计师的角度，减少设计成本，提高设计效率，可以快速承接新需求；</li><li>站在产品角度，提高产品迭代与优化效率，降低试错成本；</li><li>站在用户角度，解决用户体验一致性。</li></ul><p>那到底应该怎么去推动 UI 规范？我的做法是<code>先让设计师去给出一系列的规范，没有相关规范就拉上产品经理一起制定规范。然后前端建立一套自己的组件库，再将组件库提供给UI设计师，以此来相互监督是否达成了规范协议。</code></p><p>具体参考 <a href="https://ant.design/docs/spec/introduce-cn">Antd 设计规范</a>。</p><h3 id="9-单元测试">9. 单元测试</h3><p>很多人都不喜欢写测试用例代码，觉得浪费时间，主要是维护测试代码非常的繁琐，但我们需要编写测试代码，特别是通用组件测试代码，这不仅是提高组件的代码质量必要条件，而且当发生依赖库更新版本变化时，会马上发现潜在问题，同时也是自动化测试的基础。</p><p>React使用 Jest 和 @testing-library/react进行组件测试</p><p>做单元测试时要关注四个方面：组件渲染、状态变化、事件响应、网络请求。</p><p>Jest对TDD和BDD两者都支持，可以根据项目或实际要求进行选择。</p><h2 id="总结">总结</h2><p>统一规范的最根本目的是为了保证团队成员的一致性，从而减少沟通成本，提高开发效率 👏👏👏。</p>]]></content>
      
      
      <categories>
          
          <category> 编程规范 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>npm依赖漏洞处理方案</title>
      <link href="/posts/a40b3fc3.html"/>
      <url>/posts/a40b3fc3.html</url>
      
        <content type="html"><![CDATA[<p><strong>npm 依赖漏洞处理</strong></p><blockquote><p>奇安信开源卫士</p></blockquote><ul><li>直接依赖</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;lodash&quot;</span>: <span class="string">&quot;^4.17.4&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lodash: ^<span class="number">4.17</span>.<span class="number">4</span> 的依赖范围是 &gt;=<span class="number">3.0</span>.<span class="number">3</span> &lt; <span class="number">4.0</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> TODO:: 措施</span><br><span class="line">npm audit fix</span><br><span class="line"><span class="regexp">//</span> 相当于 npm update lodash@<span class="number">4.17</span>.<span class="number">12</span></span><br></pre></td></tr></table></figure><ul><li>间接依赖</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">例如： <span class="variable">@commitlint</span>/cli^<span class="number">7.1</span>.<span class="number">2</span>&gt;<span class="variable">@commitlint</span>/load^<span class="number">1.0</span>.<span class="number">1</span>&gt;lodash^<span class="number">3.0</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line">因为 <span class="variable">@commitlint</span>/load 对 lodash 的依赖是^<span class="number">3.0</span>.<span class="number">0</span>(&gt;=<span class="number">3.0</span>.<span class="number">0</span> &lt;<span class="number">4.0</span>.<span class="number">0</span>)，<span class="number">4.17</span>.<span class="number">12</span> 不在这个范围，所以我们不能直接通过升级 Lodash 来修复漏洞，这时我们就要向上层依赖进行分析。</span><br><span class="line"></span><br><span class="line">假设此时 <span class="variable">@commitlint</span>/load 有一个更新版本 <span class="variable">@commitlint</span>/load^<span class="number">1.0</span>.<span class="number">2</span> 对 lodash 的依赖是^<span class="number">4.0</span>.<span class="number">0</span>(&gt;=<span class="number">4.0</span>.<span class="number">0</span> &lt;<span class="number">5.0</span>.<span class="number">0</span>)，lodash<span class="variable">@4</span>.<span class="number">17.12</span> 在这个依赖范围内，那么修复策略为 npm update <span class="variable">@commitlint</span>/load<span class="variable">@1</span>.<span class="number">0.2</span> --depth=<span class="number">2</span></span><br><span class="line"></span><br><span class="line">按照这个逻辑，如果 <span class="variable">@commitlint</span>/load 也没有找到可以升级的包，那么再到上层依赖查找，直到找到可以修复漏洞的那个层级的依赖。</span><br></pre></td></tr></table></figure><blockquote><p>npm update 只会检查更新顶层的依赖，更新更深层次的依赖版本需要使用 --depth 指定更新的深度。</p></blockquote><ul><li>强制修复漏洞</li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">按照上面的策略，从底层依赖一直向上层查找，如果一直到最上层依赖才有符合要求的修复版本，那么就直接 <span class="built_in">npm</span> update 更新最顶层依赖。</span><br><span class="line"></span><br><span class="line">继续使用上面的例子，如果 @commitlint/cli^<span class="number">7.1</span><span class="number">.2</span>( &gt;=<span class="number">7.1</span><span class="number">.2</span> &lt;<span class="number">8.0</span><span class="number">.0</span> ) 还不能找到一个可修复的版本，那么 <span class="built_in">npm</span> audit fix 这个命令就无能为力了。</span><br><span class="line"></span><br><span class="line">这时我们可以尝试 <span class="built_in">npm</span> audit fix --force（强制执行 audit fix 安装最新的依赖项（toplevel））来进行修复，这个逻辑就是：<span class="built_in">npm</span> install @commitlint/cli@patchedVersion --save</span><br><span class="line"></span><br><span class="line">这个命令会直接跨越当前指定的 semver 版本范围，强制将依赖更新到最新版本，一定要谨慎使用。</span><br><span class="line"><span class="built_in">npm</span> 还提供了一些其他的修复命令命令</span><br><span class="line"></span><br><span class="line"><span class="built_in">npm</span> audit fix --package-lock-only：在不修改 node_modules 的情况下执行 audit fix，仍然会更改 pkglock</span><br><span class="line"><span class="built_in">npm</span> audit fix --only=prod：跳过更新 devDependencies</span><br></pre></td></tr></table></figure><pre><code>[参考链接](https://zhuanlan.zhihu.com/p/102995060?utm_id=0)</code></pre>]]></content>
      
      
      <categories>
          
          <category> 包管理工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pnpm</title>
      <link href="/posts/140efdb9.html"/>
      <url>/posts/140efdb9.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 包管理工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>npx</title>
      <link href="/posts/cce9bfc0.html"/>
      <url>/posts/cce9bfc0.html</url>
      
        <content type="html"><![CDATA[<h3 id="npx">npx</h3><blockquote><p>npm 5.2 后新增命令，以下是其使用场景</p></blockquote><ul><li>调用 项目内部 模块</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最初：项目的根目录下执行</span></span><br><span class="line">$ <span class="keyword">node</span><span class="title">-modules</span>/.bin/mocha --<span class="keyword">version</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在：</span></span><br><span class="line">$ npx mocha --<span class="keyword">version</span></span><br></pre></td></tr></table></figure><ul><li>避免全局安装模块</li></ul><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">npx</span> <span class="built_in">create-react-app</span> <span class="string">my-react-app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># npx 强制使用本地模块，不下载远程模块</span></span><br><span class="line">$ <span class="string">npx</span> <span class="built_in">--no-install</span> <span class="built_in">create-react-app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略本地的同名模块，强制安装使用远程模块</span></span><br><span class="line">$ <span class="string">npx</span> <span class="built_in">--ignore-existing</span> <span class="built_in">create-react-app</span> <span class="string">my-react-app</span></span><br></pre></td></tr></table></figure><ul><li>使用不同版本的 node</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -p 指定所安装的模块</span></span><br><span class="line">$ npx -p <span class="keyword">node</span><span class="title">@0</span>.<span class="number">12.8</span> <span class="keyword">node</span> <span class="title">-v</span> </span><br></pre></td></tr></table></figure><ul><li>参数</li></ul><pre><code># -c 如果 npx 安装多个模块，默认情况下，所执行的命令之中，只有第一个可执行项会使用 npx 安装的模块，后面的可执行项还是会交给 Shell 解释# -c 将所有 命令都用 npx 解释$ npx -p lolcatjs -p cowsay -c 'cowsay hello | lolcatjs'</code></pre>]]></content>
      
      
      <categories>
          
          <category> 包管理工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>yarn</title>
      <link href="/posts/c965c636.html"/>
      <url>/posts/c965c636.html</url>
      
        <content type="html"><![CDATA[<h1>Yarn</h1><p><strong>重要：永远不要随便的就去删除 node_modules 文件和 yarn.lock 文件去重新 install，因为它可能会更新一些你并不想更新的包，而带来一些难以预料的问题</strong></p><h2 id="registry">registry</h2><p>其实就是查询下载每个模块的源。</p><p>当我们执行 <code>yarn install</code> 时候，就是去 <code>registry</code> 查询得到 package 压缩包地址进行下载的。</p><pre><code>yarn config get registry # 查看当前使用的源复制代码yarn config set registry url # 设置源复制代码</code></pre><h2 id="依赖版本">依赖版本</h2><p>yarn 的包遵守语义化版本，格式为</p><pre><code>X.Y.Z（主版本号.次版本号.修订号）：X.主版本号：进行不向下兼容的修改时，递增主版本号Y.次版本号: 做了向下兼容的新增功能或修改Z.修订号：做了向下兼容的问题修复复制代码</code></pre><h3 id="版本号：-version">版本号：~version</h3><p>表示主版本号和次版本号相同，修订号取最新</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~3.1.4</span><br><span class="line"></span><br><span class="line">&gt;=3.1.4 &lt; 3.2.0</span><br><span class="line"></span><br><span class="line">~3.1</span><br><span class="line"></span><br><span class="line">3.1.x 或 &gt; = 3.1.0 &lt; 3.2.0</span><br><span class="line"></span><br><span class="line">~3</span><br><span class="line"></span><br><span class="line">3.x 或 &gt; = 3.0.0 &lt; 4.0.0</span><br></pre></td></tr></table></figure><h3 id="版本号：-version-2">版本号：^version</h3><p>表示主版本号相同，取最新版本</p><p>使用 <code>yarn add package</code>时，默认使用的是 ^ 范围。</p><h2 id="依赖类型">依赖类型</h2><h3 id="dependencies">dependencies</h3><p>代码运行时所需要的依赖，比如 react，react-router。</p><h3 id="devDependencies">devDependencies</h3><p>开发依赖，就是那些只在开发过程中需要，而运行时不需要的依赖，比如 babel，webpack。</p><h3 id="peerDependencies">peerDependencies</h3><p>同伴依赖，它用来告知宿主环境需要什么依赖以及依赖的版本范围。如果宿主环境没有对应版本的依赖，在安装依赖时会报出警告。</p><h3 id="optionalDependencies">optionalDependencies</h3><p>可选依赖，这种依赖即便安装失败，Yarn 也会认为整个依赖安装过程是成功的。可选依赖适用于那些即便没有成功安装可选依赖，也有后备方案的情况。</p><h3 id="bundledDependencies">bundledDependencies</h3><p>打包依赖，在发布包时，这个数组里的包都会被打包到最终的发布包里，需要注意 <code>bundledDependencies</code> 中的包必须是在 <code>devDependencies</code> 或 <code>dependencies</code> 声明过的。</p><h2 id="缓存">缓存</h2><p><code>yarn</code> 会将安装过的包缓存下来，<strong>这样再次安装相同包的时候，就不需要再去下载，而是直接从缓存文件中直接 copy 进来</strong>。</p><p>可以通过命令 <code>yarn cache dir</code> 查看 yarn 的全局缓存目录。</p><p>yarn 会将不通版本解压后的包存放在不同目录下，目录以</p><pre><code>npm-[package name]-[version]-[shasum]`复制代码</code></pre><p><code>shasum</code>是一个 hash 值，在 lock 和缓存时会使用到。</p><p>我们可以通过命令查看已经缓存过的包。</p><pre><code>yarn cache list 列出已缓存的每个包yarn cache list --pattern &lt;pattern&gt; 列出匹配指定模式的已缓存的包复制代码</code></pre><h2 id="yarn-lock">yarn.lock</h2><p><code>yarn.lock</code> 中会准确的存储每个依赖的具体版本信息，以保证在不同机器安装可以得到相同的结果。</p><h3 id="yarn-lock-的作用">yarn.lock 的作用</h3><p>不要轻易的删除 yarn.lock 文件。</p><p>把 yarn.lock 删掉后，原本锁住的版本都放开了，执行 yarn install 的时候会根据 package.json 里定义的版本区间去找最新版。所以，可能会造成你预期外的依赖也被更新了，不幸的话可能会引入 bug。</p><p><strong>锁定唯一版本</strong></p><ul><li>package.json 里定义的是版本区间，如^1.0.0</li><li>而 yarn.lock 里的 version 字段是唯一的版本号，如 1.0.0</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ajax-hook@^<span class="number">2.0</span><span class="number">.3</span><span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">version <span class="string">&quot;2.0.3&quot;</span></span><br><span class="line"></span><br><span class="line">resolved <span class="string">&quot;http://npm.zhenguanyu.com/ajax-hook/download/ajax-hook-2.0.3.tgz#e9ceced02f940f6223123c7dc90fe2062d417c18&quot;</span></span><br><span class="line"></span><br><span class="line">integrity sha1<span class="number">-6</span>c7O0C+UD2IjEjx9yQ/iBi1BfBg=</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;@utilts/z@^0.2.57&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;@utilts/z@^0.2.58&quot;</span><span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">version <span class="string">&quot;0.2.58&quot;</span></span><br><span class="line"></span><br><span class="line">resolved <span class="string">&quot;http://npm.zhenguanyu.com/@utilts/z/download/@utilts/z-0.2.58.tgz#df1ad9c27734e4efd18095d49239dede266bea1f&quot;</span></span><br><span class="line"></span><br><span class="line">integrity sha1<span class="number">-3</span>xrZwnc05O/RgJXUkjne3iZr6h8=</span><br><span class="line"></span><br><span class="line">dependencies<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;@utilts/zdata&quot;</span> <span class="string">&quot;^0.2.58&quot;</span></span><br><span class="line"></span><br><span class="line">lodash-es <span class="string">&quot;^4.17.21&quot;</span></span><br><span class="line"></span><br><span class="line">query-string <span class="string">&quot;^6.11.1&quot;</span></span><br><span class="line"></span><br><span class="line">rxjs <span class="string">&quot;^6.6.7&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>第一行 <code>ajax-hook@^2.0.3</code> 包的 name 和语义化版本号，这些都来自 package.json 中的定义。也被称为 <code>Identifier(s)</code>，多个 Identifier 最终可能都指向同一个版本</li><li>version 记录的是一个确定的版本，也就是实际安装的版本</li><li>resolved 字段记录的是包的 URL 地址。其中 hash 值，即上文的<code>shasum</code></li><li>integrity 是对 resolved 下载下来的文件进行完整性校验。如果出现 diff，说明同一个下载链接对应的文件被修改过。</li><li>dependencies 字段记录的是当前包的依赖，即当前包在自己的 package.json 的 dependencies 字段中的所有依赖。</li></ul><p>Yarn 在安装期间，只会使用当前项目的 yarn.lock 文件，会忽略任何依赖里面的 yarn.lock 文件。在顶级 yarn.lock 中包含需要锁定的整个依赖树里全部包版本的所有信息。</p><p><strong>yarn.lock 文件是在安装期间，由 Yarn 自动生成的，并且由 yarn 来管理，不应该手动去更改，更不应该删除 yarn.lock 文件，且要提交到版本控制系统中，以免因为不同机器安装的包版本不一致引发问题。</strong></p><p>我们的常规操作(yarn add / yarn upgrade)都会自动更新 package.json 和 yarn.lock</p><h3 id="package-json-中的-resolutions-选项">package.json 中的 resolutions 选项</h3><p><strong>通过这个选项可以修改 yarn.lock 中某个 package 的版本</strong></p><p>假如你的项目依赖了 foo,foo 依赖了 bar@^1.0.0。假设 bar 现在有两个版本 1.0.0 和 1.1.0。很不幸，bar 在发布 1.1.0 的时候没有做好向后兼容。导致 foo 和 <a href="https://link.juejin.cn?target=mailto%3Abar%401.1.0" title="mailto:bar@1.1.0">bar@1.1.0</a> 不能搭配使用。如果你可以等：</p><ul><li>要么等 foo 把依赖 bar 锁成 1.0.0 并重新发版</li><li>要么等 bar 修复兼容问题后重新发版</li></ul><p>那如果你等不了呢，你已知 foo 和 <a href="https://link.juejin.cn?target=mailto%3Abar%401.0.0" title="mailto:bar@1.0.0">bar@1.0.0</a> 可以正常工作。如果你能锁住 foo 对 bar 的依赖就好了，但是这定义在 foo 的 packge.json 里，你总不能去改 node_modules/foo/package.json 吧？这不合适。resolutions 可以解决你的问题，只要在你自己项目的 package.json 里定义：</p><pre><code>&quot;resolutions&quot;: &#123;    &quot;foo/bar&quot;: &quot;1.0.0&quot;&#125;复制代码</code></pre><p>这里的 key&quot;foo/bar&quot;表示 foo 的直接依赖 bar，把版本区间重写成 1.0.0。如果 foo 不是直接依赖的 bar（foo -&gt; … -&gt; bar），我还需要把中间的链路都捋清楚吗？不用那么麻烦！</p><pre><code>&quot;resolutions&quot;: &#123;    &quot;foo/**/bar&quot;: &quot;1.0.0&quot;&#125;复制代码</code></pre><p>如果你的项目里有很多依赖直接/间接的依赖了 bar，每个定义的版本区间可能有差别，你知道某个版本可以让他们都能正常工作，而不用安装多个版本。也可以不用声明前缀部分，只写包名 bar。这样不管是哪里依赖到了 bar 都会指向你声明的哪个版本。</p><pre><code>&quot;resolutions&quot;: &#123;    &quot;bar&quot;: &quot;1.0.0&quot;&#125;复制代码</code></pre><p>执行 yarn install 后，在 yarn.lock 里搜索 bar@：</p><pre><code>bar@^1.0.0 bar@1.1.0 bar@^2.0.0:version &quot;1.0.0&quot;...复制代码</code></pre><p><strong>可以看到，resolutions 可以违背版本区间的限制，比如上例中 Identifiers 里的 <a href="https://link.juejin.cn?target=mailto%3Abar%401.1.0" title="mailto:bar@1.1.0">bar@1.1.0</a>``bar@^2.0.0。</strong></p><h3 id="yarn-frozen-lockfile-npm-ci">yarn --frozen-lockfile / npm ci</h3><p>即使有 lock file 的存在，也无法保证在持续集成环境中每次安装依赖都和开发时一致，因为可能存在 package.json 和 lockfile 版本号不匹配并需要更新依赖版本的情况。可以使用–frozen-lockfile 来避免。</p><p>这两个命令的作用类似，必须存在 lock file 且依赖版本和 package.json 匹配时才会安装依赖，否则报错。如此可强制开发者在持续集成前先在本地解决依赖版本的一致性问题。</p><h2 id="yarn-install-的过程">yarn install 的过程</h2><p>首次执行 yarn install 安装，会按照 package.json 中的语义化版本，去向 registry 进行查询，并获取到符合版本规则的最新的依赖包进行下载，并构建构建依赖关系树。 比如在 package.json 中指定 react 的版本为 ^2.0.0，就会获取符合 2.x.x</p><p>的最高版本的包。然后自动生成 yarn.lock 文件，并生成缓存。</p><p>之后再执行 yarn install，会对比 package.json 中依赖版本范围和 yarn.lock 中版本号是否匹配。</p><ul><li>版本号匹配：会根据 yarn.lock 中的 resolved 字段去查看缓存， 如果有缓存，直接 copy，没有缓存则按照 resolved 字段的 url 去下载包。</li><li>版本号不匹配：根据 package.json 中的版本范围去 registry 查询，下载符合版本规则最新的包，并更新至 yarn.lock 中。</li></ul><h2 id="模块扁平化">模块扁平化</h2><p>假设我项目的首层依赖(即当前项目的 dependence 和 devDependences 中的依赖，不包括依赖的依赖)中有 A，B，C 三个包，A 和 B 包同时依赖了相同版本范围的 D 包。那么这部分的依赖关系树是这样的：</p><pre><code>├── A│ └── D├── B│ └── D├── C</code></pre><p>如果按照这样的依赖关系树直接安装的话，D 模块会在 A 包和 B 包的 node_modules 中都安装，这样会导致模块冗余。</p><p>为了保证依赖关系树中没有大量重复模块，yarn 在安装时会做 dedupe（去重）操作，它会遍历所有节点，逐个将模块放在根节点下面，也就是当前项目的 node-modules 中。当发现有相同的模块时，会判断当前模块指定的版本范围是否交集，如果有，则只保留兼容版本，如果没有则在当前的包的 node-modules 下安装。</p><p>所以上面的说的情况，最终安装完成是下面这样的，A，B，C，D 包都会安装在第一层 node-modules 下（在依赖的 D 版本兼容的情况下）。</p><pre><code>├── A├── B├── C├── D</code></pre><p>如果 A 包和 B 包依赖的是不兼容的版本，假设 A 包依赖的是 D@1 版本的包，B 包依赖的是 D@2 版本。则最终安装的结果如下：</p><pre><code>├── A├── B│ └── D@2├── C├── D@1</code></pre><p>至于是 D 的那个版本被安装在根目录的 node_modules 下，取决的是模块解析的顺序，先解析到的 D 的指定版本会被安装到根 node_modules，后解析到的 D 且不兼容已有版本时，会被安装到对应模块的 node_modules 下</p>]]></content>
      
      
      <categories>
          
          <category> 包管理工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PackageJson 说明</title>
      <link href="/posts/7d8efc83.html"/>
      <url>/posts/7d8efc83.html</url>
      
        <content type="html"><![CDATA[<h3 id="Packages-json">Packages.json</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">name：项目<span class="operator">/</span>模块名称，长度必须小于等于<span class="number">214</span>个字符，不能以&quot;.&quot;(点)或者&quot;_&quot;(下划线)开头，不能包含大写字母。</span><br><span class="line"></span><br><span class="line">version：项目版本。</span><br><span class="line"></span><br><span class="line">author：项目开发者，它的值是你在https:<span class="operator">/</span><span class="operator">/</span>npmjs.org网站的有效账户名，遵循“账户名<span class="operator">&lt;</span>邮件<span class="operator">&gt;</span>”的规则，例如：zhangsan zhangsan<span class="variable">@163</span>.com。</span><br><span class="line"></span><br><span class="line">description：项目描述，是一个字符串。它可以帮助人们在使用npm <span class="keyword">search</span>时找到这个包。</span><br><span class="line"></span><br><span class="line">keywords：项目关键字，是一个字符串数组。它可以帮助人们在使用npm <span class="keyword">search</span>时找到这个包。</span><br><span class="line"></span><br><span class="line">private：是否私有，设置为 <span class="literal">true</span> 时，npm 拒绝发布。</span><br><span class="line"></span><br><span class="line">license：软件授权条款，让用户知道他们的使用权利和限制。</span><br><span class="line"></span><br><span class="line">bugs：bug 提交地址。</span><br><span class="line"></span><br><span class="line">contributors：项目贡献者 。</span><br><span class="line"></span><br><span class="line">repository：项目仓库地址。</span><br><span class="line"></span><br><span class="line">homepage：项目包的官网 URL。</span><br><span class="line"></span><br><span class="line">dependencies：生产环境下，项目运行所需依赖。</span><br><span class="line"></span><br><span class="line">devDependencies：开发环境下，项目所需依赖。</span><br><span class="line"></span><br><span class="line">scripts：执行 npm 脚本命令简写，比如 “<span class="keyword">start</span>”: “react<span class="operator">-</span>scripts <span class="keyword">start</span>”, 执行 npm <span class="keyword">start</span> 就是运行 “react<span class="operator">-</span>scripts <span class="keyword">start</span>”。</span><br><span class="line"></span><br><span class="line">bin：内部命令对应的可执行文件的路径。</span><br><span class="line"></span><br><span class="line">main：项目默认执行文件，比如 require(‘webpack’)；就会默认加载 lib 目录下的 webpack.js 文件，如果没有设置，则默认加载项目跟目录下的 index.js 文件。</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span>：是以 ES <span class="keyword">Module</span>(也就是 ES6)模块化方式进行加载，因为早期没有 ES6 模块化方案时，都是遵循 CommonJS 规范，而 CommonJS 规范的包是以 main 的方式表示入口文件的，为了区分就新增了 <span class="keyword">module</span> 方式，但是 ES6 模块化方案效率更高，所以会优先查看是否有 <span class="keyword">module</span> 字段，没有才使用 main 字段。</span><br><span class="line"></span><br><span class="line">eslintConfig：EsLint 检查文件配置，自动读取验证。</span><br><span class="line"></span><br><span class="line">engines：项目运行的平台。</span><br><span class="line"></span><br><span class="line">browserslist：供浏览器使用的版本列表。</span><br><span class="line"></span><br><span class="line">style：供浏览器使用时，样式文件所在的位置；样式文件打包工具parcelify，通过它知道样式文件的打包位置。</span><br><span class="line"></span><br><span class="line">files：被项目包含的文件名数组。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工程化 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>npm</title>
      <link href="/posts/a1345b2b.html"/>
      <url>/posts/a1345b2b.html</url>
      
        <content type="html"><![CDATA[<h2 id="NPM">NPM</h2><h3 id="npm-版本号解析">npm 版本号解析</h3><ul><li>语义版本号分为X.Y.Z三位，分别代表主版本号、次版本号和补丁版本号<ul><li>如果只是修复bug，需要更新Z位</li><li>如果是新增了功能，但是向下兼容，需要更新Y位</li><li>如果有大变动，向下不兼容，需要更新X位</li></ul></li></ul><h3 id="常用命令">常用命令</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> help可查看所有命令</span><br><span class="line"><span class="built_in">npm</span> install </span><br><span class="line"><span class="built_in">npm</span> -v</span><br><span class="line"><span class="built_in">npm</span> info:查看可以安装的版本</span><br><span class="line"><span class="built_in">npm</span> list -g ：查看全局安装的模块</span><br><span class="line"><span class="built_in">npm</span> uninstall ：卸载模块</span><br><span class="line"><span class="built_in">npm</span> ls  ：卸载之后查看是否还在</span><br><span class="line"><span class="built_in">npm</span> help:查看可用命令</span><br><span class="line"><span class="built_in">npm</span> update &lt;package&gt;可以把当前目录下node_modules子目录里边的对应模块更新至最新版本</span><br><span class="line"><span class="built_in">npm</span> update &lt;package&gt; -g可以把全局安装的对应命令行程序更新至最新版</span><br><span class="line"><span class="built_in">npm</span> cache clear可以清空NPM本地缓存，用于对付使用相同版本号发布新版本代码的人</span><br><span class="line">利用cnpm替换<span class="built_in">npm</span>来进行安装：</span><br><span class="line"><span class="built_in">npm</span> install -g cnpm --registry=https://registry.<span class="built_in">npm</span>.taobao.org</span><br><span class="line">cnpm install</span><br></pre></td></tr></table></figure><h3 id="工具">工具</h3><ul><li>NRM<ul><li>NPM源管理器</li></ul></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm install –g nrm (快速切换npm源)--附带测速功能</span><br><span class="line">nrm <span class="keyword">ls</span> :列出可选的源</span><br><span class="line">nrm use taobao</span><br><span class="line">Registry <span class="built_in">has</span> been <span class="keyword">set</span> <span class="keyword">to</span>: http://registry.npm.taobao.org/</span><br><span class="line">nrm test  ：测速</span><br><span class="line">nrm <span class="built_in">add</span>  <span class="symbol">&lt;registry&gt;</span> <span class="symbol">&lt;url&gt;</span> [home]  ：增加源</span><br><span class="line">nrm del <span class="symbol">&lt;registry&gt;</span>   ：删除源</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="私服搭建">私服搭建</h3><ul><li>sinopia</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sinopia –l http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.99</span>:<span class="number">4873</span></span><br><span class="line">npm set registry http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.99</span>:<span class="number">4873</span></span><br><span class="line">npm add user –registry http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.99</span>:<span class="number">4873</span></span><br></pre></td></tr></table></figure><h3 id="package-json">package.json</h3><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># antd</span><br><span class="line"><span class="string">&quot;peerDependencies&quot;</span>: &#123; </span><br><span class="line"><span class="string">&quot;react&quot;</span>: <span class="string">&quot;&gt;=16.0.0&quot;</span> <span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;react-dom&quot;</span>: <span class="string">&quot;&gt;=16.0.0&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"># my_project 在使用 antd 时也会同时安装 react、react-dom 包的依赖</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;clone&quot;</span>: <span class="string">&quot;~2.1.2&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="string">&quot;form-render&quot;</span>: <span class="string">&quot;^1.0.0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"># ~的意思是匹配最近的小版本 比如~<span class="number">1.0</span>.<span class="number">2</span>将会匹配所有的<span class="number">1.0</span>.<span class="keyword">x</span>版本，但不匹配<span class="number">1.1</span>.<span class="number">0</span> </span><br><span class="line"># ^的意思是最近的一个大版本 比如<span class="number">1.0</span>.<span class="number">2</span> 将会匹配 所有 <span class="number">1</span>.<span class="keyword">x</span>.<span class="keyword">x</span><span class="punctuation">,</span> 但不包括<span class="number">2</span>.<span class="keyword">x</span>.<span class="keyword">x</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="resolutions">resolutions</h3><ul><li>什么时候需要用到resolutions ？<ul><li><p>当项目会依赖一个不常更新的包，但这个包又依赖另一个需要立即升级的包。 这时候，如果这个（不常更新的）包的依赖列表里不包含需要升级的包的新版本，那就只能等待作者升级，没别的办法。</p></li><li><p>项目的子依赖（依赖的依赖）需要紧急安全更新，来不及等待直接依赖更新。</p></li><li><p>项目的直接依赖还可以正常工作但已经停止维护，这时子依赖需要更新。 同时，你清楚子依赖的更新不会影响现有系统，但是又不想通过 fork 的方式来升级直接依赖。</p></li><li><p>项目的直接依赖定义了过于宽泛的子依赖版本范围，恰巧这其中的某个版本有问题，这时你想要把子依赖限制在某些正常工作的版本范围里。</p></li></ul></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;project&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;left-pad&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;resolutions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;left-pad/aa&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.1.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;left-pad/bb&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.1.2&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="发布npm包的步骤如下：">发布npm包的步骤如下：</h3><ol><li><p>创建项目：首先，你需要创建一个项目文件夹，并在其中初始化一个npm项目。在终端中导航到你的项目文件夹，并运行以下命令：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> init</span><br></pre></td></tr></table></figure><p>按照提示填写项目的相关信息，例如包名、版本、描述等。</p></li><li><p>编写代码：将你的代码编写在项目文件夹中的相应文件中。</p></li><li><p>设置入口文件：在项目的<code>package.json</code>文件中，将<code>main</code>字段设置为你的代码的入口文件。</p></li><li><p>配置依赖项：如果你的项目依赖其他的npm包，你需要在<code>package.json</code>文件中的<code>dependencies</code>字段或者<code>devDependencies</code>字段中添加相应的依赖项。</p></li><li><p>测试代码：确保你的代码符合预期并且没有错误。可以使用测试框架（如Mocha、Jest等）编写测试用例，并在终端运行测试命令来确保代码的正确性。</p></li><li><p>发布包：在终端中运行以下命令发布你的包：</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> publish</span><br></pre></td></tr></table></figure><p>这会将你的包发布到npm的包注册表上，并且可以被其他人安装和使用。在发布之前，确保你已经登录到npm账号。如果你还没有账号，可以使用npm adduser命令来创建一个新账号。</p></li><li><p>更新包：如果你的包有新的版本，你可以通过更新<code>package.json</code>文件中的版本号，并重新运行<code>npm publish</code>命令来发布更新后的包。</p></li></ol><p>请注意，发布npm包之前，确保你已经在npm上注册了账号，并且在<code>本地登录</code>了该账号，可以通过<code>npm login</code>命令进行登录。此外，还需要确保你的包名在npm上没有被其他人使用过，以避免命名冲突。</p><h3 id="windows-环境">windows 环境</h3><ul><li><a href="https://github.com/coreybutler/nvm-windows/releases">多版本nodejs管理工具nvm for windows</a></li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nvm off                     <span class="regexp">//</span>禁用node.js版本管理(不卸载任何东西)</span><br><span class="line">nvm on                      <span class="regexp">//</span>启用node.js版本管理</span><br><span class="line">nvm install &lt;version&gt;       <span class="regexp">//</span>安装node.js的命名 version是版本号 例如：nvm install <span class="number">8.12</span>.<span class="number">0</span></span><br><span class="line">nvm uninstall &lt;version&gt;     <span class="regexp">//</span>卸载node.js是的命令，卸载指定版本的nodejs，当安装失败时卸载使用</span><br><span class="line">nvm list                    <span class="regexp">//</span>显示所有安装的node.js版本</span><br><span class="line">nvm list available          <span class="regexp">//</span>显示可以安装的所有node.js的版本</span><br><span class="line">nvm use &lt;version&gt;           <span class="regexp">//</span>切换到使用指定的nodejs版本</span><br></pre></td></tr></table></figure><h3 id="Mac-环境">Mac 环境</h3><ul><li>使用方式</li></ul><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm i <span class="built_in">n</span> -g</span><br><span class="line"></span><br><span class="line">安装最新版本</span><br><span class="line">$ <span class="built_in">n</span> latest</span><br><span class="line"></span><br><span class="line">安装指定版本</span><br><span class="line">$ <span class="built_in">n</span> node/<span class="number">13.11</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line">切换 nodejs 版本</span><br><span class="line"><span class="built_in">n</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>切换之后，未生效处理方式</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">查看 node 当前安装路径</span><br><span class="line">$ <span class="built_in">which</span> node</span><br><span class="line">/usr/local/bin/node</span><br><span class="line"></span><br><span class="line">编辑配置文件</span><br><span class="line">$ vi ~/.bash_profile</span><br><span class="line"></span><br><span class="line">将下边两行插入到文件末尾：</span><br><span class="line"><span class="built_in">export</span> N_PREFIX=/usr/local</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$N_PREFIX</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">生效 .bash_profile 文件</span><br><span class="line">$ <span class="built_in">source</span> ~/.bash_profile</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>设置NPM全局目录【防止切换版本时全局包丢失】</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm<span class="built_in"> config </span><span class="built_in">get</span><span class="built_in"> prefix</span></span><br><span class="line"><span class="built_in"></span>npm<span class="built_in"> config </span><span class="built_in">get</span> cache</span><br><span class="line"></span><br><span class="line">npm<span class="built_in"> config </span><span class="built_in">set</span> cache D:\nvm\node_cache</span><br><span class="line">npm<span class="built_in"> config </span><span class="built_in">set</span><span class="built_in"> prefix </span>D:\nvm\node_global</span><br></pre></td></tr></table></figure><ul><li>npm 全局安装设置和缓存设置</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">查看当前npm包的全局安装路径：</span><br><span class="line">npm prefix -g</span><br><span class="line"></span><br><span class="line">查看配置列表：</span><br><span class="line">npm config <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">修改npm的包的全局安装路径：</span><br><span class="line">npm config <span class="built_in">set</span> prefix <span class="string">&quot;D:\nodejs\npm_global&quot;</span></span><br><span class="line"></span><br><span class="line">修改npm的包的全局cache位置:</span><br><span class="line">npm config <span class="built_in">set</span> cache <span class="string">&quot;D:\nodejs\npm-cache&quot;</span></span><br><span class="line"></span><br><span class="line">需要将 D:\nodejs\npm_global 添加进系统环境变量中，这里文添加进用户变量中。</span><br></pre></td></tr></table></figure><ul><li>yarn 的安装路径和缓存路径</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">查看 yarn 全局安装位置：</span><br><span class="line">yarn global <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line">查看 yarn 全局cache位置:</span><br><span class="line">yarn cache <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line">改变 yarn 全局安装位置</span><br><span class="line">yarn config <span class="built_in">set</span> global-folder <span class="string">&quot;D:\nodejs\yarn\global&quot;</span></span><br><span class="line"></span><br><span class="line">改变 yarn 全局cache位置:</span><br><span class="line">yarn config <span class="built_in">set</span> cache-folder <span class="string">&quot;D:\nodejs\yarn\cache&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意！以上命令需要用管理员运行cmd，执行相应的命令，否则会报错，让你怀疑人生，且网上查不到相应的报错信息。而且设置完这些路径后，卸载nodejs再重装，也不会恢复默认，估计只有重装系统才能恢复默认了。</p>]]></content>
      
      
      <categories>
          
          <category> 包管理工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>maven</title>
      <link href="/posts/c6e613d8.html"/>
      <url>/posts/c6e613d8.html</url>
      
        <content type="html"><![CDATA[<h2 id="Maven">Maven</h2><ul><li>maven的世界中拥有数量非常巨大的构件，也就是平时用的一些jar,war等文件</li><li>中央仓库 <a href="http://repol.maven.org/maven2">http://repol.maven.org/maven2</a></li><li>每个构件的 Maven 坐标<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">&lt;groupId&gt;</span>com.jiahao<span class="variable">&lt;/groupId&gt;</span> </span><br><span class="line"><span class="variable">&lt;artifactId&gt;</span>hello-world<span class="variable">&lt;/artifactId&gt;</span> </span><br><span class="line"><span class="variable">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="variable">&lt;/version&gt;</span> </span><br><span class="line"><span class="variable">&lt;packaging&gt;</span>jar<span class="variable">&lt;/packaging&gt;</span> </span><br><span class="line"><span class="variable">&lt;name&gt;</span>hello_world<span class="variable">&lt;/name&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GroupID 是项目组织唯一的标识符，实际对应JAVA的包的结构，是main目录里java的目录结构</span></span><br><span class="line"><span class="comment"># ArtifactID是项目的唯一的标识符，实际对应项目的名称，就是项目根目录的名称</span></span><br><span class="line"><span class="comment"># Version 指定项目的当前版本，SNAPSHOT意为快照，说明该项目还处于开发中，是不稳定的版本</span></span><br><span class="line"><span class="comment"># Packaging 指定打包类型，maven会使用默认值jar</span></span><br><span class="line"><span class="comment"># Name 声明一个对于用户更为友好的项目名称，不是必须的，推荐为每个pom声明name，以方便信息交流</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 包管理工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cornerStore</title>
      <link href="/posts/feb90814.html"/>
      <url>/posts/feb90814.html</url>
      
        <content type="html"><![CDATA[<h3 id="cornerStone">cornerStone</h3><p>cornerStone 使用方式介绍：<br><a href="https://www.jianshu.com/p/7f5c019c528b">https://www.jianshu.com/p/7f5c019c528b</a><br>密码：<a href="http://www.ifunmac.com">www.ifunmac.com</a></p><h2 id="cornerstone">cornerstone</h2><p>免费试用方法：<br>1. 删除 /Users/jiahao/Library/Preferences/ByHost 这个文件</p><h2 id="文件毁坏问题修复">文件毁坏问题修复</h2><pre><code>1. 安全性与隐私 打开 任何来源$&gt; sudo spctl --master-disable如若不行$&gt; sudo xattr -r -d com.apple.quarantine /Applications/Cornerstone.app</code></pre>]]></content>
      
      
      <categories>
          
          <category> 包管理工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Git指令</title>
      <link href="/posts/379d76b8.html"/>
      <url>/posts/379d76b8.html</url>
      
        <content type="html"><![CDATA[<p>Git<br>快速-开源-分布式版本控制系统<br>林纳斯•托瓦兹—15天用c语言写出震惊天下的git系统.<br><a href="http://msysgit.github.io">http://msysgit.github.io</a><br><code>载并安装git客户端</code><br>配置git账户<br>git config –-global <a href="http://user.name">user.name</a> “qiaogy”<br>git config –-global user.email <a href="mailto:15029218541@qq.com">15029218541@qq.com</a><br>git config –-global color.ui true<br>注册+检查.ssh密钥<br>创建SSHKey:ssh-keygen -t rsa -C <a href="mailto:15029218541@163.com">15029218541@163.com</a><br>生成文件地址：~/.ssh/id_rsa.pub文件中<br>git config --list</p><p>客户端吉祥物：漳狸猫<br>几种常见的版本管理工具：<br>SVN:集中式的版本管理系统 !<br>CVS:最早的版本控制管理系统 !<br>Sync:同步！</p><p>设置git默认的文本编辑器：git config --global core.editor atom/Visual Studio Code/Notepad++<br>打开编辑器: atom / Notepad++</p><p>常用命令</p><p>$ mkdir test:本地创建test目录<br>$ git init :初始化仓库<br>$ clear<br>$ touch a.txt：新建文件<br>$ touch README：创建一个自述文件<br>$ git status:查看文件是否纳入git管理<br>$ git add a.txt：新增文件<br>$ git add . :提交当前项目所有文件<br>$ git commit a.txt:提交git本地库<br>$ git diff 展示改动的具体信息<br>：q退出提交<br>$ git commit -m “create file 00” a.txt进行重新提交。<br>-m:用于书写注释<br>$ vi a.txt<br>$ git commit -m “update file 01” a.txt<br>以上文件提交到本地git管理<br>$ git log  --pretty=oneline <br>:查看历史记录<br>$ git reset --hard HEAD^:回退到上一个版本<br>$ git reset HEAD 命令用于取消已缓存的内容。<br>$ git reset HEAD --hello.php：<br>之前改动之后提交到暂存区的hello.php在你下次git commit 时不会被提交<br>$ git rm file:从缓存区和你本地工作目录中删除掉<br>$ git reflog:记录每一次命令<br>$ git reset commit_id:在历史版本间穿梭</p><p>上传至GitHub <br>$ git remote add origin <a href="https://github.com/mowangchuzhong/test.git">https://github.com/mowangchuzhong/test.git</a><br>$ git push -u origin master:服务器文件路径<br>的<br>$ git ls-files<br>$ git clone 服务器文件地址<br>//------------------------<br>日志，版本号，对比不同</p><p>$ git log a.txt:查看你commit的日志<br>$ git log --pretty=oneline a.txt<br>查看每行的修改<br>$ git diff a.txt:查看尚未提交的内容。<br>$ git cat a.txt<br>//--------------<br>版本回退，版本穿梭，版本撤销<br>$ git reset --hard HEAD^:版本回退一步<br>回退一个月的做法：<br>$ git reflog a.txt:查看版本号<br>$ git reset --hard afddbfa ，其中afddbfa是你所要回退那天的&quot;前缀&quot;！！<br>$ git reset --hard HEAD~40:回退40步！<br>//---------------------!!!三区!!!<br>理解工作区，版本库，暂存区(后一页)<br>本地修改内容后，过段时间再新增文件，此时文件保存在暂存区(index)，没有进git仓库!!!<br>commit后才提交到git仓库。<br>:wq!:???<br>$ git checkout --a.txt:新建过，撤销未add的文件<br>先$ git reset HEAD a.txt再git checkout --a.txt:撤销已add到暂存区的文件<br>$ git reset --hard HEAD^:撤销已add已commit 的文件一步----穿梭！<br>//------------------------<br>删除文件，删完提交<br>$ touch b.txt<br>$ git rm -f b.txt--------绿色delete b.txt<br>$ git commit-m “delete b.txt”----彻底将删除文件脱离git 管理。<br>红色代表本地修改，未进暂存区，绿色进去暂存区！<br>//-------------------!!!重要!!!<br>分支：<br>开发分支：master主分支(火锅的老汤)<br>主分支<br>开发分支<br>信测性分支<br>发布版本分支<br>bug分支<br>(查看，新建，切换，合并(分支名),删除)<br>$ git branch     ：查看所有分支<br>//----------<br>$ git checkout master:切换到主分支<br>$ git branch dev ：新建dev分支<br>$ git checkout dev：跟分支名即切换<br>Switched to branch ‘dev’<br>与下面该代码等同！<br>$ git checkout -b dev;创建dev分支并切换到该分支下<br>$  git  branch -d dev:删除dev分支<br>//---------------<br>$ git checkout --b.txt：回撤！！！！<br>$ 1s -1:把主分支克隆镜像了一份！<br>在master 分支合并dev这个分支的命令：<br>$ git merge dev：<br>在客户端与远程master合并：rebase <br>重点：合并<br>$ git commit -m  “fix conflict bug”<br>版本冲突：<br>我一开片，从master主分支拷贝过来一份，<br>进行更新，在我提交之前，最好要做同步，但是我现在没有做同步，master 往上走了一步，找不到原来那个点了，即撞车！服务器版本比我dev版本新了。<br>冲突会在标识符之间进行展示。<br>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;  HEAD    (本地分支)<br>         <a href="mailto:happyperter189@163.com">happyperter189@163.com</a><br>===========分隔符<br>         <a href="mailto:billinader@289.com">billinader@289.com</a>(远端分支)</p><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><p>origin/master</p></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><p>删除：<br>切换到主分支然后<br>$ git branch -d dev<br>$ git checkout -b UIUE：<br>新建一个UIUI设计交互的目录，并切换到该目录下面！<br>//---------------------</p><p>//-----------<br>实现本地与远程库的连接<br>连接GitHub <br>origin:远程库的默认名<br>$ git push origin master：把本地文件上传到github 上<br>$ git pull origin master:从github 上获取文件<br>公司干活的第一步<br>//---------------------------<br>LocalRepository&lt;—&gt;RemoteReposity<br>Fork:以第三方来clone一份，修改—横向修复！<br>commit：提交<br>pull Request:把clone 修改后的文件再提交给别人。<br>File changed：修改的内容<br>merge pull request 同意合并</p><p>//-------<br>collaborators:合作者<br>基于GitHub flow:团队开发。<br>开源项目的贡献！！！</p><p>//----------------------<br>仓库地址：git@git.linewin.cc:erp/front<br>git clone <a href="mailto:git@git.linewin.cc">git@git.linewin.cc</a>:erp/front<br>git branch <br>master<br>git checkout -b dev ：新建并切换到dev分支上<br>git push origin dev:dev    :提交本地dev分支作为远程的dev分支<br>git push origin service:service    :提交本地service分支作为远程的service分支<br>git branch -a：查看所有分支<br>master<br>dev<br>service<br>git checkout service:切换到service分支上<br><code>npm install</code><br>接下来就在service分支上做开发：<br>git add .<br>git commit -m “ver01”<br>git push  -u origin master<br>-u:进行远程和本地分支的关联<br>输入用户名、密码即可进行提交</p><h2 id=""></h2><p>主分支clone地址：<a href="https://github.com/mowangchuzhong/vue-router.git">https://github.com/mowangchuzhong/vue-router.git</a><br>侧分支clone地址：<a href="https://github.com/mowangchuzhong/vue-router.git">https://github.com/mowangchuzhong/vue-router.git</a><br>!!!</p><h2 id="-2"></h2><p>git pull origin  service:拉取远程service上最新版本。<br>做更改，切换到dev分支：<br>git merge origin/service:将service分支与当前分支(dev)分支进行合并 <br><code>注意：在合并过程中可能会出现版本冲突</code><br>··在提交之前最好要做同步，没有做同步，服务器版本比我的dev版本新了，冲突会在标识符之间进行展示。<br>&lt;&lt;&lt;&lt;&lt; HEAD  (本地分支)<br><a href="mailto:happyperter189@163.com">happyperter189@163.com</a><br>=======================分隔符<br><a href="mailto:billinader@289.com">billinader@289.com</a><br>&gt;&gt;&gt;&gt;&gt;&gt;  origin/master<br>git add .<br>git commit -m “version02”<br>git push -u origin dev<br>gitlab地址：<a href="http://jack.li">jack.li</a>@carlt.com.cn<br>密码：jack.li123<br>npm install<br>git  checkout   master：切换到master分支：<br>git  merge  origin/dev<br>即可完成项目的整体开发。</p><p>删除远程分支：<br>Git push origin --delete branchName<br>删除没有对应远程分支的本地分支：<br>Git branch -d  branchName</p><p>//git 报错处理案例：<br>1.<br>error :setting certificate verify locations:<br>处理方式：git config –-system http.sslverify false</p><p><strong>隐藏本地修改、拉取远程代码块</strong><br>1.输入 git status 查看本地的修改</p><p>2.输入git stash 隐藏掉本地修改</p><p>3.输入 git pull 从代码库拉取更新</p><p>4.输入 git stash pop stash@{版本号}</p><p>5.然后再git add git commit git push 就行了</p><h3 id="Git">Git</h3><p>git pull origin master</p><blockquote><p>相当于 git fetch + git merge FETCH_HEAD</p></blockquote><p>git pull origin master  --rebase</p><blockquote><p>相当于 git fetch + git rebase FETCH_HEAD</p></blockquote><p>git merge</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$master</span>&gt; git <span class="keyword">merge</span> dev</span><br><span class="line">是将两个分支的末端节点和他们最近的共同祖先节点，这三个节点的文件快照做一个三方合并,生成一个新的commit</span><br></pre></td></tr></table></figure><p>git rebase</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$<span class="literal">master</span>&gt; git rebase dev</span><br><span class="line"></span><br><span class="line">举例子来说，比如dev要合并到<span class="literal">master</span>上</span><br><span class="line">- 先找到两个分支最近的共同祖先节点，然后将<span class="literal">master</span>分支上从这个节点之后的所有提交都提取出来放到本地文件夹下作为补丁文件存放。</span><br><span class="line">- 将<span class="literal">master</span>拉取到dev分支的最新节点</span><br><span class="line">- 依次将存放的补丁文件一个一个应用到<span class="literal">master</span>上</span><br></pre></td></tr></table></figure><h3 id="指令">指令</h3><h2 id="Git-常用命令git-branch-查看本地所有分支git-status-查看当前状态git-commit-提交git-branch-a-查看所有的分支git-branch-r-查看本地所有分支git-commit-am-“init”-提交并且加注释git-remote-add-origin-git-192-168-1-119-ndshowgit-push-origin-master-将文件给推到服务器上git-remote-show-origin-显示远程库origin里的资源git-push-origin-master-developgit-push-origin-master-hb-dev-将本地库与服务器上的库进行关联git-checkout-track-origin-dev-切换到远程dev分支git-branch-D-master-develop-删除本地库developgit-checkout-b-dev-建立一个新的本地分支devgit-merge-origin-dev-将分支dev与当前分支进行合并git-checkout-dev-切换到本地dev分支git-remote-show-查看远程库git-add-git-rm-文件名-包括路径-从git中删除指定文件git-clone-git-github-com-schacon-grit-git-从服务器上将代码给拉下来git-config-list-看所有用户git-ls-files-看已经被提交的git-rm-file-name-删除一个文件git-commit-a-提交当前repos的所有的改变git-add-file-name-添加一个文件到git-indexgit-commit-v-当你用－v参数的时候可以看commit的差异git-commit-m-“This-is-the-message-describing-the-commit”-添加commit信息git-commit-a-a是代表add，把所有的change加到git-index里然后再commitgit-commit-a-v-一般提交命令git-log-看你commit的日志git-diff-查看尚未暂存的更新git-rm-a-a-移除文件-从暂存区和工作区中删除-git-rm-cached-a-a-移除文件-只从暂存区中删除-git-commit-m-“remove”-移除文件-从Git中删除-git-rm-f-a-a-强行移除修改后文件-从暂存区和工作区中删除-git-diff-cached-或-git-diff-staged-查看尚未提交的更新git-stash-push-将文件给push到一个临时空间中git-stash-pop-将文件从临时空间pop下来">Git 常用命令<br>git branch 查看本地所有分支<br>git status 查看当前状态<br>git commit 提交<br>git branch -a 查看所有的分支<br>git branch -r 查看本地所有分支<br>git commit -am “init” 提交并且加注释<br>git remote add origin <a href="mailto:git@192.168.1.119">git@192.168.1.119</a>:ndshow<br>git push origin master 将文件给推到服务器上<br>git remote show origin 显示远程库origin里的资源<br>git push origin master:develop<br>git push origin master:hb-dev 将本地库与服务器上的库进行关联<br>git checkout --track origin/dev 切换到远程dev分支<br>git branch -D master develop 删除本地库develop<br>git checkout -b dev 建立一个新的本地分支dev<br>git merge origin/dev 将分支dev与当前分支进行合并<br>git checkout dev 切换到本地dev分支<br>git remote show 查看远程库<br>git add .<br>git rm 文件名(包括路径) 从git中删除指定文件<br>git clone git://github.com/schacon/grit.git 从服务器上将代码给拉下来<br>git config --list 看所有用户<br>git ls-files 看已经被提交的<br>git rm [file name] 删除一个文件<br>git commit -a 提交当前repos的所有的改变<br>git add [file name] 添加一个文件到git index<br>git commit -v 当你用－v参数的时候可以看commit的差异<br>git commit -m “This is the message describing the commit” 添加commit信息<br>git commit -a -a是代表add，把所有的change加到git index里然后再commit<br>git commit -a -v 一般提交命令<br>git log 看你commit的日志<br>git diff 查看尚未暂存的更新<br>git rm a.a 移除文件(从暂存区和工作区中删除)<br>git rm --cached a.a 移除文件(只从暂存区中删除)<br>git commit -m “remove” 移除文件(从Git中删除)<br>git rm -f a.a 强行移除修改后文件(从暂存区和工作区中删除)<br>git diff --cached 或 $ git diff --staged 查看尚未提交的更新<br>git stash push 将文件给push到一个临时空间中<br>git stash pop 将文件从临时空间pop下来</h2><h2 id="git-remote-add-origin-git-github-com-username-Hello-World-gitgit-push-origin-master-将本地项目给提交到服务器中">git remote add origin <a href="mailto:git@github.com">git@github.com</a>:username/Hello-World.git<br>git push origin master 将本地项目给提交到服务器中</h2><h2 id="git-pull-本地与服务器端同步">git pull 本地与服务器端同步</h2><h2 id="git-push-远程仓库名-分支名-将本地分支推送到服务器上去。git-push-origin-serverfix-awesomebranch">git push (远程仓库名) (分支名) 将本地分支推送到服务器上去。<br>git push origin serverfix:awesomebranch</h2><p>git fetch 相当于是从远程获取最新版本到本地，不会自动merge<br>git commit -a -m “log_message” (-a是提交所有改动，-m是加入log信息) 本地修改同步至服务器端 ：<br>git branch branch_0.1 master 从主分支master创建branch_0.1分支<br>git branch -m branch_0.1 branch_1.0 将branch_0.1重命名为branch_1.0<br>git checkout branch_1.0/master 切换到branch_1.0/master分支<br>du -hs</p><hr><p>mkdir WebApp<br>cd WebApp<br>git init<br>touch README<br>git add README<br>git commit -m ‘first commit’<br>git remote add origin <a href="mailto:git@github.com">git@github.com</a>:daixu/WebApp.git<br>git push -u origin master</p><p>Git常用操作命令：</p><ol><li>远程仓库相关命令<br>检出仓库：$ git clone git://github.com/jquery/jquery.git<br>查看远程仓库：$ git remote -v<br>添加远程仓库：$ git remote add [name] [url]<br>删除远程仓库：$ git remote rm [name]<br>修改远程仓库：$ git remote set-url --push [name] [newUrl]<br>拉取远程仓库：$ git pull [remoteName] [localBranchName]<br>推送远程仓库：$ git push [remoteName] [localBranchName]</li></ol><p>*如果想把本地的某个分支test提交到远程仓库，并作为远程仓库的master分支，或者作为另外一个名叫test的分支，如下：<br>$git push origin test:master         // 提交本地test分支作为远程的master分支<br>$git push origin test:test              // 提交本地test分支作为远程的test分支</p><p>2）分支(branch)操作相关命令<br>查看本地分支：$ git branch<br>查看远程分支：$ git branch -r<br>创建本地分支：$ git branch [name] ----注意新分支创建后不会自动切换为当前分支<br>切换分支：$ git checkout [name]<br>创建新分支并立即切换到新分支：$ git checkout -b [name]<br>删除分支：$ git branch -d [name] ---- -d选项只能删除已经参与了合并的分支，对于未有合并的分支是无法删除的。如果想强制删除一个分支，可以使用-D选项<br>合并分支：$ git merge [name] ----将名称为[name]的分支与当前分支合并<br>创建远程分支(本地分支push到远程)：$ git push origin [name]<br>删除远程分支：$ git push origin :heads/[name] 或 $ gitpush origin :[name]</p><p>*创建空的分支：(执行命令之前记得先提交你当前分支的修改，否则会被强制删干净没得后悔)<br>$git symbolic-ref HEAD refs/heads/[name]<br>$rm .git/index<br>$git clean -fdx</p><p>3）版本(tag)操作相关命令<br>查看版本：$ git tag<br>创建版本：$ git tag [name]<br>删除版本：$ git tag -d [name]<br>查看远程版本：$ git tag -r<br>创建远程版本(本地版本push到远程)：$ git push origin [name]<br>删除远程版本：$ git push origin :refs/tags/[name]<br>合并远程仓库的tag到本地：$ git pull origin --tags<br>上传本地tag到远程仓库：$ git push origin --tags<br>创建带注释的tag：$ git tag -a [name] -m ‘yourMessage’</p><ol start="4"><li>子模块(submodule)相关操作命令<br>添加子模块：$ git submodule add [url] [path]<br>如：$git submodule add git://github.com/soberh/ui-libs.git src/main/webapp/ui-libs<br>初始化子模块：$ git submodule init  ----只在首次检出仓库时运行一次就行<br>更新子模块：$ git submodule update ----每次更新或切换分支后都需要运行一下<br>删除子模块：（分4步走哦）</li><li>$ git rm --cached [path]</li><li>编辑“.gitmodules”文件，将子模块的相关配置节点删除掉</li><li>编辑“ .git/config”文件，将子模块的相关配置节点删除掉</li><li>手动删除子模块残留的目录</li></ol><p>5）忽略一些文件、文件夹不提交<br>在仓库根目录下创建名称为“.gitignore”的文件，写入不需要的文件夹名或文件，每个元素占一行即可，如<br>target<br>bin<br>*.db</p>]]></content>
      
      
      <categories>
          
          <category> 版本管理 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Tcp-Ip</title>
      <link href="/posts/d25b1680.html"/>
      <url>/posts/d25b1680.html</url>
      
        <content type="html"><![CDATA[<h3 id="TCP-IP模型">TCP/IP模型</h3><ul><li>一系列网络协议的总称</li><li>目的:使计算机之间可以进行信息交换。</li></ul><h3 id="TCP-IP模型的四层结构">TCP/IP模型的四层结构</h3><ol><li>连接层负责建立电路连接，是整个网络的物理基础，典型的协议包括以太网、ADSL(网络接口)等等；</li><li>网络层负责分配地址和传送二进制数据，主要协议是IP协议；</li><li>传输层负责传送文本数据，主要协议是TCP协议；</li><li>应用层负责传送各种最终形态的数据，是直接与用户打交道的层，典型协议是HTTP、FTP等。</li></ol><p>端口:其实是TCP协议的一个参数，用来帮助TCP协议判断对方主机传来的文本，到底使用的是哪一种应用层协议。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WebSocket心跳监测</title>
      <link href="/posts/c793072c.html"/>
      <url>/posts/c793072c.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">为什么会进行心跳检测</span><br><span class="line">简单地说是为了证明客户端和服务器还活着。websocket 在使用过程中，如果遭遇网络问题等，这个时候服务端没有触发onclose事件，这样会产生多余的连接，并且服务端会继续发送消息给客户端，造成数据丢失。因此需要一种机制来检测客户端和服务端是否处于正常连接的状态，心跳检测和重连截止就产生了。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如何进行心跳检测和重连</span><br><span class="line">思路是：</span><br><span class="line"></span><br><span class="line">每隔一段指定的时间（计时器），向服务器发送一个数据，服务器收到数据后再发送给客户端，正常情况下客户端通过onmessage事件是能监听到服务器返回的数据的，说明请求正常。</span><br><span class="line">如果再这个指定时间内，客户端没有收到服务器端返回的响应消息，就判定连接断开了，使用websocket.close关闭连接。</span><br><span class="line">这个关闭连接的动作可以通过onclose事件监听到，因此在 onclose 事件内，我们可以调用reconnect事件进行重连操作。</span><br><span class="line"></span><br><span class="line">$(function () &#123;</span><br><span class="line"><span class="code">    var path = basePath;</span></span><br><span class="line"><span class="code">    var jspCode = $(&quot;#userId&quot;).val();</span></span><br><span class="line"><span class="code">    var websocket;</span></span><br><span class="line"><span class="code">    createWebSocket();</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    /**</span></span><br><span class="line"><span class="code">     * websocket启动</span></span><br><span class="line"><span class="code">     */</span></span><br><span class="line"><span class="code">    function createWebSocket() &#123;</span></span><br><span class="line"><span class="code">        try &#123;</span></span><br><span class="line"><span class="code">            if (&#x27;WebSocket&#x27; in window) &#123;</span></span><br><span class="line"><span class="code">                websocket = new WebSocket((path + &quot;/wsCrm?jspCode=&quot; + jspCode).replace(&quot;http&quot;, &quot;ws&quot;).replace(&quot;https&quot;, &quot;ws&quot;));</span></span><br><span class="line"><span class="code">            &#125; else if (&#x27;MozWebSocket&#x27; in window) &#123;</span></span><br><span class="line"><span class="code">                websocket = new MozWebSocket((&quot;ws://&quot; + path + &quot;/wsCrm?jspCode=&quot; + jspCode).replace(&quot;http&quot;, &quot;ws&quot;).replace(&quot;https&quot;, &quot;ws&quot;));</span></span><br><span class="line"><span class="code">            &#125; else &#123;</span></span><br><span class="line"><span class="code">                websocket = new SockJS(path + &quot;/wsCrm/sockJs?jspCode=&quot; + jspCode.replace(&quot;http&quot;, &quot;ws&quot;));</span></span><br><span class="line"><span class="code">            &#125;</span></span><br><span class="line"><span class="code">            init();</span></span><br><span class="line"><span class="code">        &#125; catch (e) &#123;</span></span><br><span class="line"><span class="code">            console.log(&#x27;catch&#x27; + e);</span></span><br><span class="line"><span class="code">            reconnect();</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    function init() &#123;</span></span><br><span class="line"><span class="code">        //连接成功建立的回调方法</span></span><br><span class="line"><span class="code">        websocket.onopen = function (event) &#123;</span></span><br><span class="line"><span class="code">            console.log(&quot;WebSocket:已连接&quot;);</span></span><br><span class="line"><span class="code">            //心跳检测重置</span></span><br><span class="line"><span class="code">            heartCheck.reset().start();</span></span><br><span class="line"><span class="code">        &#125;;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        //接收到消息的回调方法</span></span><br><span class="line"><span class="code">        websocket.onmessage = function (event) &#123;</span></span><br><span class="line"><span class="code">            showNotify(event.data);</span></span><br><span class="line"><span class="code">            console.log(&quot;WebSocket:收到一条消息&quot;, event.data);</span></span><br><span class="line"><span class="code">            heartCheck.reset().start();</span></span><br><span class="line"><span class="code">        &#125;;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        //连接发生错误的回调方法</span></span><br><span class="line"><span class="code">        websocket.onerror = function (event) &#123;</span></span><br><span class="line"><span class="code">            console.log(&quot;WebSocket:发生错误&quot;);</span></span><br><span class="line"><span class="code">            reconnect();</span></span><br><span class="line"><span class="code">        &#125;;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        //连接关闭的回调方法</span></span><br><span class="line"><span class="code">        websocket.onclose = function (event) &#123;</span></span><br><span class="line"><span class="code">            console.log(&quot;WebSocket:已关闭&quot;);</span></span><br><span class="line"><span class="code">            heartCheck.reset();//心跳检测</span></span><br><span class="line"><span class="code">            reconnect();</span></span><br><span class="line"><span class="code">        &#125;;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span><br><span class="line"><span class="code">        window.onbeforeunload = function () &#123;</span></span><br><span class="line"><span class="code">            websocket.close();</span></span><br><span class="line"><span class="code">        &#125;;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        //关闭连接</span></span><br><span class="line"><span class="code">        function closeWebSocket() &#123;</span></span><br><span class="line"><span class="code">            websocket.close();</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        //发送消息</span></span><br><span class="line"><span class="code">        function send(message) &#123;</span></span><br><span class="line"><span class="code">            websocket.send(message);</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    //避免重复连接</span></span><br><span class="line"><span class="code">    var lockReconnect = false, tt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    /**</span></span><br><span class="line"><span class="code">     * websocket重连</span></span><br><span class="line"><span class="code">     */</span></span><br><span class="line"><span class="code">    function reconnect() &#123;</span></span><br><span class="line"><span class="code">        if (lockReconnect) &#123;</span></span><br><span class="line"><span class="code">            return;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">        lockReconnect = true;</span></span><br><span class="line"><span class="code">        tt &amp;&amp; clearTimeout(tt);</span></span><br><span class="line"><span class="code">        tt = setTimeout(function () &#123;</span></span><br><span class="line"><span class="code">            console.log(&#x27;重连中...&#x27;);</span></span><br><span class="line"><span class="code">            lockReconnect = false;</span></span><br><span class="line"><span class="code">            createWebSocket();</span></span><br><span class="line"><span class="code">        &#125;, 4000);</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    /**</span></span><br><span class="line"><span class="code">     * websocket心跳检测</span></span><br><span class="line"><span class="code">     */</span></span><br><span class="line"><span class="code">    var heartCheck = &#123;</span></span><br><span class="line"><span class="code">        timeout: 5000,</span></span><br><span class="line"><span class="code">        timeoutObj: null,</span></span><br><span class="line"><span class="code">        serverTimeoutObj: null,</span></span><br><span class="line"><span class="code">        reset: function () &#123;</span></span><br><span class="line"><span class="code">            clearTimeout(this.timeoutObj);</span></span><br><span class="line"><span class="code">            clearTimeout(this.serverTimeoutObj);</span></span><br><span class="line"><span class="code">            return this;</span></span><br><span class="line"><span class="code">        &#125;,</span></span><br><span class="line"><span class="code">        start: function () &#123;</span></span><br><span class="line"><span class="code">            var self = this;</span></span><br><span class="line"><span class="code">            this.timeoutObj &amp;&amp; clearTimeout(this.timeoutObj);</span></span><br><span class="line"><span class="code">            this.serverTimeoutObj &amp;&amp; clearTimeout(this.serverTimeoutObj);</span></span><br><span class="line"><span class="code">            this.timeoutObj = setTimeout(function () &#123;</span></span><br><span class="line"><span class="code">                //这里发送一个心跳，后端收到后，返回一个心跳消息，</span></span><br><span class="line"><span class="code">                //onmessage拿到返回的心跳就说明连接正常</span></span><br><span class="line"><span class="code">                websocket.send(&quot;HeartBeat&quot;);</span></span><br><span class="line"><span class="code">                console.log(&#x27;ping&#x27;);</span></span><br><span class="line"><span class="code">                self.serverTimeoutObj = setTimeout(function () &#123; // 如果超过一定时间还没重置，说明后端主动断开了</span></span><br><span class="line"><span class="code">                    console.log(&#x27;关闭服务&#x27;);</span></span><br><span class="line"><span class="code">                    websocket.close();//如果onclose会执行reconnect，我们执行 websocket.close()就行了.如果直接执行 reconnect 会触发onclose导致重连两次</span></span><br><span class="line"><span class="code">                &#125;, self.timeout)</span></span><br><span class="line"><span class="code">            &#125;, this.timeout)</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;;</span></span><br><span class="line"><span class="code">&#125;);</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>https</title>
      <link href="/posts/3ef665a6.html"/>
      <url>/posts/3ef665a6.html</url>
      
        <content type="html"><![CDATA[<p><strong>SSL协议</strong></p><blockquote><p>提供数据安全和完整性的加密协议</p></blockquote><p>浏览器发送网站证书信息至客户端（告知客户端网站安全性），确认信息后，服务器生成加锁的箱子（有两把不一样的钥匙），一个给客户端，一个给服务器</p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>http</title>
      <link href="/posts/97780db2.html"/>
      <url>/posts/97780db2.html</url>
      
        <content type="html"><![CDATA[<p><strong>HTTP/0.9</strong></p><blockquote><p>HTTP 是基于 TCP/IP 协议的应用层协议。它不涉及数据包（packet）传输，主要规定了客户端和服务器之间的通信格式，默认使用80端口。</p></blockquote><ul><li>仅有一条命令 GET 且服务器只能回复 HTML 格式的字符串</li></ul><p><strong>HTTP/1.0</strong></p><ul><li>新增功能项<ul><li>任何格式的内容都可以发送(文字、图像、视频、二进制文件)</li><li>GET、POST、HEAD命令，丰富浏览器与服务器互动手段</li><li>请求和回应的格式也变了。除了数据部分，每次通信都必须包括头信息（HTTP header），用来描述一些元数据</li><li>其他的新增功能还包括状态码（status code）、多字符集支持、多部分发送（multi-part type）、权限（authorization）、缓存（cache）、内容编码（content encoding）等</li></ul></li><li>缺点<ul><li>每个 TCP 连接只能发送一个请求</li><li>TCP 连接新建成本高（需要客户端-服务端三次握手），并且开始时发送速率较慢<ul><li>使用非标准 Connection：keep-alive） 字段复用TCP 连接</li></ul></li></ul></li></ul><h3 id="HTTP">HTTP</h3><ul><li>超文本传输协议<ul><li>基于TCP/IP通信协议来传递数据（HTML、JS、CSS、图片等文件, 查询结果等)</li><li>无连接：限制每次连接只处理一个请求</li><li>无状态：同一个会话的连续两个请求互相不了解<br><img src="/assets/images/network/work-flow-01.jpeg" alt="工作流程"></li></ul></li></ul><h3 id="从客户端发起请求到服务端返回结果流程解析：">从客户端发起请求到服务端返回结果流程解析：</h3><ul><li>域名解析：<ul><li>Chrome搜索自身的DNS缓存</li><li>搜索操作系统自身的DNS缓存(浏览器没有找到缓存或者缓存已经失效)</li><li>查看Chrome缓存：Chrome：//net-internals/#dns 曾经浏览过的浏览记录</li><li>读取主机host文件</li><li>浏览器发起DNS解析请求、获取IP地址</li><li>TCP/IP 三次握手</li><li>TCP/IP连接建立，浏览器向服务器发送HTTP请求</li><li>服务器接收到该请求，根据路径参数去拿数据返回给客户端<ul><li>HTTP头和正文信息</li><li>HTTP头发送的是一些附加信息</li><li>内容类型，服务器发送响应的时间，HTTP状态码</li><li>正文：用户提交的表单数据</li></ul></li></ul></li></ul><p>HTTP客户端发起请求，创建端口<br>HTTP服务器在端口监听客户端请求<br>HTTP服务器向客户端返回状态和内容</p><h3 id="状态码">状态码</h3><ul><li>请求报文头由客户端发出，服务端只能读取</li><li>HTTP的响应状态码由5段组成：<ul><li>1xx 消息，一般是告诉客户端，请求已经收到了，正在处理，别急…</li><li>2xx 处理成功，一般表示：请求收悉、我明白你要的、请求已受理、已经处理完成等信息.</li><li>3xx 重定向到其它地方。它让客户端再发起一个请求以完成整个处理。</li><li>4xx 处理发生错误，责任在客户端，如客户端的请求一个不存在的资源，客户端未被授权，禁止访问等。</li><li>5xx 处理发生错误，责任在服务端，如服务端抛出异常，路由出错，HTTP版本不支持等。</li></ul></li></ul><h3 id="常见HTTP响应头属性">常见HTTP响应头属性</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Referer：表示这个请求是从哪个URL过来的</span><br><span class="line">Cache-Control: 服务端通过该字段告诉客户端如何控制响应内容的缓存</span><br><span class="line"><span class="keyword">no</span>-cache: 强制每次请求直接发给源服务器，不经过本地缓存版本校验</span><br><span class="line"><span class="built_in">max</span>-age&gt;<span class="number">0</span> 时 直接从浏览器缓存中 提取</span><br><span class="line"><span class="built_in">max</span>-age&lt;=<span class="number">0</span> 时 向server 发送http 请求确认 ,该资源是否有修改, 有的话 返回<span class="number">200</span>, 无的话 返回<span class="number">304</span></span><br><span class="line">Etag：让客户端“更智能”地处理什么时候要从服务端取资源，什么时候可以直接从缓存中返回响应 </span><br><span class="line">Location: 让客户端redirect到iteye的首页</span><br><span class="line"># 如：Location: http:<span class="comment">//www.iteye.com </span></span><br><span class="line"><span class="keyword">Set</span>-Cookie <span class="comment">:</span> 服务端设置客户端的<span class="comment">COOKIE</span></span><br><span class="line"></span><br><span class="line">一个HTTP连接在长时间没有数据传输的情况下，链路上的任何一个网关都可能关闭这个连接，而网关是我们不可控的</span><br></pre></td></tr></table></figure><h3 id="General">General</h3><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Request URL: http:<span class="comment">//192.168.1.13/lobby/contacts/role_menus</span></span><br><span class="line">Request <span class="keyword">Method</span>: GET</span><br><span class="line">Status Code: <span class="number">200</span> OK</span><br><span class="line">Remote Address: <span class="number">192.168</span>.<span class="number">1.13</span>:<span class="number">80</span></span><br><span class="line">Referrer Policy: <span class="keyword">strict</span>-origin-when-cross-origin</span><br></pre></td></tr></table></figure><h3 id="Response">Response</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Connection: keep-alive [<span class="regexp">//</span>]: <span class="regexp">//</span> (复用的TCP连接：同一个TCP连接里面，所有的数据通信是按次序进行的)</span><br><span class="line">Content-Encoding: gzip [<span class="regexp">//</span>]: <span class="regexp">//</span> (数据压缩方法)</span><br><span class="line">Content-Type: application/json;charset=UTF-<span class="number">8</span></span><br><span class="line">Content-Length: <span class="number">172345</span> [<span class="regexp">//</span>]: <span class="regexp">//</span> (<span class="number">1</span>个TCP 连接可以传送多个回应, 通过回应的字节长度, 区分数据包属于哪个回应)</span><br><span class="line">Date: Mon, <span class="number">19</span> Apr <span class="number">2021</span> <span class="number">07</span>:<span class="number">44</span>:<span class="number">19</span> GMT</span><br><span class="line">Server: nginx/<span class="number">1.16</span>.<span class="number">1</span></span><br><span class="line">Transfer-Encoding: chunked  [<span class="regexp">//</span>]: <span class="regexp">//</span> (分块传输编码：表明回应将由数量未定的数据块组成)</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Powered-By: Express</span><br></pre></td></tr></table></figure><h3 id="Request">Request</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Accept: application<span class="regexp">/json, text/</span>plain, */*</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line">Cache-Control: no-cache </span><br><span class="line">Pragma: no-cache        [<span class="regexp">//</span>]: <span class="regexp">//</span> 应用程序应当向原始服务器推送此请求，即使它已经在上次请求时已经缓存了一份拷贝</span><br><span class="line">Connection: keep-alive  [<span class="regexp">//</span>]: <span class="regexp">//</span> (复用的TCP连接)</span><br><span class="line">Cookie: passport=s%<span class="number">3</span>A2TeoyfrwLwxIVNDx-sIYrUaHyOuIWsuX.W%<span class="number">2</span>BN9w1G7K8utyv%<span class="number">2</span>FhedDmbD9r9UfOevdu6WiineCHmPU; passport:uid=ppid_1383989766219739138</span><br><span class="line">Host: <span class="number">192.168</span>.<span class="number">1.13</span>      [<span class="regexp">//</span>]: <span class="regexp">//</span> (指定服务器域名：可以将请求发往同一台服务器上的不同网站)</span><br><span class="line">Referer: http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">1.13</span>/dashboard?code=b609977c4ce01a75e51c3902eb25081a20f149ce75eb0023</span><br><span class="line">User-Agent: Mozilla<span class="regexp">/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/</span><span class="number">537.36</span> (KHTML, like Gecko) Chrome<span class="regexp">/89.0.4389.128 Safari/</span><span class="number">537.36</span></span><br><span class="line">[<span class="regexp">//</span>]: <span class="regexp">//</span> 它是一个特殊字符串头，使得服务器能够识别客户使用的操作系统及版本、CPU 类型、浏览器及版本、浏览器渲染引擎、浏览器语言、浏览器插件等</span><br></pre></td></tr></table></figure><p><a href="http://fex.baidu.com/blog/2014/05/what-happen/">参考链接</a></p>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Redis</title>
      <link href="/posts/bae4ff13.html"/>
      <url>/posts/bae4ff13.html</url>
      
        <content type="html"><![CDATA[<h3 id="Redis">Redis</h3><p>存储<br>redis使用了两种文件格式：全量数据和增量请求。<br>全量数据格式是把内存中的数据写入磁盘，便于下次读取文件进行加载；<br>增量请求文件则是把内存中的数据序列化为操作请求，用于读取文件进行replay得到数据，序列化的操作包括SET、RPUSH、SADD、ZADD。<br>redis的存储分为内存存储、磁盘存储和log文件三部分，配置文件中有三个参数对其进行配置。<br>save seconds updates，save配置，指出在多长时间内，有多少次更新操作，就将数据同步到数据文件。这个可以多个条件配合，比如默认配置文件中的设置，就设置了三个条件。<br>appendonly yes/no ，appendonly配置，指出是否在每次更新操作后进行日志记录，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为redis本身同步数据文件是按上面的save条件来同步的，所以有的数据会在一段时间内只存在于内存中。<br>appendfsync no/always/everysec ，appendfsync配置，no表示等操作系统进行数据缓存同步到磁盘，always表示每次更新操作后手动调用fsync()将数据写到磁盘，everysec表示每秒同步一次。</p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQL</title>
      <link href="/posts/c24675b4.html"/>
      <url>/posts/c24675b4.html</url>
      
        <content type="html"><![CDATA[<h3 id="mysql-全库导入与导出">mysql 全库导入与导出</h3><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">导出</span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">mysqldump -uroot -p --all-databases &gt; sqlfile.<span class="property">sql</span></span></span><br><span class="line">导入</span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">mysql -h localhost -uroot -p</span></span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">source sqlfile.<span class="property">sql</span></span></span><br></pre></td></tr></table></figure><p><strong>主键</strong></p><ul><li>标识数据的唯一性</li></ul><p><strong>外键</strong></p><ul><li>关联到其他表的主键，实现一对多的关系</li></ul><p><strong>临时记录</strong><br>select id, name from students where id &gt;=5;</p><p>select count(*) number from students where class_id = 1;</p><p>select * from classes Inner Join students on classes_id = students_class_id;</p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB</title>
      <link href="/posts/8ead567e.html"/>
      <url>/posts/8ead567e.html</url>
      
        <content type="html"><![CDATA[<h3 id="MongoDB">MongoDB</h3><ul><li>一个基于分布式文件存储的数据库</li><li>&quot;文档&quot;型数据库<ul><li>内部执行引擎为js引擎（V8），Bson–&gt;json-可通过js直接操作</li></ul><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在硬盘存储方式:</span><br><span class="line">Bson（json的二进制化）</span><br><span class="line">  <span class="string">|</span></span><br><span class="line">Gridfs(包装的文件系统)</span><br><span class="line">  <span class="string">|</span></span><br><span class="line"> 磁盘</span><br></pre></td></tr></table></figure></li><li>由c++编写</li></ul><blockquote><p>Memmcached\redis:key-value型数据库<br>传统型数据库：结构化数据库，定好了表结构，每一行的内容必是符合表结构的</p></blockquote><p>以文档(document)为单位，表(collection)下的每一篇文档都可以有自己独特的属性和值–可无限纵深!!!<br>思路:电影、影评、影评回复、回复打分===传统型数据库，至少要四张表，关联度复杂，在文档型数据库中可以通过一篇文档完成。<br><a href="http://www.douban.com">www.douban.com</a></p><h3 id="安装">安装</h3><ol><li>先装vc_redist</li><li>再装mongodb</li><li>在D盘创建data下载创建db：存放数据内容的地方。</li><li>在D盘找到D:\mongdb\bin把地址放到系统变量那记得加分号；<code>添加环境变量</code></li><li>在D:\mongdb\bin在打开git bash输入mongod --dbpath d:/data/db:指定数据存放位置。</li><li>在浏览器地址栏输入localhost:27017 / D:\mongdb\bin\mongod.exe</li><li>在cmd中输入mongo—连接localhost:27017</li><li>开启成功</li></ol><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">启动方式二：</span><br><span class="line">  <span class="string">./bin/mongod</span> <span class="params">--dbpath</span> d:<span class="string">/data/db</span> <span class="params">--logpath</span> d:<span class="string">/data/log</span> <span class="params">--fork</span> <span class="params">--port</span> 27017</span><br><span class="line">  参数解释:</span><br><span class="line">  <span class="params">--dbpath</span> 数据存储目录</span><br><span class="line">  <span class="params">--logpath</span> 日志存储目录</span><br><span class="line">  <span class="params">--port</span> 运行端口<span class="params">(默认27017)</span></span><br><span class="line">  <span class="params">--fork</span> 后台进程运行</span><br><span class="line"></span><br><span class="line">www.mongoDB.org  /  http:<span class="string">//www.mongodb.org/downloads</span>    选择stable 版本</span><br></pre></td></tr></table></figure><h3 id="内置服务">内置服务</h3><p><img src="/assets/images/database/mongodb/help.png" alt="内置服务"></p><h3 id="常用指令">常用指令</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">db 命令用于查看当前操作的（数据库）</span><br><span class="line">show dbs:查看所有数据库</span><br><span class="line">show collections:显示数据库中所有的集合(collection)</span><br><span class="line">db.<span class="title function_ invoke__">serverStatus</span>():查看数据库服务器的状态。</span><br><span class="line"><span class="keyword">use</span> <span class="title">test</span>:创建并切换到该数据库(无数据时不显示)</span><br><span class="line"><span class="title">db</span>.<span class="title">stats</span>():查看数据库状态</span><br><span class="line"><span class="title">db</span>.<span class="title">user</span>:建表</span><br><span class="line"></span><br><span class="line"><span class="title">db</span>.<span class="title">user</span>.<span class="title">insertOne</span>(&#123;&#125;);--插入一个对象</span><br><span class="line">db.user.<span class="title function_ invoke__">insertMany</span>(&#123;&#125;,&#123;&#125;):插入多条数据</span><br><span class="line">db.user.<span class="title function_ invoke__">find</span>(&#123;&#125;):查看所有插入的对象</span><br><span class="line">db.user.<span class="title function_ invoke__">find</span>(&#123;<span class="attr">username</span>:<span class="string">&quot;zhangsan&quot;</span>&#125;)</span><br><span class="line">db.<span class="title function_ invoke__">getCollectionNames</span>():查询指定数据库包含的集合名称列表。</span><br><span class="line">db.user.<span class="title function_ invoke__">deleteOne</span>(&#123;<span class="attr">username</span>:<span class="string">&quot;zhangsan&quot;</span>&#125;):默认删除找到的第一个用户名。</span><br><span class="line"><span class="comment">// 删除数据库mydb</span></span><br><span class="line">  <span class="keyword">use</span> <span class="title">mydb</span>; </span><br><span class="line">  db.<span class="title function_ invoke__">dropDatabase</span>();</span><br><span class="line"><span class="comment">// 删除数据表ids</span></span><br><span class="line">  db.ids.<span class="title function_ invoke__">remove</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//更改数据</span></span><br><span class="line">db.user.<span class="title function_ invoke__">updateMany</span>(&#123;&#125;,&#123;<span class="variable">$set</span>:&#123;<span class="attr">password</span>:<span class="string">&#x27;1111&#x27;</span>&#125;&#125;)</span><br><span class="line">第一个参数为：更改所有，第二个设置参数</span><br><span class="line">``单条字段修改</span><br><span class="line">Db.user.<span class="title function_ invoke__">update</span>(&#123;<span class="string">&quot;_id&quot;</span>:<span class="title function_ invoke__">ObjectId</span>(<span class="string">&quot;1231sdvadf...&quot;</span>)&#125;,&#123;<span class="variable">$set</span>:&#123;<span class="string">&quot;role&quot;</span>:<span class="number">51</span>&#125;&#125;);</span><br><span class="line">db.user.<span class="title function_ invoke__">find</span>(&#123;<span class="attr">username</span>:<span class="string">&#x27;李四&#x27;</span>&#125;).<span class="title function_ invoke__">size</span>():查找所有username为李四的用户。</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">只想显示其中一条：</span><br><span class="line">db.user.<span class="title function_ invoke__">find</span>(&#123;<span class="attr">username</span>:<span class="string">&quot;李四&quot;</span>&#125;,&#123;<span class="attr">username</span>:<span class="number">1</span>,<span class="attr">_id</span>:<span class="number">0</span>&#125;)</span><br><span class="line"><span class="number">1</span>:显示、<span class="number">0</span>：不显示</span><br><span class="line">查询数量：</span><br><span class="line">db.user.<span class="title function_ invoke__">find</span>(&#123;<span class="attr">password</span>:<span class="string">&quot;1111&quot;</span>&#125;).<span class="title function_ invoke__">size</span>()</span><br><span class="line">排序：<span class="number">1</span>-升序、-<span class="number">1</span>：降序</span><br><span class="line">db.user.<span class="title function_ invoke__">find</span>(&#123;<span class="attr">password</span>:<span class="string">&quot;1111&quot;</span>&#125;).<span class="title function_ invoke__">sort</span>(&#123;<span class="attr">username</span>:<span class="number">1</span>&#125;)</span><br><span class="line"><span class="comment">//移除数据：</span></span><br><span class="line">db.user.<span class="title function_ invoke__">remove</span>(&#123;<span class="attr">password</span>:<span class="string">&quot;1111&quot;</span>&#125;):删除所有密码为<span class="number">1111</span>的数据</span><br><span class="line">db.user.<span class="title function_ invoke__">remove</span>(&#123;&#125;):删除所有的数据</span><br><span class="line">或者:db.mycoll.<span class="title function_ invoke__">drop</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建表与表之间的联系</span></span><br><span class="line">db.ids.<span class="title function_ invoke__">insert</span>([&#123;<span class="attr">name</span>:<span class="string">&#x27;comment&#x27;</span>,<span class="attr">id</span>:<span class="number">0</span>&#125;])</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line">1.1: show dbs  查看当前的数据库</span><br><span class="line">1.2 use databaseName 选库</span><br><span class="line">1.2 show tables/collections 查看当前库下的collection</span><br><span class="line">1.3 如何创建库?</span><br><span class="line">Mongodb的库是隐式创建,你可以use 一个不存在的库</span><br><span class="line">然后在该库下创建collection,即可创建库</span><br><span class="line"></span><br><span class="line">1.4 db.createCollection(‘collectionName’)  </span><br><span class="line">创建collection </span><br><span class="line"></span><br><span class="line">1.5 collection允许隐式创建</span><br><span class="line">Db.collectionName.insert(document); </span><br><span class="line"></span><br><span class="line">1.6 db.collectionName.drop() ,</span><br><span class="line">删除collection </span><br><span class="line"></span><br><span class="line">1.7 db.dropDatabase();</span><br><span class="line">删除database</span><br><span class="line">*******************************************</span><br><span class="line">基本操作增删改查</span><br><span class="line">增: insert</span><br><span class="line">介绍: mongodb存储的是文档,文档是json格式的对象.</span><br><span class="line">语法: db.collectionName.isnert(document);</span><br><span class="line"> </span><br><span class="line">1: 增加单篇文档</span><br><span class="line">Db.collectionName.insert(&#123;title:’nice day’&#125;);</span><br><span class="line"> </span><br><span class="line">2: 增加单个文档,并指定_id</span><br><span class="line">Db.collectionName.insert(&#123;_id:8,age:78,name:’lisi’&#125;);</span><br><span class="line"> </span><br><span class="line">3. 增加多个文档</span><br><span class="line">db.collectionName.insert(</span><br><span class="line">[</span><br><span class="line">&#123;time:&#x27;friday&#x27;,study:&#x27;mongodb&#x27;&#125;,</span><br><span class="line">&#123;_id:9,gender:&#x27;male&#x27;,name:&#x27;QQ&#x27;&#125;</span><br><span class="line">]</span><br><span class="line">)</span><br><span class="line">*******************************************</span><br><span class="line">删:remove</span><br><span class="line">语法: db.collection.remove(查询表达式, 选项);</span><br><span class="line">选项是指  &#123;justOne:true/false&#125;,是否只删一行, 默认为false</span><br><span class="line">注意</span><br><span class="line">1: 查询表达式依然是个json对象</span><br><span class="line">2: 查询表达式匹配的行,将被删掉.</span><br><span class="line">3: 如果不写查询表达式,collections中的所有文档将被删掉.</span><br><span class="line">例1: db.stu.remove(&#123;sn:’001’&#125;);</span><br><span class="line">删除stu表中 sn属性值为’001’的文档 </span><br><span class="line">例2: db.stu.remove(&#123;gender:’m’,true&#125;);</span><br><span class="line">删除stu表中gender属性为m的文档,只删除1行.</span><br><span class="line"></span><br><span class="line">改  update操作</span><br><span class="line">改谁? --- 查询表达式</span><br><span class="line">改成什么样? -- 新值 或 赋值表达式</span><br><span class="line">操作选项 ----- 可选参数</span><br><span class="line">语法: db.collection.update(查询表达式,新值,选项);</span><br><span class="line">例:</span><br><span class="line">db.news.update(&#123;name:&#x27;QQ&#x27;&#125;,&#123;name:&#x27;MSN&#x27;&#125;);</span><br><span class="line">是指选中news表中,name值为QQ的文档,并把其文档值改为&#123;name:’MSN’&#125;,</span><br><span class="line">结果: 文档中的其他列也不见了,改后只有_id和name列了.</span><br><span class="line">即--新文档直接替换了旧文档,而不是修改</span><br><span class="line"> </span><br><span class="line">如果是想修改文档的某列,可以用$set关键字</span><br><span class="line">db.collectionName.update(query,&#123;$set:&#123;name:’QQ’&#125;&#125;)</span><br><span class="line">如:db.user.update(&#123;&quot;_id&quot;:ObjectId(&quot;1231sdvadf...&quot;)&#125;,&#123;$set:&#123;&quot;role&quot;:51&#125;&#125;) </span><br><span class="line">修改时的赋值表达式</span><br><span class="line">$set  修改某列的值</span><br><span class="line">$unset 删除某个列</span><br><span class="line">$rename 重命名某个列</span><br><span class="line">$inc 增长某个列</span><br><span class="line">$setOnInsert 当upsert为true时,并且发生了insert操作时,可以补充的字段.</span><br><span class="line"></span><br><span class="line">Option的作用:</span><br><span class="line">&#123;upsert:true/false,multi:true/false&#125;</span><br><span class="line">Upsert---是指没有匹配的行,则直接插入该行.(和mysql中的replace一样)</span><br><span class="line"> </span><br><span class="line">例:db.stu.update(&#123;name:&#x27;wuyong&#x27;&#125;,&#123;$set:&#123;name:&#x27;junshiwuyong&#x27;&#125;&#125;,&#123;upsert:true&#125;);</span><br><span class="line">如果有name=’wuyong’的文档,将被修改</span><br><span class="line">如果没有,将添加此新文档</span><br><span class="line"> </span><br><span class="line">例:</span><br><span class="line">db.news.update(&#123;_id:99&#125;,&#123;x:123,y:234&#125;,&#123;upsert:true&#125;);</span><br><span class="line">没有_id=99的文档被修改,因此直接插入该文档</span><br><span class="line"> </span><br><span class="line">multi: 是指修改多行(即使查询表达式命中多行,默认也只改1行,如果想改多行,可以用此选项)</span><br><span class="line">例:</span><br><span class="line">db.news.update(&#123;age:21&#125;,&#123;$set:&#123;age:22&#125;&#125;,&#123;multi:true&#125;);</span><br><span class="line">则把news中所有age=21的文档,都修改</span><br><span class="line">*******************************************</span><br><span class="line">查: find, findOne</span><br><span class="line">语法: db.collection.find(查询表达式,查询的列);</span><br><span class="line">Db.collections.find(表达式,&#123;列1:1,列2:1&#125;);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">例1:db.stu.find()</span><br><span class="line">查询所有文档 所有内容</span><br><span class="line"> </span><br><span class="line">例2: db.stu.find(&#123;&#125;,&#123;gendre:1&#125;)</span><br><span class="line">查询所有文档,的gender属性 (_id属性默认总是查出来)</span><br><span class="line"> </span><br><span class="line">例3: db.stu.find(&#123;&#125;,&#123;gender:1, _id:0&#125;)</span><br><span class="line">查询所有文档的gender属性,且不查询_id属性</span><br><span class="line"> </span><br><span class="line">例3: db.stu.find(&#123;gender:’male’&#125;,&#123;name:1,_id:0&#125;);</span><br><span class="line">查询所有gender属性值为male的文档中的name属性</span><br><span class="line">*******************************************</span><br><span class="line">查询表达式:</span><br><span class="line">1: 最简单的查询表达式</span><br><span class="line">&#123;filed:value&#125; ,是指查询field列的值为value的文档</span><br><span class="line"> </span><br><span class="line">2: $ne --- != 查询表达式</span><br><span class="line">&#123;field:&#123;$nq:value&#125;&#125;</span><br><span class="line">作用--查filed列的值 不等于 value 的文档</span><br><span class="line"> </span><br><span class="line">3: $nin --&gt; not in</span><br><span class="line"> </span><br><span class="line">4: $all</span><br><span class="line">语法: &#123;field:&#123;$all:[v1,v2..]&#125;&#125; </span><br><span class="line">是指取出 field列是一个数组,且至少包含 v1,v2值</span><br><span class="line"> </span><br><span class="line">5: $exists </span><br><span class="line">语法: &#123;field:&#123;$exists:1&#125;&#125;</span><br><span class="line">作用: 查询出含有field字段的文档</span><br><span class="line"> </span><br><span class="line">6: $nor,</span><br><span class="line">&#123;$nor,[条件1,条件2]&#125;</span><br><span class="line">是指  所有条件都不满足的文档为真返回</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">7:用正则表达式查询 以”诺基亚”开头的商品</span><br><span class="line">例:db.goods.find(&#123;goods_name:/诺基亚.*/&#125;,&#123;goods_name:1&#125;);</span><br><span class="line"> </span><br><span class="line">8: 用$where表达式来查询</span><br><span class="line">例: db.goods.find(&#123;$where:&#x27;this.cat_id != 3 &amp;&amp; this.cat_id != 11&#x27;&#125;);</span><br><span class="line">注意: 用$where查询时, mongodb是把bson结构的二进制数据转换为json结构的对象,</span><br><span class="line">然后比较对象的属性是否满足表达式.</span><br><span class="line">``速度较慢``</span><br><span class="line">Update 时可用的操作符：eg--&gt;</span><br><span class="line">db.user.insert(&#123;name:&#x27;lisi&#x27;,age:12,sex:&#x27;male&#x27;,height:123,area:&#x27;haidian&#x27;&#125;);</span><br><span class="line">db.user.update(&#123;name:&#x27;lisi&#x27;&#125;,&#123;$set:&#123;area:&#x27;chaoyang&#x27;&#125;,$unset:&#123;height:1&#125;,$inc:&#123;age:1&#125;,$rename:&#123;sex:&#x27;gender&#x27;&#125;&#125;);</span><br><span class="line">&gt; db.user.find();</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;51fc01c4f5de93e1f2856e33&quot;), &quot;age&quot; : 13, &quot;area&quot; : &quot;chaoyang&quot;, &quot;gender&quot; : &quot;male&quot;, &quot;name&quot; : &quot;lisi&quot; &#125;</span><br><span class="line">************************************************************</span><br><span class="line">游标操作   cursor</span><br><span class="line">游标是什么?</span><br><span class="line">通俗的说,游标不是查询结果,而是查询的返回资源/接口.(返回结果的一个接口)</span><br><span class="line">通过这个接口,你可以逐条读取.</span><br><span class="line">就像php中的fopen打开文件,得到一个资源一样, 通过资源,可以一行一行的读文件.</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">声明游标:</span><br><span class="line">var cursor =  db.collectioName.find(query,projection);</span><br><span class="line">Cursor.hasNext() ,判断游标是否已经取到尽头</span><br><span class="line">Cursor. Next() , 取出游标的下1个单元</span><br><span class="line"> </span><br><span class="line">用while来循环游标</span><br><span class="line">var mycursor = db.bar.find(&#123;_id:&#123;$lte:5&#125;&#125;);  //查询id &lt;= 5 的行数</span><br><span class="line">while(mycursor.hasNext()) &#123;</span><br><span class="line">printjson(mycursor.next()); // 将bson格式数据转为可见的json数据</span><br><span class="line">&#125;</span><br><span class="line">// 循环打印出 查询结果，调用cursor.next()游标移加1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">例:</span><br><span class="line">// 声明游标</span><br><span class="line">var cursor = db.goods.find();</span><br><span class="line">// 循环游标</span><br><span class="line">for(var doc=true;cursor.hasNext();) &#123; printjson(cursor.next());&#125;</span><br><span class="line"> </span><br><span class="line">也可以简写:</span><br><span class="line">for(var  cursor=db.goods.find(), doc=true;cursor.hasNext();) &#123; printjson(cursor.next());&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">游标还有一个迭代函数,允许我们自定义回调函数来逐个处理每个单元.</span><br><span class="line">cursor.forEach(回调函数);</span><br><span class="line">例:  obj:即调用cursor.next()所取出的单元(document)</span><br><span class="line">var gettitle = function(obj) &#123;print(obj.goods_name)&#125;</span><br><span class="line">var cursor = db.goods.find();</span><br><span class="line">cursor.forEach(gettitle);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">游标在分页中的应用</span><br><span class="line">比如查到10000行,跳过100页,取10行.</span><br><span class="line">一般地,我们假设每页N行, 当前是page页</span><br><span class="line">就需要跳过前 (page-1)*N 行, 再取N行, 在mysql中, limit offset,N来实现</span><br><span class="line">在mongo中,用skip(), limit()函数来实现的</span><br><span class="line">如 var mycursor = db.bar.find().skip(9995);</span><br><span class="line">则是查询结果中,跳过前9995行</span><br><span class="line"> </span><br><span class="line">查询第901页,每页10条</span><br><span class="line">则是 var mytcursor = db.bar.find().skip(9000).limit(10);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">通过cursor一次性得到所有数据, 并返回数组.</span><br><span class="line">例:</span><br><span class="line">var cursor = db.goods.find();</span><br><span class="line">printjson(cursor.toArray());  //看到所有行</span><br><span class="line">printjson(cursor.toArray()[2]);  //看到第2行</span><br><span class="line"> </span><br><span class="line">注意: 不要随意使用toArray()</span><br><span class="line">原因: 会把所有的行立即以对象形式组织在内存里.</span><br><span class="line">可以在取出少数几行时,用此功能.</span><br><span class="line">*******************************************</span><br><span class="line">索引创建： </span><br><span class="line">1:索引提高查询速度,降低写入、更改速度(如果在新增数据时,会新增索引文件),权衡常用的查询字段,不必在太多列上建索引</span><br><span class="line">2:在mongodb中,索引可以按字段升序/降序来创建,便于排序</span><br><span class="line">3:默认是用btree来组织索引文件,2.4版本以后,也允许建立hash索引.</span><br><span class="line"> </span><br><span class="line">查看查询计划</span><br><span class="line">Eg：</span><br><span class="line">for(var i=0;i&lt;1000,i++)&#123;</span><br><span class="line">   db.stu.insert(&#123;&quot;sn&quot;:I,&quot;name&quot;:&quot;student&quot;+i&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/assets/images/database/mongodb/search.png" alt="search.png"></p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">db</span>.find(<span class="keyword">query</span>).explain();  ##解释执行计划##</span><br><span class="line"><span class="string">&quot;cursor&quot;</span> : <span class="string">&quot;BasicCursor&quot;</span>, ----说明没有索引发挥作用--<span class="string">&quot;一个一个找&quot;</span></span><br><span class="line"><span class="string">&quot;nscannedObjects&quot;</span> : 1000 ---理论上要扫描多少行</span><br><span class="line">cursor<span class="string">&quot; : &quot;</span>BtreeCursor sn_1&quot;, 用到的btree索引</span><br><span class="line"></span><br><span class="line">精准的命中某一行, </span><br><span class="line"> </span><br><span class="line">常用命令:</span><br><span class="line">查看当前索引状态: <span class="keyword">db</span>.collection.getIndexes();</span><br><span class="line">`` _id:mongodb默认自带的索引``</span><br><span class="line">创建普通的单列索引:<span class="keyword">db</span>.collection.ensureIndex(&#123;field:1/-1&#125;);  1是升续 2是降续</span><br><span class="line"> </span><br><span class="line">删除单个索引（``某个列的索引``）</span><br><span class="line"><span class="keyword">db</span>.collection.dropIndex(&#123;filed:1/-1&#125;);</span><br><span class="line"> </span><br><span class="line">一下删除所有索引</span><br><span class="line"><span class="keyword">db</span>.collection.dropIndexes();</span><br><span class="line">``多列索引:</span><br><span class="line">说明:两个列上都有索引，你索引你的，我索引我的。把多个列绑定为一个整体来加索引(整体值:page-pageSize)查询效率高。</span><br><span class="line">创建多列索引  <span class="keyword">db</span>.collection.ensureIndex(&#123;field1:1/-1, field2:1/-1&#125;);</span><br><span class="line"></span><br><span class="line">子文档查询:<span class="keyword">db</span>.shop.find(<span class="string">&quot;spc.area&quot;</span>:<span class="string">&quot;taiwan&quot;</span>); </span><br><span class="line">创建子文档索引</span><br><span class="line"><span class="keyword">db</span>.collection.ensureIndex(&#123;filed.subfield:1/-1&#125;);</span><br><span class="line"> </span><br><span class="line">创建唯一索引:可防止重复插入数据</span><br><span class="line"><span class="keyword">db</span>.collection.ensureIndex(&#123;filed.subfield:1/-1&#125;, &#123;unique:true&#125;);</span><br><span class="line"> </span><br><span class="line">创建稀疏索引:</span><br><span class="line">稀疏索引的特点------如果针对field做索引,针对不含field列的文档,将不建立索引.</span><br><span class="line">与之相对,普通索引,会把该文档的field列的值认为NULL,并建索引.</span><br><span class="line">适宜于: 小部分文档含有某列时.</span><br><span class="line"><span class="keyword">db</span>.collection.ensureIndex(&#123;field:1/-1&#125;,&#123;sparse:true&#125;); <span class="comment">// email列为null的将不会被查出。</span></span><br><span class="line">eg:<span class="keyword">db</span>.tea.insert(&#123;&#125;); </span><br><span class="line"> <span class="keyword">db</span>.tea.find();</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : ObjectId(<span class="string">&quot;5275f99b87437c610023597b&quot;</span>), <span class="string">&quot;email&quot;</span> : <span class="string">&quot;a@163.com&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : ObjectId(<span class="string">&quot;5275f99e87437c610023597c&quot;</span>), <span class="string">&quot;email&quot;</span> : <span class="string">&quot;b@163.com&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : ObjectId(<span class="string">&quot;5275f9e887437c610023597e&quot;</span>), <span class="string">&quot;email&quot;</span> : <span class="string">&quot;c@163.com&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : ObjectId(<span class="string">&quot;5275fa3887437c6100235980&quot;</span>) &#125;</span><br><span class="line">如上内容,最后一行没有email列,</span><br><span class="line">如果分别加普通索引,和稀疏索引,</span><br><span class="line">对于最后一行的email分别当成null 和 忽略最后一行来处理.</span><br><span class="line">根据&#123;email:null&#125;来查询,前者能查到,而稀疏索引查不到最后一行.</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">创建哈希索引(2.4新增的)--通过hash函数计算出数据在硬盘上存储的位置。</span><br><span class="line">哈希索引速度比普通索引(二叉树数据结构)快,但是,无能对范围查询进行优化.</span><br><span class="line">适宜于---随机性强的散列(运存中查询速读块，机械硬盘上对范围查询速读慢!!!)</span><br><span class="line"><span class="keyword">db</span>.collection.ensureIndex(&#123;<span class="keyword">file</span>:’hashed’&#125;);</span><br><span class="line">``BtreeCursor hashed`` </span><br><span class="line"></span><br><span class="line">重建索引</span><br><span class="line">一个表经过很多次修改后,导致表的文件产生空洞,索引文件也如此.</span><br><span class="line">可以通过索引的重建,减少索引文件碎片,并提高索引的效率.</span><br><span class="line">类似mysql中的optimize <span class="keyword">table</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">db</span>.collection.reIndex()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="/assets/docs/mongodb/mongo.doc">mongo.doc</a><br><a href="https://www.cnblogs.com/liyonghui/p/mongodb.html">mongodb.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>IndexDB</title>
      <link href="/posts/486ec417.html"/>
      <url>/posts/486ec417.html</url>
      
        <content type="html"><![CDATA[<h3 id="IndexDB">IndexDB</h3><ul><li><p>没有表的概念,而是objectStore(灵活的数据结构)，一个数据库可以包含多个objectStore[相当于一张表]</p></li><li><p>某个字段作为键值:keyPath</p></li><li><p>自动递增数字作为键值:keyGenerator</p></li><li><p>选择的键不同,objectStore可以存储的数据结构也有差异</p><table><thead><tr><th>键类型</th><th>存储数据</th></tr></thead><tbody><tr><td>不使用</td><td>任意值，但是每添加一条数据的时候需要指定键参数</td></tr><tr><td>keyPath</td><td>Javascript对象，对象必须有一属性作为键值</td></tr><tr><td>keyGenerator</td><td>任意值</td></tr><tr><td>都使用</td><td>Javascript对象，如果对象中有keyPath指定的属性则不生成新的键值，如果没有自动生成递增键值，填充keyPath指定属性</td></tr></tbody></table></li><li><p>事务</p><ul><li>在对新数据库做任何事情之前，需要开始一个事务。事务中需要指定该事务跨越哪些object store</li><li>三种模式<ul><li>只读：read，不能修改数据库数据，可以并发执行</li><li>读写：readwrite，可以进行读写操作</li><li>版本变更：verionChange</li></ul></li></ul></li></ul><blockquote><p>IndexedDB—&gt; indexed 杀器-----索引</p></blockquote><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建数据库:</span></span><br><span class="line">var students = <span class="literal">[</span></span><br><span class="line"><span class="literal">    &#123;&quot;<span class="identifier">id</span>&quot;:<span class="number">1001</span>,&quot;<span class="identifier">name</span>&quot;:&quot;B<span class="identifier">yron</span>&quot;,&quot;<span class="identifier">age</span>&quot;:<span class="number">24</span>&#125;,</span></span><br><span class="line"><span class="literal">    &#123;&quot;<span class="identifier">id</span>&quot;:<span class="number">1002</span>,&quot;<span class="identifier">name</span>&quot;:&quot;F<span class="identifier">rank</span>&quot;,&quot;<span class="identifier">age</span>&quot;:<span class="number">30</span>&#125;,</span></span><br><span class="line"><span class="literal">    &#123;&quot;<span class="identifier">id</span>&quot;:<span class="number">1003</span>,&quot;<span class="identifier">name</span>&quot;:&quot;A<span class="identifier">aron</span>&quot;,&quot;<span class="identifier">age</span>&quot;:<span class="number">26</span>&#125;</span></span><br><span class="line"><span class="literal">]</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> openDB (name) &#123;</span><br><span class="line">    var version=version<span class="operator"> || </span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回 IDBOpenDBRequest 对象</span></span><br><span class="line">    var request=window.indexedDB.<span class="keyword">open</span>(name,version);</span><br><span class="line"></span><br><span class="line">    request.onerror=<span class="keyword">function</span>(e)&#123;</span><br><span class="line">        console.log(&#x27;OPen Error!&#x27;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把request获取的``DB对象``赋值给myDB的db属性，这样即可通过myDB.db来访问创建的IndexedDB</span></span><br><span class="line">    request.onsuccess=<span class="keyword">function</span>(e)&#123;</span><br><span class="line">        myDB.db=e.target.result;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// onupgradeneeded 该事件句柄在我们请求打开的数据库的版本号和已经存在的数据库版本号不一致的时候调用</span></span><br><span class="line">    request.onupgradeneeded=<span class="keyword">function</span>(e)&#123;</span><br><span class="line">        </span><br><span class="line">        console.log(&#x27;DB version changed <span class="keyword">to</span> &#x27;+version);</span><br><span class="line"></span><br><span class="line">        var db=e.target.result;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定 id 为 keyPath（主键）</span></span><br><span class="line">        <span class="keyword">if</span>(!db.objectStoreNames.contains(&#x27;students&#x27;))&#123;</span><br><span class="line">            db.create<span class="constructor">ObjectStore(&#x27;<span class="params">students</span>&#x27;,&#123;<span class="params">keyPath</span>:<span class="string">&quot;id&quot;</span>&#125;)</span>; <span class="comment">// (创建)初始化students的object store </span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 指定 id keyGenerate (自动自增)</span></span><br><span class="line">        <span class="keyword">if</span>(!db.objectStoreNames.contains(&#x27;students&#x27;))&#123;</span><br><span class="line">            db.create<span class="constructor">ObjectStore(&#x27;<span class="params">students</span>&#x27;,&#123;<span class="params">autoIncrement</span>: <span class="params">true</span>&#125;)</span>;        </span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var myDB=&#123;</span><br><span class="line">    name:&#x27;test&#x27;,</span><br><span class="line">    version:<span class="number">1</span>,</span><br><span class="line">    db:null</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span><span class="constructor">DB(<span class="params">myDB</span>.<span class="params">name</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭和删除数据库:</span></span><br><span class="line"><span class="keyword">function</span> close<span class="constructor">DB(<span class="params">db</span>)</span>&#123;</span><br><span class="line">    db.close<span class="literal">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> delete<span class="constructor">DB(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    indexedDB.delete<span class="constructor">Database(<span class="params">name</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单调用:</span></span><br><span class="line">var myDB=&#123;            </span><br><span class="line">    name:&#x27;test&#x27;,            </span><br><span class="line">    version:<span class="number">3</span>,</span><br><span class="line">    db:null</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span><span class="constructor">DB(<span class="params">myDB</span>.<span class="params">name</span>,<span class="params">myDB</span>.<span class="params">version</span>)</span>;</span><br><span class="line"></span><br><span class="line">set<span class="constructor">Timeout(<span class="params">function</span>()</span>&#123;        </span><br><span class="line">    close<span class="constructor">DB(<span class="params">myDB</span>.<span class="params">db</span>)</span>;  <span class="comment">//关闭数据库</span></span><br><span class="line">    delete<span class="constructor">DB(<span class="params">myDB</span>.<span class="params">name</span>)</span>; <span class="comment">// 删除数据库</span></span><br><span class="line">&#125;,<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 给object store 添加数据</span></span><br><span class="line"><span class="comment">// 对新数据的操作都需要在transaction中进行，而transaction又要求指定object store，所以我们只能在创建数据库的时候初始化object store以供后面使用，这正是onupgradeneeded 的一个重要作用</span></span><br><span class="line"><span class="keyword">function</span> add<span class="constructor">Data(<span class="params">db</span>,<span class="params">storeName</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 打开一个事务，使用students 的 object store</span></span><br><span class="line">    var transaction=db.transaction(storeName,&#x27;readwrite&#x27;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取students object store</span></span><br><span class="line">    var store=transaction.<span class="keyword">object</span><span class="constructor">Store(<span class="params">storeName</span>)</span>;  </span><br><span class="line">    <span class="keyword">for</span>(var i=<span class="number">0</span>;i&lt;students.length;i++)&#123;</span><br><span class="line">        store.add(students<span class="literal">[<span class="identifier">i</span>]</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">set<span class="constructor">Timeout(<span class="params">function</span>()</span>&#123;</span><br><span class="line">    add<span class="constructor">Data(<span class="params">myDB</span>.<span class="params">db</span>,&#x27;<span class="params">students</span>&#x27;)</span>;</span><br><span class="line">&#125;,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找数据: 调用object store的get方法通过键获取数据</span></span><br><span class="line"><span class="keyword">function</span> get<span class="constructor">DataByKey(<span class="params">db</span>,<span class="params">storeName</span>,<span class="params">key</span>)</span>&#123;</span><br><span class="line">    var transaction=db.transaction(storeName,&#x27;readwrite&#x27;); </span><br><span class="line">    var store=transaction.<span class="keyword">object</span><span class="constructor">Store(<span class="params">storeName</span>)</span>; </span><br><span class="line">    var request=store.get(key); </span><br><span class="line">    request.onsuccess=<span class="keyword">function</span>(e)&#123; </span><br><span class="line">        var student=e.target.result; </span><br><span class="line">        console.log(student.name); </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新数据: 调用object store的put方法更新数据，会自动替换键值相同的记录，达到更新目的，没有相同的则添加</span></span><br><span class="line"><span class="keyword">function</span> update<span class="constructor">DataByKey(<span class="params">db</span>,<span class="params">storeName</span>,<span class="params">key</span>)</span>&#123;</span><br><span class="line">   var transaction=db.transaction(storeName,&#x27;readwrite&#x27;); </span><br><span class="line">   var store=transaction.<span class="keyword">object</span><span class="constructor">Store(<span class="params">storeName</span>)</span>; </span><br><span class="line">   var request=store.get(key); </span><br><span class="line">   request.onsuccess=<span class="keyword">function</span>(e)&#123; </span><br><span class="line">       var student=e.target.result; </span><br><span class="line">       student.age=<span class="number">35</span>;</span><br><span class="line">       store.put(student); </span><br><span class="line">   &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除数据及object store</span></span><br><span class="line"><span class="comment">// 调用object store的delete方法根据键值删除记录</span></span><br><span class="line"><span class="keyword">function</span> delete<span class="constructor">DataByKey(<span class="params">db</span>,<span class="params">storeName</span>,<span class="params">key</span>)</span>&#123;</span><br><span class="line">    var transaction=db.transaction(storeName,&#x27;readwrite&#x27;); </span><br><span class="line">    var store=transaction.<span class="keyword">object</span><span class="constructor">Store(<span class="params">storeName</span>)</span>; </span><br><span class="line">    store.delete(key); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用object store的clear方法可以清空object store</span></span><br><span class="line"><span class="keyword">function</span> clear<span class="constructor">ObjectStore(<span class="params">db</span>,<span class="params">storeName</span>)</span>&#123;</span><br><span class="line">    var transaction=db.transaction(storeName,&#x27;readwrite&#x27;);</span><br><span class="line">    var store=transaction.<span class="keyword">object</span><span class="constructor">Store(<span class="params">storeName</span>)</span>; </span><br><span class="line">    store.clear<span class="literal">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用数据库实例的deleteObjectStore方法可以删除一个object store，这个就得在onupgradeneeded里面调用了</span></span><br><span class="line"><span class="keyword">if</span>(db.objectStoreNames.contains(&#x27;students&#x27;))&#123;</span><br><span class="line">   db.delete<span class="constructor">ObjectStore(&#x27;<span class="params">students</span>&#x27;)</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>参考文档:<br><a href="http://www.cnblogs.com/dolphinX/p/3415761.html">HTML5本地存储-IndexDB-1</a><br><a href="http://www.cnblogs.com/dolphinX/p/3416889.html">HTML5本地存储-IndexDB-2</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Markdown语法与外挂标签写法汇总</title>
      <link href="/posts/2013454d.html"/>
      <url>/posts/2013454d.html</url>
      
        <content type="html"><![CDATA[<h1>1.Markdown语法自带格式</h1><div class="note info flat"><p>参考：<a href="https://blog.csdn.net/u014061630/article/details/81359144">Markdown语法图文全面详解(10分钟学会)</a></p></div><div class="note warning flat"><p>注意：此页面偶尔会存在CSS冲突问题!</p></div><h2 id="1-1-代码块">1.1 代码块</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">\```shell</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VSCode终端</span></span><br><span class="line">hexo clean; hexo s</span><br><span class="line">hexo clean; hexo g; hexo d</span><br><span class="line">git add .; git commit -m &quot;npm publish&quot;; npm version patch; </span><br><span class="line">git push</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cmder终端</span></span><br><span class="line">hexo clean &amp;&amp; hexo s</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line">git add . &amp;&amp; git commit -m &quot;npm publish&quot; &amp;&amp; npm version patch</span><br><span class="line">git push</span><br><span class="line">\```</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VSCode终端</span></span><br><span class="line">hexo clean; hexo s</span><br><span class="line">hexo clean; hexo g; hexo d</span><br><span class="line">git add .; git commit -m &quot;npm publish&quot;; npm version patch; </span><br><span class="line">git push</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cmder终端</span></span><br><span class="line">hexo clean &amp;&amp; hexo s</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line">git add . &amp;&amp; git commit -m &quot;npm publish&quot; &amp;&amp; npm version patch</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-2-多级标题">1.2 多级标题</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># H1</span></span><br><span class="line"><span class="section">## H2</span></span><br><span class="line"><span class="section">### H3</span></span><br><span class="line"><span class="section">#### H4</span></span><br><span class="line"><span class="section">##### H5</span></span><br><span class="line"><span class="section">###### H6</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p>见本文章标题!</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-3-文字样式">1.3 文字样式</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">u</span>&gt;</span></span>下划线演示<span class="language-xml"><span class="tag">&lt;/<span class="name">u</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">文字<span class="strong">**加粗**</span>演示</span><br><span class="line"></span><br><span class="line">文字<span class="emphasis">*斜体*</span>演示</span><br><span class="line"></span><br><span class="line">文本<span class="code">`高亮`</span>演示</span><br><span class="line"></span><br><span class="line">文本~~删除~~线演示</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span> = <span class="string">5</span>&gt;</span></span>5号字<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">face</span>=<span class="string">&quot;黑体&quot;</span>&gt;</span></span>黑体<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">blue</span>&gt;</span></span>蓝色<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">MistyRose</span>&gt;</span></span>这里的背景色是：MistyRosen，此处输入任意想输入的内容<span class="language-xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p><u>下划线演示</u></p><p>文字<strong>加粗</strong>演示</p><p>文字<em>斜体</em>演示</p><p>文本<code>高亮</code>演示</p><p>文本<s>删除</s>线演示</p><p><font size = 5>5号字</font><br><font face="黑体">黑体</font><br><font color=blue>蓝色</font></p><table><tr><td bgcolor=MistyRose>这里的背景色是：MistyRosen，此处输入任意想输入的内容</td></tr></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note info flat"><p>上述要点可参考:<a href="https://blog.csdn.net/qq_43732429/article/details/108034518">【Markdown语法】字体颜色大小及文字底色设置</a></p></div><h2 id="1-4-引用">1.4 引用</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt;  Java</span></span><br><span class="line"><span class="quote">&gt; 二级引用演示</span></span><br><span class="line"><span class="quote">&gt; MySQL</span></span><br><span class="line"><span class="quote">&gt; &gt;外键</span></span><br><span class="line"><span class="quote">&gt; &gt;</span></span><br><span class="line"><span class="quote">&gt; &gt;事务</span></span><br><span class="line"><span class="quote">&gt; &gt;</span></span><br><span class="line"><span class="quote">&gt; &gt;<span class="strong">**行级锁**</span>(引用内部一样可以用格式)</span></span><br><span class="line"><span class="quote">&gt; </span></span><br><span class="line"><span class="quote">&gt; ....</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><blockquote><p>Java<br>二级引用演示<br>MySQL</p><blockquote><p>外键</p><p>事务</p><p><strong>行级锁</strong>(引用内部一样可以用格式)</p></blockquote><p>…</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-5-分割线">1.5 分割线</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="strong">**<span class="emphasis">*</span></span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><hr><hr><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-6-列表-跟空格都可以">1.6 列表(*,+,-跟空格都可以)</h2><h3 id="1-6-1-无序列表">1.6.1 无序列表</h3><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> Java</span><br><span class="line"><span class="bullet">*</span> Python</span><br><span class="line"><span class="bullet">*</span> ...</span><br><span class="line"></span><br><span class="line"><span class="bullet">+</span> Java</span><br><span class="line"><span class="bullet">+</span> Python</span><br><span class="line"><span class="bullet">+</span> ...</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Java</span><br><span class="line"><span class="bullet">-</span> Python</span><br><span class="line"><span class="bullet">-</span> ...</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ul><li>Java</li><li>Python</li><li>…</li></ul><ul><li>Java</li><li>Python</li><li>…</li></ul><ul><li>Java</li><li>Python</li><li>…</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="1-6-2-有序列表">1.6.2 有序列表</h3><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 注意后面有空格</span></span><br><span class="line"><span class="bullet">1.</span> </span><br><span class="line"><span class="bullet">2.</span> </span><br><span class="line"><span class="bullet">3.</span> </span><br><span class="line"><span class="bullet">4.</span> </span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li></li><li></li><li></li><li></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-7-图片">1.7 图片</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 本地图片</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/assets/pusheencode.webp&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;示例图片&quot;</span> <span class="attr">style</span>=<span class="string">&quot;zoom:50%;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="section"># 在线图片</span></span><br><span class="line">![<span class="string">code</span>](<span class="link">https://cdn.jsdelivr.net/gh/fomalhaut1998/markdown_pic/img/code.png</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p>本地图片:<br><img src="/assets/pusheencode.webp" alt="示例图片" style="zoom:50%;" /><br>在线图片:<br><img src="https://cdn.jsdelivr.net/gh/fomalhaut1998/markdown_pic/img/code.png" alt="code"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-8-表格">1.8 表格</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| 项目标号 | 资金     | 备注 |</span><br><span class="line">| -------- | -------- | ---- |</span><br><span class="line">| 1        | 100，000 | 无   |</span><br><span class="line">| 2        | 200，000 | 无   |</span><br><span class="line">| 3        | 300,600  | 重要 |</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><table><thead><tr><th>项目标号</th><th>资金</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>100，000</td><td>无</td></tr><tr><td>2</td><td>200，000</td><td>无</td></tr><tr><td>3</td><td>300,600</td><td>重要</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-9-公式">1.9 公式</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">\Gamma(z)=\int<span class="emphasis">_0^\infty t^&#123;z-1&#125;e^&#123;-t&#125;dt.</span></span><br><span class="line"><span class="emphasis">$$</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p>$$<br>\Gamma(z)=\int_0^\infty t^{z-1}e^{-t}dt.<br>$$</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>2.Butterfly外挂标签</h1><div class="note info flat"><p>这部分参考安知鱼:<a href="https://anzhiy.cn/posts/7d58.html">基于Butterfly的外挂标签引入</a></p></div><h2 id="2-1-行内文本样式-text">2.1 行内文本样式 text</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% u 文本内容 %&#125;</span><br><span class="line">&#123;% emp 文本内容 %&#125;</span><br><span class="line">&#123;% wavy 文本内容 %&#125;</span><br><span class="line">&#123;% del 文本内容 %&#125;</span><br><span class="line">&#123;% kbd 文本内容 %&#125;</span><br><span class="line">&#123;% psw 文本内容 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 带 &#123;% u 下划线 %&#125; 的文本</span><br><span class="line"><span class="bullet">2.</span> 带 &#123;% emp 着重号 %&#125; 的文本</span><br><span class="line"><span class="bullet">3.</span> 带 &#123;% wavy 波浪线 %&#125; 的文本</span><br><span class="line"><span class="bullet">4.</span> 带 &#123;% del 删除线 %&#125; 的文本</span><br><span class="line"><span class="bullet">5.</span> 键盘样式的文本 &#123;% kbd command %&#125; + &#123;% kbd D %&#125;</span><br><span class="line"><span class="bullet">6.</span> 密码样式的文本：&#123;% psw 这里没有验证码 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><ol><li>带 <u>下划线</u> 的文本</li><li>带 <emp>着重号</emp> 的文本</li><li>带 <wavy>波浪线</wavy> 的文本</li><li>带 <del>删除线</del> 的文本</li><li>键盘样式的文本 <kbd>command</kbd> + <kbd>D</kbd></li><li>密码样式的文本：<psw>这里没有验证码</psw></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-2-行内文本-span">2.2 行内文本 span</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% span 样式参数(参数以空格划分), 文本内容 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>字体</code>: logo, code</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>大小</code>: small, h4, h3, h2, h1, large, huge, ultra</li><li><code>对齐方向</code>: left, center, right</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 彩色文字</span><br><span class="line">在一段话中方便插入各种颜色的标签，包括：&#123;% span red, 红色 %&#125;、&#123;% span yellow, 黄色 %&#125;、&#123;% span green, 绿色 %&#125;、&#123;% span cyan, 青色 %&#125;、&#123;% span blue, 蓝色 %&#125;、&#123;% span gray, 灰色 %&#125;。</span><br><span class="line"><span class="bullet">-</span> 超大号文字</span><br><span class="line">文档「开始」页面中的标题部分就是超大号文字。</span><br><span class="line">&#123;% span center logo large, Volantis %&#125;</span><br><span class="line">&#123;% span center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><ul><li>彩色文字<br>在一段话中方便插入各种颜色的标签，包括：<span class='p red'>红色</span>、<span class='p yellow'>黄色</span>、<span class='p green'>绿色</span>、<span class='p cyan'>青色</span>、<span class='p blue'>蓝色</span>、<span class='p gray'>灰色</span>。</li><li>超大号文字<br>文档「开始」页面中的标题部分就是超大号文字。<br><span class='p center logo large'>Volantis</span><br><span class='p center small'>A Wonderful Theme for Hexo</span></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-3-段落文本-p">2.3 段落文本 p</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% p 样式参数(参数以空格划分), 文本内容 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>字体</code>: logo, code</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>大小</code>: small, h4, h3, h2, h1, large, huge, ultra</li><li><code>对齐方向</code>: left, center, right</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 彩色文字</span><br><span class="line">在一段话中方便插入各种颜色的标签，包括：&#123;% p red, 红色 %&#125;、&#123;% p yellow, 黄色 %&#125;、&#123;% p green, 绿色 %&#125;、&#123;% p cyan, 青色 %&#125;、&#123;% p blue, 蓝色 %&#125;、&#123;% p gray, 灰色 %&#125;。</span><br><span class="line"><span class="bullet">-</span> 超大号文字</span><br><span class="line">文档「开始」页面中的标题部分就是超大号文字。</span><br><span class="line">&#123;% p center logo large, Volantis %&#125;</span><br><span class="line">&#123;% p center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><ul><li>彩色文字<br>在一段话中方便插入各种颜色的标签，包括：<p class='p red'>红色</p>、<p class='p yellow'>黄色</p>、<p class='p green'>绿色</p>、<p class='p cyan'>青色</p>、<p class='p blue'>蓝色</p>、<p class='p gray'>灰色</p>。</li><li>超大号文字<br>文档「开始」页面中的标题部分就是超大号文字。</li></ul><p class='p center logo large'>Volantis</p><p class='p center small'>A Wonderful Theme for Hexo</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-4-引用note">2.4 引用note</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">通用配置</button></li><li class="tab"><button type="button" data-href="#分栏-2">语法格式</button></li><li class="tab"><button type="button" data-href="#分栏-3">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-4">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-5">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">note:</span><br><span class="line">  # Note tag style values:</span><br><span class="line">  #  - simple    bs-callout old alert style. Default.</span><br><span class="line">  #  - modern    bs-callout new (v2-v3) alert style.</span><br><span class="line">  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span><br><span class="line">  #  - disabled  disable all CSS styles import of note tag.</span><br><span class="line">  style: simple</span><br><span class="line">  icons: false</span><br><span class="line">  border<span class="emphasis">_radius: 3</span></span><br><span class="line"><span class="emphasis">  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line"><span class="emphasis">  # Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line"><span class="emphasis">  light_</span>bg<span class="emphasis">_offset: 0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 自带icon</span></span><br><span class="line">&#123;% note [class] [no-icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"><span class="section"># 外部icon</span></span><br><span class="line">&#123;% note [color] [icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.自带icon</p><table><thead><tr><th>参数</th><th style="text-align:center">用法</th></tr></thead><tbody><tr><td>class</td><td style="text-align:center">【可选】标识，不同的标识有不同的配色 （ default / primary / success / info / warning / danger ）</td></tr><tr><td>no-icon</td><td style="text-align:center">【可选】不显示 icon</td></tr><tr><td>style</td><td style="text-align:center">【可选】可以覆盖配置中的 style （simple/modern/flat/disabled）</td></tr></tbody></table><p>2.外部icon</p><table><thead><tr><th>参数</th><th style="text-align:center">用法</th></tr></thead><tbody><tr><td>class</td><td style="text-align:center">【可选】标识，不同的标识有不同的配色 （ default / blue / pink / red / purple / orange / green ）</td></tr><tr><td>no-icon</td><td style="text-align:center">【可选】可配置自定义 icon (只支持 fontawesome 图标, 也可以配置 no-icon )</td></tr><tr><td>style</td><td style="text-align:center">【可选】可以覆盖配置中的 style （simple/modern/flat/disabled）</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><details class="folding-tag" blue><summary> 1.自带icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note simple %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default simple %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary simple %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success simple %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info simple %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning simple %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger simple %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>2.<code>modern</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note modern %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default modern %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary modern %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success modern %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info modern %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning modern %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger modern %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>3.<code>flat</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note flat %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default flat %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary flat %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success flat %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info flat %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning flat %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger flat %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>4.<code>disabled</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note disabled %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default disabled %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary disabled %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success disabled %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info disabled %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning disabled %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger disabled %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>5.<code>no-icon</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default no-icon %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary no-icon %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success no-icon %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info no-icon %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning no-icon %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger no-icon %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" blue><summary> 2.外部icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; simple %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; simple %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; simple %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; simple%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; simple %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; simple %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; simple %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>2.<code>modern</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; modern %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; modern %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; modern%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; modern %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; modern %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; modern %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>3.<code>flat</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; flat %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; flat %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; flat %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; flat%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; flat %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; flat %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; flat %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>4.<code>disabled</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; disabled %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; disabled %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; disabled %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; disabled %&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; disabled %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; disabled %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; disabled %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>5.<code>no-icon</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue no-icon %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink no-icon %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red no-icon %&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange no-icon %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple no-icon %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green no-icon %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-5"><details class="folding-tag" blue><summary> 1.自带icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><div class="note simple"><p>默认 提示块标签</p></div><div class="note default simple"><p>default 提示块标签</p></div><div class="note primary simple"><p>primary 提示块标签</p></div><div class="note success simple"><p>success 提示块标签</p></div><div class="note info simple"><p>info 提示块标签</p></div><div class="note warning simple"><p>warning 提示块标签</p></div><div class="note danger simple"><p>danger 提示块标签</p></div>2.`modern`样式<div class="note modern"><p>默认 提示块标签</p></div><div class="note default modern"><p>default 提示块标签</p></div><div class="note primary modern"><p>primary 提示块标签</p></div><div class="note success modern"><p>success 提示块标签</p></div><div class="note info modern"><p>info 提示块标签</p></div><div class="note warning modern"><p>warning 提示块标签</p></div><div class="note danger modern"><p>danger 提示块标签</p></div><p>3.<code>flat</code>样式</p><div class="note flat"><p>默认 提示块标签</p></div><div class="note default flat"><p>default 提示块标签</p></div><div class="note primary flat"><p>primary 提示块标签</p></div><div class="note success flat"><p>success 提示块标签</p></div><div class="note info flat"><p>info 提示块标签</p></div><div class="note warning flat"><p>warning 提示块标签</p></div><div class="note danger flat"><p>danger 提示块标签</p></div><p>4.<code>disabled</code>样式</p><div class="note disabled"><p>默认 提示块标签</p></div><div class="note default disabled"><p>default 提示块标签</p></div><div class="note primary disabled"><p>primary 提示块标签</p></div><div class="note success disabled"><p>success 提示块标签</p></div><div class="note info disabled"><p>info 提示块标签</p></div><div class="note warning disabled"><p>warning 提示块标签</p></div><div class="note danger disabled"><p>danger 提示块标签</p></div><p>5.<code>no-icon</code>样式</p><div class="note no-icon flat"><p>默认 提示块标签</p></div><div class="note default no-icon flat"><p>default 提示块标签</p></div><div class="note primary no-icon flat"><p>primary 提示块标签</p></div><div class="note success no-icon flat"><p>success 提示块标签</p></div><div class="note info no-icon flat"><p>info 提示块标签</p></div><div class="note warning no-icon flat"><p>warning 提示块标签</p></div><div class="note danger no-icon flat"><p>danger 提示块标签</p></div>              </div>            </details><details class="folding-tag" blue><summary> 2.外部icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><div class="note icon-padding simple"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding simple"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了…</p></div><div class="note pink icon-padding simple"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding simple"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding simple"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding simple"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>2.<code>modern</code>样式</p><div class="note icon-padding modern"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了…</p></div><div class="note pink icon-padding modern"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding modern"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding modern"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding modern"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>3.<code>flat</code>样式</p><div class="note icon-padding flat"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding flat"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了…</p></div><div class="note pink icon-padding flat"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding flat"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding flat"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding flat"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding flat"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>4.<code>disabled</code>样式</p><div class="note icon-padding disabled"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding disabled"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了…</p></div><div class="note pink icon-padding disabled"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding disabled"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding disabled"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding disabled"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding disabled"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>5.<code>no-icon</code>样式</p><div class="note no-icon flat"><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue no-icon flat"><p>2021年快到了…</p></div><div class="note pink no-icon flat"><p>小心开车 安全至上</p></div><div class="note red no-icon flat"><p>这是三片呢？还是四片？</p></div><div class="note orange no-icon flat"><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple no-icon flat"><p>剪刀石头布</p></div><div class="note green no-icon flat"><p>前端最讨厌的浏览器</p></div>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-5-上标标签-tip">2.5 上标标签 tip</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [参数，可选] %&#125;文本内容&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>样式</code>: success,error,warning,bolt,ban,home,sync,cogs,key,bell</li><li><code>自定义图标</code>: 支持fontawesome。</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip %&#125;default&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip info %&#125;info&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip success %&#125;success&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip error %&#125;error&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip warning %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bolt %&#125;bolt&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban %&#125;ban&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip home %&#125;home&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip sync %&#125;sync&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip cogs %&#125;cogs&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip key %&#125;key&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bell %&#125;bell&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip fa-atom %&#125;自定义font awesome图标&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class="tip "><p>default</p></div><div class="tip info"><p>info</p></div><div class="tip success"><p>success</p></div><div class="tip error"><p>error</p></div><div class="tip warning"><p>warning</p></div><div class="tip bolt"><p>bolt</p></div><div class="tip ban"><p>ban</p></div><div class="tip home"><p>home</p></div><div class="tip sync"><p>sync</p></div><div class="tip cogs"><p>cogs</p></div><div class="tip key"><p>key</p></div><div class="tip bell"><p>bell</p></div><div class="tip fa-atom"><p>自定义font awesome图标</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-6-动态标签-anima">2.6 动态标签 anima</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [参数，可选] %&#125;文本内容&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><div class="note info flat"><ol><li>将所需的CSS类添加到图标（或DOM中的任何元素）。</li><li>对于父级悬停样式，需要给目标元素添加指定CSS类，同时还要给目标元素的父级元素添加CSS类<code>faa-parent animated-hover</code>。（详情见示例及示例源码）<br>You can regulate the speed of the animation by adding the CSS class or . faa-fastfaa-slow</li><li>可以通过给目标元素添加CSS类<code>faa-fast</code>或<code>faa-slow</code>来控制动画快慢。</li></ol></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.On DOM load（当页面加载时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>2.调整动画速度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated faa-fast %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated faa-slow %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>3.On hover（当鼠标悬停时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated-hover %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated-hover %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>4.On parent hover（当鼠标悬停在父级元素时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-parent animated-hover %&#125;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;faa-horizontal&quot;</span>&gt;</span></span>warning<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-parent animated-hover %&#125;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;faa-flash&quot;</span>&gt;</span></span>ban<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.On DOM load（当页面加载时显示动画）</p><div class="tip warning faa-horizontal animated"><p>warning</p></div><div class="tip ban faa-flash animated"><p>ban</p></div>2.调整动画速度<div class="tip warning faa-horizontal animated faa-fast"><p>warning</p></div><div class="tip ban faa-flash animated faa-slow"><p>ban</p></div>3.On hover（当鼠标悬停时显示动画）<div class="tip warning faa-horizontal animated-hover"><p>warning</p></div><div class="tip ban faa-flash animated-hover"><p>ban</p></div>4.On parent hover（当鼠标悬停在父级元素时显示动画）<div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">warning</p></div><div class="tip ban faa-parent animated-hover"><p class="faa-flash">ban</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-7-复选列表-checkbox">2.7 复选列表 checkbox</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox 样式参数（可选）, 文本（支持简单md） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>样式</code>: plus, minus, times</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>选中状态</code>: checked</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox 纯文本测试 %&#125;</span><br><span class="line">&#123;% checkbox checked, 支持简单的 [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) 语法 %&#125;</span><br><span class="line">&#123;% checkbox red, 支持自定义颜色 %&#125;</span><br><span class="line">&#123;% checkbox green checked, 绿色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox yellow checked, 黄色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox cyan checked, 青色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox blue checked, 蓝色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox plus green checked, 增加 %&#125;</span><br><span class="line">&#123;% checkbox minus yellow checked, 减少 %&#125;</span><br><span class="line">&#123;% checkbox times red checked, 叉 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class='checkbox'><input type="checkbox" />            <p>纯文本测试</p>            </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>            <p>支持简单的 <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> 语法</p>            </div><div class='checkbox red'><input type="checkbox" />            <p>支持自定义颜色</p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p>绿色 + 默认选中</p>            </div><div class='checkbox yellow checked'><input type="checkbox" checked="checked"/>            <p>黄色 + 默认选中</p>            </div><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>青色 + 默认选中</p>            </div><div class='checkbox blue checked'><input type="checkbox" checked="checked"/>            <p>蓝色 + 默认选中</p>            </div><div class='checkbox plus green checked'><input type="checkbox" checked="checked"/>            <p>增加</p>            </div><div class='checkbox minus yellow checked'><input type="checkbox" checked="checked"/>            <p>减少</p>            </div><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p>叉</p>            </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-8-单选列表-radio">2.8 单选列表 radio</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio 样式参数（可选）, 文本（支持简单md） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>选中状态</code>: checked</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio 纯文本测试 %&#125;</span><br><span class="line">&#123;% radio checked, 支持简单的 [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) 语法 %&#125;</span><br><span class="line">&#123;% radio red, 支持自定义颜色 %&#125;</span><br><span class="line">&#123;% radio green, 绿色 %&#125;</span><br><span class="line">&#123;% radio yellow, 黄色 %&#125;</span><br><span class="line">&#123;% radio cyan, 青色 %&#125;</span><br><span class="line">&#123;% radio blue, 蓝色 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class='checkbox'><input type="radio" />            <p>纯文本测试</p>            </div><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>支持简单的 <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> 语法</p>            </div><div class='checkbox red'><input type="radio" />            <p>支持自定义颜色</p>            </div><div class='checkbox green'><input type="radio" />            <p>绿色</p>            </div><div class='checkbox yellow'><input type="radio" />            <p>黄色</p>            </div><div class='checkbox cyan'><input type="radio" />            <p>青色</p>            </div><div class='checkbox blue'><input type="radio" />            <p>蓝色</p>            </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-9-时间轴-timeline">2.9 时间轴 timeline</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 时间线标题（可选）[,color] %&#125;</span><br><span class="line">&lt;!-- timeline 时间节点（标题） --&gt;</span><br><span class="line">正文内容</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&lt;!-- timeline 时间节点（标题） --&gt;</span><br><span class="line">正文内容</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>title</code>:标题/时间线</li><li><code>color</code>:<code>timeline</code>颜色:default(留空) / blue / pink / red / purple / orange / green</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 时间轴样式,blue %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-07-24 [<span class="string">2.6.6 -&gt; 3.0</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases</span>) --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 如果有 <span class="code">`hexo-lazyload-image`</span> 插件，需要删除并重新安装最新版本，设置 <span class="code">`lazyload.isSPA: true`</span>。</span><br><span class="line"><span class="bullet">2.</span> 2.x 版本的 css 和 js 不适用于 3.x 版本，如果使用了 <span class="code">`use_cdn: true`</span> 则需要删除。</span><br><span class="line"><span class="bullet">3.</span> 2.x 版本的 fancybox 标签在 3.x 版本中被重命名为 gallery 。</span><br><span class="line"><span class="bullet">4.</span> 2.x 版本的置顶 <span class="code">`top: true`</span> 改为了 <span class="code">`pin: true`</span>，并且同样适用于 <span class="code">`layout: page`</span> 的页面。</span><br><span class="line"><span class="bullet">5.</span> 如果使用了 <span class="code">`hexo-offline`</span> 插件，建议卸载，3.0 版本默认开启了 pjax 服务。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-05-15 [<span class="string">2.6.3 -&gt; 2.6.6</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.6</span>) --&gt;</span><br><span class="line"></span><br><span class="line">不需要额外处理。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-04-20 [<span class="string">2.6.2 -&gt; 2.6.3</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.3</span>) --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 全局搜索 <span class="code">`seotitle`</span> 并替换为 <span class="code">`seo_title`</span>。</span><br><span class="line"><span class="bullet">2.</span> group 组件的索引规则有变，使用 group 组件的文章内，<span class="code">`group: group_name`</span> 对应的组件名必须是 <span class="code">`group_name`</span>。</span><br><span class="line"><span class="bullet">2.</span> group 组件的列表名优先显示文章的 <span class="code">`short_title`</span> 其次是 <span class="code">`title`</span>。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>时间轴样式</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-07-24 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases">2.6.6 -&gt; 3.0</a></p></div></div><div class='timeline-item-content'><ol><li>如果有 <code>hexo-lazyload-image</code> 插件，需要删除并重新安装最新版本，设置 <code>lazyload.isSPA: true</code>。</li><li>2.x 版本的 css 和 js 不适用于 3.x 版本，如果使用了 <code>use_cdn: true</code> 则需要删除。</li><li>2.x 版本的 fancybox 标签在 3.x 版本中被重命名为 gallery 。</li><li>2.x 版本的置顶 <code>top: true</code> 改为了 <code>pin: true</code>，并且同样适用于 <code>layout: page</code> 的页面。</li><li>如果使用了 <code>hexo-offline</code> 插件，建议卸载，3.0 版本默认开启了 pjax 服务。</li></ol></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-05-15 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.6">2.6.3 -&gt; 2.6.6</a></p></div></div><div class='timeline-item-content'><p>不需要额外处理。</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-04-20 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.3">2.6.2 -&gt; 2.6.3</a></p></div></div><div class='timeline-item-content'><ol><li>全局搜索 <code>seotitle</code> 并替换为 <code>seo_title</code>。</li><li>group 组件的索引规则有变，使用 group 组件的文章内，<code>group: group_name</code> 对应的组件名必须是 <code>group_name</code>。</li><li>group 组件的列表名优先显示文章的 <code>short_title</code> 其次是 <code>title</code>。</li></ol></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-10-链接卡片-link">2.10 链接卡片 link</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link 标题, 链接, 图片链接（可选） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link 糖果屋教程贴, https://akilar.top/posts/615e2dec/, https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><div class="tag link"><a class="link-card" title="糖果屋教程贴" href="https://akilar.top/posts/615e2dec/"><div class="left"><img src="https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico"/></div><div class="right"><p class="text">糖果屋教程贴</p><p class="url">https://akilar.top/posts/615e2dec/</p></div></a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-11-按钮-btns">2.11 按钮 btns</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns 样式参数 %&#125;</span><br><span class="line">&#123;% cell 标题, 链接, 图片或者图标 %&#125;</span><br><span class="line">&#123;% cell 标题, 链接, 图片或者图标 %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li>圆角样式：rounded, circle</li><li>增加文字样式：可以在容器内增加 <code>&lt;b&gt;</code>标题<code>&lt;/b&gt;</code>和<code>&lt;p&gt;</code>描述文字<code>&lt;/p&gt;</code></li><li>布局方式：<br>默认为自动宽度，适合视野内只有一两个的情况。</li></ol><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>wide</td><td>宽一点的按钮</td></tr><tr><td>fill</td><td>填充布局，自动铺满至少一行，多了会换行</td></tr><tr><td>center</td><td>居中，按钮之间是固定间距</td></tr><tr><td>around</td><td>居中分散</td></tr><tr><td>grid2</td><td>等宽最多2列，屏幕变窄会适当减少列数</td></tr><tr><td>grid3</td><td>等宽最多3列，屏幕变窄会适当减少列数</td></tr><tr><td>grid4</td><td>等宽最多4列，屏幕变窄会适当减少列数</td></tr><tr><td>grid5</td><td>等宽最多5列，屏幕变窄会适当减少列数</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.如果需要显示类似「团队成员」之类的一组含有头像的链接</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle grid5 %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><p>2.或者含有图标的按钮</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns rounded grid5 %&#125;</span><br><span class="line">&#123;% cell 下载源码, /, fas fa-download %&#125;</span><br><span class="line">&#123;% cell 查看文档, /, fas fa-book-open %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><p>3.圆形图标 + 标题 + 描述 + 图片 + 网格5列 + 居中</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle center grid5 %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1&#x27;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;fab fa-apple&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>心率管家<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">  &#123;% p red, 专业版 %&#125;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_pro.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1&#x27;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;fab fa-apple&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>心率管家<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">  &#123;% p green, 免费版 %&#125;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_lite.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.如果需要显示类似「团队成员」之类的一组含有头像的链接</p><div class="btns circle grid5">            <a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a>          </div>2.或者含有图标的按钮<div class="btns rounded grid5">            <a class="button" href='/' title='下载源码'><i class='fas fa-download'></i>下载源码</a><a class="button" href='/' title='查看文档'><i class='fas fa-book-open'></i>查看文档</a>          </div>3.圆形图标 + 标题 + 描述 + 图片 + 网格5列 + 居中<div class="btns circle center grid5">            <a href='https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1'>  <i class='fab fa-apple'></i>  <b>心率管家</b>  <p class='p red'>专业版</p>  <img src='https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_pro.png'></a><a href='https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1'>  <i class='fab fa-apple'></i>  <b>心率管家</b>  <p class='p green'>免费版</p>  <img src='https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_lite.png'></a>          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-12-github卡片-ghcard">2.12 github卡片 ghcard</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ghcard 用户名, 其它参数（可选） %&#125;</span><br><span class="line">&#123;% ghcard 用户名/仓库, 其它参数（可选） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><p>使用<code>,</code>分割各个参数。写法为：<code>参数名=参数值</code><br>以下只写几个常用参数值。</p><table><thead><tr><th><strong>参数名</strong></th><th>取值</th><th>释义</th></tr></thead><tbody><tr><td>hide</td><td>stars,commits,prs,issues,contribs</td><td>隐藏指定统计</td></tr><tr><td>count_private</td><td>true</td><td>将私人项目贡献添加到总提交计数中</td></tr><tr><td>show_icons</td><td>true</td><td>显示图标</td></tr><tr><td>theme</td><td>查阅:<a href="https://github.com/anuraghazra/github-readme-stats/blob/master/themes/README.md">Available Themes</a></td><td>主题</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.用户信息卡片</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| &#123;% ghcard fomalhaut1998 %&#125; | &#123;% ghcard fomalhaut1998, theme=vue %&#125; |</span><br><span class="line">| -- | -- |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=buefy %&#125; | &#123;% ghcard fomalhaut1998, theme=solarized-light %&#125; |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=onedark %&#125; | &#123;% ghcard fomalhaut1998, theme=solarized-dark %&#125; |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=algolia %&#125; | &#123;% ghcard fomalhaut1998, theme=calm %&#125; |</span><br></pre></td></tr></table></figure><p>2.仓库信息卡片</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=vue %&#125; |</span><br><span class="line">| -- | -- |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=buefy %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=solarized-light %&#125; |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=onedark %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=solarized-dark %&#125; |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=algolia %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=calm %&#125; |</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.用户信息卡片</p><table><thead><tr><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&show_owner=true"/></a></th><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=vue&show_owner=true"/></a></th></tr></thead><tbody><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=buefy&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=solarized-light&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=onedark&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=solarized-dark&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=algolia&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=calm&show_owner=true"/></a></td></tr></tbody></table><p>2.仓库信息卡片</p><table><thead><tr><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&show_owner=true"/></a></th><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=vue&show_owner=true"/></a></th></tr></thead><tbody><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=buefy&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=solarized-light&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=onedark&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=solarized-dark&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=algolia&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=calm&show_owner=true"/></a></td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-13-github徽标-ghbdage">2.13 github徽标 ghbdage</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage [right],[left],[logo]||[color],[link],[title]||[option] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>left</code>：徽标左边的信息，必选参数。</li><li><code>right</code>: 徽标右边的信息，必选参数，</li><li><code>logo</code>：徽标图标，图标名称详见<a href="https://simpleicons.org/">simpleicons</a>，可选参数。</li><li><code>color</code>：徽标右边的颜色，可选参数。</li><li><code>link</code>：指向的链接，可选参数。</li><li><code>title</code>：徽标的额外信息，可选参数。主要用于优化SEO，但<code>object</code>标签不会像<code>a</code>标签一样在鼠标悬停显示<code>title</code>信息。</li><li><code>option</code>：自定义参数，支持<a href="https://shields.io/">shields.io</a>的全部API参数支持，具体参数可以参看上文中的拓展写法示例。形式为<code>name1=value2&amp;name2=value2</code>。</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.基本参数,定义徽标左右文字和图标</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage Theme,Butterfly %&#125;</span><br><span class="line">&#123;% bdage Frame,Hexo,hexo %&#125;</span><br></pre></td></tr></table></figure><p>2.信息参数，定义徽标右侧内容背景色，指向链接</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage CDN,JsDelivr,jsDelivr||abcdef,https://metroui.org.ua/index.html,本站使用JsDelivr为静态资源提供CDN加速 %&#125;</span><br><span class="line">//如果是跨顺序省略可选参数，仍然需要写个逗号,用作分割</span><br><span class="line">&#123;% bdage Source,GitHub,GitHub||,https://github.com/ %&#125;</span><br></pre></td></tr></table></figure><p>3.拓展参数，支持shields的API的全部参数内容</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage Hosted,Vercel,Vercel||brightgreen,https://vercel.com/,本站采用双线部署，默认线路托管于Vercel||style=social&amp;logoWidth=20 %&#125;</span><br><span class="line">//如果是跨顺序省略可选参数组，仍然需要写双竖线||用作分割</span><br><span class="line">&#123;% bdage Hosted,Vercel,Vercel||||style=social&amp;logoWidth=20&amp;logoColor=violet %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.基本参数,定义徽标左右文字和图标</p><p><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Butterfly-Theme-orange?logo=&color=orange&link=&"></object><br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Hexo-Frame-orange?logo=hexo&color=orange&link=&"></object></p><p>2.信息参数，定义徽标右侧内容背景色，指向链接</p><p><object class="ghbdage" style="margin-inline:5px" title="本站使用JsDelivr为静态资源提供CDN加速" standby="loading..." data="https://img.shields.io/badge/JsDelivr-CDN-orange?logo=jsDelivr&color=abcdef&link=https://metroui.org.ua/index.html&"></object><br>//如果是跨顺序省略可选参数，仍然需要写个逗号,用作分割<br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/GitHub-Source-orange?logo=GitHub&color=orange&link=https://github.com/&"></object></p><p>3.拓展参数，支持shields的API的全部参数内容</p><p><object class="ghbdage" style="margin-inline:5px" title="本站采用双线部署，默认线路托管于Vercel" standby="loading..." data="https://img.shields.io/badge/Vercel-Hosted-orange?logo=Vercel&color=brightgreen&link=https://vercel.com/&style=social&logoWidth=20"></object><br>//如果是跨顺序省略可选参数组，仍然需要写双竖线||用作分割<br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Vercel-Hosted-orange?logo=Vercel&color=orange&link=&style=social&logoWidth=20&logoColor=violet"></object></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-14-网站卡片-sites">2.14 网站卡片 sites</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site 标题, url=链接, screenshot=截图链接, avatar=头像链接（可选）, description=描述（可选） %&#125;</span><br><span class="line">&#123;% site 标题, url=链接, screenshot=截图链接, avatar=头像链接（可选）, description=描述（可选） %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site xaoxuu, url=https://xaoxuu.com, screenshot=https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg, avatar=https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/avatar/avatar.png, description=简约风格 %&#125;</span><br><span class="line">&#123;% site inkss, url=https://inkss.cn, screenshot=https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg, avatar=https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site MHuiG, url=https://blog.mhuig.top, screenshot=https://i.loli.net/2020/08/22/d24zpPlhLYWX6D1.png, avatar=https://cdn.jsdelivr.net/gh/MHuiG/imgbed@master/data/p.png, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site Colsrch, url=https://colsrch.top, screenshot=https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png, avatar=https://cdn.jsdelivr.net/gh/Colsrch/images/Colsrch/avatar.jpg, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site Linhk1606, url=https://linhk1606.github.io, screenshot=https://i.loli.net/2020/08/21/3PmGLCKicnfow1x.png, avatar=https://i.loli.net/2020/02/09/PN7I5RJfFtA93r2.png, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><div class="site-card-group"><a class="site-card" href="https://fomalhaut1998.com"><div class="img"><img src="https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/avatar/avatar.png"/><span class="title">fomalhaut1998</span><span class="desc">简约风格</span></div></a><a class="site-card" href="https://inkss.cn"><div class="img"><img src="https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg"/><span class="title">inkss</span><span class="desc">这是一段关于这个网站的描述文字</span></div></a><a class="site-card" href="https://blog.mhuig.top"><div class="img"><img src="https://i.loli.net/2020/08/22/d24zpPlhLYWX6D1.png"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/MHuiG/imgbed@master/data/p.png"/><span class="title">MHuiG</span><span class="desc">这是一段关于这个网站的描述文字</span></div></a><a class="site-card" href="https://colsrch.top"><div class="img"><img src="https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/Colsrch/images/Colsrch/avatar.jpg"/><span class="title">Colsrch</span><span class="desc">这是一段关于这个网站的描述文字</span></div></a><a class="site-card" href="https://linhk1606.github.io"><div class="img"><img src="https://i.loli.net/2020/08/21/3PmGLCKicnfow1x.png"/></div><div class="info"><img src="https://i.loli.net/2020/02/09/PN7I5RJfFtA93r2.png"/><span class="title">Linhk1606</span><span class="desc">这是一段关于这个网站的描述文字</span></div></a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-15-行内图片-inlineimage">2.15 行内图片 inlineimage</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% inlineimage 图片链接, height=高度（可选） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>高度</code>：height=20px</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这是 &#123;% inlineimage https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/0000.gif %&#125; 一段话。</span><br><span class="line"></span><br><span class="line">这又是 &#123;% inlineimage https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/5150.gif, height=40px %&#125; 一段话。</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>这是 <img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/0000.gif" style="height:1.5em"/> 一段话。</p><p>这又是 <img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/5150.gif" style="height:40px;"/> 一段话。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-16-单张图片-image">2.16 单张图片 image</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image 链接, width=宽度（可选）, height=高度（可选）, alt=描述（可选）, bg=占位颜色（可选） %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li>图片宽度高度：width=300px, height=32px</li><li>图片描述：alt=图片描述（butterfly需要在主题配置文件中开启图片描述）</li><li>占位背景色：bg=#f2f2f2</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.添加描述：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, alt=每天下课回宿舍的路，没有什么故事。 %&#125;</span><br></pre></td></tr></table></figure><p>2.指定宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px %&#125;</span><br></pre></td></tr></table></figure><p>3.指定宽度并添加描述：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px, alt=每天下课回宿舍的路，没有什么故事。 %&#125;</span><br></pre></td></tr></table></figure><p>4.设置占位背景色：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px, bg=#1D0C04, alt=优化不同宽度浏览的观感 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.添加描述：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="每天下课回宿舍的路，没有什么故事。"/></div><span class="image-caption">每天下课回宿舍的路，没有什么故事。</span></div>2..指定宽度<div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" style="width:400px;"/></div></div>3.指定宽度并添加描述：<div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="每天下课回宿舍的路，没有什么故事。" style="width:400px;"/></div><span class="image-caption">每天下课回宿舍的路，没有什么故事。</span></div>4.设置占位背景色：<div class="img-wrap"><div class="img-bg" style="background:#1D0C04"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="优化不同宽度浏览的观感" style="width:400px;"/></div><span class="image-caption">优化不同宽度浏览的观感</span></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-17-音频-audio">2.17 音频 audio</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio 音频链接 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><div class="audio"><audio controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3' type='audio/mp3'>Your browser does not support the audio tag.</audio></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-18-视频-video">2.18 视频 video</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video 视频链接 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>对齐方向</code>：left, center, right</li><li><code>列数</code>：逗号后面直接写列数，支持 1 ～ 4 列。</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.100%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br></pre></td></tr></table></figure><p>2.50%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 2 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure><p>3.25%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 4 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.100%宽度</p><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div>2.50%宽度<div class="videos" col='2'><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div></div>3.25%宽度<div class="videos" col='4'><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-19-相册-gallery">2.19 相册 gallery</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>2.gallery 相册</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">markdown 圖片格式</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ul><li>gallerygroup 相册图库</li></ul><table><thead><tr><th>参数名</th><th>释义</th></tr></thead><tbody><tr><td>name</td><td>图库名字</td></tr><tr><td>description</td><td>图库描述</td></tr><tr><td>link</td><td>链接到对应相册的地址</td></tr><tr><td>img-url</td><td>图库封面</td></tr></tbody></table><ul><li><p>gallery 相册</p><p>区别于旧版的Gallery相册,新的Gallery相册会自动根据图片长度进行排版，书写也更加方便，与markdown格式一样。可根据需要插入到相应的md。无需再自己配置长宽。<strong>建议在粘贴时故意使用长短、大小、横竖不一的图片</strong>，会有更好的效果。（尺寸完全相同的图片只会平铺输出，效果很糟糕）</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup MC 在Rikkaの六花服务器里留下的足迹 &#x27;/gallery/MC/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/1.jpg %&#125;</span><br><span class="line">&#123;% galleryGroup Gundam 哦咧哇gundam哒！ &#x27;/gallery/Gundam/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907110508327.png %&#125;</span><br><span class="line">&#123;% galleryGroup I-am-Akilar 某种意义上也算自拍吧 &#x27;/gallery/I-am-Akilar/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907113116651.png %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>2.gallery 相册</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg</span>)</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg</span>)</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.gallerygroup 相册图库</p><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/1.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">MC</div>  <p>在Rikkaの六花服务器里留下的足迹</p>  <a href='/gallery/MC/'></a>  </figcaption>  </figure>  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907110508327.png' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Gundam</div>  <p>哦咧哇gundam哒！</p>  <a href='/gallery/Gundam/'></a>  </figcaption>  </figure>  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907113116651.png' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">I-am-Akilar</div>  <p>某种意义上也算自拍吧</p>  <a href='/gallery/I-am-Akilar/'></a>  </figcaption>  </figure></div>2.gallery 相册<div class="fj-gallery"><p><img src="https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg" alt=""></p>          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-20-折叠框-folding">2.20 折叠框 folding</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding 参数（可选）, 标题 %&#125;</span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><!-- tab 参数配置 --><ol><li><p><code>颜色</code>：blue, cyan, green, yellow, red</p></li><li><p><code>状态</code>：状态填写 open 代表默认打开。</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding 查看图片测试 %&#125;</span><br><span class="line"></span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding cyan open, 查看默认打开的折叠框 %&#125;</span><br><span class="line"></span><br><span class="line">这是一个默认打开的折叠框。</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding green, 查看代码测试 %&#125;</span><br><span class="line">假装这里有代码块（代码块没法嵌套代码块）</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding yellow, 查看列表测试 %&#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> haha</span><br><span class="line"><span class="bullet">-</span> hehe</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding red, 查看嵌套测试 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding blue, 查看嵌套测试2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding 查看嵌套测试3 %&#125;</span><br><span class="line"></span><br><span class="line">hahaha <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png&#x27;</span> <span class="attr">style</span>=<span class="string">&#x27;height:24px&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><details class="folding-tag" ><summary> 查看图片测试 </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg" alt=""></p>              </div>            </details><details class="folding-tag" cyan open><summary> 查看默认打开的折叠框 </summary>              <div class='content'>              <p>这是一个默认打开的折叠框。</p>              </div>            </details><details class="folding-tag" green><summary> 查看代码测试 </summary>              <div class='content'>              <p>假装这里有代码块（代码块没法嵌套代码块）</p>              </div>            </details><details class="folding-tag" yellow><summary> 查看列表测试 </summary>              <div class='content'>              <ul><li>haha</li><li>hehe</li></ul>              </div>            </details><details class="folding-tag" red><summary> 查看嵌套测试 </summary>              <div class='content'>              <details class="folding-tag" blue><summary> 查看嵌套测试2 </summary>              <div class='content'>              <details class="folding-tag" ><summary> 查看嵌套测试3 </summary>              <div class='content'>              <p>hahaha <span><img src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png' style='height:24px'></span></p>              </div>            </details>              </div>            </details>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-21-分栏-tab">2.21 分栏 tab</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">配置参数</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><p>Unique name :</p><ul><li><p>选项卡块标签的唯一名称，不带逗号。</p></li><li><p>将在#id中用作每个标签及其索引号的前缀。</p></li><li><p>如果名称中包含空格，则对于生成#id，所有空格将由破折号代替。</p></li><li><p>仅当前帖子/页面的URL必须是唯一的！</p></li></ul></li><li><p>[index]:</p><ul><li><p>活动选项卡的索引号。</p></li><li><p>如果未指定，将选择第一个标签（1）。</p></li><li><p>如果index为-1，则不会选择任何选项卡。</p></li><li><p>可选参数。</p></li></ul></li><li><p>[Tab caption]:</p><ul><li><p>当前选项卡的标题。</p></li><li><p>如果未指定标题，则带有制表符索引后缀的唯一名称将用作制表符的标题。</p></li><li><p>如果未指定标题，但指定了图标，则标题将为空。</p></li><li><p>可选参数。</p></li></ul></li><li><p>[@icon]:</p><ul><li><p>FontAwesome图标名称（全名，看起来像“ fas fa-font”）</p></li><li><p>可以指定带空格或不带空格；</p></li><li><p>例如’Tab caption @icon’ 和 ‘Tab caption@icon’.</p></li><li><p>可选参数。</p></li></ul></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.Demo 1 - 预设选择第一个【默认】</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>2.Demo 2 - 预设选择tabs</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test2, 3 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>3.Demo 3 - 没有预设值</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test3, -1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>4.Demo 4 - 自定义Tab名 + 只有icon + icon和Tab名</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test4 %&#125;</span><br><span class="line">&lt;!-- tab 第一个Tab --&gt;</span><br><span class="line"><span class="strong">**tab名字为第一个Tab**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab @fab fa-apple-pay --&gt;</span><br><span class="line"><span class="strong">**只有图标 没有Tab名字**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab 炸弹@fas fa-bomb --&gt;</span><br><span class="line"><span class="strong">**名字+icon**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.Demo 1 - 预设选择第一个【默认】</p><div class="tabs" id="test1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test1-1">test1 1</button></li><li class="tab"><button type="button" data-href="#test1-2">test1 2</button></li><li class="tab"><button type="button" data-href="#test1-3">test1 3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test1-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>2.Demo 2 - 预设选择tabs</p><div class="tabs" id="test2"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#test2-1">test2 1</button></li><li class="tab"><button type="button" data-href="#test2-2">test2 2</button></li><li class="tab active"><button type="button" data-href="#test2-3">test2 3</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="test2-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test2-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="test2-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>3.Demo 3 - 没有预设值</p><div class="tabs" id="test3"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#test3-1">test3 1</button></li><li class="tab"><button type="button" data-href="#test3-2">test3 2</button></li><li class="tab"><button type="button" data-href="#test3-3">test3 3</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="test3-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test3-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test3-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>4.Demo 4 - 自定义Tab名 + 只有icon + icon和Tab名</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">第一个Tab</button></li><li class="tab"><button type="button" data-href="#test4-2"><i class="fab fa-apple-pay" style="text-align: center;"></i></button></li><li class="tab"><button type="button" data-href="#test4-3"><i class="fas fa-bomb"></i>炸弹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p><strong>tab名字为第一个Tab</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><p><strong>只有图标 没有Tab名字</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><p><strong>名字+icon</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-22-诗词标签-poem">2.22 诗词标签 poem</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-2">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-3">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><ol><li><code>title</code>：诗词标题</li><li><code>author</code>：作者，可以不写</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% poem 水调歌头,苏轼 %&#125;</span><br><span class="line">丙辰中秋，欢饮达旦，大醉，作此篇，兼怀子由。</span><br><span class="line">明月几时有？把酒问青天。</span><br><span class="line">不知天上宫阙，今夕是何年？</span><br><span class="line">我欲乘风归去，又恐琼楼玉宇，高处不胜寒。</span><br><span class="line">起舞弄清影，何似在人间？</span><br><span class="line"></span><br><span class="line">转朱阁，低绮户，照无眠。</span><br><span class="line">不应有恨，何事长向别时圆？</span><br><span class="line">人有悲欢离合，月有阴晴圆缺，此事古难全。</span><br><span class="line">但愿人长久，千里共婵娟。</span><br><span class="line">&#123;% endpoem %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><div class='poem'><div class='poem-title'>水调歌头</div><div class='poem-author'>苏轼</div><p>丙辰中秋，欢饮达旦，大醉，作此篇，兼怀子由。<br>明月几时有？把酒问青天。<br>不知天上宫阙，今夕是何年？<br>我欲乘风归去，又恐琼楼玉宇，高处不胜寒。<br>起舞弄清影，何似在人间？</p><p>转朱阁，低绮户，照无眠。<br>不应有恨，何事长向别时圆？<br>人有悲欢离合，月有阴晴圆缺，此事古难全。<br>但愿人长久，千里共婵娟。</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-23-阿里图标-icon">2.23 阿里图标 icon</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% icon [icon-xxxx],[font-size] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>icon-xxxx</code>：表示图标<code>font-class</code>,可以在自己的阿里矢量图标库项目的<code>font-class</code>引用方案内查询并复制。</li><li><code>font-size</code>：表示图标大小，直接填写数字即可，单位为<code>em</code>。图标大小默认值为<code>1em</code>。</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% icon icon-rat<span class="emphasis">_zi %&#125;&#123;% icon icon-rat,2 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-ox_</span>chou,3 %&#125;&#123;% icon icon-ox,4 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-tiger<span class="emphasis">_yin,5 %&#125;&#123;% icon icon-tiger,6 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-rabbit_</span>mao,1 %&#125;&#123;% icon icon-rabbit,2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-dragon<span class="emphasis">_chen,3 %&#125;&#123;% icon icon-dragon,4 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-snake_</span>si,5 %&#125;&#123;% icon icon-snake,6 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-horse<span class="emphasis">_wu %&#125;&#123;% icon icon-horse,2 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-goat_</span>wei,3 %&#125;&#123;% icon icon-goat,4 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-monkey<span class="emphasis">_shen,5 %&#125;&#123;% icon icon-monkey,6 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-rooster_</span>you %&#125;&#123;% icon icon-rooster,2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-dog<span class="emphasis">_xu,3 %&#125;&#123;% icon icon-dog,4 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-boar_</span>hai,5 %&#125;&#123;% icon icon-boar,6 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rat_zi"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rat"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-ox_chou"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-ox"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-tiger_yin"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-tiger"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rabbit_mao"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rabbit"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-dragon_chen"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-dragon"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-snake_si"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-snake"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-horse_wu"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-horse"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-goat_wei"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-goat"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-monkey_shen"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-monkey"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rooster_you"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rooster"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-dog_xu"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-dog"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-boar_hai"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-boar"></use></svg></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-24-特效标签wow">2.24 特效标签wow</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-2">渲染演示</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow [animete],[duration],[delay],[offset],[iteration] %&#125;</span><br><span class="line">内容</span><br><span class="line">&#123;% endwow %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>animate</code>: 动画样式，效果详见<a href="https://animate.style/">animate.css参考文档</a></li><li><code>duration</code>: 选填项，动画持续时间，单位可以是<code>ms</code>也可以是<code>s</code>。例如<code>3s</code>，<code>700ms</code>。</li><li><code>delay</code>: 选填项，动画开始的延迟时间，单位可以是<code>ms</code>也可以是<code>s</code>。例如<code>3s</code>，<code>700ms</code>。</li><li><code>offset</code>: 选填项，开始动画的距离（相对浏览器底部）</li><li><code>iteration</code>: 选填项，动画重复的次数</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><p>1.flip动画效果。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__zoomIn,5s,5s,100,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`zoomIn`动画效果，持续`5s`，延时`5s`，离底部`100`距离时启动，重复`10`次</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>2.zoomIn动画效果，持续5s，延时5s，离底部100距离时启动，重复10次</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__zoomIn,5s,5s,100,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`zoomIn`动画效果，持续`5s`，延时`5s`，离底部`100`距离时启动，重复`10`次</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>3.slideInRight动画效果，持续5s，延时5s</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__slideInRight,5s,5s %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note orange &#x27;fas fa-car&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`slideInRight`动画效果，持续`5s`，延时`5s`。</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>4.heartBeat动画效果，延时5s，重复10次。此处注意不用的参数位置要留空，用逗号间隔。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__heartBeat,,5s,,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note red &#x27;fas fa-battery-half&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`heartBeat`动画效果，延时`5s`，重复`10`次。</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>1.flip动画效果。</p><div class='wow animate__zoomIn' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset='100'  data-wow-iteration='10' ><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><code>zoomIn</code>动画效果，持续<code>5s</code>，延时<code>5s</code>，离底部<code>100</code>距离时启动，重复<code>10</code>次</p></div></div><p>2.zoomIn动画效果，持续5s，延时5s，离底部100距离时启动，重复10次</p><div class='wow animate__zoomIn' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset='100'  data-wow-iteration='10' ><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><code>zoomIn</code>动画效果，持续<code>5s</code>，延时<code>5s</code>，离底部<code>100</code>距离时启动，重复<code>10</code>次</p></div></div><p>3.slideInRight动画效果，持续5s，延时5s</p><div class='wow animate__slideInRight' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-car"></i><p><code>slideInRight</code>动画效果，持续<code>5s</code>，延时<code>5s</code>。</p></div></div><p>4.heartBeat动画效果，延时5s，重复10次。此处注意不用的参数位置要留空，用逗号间隔。</p><div class='wow animate__heartBeat' data-wow-duration='' data-wow-delay='5s' data-wow-offset=''  data-wow-iteration='10' ><div class="note red icon-padding modern"><i class="note-icon fas fa-battery-half"></i><p><code>heartBeat</code>动画效果，延时<code>5s</code>，重复<code>10</code>次。</p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-25-进度条-progress">2.25  进度条 progress</h2><div class="note info flat"><p>进度条标签参考<a href="https://rongbuqiu.com/jdt.html">沂佰孜猫-给HEXO文章添加彩色进度条</a>。<br>源样式提取自<a href="https://zwying0814.gitbook.io/cuteen/">Cuteen</a>主题。</p></div><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-2">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% progress [width] [color] [text] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>width</code>: 0到100的阿拉伯数字</li><li><code>color</code>: 颜色，取值有red,yellow,green,cyan,blue,gray</li><li><code>text</code>:进度条上的文字内容</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% progress 10 red 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 30 yellow 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 50 green 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 70 cyan 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 90 blue 进度条样式预览 %&#125;</span><br><span class="line">&#123;% progress 100 gray 进度条样式预览 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-red"  style="width: 10%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-yellow"  style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-green"  style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-cyan"  style="width: 70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-blue"  style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-gray"  style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"><p>进度条样式预览</p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-26-注释-notation">2.26 注释 notation</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% nota [label] , [text] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><p><code>label</code>: 注释词汇</p></li><li><p><code>text</code>: 悬停显示的注解内容</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% nota 把鼠标移动到我上面试试 ,可以看到注解内容出现在顶栏 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p><span class='nota' data-nota='可以看到注解内容出现在顶栏'>把鼠标移动到我上面试试</span></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-27-气泡注释-bubble">2.27 气泡注释 bubble</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bubble [content] , [notation] ,[background-color] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>content</code>: 注释词汇</li><li><code>notation</code>: 悬停显示的注解内容</li><li><code>background-color</code>: 可选，气泡背景色。默认为“#71a4e3”</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最近我学到了不少新玩意儿（虽然对很多大佬来说这些已经是旧技术了），比如CSS的&#123;% bubble 兄弟相邻选择器,&quot;例如 h1 + p &#123;margin-top:50px;&#125;&quot; %&#125;，&#123;% bubble flex布局,&quot;Flex 是 Flexible Box 的缩写，意为&quot;弹性布局&quot;，用来为盒状模型提供最大的灵活性&quot;,&quot;#ec5830&quot; %&#125;，&#123;% bubble transform变换,&quot;transform 属性向元素应用 2D 或 3D 转换。该属性允许我们对元素进行旋转、缩放、移动或倾斜。&quot;,&quot;#1db675&quot; %&#125;，animation的&#123;% bubble 贝塞尔速度曲线,&quot;贝塞尔曲线(Bézier curve)，又称贝兹曲线或贝济埃曲线，是应用于二维图形应用程序的数学曲线。一般的矢量图形软件通过它来精确画出曲线，贝兹曲线由线段与节点组成，节点是可拖动的支点，线段像可伸缩的皮筋&quot;,&quot;#de4489&quot; %&#125;写法，还有今天刚看到的&#123;% bubble clip-path,&quot;clip-path属性使用裁剪方式创建元素的可显示区域。区域内的部分显示，区域外的隐藏。&quot;,&quot;#868fd7&quot; %&#125;属性。这些对我来说很新颖的概念狠狠的冲击着我以前积累起来的设计思路。</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>最近我学到了不少新玩意儿（虽然对很多大佬来说这些已经是旧技术了），比如CSS的<span class="bubble-content">兄弟相邻选择器</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#71a4e3;">例如 h1 + p {margin-top:50px;}</span></span>，<span class="bubble-content">flex布局</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#ec5830;">Flex 是 Flexible Box 的缩写，意为弹性布局&quot;，用来为盒状模型提供最大的灵活性&quot;</span></span>，<span class="bubble-content">transform变换</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#1db675;">transform 属性向元素应用 2D 或 3D 转换。该属性允许我们对元素进行旋转、缩放、移动或倾斜。</span></span>，animation的<span class="bubble-content">贝塞尔速度曲线</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#de4489;">贝塞尔曲线(Bézier curve)，又称贝兹曲线或贝济埃曲线，是应用于二维图形应用程序的数学曲线。一般的矢量图形软件通过它来精确画出曲线，贝兹曲线由线段与节点组成，节点是可拖动的支点，线段像可伸缩的皮筋</span></span>写法，还有今天刚看到的<span class="bubble-content">clip-path</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#868fd7;">clip-path属性使用裁剪方式创建元素的可显示区域。区域内的部分显示，区域外的隐藏。</span></span>属性。这些对我来说很新颖的概念狠狠的冲击着我以前积累起来的设计思路。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-28-引用文献-reference">2.28 引用文献 reference</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% referto [id] , [literature] %&#125;</span><br><span class="line">&#123;% referfrom [id] , [literature] , [url] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><p>referto 引用上标</p><ul><li><p><code>id</code>: 上标序号内容，需与referfrom标签的id对应才能实现跳转</p></li><li><p><code>literature</code>: 引用的参考文献名称</p></li></ul></li><li><p>referfrom 引用出处</p><ul><li><p><code>id</code>: 序号内容，需与referto标签的id对应才能实现 跳转</p></li><li><p><code>literature</code>: 引用的参考文献名称</p></li><li><p><code>url</code>: 引用的参考文献链接，可省略</p></li></ul></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Akilarの糖果屋(akilar.top)是一个私人性质的博客&#123;% referto &#x27;[1]&#x27;,&#x27;Akilarの糖果屋群聊简介&#x27; %&#125;，从各类教程至生活点滴，无话不谈。建群的目的是提供一个闲聊的场所。博客采用Hexo框架&#123;% referto &#x27;[2]&#x27;,&#x27;Hexo中文文档&#x27; %&#125;，Butterfly主题&#123;% referto &#x27;[3]&#x27;,&#x27;Butterfly 安装文档(一) 快速开始&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">本项目参考了Volantis&#123;% referto &#x27;[4]&#x27;,&#x27;hexo-theme-volantis 标签插件&#x27; %&#125;的标签样式。引入<span class="code">`[tag].js`</span>，并针对<span class="code">`butterfly`</span>主题修改了相应的<span class="code">`[tag].styl`</span>。在此鸣谢<span class="code">`Volantis`</span>主题众开发者。</span><br><span class="line">主要参考内容包括各个volantis的内置标签插件文档&#123;% referto &#x27;[5]&#x27;,&#x27;Volantis文档:内置标签插件&#x27; %&#125;</span><br><span class="line">Butterfly主题的各个衍生魔改&#123;% referto &#x27;[6]&#x27;,&#x27;Butterfly 安装文档:标签外挂（Tag Plugins&#x27; %&#125;&#123;% referto &#x27;[7]&#x27;,&#x27;小弋の生活馆全样式预览&#x27; %&#125;&#123;% referto &#x27;[8]&#x27;,&#x27;l-lin-font-awesome-animation&#x27; %&#125;&#123;% referto &#x27;[9]&#x27;,&#x27;小康的butterfly主题使用文档&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% referfrom &#x27;[1]&#x27;,&#x27;Akilarの糖果屋群聊简介&#x27;,&#x27;https://jq.qq.com/?<span class="emphasis">_wv=1027&amp;k=pGLB2C0N&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[2]&#x27;,&#x27;Hexo中文文档&#x27;,&#x27;https://hexo.io/zh-cn/docs/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[3]&#x27;,&#x27;Butterfly 安装文档(一) 快速开始&#x27;,&#x27;https://butterfly.js.org/posts/21cfbf15/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[4]&#x27;,&#x27;hexo-theme-volantis 标签插件&#x27;,&#x27;https://volantis.js.org/v5/tag-plugins/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[5]&#x27;,&#x27;Volantis文档:内置标签插件&#x27;,&#x27;https://volantis.js.org/tag-plugins/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[6]&#x27;,&#x27;Butterfly 安装文档:标签外挂（Tag Plugins&#x27;,&#x27;https://butterfly.js.org/posts/4aa8abbe/#%E6%A8%99%E7%B1%A4%E5%A4%96%E6%8E%9B%EF%BC%88Tag-Plugins%EF%BC%89&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[7]&#x27;,&#x27;小弋の生活馆全样式预览&#x27;,&#x27;https://lovelijunyi.gitee.io/posts/c898.html&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[8]&#x27;,&#x27;l-lin-font-awesome-animation&#x27;,&#x27;https://github.com/l-lin/font-awesome-animation&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[9]&#x27;,&#x27;小康的butterfly主题使用文档&#x27;,&#x27;https://www.antmoe.com/posts/3b43914f/&#x27; %&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>Akilarの糖果屋(akilar.top)是一个私人性质的博客<span class="hidden-anchor" id="referto_[1]"></span><sup class="reference"><a href="#referfrom_[1]">[1]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Akilarの糖果屋群聊简介</span><span class="reference-title">参考资料</span></span></span>，从各类教程至生活点滴，无话不谈。建群的目的是提供一个闲聊的场所。博客采用Hexo框架<span class="hidden-anchor" id="referto_[2]"></span><sup class="reference"><a href="#referfrom_[2]">[2]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Hexo中文文档</span><span class="reference-title">参考资料</span></span></span>，Butterfly主题<span class="hidden-anchor" id="referto_[3]"></span><sup class="reference"><a href="#referfrom_[3]">[3]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Butterfly 安装文档(一) 快速开始</span><span class="reference-title">参考资料</span></span></span></p><p>本项目参考了Volantis<span class="hidden-anchor" id="referto_[4]"></span><sup class="reference"><a href="#referfrom_[4]">[4]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">hexo-theme-volantis 标签插件</span><span class="reference-title">参考资料</span></span></span>的标签样式。引入<code>[tag].js</code>，并针对<code>butterfly</code>主题修改了相应的<code>[tag].styl</code>。在此鸣谢<code>Volantis</code>主题众开发者。<br>主要参考内容包括各个volantis的内置标签插件文档<span class="hidden-anchor" id="referto_[5]"></span><sup class="reference"><a href="#referfrom_[5]">[5]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Volantis文档:内置标签插件</span><span class="reference-title">参考资料</span></span></span><br>Butterfly主题的各个衍生魔改<span class="hidden-anchor" id="referto_[6]"></span><sup class="reference"><a href="#referfrom_[6]">[6]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Butterfly 安装文档:标签外挂（Tag Plugins</span><span class="reference-title">参考资料</span></span></span><span class="hidden-anchor" id="referto_[7]"></span><sup class="reference"><a href="#referfrom_[7]">[7]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">小弋の生活馆全样式预览</span><span class="reference-title">参考资料</span></span></span><span class="hidden-anchor" id="referto_[8]"></span><sup class="reference"><a href="#referfrom_[8]">[8]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">l-lin-font-awesome-animation</span><span class="reference-title">参考资料</span></span></span><span class="hidden-anchor" id="referto_[9]"></span><sup class="reference"><a href="#referfrom_[9]">[9]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">小康的butterfly主题使用文档</span><span class="reference-title">参考资料</span></span></span></p><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://jq.qq.com/?_wv=1027&k=pGLB2C0N">Akilarの糖果屋群聊简介</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[2]"></span><a class="reference-anchor" href="#referto_[2]">[2]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://hexo.io/zh-cn/docs/">Hexo中文文档</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[3]"></span><a class="reference-anchor" href="#referto_[3]">[3]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://butterfly.js.org/posts/21cfbf15/">Butterfly 安装文档(一) 快速开始</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[4]"></span><a class="reference-anchor" href="#referto_[4]">[4]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://volantis.js.org/v5/tag-plugins/">hexo-theme-volantis 标签插件</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[5]"></span><a class="reference-anchor" href="#referto_[5]">[5]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://volantis.js.org/tag-plugins/">Volantis文档:内置标签插件</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[6]"></span><a class="reference-anchor" href="#referto_[6]">[6]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://butterfly.js.org/posts/4aa8abbe/#%E6%A8%99%E7%B1%A4%E5%A4%96%E6%8E%9B%EF%BC%88Tag-Plugins%EF%BC%89">Butterfly 安装文档:标签外挂（Tag Plugins</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[7]"></span><a class="reference-anchor" href="#referto_[7]">[7]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://lovelijunyi.gitee.io/posts/c898.html">小弋の生活馆全样式预览</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[8]"></span><a class="reference-anchor" href="#referto_[8]">[8]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/l-lin/font-awesome-animation">l-lin-font-awesome-animation</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[9]"></span><a class="reference-anchor" href="#referto_[9]">[9]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.antmoe.com/posts/3b43914f/">小康的butterfly主题使用文档</a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-29-PDF展示">2.29 PDF展示</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% pdf 文件路径 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li><code>文件路径</code>: 可以是相对路径或者是在线链接</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.本地文件:在md文件路径下创建一个同名文件夹，其内放pdf文件名为xxx.pdf的文件</span></span><br><span class="line">&#123;% pdf xxx.pdf %&#125;</span><br><span class="line"><span class="section"># 2.在线链接</span></span><br><span class="line">&#123;% pdf https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/pdf/小作文讲义.pdf %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><p>2.在线链接(要放到最外层才能起作用)</p><pre><code>&lt;div class=&quot;row&quot;&gt;&lt;embed src=&quot;https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/pdf/小作文讲义.pdf&quot; width=&quot;100%&quot; height=&quot;550&quot; type=&quot;application/pdf&quot;&gt;&lt;/div&gt;</code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-30-Hexo-tag-map-插件">2.30 Hexo-tag-map 插件</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% + 标签值 + 经度 + 纬度 + 文本 + 缩放等级 + 宽 + 高 + 默认图层 + %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><table><thead><tr><th style="text-align:center">地图名</th><th style="text-align:center">标签值 &lt;必填&gt;</th><th style="text-align:center">宽 (默认 100%) / 高 (默认 360px)</th><th style="text-align:center">缩放等级 (默认 14)</th><th style="text-align:center">宽 (默认 100%) / 高 (默认 360px)</th><th style="text-align:center">默认图层 (默认 1)</th></tr></thead><tbody><tr><td style="text-align:center">混合地图</td><td style="text-align:center">map</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 3~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~7</td></tr><tr><td style="text-align:center">谷歌地图</td><td style="text-align:center">googleMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~20</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~3</td></tr><tr><td style="text-align:center">高德地图</td><td style="text-align:center">gaodeMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 3~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~3</td></tr><tr><td style="text-align:center">百度地图</td><td style="text-align:center">baiduMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 4~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~2</td></tr><tr><td style="text-align:center">Geoq 地图</td><td style="text-align:center">geoqMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~5</td></tr><tr><td style="text-align:center">openstreet 地图</td><td style="text-align:center">openstreetMap</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">取值 1~18</td><td style="text-align:center">百分数或具体值 (100% 或 360px)</td><td style="text-align:center">不支持此参数</td></tr></tbody></table><ol><li>参数之间，用英文逗号相隔</li><li>参数必须按上述事例顺序输入，不得为空</li><li>同一个页面，同一组经纬度值，只能插入一个相同标签值的地图 (若有需要，可以将第二个地图上，经度或纬度末尾删除一两个数)</li><li>参数取值必须在上述范围内</li><li>默认图层：即地图叠加层的值，默认常规地图还是卫星地图，可按地图显示顺序取值</li><li>缩放等级，数字越大，地图比例尺越小，显示的越精细</li><li>除标签值外，其他参数选填，但 每个参数的左边的参数必填</li><li>谷歌地图需要外网才能加载查看</li></ol><p>坐标获取：<a href="https://lbs.amap.com/tools/picker">高德地图坐标拾取系统</a> 、<a href="https://api.map.baidu.com/lbsapi/getpoint/index.html">百度地图坐标拾取系统</a></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% map 120.101101,30.239119 %&#125;</span><br><span class="line">&#123;% googleMap 120.101101,30.239119, 这里是西湖灵隐寺，据说求姻缘很灵验哦！ %&#125;</span><br><span class="line">&#123;% geoqMap 120.101101,30.239119, 这里是西湖灵隐寺，据说求姻缘很灵验哦！, 13, 90%, 320px, 3 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div class="map-box"><div id="map-120.101101-30.239119" style="max-width:100%; height:360px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div></div><script type="text/javascript">var normalm=L.tileLayer.chinaProvider('GaoDe.Normal.Map',{maxZoom:20,minZoom:1,attribution:'Amap'});var imgm=L.tileLayer.chinaProvider('GaoDe.Satellite.Map',{maxZoom:20,minZoom:1,attribution:'Amap'});var imga=L.tileLayer.chinaProvider('GaoDe.Satellite.Annotion',{maxZoom:20,minZoom:1,attribution:'Amap'});var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:20,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'});routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:21,minZoom:1});var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'}),routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:21,minZoom:1,attribution:'Google Maps'});var normalm1=L.tileLayer.chinaProvider('Geoq.Normal.Map',{maxZoom:21,minZoom:1,attribution:'GeoQ'});var normal=L.layerGroup([normalm]),image=L.layerGroup([imgm,imga]);var baseLayers={"高德地图":normal,"智图地图":normalm1,"谷歌地图":normalMap,"高德卫星地图":imgm,"谷歌卫星地图":satelliteMap,"高德卫星标注":image,"谷歌卫星标注":routeMap};var mymap=L.map('map-120.101101-30.239119',{center:[30.239119,120.101101],zoom:14,layers:[normal],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'放大',zoomOutTitle:'缩小'}).addTo(mymap);</script><br><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div id="googleMap-120.101101-30.239119" style="max-width:100%; height:360px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div><script type="text/javascript">var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:22,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:22,minZoom:1,attribution:'Google Maps'}),routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:22,minZoom:1,attribution:'Google Maps'});var baseLayers={"谷歌地图":normalMap,"谷歌卫星图":satelliteMap,"谷歌卫星标注": routeMap};var overlayLayers={};var mymap=L.map("googleMap-120.101101-30.239119",{center:[30.239119,120.101101],zoom:14,layers:[normalMap],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'放大',zoomOutTitle:'缩小'}).addTo(mymap);var marker = L.marker(['30.239119','120.101101']).addTo(mymap);marker.bindPopup("这里是西湖灵隐寺，据说求姻缘很灵验哦！").openPopup();</script><br><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div id="geoqMap-120.101101-30.239119" style="max-width:90%; height:320px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div><script type="text/javascript">var normalm1=L.tileLayer.chinaProvider('Geoq.Normal.Map',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm2=L.tileLayer.chinaProvider('Geoq.Normal.PurplishBlue',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm3=L.tileLayer.chinaProvider('Geoq.Normal.Gray',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm4=L.tileLayer.chinaProvider('Geoq.Normal.Warm',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm5=L.tileLayer.chinaProvider('Geoq.Theme.Hydro',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normal=L.layerGroup([normalm1,normalm2,normalm3,normalm4,normalm5]);var baseLayers={"智图地图":normalm1,"午夜蓝":normalm2,"灰色":normalm3,"暖色":normalm4,"水系":normalm5};var mymap=L.map("geoqMap-120.101101-30.239119",{center:[30.239119,120.101101],zoom:13,layers:[normalm3],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'放大',zoomOutTitle:'缩小'}).addTo(mymap);var marker = L.marker(['30.239119','120.101101']).addTo(mymap);marker.bindPopup("这里是西湖灵隐寺，据说求姻缘很灵验哦！").openPopup();</script><br><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-31-隐藏块">2.31 隐藏块</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#分栏-1">标签语法</button></li><li class="tab"><button type="button" data-href="#分栏-2">参数配置</button></li><li class="tab"><button type="button" data-href="#分栏-3">示例源码</button></li><li class="tab"><button type="button" data-href="#分栏-4">渲染演示</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideBlock display,bg,color %&#125;</span><br><span class="line">content</span><br><span class="line">&#123;% endhideBlock %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-2"><ol><li>content：要隐藏的内容</li><li>display：展示前按钮显示的文字（可选）</li><li>bg：按钮的背景颜色（可选）</li><li>color：按钮显示的文字的颜色（可选）</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideBlock 点我预览, blue %&#125;</span><br><span class="line">这里有张图片：</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://s1.vika.cn/space/2022/10/30/b35fce448bc9404a8d65c3ce1e6e46eb&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;image (1)&quot;</span> <span class="attr">style</span>=<span class="string">&quot;zoom:67%;&quot;</span> /&gt;</span></span></span><br><span class="line">&#123;% endhideBlock %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="分栏-4"><div class="hide-block"><button type="button" class="hide-button" style="background-color:  blue;">点我预览    </button><div class="hide-content"><p>这里有张图片：<br><img src="https://s1.vika.cn/space/2022/10/30/b35fce448bc9404a8d65c3ce1e6e46eb" alt="image (1)" style="zoom:67%;" /></p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> 外挂标签 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
